<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>é€è¯»æºç ä¹‹ OkHttp</title>
      <link href="/2023-03-14/okhttp/"/>
      <url>/2023-03-14/okhttp/</url>
      
        <content type="html"><![CDATA[<p>åš Android å¼€å‘çš„åŒå­¦ä»¬å‡ ä¹æ²¡æœ‰ä¸çŸ¥é“ OkHttp è¿™ä¸ªç½‘ç»œè¯·æ±‚åº“çš„äº†ã€‚è¿™ä¸ªåº“å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆå‡ ä¹æ‰€æœ‰ç±»å‹çš„ã€æ¶µç›–å‡ ä¹æ‰€æœ‰éœ€æ±‚çš„ç½‘ç»œè¯·æ±‚ã€‚</p><p>å®ƒä¸å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„ LeakCanaryã€Retrofit ä¸€æ ·æ¥è‡ªå¤§åé¼é¼çš„ <a href="https://square.github.io/">Square å…¬å¸</a>ï¼Œæˆªè‡³æœ¬æ–‡å†™ä¸‹æ—¶ï¼Œè¯¥åº“åœ¨ Github ä¸Šå·²æœ‰ 43.7k çš„ Start æ•°é‡ã€‚</p><span id="more"></span><h3 id="ä¸€ã€OkHttp-è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#ä¸€ã€OkHttp-è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="ä¸€ã€OkHttp è§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>ä¸€ã€OkHttp è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h3><p>ä»åº“çš„åå­—ä¸éš¾çœ‹å‡ºï¼ŒOkHttp è§£å†³çš„æ˜¯ç½‘ç»œé—®é¢˜ã€‚åœ¨ Android å¼€å‘ä¸­ï¼Œç½‘ç»œé—®é¢˜è‡ªå¤ä»¥æ¥ä¾¿æ˜¯å¼€å‘è€…æ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ã€‚</p><p>åœ¨äº’è”ç½‘æ—¶ä»£ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•åº”ç”¨å¯ä»¥å®Œå…¨è„±ç¦»äº’è”ç½‘ä½¿ç”¨ï¼Œè‰¯å¥½çš„ç½‘ç»œé€šä¿¡è®¾è®¡ï¼Œå¯¹è¡¡é‡ä¸€æ¬¾ APP çš„è´¨é‡æ¥è¯´ï¼Œæ— ç–‘æ˜¯å°¤ä¸ºé‡è¦çš„åŠ åˆ†é¡¹ã€‚</p><p>åœ¨ä¸Šå¤æ—¶æœŸ(ğŸ™…â€â™‚ï¸)ï¼ŒAndroid å¼€å‘è€…ä»¬è¿˜åœ¨ä½¿ç”¨ <code>HttpUrlConnection</code> æ¥å®ç°ç½‘ç»œè¯·æ±‚ï¼Œä¸å¿…å¼•å…¥ä¸‰æ–¹ä»£ç ï¼ŒåŸå§‹ä¸”ç®€å•ã€‚ä½†ä¹Ÿæ­£æ˜¯å› ä¸ºåŸå§‹ï¼Œä¸€äº›é«˜çº§åŠŸèƒ½å°±è¦è‡ªå·±å®ç°ã€‚ç”šè‡³åœ¨ Android2.2 ä¹‹å‰è¿˜æœ‰ Bugï¼Œéœ€è¦ç¦ç”¨è¿æ¥æ± ä»¥æ­£å¸¸ä½¿ç”¨ inputstreamï¼Œæ‰€ä»¥ Google æ¥ä¸‹æ¥å¼•å…¥äº† <code>HttpClient</code>ã€‚å®ƒè§£å†³äº†ä¸€äº›ä½¿ç”¨å’Œç»´æŠ¤ä¸Šçš„é—®é¢˜ï¼Œä½†è¿™ä¸ªåº“é¥±å—å¼€å‘è€…å’Œç»´æŠ¤è€…è¯Ÿç—…ï¼Œå…¶å±äº Apache ç»„ç»‡ï¼ŒAPI å¤æ‚å¤šå˜ï¼Œå¹¶ä¸”ä¸æ˜“æ‰©å±•ï¼Œæ‰€ä»¥è¢« Google å¼ƒä¹‹æ•å±£ã€‚</p><p>äºæ˜¯ä¸€ä¸ªæ˜“ç”¨ã€å¯ç»´æŠ¤ã€å¯æ‹“å±•ã€ç¨³å®šæ€§é«˜çš„ç½‘ç»œè¯·æ±‚åº“åœ¨æ­¤æ—¶å°±åº”è¿è€Œç”Ÿã€‚å®ƒå°±æ˜¯ OkHttpã€‚</p><p>OkHttp é’ˆå¯¹çš„ä¸åªæ˜¯ Androidï¼Œå®ƒå¯¹ Java ç¨‹åºä¹Ÿæœ‰å°è£…ï¼Œå…¶å®ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºä¼ è¾“å±‚ï¼ˆè¿˜è®°å¾—ç½‘ç»œçš„7å±‚æ¶æ„å—ï¼Ÿï¼‰å®ç°åº”ç”¨å±‚åè®®çš„ç½‘ç»œæ¡†æ¶ï¼Œè€Œä¸ä»…æ˜¯ä¸€ä¸ª Http è¯·æ±‚çš„åº“ã€‚</p><p>ç›®å‰æ¥è¯´ï¼Œå¾ˆå¤šå…¬å¸éƒ½å·²ç»åœ¨ä½¿ç”¨ OkHttp å½“åšé»˜è®¤çš„ç½‘ç»œè¯·æ±‚åº“ï¼Œä¸€äº›è‘—åçš„ä¸‰æ–¹åº“ä¹Ÿå·²ç»é»˜è®¤ä½¿ç”¨ OkHttp æ¥åšç½‘ç»œè¯·æ±‚ï¼Œä½ åœ¨é›†æˆå®ƒçš„åŒæ—¶ï¼Œå®ƒä¹Ÿä¼šé»˜é»˜åœ°å¸®ä½ æŠŠ OkHttp é›†æˆè¿›é¡¹ç›®ä¸­ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒOkHttp è§£å†³çš„ï¼Œå°±æ˜¯ç½‘ç»œå¼€å‘ä¸­çš„å„ç§ API ä½¿ç”¨ç¹çã€å¯å®šåˆ¶å¯æ‹“å±•æ€§ä¸é«˜ã€é«˜çº§åŠŸèƒ½è¦è‡ªå·±é€ è½®å­çš„é—®é¢˜ã€‚</p><p>æŒ‰ç…§å®˜æ–¹æ–‡æ¡£æ¥çœ‹ï¼Œå®ƒè¿˜æä¾›äº†è¿æ¥æ± ï¼Œå®ç° GZIP æ ¼å¼ä¼ è¾“ï¼Œé‡å¤è¯·æ±‚çš„ç¼“å­˜ç­‰ã€‚å¹¶ä¸”æ–°ç‰ˆçš„ OkHttp å·²ç»æ”¯æŒ TLS1.3 åè®®(<a href="https://zh.wikipedia.org/wiki/%E5%82%B3%E8%BC%B8%E5%B1%A4%E5%AE%89%E5%85%A8%E6%80%A7%E5%8D%94%E5%AE%9A">ç¥é©¬æ˜¯TLSï¼Ÿ</a>)ï¼Œä»¥åŠå¤š IP åœ°å€è½®è¯¢åŠŸèƒ½ã€‚OkHttp æä¾›ä¸°å¯Œåˆç®€æ˜“çš„ APIï¼Œæ”¯ä»˜åŒæ­¥/å¼‚æ­¥çš„è°ƒç”¨ï¼Œå¹¶ä¸”æœ‰ç€å®Œå–„çš„å›è°ƒæœºåˆ¶ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚</p><h3 id="äºŒã€ä»£ç ç»“æ„"><a href="#äºŒã€ä»£ç ç»“æ„" class="headerlink" title="äºŒã€ä»£ç ç»“æ„"></a>äºŒã€ä»£ç ç»“æ„</h3><p>æœ¬æ–‡ä»¥ OkHttp 5.0.0-SNAPSHOT ä»£ç åšä¸ºç¤ºä¾‹ã€‚</p><p>Clone ä¸€ä¸‹ OkHttp çš„æºç ï¼Œå¯ä»¥çœ‹åˆ° OkHttp çš„ module æœ‰å¾ˆå¤šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/okhttp-1.png"></p><p>æˆ‘ä»¬ä¾æ¬¡ç®€å•ä»‹ç»ä¸€ä¸‹å„ä¸ª moduleã€‚</p><ol><li><code>buildSrc</code>: é¡¹ç›®æ‰“åŒ…æ—¶çš„ä¸€äº›è„šæœ¬ï¼Œå¯ä»¥ç•¥è¿‡ã€‚</li><li><code>logging-interceptor</code>: æ—¥å¿—æ‹¦æˆªå™¨ã€‚è´Ÿè´£è®°å½•ç½‘ç»œè¯·æ±‚å’Œè¿”å›å†…å®¹å¹¶æ‰“å°æ—¥å¿—ï¼Œå¸®åŠ©è®°å½•ä¸æ’æŸ¥é—®é¢˜ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</li></ol><pre><code class="groovy">    implementation(&quot;com.squareup.okhttp3:logging-interceptor:4.10.0&quot;)</code></pre><pre><code class="kotlin">    val logging = HttpLoggingInterceptor()    logging.setLevel(HttpLoggingInterceptor.Level.BASIC)    val client = OkHttpClient.Builder()        .addInterceptor(logging)        .build()</code></pre><ol start="3"><li><code>mockwebserver(3/3-juni4/3-junit5)</code>: æ¨¡æ‹ŸæœåŠ¡å™¨ï¼Œä¸€èˆ¬ç”¨äºæœ¬åœ°çš„æ¨¡æ‹Ÿ API è¯·æ±‚æµ‹è¯•ï¼Œé’ˆå¯¹ä¸åŒçš„ junit ç‰ˆæœ¬åšå‡ºäº†é€‚é…ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</li></ol><pre><code class="groovy">    testImplementation(&quot;com.squareup.okhttp3:mockwebserver:4.10.0&quot;)</code></pre><pre><code class="kotlin">    @Throws(Exception::class)    fun test() &#123;        // åˆ›å»º MokWebServer çš„å®ä¾‹ã€‚æ¯ä¸ªå•å…ƒæµ‹è¯•éƒ½å¯ä»¥åˆ›å»ºä¸åŒçš„å®ä¾‹ã€‚        val server = MockWebServer()        // è®¡åˆ’ä¸€äº›å›åº”æ¶ˆæ¯        server.enqueue(MockResponse(body = &quot;hello, world!&quot;))        server.enqueue(MockResponse(body = &quot;sup, bra?&quot;))        server.enqueue(MockResponse(body = &quot;yo dog&quot;))        // å¯åŠ¨æœåŠ¡        server.start()        val baseUrl: okhttp3.HttpUrl = server.url(&quot;/v1/chat/&quot;)        // æ¨¡æ‹Ÿè¯·æ±‚        val chat = Chat(baseUrl)        chat.loadMore()        assertEquals(&quot;hello, world!&quot;, chat.messages())        chat.loadMore()        chat.loadMore()        assertEquals(        &quot;&quot;&quot;            hello, world!            sup, bra?            yo dog            &quot;&quot;&quot;.trimIndent(), chat.messages()        )        // å¯é€‰ï¼šç¡®å®šä½ çš„åº”ç”¨è¯·æ±‚äº†æ­£ç¡®è·¯å¾„        val request1 = server.takeRequest()        assert(&quot;/v1/chat/messages/&quot; == request1.path)        assert(request1.getHeader(&quot;Authorization&quot;) != null)        val request2 = server.takeRequest()        assert(&quot;/v1/chat/messages/2&quot; == request2.path)        val request3 = server.takeRequest()        assert(&quot;/v1/chat/messages/3&quot; == request3.path)        // å…³é—­æœåŠ¡        server.shutdown()    &#125;</code></pre><p>è¿™éƒ¨åˆ†ä»£ç æˆ‘ä»¬åœ¨ä¹‹åä¼šå†è¿›è¡Œä»‹ç»ã€‚</p><ol start="4"><li><code>okcurl</code>: ä¸€äº›æµ‹è¯•æŒ‡ä»¤ã€‚</li><li><code>okhttp</code>: æ ¸å¿ƒä»£ç ï¼ŒåŒæ—¶åŒ…å«ä¸€äº›æµ‹è¯•ï¼Œæ˜¯æˆ‘ä»¬ä¸»è¦è¦é˜…è¯»çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢è¯¦ç»†é˜…è¯»ã€‚</li><li><code>okhttp-android</code>: é’ˆå¯¹ Android ç³»ç»Ÿå¢åŠ çš„ä¸€äº›æ–‡ä»¶ï¼Œä¸»è¦æ˜¯ä¸€äº› Extension æ–¹æ³•ï¼Œä»¥åŠ Android ä¸Šçš„ DNS è§£æå™¨ã€‚</li><li><code>okhttp-bom</code>: é’ˆå¯¹ Gradle çš„<a href="https://docs.gradle.org/6.2/userguide/platforms.html#sub:bom_import">BOM(Bill-of-Materials)</a>ç‰¹æ€§çš„ç¼–è¯‘è„šæœ¬ï¼Œèƒ½å¤Ÿè®© gradle æ”¯æŒå¦‚ä¸‹å†™æ³•ï¼š</li></ol><pre><code class="groovy">    dependencies &#123;       // define a BOM and its version       implementation(platform(&quot;com.squareup.okhttp3:okhttp-bom:4.10.0&quot;))       // define any required OkHttp artifacts without version       implementation(&quot;com.squareup.okhttp3:okhttp&quot;)       implementation(&quot;com.squareup.okhttp3:logging-interceptor&quot;)    &#125;</code></pre><ol start="8"><li><code>okhttp-brotli</code>: ä½¿ç”¨ <a href="https://github.com/google/brotli">Brotli å‹ç¼©ç®—æ³•</a> åˆ¶ä½œçš„æ‹¦æˆªå™¨ã€‚ä¸»è¦ç”¨æ¥å®ç°ç½‘ç»œä¼ è¾“ä¸­çš„ GZip å‹ç¼©ã€‚å®ƒä¾èµ–äº† brotli åº“ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</li></ol><pre><code class="groovy">    implementation(&quot;com.squareup.okhttp3:okhttp-brotli:4.10.0&quot;)</code></pre><pre><code class="kotlin">    val client = OkHttpClient.Builder()        .addInterceptor(BrotliInterceptor.INSTANCE)        .build() </code></pre><ol start="9"><li><code>okhttp-coroutines</code>: è¯¥ module ç”¨æ¥æ”¯æŒ Kotlin çš„åç¨‹ã€‚</li><li><code>okhttp-dnsoverhttps</code>: å¯¹ <a href="https://zh.wikipedia.org/wiki/DNS_over_HTTPS">DNS over HTTPS</a> çš„å®ç°ã€‚</li><li><code>okhttp-hpacktests</code>: ä¸€äº›æµ‹è¯•ï¼Œç”¨æ¥éªŒè¯ OkHttp å¯¹äº HPACK åŠŸèƒ½çš„å®ç°ã€‚</li><li><code>okhttp-sse</code>: å®éªŒæ€§åŠŸèƒ½ï¼Œå¯ä»¥æ¥å—æœåŠ¡ç«¯å‘é€çš„äº‹ä»¶ã€‚æœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº† <code>Accept:text/event-stream</code> çš„ Header æ¥å®ç°çš„ã€‚ä½†ç›®å‰ä¹Ÿåªæ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œå®ç°æ–¹å¼éšæ—¶å¯èƒ½å˜åŒ–ã€‚</li><li><code>okhttp-testing-support</code>: ä¾› OkHttp å·¥ç¨‹å†…éƒ¨ä½¿ç”¨çš„æµ‹è¯•ç”¨ä¾‹ã€‚</li><li><code>okhttp-tls</code>: æä¾›äº†ä¸€äº›è®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ TLS åŠŸèƒ½çš„ APIã€‚å¦‚ <a href="https://square.github.io/okhttp/4.x/okhttp-tls/okhttp3.tls/-held-certificate/">HeldCertificate</a> å’Œ <a href="https://square.github.io/okhttp/4.x/okhttp-tls/okhttp3.tls/-handshake-certificates/">HandshakeCertificate</a>ã€‚</li><li><code>okhttp-urlconnection</code>: ä» <code>java.net</code> åŒ…ä¸­é›†æˆäº† <code>Authenticator</code> å’Œ <code>CookieHandler</code>ã€‚ä¸»è¦ç”¨äºæµ‹è¯•ã€‚</li><li><code>samples</code>: ä¸€äº›ä½¿ç”¨ä¾‹å­ã€‚åˆæ¬¡ä½¿ç”¨å»ºè®®å…ˆä» Samples çœ‹èµ·ï¼Œå¯ä»¥äº†è§£ä¸€äº›åˆçº§ç”¨æ³•å’Œé«˜çº§ç”¨æ³•ã€‚ä½†å¤§å¤šæ•°æ—¶å€™ï¼Œå®˜ç½‘çš„æ•™ç¨‹è¶³ä»¥æ¶µç›–ç»å¤§å¤šæ•°éœ€æ±‚ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> ä¸‰æ–¹åº“ </tag>
            
            <tag> OkHttp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€è¯»æºç ä¹‹å¼€ç¯‡</title>
      <link href="/2023-03-14/thesourcecode/"/>
      <url>/2023-03-14/thesourcecode/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¼€å‘ä¸­ï¼Œå­¦ä¼šå¦‚ä½•å†™å‡ºä¼˜è´¨çš„ä»£ç å¾ˆé‡è¦ï¼Œå­¦ä¼šä½¿ç”¨ä¸‰æ–¹åº“ä¹Ÿå¾ˆé‡è¦ï¼Œä½†æ›´é‡è¦çš„ï¼Œæ˜¯ç ”ä¹ åˆ«äººå†™ä»£ç çš„æ–¹å¼ï¼Œç„¶åä»ä¸­å­¦åˆ°äº›ä»€ä¹ˆã€‚</p><p>ç°åœ¨å°±ä¸šç«äº‰ç¯å¢ƒç›¸å½“æ¿€çƒˆï¼Œè‡ªå·±æ²¡ç‚¹æœ¬äº‹ï¼Œè¿˜çœŸçš„æ²¡æ³•æ‹¿æä½å„ç§å¥‡è‘©çš„é¢è¯•å®˜ï¼Œé¢è¯•å®˜æœ€å–œæ¬¢é—®çš„é—®é¢˜å°±æ˜¯ï¼š<strong>ä½ è¯»è¿‡å“ªäº›å¼€æºåº“çš„æºä»£ç å‘¢ï¼Ÿ</strong></p><p>ä»–ä»¬åœ¨é—®è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œåœ¨è€ƒéªŒä½ æŠ€æœ¯æ°´å¹³çš„åŒæ—¶ï¼Œä¹Ÿåœ¨çœ‹ï¼Œä½ æ˜¯å¦æœ‰è‡ªä¸»å­¦ä¹ çš„åŠ¨åŠ›ï¼Œæ˜¯å¦èƒ½é˜…è¯»ä¸€ä¸ªä½“ç³»å®Œå–„çš„ç»“æ„æ€§çš„ä»£ç ï¼Œæ˜¯å¦èƒ½ç†è§£å¹¶è½¬åŒ–æˆè‡ªå·±çš„çŸ¥è¯†å¹¶ä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆï¼Œé˜…è¯»å¼€æºä»£ç å°±å°¤å…¶é‡è¦ï¼Œæ— è®ºæ˜¯æ‹¿æ¥å……å®è‡ªå·±ï¼Œè¿˜æ˜¯æ‹¿æ¥éœ‡æ…‘(bushi)é¢è¯•å®˜ï¼Œéƒ½æ˜¯ä¸€æŠŠåˆ©å™¨ã€‚</p><span id="more"></span><p>æˆ‘ä»¬è¯»æºç æ—¶ï¼Œæœ€ä¸»è¦çš„åŸºæœ¬æ–¹å‘æ˜¯è¿™ä¸‰ä¸ªï¼š</p><ol><li>å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜</li><li>é’ˆå¯¹ç‰¹å®šçš„é—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•è§£å†³çš„</li><li>å®ƒæœ‰å“ªäº›é—ªå…‰ç‚¹æ˜¯å€¼å¾—æˆ‘ä»¬å­¦ä¹ çš„</li></ol><p>ç®€å•è®²ä¸€ä¸‹è¿™ä¸‰ä¸ªæ–¹å‘ã€‚</p><h3 id="1-è¿™ä¸ªåº“è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#1-è¿™ä¸ªåº“è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="1. è¿™ä¸ªåº“è§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>1. è¿™ä¸ªåº“è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h3><p>æ˜¾é¡µæ˜“è§ï¼Œæ¯ä¸ªè½®å­è¢«åˆ¶é€ å‡ºæ¥ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³æŸä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„ï¼Œå°±æ˜¯è¿™ä¸ªåº“<strong>ä¸»è¦</strong>è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œ<strong>é¡ºå¸¦</strong>è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå°±å¯ä»¥å¸¦ç€ç–‘é—®å»è¯»ä»£ç ã€‚</p><p>æ‹¿ <a href="https://bumptech.github.io/glide/">Glide</a> è¿™ä¸ªè‘—åçš„å›¾ç‰‡åŠ è½½åº“æ¥ä¸¾ä¸ªä¾‹å­ã€‚</p><h4 id="Glide-ä¸»è¦è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#Glide-ä¸»è¦è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="Glide ä¸»è¦è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>Glide ä¸»è¦è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><p>ä» Glide çš„å®˜æ–¹æ–‡æ¡£æ¥çœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆçš„å›¾ç‰‡åŠ è½½åº“ï¼Œå¹¶ä¸”æä¾›äº†ç®€æ´æ˜“ç”¨çš„ API ä¾›å¼€å‘è€…è°ƒç”¨ã€‚åœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶ï¼Œè¿˜æä¾›äº†é«˜æ‹“å±•æ€§çš„å›¾ç‰‡è§£ç ç®¡é“ï¼ˆdecode pipelineï¼‰ã€‚å®ƒç”šè‡³å¯ä»¥æ‹‰å–å’Œè§£ç è§†é¢‘çš„ç¼©ç•¥å›¾ï¼Œå±•ç¤º GIF å›¾ç‰‡ï¼Œå¹¶æ”¯æŒç½‘ç»œè¯·æ±‚æ‹¦æˆªå™¨ã€‚å¦‚æœä½ å–œæ¬¢ï¼Œä½ ç”šè‡³å¯ä»¥å°†å®ƒçš„ç½‘ç»œè¯·æ±‚éƒ¨åˆ†æ›¿æ¢æˆ Volley æˆ–è€… OkHttpã€‚</p><p>Glide çš„<strong>ä¸»è¦</strong>ç›®æ ‡åœ¨äºè®©åˆ—è¡¨ä¸­çš„å›¾ç‰‡æ»‘åŠ¨èµ·æ¥ä¸å¡é¡¿ï¼Œä½†å®ƒä¹Ÿ<strong>åŒæ—¶</strong>èƒ½å¸®ä½ è§£å†³å›¾ç‰‡åŠ è½½æ—¶çš„å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚æœ¬åœ°å›¾ç‰‡åŠ è½½ã€è¿œç¨‹æ‹‰å–åŠ è½½ã€è£å‰ªç­‰ç­‰ã€‚</p><pre><code>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªé˜¶æ®µçš„å†…å®¹ä¸»è¦æ¥è‡ªäºåº“çš„å®˜æ–¹æ–‡æ¡£ã€‚</code></pre><h4 id="Glide-æ˜¯å¦‚ä½•å®ç°å®ƒçš„ä¸»è¦ç›®æ ‡çš„ï¼Ÿ"><a href="#Glide-æ˜¯å¦‚ä½•å®ç°å®ƒçš„ä¸»è¦ç›®æ ‡çš„ï¼Ÿ" class="headerlink" title="Glide æ˜¯å¦‚ä½•å®ç°å®ƒçš„ä¸»è¦ç›®æ ‡çš„ï¼Ÿ"></a>Glide æ˜¯å¦‚ä½•å®ç°å®ƒçš„ä¸»è¦ç›®æ ‡çš„ï¼Ÿ</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¼€å‘æ—¶çš„å¤§éƒ¨åˆ†æ—¶é—´ï¼Œå›¾ç‰‡åŠ è½½éƒ½å¯ä»¥ä½¿ç”¨ <code>imageView.setImageResource(resId)</code> æˆ–è€… <code>imageView.setImageBitmap(bitmap)</code> æ¥æå®šï¼Œé‚£ Glide ç©¶ç«Ÿåšäº†äº›ä»€ä¹ˆï¼Œæ¥æ›¿ä»£è¿™ä¸¤å¥ä»£ç å‘¢ï¼Ÿ</p><pre><code>é€šè¿‡è¯»æºç ï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä»¬ä¸€å®šèƒ½æ‰¾åˆ°è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚æ­¤å¤„ä¸èµ˜è¿°ï¼Œåé¢ä¼šæœ‰è¯¦ç»†çš„æ–‡ç« ã€‚</code></pre><h4 id="Glide-æ˜¯å¦‚ä½•å®ç°å®ƒçš„æ¬¡è¦ç›®æ ‡çš„ï¼Ÿ"><a href="#Glide-æ˜¯å¦‚ä½•å®ç°å®ƒçš„æ¬¡è¦ç›®æ ‡çš„ï¼Ÿ" class="headerlink" title="Glide æ˜¯å¦‚ä½•å®ç°å®ƒçš„æ¬¡è¦ç›®æ ‡çš„ï¼Ÿ"></a>Glide æ˜¯å¦‚ä½•å®ç°å®ƒçš„æ¬¡è¦ç›®æ ‡çš„ï¼Ÿ</h4><p>å…ˆä¸ææœ¬åœ°å›¾ç‰‡åŠ è½½ï¼Œè¿œç¨‹å›¾ç‰‡åŠ è½½å…¶å®ä»¤æˆ‘ä»¬å¾ˆå¤´ç—›ï¼Œå›¾ç‰‡ä¸‹è½½ã€å›¾ç‰‡ä¿å­˜ã€å›¾ç‰‡ç¼“å­˜ã€å¤§å°é€‚é…ã€é”™è¯¯é‡è¯•ã€æ–­ç‚¹ç»­ä¼ ã€‚ã€‚ã€‚æ¯ä¸€ä¸ªéƒ½æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p><p>é‚£ä¹ˆåœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹ï¼ŒGlide æ˜¯å¦‚ä½•è§£å†³è¿™äº›æ¬¡è¦çš„é—®é¢˜çš„å‘¢ï¼Ÿ</p><pre><code>è¿˜æ˜¯è¦é€šè¿‡é˜…è¯»æºä»£ç ï¼Œæ¥æ‰¾åˆ°è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚æ­¤å¤„äº¦ä¸èµ˜è¿°ï¼Œåé¢ä¼šæœ‰è¯¦ç»†çš„æ–‡ç« ã€‚</code></pre><h3 id="2-é’ˆå¯¹ä¸Šè¿°å‡ ä¸ªé—®é¢˜çš„æ–¹å¼ï¼Œå®ƒçš„è§£å†³æ–¹å¼æ˜¯ä»€ä¹ˆã€‚"><a href="#2-é’ˆå¯¹ä¸Šè¿°å‡ ä¸ªé—®é¢˜çš„æ–¹å¼ï¼Œå®ƒçš„è§£å†³æ–¹å¼æ˜¯ä»€ä¹ˆã€‚" class="headerlink" title="2. é’ˆå¯¹ä¸Šè¿°å‡ ä¸ªé—®é¢˜çš„æ–¹å¼ï¼Œå®ƒçš„è§£å†³æ–¹å¼æ˜¯ä»€ä¹ˆã€‚"></a>2. é’ˆå¯¹ä¸Šè¿°å‡ ä¸ªé—®é¢˜çš„æ–¹å¼ï¼Œå®ƒçš„è§£å†³æ–¹å¼æ˜¯ä»€ä¹ˆã€‚</h3><p>ä¸»è¦é—®é¢˜æ˜¯ï¼Œè§£å†³åˆ—è¡¨å›¾ç‰‡æ»‘åŠ¨ä¸å¡é¡¿çš„é—®é¢˜ï¼Œåœ¨è¯»æºç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°å‘ç° <code>RequestBuilder</code>ã€<code>RequestManager</code> è¿™æ ·çš„ç®¡ç†æ¨¡å—ï¼Œå°†æ‰€æœ‰å›¾ç‰‡çš„åŠ è½½å˜ä¸ºä¸€ä¸ªä¸ªçš„è¯·æ±‚ï¼Œè¿›è¡Œè°ƒåº¦ä¸ç®¡ç†ï¼Œä»è€Œè®©æ¯ä¸€æ¬¡å›¾ç‰‡çš„åŠ è½½ä¸å±•ç¤ºå˜å¾—æœ‰åºä¸”é«˜æ•ˆã€‚</p><p>æ¬¡è¦é—®é¢˜æˆ‘ä»¬ä¸¾å…¶ä¸­ä¸€ä¸ªä¾‹å­â€”â€”ç¼“å­˜ã€‚Glide ä½¿ç”¨äº†<strong>å››çº§ç¼“å­˜</strong>æ¥å®Œæˆç¼“å­˜åŠŸèƒ½ï¼Œæ´»åŠ¨èµ„æº(Active Resources)ã€å†…å­˜ç¼“å­˜(Memory Cache)ã€èµ„æºç¼“å­˜(Resource)ã€æ•°æ®æ–‡ä»¶ç¼“å­˜(Data)ã€‚æ¯å¢åŠ ä¸€çº§ç¼“å­˜ï¼Œéƒ½ä¼šè®©åŠ è½½å›¾ç‰‡çš„é€Ÿåº¦æœ‰ä¸€ä¸ªä¿éšœï¼ŒåŒæ ·åœ°ï¼Œä¹Ÿå¿…é¡»è¦è®¾è®¡å¥½ä»£ç çš„æ¶æ„ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šå¼„å·§æˆæ‹™ã€‚</p><h3 id="3-Glide-æºç ä¸­æœ‰ä»€ä¹ˆé—ªå…‰ç‚¹å€¼å¾—æˆ‘ä»¬å­¦ä¹ å—ï¼Ÿ"><a href="#3-Glide-æºç ä¸­æœ‰ä»€ä¹ˆé—ªå…‰ç‚¹å€¼å¾—æˆ‘ä»¬å­¦ä¹ å—ï¼Ÿ" class="headerlink" title="3. Glide æºç ä¸­æœ‰ä»€ä¹ˆé—ªå…‰ç‚¹å€¼å¾—æˆ‘ä»¬å­¦ä¹ å—ï¼Ÿ"></a>3. Glide æºç ä¸­æœ‰ä»€ä¹ˆé—ªå…‰ç‚¹å€¼å¾—æˆ‘ä»¬å­¦ä¹ å—ï¼Ÿ</h3><p>æœ‰ï¼Œå½“ç„¶æœ‰ã€‚Glide è¿ç”¨äº†å¤§é‡çš„å·¥å‚æ¨¡å¼åŠBuilderæ¨¡å¼ï¼Œæ˜¯æˆ‘ä»¬å¹³æ—¶å¯èƒ½ä¸å¤ªä¼šç”¨åˆ°ï¼Œä½†æ˜¯ç”¨èµ·æ¥å°±ä¼šäº‹åŠåŠŸå€çš„ä¸€äº›å¼€å‘æŠ€å·§ã€‚</p><p>é€šè¿‡ä¸Šé¢çš„ä¸‰ä¸ªå¤§é—®é¢˜ï¼ŒåŸºæœ¬å°±å¯ä»¥å°†æºç æ‹†è§£å¹¶è¯»æ˜ç™½ã€‚</p><p>åœ¨è¯»æºç æ—¶ï¼Œæˆ‘ä»¬ä¸è¦æ€¥äºçº ç»“å„ç§ç»†èŠ‚ï¼Œå¯ä»¥ä»¥å…ˆæ•´ä½“åå±€éƒ¨çš„æ€è·¯å»è¯»ï¼Œå¤ªè¿‡çº ç»“ç»†èŠ‚åé¢ä¼šé˜»æŒ¡ä½ çš„è„šæ­¥ï¼Œä¹Ÿè®¸åœ¨è¯»åˆ°æŸä¸ªåœ°æ–¹çš„æ—¶å€™ï¼Œä½ çªç„¶å°±èƒ½æ˜ç™½åˆšæ‰çš„æŸä¸ªå›°æ‰°ä½ çš„ç‚¹æ˜¯æ€ä¹ˆæå®šçš„äº†ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ã€Šé€è¯»æºç ã€‹ç³»åˆ—çš„å¼€å±±ä¹‹ä½œï¼Œå°±ç”±æ­¤æ‹‰å¼€åºå¹•ï¼Œå¤§å®¶é¼“æŒï¼ï¼</p><p>æœ€åé™„ä¸Šã€Šé€è¯»æºç ã€‹ç³»åˆ—çš„ç›®å½•ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥çœ‹ã€‚</p><ul><li><a href="/2023-03-14/okhttp">é€è¯»æºç ä¹‹ OkHttp</a></li><li><a href="/glide">é€è¯»æºç ä¹‹ Glide</a></li><li><a href="/retrofit">é€è¯»æºç ä¹‹ Retrofit</a></li><li><a href="/activitymanager">é€è¯»æºç ä¹‹ ActivityManager</a></li><li><a href="/leakcanary">é€è¯»æºç ä¹‹ LeakCanary</a></li></ul><p><code>return 0;</code></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> ä¸‰æ–¹åº“ </tag>
            
            <tag> æºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter ä¸ºä»€ä¹ˆè¿™ä¹ˆä¸æ»‘ï¼Ÿ</title>
      <link href="/2023-01-31/flutter-intro/"/>
      <url>/2023-01-31/flutter-intro/</url>
      
        <content type="html"><![CDATA[<p><a href="https://developer.aliyun.com/article/651005">Flutterä¹‹ç¦… å†…å­˜ä¼˜åŒ–ç¯‡</a><br><a href="https://juejin.im/collection/5db25bcff265da06a19a304e">Flutter å®Œæ•´å®æˆ˜è¯¦è§£</a><br><a href="https://github.com/flutter/flutter">flutter æºç </a><br><a href="https://www.jianshu.com/p/b56531850655">åŸ‹ç‚¹</a><br><a href="https://www.jianshu.com/u/cf5c0e4b1111">é—²é±¼æŠ€æœ¯</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Leak Canary</title>
      <link href="/2023-01-31/leakcanary/"/>
      <url>/2023-01-31/leakcanary/</url>
      
        <content type="html"><![CDATA[<blockquote><p>â€œA small leak will sink a great ship.â€ - Benjamin Franklin</p></blockquote><p>è¿™ç¯‡æ–‡ç« æ¥è®²è®²è‘—åçš„ç¬¬ä¸‰æ–¹å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…· - LeakCanaryã€‚</p><blockquote><p>æ³¨ï¼šæœ¬æ–‡æºä»£ç åŸºäº leakcanary-android:2.3</p></blockquote><span id="more"></span><p>LeakCanary çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ä¸€ç¬”å¸¦è¿‡ï¼š</p><pre><code>dependencies &#123;  // debugImplementation because LeakCanary should only run in debug builds.  debugImplementation &#39;com.squareup.leakcanary:leakcanary-android:2.3&#39;&#125;</code></pre><p>é…ç½®å®Œ gradle ä¾èµ–åï¼Œä»»ä½•ä»£ç éƒ½ä¸ç”¨å†™ï¼Œå°±èƒ½ç›´æ¥ç”Ÿæ•ˆã€‚</p><p>ç¥å¥‡å—ï¼Ÿç¥å¥‡å°±å¯¹äº†ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ä¸Šæåˆ°ï¼ŒLeakCanary èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ä¸‹é¢å‡ ç§å¯¹è±¡ï¼š</p><ul><li>é”€æ¯ä¹‹åçš„ Activity å®ä¾‹</li><li>é”€æ¯ä¹‹åçš„ Fragment å®ä¾‹</li><li>é”€æ¯ä¹‹åçš„ Fragment View å®ä¾‹</li><li>æ¸…é™¤ä¹‹åçš„ ViewModel å®ä¾‹</li></ul><p>åœ¨è¿™å‡ ç§è¡Œä¸ºå‘ç”Ÿåï¼ŒLeanCanary ä¼šåšå››ä¸ªæ­¥éª¤æ¥å¸®åŠ©æˆ‘ä»¬åˆ†ææ˜¯å¦æœ‰å†…å­˜æ³„æ¼ï¼š</p><ol><li>æ£€æŸ¥æ˜¯å¦æœ‰è¢«ä¿ç•™ä¸‹çš„å¯¹è±¡</li><li>Dump Heap</li><li>åˆ†æ HPROF æ–‡ä»¶</li><li>å¯¹æ³„æ¼çš„éƒ¨åˆ†è¿›è¡Œåˆ†ç±»</li></ol><p>æˆ‘ä»¬æ¥æŒ‰æ­¥éª¤åˆ†æåˆ†æå®ƒçš„æºç ï¼Œçœ‹å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•åšåˆ°çš„ã€‚</p><h2 id="æ£€æŸ¥è¦è¢«ä¿ç•™çš„å¯¹è±¡"><a href="#æ£€æŸ¥è¦è¢«ä¿ç•™çš„å¯¹è±¡" class="headerlink" title="æ£€æŸ¥è¦è¢«ä¿ç•™çš„å¯¹è±¡"></a>æ£€æŸ¥è¦è¢«ä¿ç•™çš„å¯¹è±¡</h2><p>LeanCanary ä¼šç›‘æµ‹ Android ç»„ä»¶ï¼ˆå¹¶ä¸æ˜¯å…¨éƒ¨ï¼‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å®ƒä»¬é”€æ¯çš„æ—¶å€™ï¼Œä¼šæ£€æµ‹å®ƒä»¬æ˜¯å¦å‡ºç°äº†å†…å­˜æ³„æ¼ã€‚</p><p>è¿™äº›å¯¹è±¡ä¼šè¢«ä¼ é€’åˆ°ä¸€ä¸ª ObjectWatcher ç±»ï¼Œå®ƒä½¿ç”¨ WeakReference æ¥æŒæœ‰è¿™äº›å®ä¾‹ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»æ¥è‡ªå·±è§‚å¯ŸæŸä¸ªå¯¹è±¡æ˜¯å¦å‡ºç°äº†æ³„æ¼ã€‚</p><p>å®ƒçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="kotlin">/** * [ObjectWatcher] can be passed objects to [watch]. It will create [KeyedWeakReference] instances * that reference watches objects, and check if those references have been cleared as expected on * the [checkRetainedExecutor] executor. If not, these objects are considered retained and * [ObjectWatcher] will then notify the [onObjectRetainedListener] on that executor thread. * * [checkRetainedExecutor] is expected to run its tasks on a background thread, with a significant * to give the GC the opportunity to identify weakly reachable objects. * * [ObjectWatcher] is thread safe. */// Thread safe by locking on all methods, which is reasonably efficient given how often// these methods are accessed.class ObjectWatcher constructor(  private val clock: Clock,  private val checkRetainedExecutor: Executor,  /**   * Calls to [watch] will be ignored when [isEnabled] returns false   */  private val isEnabled: () -&gt; Boolean = &#123; true &#125;) &#123;  private val onObjectRetainedListeners = mutableSetOf&lt;OnObjectRetainedListener&gt;()  /**   * References passed to [watch].   */  private val watchedObjects = mutableMapOf&lt;String, KeyedWeakReference&gt;()  private val queue = ReferenceQueue&lt;Any&gt;()  ...  /**   * Returns the objects that are currently considered retained. Useful for logging purposes.   * Be careful with those objects and release them ASAP as you may creating longer lived leaks   * then the one that are already there.   */  val retainedObjects: List&lt;Any&gt;    @Synchronized get() &#123;      removeWeaklyReachableObjects()      val instances = mutableListOf&lt;Any&gt;()      for (weakReference in watchedObjects.values) &#123;        if (weakReference.retainedUptimeMillis != -1L) &#123;          val instance = weakReference.get()          if (instance != null) &#123;            instances.add(instance)          &#125;        &#125;      &#125;      return instances    &#125;  ...  /**   * Watches the provided [watchedObject].   *   * @param description Describes why the object is watched.   */  @Synchronized fun watch(    watchedObject: Any,    description: String  ) &#123;    if (!isEnabled()) &#123;      return    &#125;    removeWeaklyReachableObjects()    val key = UUID.randomUUID()        .toString()    val watchUptimeMillis = clock.uptimeMillis()    val reference =      KeyedWeakReference(watchedObject, key, description, watchUptimeMillis, queue)    SharkLog.d &#123;      &quot;Watching &quot; +          (if (watchedObject is Class&lt;*&gt;) watchedObject.toString() else &quot;instance of $&#123;watchedObject.javaClass.name&#125;&quot;) +          (if (description.isNotEmpty()) &quot; ($description)&quot; else &quot;&quot;) +          &quot; with key $key&quot;    &#125;    watchedObjects[key] = reference    checkRetainedExecutor.execute &#123;      moveToRetained(key)    &#125;  &#125;  ...&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒObjectWatcher å†…éƒ¨æœ‰è¿™ä¹ˆå‡ ä¸ªé‡è¦çš„ä¸œè¥¿ï¼š</p><ul><li><code>onObjectRetainedListeners</code>ï¼Œä½¿ç”¨è€…å¯ä»¥æ‰‹åŠ¨æ·»åŠ  OnObjectRetainedListenerï¼Œå½“æœ‰å¯¹è±¡è¢«ä¿ç•™æ—¶ï¼Œå¯ä»¥æ¥æ”¶åˆ°å›è°ƒï¼›</li><li><code>watchedObjects</code>ï¼ŒæŒæœ‰å¯¹è¦è§‚å¯Ÿçš„å¯¹è±¡çš„ WeakReferenceã€‚å¯ä»¥çœ‹åˆ° LeakCanary ä½¿ç”¨äº† KeyedWeakReferenceï¼Œå®ƒæ˜¯ WeakReference çš„å­ç±»ï¼Œæ·»åŠ äº†ä¸€ä¸ªå­—æ®µç”¨äºä¿å­˜å¯¹è±¡è¢«è§‚æµ‹çš„æ—¶é•¿ï¼›</li><li><code>queue</code>ï¼Œ<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ref/ReferenceQueue.html">ReferenceQueue</a>ï¼Œè¿™æ˜¯ Java ä¸­çš„ç‰¹æ€§ï¼Œå½“å†…å­˜ä¸­å¯¹è±¡çš„å¯è¾¾æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒGC ä¼šå°†å˜åŒ–çš„å¯¹è±¡æ·»åŠ åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ï¼›</li><li><code>retainedObjects</code>ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼çš„å¯¹è±¡å°±ä¿å­˜åœ¨è¿™ä¸ª List ä¸­ï¼Œä¾›åç»­åˆ†æä½¿ç”¨ã€‚</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLeakCanary ä¼šå°†åº”ç”¨ä¸­çš„ Activityã€Fragment ç­‰ç»„ä»¶æ³¨å†Œåˆ° ObjectWatcher ä¸­ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ˜¯åœ¨ä½•æ—¶æ³¨å†Œçš„ï¼Ÿ</p><p>é€šè¿‡æ‰’æ‹‰ä»£ç ï¼Œæˆ‘å‘ç°äº†ä½äº leakcanary/internal/ ä¸­çš„è¿™ä¸ªç±»ï¼šAppWatcherInstallerã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="kotlin">/** * Content providers are loaded before the application class is created. [AppWatcherInstaller] is * used to install [leakcanary.AppWatcher] on application start. */internal sealed class AppWatcherInstaller : ContentProvider() &#123;  ...  override fun onCreate(): Boolean &#123;    val application = context!!.applicationContext as Application    InternalAppWatcher.install(application)    return true  &#125;  ...&#125;</code></pre><p>å‰å®³äº†ï¼Œåˆ©ç”¨äº† Content Provider ä¼šæ—©äº Application ç±»åŠ è½½çš„è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨ <code>onCreate()</code> æ–¹æ³•ä¸­è°ƒç”¨äº† <code>InternalAppWatcher.install()</code> æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–çš„å·¥ä½œï¼š</p><pre><code class="kotlin">internal object InternalAppWatcher &#123;  private val onAppWatcherInstalled: (Application) -&gt; Unit  ...  init &#123;    val internalLeakCanary = try &#123;      val leakCanaryListener = Class.forName(&quot;leakcanary.internal.InternalLeakCanary&quot;)      leakCanaryListener.getDeclaredField(&quot;INSTANCE&quot;).get(null)    &#125; catch (ignored: Throwable) &#123;      NoLeakCanary    &#125;    @kotlin.Suppress(&quot;UNCHECKED_CAST&quot;)    onAppWatcherInstalled = internalLeakCanary as (Application) -&gt; Unit  &#125;  ...  val objectWatcher = ObjectWatcher(      clock = clock,      checkRetainedExecutor = checkRetainedExecutor,      isEnabled = &#123; AppWatcher.config.enabled &#125;  )  fun install(application: Application) &#123;    SharkLog.logger = DefaultCanaryLog()    checkMainThread()    if (this::application.isInitialized) &#123;      return    &#125;    InternalAppWatcher.application = application    val configProvider = &#123; AppWatcher.config &#125;    ActivityDestroyWatcher.install(application, objectWatcher, configProvider)    FragmentDestroyWatcher.install(application, objectWatcher, configProvider)    onAppWatcherInstalled(application)  &#125;  ...  private fun checkMainThread() &#123;    if (Looper.getMainLooper().thread !== Thread.currentThread()) &#123;      throw UnsupportedOperationException(          &quot;Should be called from the main thread, not $&#123;Thread.currentThread()&#125;&quot;      )    &#125;  &#125;  ...&#125;</code></pre><p><code>InternalAppWatcher.install()</code> æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥äº†å½“å‰ä»£ç æ˜¯å¦è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼›ç„¶ååˆ†åˆ«è°ƒç”¨äº† ActivityDestroyWatcher å’Œ FragmentDestroyWatcher çš„ <code>install()</code> æ–¹æ³•ï¼Œå½“è¿™äº›äº‹æƒ…éƒ½åšå®Œåï¼Œç”¨äº†ä¸€ä¸ªç§€å„¿çš„æ–¹æ³•ï¼Œç»™ <code>internalLeakCanary</code> è¿™ä¸ªæˆå‘˜å˜é‡èµ‹å€¼ã€‚</p><p><img src="https://s3.ax1x.com/2020/12/11/rAhsB9.md.jpg"></p><p>æ¥çœ‹ ActivityDestroyWatcherï¼š</p><pre><code class="kotlin">internal class ActivityDestroyWatcher private constructor(  private val objectWatcher: ObjectWatcher,  private val configProvider: () -&gt; Config) &#123;  private val lifecycleCallbacks =    object : Application.ActivityLifecycleCallbacks by noOpDelegate() &#123;      override fun onActivityDestroyed(activity: Activity) &#123;        if (configProvider().watchActivities) &#123;          objectWatcher.watch(              activity, &quot;$&#123;activity::class.java.name&#125; received Activity#onDestroy() callback&quot;          )        &#125;      &#125;    &#125;  companion object &#123;    fun install(      application: Application,      objectWatcher: ObjectWatcher,      configProvider: () -&gt; Config    ) &#123;      val activityDestroyWatcher = ActivityDestroyWatcher(objectWatcher, configProvider)      application.registerActivityLifecycleCallbacks(activityDestroyWatcher.lifecycleCallbacks)    &#125;  &#125;&#125;</code></pre><p>å®ƒçš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œç›´æ¥åˆ›å»º ActivityDestroyWatcher çš„å®ä¾‹ï¼Œå¹¶åˆ©ç”¨ Application ä¸­çš„ ActivityLifecycleCallbacks æ¥å£ï¼Œæ¥æ”¶ Activity çš„ <code>onActivityDestroyed()</code> å›è°ƒï¼Œç„¶åå°† Activity äº¤ç»™ ObjectWatcherã€‚</p><blockquote><p>kotlin ä¸­çš„ by ä¸€èˆ¬ç”¨äºå®ç°å§”æ‰˜æœºåˆ¶ï¼Œåœ¨è¿™é‡Œçš„åŠŸèƒ½ç›¸å½“äºå¯ä»¥çœç•¥æ‰å…¶ä»–çš„å›è°ƒçš„ä»£ç ã€‚<br>noOpDelegate çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="kotlin">inline fun &lt;reified T : Any&gt; noOpDelegate(): T &#123;    val javaClass = T::class.java    val noOpHandler = InvocationHandler &#123; _, _, _ -&gt;      // no op    &#125;    return Proxy.newProxyInstance(        javaClass.classLoader, arrayOf(javaClass), noOpHandler    ) as T  &#125;</code></pre></blockquote><p>FragmentDestroyWatcher ç¨å¾®å¤æ‚ä¸€äº›ï¼š</p><pre><code class="kotlin">internal object FragmentDestroyWatcher &#123;  private const val ANDROIDX_FRAGMENT_CLASS_NAME = &quot;androidx.fragment.app.Fragment&quot;  private const val ANDROIDX_FRAGMENT_DESTROY_WATCHER_CLASS_NAME = &quot;leakcanary.internal.AndroidXFragmentDestroyWatcher&quot;  // Using a string builder to prevent Jetifier from changing this string to Android X Fragment  @Suppress(&quot;VariableNaming&quot;, &quot;PropertyName&quot;)  private val ANDROID_SUPPORT_FRAGMENT_CLASS_NAME = StringBuilder(&quot;android.&quot;).append(&quot;support.v4.app.Fragment&quot;).toString()  private const val ANDROID_SUPPORT_FRAGMENT_DESTROY_WATCHER_CLASS_NAME = &quot;leakcanary.internal.AndroidSupportFragmentDestroyWatcher&quot;  fun install(    application: Application,    objectWatcher: ObjectWatcher,    configProvider: () -&gt; AppWatcher.Config  ) &#123;    val fragmentDestroyWatchers = mutableListOf&lt;(Activity) -&gt; Unit&gt;()    if (SDK_INT &gt;= O) &#123;      fragmentDestroyWatchers.add(          AndroidOFragmentDestroyWatcher(objectWatcher, configProvider)      )    &#125;    getWatcherIfAvailable(        ANDROIDX_FRAGMENT_CLASS_NAME,        ANDROIDX_FRAGMENT_DESTROY_WATCHER_CLASS_NAME,        objectWatcher,        configProvider    )?.let &#123;      fragmentDestroyWatchers.add(it)    &#125;    getWatcherIfAvailable(        ANDROID_SUPPORT_FRAGMENT_CLASS_NAME,        ANDROID_SUPPORT_FRAGMENT_DESTROY_WATCHER_CLASS_NAME,        objectWatcher,        configProvider    )?.let &#123;      fragmentDestroyWatchers.add(it)    &#125;    if (fragmentDestroyWatchers.size == 0) &#123;      return    &#125;    application.registerActivityLifecycleCallbacks(object : Application.ActivityLifecycleCallbacks by noOpDelegate() &#123;      override fun onActivityCreated(activity: Activity, savedInstanceState: Bundle?) &#123;        for (watcher in fragmentDestroyWatchers) &#123;          watcher(activity)        &#125;      &#125;    &#125;)  &#125;  private fun getWatcherIfAvailable(    fragmentClassName: String,    watcherClassName: String,    objectWatcher: ObjectWatcher,    configProvider: () -&gt; AppWatcher.Config  ): ((Activity) -&gt; Unit)? &#123;    return if (classAvailable(fragmentClassName) &amp;&amp;        classAvailable(watcherClassName)    ) &#123;      val watcherConstructor = Class.forName(watcherClassName)          .getDeclaredConstructor(ObjectWatcher::class.java, Function0::class.java)      @Suppress(&quot;UNCHECKED_CAST&quot;)      watcherConstructor.newInstance(objectWatcher, configProvider) as (Activity) -&gt; Unit    &#125; else &#123;      null    &#125;  &#125;  private fun classAvailable(className: String): Boolean &#123;    return try &#123;      Class.forName(className)      true    &#125; catch (e: Throwable) &#123;      // e is typically expected to be a ClassNotFoundException      // Unfortunately, prior to version 25.0.2 of the support library the      // FragmentManager.FragmentLifecycleCallbacks class was a non static inner class.      // Our AndroidSupportFragmentDestroyWatcher class is compiled against the static version of      // the FragmentManager.FragmentLifecycleCallbacks class, leading to the      // AndroidSupportFragmentDestroyWatcher class being rejected and a NoClassDefFoundError being      // thrown here. So we&#39;re just covering our butts here and catching everything, and assuming      // any throwable means &quot;can&#39;t use this&quot;. See https://github.com/square/leakcanary/issues/1662      false    &#125;  &#125;&#125;</code></pre><p>å¯¹ Fragment çš„ç›‘æ§æ˜¯ä¸»è¦é‡‡ç”¨äº†ä¸¤ä¸ªç±»ï¼š<code>leakcanary.internal.AndroidXFragmentDestroyWatcher</code> å’Œ <code>leakcanary.internal.AndroidSupportFragmentDestroyWatcher</code>ã€‚è¿™ä¸¤ä¸ªç±»çš„å®ç°æ–¹å¼ç›¸åŒï¼Œéƒ½æ˜¯ lambda è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬åªçœ‹å…¶ä¸­ä¸€ä¸ªï¼š</p><pre><code class="kotlin">internal class AndroidXFragmentDestroyWatcher(  private val objectWatcher: ObjectWatcher,  private val configProvider: () -&gt; Config) : (Activity) -&gt; Unit &#123;  private val fragmentLifecycleCallbacks = object : FragmentManager.FragmentLifecycleCallbacks() &#123;    override fun onFragmentCreated(      fm: FragmentManager,      fragment: Fragment,      savedInstanceState: Bundle?    ) &#123;      ViewModelClearedWatcher.install(fragment, objectWatcher, configProvider)    &#125;    override fun onFragmentViewDestroyed(      fm: FragmentManager,      fragment: Fragment    ) &#123;      val view = fragment.view      if (view != null &amp;&amp; configProvider().watchFragmentViews) &#123;        objectWatcher.watch(            view, &quot;$&#123;fragment::class.java.name&#125; received Fragment#onDestroyView() callback &quot; +            &quot;(references to its views should be cleared to prevent leaks)&quot;        )      &#125;    &#125;    override fun onFragmentDestroyed(      fm: FragmentManager,      fragment: Fragment    ) &#123;      if (configProvider().watchFragments) &#123;        objectWatcher.watch(            fragment, &quot;$&#123;fragment::class.java.name&#125; received Fragment#onDestroy() callback&quot;        )      &#125;    &#125;  &#125;  override fun invoke(activity: Activity) &#123;    if (activity is FragmentActivity) &#123;      val supportFragmentManager = activity.supportFragmentManager      supportFragmentManager.registerFragmentLifecycleCallbacks(fragmentLifecycleCallbacks, true)      ViewModelClearedWatcher.install(activity, objectWatcher, configProvider)    &#125;  &#125;&#125;</code></pre><p>åˆ©ç”¨äº† FragmentManager ä¸­çš„ FragmentLifecycleCallbacks æ¥å£å®ç°äº†å¯¹ Fragment ç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬ï¼ŒåŒæ—¶è¿˜å¯¹ ViewModel çš„é”€æ¯äº‹ä»¶åšäº†ç›‘å¬ã€‚</p><p>å½“ Activity èµ°å®Œè‡ªå·±çš„ <code>onDestroy()</code> æ–¹æ³•åï¼ŒWatcher ä¸­çš„ watch() æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼ˆä¸Šæ–¹ä»£ç ï¼‰ï¼Œç„¶åï¼Œåˆ©ç”¨äº† Executor ï¼ˆæ³¨æ„ï¼Œè¯¥ Executor æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè·‘çš„ï¼‰å¼€å§‹æ‰§è¡Œ<code>moveToRetained(key)</code>ä»£ç ï¼š</p><pre><code class="kotlin">@Synchronized private fun moveToRetained(key: String) &#123;  removeWeaklyReachableObjects()  val retainedRef = watchedObjects[key]  if (retainedRef != null) &#123;    retainedRef.retainedUptimeMillis = clock.uptimeMillis()    onObjectRetainedListeners.forEach &#123; it.onObjectRetained() &#125;  &#125;&#125;</code></pre><p>é¦–å…ˆç§»é™¤äº†æ‰€æœ‰åœ¨ GC åä¾æ—§æœ‰å¯è¾¾æ€§çš„å¯¹è±¡ï¼Œå¦‚æœå…¨éƒ¨éƒ½ç§»é™¤äº†ï¼Œ<code>retainedRef</code> å°±æ˜¯ <code>null</code>ï¼Œåˆ™ä¸ä¼šè§¦å‘å›è°ƒï¼Œè¯æ˜æ²¡æœ‰å†…å­˜æ³„æ¼ï¼›å¦‚æœç§»é™¤ä¸äº†ï¼Œè¯´æ˜æœ‰å†…å­˜æ³„æ¼ï¼Œå¼€å§‹è¿›è¡Œä¸‹ä¸€æ­¥ï¼šDump Heapã€‚</p><h2 id="Dump-Heap"><a href="#Dump-Heap" class="headerlink" title="Dump Heap"></a>Dump Heap</h2><p>ä¹¦æ¥ä¸Šæ–‡ï¼ŒWatcher å¼€å§‹å›è°ƒæ‰€æœ‰çš„ <code>onObjectRetainedListeners</code>ã€‚è¿™äº› Listeners æ˜¯åœ¨ä½•æ—¶è¢«æ·»åŠ çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å›åˆ°åˆå§‹åŒ–çš„éƒ¨åˆ†ï¼Œä¹Ÿå³<code>InternalAppWatcher.install()</code>ï¼Œå…¶ä¸­æœ‰è¿™æ ·çš„ä»£ç ï¼š</p><pre><code class="kotlin">init &#123;    val internalLeakCanary = try &#123;      val leakCanaryListener = Class.forName(&quot;leakcanary.internal.InternalLeakCanary&quot;)      leakCanaryListener.getDeclaredField(&quot;INSTANCE&quot;).get(null)    &#125; catch (ignored: Throwable) &#123;      NoLeakCanary    &#125;    @kotlin.Suppress(&quot;UNCHECKED_CAST&quot;)    onAppWatcherInstalled = internalLeakCanary as (Application) -&gt; Unit  &#125;</code></pre><p>å½“ <code>onAppWatcherInstalled</code> è¿™ä¸ª Lambda è¡¨è¾¾å¼è¢«æ‰§è¡Œæ—¶ï¼Œ<code>leakcanary.internal.InternalLeakCanary</code> è¿™ä¸ªç±»ä¼šè¢«åˆå§‹åŒ–ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªç±»ï¼š</p><pre><code class="kotlin">internal object InternalLeakCanary : (Application) -&gt; Unit, OnObjectRetainedListener &#123;  private lateinit var heapDumpTrigger: HeapDumpTrigger  lateinit var application: Application  override fun invoke(application: Application) &#123;    this.application = application    checkRunningInDebuggableBuild()    AppWatcher.objectWatcher.addOnObjectRetainedListener(this)    val heapDumper = AndroidHeapDumper(application, leakDirectoryProvider)    val gcTrigger = GcTrigger.Default    val configProvider = &#123; LeakCanary.config &#125;    val handlerThread = HandlerThread(LEAK_CANARY_THREAD_NAME)    handlerThread.start()    val backgroundHandler = Handler(handlerThread.looper)    heapDumpTrigger = HeapDumpTrigger(        application, backgroundHandler, AppWatcher.objectWatcher, gcTrigger, heapDumper,        configProvider    )    application.registerVisibilityListener &#123; applicationVisible -&gt;      this.applicationVisible = applicationVisible      heapDumpTrigger.onApplicationVisibilityChanged(applicationVisible)    &#125;    registerResumedActivityListener(application)    addDynamicShortcut(application)    disableDumpHeapInTests()  &#125;  ...  override fun onObjectRetained() &#123;    if (this::heapDumpTrigger.isInitialized) &#123;      heapDumpTrigger.onObjectRetained()    &#125;  &#125;  fun onDumpHeapReceived(forceDump: Boolean) &#123;    if (this::heapDumpTrigger.isInitialized) &#123;      heapDumpTrigger.onDumpHeapReceived(forceDump)    &#125;  &#125;  ...&#125;</code></pre><p>å¥½å®¶ä¼™ï¼Œæˆ‘ TM ç›´æ¥å¥½å®¶ä¼™ï¼Œè¿™å±…ç„¶åˆæ˜¯ä¸ª Lambda è¡¨è¾¾å¼ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥çœ‹ <code>invoke()</code> å›è°ƒéƒ¨åˆ†ä¸­ï¼Œæœ‰ <code>AppWatcher.objectWatcher.addOnObjectRetainedListener(this)</code> è¿™æ ·ä¸€å¥ï¼Œå°†è‡ªå·±åšä¸ºè¢«å›è°ƒæ–¹æ·»åŠ åˆ°äº† watcher ä¸­ï¼Œé‚£ä¹ˆä¸Šé¢çš„ <code>onObjectRetainedListener</code> å°±æ‰¾åˆ°äº†å®ç°è€…ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨äº† <code>heapDumpTrigger.onObjectRetained()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å»çœ‹çœ‹è¿™é‡Œåšäº†ä»€ä¹ˆã€‚</p><pre><code class="kotlin">fun onObjectRetained() &#123;    scheduleRetainedObjectCheck(        reason = &quot;found new object retained&quot;,        rescheduling = false    )&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°åªæ˜¯å¾ˆç®€å•åœ°è°ƒç”¨äº† <code>scheduleRetainedObjectCheck()</code> æ–¹æ³•ï¼š</p><pre><code class="kotlin">private fun scheduleRetainedObjectCheck(  reason: String,  rescheduling: Boolean,  delayMillis: Long = 0L) &#123;  val checkCurrentlyScheduledAt = checkScheduledAt  if (checkCurrentlyScheduledAt &gt; 0) &#123;    val scheduledIn = checkCurrentlyScheduledAt - SystemClock.uptimeMillis()    SharkLog.d &#123; &quot;Ignoring request to check for retained objects ($reason), already scheduled in $&#123;scheduledIn&#125;ms&quot; &#125;    return  &#125; else &#123;    val verb = if (rescheduling) &quot;Rescheduling&quot; else &quot;Scheduling&quot;    val delay = if (delayMillis &gt; 0) &quot; in $&#123;delayMillis&#125;ms&quot; else &quot;&quot;    SharkLog.d &#123; &quot;$verb check for retained objects$&#123;delay&#125; because $reason&quot; &#125;  &#125;  checkScheduledAt = SystemClock.uptimeMillis() + delayMillis  backgroundHandler.postDelayed(&#123;    checkScheduledAt = 0    checkRetainedObjects(reason)  &#125;, delayMillis)&#125;</code></pre><p>è®°å½•äº†æ—¶é—´æˆ³ä¹‹åï¼Œå¼€å§‹åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ <code>checkRetainedObjects(reason)</code> æ–¹æ³•ï¼š</p><pre><code class="kotlin">private fun checkRetainedObjects(reason: String) &#123;  ...  val now = SystemClock.uptimeMillis()  val elapsedSinceLastDumpMillis = now - lastHeapDumpUptimeMillis  if (elapsedSinceLastDumpMillis &lt; WAIT_BETWEEN_HEAP_DUMPS_MILLIS) &#123;    onRetainInstanceListener.onEvent(DumpHappenedRecently)    showRetainedCountNotification(        objectCount = retainedReferenceCount,        contentText = application.getString(R.string.leak_canary_notification_retained_dump_wait)    )    scheduleRetainedObjectCheck(        reason = &quot;previous heap dump was $&#123;elapsedSinceLastDumpMillis&#125;ms ago (&lt; $&#123;WAIT_BETWEEN_HEAP_DUMPS_MILLIS&#125;ms)&quot;,        rescheduling = true,        delayMillis = WAIT_BETWEEN_HEAP_DUMPS_MILLIS - elapsedSinceLastDumpMillis    )    return  &#125;  SharkLog.d &#123; &quot;Check for retained objects found $retainedReferenceCount objects, dumping the heap&quot; &#125;  dismissRetainedCountNotification()  dumpHeap(retainedReferenceCount, retry = true)  ...&#125;</code></pre><p>é¦–æ¬¡è¿è¡Œæ—¶ï¼Œ<code>lastHeapDumpUptimeMillis</code> ä¸º <code>0</code>ï¼Œæ‰€ä»¥ä»£ç ä¼šæ‰§è¡Œåˆ° <code>dumpHeap(retainedReferenceCount, retry = true)</code>ï¼Œè€Œåç»­æ‰§è¡Œæ—¶ï¼Œå¦‚æœä¸¤æ¬¡æ‰§è¡Œçš„é—´éš”è¿‡å°ï¼ˆ60ç§’ï¼‰ï¼Œåˆ™ç›´æ¥å±•ç¤ºé€šçŸ¥ï¼Œä¸å† dump heapã€‚</p><pre><code class="kotlin">private fun dumpHeap(retainedReferenceCount: Int, retry: Boolean) &#123;  saveResourceIdNamesToMemory()  val heapDumpUptimeMillis = SystemClock.uptimeMillis()  KeyedWeakReference.heapDumpUptimeMillis = heapDumpUptimeMillis  val heapDumpFile = heapDumper.dumpHeap()  if (heapDumpFile == null) &#123;    if (retry) &#123;      SharkLog.d &#123; &quot;Failed to dump heap, will retry in $WAIT_AFTER_DUMP_FAILED_MILLIS ms&quot; &#125;      scheduleRetainedObjectCheck(          reason = &quot;failed to dump heap&quot;,          rescheduling = true,          delayMillis = WAIT_AFTER_DUMP_FAILED_MILLIS      )    &#125; else &#123;      SharkLog.d &#123; &quot;Failed to dump heap, will not automatically retry&quot; &#125;    &#125;    showRetainedCountNotification(        objectCount = retainedReferenceCount,        contentText = application.getString(            R.string.leak_canary_notification_retained_dump_failed        )    )    return  &#125;  lastDisplayedRetainedObjectCount = 0  lastHeapDumpUptimeMillis = SystemClock.uptimeMillis()  objectWatcher.clearObjectsWatchedBefore(heapDumpUptimeMillis)  HeapAnalyzerService.runAnalysis(application, heapDumpFile)&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå…³é”®çš„ä¸€æ­¥æ˜¯ <code>heapDumper.dumpHeap()</code> æ–¹æ³•ï¼Œè¿™é‡Œ dump å‡ºæ¥çš„å†…å­˜æ•°æ®ä¼šç›´æ¥ä¾›åé¢çš„ HeapAnalyzerService ä½¿ç”¨ã€‚æ­¤å¤„çš„ <code>heapDumper</code> æ˜¯ä¸€ä¸ª AndroidHeapDumper çš„å®ä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="kotlin">internal class AndroidHeapDumper(  context: Context,  private val leakDirectoryProvider: LeakDirectoryProvider) : HeapDumper &#123;  private val context: Context = context.applicationContext  private val mainHandler: Handler = Handler(Looper.getMainLooper())  override fun dumpHeap(): File? &#123;    val heapDumpFile = leakDirectoryProvider.newHeapDumpFile() ?: return null    val waitingForToast = FutureResult&lt;Toast?&gt;()    showToast(waitingForToast)    if (!waitingForToast.wait(5, SECONDS)) &#123;      SharkLog.d &#123; &quot;Did not dump heap, too much time waiting for Toast.&quot; &#125;      return null    &#125;    val notificationManager =      context.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager    if (Notifications.canShowNotification) &#123;      val dumpingHeap = context.getString(R.string.leak_canary_notification_dumping)      val builder = Notification.Builder(context)          .setContentTitle(dumpingHeap)      val notification = Notifications.buildNotification(context, builder, LEAKCANARY_LOW)      notificationManager.notify(R.id.leak_canary_notification_dumping_heap, notification)    &#125;    val toast = waitingForToast.get()    return try &#123;      Debug.dumpHPROFData(heapDumpFile.absolutePath)      if (heapDumpFile.length() == 0L) &#123;        SharkLog.d &#123; &quot;Dumped heap file is 0 byte length&quot; &#125;        null      &#125; else &#123;        heapDumpFile      &#125;    &#125; catch (e: Exception) &#123;      SharkLog.d(e) &#123; &quot;Could not dump heap&quot; &#125;      // Abort heap dump      null    &#125; finally &#123;      cancelToast(toast)      notificationManager.cancel(R.id.leak_canary_notification_dumping_heap)    &#125;  &#125;  private fun showToast(waitingForToast: FutureResult&lt;Toast?&gt;) &#123;    mainHandler.post(Runnable &#123;      val resumedActivity = InternalLeakCanary.resumedActivity      if (resumedActivity == null) &#123;        waitingForToast.set(null)        return@Runnable      &#125;      val toast = Toast(resumedActivity)      val iconSize = resumedActivity.resources.getDimensionPixelSize(          R.dimen.leak_canary_toast_icon_size      )      toast.setGravity(Gravity.CENTER_VERTICAL, 0, -iconSize)      toast.duration = Toast.LENGTH_LONG      // Inflating with application context: https://github.com/square/leakcanary/issues/1385      val inflater = LayoutInflater.from(context)      toast.view = inflater.inflate(R.layout.leak_canary_heap_dump_toast, null)      toast.show()      val toastIcon = toast.view.findViewById&lt;View&gt;(R.id.leak_canary_toast_icon)      toastIcon.translationY = -iconSize.toFloat()      toastIcon          .animate()          .translationY(0f)          .setListener(object : AnimatorListenerAdapter() &#123;            override fun onAnimationEnd(animation: Animator) &#123;              waitingForToast.set(toast)            &#125;          &#125;)    &#125;)  &#125;  private fun cancelToast(toast: Toast?) &#123;    if (toast == null) &#123;      return    &#125;    mainHandler.post &#123; toast.cancel() &#125;  &#125;&#125;</code></pre><p>dump çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥åˆ†ä¸ºå››æ­¥ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ª HPROF æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨å†…å­˜ä¿¡æ¯ï¼›</li><li>å±•ç¤ºä¸€ä¸ªé€šçŸ¥æ–¹ä¾¿å¼€å‘è€…ç‚¹å‡»å¯Ÿçœ‹ï¼›</li><li>å±•ç¤ºä¸€ä¸ª toast å‘Šè¯‰å¼€å‘è€…æœ‰å†…å­˜æ³„æ¼å¹¶è¯·ç­‰å¾…ï¼›</li><li>è°ƒç”¨ <code>Debug.dumpHPROFData()</code> æ–¹æ³•å†™å…¥æ–‡ä»¶ã€‚</li></ol><p><code>Debug.dumpHPROFData()</code> æ–¹æ³•æ˜¯ Android æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¼šå°† HPROF ä¿¡æ¯å­˜å‚¨åˆ°æŒ‡å®šçš„è·¯å¾„ä¸­ï¼ŒåŒæ—¶å¯èƒ½ä¼šå¼•èµ·ä¸€æ¬¡ GCã€‚</p><p>ç”Ÿæˆ HPROF æ–‡ä»¶ä¹‹åï¼Œå°±æ¥åˆ°äº†é‡å¤´æˆï¼Œç¬¬ä¸‰æ­¥â€”â€”åˆ†æ HPROF æ–‡ä»¶ã€‚</p><h2 id="åˆ†æ-HPROF-æ–‡ä»¶"><a href="#åˆ†æ-HPROF-æ–‡ä»¶" class="headerlink" title="åˆ†æ HPROF æ–‡ä»¶"></a>åˆ†æ HPROF æ–‡ä»¶</h2><p>ä¸Šé¢æåˆ°äº†ï¼Œåˆ†æ HPROF æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ HeapAnalyzerService è¿™ä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®ç°æ–¹æ³•ã€‚</p><p>HeapAnalyzerService æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª IntentServiceï¼Œå®ƒç»§æ‰¿è‡ª leakcanary.internal.ForegoundServiceï¼Œè€Œ ForegroundService åˆç»§æ‰¿è‡ª IntentServiceã€‚</p><pre><code class="kotlin">internal class HeapAnalyzerService : ForegroundService(    HeapAnalyzerService::class.java.simpleName,    R.string.leak_canary_notification_analysing,    R.id.leak_canary_notification_analyzing_heap), OnAnalysisProgressListener &#123;    override fun onHandleIntentInForeground(intent: Intent?) &#123;    if (intent == null || !intent.hasExtra(HEAPDUMP_FILE_EXTRA)) &#123;      SharkLog.d &#123; &quot;HeapAnalyzerService received a null or empty intent, ignoring.&quot; &#125;      return    &#125;    // Since we&#39;re running in the main process we should be careful not to impact it.    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND)    val heapDumpFile = intent.getSerializableExtra(HEAPDUMP_FILE_EXTRA) as File    val config = LeakCanary.config    val heapAnalysis = if (heapDumpFile.exists()) &#123;      analyzeHeap(heapDumpFile, config)    &#125; else &#123;      missingFileFailure(heapDumpFile)    &#125;    onAnalysisProgress(REPORTING_HEAP_ANALYSIS)    config.onHeapAnalyzedListener.onHeapAnalyzed(heapAnalysis)  &#125;  ...  companion object &#123;    private const val HEAPDUMP_FILE_EXTRA = &quot;HEAPDUMP_FILE_EXTRA&quot;    private const val PROGUARD_MAPPING_FILE_NAME = &quot;leakCanaryObfuscationMapping.txt&quot;    fun runAnalysis(      context: Context,      heapDumpFile: File    ) &#123;      val intent = Intent(context, HeapAnalyzerService::class.java)      intent.putExtra(HEAPDUMP_FILE_EXTRA, heapDumpFile)      startForegroundService(context, intent)    &#125;    private fun startForegroundService(      context: Context,      intent: Intent    ) &#123;      if (SDK_INT &gt;= 26) &#123;        context.startForegroundService(intent)      &#125; else &#123;        // Pre-O behavior.        context.startService(intent)      &#125;    &#125;  &#125;&#125;</code></pre><p>åœ¨è°ƒç”¨äº† <code>HeapAnalyzerService.runAnalysis()</code> æ–¹æ³•ä¹‹åï¼Œå°±å¯åŠ¨äº†è¿™ä¸ªå‰å°æœåŠ¡ï¼Œæœ€ç»ˆä¼šè°ƒç”¨å› <code>onHandleIntentInForeground()</code> æ–¹æ³•ï¼Œç´§æ¥ç€ï¼Œåœ¨è°ƒä½è¿›ç¨‹ä¼˜å…ˆçº§åï¼Œè°ƒç”¨äº† <code>analyzeHeap()</code> æ–¹æ³•ï¼›</p><pre><code class="kotlin">private fun analyzeHeap(  heapDumpFile: File,  config: Config): HeapAnalysis &#123;  val heapAnalyzer = HeapAnalyzer(this)  val proguardMappingReader = try &#123;    ProguardMappingReader(assets.open(PROGUARD_MAPPING_FILE_NAME))  &#125; catch (e: IOException) &#123;    null  &#125;  return heapAnalyzer.analyze(      heapDumpFile = heapDumpFile,      leakingObjectFinder = config.leakingObjectFinder,      referenceMatchers = config.referenceMatchers,      computeRetainedHeapSize = config.computeRetainedHeapSize,      objectInspectors = config.objectInspectors,      metadataExtractor = config.metadataExtractor,      proguardMapping = proguardMappingReader?.readProguardMapping()  )&#125;</code></pre><p>æ­¤å¤„æ–°å»ºäº† HeapAnalyzer çš„å®ä¾‹å¹¶è¿›è¡Œ HPROF æ–‡ä»¶çš„å¤„ç†ã€‚</p><p>Leakcanary åœ¨åˆ†æ HPROF æ–‡ä»¶æ–¹é¢è¿›è¡Œäº†ä¸€æ¬¡å˜é©ï¼Œä¹‹å‰ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹åº“ <a href="https://github.com/square/haha">HAHA</a>ï¼Œåæ¥åˆç€æ‰‹å¼€å‘äº†è‡ªå·±çš„åº“å« <a href="https://square.github.io/leakcanary/shark/">Shark</a>ã€‚æ¥ä¸‹æ¥å°±å¼€å§‹ä½¿ç”¨åˆ°è‡ªå·±çš„ Shark åº“äº†ï¼ŒHeapAnalyzer å°±æ˜¯è¿™ä¸ªåº“ä¸­çš„ç±»ã€‚</p><pre><code class="kotlin">class HeapAnalyzer constructor(  private val listener: OnAnalysisProgressListener) &#123;  ...  /**   * Searches the heap dump for leaking instances and then computes the shortest strong reference   * path from those instances to the GC roots.   */  fun analyze(    heapDumpFile: File,    leakingObjectFinder: LeakingObjectFinder,    referenceMatchers: List&lt;ReferenceMatcher&gt; = emptyList(),    computeRetainedHeapSize: Boolean = false,    objectInspectors: List&lt;ObjectInspector&gt; = emptyList(),    metadataExtractor: MetadataExtractor = MetadataExtractor.NO_OP,    proguardMapping: ProguardMapping? = null  ): HeapAnalysis &#123;    ...    return try &#123;      listener.onAnalysisProgress(PARSING_HEAP_DUMP)      Hprof.open(heapDumpFile)          .use &#123; hprof -&gt;            val graph = HprofHeapGraph.indexHprof(hprof, proguardMapping)            val helpers = FindLeakInput(graph, referenceMatchers, computeRetainedHeapSize, objectInspectors)            helpers.analyzeGraph(                metadataExtractor, leakingObjectFinder, heapDumpFile, analysisStartNanoTime            )          &#125;    &#125; catch (exception: Throwable) &#123;      HeapAnalysisFailure(          heapDumpFile, System.currentTimeMillis(), since(analysisStartNanoTime),          HeapAnalysisException(exception)      )    &#125;  &#125;&#125;</code></pre><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°±ä¸å…·ä½“å±•å¼€ Shark å¯¹äº HPROF æ–‡ä»¶çš„è§£æäº†ï¼Œæœ‰ç©ºå•å¼€ä¸€ç¯‡æ–‡ç« è®²ä¸€è®²ã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨åˆ†æå®Œ HRPOF æ–‡ä»¶åï¼Œè¿”å›åˆ†æç»“æœï¼Œå¹¶äº¤ç»™ <code>config.onHeapAnalyzedListener.onHeapAnalyzed(heapAnalysis)</code>ã€‚</p><p>è¿™ä¸ª Config æœ‰å¿…è¦æä¸€ä¸‹ï¼Œå®ƒæ˜¯ä¸ªè´¯ç©¿å§‹ç»ˆçš„è§’è‰²ï¼Œé‡Œé¢å­˜å‚¨äº† N å¤šçš„å…¨å±€å˜é‡ï¼Œæ˜¯ä¸€ä¸ª data ç±»ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ <code>copy()</code> æ–¹æ³•ä¿®æ”¹ Leakcanary çš„é»˜è®¤é…ç½®ï¼Œæˆ–è€…è‡ªå®šä¹‰è§£æå™¨ã€å„ç§ Listener ç­‰ç­‰ã€‚æ­¤å¤„çš„ <code>onHeapAnalyzedListener</code> æ˜¯åœ¨ config ä¸­å·²ç»è¢«é¢„å®šä¹‰å¥½çš„ï¼š</p><pre><code class="kotlin">/**  * Called on a background thread when the heap analysis is complete.  * If you want leaks to be added to the activity that lists leaks, make sure to delegate  * calls to a [DefaultOnHeapAnalyzedListener].  *  * Defaults to [DefaultOnHeapAnalyzedListener]  */val onHeapAnalyzedListener: OnHeapAnalyzedListener = DefaultOnHeapAnalyzedListener.create(),</code></pre><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„ <code>onHeapAnalyzed()</code> æ–¹æ³•ï¼š</p><pre><code class="kotlin">class DefaultOnHeapAnalyzedListener(private val application: Application) : OnHeapAnalyzedListener &#123;  private val mainHandler = Handler(Looper.getMainLooper())  override fun onHeapAnalyzed(heapAnalysis: HeapAnalysis) &#123;    SharkLog.d &#123; &quot;$heapAnalysis&quot; &#125;    val id = LeaksDbHelper(application).writableDatabase.use &#123; db -&gt;      HeapAnalysisTable.insert(db, heapAnalysis)    &#125;    val (contentTitle, screenToShow) = when (heapAnalysis) &#123;      is HeapAnalysisFailure -&gt; application.getString(          R.string.leak_canary_analysis_failed      ) to HeapAnalysisFailureScreen(id)      is HeapAnalysisSuccess -&gt; &#123;        val retainedObjectCount = heapAnalysis.allLeaks.sumBy &#123; it.leakTraces.size &#125;        val leakTypeCount = heapAnalysis.applicationLeaks.size + heapAnalysis.libraryLeaks.size        application.getString(            R.string.leak_canary_analysis_success_notification, retainedObjectCount, leakTypeCount        ) to HeapDumpScreen(id)      &#125;    &#125;    if (InternalLeakCanary.formFactor == TV) &#123;      showToast(heapAnalysis)      printIntentInfo()    &#125; else &#123;      showNotification(screenToShow, contentTitle)    &#125;  &#125;&#125;</code></pre><p>ä¸è€ƒè™‘æˆ‘ä»¬æ˜¯ TV çš„æƒ…å†µï¼Œä¼šå±•ç¤ºä¸€ä¸ªé€šçŸ¥ï¼š</p><pre><code class="kotlin">private fun showNotification(  screenToShow: Screen,  contentTitle: String) &#123;  val pendingIntent = LeakActivity.createPendingIntent(      application, arrayListOf(HeapDumpsScreen(), screenToShow)  )  val contentText = application.getString(R.string.leak_canary_notification_message)  Notifications.showNotification(      application, contentTitle, contentText, pendingIntent,      R.id.leak_canary_notification_analysis_result,      LEAKCANARY_MAX  )&#125;</code></pre><p>ç‚¹å‡»è¿™ä¸ªé€šçŸ¥ï¼Œå°±ä¼šè¿›å…¥ LeakActivityã€‚LeakActivity å°±ä¼šå®Œæ•´å±•ç¤ºå†…å­˜æ³„æ¼çš„ Reference è·¯å¾„ï¼Œæ–¹ä¾¿å¼€å‘è€…æŸ¥æ‰¾é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> æºç è§£æ </tag>
            
            <tag> leakcanary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Android åŠ¨ç”»çš„ä¸€åˆ‡</title>
      <link href="/2023-01-31/android-animation/"/>
      <url>/2023-01-31/android-animation/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android å¯åŠ¨è¿‡ç¨‹åˆ†æ</title>
      <link href="/2023-01-31/android-boot/"/>
      <url>/2023-01-31/android-boot/</url>
      
        <content type="html"><![CDATA[<p>éš¾é“ä½ ä¸å¥½å¥‡ Android ç³»ç»Ÿæ˜¯æ€æ ·å¯åŠ¨çš„å—ï¼Ÿ</p><span id="more"></span><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒAndroid æ˜¯åŸºäº Linux ç³»ç»Ÿçš„ï¼Œä½†æ˜¯ç”±äº Android å±äºåµŒå…¥å¼è®¾å¤‡ï¼Œå¹¶æ²¡æœ‰åƒ PC é‚£æ ·çš„ BIOS ç¨‹åºã€‚ å–è€Œä»£ä¹‹çš„æ˜¯ Bootloader â€”â€” <strong>ç³»ç»Ÿå¯åŠ¨åŠ è½½å™¨</strong>ã€‚ å®ƒç±»ä¼¼äº BIOSï¼Œåœ¨ç³»ç»ŸåŠ è½½å‰ï¼Œç”¨ä»¥<strong>åˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡</strong>ï¼Œ<strong>å»ºç«‹å†…å­˜ç©ºé—´çš„æ˜ åƒå›¾</strong>ï¼Œä¸ºæœ€ç»ˆ<strong>è°ƒç”¨ç³»ç»Ÿå†…æ ¸</strong>å‡†å¤‡å¥½ç¯å¢ƒã€‚ åœ¨ Android é‡Œæ²¡æœ‰ç¡¬ç›˜ï¼Œè€Œæ˜¯ ROMï¼Œå®ƒç±»ä¼¼äºç¡¬ç›˜å­˜æ”¾æ“ä½œç³»ç»Ÿï¼Œç”¨æˆ·ç¨‹åºç­‰ã€‚ ROM è·Ÿç¡¬ç›˜ä¸€æ ·ä¹Ÿä¼šåˆ’åˆ†ä¸ºä¸åŒçš„åŒºåŸŸï¼Œç”¨äºæ”¾ç½®ä¸åŒçš„ç¨‹åºï¼Œåœ¨ Android ä¸­ä¸»è¦åˆ’åˆ†ä¸ºä¸€ä¸‹å‡ ä¸ªåˆ†åŒºï¼š</p><ul><li>/bootï¼šå­˜æ”¾å¼•å¯¼ç¨‹åºï¼ŒåŒ…æ‹¬å†…æ ¸å’Œå†…å­˜æ“ä½œç¨‹åº</li><li>/systemï¼šç›¸å½“äºç”µè„‘cç›˜ï¼Œå­˜æ”¾Androidç³»ç»ŸåŠç³»ç»Ÿåº”ç”¨</li><li>/recoveryï¼šæ¢å¤åˆ†åŒºï¼Œå¯ä»¥è¿›å…¥è¯¥åˆ†åŒºè¿›è¡Œç³»ç»Ÿæ¢å¤</li><li>/dataï¼šç”¨æˆ·æ•°æ®åŒºï¼ŒåŒ…å«äº†ç”¨æˆ·çš„æ•°æ®ï¼šè”ç³»äººã€çŸ­ä¿¡ã€è®¾ç½®ã€ç”¨æˆ·å®‰è£…çš„ç¨‹åº</li><li>/cacheï¼šå®‰å“ç³»ç»Ÿç¼“å­˜åŒºï¼Œä¿å­˜ç³»ç»Ÿæœ€å¸¸è®¿é—®çš„æ•°æ®å’Œåº”ç”¨ç¨‹åº</li><li>/miscï¼šåŒ…å«ä¸€äº›æ‚é¡¹å†…å®¹ï¼Œå¦‚ç³»ç»Ÿè®¾ç½®å’Œç³»ç»ŸåŠŸèƒ½å¯ç”¨ç¦ç”¨è®¾ç½®</li><li>/sdcardï¼šç”¨æˆ·è‡ªå·±çš„å­˜å‚¨åŒºï¼Œå¯ä»¥å­˜æ”¾ç…§ç‰‡ï¼ŒéŸ³ä¹ï¼Œè§†é¢‘ç­‰æ–‡ä»¶</li></ul><p>é‚£ä¹ˆï¼ŒBootloader æ˜¯å¦‚ä½•è¢«åŠ è½½çš„å‘¢ï¼Ÿè·Ÿ PC å¯åŠ¨è¿‡ç¨‹ç±»ä¼¼ï¼Œå½“å¼€æœºé€šç”µæ—¶é¦–å…ˆä¼šåŠ è½½ Bootloaderï¼ŒBootloader å›è¯»å– ROM æ‰¾åˆ°æ“ä½œç³»ç»Ÿå¹¶å°† Linux å†…æ ¸åŠ è½½åˆ° RAM ä¸­ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ª Android ç³»ç»Ÿå¯åŠ¨çš„æµç¨‹å›¾ï¼š</p><p><img src="/img/68.png"></p><p>å½“ Linux å†…æ ¸å¯åŠ¨åä¼šåˆå§‹åŒ–å„ç§è½¯ç¡¬ä»¶ç¯å¢ƒï¼ŒåŠ è½½é©±åŠ¨ç¨‹åºï¼ŒæŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ŒLinux å†…æ ¸åŠ è½½çš„æœ€åé˜¶æ®µä¼šå¯åŠ¨æ‰§è¡Œç¬¬ä¸€ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹ init è¿›ç¨‹ã€‚</p><h2 id="init-è¿›ç¨‹"><a href="#init-è¿›ç¨‹" class="headerlink" title="init è¿›ç¨‹"></a>init è¿›ç¨‹</h2><p><img src="/img/69.png"></p><p>init æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹(pid=1)ï¼ŒKernel å¯åŠ¨åä¼šè°ƒç”¨ /system/core/init/Init.cpp çš„<code>main()</code>æ–¹æ³•ã€‚<br>é¦–å…ˆåˆå§‹åŒ– Kernel logï¼Œåˆ›å»ºä¸€å—å…±äº«çš„å†…å­˜ç©ºé—´ï¼ŒåŠ è½½ /default.prop æ–‡ä»¶ï¼Œè§£æ init.rc æ–‡ä»¶ã€‚</p><h3 id="init-rc-æ–‡ä»¶"><a href="#init-rc-æ–‡ä»¶" class="headerlink" title="init.rc æ–‡ä»¶"></a>init.rc æ–‡ä»¶</h3><p>init.rc æ–‡ä»¶æ˜¯ Android ç³»ç»Ÿçš„é‡è¦é…ç½®æ–‡ä»¶ï¼Œä½äº /system/core/rootdir/ ç›®å½•ä¸­ã€‚ ä¸»è¦åŠŸèƒ½æ˜¯å®šä¹‰äº†ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œçš„ä¸€ç³»åˆ— action åŠæ‰§è¡Œç‰¹å®šåŠ¨ä½œã€è®¾ç½®ç¯å¢ƒå˜é‡å’Œå±æ€§å’Œæ‰§è¡Œç‰¹å®šçš„ serviceã€‚</p><p>init.rc è„šæœ¬æ–‡ä»¶é…ç½®äº†ä¸€äº›é‡è¦çš„æœåŠ¡ï¼Œinit è¿›ç¨‹é€šè¿‡åˆ›å»ºå­è¿›ç¨‹å¯åŠ¨è¿™äº›æœåŠ¡ï¼Œè¿™é‡Œåˆ›å»ºçš„ service éƒ½å±äº native æœåŠ¡ï¼Œè¿è¡Œåœ¨ Linux ç©ºé—´ï¼Œé€šè¿‡ socket å‘ä¸Šå±‚æä¾›ç‰¹å®šçš„æœåŠ¡ï¼Œå¹¶ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œåœ¨åå°ã€‚</p><p>é€šè¿‡ init.rc è„šæœ¬ç³»ç»Ÿå¯åŠ¨äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„æœåŠ¡ï¼š</p><ul><li>service_managerï¼šå¯åŠ¨ binder IPCï¼Œç®¡ç†æ‰€æœ‰çš„ Android ç³»ç»ŸæœåŠ¡</li><li>mountdï¼šè®¾å¤‡å®‰è£… Daemonï¼Œè´Ÿè´£è®¾å¤‡å®‰è£…åŠçŠ¶æ€é€šçŸ¥</li><li>debuggerdï¼šå¯åŠ¨ debug systemï¼Œå¤„ç†è°ƒè¯•è¿›ç¨‹çš„è¯·æ±‚</li><li>rildï¼šå¯åŠ¨ radio interface layer daemon æœåŠ¡ï¼Œå¤„ç†ç”µè¯ç›¸å…³çš„äº‹ä»¶å’Œè¯·æ±‚</li><li>media_serverï¼šå¯åŠ¨ AudioFlingerï¼ŒMediaPlayerService å’Œ CameraServiceï¼Œè´Ÿè´£å¤šåª’ä½“æ’­æ”¾ç›¸å…³çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬éŸ³è§†é¢‘è§£ç </li><li>surface_flingerï¼šå¯åŠ¨ SurfaceFlinger è´Ÿè´£æ˜¾ç¤ºè¾“å‡º</li><li>zygoteï¼šè¿›ç¨‹å­µåŒ–å™¨ï¼Œå¯åŠ¨ Android Java VMRuntime å’Œå¯åŠ¨ systemserverï¼Œè´Ÿè´£ Android åº”ç”¨è¿›ç¨‹çš„å­µåŒ–å·¥ä½œ</li></ul><p>åœ¨è¿™ä¸ªé˜¶æ®µä½ å¯ä»¥åœ¨è®¾å¤‡çš„å±å¹•ä¸Šçœ‹åˆ° â€œAndroidâ€ logo äº†ã€‚</p><p>ä»¥ä¸Šå·¥ä½œæ‰§è¡Œå®Œï¼Œinit è¿›ç¨‹å°±ä¼šè¿›å…¥ loop çŠ¶æ€ã€‚</p><h2 id="service-manager-è¿›ç¨‹"><a href="#service-manager-è¿›ç¨‹" class="headerlink" title="service_manager è¿›ç¨‹"></a>service_manager è¿›ç¨‹</h2><p>ServiceManager æ˜¯ Binder IPC é€šä¿¡è¿‡ç¨‹ä¸­çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª Binder æœåŠ¡ã€‚ServiceManager è¿›ç¨‹ä¸»è¦æ˜¯å¯åŠ¨ Binderï¼Œæä¾›æœåŠ¡çš„æŸ¥è¯¢å’Œæ³¨å†Œã€‚</p><h2 id="surface-flinger-è¿›ç¨‹"><a href="#surface-flinger-è¿›ç¨‹" class="headerlink" title="surface_flinger è¿›ç¨‹"></a>surface_flinger è¿›ç¨‹</h2><p>SurfaceFlinger è´Ÿè´£å›¾åƒç»˜åˆ¶ï¼Œæ˜¯åº”ç”¨ UI çš„åŸºç¡€ï¼Œå…¶åŠŸèƒ½æ˜¯åˆæˆæ‰€æœ‰ Surface å¹¶æ¸²æŸ“åˆ°æ˜¾ç¤ºè®¾å¤‡ã€‚SurfaceFlinger è¿›ç¨‹ä¸»è¦æ˜¯å¯åŠ¨ FrameBufferï¼Œåˆå§‹åŒ–æ˜¾ç¤ºç³»ç»Ÿã€‚</p><h2 id="media-server-è¿›ç¨‹"><a href="#media-server-è¿›ç¨‹" class="headerlink" title="media_server è¿›ç¨‹"></a>media_server è¿›ç¨‹</h2><p>MediaServer è¿›ç¨‹ä¸»è¦æ˜¯å¯åŠ¨ AudioFlinger éŸ³é¢‘æœåŠ¡ï¼ŒCameraService ç›¸æœºæœåŠ¡ã€‚è´Ÿè´£å¤„ç†éŸ³é¢‘è§£ææ’­æ”¾ï¼Œç›¸æœºç›¸å…³çš„å¤„ç†ã€‚</p><h2 id="Zygote-è¿›ç¨‹"><a href="#Zygote-è¿›ç¨‹" class="headerlink" title="Zygote è¿›ç¨‹"></a>Zygote è¿›ç¨‹</h2><p>Zygote è¿›ç¨‹å­µåŒ–äº†æ‰€æœ‰çš„ Android åº”ç”¨è¿›ç¨‹ï¼Œæ˜¯ Android Framework çš„åŸºç¡€ï¼Œè¯¥è¿›ç¨‹çš„å¯åŠ¨ä¹Ÿæ ‡å¿—ç€ Framework æ¡†æ¶åˆå§‹åŒ–å¯åŠ¨çš„å¼€å§‹ã€‚</p><p>Zygote æœåŠ¡è¿›ç¨‹çš„ä¸»è¦åŠŸèƒ½ï¼š</p><ul><li>æ³¨å†Œåº•å±‚åŠŸèƒ½çš„ JNI å‡½æ•°åˆ°è™šæ‹Ÿæœº</li><li>é¢„åŠ è½½ Java ç±»å’Œèµ„æº</li><li>fork å¹¶å¯åŠ¨ system_server æ ¸å¿ƒè¿›ç¨‹</li><li>ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹ç›‘å¬å¤„ç†â€œå­µåŒ–æ–°è¿›ç¨‹â€çš„è¯·æ±‚</li><li>å½“ Zygote è¿›ç¨‹å¯åŠ¨å, ä¾¿ä¼šæ‰§è¡Œåˆ° frameworks/base/cmds/app_process/App_main.cpp æ–‡ä»¶çš„<code>main()</code>æ–¹æ³•</li></ul><p>ç„¶å Zygote è¿›ç¨‹ä¼šè¿›å…¥ loop çŠ¶æ€ï¼Œç­‰å¾…ä¸‹æ¬¡ fork è¿›ç¨‹ã€‚</p><h2 id="system-server-è¿›ç¨‹"><a href="#system-server-è¿›ç¨‹" class="headerlink" title="system_server è¿›ç¨‹"></a>system_server è¿›ç¨‹</h2><p>system_server è¿›ç¨‹ ç”± Zygote è¿›ç¨‹ fork è€Œæ¥ã€‚æ¥ä¸‹æ¥çœ‹ä¸‹ system_server å¯åŠ¨è¿‡ç¨‹ã€‚</p><p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/services/java/com/android/server/SystemServer.java">æŸ¥çœ‹SystemServer.javaå…¨éƒ¨ä»£ç </a></p><pre><code class="java">//é¦–å…ˆä¼šè°ƒç”¨ ZygoteInit.startSystemServer() æ–¹æ³•ZygoteInit.startSystemServer()  //fork å­è¿›ç¨‹ system_serverï¼Œè¿›å…¥ system_server è¿›ç¨‹ã€‚ZygoteInit.handleSystemServerProcess()  //è®¾ç½®å½“å‰è¿›ç¨‹åä¸ºâ€œsystem_serverâ€ï¼Œåˆ›å»º PathClassLoader ç±»åŠ è½½å™¨ã€‚RuntimeInit.zygoteInit()    //é‡å®šå‘ log è¾“å‡ºï¼Œé€šç”¨çš„åˆå§‹åŒ–ï¼ˆè®¾ç½®é»˜è®¤å¼‚å¸¸æ•æ‰æ–¹æ³•ï¼Œæ—¶åŒºç­‰ï¼‰ï¼Œåˆå§‹åŒ– Zygote -&gt; nativeZygoteInit()ã€‚nativeZygoteInit()  //æ–¹æ³•ç»è¿‡å±‚å±‚è°ƒç”¨ï¼Œä¼šè¿›å…¥ app_main.cpp ä¸­çš„ onZygoteInit() æ–¹æ³•ã€‚app_main::onZygoteInit()// å¯åŠ¨æ–° Binder çº¿ç¨‹ã€‚applicationInit()   //æ–¹æ³•ç»è¿‡å±‚å±‚è°ƒç”¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ ZygoteInit.MethodAndArgsCaller(m, argv), ZygoteInit.main() ä¼šæ•æ‰è¯¥å¼‚å¸¸ã€‚ZygoteInit.main()   //å¼€å¯ DDMS åŠŸèƒ½ï¼Œpreload() åŠ è½½èµ„æºï¼Œé¢„åŠ è½½ OpenGLï¼Œè°ƒç”¨ SystemServer.main() æ–¹æ³•ã€‚SystemServer.main() //å…ˆåˆå§‹åŒ– SystemServer å¯¹è±¡ï¼Œå†è°ƒç”¨å¯¹è±¡çš„ run() æ–¹æ³•ã€‚SystemServer.run()  //å‡†å¤‡ä¸»çº¿ç¨‹ looperï¼ŒåŠ è½½ android_servers.so åº“ï¼Œè¯¥åº“åŒ…å«çš„æºç åœ¨ frameworks/base/services/ ç›®å½•ä¸‹ã€‚</code></pre><p>system_server è¿›ç¨‹å¯åŠ¨åå°†åˆå§‹åŒ–ç³»ç»Ÿä¸Šä¸‹æ–‡ï¼ˆè®¾ç½®ä¸»é¢˜ï¼‰ï¼Œåˆ›å»ºç³»ç»ŸæœåŠ¡ç®¡ç† SystemServiceManagerï¼Œç„¶åå¯åŠ¨å„ç§ç³»ç»ŸæœåŠ¡ï¼š</p><pre><code class="java">startBootstrapServices(); // å¯åŠ¨å¼•å¯¼æœåŠ¡//è¯¥æ–¹æ³•ä¸»è¦å¯åŠ¨æœåŠ¡ ActivityManagerServiceï¼ŒPowerManagerServiceï¼ŒLightsServiceï¼ŒDisplayManagerServiceï¼ŒPackageManagerServiceï¼ŒUserManagerServiceã€‚//è®¾ç½® ActivityManagerServiceï¼Œå¯åŠ¨ä¼ æ„Ÿå™¨æœåŠ¡ã€‚startCoreServices();      // å¯åŠ¨æ ¸å¿ƒæœåŠ¡//è¯¥æ–¹æ³•ä¸»è¦//å¯åŠ¨æœåŠ¡ BatteryService ç”¨äºç»Ÿè®¡ç”µæ± ç”µé‡ï¼Œéœ€è¦ LightServiceã€‚//å¯åŠ¨æœåŠ¡ UsageStatsServiceï¼Œç”¨äºç»Ÿè®¡åº”ç”¨ä½¿ç”¨æƒ…å†µã€‚//å¯åŠ¨æœåŠ¡ WebViewUpdateServiceã€‚startOtherServices();     // å¯åŠ¨å…¶ä»–æœåŠ¡//è¯¥æ–¹æ³•ä¸»è¦å¯åŠ¨æœåŠ¡ InputManagerServiceï¼ŒWindowManagerServiceã€‚//ç­‰å¾… ServiceManagerï¼ŒSurfaceFlingerå¯åŠ¨å®Œæˆï¼Œç„¶åæ˜¾ç¤ºå¯åŠ¨ç•Œé¢ã€‚//å¯åŠ¨æœåŠ¡ StatusBarManagerServiceï¼Œ//å‡†å¤‡å¥½ window, power, package, display æœåŠ¡ï¼š//    - WindowManagerService.systemReady()//    - PowerManagerService.systemReady()//    - PackageManagerService.systemReady()//    - DisplayManagerService.systemReady()</code></pre><p>æ‰€æœ‰çš„æœåŠ¡å¯åŠ¨å®Œæˆåä¼šæ³¨å†Œåˆ° ServiceManagerã€‚<br>ActivityManagerService æœåŠ¡å¯åŠ¨å®Œæˆåï¼Œä¼šè¿›å…¥<code>ActivityManagerService.systemReady()</code>ï¼Œç„¶åå¯åŠ¨ SystemUIï¼ŒWebViewFactoryï¼ŒWatchdogï¼Œæœ€åå¯åŠ¨æ¡Œé¢ Launcher Appã€‚</p><p>æœ€åä¼šè¿›å…¥å¾ªç¯<code>Looper.loop()</code>ã€‚</p><h2 id="ActivityManagerService-å¯åŠ¨"><a href="#ActivityManagerService-å¯åŠ¨" class="headerlink" title="ActivityManagerService å¯åŠ¨"></a>ActivityManagerService å¯åŠ¨</h2><p>å¯åŠ¨æ¡Œé¢ Launcher App éœ€è¦ç­‰å¾… ActivityManagerService å¯åŠ¨å®Œæˆã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ ActivityManagerService å¯åŠ¨è¿‡ç¨‹ã€‚</p><pre><code class="java">ActivityManagerService(Context) //åˆ›å»ºåä¸ºâ€œActivityManagerâ€çš„å‰å°çº¿ç¨‹ï¼Œå¹¶è·å–mHandlerã€‚//é€šè¿‡ UiThread ç±»ï¼Œåˆ›å»ºåä¸ºâ€œandroid.uiâ€çš„çº¿ç¨‹ã€‚//åˆ›å»ºå‰å°å¹¿æ’­å’Œåå°å¹¿æ’­æ¥æ”¶å™¨ã€‚//åˆ›å»ºç›®å½• /data/systemã€‚//åˆ›å»ºæœåŠ¡ BatteryStatsServiceã€‚ActivityManagerService.start()  //å¯åŠ¨ç”µæ± ç»Ÿè®¡æœåŠ¡ï¼Œåˆ›å»º LocalServiceï¼Œå¹¶æ·»åŠ åˆ° LocalServicesã€‚ActivityManagerService.startOtherServices() -&gt; installSystemProviders()//å®‰è£…æ‰€æœ‰çš„ç³»ç»Ÿ Providerã€‚ActivityManagerService.systemReady()//æ¢å¤æœ€è¿‘ä»»åŠ¡æ çš„ taskã€‚//å¯åŠ¨ WebViewï¼ŒSystemUIï¼Œå¼€å¯ Watchdogï¼Œå¯åŠ¨æ¡Œé¢ Launcher Appã€‚//å‘é€ç³»ç»Ÿå¹¿æ’­ã€‚</code></pre><p>å¯åŠ¨æ¡Œé¢ Launcher Appï¼Œé¦–å…ˆä¼šé€šè¿‡ Zygote è¿›ç¨‹ fork ä¸€ä¸ªæ–°è¿›ç¨‹ä½œä¸º App è¿›ç¨‹ï¼Œç„¶ååˆ›å»º Applicationï¼Œåˆ›å»ºå¯åŠ¨ Activityï¼Œæœ€åç”¨æˆ·æ‰ä¼šçœ‹åˆ°æ¡Œé¢ã€‚</p><h2 id="å®Œæ•´å¯åŠ¨è¿‡ç¨‹"><a href="#å®Œæ•´å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="å®Œæ•´å¯åŠ¨è¿‡ç¨‹"></a>å®Œæ•´å¯åŠ¨è¿‡ç¨‹</h2><p><img src="/img/70.png"></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºæ‡’åŠ è½½</title>
      <link href="/2023-01-31/lazy-load/"/>
      <url>/2023-01-31/lazy-load/</url>
      
        <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5adcb0e36fb9a07aa7673fbc"></a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Instrumentation</title>
      <link href="/2023-01-31/instrumentation/"/>
      <url>/2023-01-31/instrumentation/</url>
      
        <content type="html"><![CDATA[<p>Instrumentation çš„è‹±æ–‡æ„æ€æ˜¯ã€ä»ªè¡¨ã€ï¼Œä½†åœ¨ Android ä¸­çš„åŠŸèƒ½å¯ä¸æ˜¯ã€ä»ªè¡¨ã€ã€‚</p><span id="more"></span><p>å®ƒå…¶å®æ˜¯ Android ç³»ç»Ÿé‡Œçš„ä¸€å¥—æ§åˆ¶æ–¹æ³•ï¼Œæˆ–è€…å«ã€é’©å­ã€ã€‚è¿™äº›ã€é’©å­ã€å¯ä»¥åœ¨æ­£å¸¸çš„ç”Ÿå‘½å‘¨æœŸï¼ˆæ­£å¸¸æ˜¯ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶çš„)ä¹‹å¤–æ§åˆ¶Androidæ§ä»¶çš„è¿è¡Œï¼Œå…¶å®æŒ‡çš„å°±æ˜¯Instrumentationç±»æä¾›çš„å„ç§æµç¨‹æ§åˆ¶æ–¹æ³•ã€‚æˆ‘ä»¬çœ‹ä¸€ç‚¹æºç å°±çŸ¥é“äº†ï¼š</p><pre><code class="java">public class Instrumentation &#123;    private ActivityThread mThread = null;    private MessageQueue mMessageQueue = null;    private Context mInstrContext;    private Context mAppContext;    private ComponentName mComponent;    private Thread mRunner;    ...    public void callActivityOnCreate(Activity activity, Bundle icicle) &#123;        prePerformCreate(activity);        activity.performCreate(icicle);        postPerformCreate(activity);    &#125;    ...    public void callActivityOnResume(Activity activity) &#123;        activity.mResumed = true;        activity.onResume();                if (mActivityMonitors != null) &#123;            synchronized (mSync) &#123;                final int N = mActivityMonitors.size();                for (int i=0; i&lt;N; i++) &#123;                    final ActivityMonitor am = mActivityMonitors.get(i);                    am.match(activity, activity, activity.getIntent());                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><p>çœ‹èµ·æ¥åƒä¸åƒé™æ€ä»£ç†ï¼Ÿ</p><p><img src="http://img.doutula.com/production/uploads/image/2019/11/17/20191117993281_HImBdo.jpg"></p><p>å®ƒä¼šåœ¨ Activity çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ‰§è¡Œæ—¶åŠ ä¸€ä¸ªé’©å­ï¼Œç”¨æ¥åšä¸€äº›ç›‘å¬çš„å·¥ä½œã€‚</p><p>Activity çš„å®ä¾‹ä¹Ÿæ˜¯ç”± Instrumentation åˆ›å»ºçš„ï¼Œåœ¨ ActivityThread ä¸­ï¼š</p><pre><code class="java">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;    activity = mInstrumentation.newActivity(        cl, component.getClassName(), r.intent);&#125;</code></pre><p>Instumentation è¯´äº†ï¼Œæˆ‘åˆ›å»ºçš„ Activity å®ä¾‹ï¼Œæˆ‘è¦æ˜¯ä¸ç›‘å¬ç€ç‚¹ï¼Œé‚£è¿˜ä¸å®Œè›‹äº†ã€‚æ‰€ä»¥å®ƒä¸€èˆ¬ç”¨æ¥è¿›è¡Œæµ‹è¯•ï¼Œç”¨æ¥å®ç° Activity ç”Ÿå‘½å‘¨æœŸé’©å­ã€è·å– Activity ä¸­çš„ View ç­‰ç­‰ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº MotionLayout</title>
      <link href="/2023-01-31/motionlayout/"/>
      <url>/2023-01-31/motionlayout/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº ListView çš„æ¸²æŸ“ã€ç¼“å­˜åŠä¼˜åŒ–</title>
      <link href="/2023-01-31/listview-optimization/"/>
      <url>/2023-01-31/listview-optimization/</url>
      
        <content type="html"><![CDATA[<p>ListView ä¼˜åŒ–æ˜¯è€ç”Ÿå¸¸è°ˆçš„äº‹æƒ…ï¼Œè™½ç„¶ç°åœ¨æœ‰ RycyclerView å¯ä»¥å®Œç¾æ›¿ä»£ ListViewï¼Œä½†æ˜¯äº†è§£ ListView çš„æ¸²æŸ“ã€ç¼“å­˜åŠä¼˜åŒ–ï¼Œä¹Ÿå¹¶ä¸æ˜¯ä»€ä¹ˆåäº‹ã€‚</p><span id="more"></span><h2 id="ListView-ä¸å®ƒçš„æœ‹å‹ä»¬"><a href="#ListView-ä¸å®ƒçš„æœ‹å‹ä»¬" class="headerlink" title="ListView ä¸å®ƒçš„æœ‹å‹ä»¬"></a>ListView ä¸å®ƒçš„æœ‹å‹ä»¬</h2><p>ListView ç»§æ‰¿è‡ª AbsListViewï¼ŒAbsListView ç»§æ‰¿è‡ª AdapterViewï¼ŒAdapterView ç»§æ‰¿è‡ª ViewGroupï¼Œå®ƒä»¬ä¹Ÿæœ‰å„è‡ªçš„æ´¾ç”Ÿç±»ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/listview-1589441712.png"></p><p>AdapterView æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒä¸€ä¸ªå¯ä»¥ç”±å†…éƒ¨å…ƒç´ æ¥å†³å®šå¦‚ä½•å±•ç°çš„ ViewGroupã€‚å®ƒå†…éƒ¨åŒ…å«äº†å¯¹å†…éƒ¨ View çš„ç®¡ç†å’ŒåŸºæœ¬äº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚<code>addView()</code>ã€<code>removeView()</code>ã€<code>setOnItemClickListener()</code>ç­‰ç­‰ã€‚</p><p>AbsListView ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯è¢«ç”¨æ¥å±•ç¤ºå¤§é‡æ•°æ®çš„ä¸€ä¸ªåŸºç±»ï¼Œè€Œä¸”å®ƒå¹¶æ²¡æœ‰æŒ‡å®šå±•ç¤ºçš„æ ·å¼ï¼Œå®Œå…¨ç”±æ´¾ç”Ÿç±»æ¥å®ç°ï¼Œæ¯”å¦‚ç½‘æ ¼ã€åˆ—è¡¨ã€ç€‘å¸ƒæµç­‰ï¼Œå®Œå…¨ç”±å­ç±»æ¥å†³å®šå±•ç¤ºçš„æ ·å¼ã€‚å®ƒè´Ÿè´£å¤„ç†å†…éƒ¨ View çš„æ¸²æŸ“ã€ç¼“å­˜ã€å›æ”¶ç­‰ã€‚</p><h2 id="AbsListView"><a href="#AbsListView" class="headerlink" title="AbsListView"></a>AbsListView</h2><p>AbsListView ä¸­æœ‰ä¸€ä¸ªç±»ï¼Œå«åš RecycleBinï¼Œæ„ä¸ºå›æ”¶ç«™ã€‚æˆ‘ä»¬çœ‹çœ‹å®ƒçš„æ³¨é‡Šï¼š</p><blockquote><p>The RecycleBin facilitates reuse of views across layouts. The RecycleBin has two levels of storage: ActiveViews and ScrapViews. ActiveViews are those views which were onscreen at the start of a layout. By construction, they are displaying current information. At the end of layout, all views in ActiveViews are demoted to ScrapViews. ScrapViews are old views that could potentially be used by the adapter to avoid allocating views unnecessarily.</p></blockquote><p>æœºç¿»ä¸€ä¸‹ï¼šå›æ”¶ç«™æœºåˆ¶å¯ä»¥å®ç° View çš„é‡ç”¨ã€‚å›æ”¶ç«™æœ‰ä¸¤ä¸ªçº§åˆ«çš„å­˜å‚¨ï¼šæ´»åŠ¨çš„ View ï¼ˆActiveViewsï¼‰å’ŒåºŸå¼ƒçš„ Viewï¼ˆScrapViewsï¼‰ã€‚ActiveViews æ˜¯æŒ‡åœ¨ layout è¿‡ç¨‹çš„å¼€å§‹æ—¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ Viewã€‚åˆšå¼€å§‹æ„å»ºæ—¶ï¼Œå®ƒä»¬ä¼šæ˜¾ç¤ºå½“å‰çš„ä¿¡æ¯ï¼Œåœ¨ layout ç»“æŸæ—¶ï¼Œæ‰€æœ‰çš„ ActiveViews ä¼šè¢«é™çº§ä¸º ScrapViewsã€‚<strong>ScrapViews æ˜¯å°†æ¥æœ‰å¯èƒ½ä¼šè¢« adater é‡å¤åˆ©ç”¨çš„</strong>ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…è¢«ä¸å¿…è¦çš„ View é‡å»ºï¼Œå°†å®ƒä»¬ç¼“å­˜èµ·æ¥ã€‚</p><p>æˆ‘ä»¬æ¥ç®€å•çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">class RecycleBin &#123;    @UnsupportedAppUsage    private RecyclerListener mRecyclerListener;    private int mFirstActivePosition;    private View[] mActiveViews = new View[0];    // æœªæ’åºçš„ Viewï¼Œå¯ä»¥è¢« adapter å½“ä½œ converter view æ¥ä½¿ç”¨    // è¿™é‡Œæ˜¯ä¸€ä¸ªåŒ…å« ArrayList çš„æ•°ç»„ï¼Œä¸åŒçš„ ViewType ä¼šå­˜å‚¨åˆ°ä¸åŒçš„ ArrayList ä¸­    private ArrayList&lt;View&gt;[] mScrapViews;    private int mViewTypeCount;    private ArrayList&lt;View&gt; mCurrentScrap;    private ArrayList&lt;View&gt; mSkippedScrap;    private SparseArray&lt;View&gt; mTransientStateViews;    private LongSparseArray&lt;View&gt; mTransientStateViewsById;    public void markChildrenDirty() &#123;        if (mViewTypeCount == 1) &#123;            final ArrayList&lt;View&gt; scrap = mCurrentScrap;            final int scrapCount = scrap.size();            for (int i = 0; i &lt; scrapCount; i++) &#123;                scrap.get(i).forceLayout();            &#125;        &#125; else &#123;            final int typeCount = mViewTypeCount;            for (int i = 0; i &lt; typeCount; i++) &#123;                final ArrayList&lt;View&gt; scrap = mScrapViews[i];                final int scrapCount = scrap.size();                for (int j = 0; j &lt; scrapCount; j++) &#123;                    scrap.get(j).forceLayout();                &#125;            &#125;        &#125;        if (mTransientStateViews != null) &#123;            final int count = mTransientStateViews.size();            for (int i = 0; i &lt; count; i++) &#123;                mTransientStateViews.valueAt(i).forceLayout();            &#125;        &#125;        if (mTransientStateViewsById != null) &#123;            final int count = mTransientStateViewsById.size();            for (int i = 0; i &lt; count; i++) &#123;                mTransientStateViewsById.valueAt(i).forceLayout();            &#125;        &#125;    &#125;    ...    // æ¸…é™¤ ScrapViews    @UnsupportedAppUsage    void clear() &#123;        ...    &#125;    // å°† AbsListView ä¸­æ‰€æœ‰çš„ children å¡«å……åˆ° ActiveViews    // firstActivePosition æŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªå¯è§ view è¢«æ·»åŠ æ—¶åœ¨ mActiveView æ•°ç»„ä¸­çš„ position    void fillActiveViews(int childCount, int firstActivePosition) &#123;        // å¦‚æœå½“å‰æ•°ç»„è¿‡å°ï¼Œåˆ™è¦æ–°å»ºä¸€ä¸ªæ•°ç»„        if (mActiveViews.length &lt; childCount) &#123;            mActiveViews = new View[childCount];        &#125;        // è®°å½•å¤–éƒ¨ï¼ˆç”± AbsListView çš„æ´¾ç”Ÿç±»ï¼Œå¦‚ ListViewï¼‰ä¼ å…¥çš„ firstActivePosition        mFirstActivePosition = firstActivePosition;        // æˆ‘æ²¡å¼„æ˜ç™½è¿™é‡Œä¸ºä»€ä¹ˆè¦å†æ–°å»ºä¸€ä¸ªæ•°ç»„å˜é‡æŒ‡å‘ mActiveViews å†…å­˜        // æœ‰æ˜ç™½çš„åŒå­¦å¯ä»¥ç•™è¨€å‘Šè¯‰æˆ‘        final View[] activeViews = mActiveViews;        for (int i = 0; i &lt; childCount; i++) &#123;            View child = getChildAt(i);            AbsListView.LayoutParams lp = (AbsListView.LayoutParams) child.getLayoutParams();            // è«è¦å°† footer å’Œ header view æ·»åŠ åˆ° ScrapViews ä¸­            if (lp != null &amp;&amp; lp.viewType != ITEM_VIEW_TYPE_HEADER_OR_FOOTER) &#123;                activeViews[i] = child;                // è®°å½•ä½ç½®ï¼ŒsetupChild() æ–¹æ³•å°±ä¸ä¼šå°†å®ƒçš„çŠ¶æ€é‡ç½®äº†ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„ setupChild() æ–¹æ³•                lp.scrappedFromPosition = firstActivePosition + i;            &#125;        &#125;    &#125;    // è·å– ActiveViewï¼ŒæŸä¸ª ActiveView è¢«è·å–åï¼Œå°±ä¼šä» mActiveViews ä¸­è¢«ç§»é™¤    View getActiveView(int position) &#123;        int index = position - mFirstActivePosition;        final View[] activeViews = mActiveViews;        if (index &gt;=0 &amp;&amp; index &lt; activeViews.length) &#123;            final View match = activeViews[index];            activeViews[index] = null;            return match;        &#125;        return null;    &#125;    // è·å–æ­£åœ¨è½¬å˜çŠ¶æ€çš„ View    View getTransientStateView(int position) &#123;        if (mAdapter != null &amp;&amp; mAdapterHasStableIds &amp;&amp; mTransientStateViewsById != null) &#123;            long id = mAdapter.getItemId(position);            View result = mTransientStateViewsById.get(id);            mTransientStateViewsById.remove(id);            return result;        &#125;        if (mTransientStateViews != null) &#123;            final int index = mTransientStateViews.indexOfKey(position);            if (index &gt;= 0) &#123;                View result = mTransientStateViews.valueAt(index);                mTransientStateViews.removeAt(index);                return result;            &#125;        &#125;        return null;    &#125;    ...    // è·å– ScrapViewï¼Œè¿™äº› View ä»¬æ˜¯æœªæ’åºçš„    View getScrapView(int position) &#123;        // æ ¹æ®ä½ç½®è·å– ViewType        final int whichScrap = mAdapter.getItemViewType(position);        if (whichScrap &lt; 0) &#123;            return null;        &#125;        // å¦‚æœåªæœ‰ä¸€ç§ ViewTypeï¼Œé‚£å°±ç›´æ¥è·å–        if (mViewTypeCount == 1) &#123;            return retrieveFromScrap(mCurrentScrap, position);        // å¦‚æœæœ‰å¤šç§ ViewTypeï¼Œé‚£è¦ä»å¯¹åº”çš„ ScrapViews åˆ—è¡¨ä¸­è·å–        &#125; else if (whichScrap &lt; mScrapViews.length) &#123;            return retrieveFromScrap(mScrapViews[whichScrap], position);        &#125;        return null;    &#125;    // å¦‚æœåˆ—è¡¨ä¸­çš„æ•°æ®æ²¡æœ‰å˜åŒ–æˆ–è€… adapter æœ‰ç¨³å®šçš„ IDï¼Œå˜åŒ–çŠ¶æ€çš„ view å°†ä¼šä¿ç•™å®ƒä»¬çš„çŠ¶æ€ä»¥ä¾¿åé¢è·å–    void addScrapView(View scrap, int position) &#123;        final AbsListView.LayoutParams lp = (AbsListView.LayoutParams) scrap.getLayoutParams();        // æ— æ³•å›æ”¶ï¼Œè¿ä¸ª LayoutParams éƒ½æ²¡æœ‰        if (lp == null) &#123;            return;        &#125;        lp.scrappedFromPosition = position;        // ç§»é™¤ä½†ä¸è¦å°† header æˆ–è€… footer åºŸå¼ƒæ‰        final int viewType = lp.viewType;        if (!shouldRecycleViewType(viewType)) &#123;            // æ— æ³•å›æ”¶ã€‚å¦‚æœå®ƒä¸æ˜¯ header æˆ–è€… footer çš„è¯ï¼ˆå®ƒä»¬æœ‰ç‰¹æ®Šçš„å¤„ç†æ–¹å¼ï¼Œåº”è¯¥è¢«å¿½ç•¥ï¼‰ï¼Œ            // å°±ç»™å®ƒè·³è¿‡ï¼Œç­‰å›å¤´æŠŠå®ƒ detach æ‰ã€‚            if (viewType != ITEM_VIEW_TYPE_HEADER_OR_FOOTER) &#123;                // åŠ å…¥ detach åˆ—è¡¨                getSkippedScrap().add(scrap);            &#125;            return;        &#125;        // View ä¸­çš„æ–¹æ³•ï¼Œç”¨äºå°† View ä¸­çš„ callback ç­‰ç§»é™¤        scrap.dispatchStartTemporaryDetach();        notifyViewAccessibilityStateChangedIfNeeded(                AccessibilityEvent.CONTENT_CHANGE_TYPE_SUBTREE);        // ä¸è¦åºŸå¼ƒæ‰ç¬æ€çš„ View        final boolean scrapHasTransientState = scrap.hasTransientState();        if (scrapHasTransientState) &#123;            if (mAdapter != null &amp;&amp; mAdapterHasStableIds) &#123;                // If the adapter has stable IDs, we can reuse the view for                // the same data.                if (mTransientStateViewsById == null) &#123;                    mTransientStateViewsById = new LongSparseArray&lt;&gt;();                &#125;                mTransientStateViewsById.put(lp.itemId, scrap);            &#125; else if (!mDataChanged) &#123;                // If the data hasn&#39;t changed, we can reuse the views at                // their old positions.                if (mTransientStateViews == null) &#123;                    mTransientStateViews = new SparseArray&lt;&gt;();                &#125;                mTransientStateViews.put(position, scrap);            &#125; else &#123;                // Otherwise, we&#39;ll have to remove the view and start over.                clearScrapForRebind(scrap);                getSkippedScrap().add(scrap);            &#125;        &#125; else &#123;            clearScrapForRebind(scrap);            if (mViewTypeCount == 1) &#123;                mCurrentScrap.add(scrap);            &#125; else &#123;                mScrapViews[viewType].add(scrap);            &#125;            if (mRecyclerListener != null) &#123;                mRecyclerListener.onMovedToScrapHeap(scrap);            &#125;        &#125;    &#125;    private ArrayList&lt;View&gt; getSkippedScrap() &#123;        if (mSkippedScrap == null) &#123;            mSkippedScrap = new ArrayList&lt;&gt;();        &#125;        return mSkippedScrap;    &#125;    void removeSkippedScrap() &#123;        if (mSkippedScrap == null) &#123;            return;        &#125;        final int count = mSkippedScrap.size();        for (int i = 0; i &lt; count; i++) &#123;            removeDetachedView(mSkippedScrap.get(i), false);        &#125;        mSkippedScrap.clear();    &#125;    // å°† mActiveViews ä¸­å‰©ä½™çš„ View ç§»åˆ° mScrapViews ä¸­    void scrapActiveViews() &#123;        final View[] activeViews = mActiveViews;        final boolean hasListener = mRecyclerListener != null;        final boolean multipleScraps = mViewTypeCount &gt; 1;        ArrayList&lt;View&gt; scrapViews = mCurrentScrap;        final int count = activeViews.length;        for (int i = count - 1; i &gt;= 0; i--) &#123;            final View victim = activeViews[i];            if (victim != null) &#123;                final AbsListView.LayoutParams lp                        = (AbsListView.LayoutParams) victim.getLayoutParams();                final int whichScrap = lp.viewType;                activeViews[i] = null;                if (victim.hasTransientState()) &#123;                    // Store views with transient state for later use.                    victim.dispatchStartTemporaryDetach();                    if (mAdapter != null &amp;&amp; mAdapterHasStableIds) &#123;                        if (mTransientStateViewsById == null) &#123;                            mTransientStateViewsById = new LongSparseArray&lt;View&gt;();                        &#125;                        long id = mAdapter.getItemId(mFirstActivePosition + i);                        mTransientStateViewsById.put(id, victim);                    &#125; else if (!mDataChanged) &#123;                        if (mTransientStateViews == null) &#123;                            mTransientStateViews = new SparseArray&lt;View&gt;();                        &#125;                        mTransientStateViews.put(mFirstActivePosition + i, victim);                    &#125; else if (whichScrap != ITEM_VIEW_TYPE_HEADER_OR_FOOTER) &#123;                        // The data has changed, we can&#39;t keep this view.                        removeDetachedView(victim, false);                    &#125;                &#125; else if (!shouldRecycleViewType(whichScrap)) &#123;                    // Discard non-recyclable views except headers/footers.                    if (whichScrap != ITEM_VIEW_TYPE_HEADER_OR_FOOTER) &#123;                        removeDetachedView(victim, false);                    &#125;                &#125; else &#123;                    // Store everything else on the appropriate scrap heap.                    if (multipleScraps) &#123;                        scrapViews = mScrapViews[whichScrap];                    &#125;                    lp.scrappedFromPosition = mFirstActivePosition + i;                    removeDetachedView(victim, false);                    scrapViews.add(victim);                    if (hasListener) &#123;                        mRecyclerListener.onMovedToScrapHeap(victim);                    &#125;                &#125;            &#125;        &#125;        pruneScrapViews();    &#125;    // layout è¿‡ç¨‹çš„æœ€åï¼Œæ‰€æœ‰æš‚æ—¶è¢« detach æ‰çš„ View è¦ä¹ˆåº”è¯¥è¢«é‡æ–° attachï¼Œæˆ–è€…å®Œå…¨è¢« detachã€‚è¿™ä¸ªæ–¹æ³•èƒ½ä¿è¯åœ¨    // scrap åˆ—è¡¨ä¸­çš„æ‰€æœ‰ View éƒ½è¢« detach æ‰    void fullyDetachScrapViews() &#123;        final int viewTypeCount = mViewTypeCount;        final ArrayList&lt;View&gt;[] scrapViews = mScrapViews;        for (int i = 0; i &lt; viewTypeCount; ++i) &#123;            final ArrayList&lt;View&gt; scrapPile = scrapViews[i];            for (int j = scrapPile.size() - 1; j &gt;= 0; j--) &#123;                final View view = scrapPile.get(j);                if (view.isTemporarilyDetached()) &#123;                    removeDetachedView(view, false);                &#125;            &#125;        &#125;    &#125;    // ç¡®ä¿ scrap åˆ—è¡¨çš„å¤§å°ä¸è¦è¶…è¿‡ active åˆ—è¡¨çš„å¤§å°ï¼Œå› ä¸ºæœ‰æ—¶ adapter å¯èƒ½ä¼šä¸å›æ”¶ viewã€‚    // åŒæ—¶ç§»é™¤æ‰€æœ‰ç¼“å­˜çš„å·²ç»ä¸å†æ‹¥æœ‰ç¬æ€çš„ç¬æ€ view    private void pruneScrapViews() &#123;        final int maxViews = mActiveViews.length;        final int viewTypeCount = mViewTypeCount;        final ArrayList&lt;View&gt;[] scrapViews = mScrapViews;        for (int i = 0; i &lt; viewTypeCount; ++i) &#123;            final ArrayList&lt;View&gt; scrapPile = scrapViews[i];            int size = scrapPile.size();            while (size &gt; maxViews) &#123;                scrapPile.remove(--size);            &#125;        &#125;        final SparseArray&lt;View&gt; transViewsByPos = mTransientStateViews;        if (transViewsByPos != null) &#123;            for (int i = 0; i &lt; transViewsByPos.size(); i++) &#123;                final View v = transViewsByPos.valueAt(i);                if (!v.hasTransientState()) &#123;                    removeDetachedView(v, false);                    transViewsByPos.removeAt(i);                    i--;                &#125;            &#125;        &#125;        final LongSparseArray&lt;View&gt; transViewsById = mTransientStateViewsById;        if (transViewsById != null) &#123;            for (int i = 0; i &lt; transViewsById.size(); i++) &#123;                final View v = transViewsById.valueAt(i);                if (!v.hasTransientState()) &#123;                    removeDetachedView(v, false);                    transViewsById.removeAt(i);                    i--;                &#125;            &#125;        &#125;    &#125;    void reclaimScrapViews(List&lt;View&gt; views) &#123;        if (mViewTypeCount == 1) &#123;            views.addAll(mCurrentScrap);        &#125; else &#123;            final int viewTypeCount = mViewTypeCount;            final ArrayList&lt;View&gt;[] scrapViews = mScrapViews;            for (int i = 0; i &lt; viewTypeCount; ++i) &#123;                final ArrayList&lt;View&gt; scrapPile = scrapViews[i];                views.addAll(scrapPile);            &#125;        &#125;    &#125;    /**        * Updates the cache color hint of all known views.        *        * @param color The new cache color hint.        */    void setCacheColorHint(int color) &#123;        if (mViewTypeCount == 1) &#123;            final ArrayList&lt;View&gt; scrap = mCurrentScrap;            final int scrapCount = scrap.size();            for (int i = 0; i &lt; scrapCount; i++) &#123;                scrap.get(i).setDrawingCacheBackgroundColor(color);            &#125;        &#125; else &#123;            final int typeCount = mViewTypeCount;            for (int i = 0; i &lt; typeCount; i++) &#123;                final ArrayList&lt;View&gt; scrap = mScrapViews[i];                final int scrapCount = scrap.size();                for (int j = 0; j &lt; scrapCount; j++) &#123;                    scrap.get(j).setDrawingCacheBackgroundColor(color);                &#125;            &#125;        &#125;        // Just in case this is called during a layout pass        final View[] activeViews = mActiveViews;        final int count = activeViews.length;        for (int i = 0; i &lt; count; ++i) &#123;            final View victim = activeViews[i];            if (victim != null) &#123;                victim.setDrawingCacheBackgroundColor(color);            &#125;        &#125;    &#125;    private View retrieveFromScrap(ArrayList&lt;View&gt; scrapViews, int position) &#123;        final int size = scrapViews.size();        if (size &gt; 0) &#123;            // See if we still have a view for this position or ID.            // Traverse backwards to find the most recently used scrap view            for (int i = size - 1; i &gt;= 0; i--) &#123;                final View view = scrapViews.get(i);                final AbsListView.LayoutParams params =                        (AbsListView.LayoutParams) view.getLayoutParams();                if (mAdapterHasStableIds) &#123;                    final long id = mAdapter.getItemId(position);                    if (id == params.itemId) &#123;                        return scrapViews.remove(i);                    &#125;                &#125; else if (params.scrappedFromPosition == position) &#123;                    final View scrap = scrapViews.remove(i);                    clearScrapForRebind(scrap);                    return scrap;                &#125;            &#125;            final View scrap = scrapViews.remove(size - 1);            clearScrapForRebind(scrap);            return scrap;        &#125; else &#123;            return null;        &#125;    &#125;    private void clearScrap(final ArrayList&lt;View&gt; scrap) &#123;        final int scrapCount = scrap.size();        for (int j = 0; j &lt; scrapCount; j++) &#123;            removeDetachedView(scrap.remove(scrapCount - 1 - j), false);        &#125;    &#125;    private void clearScrapForRebind(View view) &#123;        view.clearAccessibilityFocus();        view.setAccessibilityDelegate(null);    &#125;    private void removeDetachedView(View child, boolean animate) &#123;        child.setAccessibilityDelegate(null);        AbsListView.this.removeDetachedView(child, animate);    &#125;&#125; </code></pre><p>è¿™ä¸ªç±»ä¸­æ¯”è¾ƒé‡è¦çš„æ–¹æ³•å°±æ˜¯å¯¹äº View å½“å‰çŠ¶æ€çš„ç®¡ç†æ–¹æ³•ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªï¼š</p><ul><li><code>fillActiveViews(int childCount, int firstActivePosition)</code>ï¼šè¿™ä¸ªæ–¹æ³•ä¼šå°† AbsListView ä¸­æ‰€æœ‰çš„å­ View æ·»åŠ åˆ° mActiveViews æ•°ç»„ä¸­ã€‚<code>childCount</code>æŒ‡å­ View çš„ä¸ªæ•°ï¼Œ<code>firstActivePosition</code>æŒ‡ç¬¬ä¸€ä¸ªå¯è§å…ƒç´ çš„ positionã€‚</li><li><code>getActiveView(int position)</code>ï¼šä»<code>mActiveViews</code>ä¸­è·å– Viewã€‚å½“ View è¢«è·å–åï¼Œå°±ä¼šä»<code>mActiveViews</code>ä¸­ç§»é™¤ï¼Œå†æ¬¡è®¿é—®å°±ä¼šè¿”å›<code>null</code>ï¼Œè¿™æ„å‘³ç€ ActiveView æ— æ³•å¤ç”¨ã€‚</li><li><code>addScrapView(View view, int position)</code>ï¼šå°† ScrapView ç¼“å­˜åˆ°<code>mScrapViews</code>ä¸­ã€‚mScrapViews æ˜¯ä¸€ä¸ª ArrayList æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ä¸­æŒ‰ ViewType åˆ†ç±»å¹¶å­˜å‚¨ï¼Œå¦‚æœæœ‰3ç§ ViewTypeï¼Œæ•°ç»„ä¸­å°±ä¼šæœ‰3ä¸ª ArrayListã€‚è¿™äº›ç¼“å­˜éƒ½æ˜¯æ— åºçš„ã€‚</li><li><code>getScrapView(int position)</code>ï¼šä»ç¼“å­˜ä¸­å–å‡ºä¸€ä¸ª Viewã€‚</li></ul><p>AbsListView ä¹Ÿä¼šæœ‰è‡ªå·±çš„ measureã€layoutã€draw è¿‡ç¨‹ï¼Œä½†æ˜¯ draw è¿‡ç¨‹åœ¨ AbsListView ä¸­æ²¡æœ‰å®ç°ï¼Œåœ¨ ListView ä¸­ä¹Ÿæ²¡æœ‰å®ç°ï¼Œä¹Ÿå³å®ƒçš„ç»˜åˆ¶å…¨éƒ¨äº¤ç»™å­ View æ¥åšï¼Œæˆ‘ä»¬åªçœ‹å®ƒçš„<code>onMeasure()</code>å’Œ<code>onLayout</code>ã€‚</p><h3 id="AbsListView-çš„onMesaure"><a href="#AbsListView-çš„onMesaure" class="headerlink" title="AbsListView çš„onMesaure()"></a>AbsListView çš„<code>onMesaure()</code></h3><p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">@Overrideprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;    // mSelector æ˜¯ä¸€ä¸ª Drawableï¼Œç”¨æ¥ç»˜åˆ¶ selector    if (mSelector == null) &#123;        useDefaultSelector();    &#125;    final Rect listPadding = mListPadding;    listPadding.left = mSelectionLeftPadding + mPaddingLeft;    listPadding.top = mSelectionTopPadding + mPaddingTop;    listPadding.right = mSelectionRightPadding + mPaddingRight;    listPadding.bottom = mSelectionBottomPadding + mPaddingBottom;    // Check if our previous measured size was at a point where we should scroll later.    if (mTranscriptMode == TRANSCRIPT_MODE_NORMAL) &#123;        final int childCount = getChildCount();        final int listBottom = getHeight() - getPaddingBottom();        final View lastChild = getChildAt(childCount - 1);        final int lastBottom = lastChild != null ? lastChild.getBottom() : listBottom;        mForceTranscriptScroll = mFirstPosition + childCount &gt;= mLastHandledItemCount &amp;&amp;                lastBottom &lt;= listBottom;    &#125;&#125;</code></pre><p>å¯è§ measure è¿‡ç¨‹æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œåªæ˜¯ç¡®å®šäº†ä¸€äº› padding å€¼ã€‚</p><h3 id="AbsListView-çš„onLayout"><a href="#AbsListView-çš„onLayout" class="headerlink" title="AbsListView çš„onLayout()"></a>AbsListView çš„<code>onLayout()</code></h3><p>è¿™ä¸ªæ˜¯ AbsListView çš„é‡å¤´æˆã€‚ä¸‹é¢æˆ‘ä»¬å³å°†ä¼šè®²åˆ°çš„ <strong>ListView ä¸­æ˜¯æ²¡æœ‰<code>onLayout</code>æ–¹æ³•çš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„ layout è¿‡ç¨‹ï¼Œå®Œå…¨ç”±çˆ¶ç±» AbsListView æ¥å®ç°ã€‚</p><pre><code class="java">/**    * Subclasses should NOT override this method but    *  &#123;@link #layoutChildren()&#125; instead.    */@Overrideprotected void onLayout(boolean changed, int l, int t, int r, int b) &#123;    super.onLayout(changed, l, t, r, b);    mInLayout = true;    final int childCount = getChildCount();    // å¦‚æœ AbsListView çš„å¤§å°æˆ– position å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è¦å¼ºåˆ¶æ‰€æœ‰çš„å­ View é‡æ–° layout    if (changed) &#123;        for (int i = 0; i &lt; childCount; i++) &#123;            getChildAt(i).forceLayout();        &#125;        // å›æ”¶ç«™å°† ScrapViews ä¹Ÿå…¨éƒ¨æ‰§è¡Œ forceLayout        mRecycler.markChildrenDirty();    &#125;    // è®©æ‰€æœ‰å­ View è¿›è¡Œ layout è¿‡ç¨‹    layoutChildren();    mOverscrollMax = (b - t) / OVERSCROLL_LIMIT_DIVISOR;    // TODO: Move somewhere sane. This doesn&#39;t belong in onLayout().    if (mFastScroll != null) &#123;        mFastScroll.onItemCountChanged(getChildCount(), mItemCount);    &#125;    mInLayout = false;&#125;</code></pre><p>æ³¨é‡Šä¸­æˆ‘ä»¬çœ‹åˆ°ï¼š<strong>å­ç±»ä¸è¦è¦†å†™è¿™ä¸ªæ–¹æ³•ï¼Œåº”è¯¥è¦†å†™<code>layoutChildren()</code>æ–¹æ³•</strong>ã€‚å¾…ä¼šæˆ‘ä»¬ä¼šè¯¦è§£ ListView å¯¹è¿™ä¸ªæ–¹æ³•çš„è¦†å†™ã€‚</p><h2 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h2><p>ListView ç»§æ‰¿äº† AbsListViewï¼Œå¹¶å®ç°äº†è‡ªå·±çš„ measureã€layout è¿‡ç¨‹</p><h3 id="ListView-çš„onMesaure"><a href="#ListView-çš„onMesaure" class="headerlink" title="ListView çš„onMesaure()"></a>ListView çš„<code>onMesaure()</code></h3><pre><code class="java">@Overrideprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;    // Sets up mListPadding    super.onMeasure(widthMeasureSpec, heightMeasureSpec);    final int widthMode = MeasureSpec.getMode(widthMeasureSpec);    final int heightMode = MeasureSpec.getMode(heightMeasureSpec);    int widthSize = MeasureSpec.getSize(widthMeasureSpec);    int heightSize = MeasureSpec.getSize(heightMeasureSpec);    int childWidth = 0;    int childHeight = 0;    int childState = 0;    mItemCount = mAdapter == null ? 0 : mAdapter.getCount();    if (mItemCount &gt; 0 &amp;&amp; (widthMode == MeasureSpec.UNSPECIFIED            || heightMode == MeasureSpec.UNSPECIFIED)) &#123;        final View child = obtainView(0, mIsScrap);        // Lay out child directly against the parent measure spec so that        // we can obtain exected minimum width and height.        measureScrapChild(child, 0, widthMeasureSpec, heightSize);        childWidth = child.getMeasuredWidth();        childHeight = child.getMeasuredHeight();        childState = combineMeasuredStates(childState, child.getMeasuredState());        if (recycleOnMeasure() &amp;&amp; mRecycler.shouldRecycleViewType(                ((LayoutParams) child.getLayoutParams()).viewType)) &#123;            mRecycler.addScrapView(child, 0);        &#125;    &#125;    if (widthMode == MeasureSpec.UNSPECIFIED) &#123;        widthSize = mListPadding.left + mListPadding.right + childWidth +                getVerticalScrollbarWidth();    &#125; else &#123;        widthSize |= (childState &amp; MEASURED_STATE_MASK);    &#125;    if (heightMode == MeasureSpec.UNSPECIFIED) &#123;        heightSize = mListPadding.top + mListPadding.bottom + childHeight +                getVerticalFadingEdgeLength() * 2;    &#125;    if (heightMode == MeasureSpec.AT_MOST) &#123;        // TODO: after first layout we should maybe start at the first visible position, not 0        heightSize = measureHeightOfChildren(widthMeasureSpec, 0, NO_POSITION, heightSize, -1);    &#125;    // è°ƒç”¨ View çš„ setMeasuredDimension æ¥ä¿å­˜æµ‹é‡ç»“æœ    setMeasuredDimension(widthSize, heightSize);    mWidthMeasureSpec = widthMeasureSpec;&#125;</code></pre><p>ç”±ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œmeasure è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯åˆ¤æ–­äº†ä¸€ä¸‹ç›®å‰è‡ªèº«è®¾ç½®çš„ MeasureSpecï¼Œæ¥å†³å®šè‡ªèº«çš„å¤§å°ã€‚</p><h3 id="ListView-çš„layoutChildren"><a href="#ListView-çš„layoutChildren" class="headerlink" title="ListView çš„layoutChildren()"></a>ListView çš„<code>layoutChildren()</code></h3><p>ä¸Šé¢è¯´è¿‡äº†ï¼ŒListView ä¸èƒ½è¦†å†™<code>onLayout()</code>æ–¹æ³•ï¼Œè€Œæ˜¯è¦†å†™<code>layoutChildren()</code>æ–¹æ³•æ¥å¯¹è‡ªèº«è¿›è¡Œ layout è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">@Overrideprotected void layoutChildren() &#123;    // mBlockLayoutRequests æ˜¯ AdapterView ä¸­çš„æˆå‘˜å˜é‡ï¼Œç”¨æ¥æ ‡è¯†å½“å‰æ˜¯å¦æ­£åœ¨ layout è¿‡ç¨‹ä¸­    final boolean blockLayoutRequests = mBlockLayoutRequests;    if (blockLayoutRequests) &#123;        return;    &#125;    mBlockLayoutRequests = true;    try &#123;        // å…ˆè°ƒç”¨ AbsListView çš„ layoutChildren() æ–¹æ³•ï¼ˆè™½ç„¶æ˜¯æœªå®ç°ï¼‰        super.layoutChildren();        // åˆ·æ–°ï¼Œåœ¨ layout å®Œæˆä¹‹åè°ƒç”¨ draw è¿‡ç¨‹        invalidate();        if (mAdapter == null) &#123;            resetList();            invokeOnItemScrollListener();            return;        &#125;        final int childrenTop = mListPadding.top;        final int childrenBottom = mBottom - mTop - mListPadding.bottom;        final int childCount = getChildCount();        int index = 0;        int delta = 0;        View sel;        View oldSel = null;        View oldFirst = null;        View newSel = null;        // è®°å½•å¤„äº select mode çš„ item        switch (mLayoutMode) &#123;            case LAYOUT_SET_SELECTION:                index = mNextSelectedPosition - mFirstPosition;                if (index &gt;= 0 &amp;&amp; index &lt; childCount) &#123;                    newSel = getChildAt(index);                &#125;                break;            case LAYOUT_FORCE_TOP:            case LAYOUT_FORCE_BOTTOM:            case LAYOUT_SPECIFIC:            case LAYOUT_SYNC:                break;            case LAYOUT_MOVE_SELECTION:            default:                // Remember the previously selected view                index = mSelectedPosition - mFirstPosition;                if (index &gt;= 0 &amp;&amp; index &lt; childCount) &#123;                    oldSel = getChildAt(index);                &#125;                // Remember the previous first child                oldFirst = getChildAt(0);                if (mNextSelectedPosition &gt;= 0) &#123;                    delta = mNextSelectedPosition - mSelectedPosition;                &#125;                // Caution: newSel might be null                newSel = getChildAt(index + delta);        &#125;        // å¦‚æœåœ¨ layout è¿‡ç¨‹ä¸­ adapter ä¸­çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–        boolean dataChanged = mDataChanged;        if (dataChanged) &#123;            // AbsListView ä¸­çš„æ–¹æ³•ï¼Œç”¨æ¥ç¡®å®šæ˜¯å“ªæ¡æ•°æ®å‘ç”Ÿäº†æ”¹å˜            handleDataChanged();        &#125;        // å¦‚æœæ˜¯ç©ºæ•°æ®ï¼Œå°±æ¸…é™¤æ‰€æœ‰å¯è§çš„ viewï¼Œå°†å„ç§æ•°æ®å…¨éƒ¨é‡ç½®ï¼Œç„¶åè¿”å›        if (mItemCount == 0) &#123;            resetList();            invokeOnItemScrollListener();            return;        &#125; else if (mItemCount != mAdapter.getCount()) &#123;            throw new IllegalStateException(&quot;The content of the adapter has changed but &quot;                    + &quot;ListView did not receive a notification. Make sure the content of &quot;                    + &quot;your adapter is not modified from a background thread, but only from &quot;                    + &quot;the UI thread. Make sure your adapter calls notifyDataSetChanged() &quot;                    + &quot;when its content changes. [in ListView(&quot; + getId() + &quot;, &quot; + getClass()                    + &quot;) with Adapter(&quot; + mAdapter.getClass() + &quot;)]&quot;);        &#125;        setSelectedPositionInt(mNextSelectedPosition);        // å¤„ç†ä¸€äº› accessibility ç›¸å…³çš„        AccessibilityNodeInfo accessibilityFocusLayoutRestoreNode = null;        View accessibilityFocusLayoutRestoreView = null;        int accessibilityFocusPosition = INVALID_POSITION;        // Remember which child, if any, had accessibility focus. This must        // occur before recycling any views, since that will clear        // accessibility focus.        final ViewRootImpl viewRootImpl = getViewRootImpl();        if (viewRootImpl != null) &#123;            final View focusHost = viewRootImpl.getAccessibilityFocusedHost();            if (focusHost != null) &#123;                final View focusChild = getAccessibilityFocusedChild(focusHost);                if (focusChild != null) &#123;                    if (!dataChanged || isDirectChildHeaderOrFooter(focusChild)                            || (focusChild.hasTransientState() &amp;&amp; mAdapterHasStableIds)) &#123;                        // The views won&#39;t be changing, so try to maintain                        // focus on the current host and virtual view.                        accessibilityFocusLayoutRestoreView = focusHost;                        accessibilityFocusLayoutRestoreNode = viewRootImpl                                .getAccessibilityFocusedVirtualView();                    &#125;                    // If all else fails, maintain focus at the same                    // position.                    accessibilityFocusPosition = getPositionForView(focusChild);                &#125;            &#125;        &#125;        // å¤„ç†ç„¦ç‚¹ç›¸å…³        View focusLayoutRestoreDirectChild = null;        View focusLayoutRestoreView = null;        // Take focus back to us temporarily to avoid the eventual call to        // clear focus when removing the focused child below from messing        // things up when ViewAncestor assigns focus back to someone else.        final View focusedChild = getFocusedChild();        if (focusedChild != null) &#123;            // TODO: in some cases focusedChild.getParent() == null            // We can remember the focused view to restore after re-layout            // if the data hasn&#39;t changed, or if the focused position is a            // header or footer.            if (!dataChanged || isDirectChildHeaderOrFooter(focusedChild)                    || focusedChild.hasTransientState() || mAdapterHasStableIds) &#123;                focusLayoutRestoreDirectChild = focusedChild;                // Remember the specific view that had focus.                focusLayoutRestoreView = findFocus();                if (focusLayoutRestoreView != null) &#123;                    // Tell it we are going to mess with it.                    focusLayoutRestoreView.dispatchStartTemporaryDetach();                &#125;            &#125;            requestFocus();        &#125;        // å°†æ‰€æœ‰ View æ‰”åˆ°å›æ”¶ç«™ï¼Œè¿™äº› View æœ‰å¯èƒ½ä¼šè¢«é‡ç”¨        final int firstPosition = mFirstPosition;        final RecycleBin recycleBin = mRecycler;        if (dataChanged) &#123;            for (int i = 0; i &lt; childCount; i++) &#123;                recycleBin.addScrapView(getChildAt(i), firstPosition+i);            &#125;        &#125; else &#123;            recycleBin.fillActiveViews(childCount, firstPosition);        &#125;        // å°†æ‰€æœ‰çš„å­ View çš„ parent ç½®ä¸º nullï¼Œå¹¶å°† View ç½®ä¸º null        detachAllViewsFromParent();        recycleBin.removeSkippedScrap();        switch (mLayoutMode) &#123;            case LAYOUT_SET_SELECTION:                if (newSel != null) &#123;                    sel = fillFromSelection(newSel.getTop(), childrenTop, childrenBottom);                &#125; else &#123;                    sel = fillFromMiddle(childrenTop, childrenBottom);                &#125;                break;            case LAYOUT_SYNC:                sel = fillSpecific(mSyncPosition, mSpecificTop);                break;            case LAYOUT_FORCE_BOTTOM:                sel = fillUp(mItemCount - 1, childrenBottom);                adjustViewsUpOrDown();                break;            case LAYOUT_FORCE_TOP:                mFirstPosition = 0;                sel = fillFromTop(childrenTop);                adjustViewsUpOrDown();                break;            case LAYOUT_SPECIFIC:                final int selectedPosition = reconcileSelectedPosition();                sel = fillSpecific(selectedPosition, mSpecificTop);                /**                    * When ListView is resized, FocusSelector requests an async selection for the                    * previously focused item to make sure it is still visible. If the item is not                    * selectable, it won&#39;t regain focus so instead we call FocusSelector                    * to directly request focus on the view after it is visible.                    */                if (sel == null &amp;&amp; mFocusSelector != null) &#123;                    final Runnable focusRunnable = mFocusSelector                            .setupFocusIfValid(selectedPosition);                    if (focusRunnable != null) &#123;                        post(focusRunnable);                    &#125;                &#125;                break;            case LAYOUT_MOVE_SELECTION:                sel = moveSelection(oldSel, newSel, delta, childrenTop, childrenBottom);                break;            // åœ¨ ListView çš„ç¬¬ä¸€æ¬¡ layout è¿‡ç¨‹ä¸­ï¼ŒchildCount = 0            default:                if (childCount == 0) &#123;                    // mStackFromBottom ä¸º true æ—¶ï¼Œè¡¨ç¤ºæ•´ä¸ª ListView æ˜¯å€’ç€å¡«å……çš„                    if (!mStackFromBottom) &#123;                        final int position = lookForSelectablePosition(0, true);                        setSelectedPositionInt(position);                        // ä¸»è¦çš„å¡«å……æ–¹æ³•                        sel = fillFromTop(childrenTop);                    &#125; else &#123;                        final int position = lookForSelectablePosition(mItemCount - 1, false);                        setSelectedPositionInt(position);                        sel = fillUp(mItemCount - 1, childrenBottom);                    &#125;                &#125; else &#123;                    // å¦‚æœå·²ç»æœ‰ View äº†ï¼Œé‚£å°±åªå¡«å……ç‰¹å®šä½ç½®çš„ View                    if (mSelectedPosition &gt;= 0 &amp;&amp; mSelectedPosition &lt; mItemCount) &#123;                        sel = fillSpecific(mSelectedPosition,                                oldSel == null ? childrenTop : oldSel.getTop());                    &#125; else if (mFirstPosition &lt; mItemCount) &#123;                        sel = fillSpecific(mFirstPosition,                                oldFirst == null ? childrenTop : oldFirst.getTop());                    &#125; else &#123;                        sel = fillSpecific(0, childrenTop);                    &#125;                &#125;                break;        &#125;        ...    &#125; finally &#123;        ...        // å…è®¸è¿›è¡Œä¸‹ä¸€æ¬¡ layout        if (!blockLayoutRequests) &#123;            mBlockLayoutRequests = false;        &#125;    &#125;&#125;</code></pre><p>å¯è§ï¼Œåœ¨ layout è¿‡ç¨‹ä¸­ï¼Œä¼šå¤„ç†ä¸€äº› Accessibility å’Œç„¦ç‚¹æ–¹é¢çš„äº‹æƒ…ï¼Œæœ€åå¼€å§‹åˆ¤æ–­ ListView çš„ç±»å‹å’Œå­ View æ•°é‡ã€‚åœ¨åˆæ¬¡ layout æ—¶ï¼ŒListView ä¸­å¿…ç„¶ä¸ä¼šæ·»åŠ è¿›å­ Viewï¼Œæ‰€ä»¥æ­¤æ—¶ childCount ä¸º 0ï¼Œåœ¨å¡«å……æ—¶ä¼šè°ƒç”¨<code>fillFromTop()</code>æ–¹æ³•ï¼š</p><pre><code class="java">private View fillFromTop(int nextTop) &#123;    mFirstPosition = Math.min(mFirstPosition, mSelectedPosition);    mFirstPosition = Math.min(mFirstPosition, mItemCount - 1);    if (mFirstPosition &lt; 0) &#123;        mFirstPosition = 0;    &#125;    return fillDown(mFirstPosition, nextTop);&#125;private View fillDown(int pos, int nextTop) &#123;    View selectedView = null;    int end = (mBottom - mTop);    if ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) &#123;        end -= mListPadding.bottom;    &#125;    while (nextTop &lt; end &amp;&amp; pos &lt; mItemCount) &#123;        // is this the selected item?        boolean selected = pos == mSelectedPosition;        View child = makeAndAddView(pos, nextTop, true, mListPadding.left, selected);        nextTop = child.getBottom() + mDividerHeight;        if (selected) &#123;            selectedView = child;        &#125;        pos++;    &#125;    setVisibleRangeHint(mFirstPosition, mFirstPosition + getChildCount() - 1);    return selectedView;&#125;</code></pre><p>å¯è§åœ¨<code>fillDown()</code>æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†å¾ªç¯çš„æ–¹å¼å°†å­ View éƒ½åˆ›å»ºå‡ºæ¥ï¼Œå…·ä½“çš„æ“ä½œè¿˜æ˜¯äº¤ç»™äº†<code>makeAndAddView()</code>æ–¹æ³•ï¼š</p><pre><code class="java">private View makeAndAddView(int position, int y, boolean flow, int childrenLeft,        boolean selected) &#123;    if (!mDataChanged) &#123;        // è¿™é‡Œå°è¯•ä»å›æ”¶ç«™ä¸­æ‹¿å‡ºå·²ç»æ¸²æŸ“è¿‡çš„ Viewï¼Œåˆæ¬¡è·å–æ—¶ï¼Œå¿…ä¸º null        final View activeView = mRecycler.getActiveView(position);        if (activeView != null) &#123;            // å¦‚æœåœ¨å›æ”¶ç«™ä¸­æ‰¾åˆ°äº†å¯¹åº”çš„ Viewï¼Œå°±ç›´æ¥ç»™å®ƒæ”¾åˆ°å¯¹åº”çš„ä½ç½®ä¸Š            setupChild(activeView, position, y, flow, childrenLeft, selected, true);            return activeView;        &#125;    &#125;    // æ–°å»ºä¸€ä¸ª Viewï¼Œæˆ–è€…æ˜¯å°†ä¸€ä¸ªæœªä½¿ç”¨çš„ View convert ä¸€ä¸‹ï¼ˆå¦‚æœå¯èƒ½çš„è¯ï¼‰    final View child = obtainView(position, mIsScrap);    // æ”¾åˆ°å¯¹åº”çš„ä½ç½®ä¸Š    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[0]);    return child;&#125;</code></pre><p>è¿™é‡Œä¼šå°è¯•å…ˆè·å–å›æ”¶ç«™ä¸­å¯¹åº”çš„ Viewï¼Œåœ¨é¦–æ¬¡ layout æ—¶è‚¯å®šè·å–åˆ°çš„æ˜¯<code>null</code>ï¼Œå°±ä¼šè°ƒç”¨<code>obtainView()</code>æ¥åˆ›å»ºä¸€ä¸ª Viewï¼Œè¿™ä¸ªæ–¹æ³•ç”± AbsListView æ¥å®ç°ï¼š</p><pre><code class="java">// AbsListView.javaView obtainView(int position, boolean[] outMetadata) &#123;    Trace.traceBegin(Trace.TRACE_TAG_VIEW, &quot;obtainView&quot;);    outMetadata[0] = false;    final View transientView = mRecycler.getTransientStateView(position);  // 1    if (transientView != null) &#123;        final LayoutParams params = (LayoutParams) transientView.getLayoutParams();        // If the view type hasn&#39;t changed, attempt to re-bind the data.        if (params.viewType == mAdapter.getItemViewType(position)) &#123;            final View updatedView = mAdapter.getView(position, transientView, this); //2            // If we failed to re-bind the data, scrap the obtained view.            if (updatedView != transientView) &#123;                setItemViewLayoutParams(updatedView, position);                mRecycler.addScrapView(updatedView, position);            &#125;        &#125;        outMetadata[0] = true;        // Finish the temporary detach started in addScrapView().        transientView.dispatchFinishTemporaryDetach();        return transientView;    &#125;    final View scrapView = mRecycler.getScrapView(position);  // 3    final View child = mAdapter.getView(position, scrapView, this);  // 4    if (scrapView != null) &#123;        if (child != scrapView) &#123;            // Failed to re-bind the data, return scrap to the heap.            mRecycler.addScrapView(scrapView, position);  // 5        &#125; else if (child.isTemporarilyDetached()) &#123;            outMetadata[0] = true;            // Finish the temporary detach started in addScrapView().            child.dispatchFinishTemporaryDetach();        &#125;    &#125;    if (mCacheColorHint != 0) &#123;        child.setDrawingCacheBackgroundColor(mCacheColorHint);    &#125;    if (child.getImportantForAccessibility() == IMPORTANT_FOR_ACCESSIBILITY_AUTO) &#123;        child.setImportantForAccessibility(IMPORTANT_FOR_ACCESSIBILITY_YES);    &#125;    setItemViewLayoutParams(child, position);    if (AccessibilityManager.getInstance(mContext).isEnabled()) &#123;        if (mAccessibilityDelegate == null) &#123;            mAccessibilityDelegate = new ListItemAccessibilityDelegate();        &#125;        if (child.getAccessibilityDelegate() == null) &#123;            child.setAccessibilityDelegate(mAccessibilityDelegate);        &#125;    &#125;    Trace.traceEnd(Trace.TRACE_TAG_VIEW);    return child;&#125;</code></pre><p>è¿™ä¸ªæ–¹æ³•æ˜¯å„ç§ ListView åŠå…¶æ´¾ç”Ÿç±»ä¸­æœ€é‡è¦çš„æ–¹æ³•äº†ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p><ol><li>æ£€æŸ¥å›æ”¶ç«™ä¸­æ˜¯å¦æœ‰ç¬æ€çš„ Viewï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°è¯•é‡æ–°ç»‘å®šæ•°æ®ï¼›å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±ç›´æ¥æ‰”æ‰ï¼Œé‡æ–°åˆ›å»ºã€‚</li><li>å¦‚æœåœ¨ä¸Šä¸€æ­¥ä¸­è·å–åˆ°äº†ç¬æ€ Viewï¼Œå¹¶ä¸”ä¹‹å‰å­˜å‚¨çš„ ViewType ä¸ Adapter ä¸­å­˜å‚¨çš„ ViewType ç›¸åŒçš„è¯ï¼Œå°±ç›´æ¥æŠŠç¬æ€ View äº¤ç»™ Adapterï¼Œé‡æ–°ç»‘å®šæ•°æ®ã€‚</li><li>å¦‚æœåœ¨ç¬¬1æ­¥ä¸­æ²¡æœ‰è·å–åˆ°ç¬æ€ Viewï¼Œåˆ™å°è¯•ä» ScrapViews ä¸­è·å–ï¼Œçœ‹æœ‰æ²¡æœ‰è¢«åºŸå¼ƒçš„ Viewã€‚</li><li>æ‹¿ç€ä¸Šä¸€æ­¥è·å–çš„ ScrapViewï¼Œäº¤ç»™ Adapter ç»‘å®šæ•°æ®ã€‚</li><li>å¦‚æœè·å–çš„ ScrapView å’Œ Adapter ç»‘å®šæ•°æ®åçš„ View æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼ˆå¤ç”¨ï¼‰ï¼Œåˆ™å°†è¿™ä¸ª View æ·»åŠ åˆ° ScrapViews ä¸­ã€‚</li><li>è¿”å› Adapter ç»‘å®šæ•°æ®åçš„ Viewã€‚</li></ol><p>è¿™é‡Œè¿˜æœ‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼š<code>mAdapter.getView()</code>ï¼Œçœ¼ç†Ÿå—ï¼Ÿè¿™ä¸å°±æ˜¯æˆ‘ä»¬å¹³æ—¶åœ¨å¼€å‘æ—¶è¦è¦†å†™çš„æ–¹æ³•ä¹‹ä¸€å—ï¼Œæˆ‘ä»¬å¹³æ—¶ä¼šè¿™æ ·å†™ï¼š</p><pre><code class="java">@Overridepublic View getView(int position, View convertView, ViewGroup parent) &#123;    Person person = getItem(position);    View view;    if (convertView == null) &#123;        view = LayoutInflater.from(getContext()).inflate(resourceId, null);    &#125; else &#123;        view = convertView;    &#125;    ImageView avatar = (ImageView) view.findViewById(R.id.iv_avatar);    TextView name = (TextView) view.findViewById(R.id.tv_name);    avatar.setImageResource(person.getImageId());    name.setText(person.getName());    return view;&#125;</code></pre><p>è¿™ä¸‹èƒ½æ˜ç™½å¤ç”¨çš„<code>convertView</code>æ˜¯å“ªå„¿æ¥çš„äº†å—ï¼Ÿå®ƒå¦‚æœæ˜¯<code>null</code>çš„è¯ï¼Œè¯´æ˜æ˜¯åˆæ¬¡ layout è¿‡ç¨‹ï¼Œå¦‚æœä¸æ˜¯<code>null</code>çš„è¯ï¼Œè¯´æ˜å®ƒæ˜¯ç¬æ€ View æˆ–è€…æ˜¯ ScrapViewã€‚è¿™ä¹Ÿæ˜¯ ListView ä¼˜åŒ–å¤„ä¹‹ä¸€â€”â€”å¤ç”¨<code>convertView</code>ï¼ŒèŠ‚çœæ‰ç”¨ LayoutInflater é‡æ–°æ¸²æŸ“çš„è¿‡ç¨‹ã€‚</p><p>å½“ç„¶ï¼Œåœ¨åˆæ¬¡ layout è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„<code>convertView</code>å¿…ç„¶ä¸º<code>null</code>ï¼Œä¹Ÿå³å…¨éƒ¨ä¸º LayoutInflater æ¸²æŸ“ï¼Œä¼šæ¯”è¾ƒè€—æ—¶ã€‚</p><p>æˆ‘ä»¬ç»§ç»­å›åˆ°<code>makeAndAddView()</code>æ–¹æ³•ä¸­ï¼Œä¸‹é¢è¿˜æœ‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•æ˜¯<code>setupChild()</code>ï¼š</p><pre><code class="java">  private void setupChild(View child, int position, int y, boolean flowDown, int childrenLeft,            boolean selected, boolean isAttachedToWindow) &#123;    Trace.traceBegin(Trace.TRACE_TAG_VIEW, &quot;setupListItem&quot;);    final boolean isSelected = selected &amp;&amp; shouldShowSelector();    final boolean updateChildSelected = isSelected != child.isSelected();    final int mode = mTouchMode;    final boolean isPressed = mode &gt; TOUCH_MODE_DOWN &amp;&amp; mode &lt; TOUCH_MODE_SCROLL            &amp;&amp; mMotionPosition == position;    final boolean updateChildPressed = isPressed != child.isPressed();    final boolean needToMeasure = !isAttachedToWindow || updateChildSelected            || child.isLayoutRequested();    // Respect layout params that are already in the view. Otherwise make    // some up...    AbsListView.LayoutParams p = (AbsListView.LayoutParams) child.getLayoutParams();    if (p == null) &#123;        p = (AbsListView.LayoutParams) generateDefaultLayoutParams();    &#125;    p.viewType = mAdapter.getItemViewType(position);    p.isEnabled = mAdapter.isEnabled(position);    // Set up view state before attaching the view, since we may need to    // rely on the jumpDrawablesToCurrentState() call that occurs as part    // of view attachment.    if (updateChildSelected) &#123;        child.setSelected(isSelected);    &#125;    if (updateChildPressed) &#123;        child.setPressed(isPressed);    &#125;    if (mChoiceMode != CHOICE_MODE_NONE &amp;&amp; mCheckStates != null) &#123;        if (child instanceof Checkable) &#123;            ((Checkable) child).setChecked(mCheckStates.get(position));        &#125; else if (getContext().getApplicationInfo().targetSdkVersion                &gt;= android.os.Build.VERSION_CODES.HONEYCOMB) &#123;            child.setActivated(mCheckStates.get(position));        &#125;    &#125;    if ((isAttachedToWindow &amp;&amp; !p.forceAdd) || (p.recycledHeaderFooter            &amp;&amp; p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER)) &#123;        attachViewToParent(child, flowDown ? -1 : 0, p);        // If the view was previously attached for a different position,        // then manually jump the drawables.        if (isAttachedToWindow                &amp;&amp; (((AbsListView.LayoutParams) child.getLayoutParams()).scrappedFromPosition)                        != position) &#123;            child.jumpDrawablesToCurrentState();        &#125;    &#125; else &#123;        p.forceAdd = false;        if (p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER) &#123;            p.recycledHeaderFooter = true;        &#125;        addViewInLayout(child, flowDown ? -1 : 0, p, true);        // add view in layout will reset the RTL properties. We have to re-resolve them        child.resolveRtlPropertiesIfNeeded();    &#125;    if (needToMeasure) &#123;        final int childWidthSpec = ViewGroup.getChildMeasureSpec(mWidthMeasureSpec,                mListPadding.left + mListPadding.right, p.width);        final int lpHeight = p.height;        final int childHeightSpec;        if (lpHeight &gt; 0) &#123;            childHeightSpec = MeasureSpec.makeMeasureSpec(lpHeight, MeasureSpec.EXACTLY);        &#125; else &#123;            childHeightSpec = MeasureSpec.makeSafeMeasureSpec(getMeasuredHeight(),                    MeasureSpec.UNSPECIFIED);        &#125;        child.measure(childWidthSpec, childHeightSpec);    &#125; else &#123;        cleanupLayoutState(child);    &#125;    final int w = child.getMeasuredWidth();    final int h = child.getMeasuredHeight();    final int childTop = flowDown ? y : y - h;    if (needToMeasure) &#123;        final int childRight = childrenLeft + w;        final int childBottom = childTop + h;        child.layout(childrenLeft, childTop, childRight, childBottom);    &#125; else &#123;        child.offsetLeftAndRight(childrenLeft - child.getLeft());        child.offsetTopAndBottom(childTop - child.getTop());    &#125;    if (mCachingStarted &amp;&amp; !child.isDrawingCacheEnabled()) &#123;        child.setDrawingCacheEnabled(true);    &#125;    Trace.traceEnd(Trace.TRACE_TAG_VIEW);&#125;</code></pre><p>è¿™éƒ¨åˆ†ä»£ç çš„æ ¸å¿ƒæ˜¯<code>attachViewToParent()</code>å’Œ<code>addViewInLayout()</code>æ–¹æ³•ï¼Œä»£è¡¨ç€å°† View æ­£å¼åŠ å…¥ ListView ä¸­ã€‚</p><p><a href="https://blog.csdn.net/guolin_blog/article/details/44996879">çœ‹çœ‹è¿™ä¸ªï¼Œæ—¥åç»§ç»­å†™å§</a><br><a href="https://www.jianshu.com/p/01f161cb498c">çœ‹çœ‹è¿™ä¸ª</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> ListView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>View äº‹ä»¶åˆ†å‘æœºåˆ¶</title>
      <link href="/2023-01-31/view-event-dispatch/"/>
      <url>/2023-01-31/view-event-dispatch/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« æ¥æ¢³ç†ä¸€ä¸‹ Android æœ€ä»¤äººå¤´ç–¼çš„åŸºæœ¬å…ƒç´ â€”â€”äº‹ä»¶æœºåˆ¶ã€‚</p><span id="more"></span><h2 id="äº‹ä»¶åºåˆ—"><a href="#äº‹ä»¶åºåˆ—" class="headerlink" title="äº‹ä»¶åºåˆ—"></a>äº‹ä»¶åºåˆ—</h2><p>å½“ç”¨æˆ·ç‚¹å‡»å±å¹•é‡ŒViewæˆ–è€…ViewGroupçš„æ—¶å€™ï¼Œå°†ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œè¿™ä¸ªäº‹ä»¶å¯¹è±¡å°±æ˜¯MotionEventå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è®°å½•äº†äº‹ä»¶çš„ç±»å‹ï¼Œè§¦æ‘¸çš„ä½ç½®ï¼Œä»¥åŠè§¦æ‘¸çš„æ—¶é—´ç­‰ã€‚MotionEventé‡Œé¢å®šä¹‰äº†äº‹ä»¶çš„ç±»å‹ï¼Œå…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥åœ¨å±å¹•è§¦æ‘¸ï¼Œæ»‘åŠ¨ï¼Œç¦»å¼€å±å¹•åŠ¨ä½œï¼Œåˆ†åˆ«å¯¹åº”ï¼š</p><ul><li>MotionEvent.ACTION_DOWNï¼šç”¨æˆ·è§¦æ‘¸View &amp; ViewGroup</li><li>MotionEvent.ACTION_MOVEï¼šç”¨æˆ·æ‰‹æŒ‡ç§»åŠ¨View &amp; ViewGroup</li><li>MotionEvent.ACTION_UPï¼šç”¨æˆ·æ‰‹æŒ‡ç¦»å¼€å±å¹•</li><li>MotionEvent.ACTION_CANCELï¼šäº‹ä»¶é€€å‡ºäº†ï¼Œä¸æ˜¯ç”¨æˆ·å¯¼è‡´çš„</li></ul><p>å› æ­¤ç”¨æˆ·åœ¨è§¦æ‘¸å±å¹•åˆ°ç¦»å¼€å±å¹•ä¼šäº§ç”Ÿä¸€ç³»åˆ—äº‹ä»¶ï¼š</p><pre><code>ACTION_DOWN -&gt; ACTION_MOVE(0ä¸ªæˆ–è€…å¤šä¸ª) -&gt; ACTION_UP</code></pre><p>å¦‚ä¸‹å›¾ï¼š<br><img src="https://s3.ax1x.com/2020/12/09/rCptjP.png" alt="äº‹ä»¶åºåˆ—"></p><h2 id="äº‹ä»¶ä¼ é€’çš„é¡ºåº"><a href="#äº‹ä»¶ä¼ é€’çš„é¡ºåº" class="headerlink" title="äº‹ä»¶ä¼ é€’çš„é¡ºåº"></a>äº‹ä»¶ä¼ é€’çš„é¡ºåº</h2><p>äº‹ä»¶ä¼ é€’çš„é¡ºåºå¦‚ä¸‹ï¼š</p><pre><code>InputManageSystem -&gt; WindowInputEventReceiver(ViewRootImpl) -&gt; DecorView -&gt; Activity -&gt; DecorView -&gt; å­View</code></pre><p>å¦‚æœæ‰€æœ‰çš„ View éƒ½æ²¡æœ‰æ¶ˆè€—äº‹ä»¶ï¼Œé‚£æœ€åäº‹ä»¶ä¼šä¼ å›åˆ° Activityï¼Œç”± Activity å¤„ç†ï¼ˆä¹Ÿå³ Activity çš„<code>onTouchEvent()</code>æ–¹æ³•è¢«è°ƒç”¨ï¼‰ã€‚</p><pre><code>å­View --&gt; DecorView --&gt; Activity</code></pre><p>ç”± DecorView å‘ä¸‹ï¼Œäº‹ä»¶çš„ä¼ é€’è¿˜ç®—æ¸…æ™°ï¼Œæ²¡æœ‰å¤ªå¤šçš„ç–‘é—®ã€‚é‚£æœ€å…³é”®çš„æ˜¯ï¼Œè§¦æ‘¸äº‹ä»¶æ˜¯æ€ä¹ˆäº§ç”Ÿå¹¶äº¤ç»™ DecorView çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œè§¦æ‘¸å±å¹•ï¼Œé¦–å…ˆè‚¯å®šæ˜¯ç¡¬ä»¶äº§ç”Ÿçš„ä¸€ä¸ªç”µä¿¡å·ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½æ¥è§¦åˆ°çš„è§¦æ‘¸äº‹ä»¶ç›´æ¥å°±åˆ°äº† MotionEventï¼Œé‚£ä¹ˆè¿™ä¸ª MotionEvent åœ¨å“ªé‡Œäº§ç”Ÿï¼Ÿ</p><p>å…¶å®è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ Framework å±‚åšçš„å¤„ç†ã€‚</p><p>å±å¹•å¯¹åº” Android æ¥è¯´ï¼Œæ‹…ä»»äº†<strong>é”®ç›˜</strong>çš„ä½œç”¨ï¼Œå°±æ˜¯æˆ‘ä»¬è®¡ç®—æœºç»„æˆçš„è¾“å…¥è®¾å¤‡ã€‚æˆ‘ä»¬çŸ¥é“ Android æ˜¯åŸºäº Linux ç³»ç»Ÿçš„ï¼Œå½“æˆ‘ä»¬çš„è¾“å…¥è®¾å¤‡å¯ç”¨æ—¶ï¼ˆå¯¹å½“å‰çš„ä¾‹å­æ¥è¯´â€”â€”è§¦æ‘¸å±ï¼‰ï¼Œæˆ‘ä»¬å¯¹è§¦æ‘¸å±è¿›è¡Œæ“ä½œï¼ŒLinux å°±ä¼šæ”¶åˆ°ç›¸åº”çš„<strong>ç¡¬ä»¶ä¸­æ–­</strong>ï¼Œç„¶åå°†ä¸­æ–­åŠ å·¥æˆåŸå§‹çš„<strong>è¾“å…¥äº‹ä»¶</strong>å¹¶å†™å…¥ç›¸åº”çš„<strong>è®¾å¤‡èŠ‚ç‚¹</strong>ä¸­ã€‚è€Œ Android çš„è¾“å…¥ç³»ç»Ÿæ‰€åšçš„äº‹æƒ…æ¦‚æ‹¬èµ·æ¥è¯´å°±æ˜¯ç›‘æ§è¿™äº›è®¾å¤‡èŠ‚ç‚¹ï¼Œå½“æŸä¸ªè®¾å¤‡èŠ‚ç‚¹æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œå°†æ•°æ®è¯»å‡ºå¹¶è¿›è¡Œä¸€ç³»åˆ—çš„ç¿»è¯‘åŠ å·¥ï¼Œç„¶ååœ¨æ‰€æœ‰çš„çª—å£ä¸­æ‰¾åˆ°åˆé€‚çš„äº‹ä»¶æ¥æ”¶è€…ï¼Œå¹¶æ´¾å‘ç»™å®ƒã€‚è¿™é‡Œæ‰€è¯´çš„ Android è¾“å…¥ç³»ç»Ÿï¼Œå°±æ˜¯ InputManagerServiceï¼ˆIMSï¼‰ï¼Œå®ƒå’Œæˆ‘ä»¬ç†ŸçŸ¥çš„ ActivityManagerServiceï¼ˆAMSï¼‰ä¸€æ ·ï¼Œä½œä¸ºç³»ç»ŸæœåŠ¡ï¼Œéƒ½æ˜¯åœ¨ ServiceServer ä¸­è¢«åˆ›å»ºã€‚</p><p>æ ¹æ® <a href="/activity/">Activityã€Window å’Œ View ä¹‹é—´çš„å…³ç³»</a>ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒActivity åœ¨åˆ›å»ºæ—¶ï¼Œä¼šåˆ›å»ºå¯¹åº”çš„ PhoneWindowï¼Œåˆ›å»ºå®Œæˆä¹‹åï¼Œä¼šåŒæ—¶åˆ›å»º ViewRootImpl å®ä¾‹ï¼Œåœ¨è¿™ä¸ªå®ä¾‹çš„ <code>setView()</code> æ–¹æ³•ä¸­ï¼Œä¼šå°†è¯¥ Window ä¸ IMS è¿›è¡Œå…³è”ï¼Œå…³è”çš„æ–¹å¼æ˜¯åˆ›å»º InputChannel å®ä¾‹å¹¶é€šè¿‡ Binder é€šä¿¡çš„æ–¹å¼æŠŠ PhoneWindow å’Œ InputChannel ä¸€èµ·æ‰”ç»™ IMSï¼ŒIMS å»è¿›è¡Œæ³¨å†Œã€‚å¾…æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå°±ä¼šæœ‰æ‰€å›è°ƒï¼Œè€Œå›è°ƒçš„ä¸€ä¸ªå…³é”®ç±»æ˜¯ä¸‹é¢å³å°†ä¼šæåˆ°çš„ WindowInputEventReceiverã€‚</p><h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><p>WindowInputEventReceiver æ˜¯ ViewRootImpl ä¸­çš„ä¸€ä¸ªå­ç±»ã€‚å®ƒçš„å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½æ˜¯æ­å»º DecorView ä¸ IMS ä¹‹é—´çš„æ¡¥æ¢ã€‚ åœ¨ <code>ViewRootImpl.setView()</code> ä¸­ï¼Œæœ‰å¦‚ä¸‹ä»£ç ï¼š</p><pre><code class="java">public void setView(View view, WindowManager.LayoutParams attrs, View panelParentView, int userId) &#123;    ...    // Schedule the first layout -before- adding to the window    // manager, to make sure we do the relayout before receiving    // any other events from the system.    requestLayout();                // 1    InputChannel inputChannel = null;    if ((mWindowAttributes.inputFeatures            &amp; WindowManager.LayoutParams.INPUT_FEATURE_NO_INPUT_CHANNEL) == 0) &#123;        inputChannel = new InputChannel();          // 2    &#125;    ...    try &#123;        ...        res = mWindowSession.addToDisplayAsUser(mWindow, mSeq, mWindowAttributes,                            getHostVisibility(), mDisplay.getDisplayId(), userId, mTmpFrame,                            mAttachInfo.mContentInsets, mAttachInfo.mStableInsets,                            mAttachInfo.mDisplayCutout, inputChannel,                            mTempInsets, mTempControls);        // 3        ...    &#125;    ...    if (inputChannel != null) &#123;        ...        mInputEventReceiver = new WindowInputEventReceiver(inputChannel, Looper.myLooper());  // 4    &#125;&#125;</code></pre><ol><li>å‡†å¤‡å¼€å§‹è¿›è¡Œ layout é˜¶æ®µï¼›</li><li>åˆ›å»º InputChannel å®ä¾‹ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶å¹¶æœªåˆå§‹åŒ–è¯¥å®ä¾‹ï¼›</li><li>å°† PhoneWindow å®ä¾‹å’Œ InputChannel å®ä¾‹éƒ½é€šè¿‡ Binder æ‰”ç»™ Sessionï¼ˆmWindowSession æ˜¯ IWindowSession ç±»å‹çš„ï¼Œå…¶å¯¹åº”çš„å®ç°ä¸º Session ç±»ï¼Œä½äº com/android/server/wm/Session.javaï¼‰ï¼ŒSession é€šè¿‡ä¸€ç³»åˆ—æ“ä½œå°† PhoneWindow ä¸ InputChannel ç»‘å®šã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ç»‘å®šä¹‹å‰ï¼Œæ‰ä¼šåˆ©ç”¨ <code>InputChannel.openChannelPair(name)</code> æ–¹æ³•åˆ›å»ºä¸¤ä¸ª InputChannelï¼Œä¸€ä¸ªæ˜¯ Server ç«¯ï¼Œç”¨äºå‘å¸ƒäº‹ä»¶ï¼›ä¸€ä¸ªæ˜¯ Client ç«¯ï¼Œç”¨äºæ¶ˆè€—äº‹ä»¶ï¼Œç„¶åå°†æ–°åˆ›å»ºçš„ Client ç«¯ç›´æ¥ <code>transferTo()</code> åˆ°æ­¥éª¤ 2 ä¸­åˆ›å»ºçš„å®ä¾‹ï¼Œä»è€Œå®Œæˆå…¶åˆå§‹åŒ–çš„æ“ä½œã€‚</li><li>æ³¨å†Œ WindowInputEventReceiverï¼Œå½“ InputChannel æœ‰æ¶ˆæ¯è¿‡æ¥çš„æ—¶å€™ï¼Œç«‹åˆ»å›è°ƒå®ƒçš„ <code>onInputEvent()</code> æ–¹æ³•ã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ›å»º WindowInputEventReceiver å®ä¾‹çš„æ—¶å€™ï¼Œä¹Ÿç»™å®ƒäº†ä¸€ä¸ªä¸»çº¿ç¨‹çš„ Looperï¼Œè¿™æ„å‘³ç€ï¼Œäº‹ä»¶çš„æ¥æ”¶å’Œåç»­åˆ†å‘ï¼Œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè§¦æ‘¸äº‹ä»¶ä¸èƒ½åšå¤ªå¤æ‚çš„æ“ä½œçš„åŸå› â€”â€”ä¼šå¡ä½ä¸»çº¿ç¨‹ã€‚</p><p>ç”± WindowInputEventReceiver çš„<code>onInputEvent()</code>æ–¹æ³•å±‚å±‚å‘ä¸‹èµ°ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯ä»¥æ‰¾åˆ° ViewRootImpl.java ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼š</p><pre><code class="java">// ViewRootImpl.javaView mView;private int processPointerEvent(QueuedInputEvent q) &#123;    final MotionEvent event = (MotionEvent)q.mEvent;    ...     boolean handled = mView.dispatchPointerEvent(event);    ...    return handled ? FINISH_HANDLED : FORWARD;&#125;</code></pre><p>æ­¤å¤„çš„<code>mView</code>ï¼Œæ˜¯åœ¨<code>ViewRootImpl.setView()</code>ä¸­èµ‹å€¼çš„ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†å¾ˆå¤šçš„é‡è¦å·¥ä½œï¼Œæˆ‘ä¼šåœ¨<a href="/viewrootimpl/">å…³äº ViewRootImpl</a>ä¸€æ–‡ä¸­è¿›è¡Œè¯¦è§£ã€‚è¿™ä¸ª<code>setView()</code>æ–¹æ³•ï¼Œæ˜¯åœ¨<code>WindowManagerGlobal.addView()</code>ä¸­è¢«è°ƒç”¨çš„ã€‚è€Œ<code>WindowManagerGlobal.addView()</code>åˆæ˜¯åœ¨<code>WindowManagerImpl.addView()</code>ä¸­è¢«è°ƒç”¨çš„ï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œåˆæ˜¯åœ¨<code>Activity.makeVisible()</code>æ–¹æ³•ä¸­è°ƒç”¨çš„ï¼Œäºæ˜¯æˆ‘ä»¬æ‰¾åˆ°äº†ä¸Šé¢ä»£ç ä¸­<code>mView</code>çš„å‡ºå¤„ï¼š</p><pre><code class="java">// android.app.Activity.javaView mDecor = null;void makeVisible() &#123;    if (!mWindowAdded) &#123;        ViewManager wm = getWindowManager();        wm.addView(mDecor, getWindow().getAttributes());        mWindowAdded = true;    &#125;    mDecor.setVisibility(View.VISIBLE);&#125;</code></pre><p>åŸæ¥å°±æ˜¯ DecorView å•Šã€‚åˆ°æ­¤ï¼Œäº‹ä»¶ç»ˆäºç¨³ç¨³åœ°äº¤ç»™äº†æˆ‘ä»¬çš„ DecorViewã€‚</p><p>æ¥ä¸‹æ¥åœ¨ DecorView.java ä¸­æ‰¾æ‰¾<code>dispatchPointerEvent()</code>ã€‚WTFï¼Ÿæ²¡æ‰¾åˆ°ï¼Ÿè¡¨ç€æ€¥ï¼Œé‚£è‚¯å®šåœ¨ ViewGroup.java é‡Œã€‚WTFï¼Ÿæ²¡æ‰¾åˆ°ï¼Ÿè¡¨ç€æ€¥ï¼Œé‚£è‚¯å®šåœ¨ View.java é‡Œã€‚</p><pre><code class="java">// View.java@UnsupportedAppUsagepublic final boolean dispatchPointerEvent(MotionEvent event) &#123;    if (event.isTouchEvent()) &#123;        return dispatchTouchEvent(event);    &#125; else &#123;        return dispatchGenericMotionEvent(event);    &#125;&#125;</code></pre><p>ç”±æ­¤å¼•å‡ºä¸‹é¢çš„éƒ¨åˆ†ã€‚</p><h2 id="ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•"><a href="#ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•" class="headerlink" title="ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•"></a>ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•</h2><p>äº‹ä»¶åˆ†å‘ä¸­æœ‰3ä¸ªæ¯”è¾ƒé‡è¦çš„å…¥å£æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>public boolean dispatchTouchEvent(MotionEvent event)</code></li><li><code>public boolean onTouchEvent(MotionEvent event)</code></li><li><code>public boolean onInterceptTouchEvent(MotionEvent ev)</code>ã€‚</li></ul><p>å…ˆæ¥çœ‹çœ‹è¿™å‡ ä¸ªæ–¹æ³•çš„è°ƒç”¨å…³ç³»ï¼š<br><em><img src="/img/15.png" alt="äº‹ä»¶åˆ†å‘æœºåˆ¶å›¾"></em></p><p>ä¸Šå›¾ä¸­ç»¿è‰²çº¿æ¡è¡¨ç¤ºé»˜è®¤çš„äº‹ä»¶å¤„ç†æµç¨‹ï¼Œå³æˆ‘ä»¬æ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œäº‹ä»¶ä¼šæŒ‰ç…§ç»¿è‰²çº¿æ¡æ‰€ç¤ºçš„æ–¹å‘ç”±Activity -&gt; â€¦ViewGroupâ€¦ -&gt; View -&gt; â€¦ViewGroupâ€¦ -&gt; Activity è¿™ä¸ªUå‹å›¾è¿›è¡Œä¼ é€’ã€‚å³ä¸€ç›´é»˜è®¤è°ƒç”¨<code>super.xxx</code>æ–¹æ³•ã€‚</p><p>é»‘è‰²çº¿æ¡è¡¨ç¤ºé»˜è®¤Activity -&gt;â€¦ViewGroupâ€¦ -&gt; View -&gt;â€¦ViewGroupâ€¦ -&gt; Activity è¿™ä¸ªUå‹å›¾çš„ä»»ä¸€èŠ‚ç‚¹ä¸­ï¼ˆä¸åŒ…æ‹¬<code>onInterceptTouchEvent</code>ï¼‰è¿”å›äº†trueï¼Œäº‹ä»¶å³ç»“æŸï¼Œä¸å†å‘ä¸‹ä¸€èŠ‚ç‚¹ä¼ é€’ã€‚</p><p>çº¢è‰²çº¿æ¡è¡¨ç¤ºä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œå°¤å…¶æ˜¯ViewGroupï¼Œ<code>ViewGroup.onInterceptTouchEvent()</code>è¡¨ç¤ºè¯¢é—®å½“å‰ViewGroupæ˜¯å¦éœ€è¦æ‹¦æˆªæ­¤äº‹ä»¶å³è¦ä¸è¦å¤„ç†ï¼Œä¸ºä»€ä¹ˆè¦ã€å¤šæ­¤ä¸€ä¸¾ã€å‘¢ï¼Œå› ä¸º<code>ViewGroup.dispatchTouchEvent()</code>è¿™ä¸ªå‡½æ•°çš„ç‰¹æ®Šï¼Œä»ä¸Šå›¾å¯çŸ¥ï¼Œè¯¥å‡½æ•°è¿”å›trueï¼Œæ˜¯æ¶ˆè´¹äº‹ä»¶ï¼Œè¿”å›falseæ˜¯äº¤ç”±ä¸Šä¸€çº§çš„ViewGroupæˆ–è€…Activityçš„<code>onTouchEvent()</code>ã€‚é‚£ä¹ˆå®ƒæ€ä¹ˆå‘ä¸‹ä¼ é€’äº‹ä»¶æˆ–è€…æƒ³æŠŠäº‹ä»¶äº¤ç»™è‡ªå·±çš„<code>onTouchEvent</code>å¤„ç†å‘¢ï¼Œæ‰€ä»¥ViewGroupå¤šäº†ä¸ª<code>onInterceptTouchEvent</code>ï¼ˆViewæ˜¯æ²¡æœ‰è¯¥å‡½æ•°çš„ï¼‰ï¼Œ<code>onInterceptTouchEvent</code>èµ·åˆ°ä½œç”¨çš„æ˜¯åˆ†æµã€‚<code>onInterceptTouchEvent</code>è¿”å›<code>false</code>æˆ–è€…è¿”å›<code>super.xxx</code>æ˜¯å‘ä¸‹çº§Viewæˆ–è€…ViewGroupä¼ é€’ï¼Œè¿”å›<code>true</code>å‘¢æ˜¯æŠŠäº‹ä»¶äº¤ç»™è‡ªå·±çš„onTouchEventå¤„ç†ã€‚</p><p>æ¥ä¸ŠèŠ‚ï¼Œåˆšæ‰äº‹ä»¶äº¤ç»™äº† DecorViewï¼Œä½†æ˜¯æ— å¥ˆæœ€åè¿˜æ˜¯åœ¨ View ä¸­æ‰¾åˆ° <code>dispatchPointerEvent()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªäº‹ä»¶æ˜¯æ€ä¹ˆä¸ªèµ°å‘ï¼š</p><h3 id="dispatchTouchEvent"><a href="#dispatchTouchEvent" class="headerlink" title="dispatchTouchEvent"></a><code>dispatchTouchEvent</code></h3><p><code>dispatchTouchEvent</code>æ–¹æ³•ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ã€‚äº‹ä»¶ä¼ é€’åˆ°å½“å‰ View/ViewGroup æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚<code>dispatchTouchEvent</code>æ–¹æ³•é‡Œé¢åŒ…å«äº†å…·ä½“çš„äº‹ä»¶åˆ†å‘é€»è¾‘ï¼Œè¿”å›ç»“æœå—å½“å‰ View çš„<code>onTouchEvent</code>æ–¹æ³•å’Œä¸‹çº§ View çš„<code>dispatchTouchEvent</code>æ–¹æ³•çš„å½±å“ã€‚</p><p>å› ä¸º DecorView ç»§æ‰¿è‡ª ViewGroupï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ViewGroupæ˜¯å¦‚ä½•é€šè¿‡<code>dispatchTouchEvent</code>åˆ†å‘äº‹ä»¶çš„ï¼š</p><pre><code class="java">// ViewGroup.java @Override    public boolean dispatchTouchEvent(MotionEvent ev) &#123;        if (mInputEventConsistencyVerifier != null) &#123;            mInputEventConsistencyVerifier.onTouchEvent(ev, 1);        &#125;        // If the event targets the accessibility focused view and this is it, start        // normal event dispatch. Maybe a descendant is what will handle the click.        if (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) &#123;            ev.setTargetAccessibilityFocus(false);        &#125;        boolean handled = false;        if (onFilterTouchEventForSecurity(ev)) &#123;            final int action = ev.getAction();            final int actionMasked = action &amp; MotionEvent.ACTION_MASK;            // Handle an initial down.            if (actionMasked == MotionEvent.ACTION_DOWN) &#123;                // Throw away all previous state when starting a new touch gesture.                // The framework may have dropped the up or cancel event for the previous gesture                // due to an app switch, ANR, or some other state change.                cancelAndClearTouchTargets(ev);                resetTouchState();            &#125;            // Check for interception.            final boolean intercepted;            if (actionMasked == MotionEvent.ACTION_DOWN                    || mFirstTouchTarget != null) &#123;                final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;                if (!disallowIntercept) &#123;                    intercepted = onInterceptTouchEvent(ev); // åˆ¤æ–­æ˜¯å¦è¦æ‹¦æˆªäº‹ä»¶                    ev.setAction(action); // restore action in case it was changed                &#125; else &#123;                    intercepted = false;                &#125;            &#125; else &#123;                // There are no touch targets and this action is not an initial down                // so this view group continues to intercept touches.                intercepted = true;            &#125;            // If intercepted, start normal event dispatch. Also if there is already            // a view that is handling the gesture, do normal event dispatch.            if (intercepted || mFirstTouchTarget != null) &#123;                ev.setTargetAccessibilityFocus(false);            &#125;            // Check for cancelation.            final boolean canceled = resetCancelNextUpFlag(this)                    || actionMasked == MotionEvent.ACTION_CANCEL;            // Update list of touch targets for pointer down, if needed.            final boolean split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != 0;            TouchTarget newTouchTarget = null;            boolean alreadyDispatchedToNewTouchTarget = false;            // åœ¨è¿™é‡Œå¯»æ‰¾åˆé€‚çš„å­viewå¹¶æ´¾å‘äº‹ä»¶            if (!canceled &amp;&amp; !intercepted) &#123;                // If the event is targeting accessibility focus we give it to the                // view that has accessibility focus and if it does not handle it                // we clear the flag and dispatch the event to all children as usual.                // We are looking up the accessibility focused host to avoid keeping                // state since these events are very rare.                View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()                        ? findChildWithAccessibilityFocus() : null;                if (actionMasked == MotionEvent.ACTION_DOWN                        || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)                        || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;                    final int actionIndex = ev.getActionIndex(); // always 0 for down                    final int idBitsToAssign = split ? 1 &lt;&lt; ev.getPointerId(actionIndex)                            : TouchTarget.ALL_POINTER_IDS;                    // Clean up earlier touch targets for this pointer id in case they                    // have become out of sync.                    removePointersFromTouchTargets(idBitsToAssign);                    final int childrenCount = mChildrenCount;                    if (newTouchTarget == null &amp;&amp; childrenCount != 0) &#123;                        final float x = ev.getX(actionIndex);                        final float y = ev.getY(actionIndex);                        // Find a child that can receive the event.                        // Scan children from front to back.                        final ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();                        final boolean customOrder = preorderedList == null                                &amp;&amp; isChildrenDrawingOrderEnabled();                        final View[] children = mChildren;                        for (int i = childrenCount - 1; i &gt;= 0; i--) &#123;                            final int childIndex = getAndVerifyPreorderedIndex(                                    childrenCount, i, customOrder);                            final View child = getAndVerifyPreorderedView(                                    preorderedList, children, childIndex);                            // If there is a view that has accessibility focus we want it                            // to get the event first and if not handled we will perform a                            // normal dispatch. We may do a double iteration but this is                            // safer given the timeframe.                            if (childWithAccessibilityFocus != null) &#123;                                if (childWithAccessibilityFocus != child) &#123;                                    continue;                                &#125;                                childWithAccessibilityFocus = null;                                i = childrenCount - 1;                            &#125;                            if (!child.canReceivePointerEvents()                                    || !isTransformedTouchPointInView(x, y, child, null)) &#123;                                ev.setTargetAccessibilityFocus(false);                                continue;                            &#125;                            newTouchTarget = getTouchTarget(child);                            if (newTouchTarget != null) &#123;                                // Child is already receiving touch within its bounds.                                // Give it the new pointer in addition to the ones it is handling.                                newTouchTarget.pointerIdBits |= idBitsToAssign;                                break;                            &#125;                            resetCancelNextUpFlag(child);                            if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) &#123;                                // Child wants to receive touch within its bounds.                                mLastTouchDownTime = ev.getDownTime();                                if (preorderedList != null) &#123;                                    // childIndex points into presorted list, find original index                                    for (int j = 0; j &lt; childrenCount; j++) &#123;                                        if (children[childIndex] == mChildren[j]) &#123;                                            mLastTouchDownIndex = j;                                            break;                                        &#125;                                    &#125;                                &#125; else &#123;                                    mLastTouchDownIndex = childIndex;                                &#125;                                mLastTouchDownX = ev.getX();                                mLastTouchDownY = ev.getY();                                newTouchTarget = addTouchTarget(child, idBitsToAssign);                                alreadyDispatchedToNewTouchTarget = true;                                break;                            &#125;                            // The accessibility focus didn&#39;t handle the event, so clear                            // the flag and do a normal dispatch to all children.                            ev.setTargetAccessibilityFocus(false);                        &#125;                        if (preorderedList != null) preorderedList.clear();                    &#125;                    if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) &#123;                        // Did not find a child to receive the event.                        // Assign the pointer to the least recently added target.                        newTouchTarget = mFirstTouchTarget;                        while (newTouchTarget.next != null) &#123;                            newTouchTarget = newTouchTarget.next;                        &#125;                        newTouchTarget.pointerIdBits |= idBitsToAssign;                    &#125;                &#125;            &#125;            // Dispatch to touch targets.            if (mFirstTouchTarget == null) &#123;                // No touch targets so treat this as an ordinary view.                handled = dispatchTransformedTouchEvent(ev, canceled, null,                        TouchTarget.ALL_POINTER_IDS);            &#125; else &#123;                // Dispatch to touch targets, excluding the new touch target if we already                // dispatched to it.  Cancel touch targets if necessary.                TouchTarget predecessor = null;                TouchTarget target = mFirstTouchTarget;                while (target != null) &#123;                    final TouchTarget next = target.next;                    if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;                        handled = true;                    &#125; else &#123;                        final boolean cancelChild = resetCancelNextUpFlag(target.child)                                || intercepted;                        if (dispatchTransformedTouchEvent(ev, cancelChild,                                target.child, target.pointerIdBits)) &#123;                            handled = true;                        &#125;                        if (cancelChild) &#123;                            if (predecessor == null) &#123;                                mFirstTouchTarget = next;                            &#125; else &#123;                                predecessor.next = next;                            &#125;                            target.recycle();                            target = next;                            continue;                        &#125;                    &#125;                    predecessor = target;                    target = next;                &#125;            &#125;            // Update list of touch targets for pointer up or cancel, if needed.            if (canceled                    || actionMasked == MotionEvent.ACTION_UP                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;                resetTouchState();            &#125; else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;                final int actionIndex = ev.getActionIndex();                final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex);                removePointersFromTouchTargets(idBitsToRemove);            &#125;        &#125;        if (!handled &amp;&amp; mInputEventConsistencyVerifier != null) &#123;            mInputEventConsistencyVerifier.onUnhandledEvent(ev, 1);        &#125;        return handled;    &#125;</code></pre><p>ç®€å•æ€»ç»“ï¼Œå°±æ˜¯ï¼š</p><ol><li>å…ˆåˆ¤æ–­æ˜¯å¦è¦æ‹¦æˆªï¼ˆé€šè¿‡<code>onInterceptTouchEvent()</code>æ–¹æ³•ï¼‰ï¼Œå¦‚æœä¸æ‹¦æˆªï¼Œé‚£å°±å¯»æ‰¾åˆé€‚çš„å­viewè¿›è¡Œäº‹ä»¶çš„æ´¾å‘ï¼Œä¹Ÿæ—¢è°ƒç”¨å­viewçš„<code>dispatchTouchEvent()</code>ã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå­viewæ¶ˆè´¹äº†æ­¤æ¬¡äº‹ä»¶ï¼Œå³<code>dispatchTouchEvent()</code>è¿”å›äº†<code>true</code>ï¼Œé‚£æ´¾å‘ä¸­æ­¢ï¼Œå¹¶è¿”å›trueï¼Œè¡¨ç¤ºäº‹ä»¶å·²ç»è¢«æ¶ˆè´¹ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå­viewæ¶ˆè´¹æ­¤æ¬¡äº‹ä»¶ï¼Œå³<code>dispatchTouchEvent()</code>è¿”å›äº†<code>false</code>ï¼Œé‚£ViewGroupå°±è‡ªå·±å¤„ç†æ­¤æ¬¡äº‹ä»¶ï¼Œè°ƒç”¨çˆ¶ç±»Viewçš„<code>onTouchEvent()</code>ã€‚å¦‚æœæœ€åè¿˜æœªæ¶ˆè€—ï¼Œé‚£å°±ä¼šä¸€ç›´å‘ä¸Šè¿”å›ï¼Œç›´åˆ°Activityçš„<code>onTouchEvent()</code>ã€‚</li><li>å¦‚æœè¦æ‹¦æˆªï¼Œé‚£å°±ä¼šç›´æ¥è°ƒç”¨è‡ªå·±çˆ¶ç±»Viewçš„<code>onTouchEvent()</code>ã€‚</li></ol><p>ä¸Šä¸€éƒ¨åˆ†çš„ä»£ç é‡Œæˆ‘ä»¬ä¹Ÿä¹Ÿçœ‹åˆ°ï¼Œ<code>dispatchPointerEvent</code>ç›´æ¥è°ƒç”¨äº†<code>dispatchTouchEvent(event)</code>ï¼Œè€ŒDecorViewåˆé‡å†™äº†è¿™ä¸ªæ–¹æ³•ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹<code>DecorView.dispatchTouchEvent()</code>åšäº†äº›å•¥ï¼š</p><pre><code class="java">// DecorView.java@Overridepublic boolean dispatchTouchEvent(MotionEvent ev) &#123;    final Window.Callback cb = mWindow.getCallback();    return cb != null &amp;&amp; !mWindow.isDestroyed() &amp;&amp; mFeatureId &lt; 0            ? cb.dispatchTouchEvent(ev) : super.dispatchTouchEvent(ev);&#125;</code></pre><p>Callbackæ¥è‡ªäºWindow.javaï¼š</p><pre><code class="java">// Window.javapublic final Callback getCallback() &#123;    return mCallback;&#125;</code></pre><pre><code class="java">// Callback.java:public interface Callback &#123;    ...    public boolean dispatchTouchEvent(MotionEvent event);    ...&#125;</code></pre><p>é‚£æ—¢ç„¶æœ‰<code>getCallback()</code>å°±è‚¯å®šæœ‰<code>setCallback()</code>ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹ã€‚<br><img src="/img/14.png" alt="Callbackè°ƒç”¨è€…"></p><p>åœ¨<code>Activity.attach()</code>æ–¹æ³•ä¸­æ‰¾åˆ°äº†<code>window.setCallback(this)</code>ï¼š</p><pre><code class="java">// Activity.java@UnsupportedAppUsagefinal void attach(Context context, ActivityThread aThread,        Instrumentation instr, IBinder token, int ident,        Application application, Intent intent, ActivityInfo info,        CharSequence title, Activity parent, String id,        NonConfigurationInstances lastNonConfigurationInstances,        Configuration config, String referrer, IVoiceInteractor voiceInteractor,        Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) &#123;    ...    mWindow.setCallback(this);      ...&#125;</code></pre><p>æ‰€ä»¥è¯´ï¼ŒMotionEventæœ€ç»ˆåˆæ˜¯ä¼ é€’åˆ°äº†Activityï¼Œ<code>cb.dispatchTouchEvent(ev)</code>ä¹Ÿå°±æ˜¯ç›¸å½“äº<code>Activity.dispatchTouchEvent()</code>ã€‚</p><p>é‚£ä¹ˆæ¥çœ‹çœ‹Activityæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š</p><pre><code class="java">    // Activty.java    /**     * è¢«è°ƒç”¨æ¥å¤„ç†è§¦æ‘¸å±å¹•çš„äº‹ä»¶ã€‚     * ä½ å¯ä»¥è¦†å†™æ­¤æ–¹æ³•ä»¥åœ¨äº‹ä»¶åˆ†å‘åˆ°windowä¹‹å‰æ‹¦æˆªæ‰€æœ‰çš„äº‹ä»¶ã€‚     * ä¸è¿‡è¦ç¡®ä¿è°ƒç”¨æ­¤å¤„çš„å®ç°ä¿è¯è§¦æ‘¸äº‹ä»¶éƒ½è¢«æ­£å¸¸å¤„ç†ã€‚      *     * @param ev The touch screen event.     *     * @return boolean Return true if this event was consumed.     */    public boolean dispatchTouchEvent(MotionEvent ev) &#123;        if (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;            onUserInteraction();        &#125;        if (getWindow().superDispatchTouchEvent(ev)) &#123;            return true;        &#125;        return onTouchEvent(ev);    &#125;</code></pre><p>Activityåˆè°ƒç”¨äº†<code>getWindow().superDispatchTouchEvent(ev)</code>ä¹Ÿå°±æ˜¯PhoneWindowã€‚</p><pre><code class="java">// PhoneWindow.java@Overridepublic boolean superDispatchTouchEvent(MotionEvent event) &#123;        // å…œå…œè½¬è½¬ä¸€å¤§åœˆï¼Œè¿˜æ˜¯æŠŠäº‹ä»¶äº¤ç»™æˆ‘ä»¬çš„DecorViewï¼Œ        // DecorViewç»§æ‰¿è‡ªFrameLayoutï¼ŒFrameLayoutå‘¢åˆç»§æ‰¿è‡ªViewGroupï¼Œ        // æ‰€ä»¥ä½œä¸ºä¸€ä¸ªViewGroupï¼ŒDecorViewç»§ç»­å‘å…¶å­Viewæ´¾å‘äº‹ä»¶ï¼Œå…¶æµç¨‹åœ¨æ–‡ç« çš„å¼€å¤´å°±å·²ç»ç»™äº†        return mDecor.superDispatchTouchEvent(event);&#125;</code></pre><p>è¿™é‡Œåˆè°ƒç”¨äº†DecorViewçš„superDispatchTouchEvent(event)ï¼š</p><pre><code class="java">// DecorView.javapublic boolean superDispatchTouchEvent(MotionEvent event) &#123;    return super.dispatchTouchEvent(event);&#125;</code></pre><p>è¿™é‡Œå°±æ˜¯ç›´æ¥ç»§æ‰¿è‡ªViewGroupçš„<code>dispatchTouchEvent(MotionEvent ev)</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹ä»¶ä» DecorView ä¼ é€’åˆ°Activityï¼Œæœ€ç»ˆåˆå›åˆ° DecorViewï¼Œæœ€åæŒ‰ç…§åˆ†å‘æœºåˆ¶åˆ†å‘åˆ°ViewGroupå†åˆ°æ‰€æœ‰çš„å­Viewã€‚</p><p>å…œå…œè½¬è½¬ä¸€å¤§åœˆæˆ‘ä»¬ç¥ç»éƒ½è¢«ç»•å¼¯äº†:joy: ã€‚åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬è§¦æ‘¸ï¼ˆç‚¹å‡»ï¼‰å±å¹•æ—¶ï¼ŒAndroidè¾“å…¥ç³»ç»ŸInputManagerServiceé€šè¿‡å¯¹äº‹ä»¶çš„åŠ å·¥å¤„ç†å†æ‰¾åˆ°åˆé€‚çš„ Window æ¥æ”¶è€…å¹¶é€šè¿‡ InputChannel å‘ Window æ´¾å‘åŠ å·¥åçš„äº‹ä»¶ï¼Œå¹¶è§¦å‘ WindowInputEventReceiver çš„<code>onInputEvent</code>çš„è°ƒç”¨ï¼Œç”±æ­¤äº§ç”Ÿåé¢ä¸€ç³»åˆ—çš„è°ƒç”¨ï¼ŒæŠŠäº‹ä»¶æ´¾å‘ç»™æ•´ä¸ªæ§ä»¶æ ‘çš„æ ¹ DecorView ã€‚è€Œ DecorView åˆä¸Šæ¼”äº†ä¸€å‡ºå·æ¢æ¢æŸ±çš„æŠŠæˆï¼Œå…ˆæŠŠäº‹ä»¶äº¤ç»™ Activity å¤„ç†ï¼Œåœ¨ Activity ä¸­åˆæŠŠäº‹ä»¶äº¤è¿˜ç»™äº†æˆ‘ä»¬çš„ DecorView ã€‚è‡ªæ­¤æ²¿ç€æ§ä»¶æ ‘è‡ªä¸Šå‘ä¸‹ä¾æ¬¡æ´¾å‘äº‹ä»¶ã€‚å¦‚æœæœ€åæ²¡æœ‰ä»»ä½• View å¤„ç†æ­¤æ¬¡ç‚¹å‡»äº‹ä»¶ï¼Œåˆ™ Activity å†æ¥åšæœ€åçš„å¤„ç†ã€‚</p><p>é‚£å°±ç»§ç»­çœ‹çœ‹Viewçš„äº‹ä»¶åˆ†å‘ï¼š</p><pre><code class="java">// View.java/*** å°†è§¦æ‘¸å±å¹•çš„æ‰‹åŠ¿äº‹ä»¶å‘ä¸‹ä¼ é€’ç»™ç›®æ ‡ viewï¼Œå¦‚æœå½“å‰ view æ˜¯ç›®æ ‡ viewçš„è¯ï¼Œå°±ä¼ é€’ç»™å½“å‰ viewã€‚** @param event The motion event to be dispatched.* @return å¦‚æœäº‹ä»¶è¢«å¤„ç†ï¼ˆæ¶ˆè€—ï¼‰ï¼Œå°±è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚*/public boolean dispatchTouchEvent(MotionEvent event) &#123;    // If the event should be handled by accessibility focus first.    if (event.isTargetAccessibilityFocus()) &#123;        // We don&#39;t have focus or no virtual descendant has it, do not handle the event.        if (!isAccessibilityFocusedViewOrHost()) &#123;            return false;        &#125;        // We have focus and got the event, then use normal event dispatch.        event.setTargetAccessibilityFocus(false);    &#125;    boolean result = false;    if (mInputEventConsistencyVerifier != null) &#123;        mInputEventConsistencyVerifier.onTouchEvent(event, 0);    &#125;    final int actionMasked = event.getActionMasked();    if (actionMasked == MotionEvent.ACTION_DOWN) &#123;        // Defensive cleanup for new gesture        stopNestedScroll();    &#125;    // è¿™é‡Œå†³å®šäº†è¯¥ view æ˜¯å¦è¦æ¶ˆè€—æ­¤æ¬¡äº‹ä»¶ã€‚    //    // 1. å¦‚æœè¯¥ view æœ‰`TouchListener`çš„è¯ï¼Œäº¤ç»™å®ƒçš„æ´¾ç”Ÿç±»çš„ `onTouch` å®ç°å»å†³å®šæ˜¯å¦è¦æ¶ˆè€—äº‹ä»¶ã€‚    // 2. å¦‚æœæ²¡æœ‰ `TouchListener`ï¼Œé‚£ä¹ˆå°±çœ‹ view è‡ªå·±å¤„ç† touchEvent äº‹ä»¶ä¹‹åï¼Œæ˜¯å¦è¦æ¶ˆè€—æ‰è¯¥äº‹ä»¶ã€‚     if (onFilterTouchEventForSecurity(event)) &#123;        if ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) &#123;            result = true;        &#125;        //noinspection SimplifiableIfStatement        ListenerInfo li = mListenerInfo;        if (li != null &amp;&amp; li.mOnTouchListener != null                &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123;            result = true;        &#125;        if (!result &amp;&amp; onTouchEvent(event)) &#123;            result = true;        &#125;    &#125;    if (!result &amp;&amp; mInputEventConsistencyVerifier != null) &#123;        mInputEventConsistencyVerifier.onUnhandledEvent(event, 0);    &#125;    // Clean up after nested scrolls if this is the end of a gesture;    // also cancel it if we tried an ACTION_DOWN but we didn&#39;t want the rest    // of the gesture.    if (actionMasked == MotionEvent.ACTION_UP ||            actionMasked == MotionEvent.ACTION_CANCEL ||            (actionMasked == MotionEvent.ACTION_DOWN &amp;&amp; !result)) &#123;        stopNestedScroll();    &#125;    return result;&#125;</code></pre><h3 id="onTouchEvent"><a href="#onTouchEvent" class="headerlink" title="onTouchEvent"></a><code>onTouchEvent</code></h3><p>è¯¥æ–¹æ³•åœ¨<code>View.dispatchTouchEvent()</code>æ–¹æ³•ä¸­è°ƒç”¨ï¼Œç”¨æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ï¼Œå¦‚æœä¸æ¶ˆè€—ï¼Œåˆ™åœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­ï¼Œå½“å‰Viewæ— æ³•å†æ¬¡æ¥æ”¶åˆ°äº‹ä»¶ã€‚ä¾‹å¦‚ä¸€ä¸ª<code>Button</code>è®¾ç½®ä¸º <code>android:enabled=&quot;false&quot;</code>ï¼Œé‚£ä» ACTION_DOWN å¼€å§‹ï¼Œå°±ä¸æ¶ˆè€—è¯¥äº‹ä»¶ï¼Œé‚£ä¹ˆåé¢çš„ ACTION_MOVEã€ACTION_UPç­‰äº‹ä»¶ä¹Ÿå°±ä¸ä¼šå†æ¥æ”¶åˆ°äº†ã€‚è¿™æ˜¯ç”±ä¸€ä¸ªå«<code>mIgnoreNextUpEvent</code>çš„å˜é‡æ§åˆ¶çš„ã€‚</p><p>è¿˜æ˜¯æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// View.java/**    * å®ç°è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†å±å¹•è§¦æ‘¸æ‰‹åŠ¿äº‹ä»¶ã€‚    *     * å¦‚æœè¿™ä¸ªæ–¹æ³•è¢«ç”¨æ¥æ£€æµ‹ç‚¹å‡»åŠ¨ä½œï¼Œé‚£ä½ æœ€å¥½ä½¿ç”¨ performClick() æ–¹æ³•æ¥è§¦å‘æ­¤æ¬¡ç‚¹å‡»äº‹ä»¶ã€‚    * è¿™æ ·åšèƒ½ä¿è¯å®ƒæ˜¯ä¸€ä¸ªé«˜åº¦ä¸€è‡´æ€§çš„ç³»ç»Ÿè¡Œä¸ºï¼ŒåŒ…æ‹¬ï¼š    *    * Â· éµå®ˆç‚¹å‡»éŸ³æ•ˆçš„è®¾ç½®    * Â· åˆ†å‘ OnClickListener    * Â· å½“å¯ç”¨ accessibity æ—¶ï¼Œæ­£ç¡®å¤„ç† AccessibilityNodeInfo ä¸­çš„ ACTION_CLICK äº‹ä»¶    *    * @param event The motion event.    * @return å¦‚æœäº‹ä»¶è¢«å¤„ç†ï¼ˆæ¶ˆè€—ï¼‰ï¼Œå°±è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚    */public boolean onTouchEvent(MotionEvent event) &#123;    final float x = event.getX();    final float y = event.getY();    final int viewFlags = mViewFlags;    final int action = event.getAction();    final boolean clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE            || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)            || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;    if ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;        if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123;            setPressed(false);        &#125;        mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;        // A disabled view that is clickable still consumes the touch        // events, it just doesn&#39;t respond to them.        return clickable;    &#125;    if (mTouchDelegate != null) &#123;        if (mTouchDelegate.onTouchEvent(event)) &#123;            return true;        &#125;    &#125;    if (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) &#123;        switch (action) &#123;            case MotionEvent.ACTION_UP:                mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;                if ((viewFlags &amp; TOOLTIP) == TOOLTIP) &#123;                    handleTooltipUp();                &#125;                if (!clickable) &#123;                    removeTapCallback();                    removeLongPressCallback();                    mInContextButtonPress = false;                    mHasPerformedLongPress = false;                    mIgnoreNextUpEvent = false;                    break;                &#125;                boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;                if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) &#123;                    // take focus if we don&#39;t have it already and we should in                    // touch mode.                    boolean focusTaken = false;                    if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;                        focusTaken = requestFocus();                    &#125;                    if (prepressed) &#123;                        // The button is being released before we actually                        // showed it as pressed.  Make it show the pressed                        // state now (before scheduling the click) to ensure                        // the user sees it.                        setPressed(true, x, y);                    &#125;                    if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123;                        // This is a tap, so remove the longpress check                        removeLongPressCallback();                        // Only perform take click actions if we were in the pressed state                        if (!focusTaken) &#123;                            // Use a Runnable and post this rather than calling                            // performClick directly. This lets other visual state                            // of the view update before click actions start.                            if (mPerformClick == null) &#123;                                mPerformClick = new PerformClick();                            &#125;                            if (!post(mPerformClick)) &#123;                                performClickInternal();                            &#125;                        &#125;                    &#125;                    if (mUnsetPressedState == null) &#123;                        mUnsetPressedState = new UnsetPressedState();                    &#125;                    if (prepressed) &#123;                        postDelayed(mUnsetPressedState,                                ViewConfiguration.getPressedStateDuration());                    &#125; else if (!post(mUnsetPressedState)) &#123;                        // If the post failed, unpress right now                        mUnsetPressedState.run();                    &#125;                    removeTapCallback();                &#125;                mIgnoreNextUpEvent = false;                break;            case MotionEvent.ACTION_DOWN:                if (event.getSource() == InputDevice.SOURCE_TOUCHSCREEN) &#123;                    mPrivateFlags3 |= PFLAG3_FINGER_DOWN;                &#125;                mHasPerformedLongPress = false;                if (!clickable) &#123;                    checkForLongClick(                            ViewConfiguration.getLongPressTimeout(),                            x,                            y,                            TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS);                    break;                &#125;                if (performButtonActionOnTouchDown(event)) &#123;                    break;                &#125;                // Walk up the hierarchy to determine if we&#39;re inside a scrolling container.                boolean isInScrollingContainer = isInScrollingContainer();                // For views inside a scrolling container, delay the pressed feedback for                // a short period in case this is a scroll.                if (isInScrollingContainer) &#123;                    mPrivateFlags |= PFLAG_PREPRESSED;                    if (mPendingCheckForTap == null) &#123;                        mPendingCheckForTap = new CheckForTap();                    &#125;                    mPendingCheckForTap.x = event.getX();                    mPendingCheckForTap.y = event.getY();                    postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());                &#125; else &#123;                    // Not inside a scrolling container, so show the feedback right away                    setPressed(true, x, y);                    checkForLongClick(                            ViewConfiguration.getLongPressTimeout(),                            x,                            y,                            TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS);                &#125;                break;            case MotionEvent.ACTION_CANCEL:                if (clickable) &#123;                    setPressed(false);                &#125;                removeTapCallback();                removeLongPressCallback();                mInContextButtonPress = false;                mHasPerformedLongPress = false;                mIgnoreNextUpEvent = false;                mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;                break;            case MotionEvent.ACTION_MOVE:                if (clickable) &#123;                    drawableHotspotChanged(x, y);                &#125;                final int motionClassification = event.getClassification();                final boolean ambiguousGesture =                        motionClassification == MotionEvent.CLASSIFICATION_AMBIGUOUS_GESTURE;                int touchSlop = mTouchSlop;                if (ambiguousGesture &amp;&amp; hasPendingLongPressCallback()) &#123;                    final float ambiguousMultiplier =                            ViewConfiguration.getAmbiguousGestureMultiplier();                    if (!pointInView(x, y, touchSlop)) &#123;                        // The default action here is to cancel long press. But instead, we                        // just extend the timeout here, in case the classification                        // stays ambiguous.                        removeLongPressCallback();                        long delay = (long) (ViewConfiguration.getLongPressTimeout()                                * ambiguousMultiplier);                        // Subtract the time already spent                        delay -= event.getEventTime() - event.getDownTime();                        checkForLongClick(                                delay,                                x,                                y,                                TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS);                    &#125;                    touchSlop *= ambiguousMultiplier;                &#125;                // Be lenient about moving outside of buttons                if (!pointInView(x, y, touchSlop)) &#123;                    // Outside button                    // Remove any future long press/tap checks                    removeTapCallback();                    removeLongPressCallback();                    if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123;                        setPressed(false);                    &#125;                    mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;                &#125;                final boolean deepPress =                        motionClassification == MotionEvent.CLASSIFICATION_DEEP_PRESS;                if (deepPress &amp;&amp; hasPendingLongPressCallback()) &#123;                    // process the long click action immediately                    removeLongPressCallback();                    checkForLongClick(                            0 /* send immediately */,                            x,                            y,                            TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__DEEP_PRESS);                &#125;                break;        &#125;        return true;    &#125;    return false;&#125;</code></pre><h3 id="onInterceptTouchEvent"><a href="#onInterceptTouchEvent" class="headerlink" title="onInterceptTouchEvent"></a><code>onInterceptTouchEvent</code></h3><p><code>onInterceptTouchEvent()</code>æ–¹æ³•åœ¨<code>ViewGroup.dispatchTouchEvent()</code>æ–¹æ³•å†…éƒ¨è¢«è°ƒç”¨ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªæŸä¸ªäº‹ä»¶ã€‚å¦‚æœå½“å‰ViewGroupæ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—å½“ä¸­ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªå½“å‰äº‹ä»¶ã€‚è¿™ä¸ªæ–¹æ³•åªæœ‰ViewGroupä¸­æœ‰ï¼ŒViewä¸­æ²¡æœ‰ã€‚</p><pre><code class="java">/**    * å®ç°è¯¥æ–¹æ³•æ¥æ‹¦æˆªæ‰€æœ‰çš„è§¦æ‘¸äº‹ä»¶ã€‚è¿™èƒ½è®©ä½ ç›‘æµ‹æ‰€æœ‰å‘é€åˆ°å­viewçš„äº‹ä»¶ï¼Œå¹¶ä¸”å¾—åˆ°è¯¥äº‹ä»¶çš„æ‰€æœ‰ä¿¡æ¯ã€‚    *    * ä½¿ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä¸View.onTouchEvent()æœ‰ç€ç›¸å½“å¤æ‚çš„äº¤äº’ã€‚    * äº‹ä»¶ä¼šæŒ‰ç…§ä¸‹é¢çš„é¡ºåºè¢«æ¥æ”¶ï¼š    *    * Â· æŒ‰ä¸‹äº‹ä»¶(ACTION_DOWN)    * Â· æŒ‰ä¸‹äº‹ä»¶è¦ä¹ˆè¢«è¯¥ViewGroupçš„æŸä¸ªå­viewå¤„ç†ï¼Œè¦ä¹ˆå°±è¿›åˆ°ä½ è‡ªå·±çš„onTouchEvent()æ–¹æ³•å»å¤„ç†ï¼›    *   è¿™æ„å‘³ç€ä½ åœ¨è¦†å†™onTouchEvent()æ—¶è¦è¿”å› trueï¼Œæ‰èƒ½æ¥æ”¶åˆ°æ¥ä¸‹æ¥å…¶ä»–çš„äº‹ä»¶ï¼ˆè€Œä¸æ˜¯ç”±çˆ¶viewæ¥æ¥æ”¶å¤„ç†)ã€‚    *   è¿™ä¸ªæ–¹æ³•è¿”å› trueæ—¶ï¼Œä½ ä¸ä¼šæ¥æ”¶åˆ°æ¥è‡ª onInterceptTouchEvent() çš„ä»»ä½•äº‹ä»¶ï¼Œ    *   å¹¶ä¸”æ¥ä¸‹æ¥çš„è§¦æ‘¸äº‹ä»¶å°±ä¼šæ­£å¸¸å‘ç”Ÿã€‚    * Â· åªè¦è¿™ä¸ªæ–¹æ³•è¿”å›äº† falseï¼Œæ¥ä¸‹æ¥çš„äº‹ä»¶ï¼ˆç›´åˆ°ACTION_UPå¹¶åŒ…æ‹¬ACTION_UPäº‹ä»¶ï¼‰éƒ½ä¼šå…ˆç»è¿‡    *   onInterceptTouchEventï¼Œå†è¢«å‘é€åˆ°ç›®æ ‡viewçš„ onTouchEventã€‚    * Â· å¦‚æœè¿™å„¿è¿”å›äº† trueï¼Œåé¢å°±ä¸ä¼šæ¥æ”¶åˆ°ç›¸åŒçš„äº‹ä»¶äº†ï¼ˆé™¤äº†ACTION_CANCELï¼‰ï¼Œåç»­çš„äº‹ä»¶å°†è¢«ä¼ é€’åˆ°ä½ è‡ªå·±çš„ onTouchEvent()    *   å¹¶ä¸”ä¸ä¼šå†ç»è¿‡è¿™å„¿ã€‚å­viewå°†ä¸ä¼šå†æ¥æ”¶åˆ°ä»»ä½•äº‹ä»¶ã€‚    *    * @param ev The motion event being dispatched down the hierarchy.    * @return Return true to steal motion events from the children and have    * them dispatched to this ViewGroup through onTouchEvent().    * The current target will receive an ACTION_CANCEL event, and no further    * messages will be delivered here.    */public boolean onInterceptTouchEvent(MotionEvent ev) &#123;    if (ev.isFromSource(InputDevice.SOURCE_MOUSE)            &amp;&amp; ev.getAction() == MotionEvent.ACTION_DOWN            &amp;&amp; ev.isButtonPressed(MotionEvent.BUTTON_PRIMARY)            &amp;&amp; isOnScrollbarThumb(ev.getX(), ev.getY())) &#123;        return true;    &#125;    return false;&#125;</code></pre><p><code>onInterceptTouchEvent</code>èµ·åˆ°ä½œç”¨çš„æ˜¯åˆ†æµã€‚<code>onInterceptTouchEvent</code>è¿”å›<code>false</code>æˆ–è€…è¿”å›<code>super.xxx</code>æ˜¯å‘ä¸‹çº§Viewæˆ–è€…ViewGroupä¼ é€’ï¼Œè¿”å›<code>true</code>å‘¢æ˜¯æŠŠäº‹ä»¶äº¤ç»™è‡ªå·±çš„<code>onTouchEvent</code>å¤„ç†ã€‚</p><p>ViewGroupé»˜è®¤ä¸æ‹¦æˆªä»»ä½•äº‹ä»¶ã€‚</p><p>åˆ°æ­¤ï¼Œå…³äºäº‹ä»¶åˆ†å‘çš„æœºåˆ¶ï¼Œå°±å·®ä¸å¤šäº†ã€‚</p><h2 id="å…¶ä»–å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹"><a href="#å…¶ä»–å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹" class="headerlink" title="å…¶ä»–å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹"></a>å…¶ä»–å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹</h2><h3 id="requestDisallowInterceptTouchEventæ–¹æ³•"><a href="#requestDisallowInterceptTouchEventæ–¹æ³•" class="headerlink" title="requestDisallowInterceptTouchEventæ–¹æ³•"></a>requestDisallowInterceptTouchEventæ–¹æ³•</h3><p><code>requestDisallowInterceptTouchEvent</code>æ–¹æ³•ç”¨äºå½±å“çˆ¶å…ƒç´ çš„äº‹ä»¶æ‹¦æˆªç­–ç•¥ï¼Œ<code>requestDisallowInterceptTouchEvent(true)</code>ï¼Œè¡¨ç¤ºä¸å…è®¸çˆ¶å…ƒç´ æ‹¦æˆªäº‹ä»¶ï¼Œè¿™æ ·äº‹ä»¶å°±ä¼šä¼ é€’ç»™å­Viewã€‚ä¸€èˆ¬è¿™ä¸ªæ–¹æ³•å­Viewç”¨çš„å¤šï¼Œå¯ä»¥ç”¨æ¥å¤„ç†æ»‘åŠ¨å†²çªé—®é¢˜ã€‚</p><h3 id="onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§"><a href="#onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§" class="headerlink" title="onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§"></a>onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§</h3><ol><li><p><code>onTouchListener</code>å’Œ<code>onTouchEvent</code>éƒ½åœ¨<code>dispatchTouchEvent</code>æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œ<code>onClickListener</code>åœ¨<code>onTouchEvent</code>æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼›</p></li><li><p><code>onTouchListener</code>çš„ä¼˜å…ˆçº§é«˜äº<code>onTouchEvent</code>æ–¹æ³•ï¼Œå¦‚æœ<code>onTouchListener</code>çš„<code>onTouch</code>æ–¹æ³•è¿”å›<code>true</code>ï¼Œåˆ™<code>onTouchEvent</code>æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ï¼Œå½“ç„¶<code>onClickListener</code>å°±æ›´ä¸ä¼šè¢«è°ƒç”¨äº†ï¼›</p></li><li><p>åœ¨<code>onTouchEvent</code>æ–¹æ³•ä¸­ï¼Œå¦‚æœå½“å‰Viewè®¾ç½®äº†<code>onClickListener</code>ï¼Œé‚£ä¹ˆ<code>onClickListener</code>çš„<code>onClick</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼›</p></li><li><p>åªè¦Viewçš„<code>clickable</code>å’Œ<code>long_clickable</code>æœ‰ä¸€ä¸ªä¸º<code>true</code>ï¼ŒViewå°±ä¼šæ¶ˆè€—å½“å‰äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´<code>onTouchEvent</code>æ–¹æ³•æœ€åä¼šè¿”å›<code>true</code>ã€‚</p></li><li><p>Viewçš„<code>long_clickable</code>å±æ€§é»˜è®¤ä¸º<code>false</code>ï¼Œè€Œ<code>clickable</code>å±æ€§å’Œå…·ä½“çš„Viewæœ‰å…³ï¼Œå¯ç‚¹å‡»çš„Viewçš„<code>clickable</code>å±æ€§ä¸º<code>true</code>ï¼Œä¸å¯ç‚¹å‡»çš„Viewçš„<code>clickable</code>å±æ€§ä¸º<code>false</code>ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Framework </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ViewRootImpl è§£æ</title>
      <link href="/2023-01-31/viewrootimpl/"/>
      <url>/2023-01-31/viewrootimpl/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰åå¤æåˆ°è¿‡çš„DecorViewä¸æ˜¯æ•´ä¸ªViewæ ‘çš„æ ¹å—ï¼Ÿæ€ä¹ˆåˆå‡ºæ¥ä¸€ä¸ªçœ‹èµ·æ¥åƒæ˜¯ã€æ ¹ã€çš„ä¸œè¥¿ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹çœ‹ViewRootImplçš„ä»£ç ï¼Œå°±èƒ½æ˜ç™½Androidä¸ºä»€ä¹ˆè¦æ·»åŠ ä¸¤ä¸ªã€æ ¹ã€åœ¨æ ‘ä¸Šã€‚</p><span id="more"></span><p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>requestLayout()</code>æ–¹æ³•ç©¶ç«Ÿåœ¨åšä»€ä¹ˆï¼š</p><pre><code class="java">// ViewRoomImpl.java@Overridepublic void requestLayout() &#123;    if (!mHandlingLayoutInLayoutRequest) &#123;        checkThread();  // æ£€æŸ¥æ“ä½œçº¿ç¨‹æ˜¯å¦ä¸ºåˆ›å»ºçº¿ç¨‹        mLayoutRequested = true;        scheduleTraversals();    &#125;&#125;void scheduleTraversals() &#123;    if (!mTraversalScheduled) &#123;        mTraversalScheduled = true;        mTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();        mChoreographer.postCallback(                Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);        if (!mUnbufferedInputDispatch) &#123;            scheduleConsumeBatchedInput();        &#125;        notifyRendererOfFramePending();        pokeDrawLockIfNeeded();    &#125;&#125;final class TraversalRunnable implements Runnable &#123;    @Override    public void run() &#123;        doTraversal();    &#125;&#125;void doTraversal() &#123;    if (mTraversalScheduled) &#123;        mTraversalScheduled = false;        mHandler.getLooper().getQueue().removeSyncBarrier(mTraversalBarrier);        if (mProfile) &#123;            Debug.startMethodTracing(&quot;ViewAncestor&quot;);        &#125;        performTraversals();        if (mProfile) &#123;            Debug.stopMethodTracing();            mProfile = false;        &#125;    &#125;&#125;</code></pre><p>å¥½ï¼Œçœ‹åˆ°ä¸€ä¸ªAndroidä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•<code>performTraversals()</code>ï¼Œå®ç°äº†Viewæ ‘çš„ã€ä»æ ¹åˆ°å¶ã€çš„éå†ã€‚ViewRootImplä¸­æ¥æ”¶çš„å„ç§å˜åŒ–ï¼Œå¦‚æ¥è‡ªWMSçš„çª—å£å±æ€§å˜åŒ–ã€æ¥è‡ªæ§ä»¶æ ‘çš„å°ºå¯¸å˜åŒ–ä»¥åŠé‡ç»˜è¯·æ±‚ç­‰éƒ½å¼•å‘<code>performTraversals()</code>çš„è°ƒç”¨ï¼Œå¹¶åœ¨å…¶ä¸­å®Œæˆå¤„ç†ã€‚Viewç±»åŠå…¶å­ç±»çš„<code>onMeasure()</code>ã€<code>onLayout()</code>ã€<code>onDraw()</code>ç­‰å›è°ƒä¹Ÿéƒ½æ˜¯åœ¨è¯¥æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ç›´æ¥æˆ–é—´æ¥çš„å¼•å‘ã€‚è¯¥å‡½æ•°å¯è°“æ˜¯æ˜¯ViewRootImplçš„ã€å¿ƒè·³ã€ã€‚æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p><pre><code class="java">private void performTraversals() &#123;    ...    boolean windowSizeMayChange = false;    boolean surfaceChanged = false;    WindowManager.LayoutParams lp = mWindowAttributes;    // I. pre-measureé˜¶æ®µ    // è¿™ä¸¤ä¸ªå˜é‡å°±æ˜¯DecorViewSPEC_SIZEçš„å€™é€‰    int desiredWindowWidth;    int desiredWindowHeight;    ...    Rect frame = mWinFrame;    // æ˜¯å¦æ˜¯ã€ç¬¬ä¸€æ¬¡éå†ã€    // åœ¨ViewRootImplçš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œä¼šæœ‰å¾ˆå¤šæ¬¡çš„ã€éå†ã€ï¼Œç¬¬ä¸€æ¬¡çš„ desiredWindowWidth / desiredWindowHeight    // ä¸ä¹‹åçš„ desiredWindowWidth / desiredWindowHeight çš„æµ‹é‡æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„    if (mFirst) &#123;        mFullRedrawNeeded = true;        mLayoutRequested = true;        final Configuration config = mContext.getResources().getConfiguration();        if (shouldUseDisplaySize(lp)) &#123;            // NOTE -- system code, won&#39;t try to do compat mode.            Point size = new Point();            mDisplay.getRealSize(size);            desiredWindowWidth = size.x;            desiredWindowHeight = size.y;        &#125; else &#123;            // ç¬¬1æ¬¡â€œéå†â€çš„æµ‹é‡ï¼Œé‡‡ç”¨äº†åº”ç”¨å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å°ºå¯¸ä½œä¸ºSPEC_SIZEçš„å€™é€‰            desiredWindowWidth = mWinFrame.width();            desiredWindowHeight = mWinFrame.height();        &#125;        ...    &#125; else &#123;        // åœ¨éç¬¬1æ¬¡éå†çš„æƒ…å†µä¸‹ï¼Œä¼šé‡‡ç”¨çª—å£çš„æœ€æ–°å°ºå¯¸ä½œä¸ºSPEC_SIZEçš„å€™é€‰        desiredWindowWidth = frame.width();        desiredWindowHeight = frame.height();        //å¦‚æœçª—å£çš„æœ€æ–°å°ºå¯¸ä¸ViewRootImplä¸­çš„ç°æœ‰å°ºå¯¸ä¸åŒï¼Œè¯´æ˜WMSå•æ–¹é¢æ”¹å˜äº†çª—å£çš„å°ºå¯¸ï¼Œå°†å¯¼è‡´ä¸‹é¢ä¸‰ä¸ªç»“æœ        if (desiredWindowWidth != mWidth || desiredWindowHeight != mHeight) &#123;        //éœ€è¦å®Œæ•´çš„é‡ç»˜ä»¥é€‚åº”æ–°çš„çª—å£å°ºå¯¸        mFullRedrawNeeded = true;        //éœ€è¦å¯¹æ§ä»¶æ ‘é‡æ–°å¸ƒå±€        mLayoutRequested = true;        //æ§ä»¶æ ‘å¯èƒ½æ‹’ç»æ¥å—æ–°çš„çª—å£å°ºå¯¸ï¼Œå¯èƒ½éœ€è¦çª—å£åœ¨å¸ƒå±€é˜¶æ®µå°è¯•è®¾ç½®æ–°çš„çª—å£å°ºå¯¸ã€‚åªæ˜¯å°è¯•å˜›ï¼Œå°è¯•è€Œå·²        windowSizeMayChange = true;        &#125;    &#125;    ...    boolean layoutRequested = mLayoutRequested &amp;&amp; (!mStopped || mReportNextDraw);    if (layoutRequested) &#123;        final Resources res = mView.getContext().getResources();        if (mFirst) &#123;            ...        &#125; else &#123;            // æ£€æŸ¥WMSæ˜¯å¦å•æ–¹é¢æ”¹å˜äº†ä¸€äº›å‚æ•°ï¼Œæ ‡è®°ä¸‹æ¥ï¼Œç„¶åä½œä¸ºä¹‹åæ˜¯å¦è¿›è¡Œæ§ä»¶å¸ƒå±€çš„æ¡ä»¶ä¹‹ä¸€            // å¦‚æœçª—å£çš„widthæˆ–heightè¢«æŒ‡å®šä¸ºWRAP_CONTENTæ—¶ã€‚è¡¨ç¤ºè¯¥çª—å£ä¸ºæ‚¬æµ®çª—å£            if (lp.width == ViewGroup.LayoutParams.WRAP_CONTENT                    || lp.height == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;                // æ ‡è®°ä¸€ä¸‹ï¼ŒWMSå•æ–¹é¢æ”¹å˜äº†ä¸€äº›å‚æ•°                windowSizeMayChange = true;                if (shouldUseDisplaySize(lp)) &#123;                    // NOTE -- system code, won&#39;t try to do compat mode.                    Point size = new Point();                    mDisplay.getRealSize(size);                    desiredWindowWidth = size.x;                    desiredWindowHeight = size.y;                &#125; else &#123;                    Configuration config = res.getConfiguration();                    desiredWindowWidth = dipToPx(config.screenWidthDp);                    desiredWindowHeight = dipToPx(config.screenHeightDp);                &#125;            &#125;        &#125;        // æµ‹é‡        windowSizeMayChange |= measureHierarchy(host, lp, res,                desiredWindowWidth, desiredWindowHeight);    &#125;    ...    if (layoutRequested) &#123;        // å¦‚æœåé¢è¿˜æœ‰layoutçš„è¯·æ±‚çš„è¯ï¼Œç”¨è¿™ä¸ªFLAGæ¥æ ‡è®°ï¼Œç„¶åå†é‡æ–°æ¥ä¸€æ¬¡layout        // æ‰€ä»¥ç°åœ¨å…ˆç½®ä¸ºfalse        mLayoutRequested = false;    &#125;    boolean windowShouldResize = layoutRequested &amp;&amp; windowSizeMayChange        &amp;&amp; ((mWidth != host.getMeasuredWidth() || mHeight != host.getMeasuredHeight())            || (lp.width == ViewGroup.LayoutParams.WRAP_CONTENT &amp;&amp;                    frame.width() &lt; desiredWindowWidth &amp;&amp; frame.width() != mWidth)            || (lp.height == ViewGroup.LayoutParams.WRAP_CONTENT &amp;&amp;                    frame.height() &lt; desiredWindowHeight &amp;&amp; frame.height() != mHeight));    windowShouldResize |= mDragResizing &amp;&amp; mResizeMode == RESIZE_MODE_FREEFORM;    ...    // I. pre-measureé˜¶æ®µç»“æŸ    // II. çª—å£layouté˜¶æ®µ    if (mFirst || windowShouldResize || insetsChanged ||            viewVisibilityChanged || params != null || mForceNextWindowRelayout) &#123;        ...        boolean hadSurface = mSurface.isValid();        try &#123;            ...            relayoutResult = relayoutWindow(params, viewVisibility, insetsPending);            ...        &#125; catch (RemoteException e) &#123;        &#125;        ...        // II. çª—å£layouté˜¶æ®µç»“æŸ        // III. measureé˜¶æ®µ        if (!mStopped || mReportNextDraw) &#123;            boolean focusChangedDueToTouchMode = ensureTouchModeLocally(                    (relayoutResult&amp;WindowManagerGlobal.RELAYOUT_RES_IN_TOUCH_MODE) != 0);            if (focusChangedDueToTouchMode || mWidth != host.getMeasuredWidth()                    || mHeight != host.getMeasuredHeight() || contentInsetsChanged ||                    updatedConfiguration) &#123;                int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);                int childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);                if (DEBUG_LAYOUT) Log.v(mTag, &quot;Ooops, something changed!  mWidth=&quot;                        + mWidth + &quot; measuredWidth=&quot; + host.getMeasuredWidth()                        + &quot; mHeight=&quot; + mHeight                        + &quot; measuredHeight=&quot; + host.getMeasuredHeight()                        + &quot; coveredInsetsChanged=&quot; + contentInsetsChanged);                // è¿™é‡Œå…¶å®å°±æ˜¯è°ƒç”¨äº†View.measure()æ–¹æ³•                performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);                // Implementation of weights from WindowManager.LayoutParams                // We just grow the dimensions as needed and re-measure if                // needs be                int width = host.getMeasuredWidth();                int height = host.getMeasuredHeight();                boolean measureAgain = false;                if (lp.horizontalWeight &gt; 0.0f) &#123;                    width += (int) ((mWidth - width) * lp.horizontalWeight);                    childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(width,                            MeasureSpec.EXACTLY);                    measureAgain = true;                &#125;                if (lp.verticalWeight &gt; 0.0f) &#123;                    height += (int) ((mHeight - height) * lp.verticalWeight);                    childHeightMeasureSpec = MeasureSpec.makeMeasureSpec(height,                            MeasureSpec.EXACTLY);                    measureAgain = true;                &#125;                if (measureAgain) &#123;                    if (DEBUG_LAYOUT) Log.v(mTag,                            &quot;And hey let&#39;s measure once more: width=&quot; + width                            + &quot; height=&quot; + height);                    performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);                &#125;                layoutRequested = true;            &#125;        &#125;    &#125; else &#123;        // Not the first pass and no window/insets/visibility change but the window        // may have moved and we need check that and if so to update the left and right        // in the attach info. We translate only the window frame since on window move        // the window manager tells us only for the new frame but the insets are the        // same and we do not want to translate them more than once.        maybeHandleWindowMove(frame);    &#125;    if (surfaceSizeChanged) &#123;        updateBoundsSurface();    &#125;    // III. measureé˜¶æ®µç»“æŸ    // IV. layouté˜¶æ®µå¼€å§‹    final boolean didLayout = layoutRequested &amp;&amp; (!mStopped || mReportNextDraw);    ...    if (didLayout) &#123;        // è¿›è¡Œlayoutè¿‡ç¨‹        performLayout(lp, mWidth, mHeight);        // By this point all views have been sized and positioned        // We can compute the transparent area        if ((host.mPrivateFlags &amp; View.PFLAG_REQUEST_TRANSPARENT_REGIONS) != 0) &#123;            // start out transparent            // TODO: AVOID THAT CALL BY CACHING THE RESULT?            host.getLocationInWindow(mTmpLocation);            mTransparentRegion.set(mTmpLocation[0], mTmpLocation[1],                    mTmpLocation[0] + host.mRight - host.mLeft,                    mTmpLocation[1] + host.mBottom - host.mTop);            host.gatherTransparentRegion(mTransparentRegion);            if (mTranslator != null) &#123;                mTranslator.translateRegionInWindowToScreen(mTransparentRegion);            &#125;            if (!mTransparentRegion.equals(mPreviousTransparentRegion)) &#123;                mPreviousTransparentRegion.set(mTransparentRegion);                mFullRedrawNeeded = true;                // reconfigure window manager                try &#123;                    mWindowSession.setTransparentRegion(mWindow, mTransparentRegion);                &#125; catch (RemoteException e) &#123;                &#125;            &#125;        &#125;        if (DBG) &#123;            System.out.println(&quot;======================================&quot;);            System.out.println(&quot;performTraversals -- after setFrame&quot;);            host.debug();        &#125;    &#125;    // IV. layouté˜¶æ®µç»“æŸ    // V. drawè¿‡ç¨‹å¼€å§‹    boolean cancelDraw = mAttachInfo.mTreeObserver.dispatchOnPreDraw() || !isViewVisible;    if (!cancelDraw) &#123;        if (mPendingTransitions != null &amp;&amp; mPendingTransitions.size() &gt; 0) &#123;            for (int i = 0; i &lt; mPendingTransitions.size(); ++i) &#123;                mPendingTransitions.get(i).startChangingAnimations();            &#125;            mPendingTransitions.clear();        &#125;        performDraw();    &#125; else &#123;        if (isViewVisible) &#123;            // Try again            scheduleTraversals();        &#125; else if (mPendingTransitions != null &amp;&amp; mPendingTransitions.size() &gt; 0) &#123;            for (int i = 0; i &lt; mPendingTransitions.size(); ++i) &#123;                mPendingTransitions.get(i).endChangingAnimations();            &#125;            mPendingTransitions.clear();        &#125;    &#125;    mIsInTraversal = false;    // V. drawè¿‡ç¨‹ç»“æŸ&#125;</code></pre><p>å¥½å§ï¼Œæˆ‘æ‰¿è®¤ï¼Œè¿™æ˜¯æˆ‘è§è¿‡çš„æœ€é•¿çš„æ–¹æ³•äº†ã€‚åªèƒ½ç»™å®ƒåˆ†ä¸ºå‡ ä¸ªé‡è¦é˜¶æ®µï¼Œå¹¶æç‚¼ä¸€ä¸‹ï¼Œæ— æ³•è¿›è¡Œå¤ªè¯¦ç»†çš„åˆ†æäº†ã€‚</p><p>I. pre-measureé˜¶æ®µ</p><p>è¿™æ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå®ƒä¼šå¯¹æ§ä»¶æ ‘è¿›è¡Œç¬¬ä¸€æ¬¡æµ‹é‡ã€‚åœ¨æ­¤é˜¶æ®µä¸­å°†ä¼šè®¡ç®—å‡ºæ§ä»¶æ ‘ä¸ºæ˜¾ç¤ºå…¶å†…å®¹æ‰€éœ€çš„å°ºå¯¸ï¼Œå³æœŸæœ›çš„çª—å£å°ºå¯¸ã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸­ViewåŠå…¶å­ç±»çš„<code>onMeasure()</code>æ–¹æ³•å°†ä¼šæ²¿ç€æ§ä»¶æ ‘ä¾æ¬¡å¾—åˆ°å›è°ƒã€‚</p><p>é¢„æµ‹é‡ä¹Ÿæ˜¯ä¸€æ¬¡å®Œæ•´çš„æµ‹é‡è¿‡ç¨‹ï¼Œå®ƒä¸æœ€ç»ˆæµ‹é‡çš„åŒºåˆ«ä»…åœ¨äºå‚æ•°ä¸åŒè€Œå·²ã€‚å®é™…çš„æµ‹é‡å·¥ä½œæ˜¯åœ¨Viewæˆ–å…¶å­ç±»çš„<code>onMeasure()</code>æ–¹æ³•ä¸­å®Œæˆï¼Œå¹¶ä¸”å…¶æµ‹é‡ç»“æœéœ€è¦å—é™äºæ¥è‡ªå…¶çˆ¶æ§ä»¶çš„æŒ‡ç¤ºã€‚è¿™ä¸ªæŒ‡ç¤ºç”±<code>onMeasure()</code>æ–¹æ³•ä¸­çš„ä¸¤ä¸ªå‚æ•°è¿›è¡Œä¼ è¾¾ï¼š<code>widthSpec</code>å’Œ<code>heightSpec</code>ã€‚å®ƒä»¬æ˜¯è¢«ç§°ä¸ºMeasureSpecçš„å¤åˆæ•´å‹å˜é‡ï¼Œç”¨äºæŒ‡å¯¼æ§ä»¶å¯¹è‡ªèº«è¿›è¡Œæµ‹é‡ã€‚å®ƒåˆä¸¤ä¸ªåˆ†é‡ï¼Œç»“æ„å¦‚ä¸‹è¡¨ï¼š</p><table class="table is-bordered is-narrow">    <thead>        <tr>            <th><abbr>32, 31</abbr></th>            <th><abbr>30 ... 1</abbr></th>        </tr>    </thead>    <tbody>        <tr>            <td>SPEC_MODE</td>            <td>SPEC_SIZE</td>        </tr>    </tbody></table><p>å…¶å®å°±æ˜¯ä¸ª32ä½çš„æ•´å‹ï¼Œé«˜2ä½ç”¨äºå‚¨å­˜å®ƒçš„ç±»å‹ï¼Œå30ä½ç”¨äºå‚¨å­˜å®ƒçš„å†…å®¹ã€‚</p><p>Iã€IIã€IIIä¸‰ä¸ªé˜¶æ®µå¯çŸ¥é¢„æµ‹é‡æ—¶çš„SPEC_SIZEæŒ‰ç…§å¦‚ä¸‹åŸåˆ™è¿›è¡Œå–å€¼ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡â€œéå†â€æ—¶ï¼Œä½¿ç”¨å¯ç”¨çš„æœ€å¤§å°ºå¯¸ä½œä¸ºSPEC_SIZEçš„å€™é€‰</li><li>æ­¤çª—å£æ˜¯ä¸€ä¸ªæ‚¬æµ®çª—å£æ—¶ï¼Œå³LayoutParams.width/heightå…¶ä¸­ä¹‹ä¸€è¢«æŒ‡å®šä¸ºWRAP_CONTENTæ—¶ï¼Œä½¿ç”¨å¯ç”¨çš„æœ€å¤§å°ºå¯¸ä½œä¸ºSPEC_SIZEçš„å€™é€‰</li><li>å…¶ä»–æƒ…å†µä¸‹ï¼Œä½¿ç”¨çª—å£æœ€æ–°å°ºå¯¸ä½œä¸ºSPEC_SIZEçš„å€™é€‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Framework </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Retrofit å®ç°åŸç†è§£æ</title>
      <link href="/2023-01-31/retrofit/"/>
      <url>/2023-01-31/retrofit/</url>
      
        <content type="html"><![CDATA[<p><a href="https://square.github.io/retrofit/">Retrofit</a> æ˜¯ç°åœ¨æ¯”è¾ƒå¸¸ç”¨çš„ç½‘ç»œè¯·æ±‚åº“äº†ï¼Œå®ƒçš„å¯æ‰©å±•æ€§å¼ºï¼Œåº•å±‚ç½‘ç»œè¯·æ±‚é›†æˆäº† Okhttpï¼Œå¼‚æ­¥å¤„ç†å¯é›†æˆ RxJavaï¼Œå†…å®¹è§£æå¯é›†æˆ Gsonï¼ŒJackson ç­‰ã€‚è€Œä¸”å…¨é¢æ”¯æŒ Restful è¯·æ±‚ï¼Œå¹¶ä¸”é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨ç®€æ´æ–¹ä¾¿ã€‚<br>ç²¾å¦™çš„æºç è®¾è®¡æ¨¡å¼ï¼Œå†…éƒ¨å±‚æ¬¡åˆ†å·¥æ˜ç¡®ï¼Œè§£è€¦æ€§å¼ºã€‚</p><p>å®ƒçš„ä½¿ç”¨æ ¸å¿ƒæ˜¯å®ç°ä¸€ä¸ª Java æ¥å£ï¼Œç”¨æ³¨è§£çš„æ–¹å¼æ¥æŒ‡å®šå„ç§ç½‘ç»œè¯·æ±‚ä¸­çš„å­—æ®µã€æ–¹æ³•ç­‰ã€‚</p><span id="more"></span><p>æ‹¿å®˜ç½‘çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p><h2 id="æ´»ç”Ÿç”Ÿçš„ä¾‹å­"><a href="#æ´»ç”Ÿç”Ÿçš„ä¾‹å­" class="headerlink" title="æ´»ç”Ÿç”Ÿçš„ä¾‹å­"></a>æ´»ç”Ÿç”Ÿçš„ä¾‹å­</h2><pre><code class="java">public interface GitHubService &#123;  @GET(&quot;users/&#123;user&#125;/repos&quot;)  Call&lt;List&lt;Repo&gt;&gt; listRepos(@Path(&quot;user&quot;) String user);&#125;</code></pre><p>ä¸Šé¢çš„ä¾‹å­ï¼Œç”¨äº†ä¸¤ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯<code>@GET</code>å’Œ<code>@Path</code>ï¼Œç”±å­—é¢æ„æ€ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ<code>@GET</code>æ˜¯æŒ‡è¯¥æ–¹æ³•æ˜¯HTTPè¯·æ±‚ä¸­çš„GETæ–¹æ³•ï¼Œ<code>@Path(&quot;user&quot;)</code>æ˜¯æŒ‡å°†è¯·æ±‚URLä¸­çš„<code>&#123;user&#125;</code>éƒ¨åˆ†æ›¿æ¢ä¸ºä¼ å…¥çš„<code>user</code>å‚æ•°ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæ³¨è§£çš„æºç ï¼š</p><pre><code class="java">// retrofit2.http.GET.java/** Make a GET request. */@Documented@Target(METHOD)@Retention(RUNTIME)public @interface GET &#123;  /**   * A relative or absolute path, or full URL of the endpoint. This value is optional if the first   * parameter of the method is annotated with &#123;@link Url @Url&#125;.   * &lt;p&gt;   * See &#123;@linkplain retrofit2.Retrofit.Builder#baseUrl(HttpUrl) base URL&#125; for details of how   * this is resolved against a base URL to create the full endpoint URL.   */  String value() default &quot;&quot;;&#125;</code></pre><p>å®ƒä½¿ç”¨äº†ä¸‰ä¸ªå…ƒæ³¨è§£ï¼Œä¸å†å¤šè§£é‡Šã€‚å®ƒçš„<code>value</code>æŒ‡çš„æ˜¯è¯·æ±‚ä¸­çš„ç»å¯¹/ç›¸å¯¹è·¯å¾„ã€‚</p><pre><code class="java">// retrofit2.http.Path.java@Documented@Retention(RUNTIME)@Target(PARAMETER)public @interface Path &#123;  String value();  /**   * Specifies whether the argument value to the annotated method parameter is already URL encoded.   */  boolean encoded() default false;&#125;</code></pre><p>å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯valueï¼Œä¸€ä¸ªæ˜¯æ˜¯å¦å·²ç»ç»è¿‡URL encodedã€‚</p><p>é‚£ä¹ˆï¼Œretrofitæ˜¯å¦‚ä½•å°†æ³¨è§£ä½¿ç”¨èµ·æ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„åŸç†ã€‚</p><h2 id="Retrofit-å®ç°åŸç†"><a href="#Retrofit-å®ç°åŸç†" class="headerlink" title="Retrofit å®ç°åŸç†"></a>Retrofit å®ç°åŸç†</h2><p>å…ˆä¸Šä¸€å¼ å›¾ï¼Œç®€å•äº†è§£ä¸€ä¸‹å®ƒçš„æ•´ä½“æµç¨‹ï¼š</p><p><img src="/img/27.png"></p><p>åœ¨åˆ›å»ºRetrofitå®ä¾‹æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŒ‰ç…§ä¸‹é¢çš„æ–¹å¼æ¥åˆ›å»ºå®ä¾‹ï¼š</p><pre><code class="java">Retrofit retrofit = new Retrofit.Builder()    .baseUrl(&quot;https://api.github.com/&quot;)    .build();GitHubService service = retrofit.create(GitHubService.class);</code></pre><p><code>build()</code>æ–¹æ³•å…¶å®å°±æ˜¯Javaä¸­æ¯”è¾ƒå…¸å‹çš„Builderè®¾è®¡æ¨¡å¼ï¼Œä¸è¿‡å¤šè§£é‡Šï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹<code>create()</code>çš„æºä»£ç ï¼š</p><pre><code class="java">// retrofit2.Retrofit.java@SuppressWarnings(&quot;unchecked&quot;)public &lt;T&gt; T create(final Class&lt;T&gt; service) &#123;    // æ£€æŸ¥æ¥å£å¯ç”¨æ€§    validateServiceInterface(service);    // ä½¿ç”¨åŠ¨æ€ä»£ç†çš„æ–¹å¼åˆ›å»ºä¸€ä¸ª service çš„å®ä¾‹    return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class&lt;?&gt;[] &#123; service &#125;,        new InvocationHandler() &#123;            private final Platform platform = Platform.get();            private final Object[] emptyArgs = new Object[0];            @Override public @Nullable Object invoke(Object proxy, Method method,                @Nullable Object[] args) throws Throwable &#123;                // å¦‚æœ method æ˜¯ Object çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æ­£å¸¸è°ƒç”¨                if (method.getDeclaringClass() == Object.class) &#123;                    return method.invoke(this, args);                &#125;                // ä¸€èˆ¬æƒ…å†µä¸‹ Android çš„ Platform.isDefaultMethod() éƒ½ä¼šè¿”å› false                if (platform.isDefaultMethod(method)) &#123;                    return platform.invokeDefaultMethod(method, service, proxy, args);                &#125;                // æ‰€ä»¥çœŸæ­£èµ·ä½œç”¨çš„ï¼Œè¿˜æ˜¯è¿™ä¸€å¥                return loadServiceMethod(method).invoke(args != null ? args : emptyArgs);            &#125;        &#125;    );&#125;</code></pre><p>æˆ‘ä»¬ä»è¿™å‡ è¡Œä»£ç å¯ä»¥çœ‹å‡ºï¼ŒRetrofit æ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†çš„æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªå®ç°serviceæ¥å£çš„å¯¹è±¡ï¼Œå½“å¤–éƒ¨è°ƒç”¨ service æ¥å£æ–¹æ³•ï¼Œä¼šè°ƒç”¨invokeæ–¹æ³•ï¼Œç„¶ååŠ è½½å½“å‰ method å¯¹åº”çš„ ServiceMethodï¼Œå¹¶è°ƒç”¨è¯¥ ServiceMethod çš„ invokeã€‚ServiceMethod æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº† ServiceMethod æŸä¸€ä¸ªå®ç°ç±»çš„ invoke æ–¹æ³•ã€‚å…·ä½“çš„æˆ‘ä»¬ä¼šåœ¨åé¢åˆ†æã€‚</p><p>å…ˆçœ‹çœ‹<code>validateServiceInterface()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// retrofit2.Retrofit.javaprivate void validateServiceInterface(Class&lt;?&gt; service) &#123;    if (!service.isInterface()) &#123;      throw new IllegalArgumentException(&quot;API declarations must be interfaces.&quot;);    &#125;    // Dequeæ˜¯Java1.6ä¹‹ååŠ å…¥çš„ã€åŒå‘é˜Ÿåˆ—ã€ï¼Œä¹Ÿå³èƒ½ä»ä¸¤ä¸ªæ–¹å‘å‘å¤–æ‹¿å‡ºæ•°æ®    Deque&lt;Class&lt;?&gt;&gt; check = new ArrayDeque&lt;&gt;(1);    check.add(service);    while (!check.isEmpty()) &#123;        // è·å–è¯¥serviceçš„ç±»        Class&lt;?&gt; candidate = check.removeFirst();        // getTypeParameters() æ–¹æ³•ç”¨äºè·å–è¯¥ç±»çš„å£°æ˜ä¸­çš„å‚æ•°åˆ—è¡¨        // è¿™é‡Œè¦ä¿è¯è¿™ä¸ªæ¥å£ç±»æ²¡æœ‰ä»»ä½•çš„å‚æ•°        if (candidate.getTypeParameters().length != 0) &#123;            StringBuilder message = new StringBuilder(&quot;Type parameters are unsupported on &quot;)                .append(candidate.getName());            if (candidate != service) &#123;                message.append(&quot; which is an interface of &quot;)                    .append(service.getName());                        throw new IllegalArgumentException(message.toString());        &#125;        // å°†è¯¥serviceä¸‹æ‰€æœ‰çš„æ¥å£æ·»åŠ åˆ°checkä¸­        Collections.addAll(check, candidate.getInterfaces());    &#125;    // å¦‚æœé…ç½®äº†validateEagerlyï¼Œåˆ™æå‰åŠ è½½ method å¯¹åº”çš„ ServiceMethodã€‚    // æ­¤å¤„è°ƒç”¨ loadServiceMethod() æ–¹æ³•ï¼Œå…¶å®æ˜¯åœ¨åšä¸€ä¸ªé¢„å¤„ç†çš„æ“ä½œï¼Œåªæ˜¯æå‰åˆ›å»ºäº†ä¸€äº› ServiceMethod å¯¹è±¡åœ¨ç¼“å­˜ä¸­ã€‚    if (validateEagerly) &#123;        Platform platform = Platform.get();        for (Method method : service.getDeclaredMethods()) &#123;            if (!platform.isDefaultMethod(method) &amp;&amp; !Modifier.isStatic(method.getModifiers())) &#123;                loadServiceMethod(method);            &#125;        &#125;    &#125;&#125;</code></pre><p>æ¥ä¸‹æ¥çœ‹çœ‹åœ¨<code>create()</code>å’Œ<code>validateServiceInterface()</code>éƒ½ä¼šè°ƒç”¨åˆ°çš„<code>loadServiceMethod()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// æ‰€æœ‰çš„ Method éƒ½è¢«å­˜åœ¨ä¸€ä¸ª ConcurrentHashMap ä¸­ï¼Œé¿å…åŒæ­¥é—®é¢˜private final Map&lt;Method, ServiceMethod&lt;?&gt;&gt; serviceMethodCache = new ConcurrentHashMap&lt;&gt;();// è¯¥æ–¹æ³•çš„ä¸»è¦ç›®çš„æœ‰ä¸¤ä¸ªï¼š// 1. è§£æè¯¥ method ä¸Šçš„æ‰€æœ‰æ³¨è§£ï¼Œå¹¶ä»¥ method - ServiceMethod çš„å½¢å¼æ”¾å…¥ç¼“å­˜ä¸­ï¼Œç­‰å¾…è°ƒç”¨// 2. æ ¹æ®è¯¥ method æ‰¾åˆ°å¯¹åº”çš„ ServiceMethodï¼Œå¹¶è¿”å›ServiceMethod&lt;?&gt; loadServiceMethod(Method method) &#123;    ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);    if (result != null) return result;    synchronized (serviceMethodCache) &#123;      result = serviceMethodCache.get(method);      if (result == null) &#123;        // æ­¤å¤„ result å·²ç»æ˜¯ ServiceMethod å®ç°ç±» HttpSercieMethod çš„å®ä¾‹        result = ServiceMethod.parseAnnotations(this, method);        serviceMethodCache.put(method, result);      &#125;    &#125;    return result;&#125;</code></pre><p>ServiceMethod æ˜¯ Retrofit çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æºä»£ç ï¼š</p><pre><code class="java">// retrofit2.ServiceMethod.javaabstract class ServiceMethod&lt;T&gt; &#123;    static &lt;T&gt; ServiceMethod&lt;T&gt; parseAnnotations(Retrofit retrofit, Method method) &#123;        RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method);        Type returnType = method.getGenericReturnType();        if (Utils.hasUnresolvableType(returnType)) &#123;            throw methodError(method,                &quot;Method return type must not include a type variable or wildcard: %s&quot;, returnType);        &#125;        if (returnType == void.class) &#123;            throw methodError(method, &quot;Service methods cannot return void.&quot;);        &#125;        return HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory);    &#125;    abstract @Nullable T invoke(Object[] args);&#125;</code></pre><p>RequestFactoryæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªç±»ï¼Œå®ƒè´Ÿè´£è§£ææ³¨è§£ã€æ„é€  request ç­‰ï¼Œåœ¨åé¢ä¼šç›´æ¥ä¸okhttpè¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š</p><pre><code class="java">final class RequestFactory &#123;    static RequestFactory parseAnnotations(Retrofit retrofit, Method method) &#123;        return new Builder(retrofit, method).build();    &#125;    // å‚¨å­˜ request çš„ä¸€äº›æ•°æ®    private final Method method;    private final HttpUrl baseUrl;    final String httpMethod;    private final @Nullable String relativeUrl;    private final @Nullable Headers headers;    private final @Nullable MediaType contentType;    private final boolean hasBody;    private final boolean isFormEncoded;    private final boolean isMultipart;    private final ParameterHandler&lt;?&gt;[] parameterHandlers;    final boolean isKotlinSuspendFunction;    ...    /**     * æ£€æŸ¥æ¥å£ä¸­æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼Œæ¥æ„é€ ä¸€ä¸ªå¯å¤ç”¨çš„ service æ–¹æ³•ã€‚     * è¿™ä¸ªæ“ä½œéœ€è¦è°ƒç”¨åå°„æœºåˆ¶ï¼Œæ‰€ä»¥æ¯ä¸ª service æ–¹æ³•æœ€å¥½åªæ„é€ ä¸€æ¬¡ï¼Œç„¶åå¤ç”¨ä¹‹ã€‚     * Builder ä¸èƒ½å¤ç”¨ã€‚     */    static final class Builder &#123;        private static final String PARAM = &quot;[a-zA-Z][a-zA-Z0-9_-]*&quot;;        private static final Pattern PARAM_URL_REGEX = Pattern.compile(&quot;\\&#123;(&quot; + PARAM + &quot;)\\&#125;&quot;);        private static final Pattern PARAM_NAME_REGEX = Pattern.compile(PARAM);        ...        Builder(Retrofit retrofit, Method method) &#123;            this.retrofit = retrofit;            this.method = method;            // è·å–æ–¹æ³•ä¸Šçš„æ³¨è§£            this.methodAnnotations = method.getAnnotations();            // è·å–æ–¹æ³•ä¸Šçš„å‚æ•°ç±»å‹            this.parameterTypes = method.getGenericParameterTypes();            // è·å–å‚æ•°ä¸Šçš„æ³¨è§£            this.parameterAnnotationsArray = method.getParameterAnnotations();        &#125;        RequestFactory build() &#123;            // è§£æ method ä¸Šçš„æ‰€æœ‰æ³¨è§£            for (Annotation annotation : methodAnnotations) &#123;                parseMethodAnnotation(annotation);            &#125;            ...            // å„ç§ method æ³¨è§£çš„æ£€æŸ¥            ...            // è§£æ paremater ä¸Šçš„æ‰€æœ‰æ³¨è§£            int parameterCount = parameterAnnotationsArray.length;            parameterHandlers = new ParameterHandler&lt;?&gt;[parameterCount];            for (int p = 0, lastParameter = parameterCount - 1; p &lt; parameterCount; p++) &#123;                // å¹¶æ·»åŠ åˆ°ä¸€ä¸ª ParamaterHandler çš„ Array ä¸­                parameterHandlers[p] =                    parseParameter(p, parameterTypes[p], parameterAnnotationsArray[p], p == lastParameter);            &#125;            ...            // å„ç§ parameter æ³¨è§£çš„æ£€æŸ¥            ...            return new RequestFactory(this);        &#125;    &#125;    // è§£æ method ä¸Šçš„æ³¨è§£    private void parseMethodAnnotation(Annotation annotation) &#123;        ...        // è¿™é‡Œçš„ DELETE GET ç­‰ï¼Œéƒ½æ˜¯ retrofit è‡ªå®šä¹‰çš„å„ç§ Http è¯·æ±‚ç±»å‹çš„æ³¨è§£        if (annotation instanceof DELETE) &#123;            parseHttpMethodAndPath(&quot;DELETE&quot;, ((DELETE) annotation).value(), false);        &#125; else if (annotation instanceof GET) &#123;            parseHttpMethodAndPath(&quot;GET&quot;, ((GET) annotation).value(), false);        &#125; ...    &#125;    // è§£æ method ä¸Šæ³¨è§£çš„è¯¦ç»†æ•°æ®    private void parseHttpMethodAndPath(String httpMethod, String value, boolean hasBody) &#123;        if (this.httpMethod != null) &#123;            throw methodError(method, &quot;Only one HTTP method is allowed. Found: %s and %s.&quot;,                this.httpMethod, httpMethod);        &#125;        this.httpMethod = httpMethod;        this.hasBody = hasBody;        if (value.isEmpty()) &#123;            return;        &#125;        // è·å– URL çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœæœ‰ ? å‚æ•°çš„è¯ï¼Œå°±è·å–ä¸€ä¸‹        int question = value.indexOf(&#39;?&#39;);        if (question != -1 &amp;&amp; question &lt; value.length() - 1) &#123;            // Ensure the query string does not have any named parameters.            String queryParams = value.substring(question + 1);            Matcher queryParamMatcher = PARAM_URL_REGEX.matcher(queryParams);            if (queryParamMatcher.find()) &#123;            throw methodError(method, &quot;URL query string \&quot;%s\&quot; must not have replace block. &quot;                + &quot;For dynamic query parameters use @Query.&quot;, queryParams);            &#125;        &#125;        // æ‹¿åˆ°æ³¨è§£ä¸­çš„ valueï¼Œæ­¤ä¸º relativeUrl        this.relativeUrl = value;        // è§£æå‚æ•°ä»¬        this.relativeUrlParamNames = parsePathParameters(value);    &#125;    // è§£æå‚æ•°    private @Nullable ParameterHandler&lt;?&gt; parseParameter(        int p, Type parameterType, @Nullable Annotation[] annotations, boolean allowContinuation) &#123;        ParameterHandler&lt;?&gt; result = null;        if (annotations != null) &#123;            for (Annotation annotation : annotations) &#123;                // è§£æå‚æ•°çš„æ³¨è§£                ParameterHandler&lt;?&gt; annotationAction =                    parseParameterAnnotation(p, parameterType, annotations, annotation);                if (annotationAction == null) &#123;                    continue;                &#125;                if (result != null) &#123;                    throw parameterError(method, p,                        &quot;Multiple Retrofit annotations found, only one allowed.&quot;);                &#125;                result = annotationAction;            &#125;        &#125;        if (result == null) &#123;            if (allowContinuation) &#123;                try &#123;                    if (Utils.getRawType(parameterType) == Continuation.class) &#123;                        isKotlinSuspendFunction = true;                        return null;                    &#125;                &#125; catch (NoClassDefFoundError ignored) &#123;                &#125;            &#125;            throw parameterError(method, p, &quot;No Retrofit annotation found.&quot;);        &#125;        return result;    &#125;    @Nullable    private ParameterHandler&lt;?&gt; parseParameterAnnotation(        int p, Type type, Annotation[] annotations, Annotation annotation) &#123;        // è¿™é‡Œçš„ Url Path Query ç­‰ï¼Œæ˜¯ retrofit è‡ªå®šä¹‰çš„æ³¨è§£ï¼Œé€šè¿‡å­—ç¬¦ä¸²è§£æç­‰å„ç§æ–¹å¼ï¼Œæ¥ç»„æˆæ­£ç¡®çš„ ParameterHandler        if (annotation instanceof Url) &#123;            ...            return new ParameterHandler.RelativeUrl(method, p);            ...        &#125; else if (annotation instanceof Path) &#123;            ...            return new ParameterHandler.Path&lt;&gt;(method, p, name, converter, path.encoded());            ...        &#125; else if (annotation instanceof Query) &#123;            // æ³¨æ„ä¸‰ç§ä¸åŒçš„è¿”å›å€¼            Class&lt;?&gt; rawParameterType = Utils.getRawType(type);            gotQuery = true;            if (Iterable.class.isAssignableFrom(rawParameterType)) &#123;                if (!(type instanceof ParameterizedType)) &#123;                    throw parameterError(method, p, rawParameterType.getSimpleName()                        + &quot; must include generic type (e.g., &quot;                        + rawParameterType.getSimpleName()                        + &quot;&lt;String&gt;)&quot;);                &#125;                ParameterizedType parameterizedType = (ParameterizedType) type;                Type iterableType = Utils.getParameterUpperBound(0, parameterizedType);                Converter&lt;?, String&gt; converter =                    retrofit.stringConverter(iterableType, annotations);                return new ParameterHandler.Query&lt;&gt;(name, converter, encoded).iterable();            &#125; else if (rawParameterType.isArray()) &#123;                Class&lt;?&gt; arrayComponentType = boxIfPrimitive(rawParameterType.getComponentType());                Converter&lt;?, String&gt; converter =                    retrofit.stringConverter(arrayComponentType, annotations);                return new ParameterHandler.Query&lt;&gt;(name, converter, encoded).array();            &#125; else &#123;                Converter&lt;?, String&gt; converter =                    retrofit.stringConverter(type, annotations);                return new ParameterHandler.Query&lt;&gt;(name, converter, encoded);            &#125;        &#125; else if (annotation instanceof Header) &#123;            ...            return new ParameterHandler.Header&lt;&gt;(name, converter);            ...        &#125; else if (annotation instanceof Field) &#123;            ...            return new ParameterHandler.Field&lt;&gt;(name, converter, encoded);            ...        &#125; else if (annotation instanceof Body) &#123;            ...            return new ParameterHandler.Body&lt;&gt;(method, p, converter);        &#125;        ...        return null; // Not a Retrofit annotation.    &#125;&#125;</code></pre><p>ä»è¿™å‡ éƒ¨åˆ†ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæœ€åRequestFactoryçš„å®ä¾‹ä¸­ï¼ŒåŒ…å«çš„æ˜¯ï¼š</p><ul><li>HTTP è¯·æ±‚çš„ BaseUrl</li><li>HTTP è¯·æ±‚çš„ RelativeUrl</li><li>HTTP è¯·æ±‚çš„æ–¹æ³•</li><li>HTTP è¯·æ±‚çš„å‚æ•°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰</li><li>HTTP è¯·æ±‚çš„ Bodyï¼ˆå¯é€‰ï¼‰</li><li>HTTP è¯·æ±‚çš„ Headersï¼ˆå¯é€‰ï¼‰</li><li>ParameterHandler çš„ Array</li></ul><p>è¿™ParameterHandleræ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// retrofit2.ParameterHandler.javaabstract class ParameterHandler&lt;T&gt; &#123;    abstract void apply(RequestBuilder builder, @Nullable T value) throws IOException;    final ParameterHandler&lt;Iterable&lt;T&gt;&gt; iterable() &#123;        return new ParameterHandler&lt;Iterable&lt;T&gt;&gt;() &#123;            @Override void apply(RequestBuilder builder, @Nullable Iterable&lt;T&gt; values)                throws IOException &#123;                if (values == null) return; // Skip null values.                for (T value : values) &#123;                    ParameterHandler.this.apply(builder, value);                &#125;            &#125;        &#125;;    &#125;    final ParameterHandler&lt;Object&gt; array() &#123;        return new ParameterHandler&lt;Object&gt;() &#123;            @Override void apply(RequestBuilder builder, @Nullable Object values) throws IOException &#123;                if (values == null) return; // Skip null values.                for (int i = 0, size = Array.getLength(values); i &lt; size; i++) &#123;                    //noinspection unchecked                    ParameterHandler.this.apply(builder, (T) Array.get(values, i));                &#125;            &#125;        &#125;;    &#125;    // ä¸€ä¸ª ParameterHandlerçš„å…·ä½“å®ç°ç±»    // åŒ…å« Method å’Œ index    static final class RelativeUrl extends ParameterHandler&lt;Object&gt; &#123;        private final Method method;        private final int p;        RelativeUrl(Method method, int p) &#123;            this.method = method;            this.p = p;        &#125;        @Override void apply(RequestBuilder builder, @Nullable Object value) &#123;            if (value == null) &#123;                throw Utils.parameterError(method, p, &quot;@Url parameter is null.&quot;);            &#125;            builder.setRelativeUrl(value);        &#125;    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€ç§ retrofit è‡ªå®šä¹‰çš„æ³¨è§£ï¼ˆGETã€POSTã€FIELDã€Pathï¼‰ç­‰ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬åŒ–æˆä¸€ä¸ª ParameterHandler çš„å®ä¾‹ï¼Œå¹¶å®ç° <code>apply()</code> æ–¹æ³•ã€‚<code>apply()</code>æ–¹æ³•ä¸­ä¼šä¼ å…¥ RequestBuild çš„å®ä¾‹ï¼Œè¿™æ˜¯äº§ç”Ÿ Request çš„å€’æ•°ç¬¬äºŒæ­¥ã€‚</p><p>å¥½ï¼Œè¯´äº†è¿™ä¹ˆä¸€å¤§åœˆï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—å›åˆ° ServiceMethod ç±»ä¸­ã€‚</p><p>ç”Ÿæˆäº† RequestFactory å®ä¾‹åï¼Œåˆ©ç”¨è¿™ä¸ªå®ä¾‹ï¼Œåˆè°ƒç”¨äº† <code>HttpServiceMethod.parseAnnotations()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼Œä»¥åŠå…¶åŒ…å«çš„æ–¹æ³•ï¼š</p><pre><code class="java">// retrofit2.HttpServiceMethod.java/** Adapts an invocation of an interface method into an HTTP call. */// è¿™æ˜¯ ServiceMethod çš„å”¯ä¸€å®ç°ç±»abstract class HttpServiceMethod&lt;ResponseT, ReturnT&gt; extends ServiceMethod&lt;ReturnT&gt; &#123;            static &lt;ResponseT, ReturnT&gt; HttpServiceMethod&lt;ResponseT, ReturnT&gt; parseAnnotations(        Retrofit retrofit, Method method, RequestFactory requestFactory) &#123;        boolean isKotlinSuspendFunction = requestFactory.isKotlinSuspendFunction;        boolean continuationWantsResponse = false;        boolean continuationBodyNullable = false;        Annotation[] annotations = method.getAnnotations();        Type adapterType;        ...        // â¶ ä¸€ä¸ªæ¯”è¾ƒæ ¸å¿ƒçš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ retrofit çš„çµé­‚æ‰€åœ¨ï¼Œæˆ‘ä»¬åœ¨åé¢è¦è¯¦ç»†è§£é‡Š        CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter =            createCallAdapter(retrofit, method, adapterType, annotations);        Type responseType = callAdapter.responseType();                ...        // å„ç§æ£€æŸ¥        ...        // â· retrofit çš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€Convertersã€ï¼Œå¯ä»¥è‡ªåŠ¨ååºåˆ—åŒ–è¿”å›çš„æ•°æ®        Converter&lt;ResponseBody, ResponseT&gt; responseConverter =            createResponseConverter(retrofit, method, responseType);        okhttp3.Call.Factory callFactory = retrofit.callFactory;                if (!isKotlinSuspendFunction) &#123;            return new CallAdapted&lt;&gt;(requestFactory, callFactory, responseConverter, callAdapter);        &#125; else if (continuationWantsResponse) &#123;            // ä¸ kotlin åç¨‹æœ‰å…³çš„ä¸€äº›ä¸œè¥¿ï¼Œåé¢å†è®²            // noinspection unchecked Kotlin compiler guarantees ReturnT to be Object.            return (HttpServiceMethod&lt;ResponseT, ReturnT&gt;) new SuspendForResponse&lt;&gt;(requestFactory,                callFactory, responseConverter, (CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt;) callAdapter);        &#125; else &#123;            // ä¸ kotlin åç¨‹æœ‰å…³çš„ä¸€äº›ä¸œè¥¿ï¼Œåé¢å†è®²            // noinspection unchecked Kotlin compiler guarantees ReturnT to be Object.            return (HttpServiceMethod&lt;ResponseT, ReturnT&gt;) new SuspendForBody&lt;&gt;(requestFactory,                callFactory, responseConverter, (CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt;) callAdapter,                continuationBodyNullable);        &#125;    &#125;    private static &lt;ResponseT, ReturnT&gt; CallAdapter&lt;ResponseT, ReturnT&gt; createCallAdapter(        Retrofit retrofit, Method method, Type returnType, Annotation[] annotations) &#123;        try &#123;            // noinspection unchecked            return (CallAdapter&lt;ResponseT, ReturnT&gt;) retrofit.callAdapter(returnType, annotations);        &#125; catch (RuntimeException e) &#123; // Wide exception range because factories are user code.            throw methodError(method, e, &quot;Unable to create call adapter for %s&quot;, returnType);        &#125;    &#125;    private static &lt;ResponseT&gt; Converter&lt;ResponseBody, ResponseT&gt; createResponseConverter(        Retrofit retrofit, Method method, Type responseType) &#123;        Annotation[] annotations = method.getAnnotations();        try &#123;            return retrofit.responseBodyConverter(responseType, annotations);        &#125; catch (RuntimeException e) &#123; // Wide exception range because factories are user code.            throw methodError(method, e, &quot;Unable to create converter for %s&quot;, responseType);        &#125;    &#125;    // åœ¨ Retrofit.create() æ–¹æ³•çš„æœ€åä¸€å¥ï¼Œè°ƒç”¨çš„ invoke()ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨çš„è¿™é‡Œ    @Override final @Nullable ReturnT invoke(Object[] args) &#123;        Call&lt;ResponseT&gt; call = new OkHttpCall&lt;&gt;(requestFactory, args, callFactory, responseConverter);        return adapt(call, args);    &#125;    // æŠ½è±¡æ–¹æ³•ï¼Œç”± CallAdaptedã€SuspendForResponseã€SuspendForBody æ¥å®ç°    protected abstract @Nullable ReturnT adapt(Call&lt;ResponseT&gt; call, Object[] args);    static final class CallAdapted&lt;ResponseT, ReturnT&gt; extends HttpServiceMethod&lt;ResponseT, ReturnT&gt; &#123;        private final CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter;        CallAdapted(RequestFactory requestFactory, okhttp3.Call.Factory callFactory,            Converter&lt;ResponseBody, ResponseT&gt; responseConverter,            CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter) &#123;        super(requestFactory, callFactory, responseConverter);            this.callAdapter = callAdapter;        &#125;        @Override protected ReturnT adapt(Call&lt;ResponseT&gt; call, Object[] args) &#123;            return callAdapter.adapt(call);        &#125;    &#125;    static final class SuspendForResponse&lt;ResponseT&gt; extends HttpServiceMethod&lt;ResponseT, Object&gt; &#123;        private final CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt; callAdapter;        SuspendForResponse(RequestFactory requestFactory, okhttp3.Call.Factory callFactory,            Converter&lt;ResponseBody, ResponseT&gt; responseConverter,            CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt; callAdapter) &#123;        super(requestFactory, callFactory, responseConverter);            this.callAdapter = callAdapter;        &#125;        @Override protected Object adapt(Call&lt;ResponseT&gt; call, Object[] args) &#123;            call = callAdapter.adapt(call);            //noinspection unchecked Checked by reflection inside RequestFactory.            Continuation&lt;Response&lt;ResponseT&gt;&gt; continuation =                (Continuation&lt;Response&lt;ResponseT&gt;&gt;) args[args.length - 1];            // See SuspendForBody for explanation about this try/catch.            try &#123;                return KotlinExtensions.awaitResponse(call, continuation);            &#125; catch (Exception e) &#123;                return KotlinExtensions.suspendAndThrow(e, continuation);            &#125;        &#125;    &#125;&#125;</code></pre><p>HttpServiceMethodç±»çš„ä¸»è¦åŠŸèƒ½ï¼Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ª CallAdapter å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ç”¨æ¥æŠŠ OkHttpCall é€‚é…ä¸ºæˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•çš„è¿”å›å€¼ç±»å‹çš„ï¼›åˆ›å»º Converter å¯¹è±¡ï¼Œç”¨äºæŠŠ ResponseBody è½¬æ¢ä¸ºæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„ç±»å‹ï¼›ç”Ÿæˆ HttpServiceMethod çš„ä¸‰ç§æ´¾ç”Ÿç±»å…¶ä¸­ä¸€ç§çš„å®ä¾‹ï¼Œè¿”å›å¹¶æ”¾åˆ° serviceMethodCashe ä¸­ã€‚</p><p>ä¸Šé¢çš„ä»£ç ä¸­æœ‰ä¸¤å¤„æ¯”è¾ƒé‡è¦çš„åœ°æ–¹ï¼Œç”¨åºå·æ ‡æ³¨äº†å‡ºæ¥ï¼Œæˆ‘ä»¬æ¥å•ç‹¬è®²è®²ï¼š</p><h2 id="çµé­‚-â¶-CallAdapter"><a href="#çµé­‚-â¶-CallAdapter" class="headerlink" title="çµé­‚ â¶ CallAdapter"></a>çµé­‚ â¶ CallAdapter</h2><p>è·Ÿç€<code>retrofit.callAdapter()</code>å‘ä¸‹èµ°ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// retrofit2.Retrofit.javapublic CallAdapter&lt;?, ?&gt; callAdapter(Type returnType, Annotation[] annotations) &#123;    return nextCallAdapter(null, returnType, annotations);&#125;public CallAdapter&lt;?, ?&gt; nextCallAdapter(@Nullable CallAdapter.Factory skipPast, Type returnType,      Annotation[] annotations) &#123;    ...    // callAdapterFactories åœ¨ Builder.build() ä¸­æ·»åŠ ï¼Œè§ä¸‹    int start = callAdapterFactories.indexOf(skipPast) + 1;    for (int i = start, count = callAdapterFactories.size(); i &lt; count; i++) &#123;        CallAdapter&lt;?, ?&gt; adapter = callAdapterFactories.get(i).get(returnType, annotations, this);        if (adapter != null) &#123;            return adapter;        &#125;    &#125;    // å¦‚æœåœ¨ä¸Šé¢è¿˜æ²¡æœ‰ returnï¼Œåˆ™å¤„ç†ä¸€äº›é”™è¯¯    ...&#125;public static final class Builder &#123;    Builder(Retrofit retrofit) &#123;        // ä¸è¦æ·»åŠ é»˜è®¤çš„ã€build() æ–¹æ³•é‡Œæ·»åŠ çš„çš„å¹³å°ç›¸å…³çš„ CallAdapter        for (int i = 0,            size = retrofit.callAdapterFactories.size() - platform.defaultCallAdapterFactoriesSize();            i &lt; size; i++) &#123;            callAdapterFactories.add(retrofit.callAdapterFactories.get(i));        &#125;    &#125;    public Retrofit build() &#123;        ...        // åˆå§‹åŒ– okhttoclient ç­‰ç­‰        ...        // æ‰§è¡Œå™¨        Executor callbackExecutor = this.callbackExecutor;        if (callbackExecutor == null) &#123;            callbackExecutor = platform.defaultCallbackExecutor();        &#125;        // æ·»åŠ å¹³å°ç›¸å…³çš„ CallAdapter        List&lt;CallAdapter.Factory&gt; callAdapterFactories = new ArrayList&lt;&gt;(this.callAdapterFactories);        callAdapterFactories.addAll(platform.defaultCallAdapterFactories(callbackExecutor));        ...        // è¿”å› Retrofit å®ä¾‹        return new Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories),            unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);    &#125;&#125;</code></pre><p>å†çœ‹çœ‹Platform.defaultCallAdapterFactories()åšäº†äº›ä»€ä¹ˆï¼š</p><pre><code class="java">// retrofit.Platform.javaList&lt;? extends CallAdapter.Factory&gt; defaultCallAdapterFactories(    @Nullable Executor callbackExecutor) &#123;    DefaultCallAdapterFactory executorFactory = new DefaultCallAdapterFactory(callbackExecutor);    // Android ä¸­ Build.VERSION.SDK_INT &gt;= 24 æ—¶ï¼ŒhasJava8Typesä¼šè¢«ç½®ä¸ºtrue    return hasJava8Types        ? asList(CompletableFutureCallAdapterFactory.INSTANCE, executorFactory)        : singletonList(executorFactory);&#125;</code></pre><p>ç„¶åæˆ‘ä»¬çœ‹çœ‹ DefautCallAdapterFactory ç±»ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯åˆ›å»º CallAdapter çš„ä¸€ä¸ªå·¥å‚ç±»ï¼š</p><pre><code class="java">// retrofit2.DefaultCallAdapterFactory.javafinal class DefaultCallAdapterFactory extends CallAdapter.Factory &#123;    ...    @Override public @Nullable CallAdapter&lt;?, ?&gt; get(        Type returnType, Annotation[] annotations, Retrofit retrofit) &#123;        if (getRawType(returnType) != Call.class) &#123;            return null;        &#125;        if (!(returnType instanceof ParameterizedType)) &#123;            throw new IllegalArgumentException(                &quot;Call return type must be parameterized as Call&lt;Foo&gt; or Call&lt;? extends Foo&gt;&quot;);        &#125;        final Type responseType = Utils.getParameterUpperBound(0, (ParameterizedType) returnType);        final Executor executor = Utils.isAnnotationPresent(annotations, SkipCallbackExecutor.class)            ? null            : callbackExecutor;        return new CallAdapter&lt;Object, Call&lt;?&gt;&gt;() &#123;            @Override public Type responseType() &#123;                return responseType;            &#125;            @Override public Call&lt;Object&gt; adapt(Call&lt;Object&gt; call) &#123;                return executor == null                    ? call                    : new ExecutorCallbackCall&lt;&gt;(executor, call);            &#125;        &#125;;    &#125;    ...&#125;</code></pre><p>CallAdapter çš„å®ç°ç±»ç»ˆäºå¤„æ˜¯æ‰¾åˆ°äº†ï¼Œä½†æ˜¯å®ƒçš„ adapt() æ–¹æ³•æ‰æ˜¯çœŸæ­£èµ·ä½œç”¨çš„æ–¹æ³•ã€‚ä»ä¸Šåˆ°ä¸‹ï¼Œè°ƒç”¨åˆ°<code>adapt()</code>çš„æ—¶å€™ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªExcutorCallbackCallçš„å®ä¾‹ã€‚</p><h2 id="ç‰¹æ€§-â·-Converter"><a href="#ç‰¹æ€§-â·-Converter" class="headerlink" title="ç‰¹æ€§ â· Converter"></a>ç‰¹æ€§ â· Converter</h2><p>è·Ÿç€<code>retrofit.responseBodyConverter()</code>æ–¹æ³•å¾€ä¸‹èµ°ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// retrofit2.Retrofit.javapublic &lt;T&gt; Converter&lt;ResponseBody, T&gt; responseBodyConverter(Type type, Annotation[] annotations) &#123;    return nextResponseBodyConverter(null, type, annotations);&#125;public &lt;T&gt; Converter&lt;ResponseBody, T&gt; nextResponseBodyConverter(    @Nullable Converter.Factory skipPast, Type type, Annotation[] annotations) &#123;    ...    int start = converterFactories.indexOf(skipPast) + 1;    for (int i = start, count = converterFactories.size(); i &lt; count; i++) &#123;        Converter&lt;ResponseBody, ?&gt; converter =            converterFactories.get(i).responseBodyConverter(type, annotations, this);        if (converter != null) &#123;        //noinspection unchecked        return (Converter&lt;ResponseBody, T&gt;) converter;        &#125;    &#125;&#125;public static final class Builder &#123;    Builder(Retrofit retrofit) &#123;        // ä¸è¦æ·»åŠ é»˜è®¤çš„ã€build() æ–¹æ³•é‡Œæ·»åŠ çš„çš„å¹³å°ç›¸å…³çš„ BuiltIntConverters        for (int i = 1,            size = retrofit.converterFactories.size() - platform.defaultConverterFactoriesSize();            i &lt; size; i++) &#123;            converterFactories.add(retrofit.converterFactories.get(i));        &#125;    &#125;    public Retrofit build() &#123;        ...        // åˆå§‹åŒ– okhttoclient ç­‰ç­‰        ...        List&lt;Converter.Factory&gt; converterFactories = new ArrayList&lt;&gt;(            1 + this.converterFactories.size() + platform.defaultConverterFactoriesSize());        // å…ˆæ·»åŠ å†…ç½®çš„ converterï¼Œé‡Œé¢å®ç°äº†å¤šä¸ªè½¬æ¢å™¨åŒ…æ‹¬æŠŠå­—èŠ‚æµè½¬æ¢æˆ ResponseBodyï¼Œ        // ResponseBody è½¬æ¢ä¸º java ä¸­çš„ Void æˆ–è€… Kotlin ä¸­çš„ Unit æ—¶å…³é—­æµçš„æ“ä½œç­‰        converterFactories.add(new BuiltInConverters());        // æœ‰è‡ªå®šä¹‰çš„å°±æ·»åŠ è‡ªå®šä¹‰ï¼Œ        // æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ GsonConverterFactory         converterFactories.addAll(this.converterFactories);        // å¹³å°é»˜è®¤çš„ converter        converterFactories.addAll(platform.defaultConverterFactories());        // è¿”å› Retrofit å®ä¾‹        return new Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories),            unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);    &#125;&#125;</code></pre><pre><code class="java">// retrofit2.Platform.javaList&lt;? extends Converter.Factory&gt; defaultConverterFactories() &#123;    // SDK ç‰ˆæœ¬å°äº24ï¼Œå°±æ²¡æœ‰é»˜è®¤çš„ converter    return hasJava8Types        ? singletonList(OptionalConverterFactory.INSTANCE)        : emptyList();&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ CallAdapter çš„ç”Ÿæˆæ–¹å¼å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚</p><h2 id="invoke-é˜¶æ®µ"><a href="#invoke-é˜¶æ®µ" class="headerlink" title="invoke é˜¶æ®µ"></a>invoke é˜¶æ®µ</h2><p>OKï¼Œæ‰€æœ‰åˆå§‹åŒ–å®Œæˆï¼Œæ¥ä¸‹æ¥è¿›å…¥è°ƒç”¨é˜¶æ®µï¼Œæˆ‘ä»¬æ¥ç€æ–‡ç« å¼€å¤´çš„ä¾‹å­ï¼Œæ¥çœ‹ä¸€ä¸‹è°ƒç”¨çš„å…¥å£ï¼š</p><pre><code class="java">...GitHubService service = retrofit.create(GitHubService.class);Call&lt;List&lt;Repo&gt;&gt; call = service.listRepos(&quot;cy198706&quot;);call.enqueue(new Callback&lt;List&lt;Repo&gt;&gt;() &#123;    @Override     public void onResponse(Call&lt;List&lt;Repo&gt;&gt; call, Response&lt;List&lt;Repo&gt;&gt; response) &#123;    &#125;    @Override     public void onFailure(Call&lt;List&lt;Repo&gt;&gt; call, Throwable t) &#123;    &#125;&#125;);</code></pre><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä»¥<code>enqueue()</code>æ–¹æ³•ä¸ºå…¥å£ï¼Œçœ‹çœ‹è°ƒç”¨çš„æµç¨‹æ˜¯æ€æ ·çš„ã€‚</p><p>åˆšæ‰ç»è¿‡æˆ‘ä»¬çš„åˆ†æï¼Œç›®å‰çš„<code>call</code>å˜é‡åº”è¯¥æ˜¯ä¸€ä¸ª ExecutorCallbackCall çš„å®ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// retrofit2.DefaultCallAdapterFactory.javastatic final class ExecutorCallbackCall&lt;T&gt; implements Call&lt;T&gt; &#123;    final Executor callbackExecutor;    final Call&lt;T&gt; delegate;    ExecutorCallbackCall(Executor callbackExecutor, Call&lt;T&gt; delegate) &#123;        this.callbackExecutor = callbackExecutor;        this.delegate = delegate;    &#125;    @Override     public void enqueue(final Callback&lt;T&gt; callback) &#123;        Objects.requireNonNull(callback, &quot;callback == null&quot;);        delegate.enqueue(new Callback&lt;T&gt;() &#123;        @Override         public void onResponse(Call&lt;T&gt; call, final Response&lt;T&gt; response) &#123;            callbackExecutor.execute(() -&gt; &#123;            if (delegate.isCanceled()) &#123;                // Emulate OkHttp&#39;s behavior of throwing/delivering an IOException on cancellation.                callback.onFailure(ExecutorCallbackCall.this, new IOException(&quot;Canceled&quot;));            &#125; else &#123;                callback.onResponse(ExecutorCallbackCall.this, response);            &#125;            &#125;);        &#125;        @Override         public void onFailure(Call&lt;T&gt; call, final Throwable t) &#123;            callbackExecutor.execute(() -&gt; callback.onFailure(ExecutorCallbackCall.this, t));        &#125;        &#125;);    &#125;    @Override     public boolean isExecuted() &#123;        return delegate.isExecuted();    &#125;    @Override     public Response&lt;T&gt; execute() throws IOException &#123;        return delegate.execute();    &#125;    @Override     public void cancel() &#123;        delegate.cancel();    &#125;    @Override     public boolean isCanceled() &#123;        return delegate.isCanceled();    &#125;    @SuppressWarnings(&quot;CloneDoesntCallSuperClone&quot;) // Performing deep clone.    @Override     public Call&lt;T&gt; clone() &#123;        return new ExecutorCallbackCall&lt;&gt;(callbackExecutor, delegate.clone());    &#125;    @Override     public Request request() &#123;        return delegate.request();    &#125;    @Override     public Timeout timeout() &#123;        return delegate.timeout();    &#125;&#125;</code></pre><p>delegate æ˜¯ OkHttpCall å¯¹è±¡ï¼Œä½¿ç”¨è¿‡ OkHttp çš„åº”è¯¥çŸ¥é“å®ƒçš„ enqueue æ˜¯æ‰§è¡Œåœ¨å­çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ ExecutorCallbackCall ä¸ºæˆ‘ä»¬åšçš„å°±æ˜¯æŠŠåœ¨å­çº¿ç¨‹çš„å›è°ƒä¸­ï¼Œé€šè¿‡ MainThreadExecutor åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ retrofit2.Callback çš„å›è°ƒã€‚å½“ç„¶è¿™ä¸ª enqueue è¿˜ä¸æ˜¯çœŸæ­£çš„ OkHttp çš„ enqueueï¼Œå®ƒåšäº†å°è£…ã€‚</p><p>æ¥ç€å°±çœ‹çœ‹<code>OkHttpCall.enqueue()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// retrofit2.OkhttpCall.java @Override  public void enqueue(final Callback&lt;T&gt; callback) &#123;    ...    okhttp3.Call call;    Throwable failure;    synchronized (this) &#123;        if (executed) throw new IllegalStateException(&quot;Already executed.&quot;);        executed = true;        call = rawCall;        failure = creationFailure;        if (call == null &amp;&amp; failure == null) &#123;            try &#123;                // createRawCall() æ–¹æ³•è§ä¸‹                call = rawCall = createRawCall();            &#125; catch (Throwable t) &#123;                throwIfFatal(t);                failure = creationFailure = t;            &#125;        &#125;    &#125;    if (failure != null) &#123;        callback.onFailure(this, failure);        return;    &#125;    if (canceled) &#123;        call.cancel();    &#125;    // è¿™é‡Œæ‰æ˜¯çœŸæ­£è°ƒç”¨åˆ°äº† Okhttp.enqueue()    call.enqueue(new okhttp3.Callback() &#123;        @Override         public void onResponse(okhttp3.Call call, okhttp3.Response rawResponse) &#123;            Response&lt;T&gt; response;            try &#123;                response = parseResponse(rawResponse);            &#125; catch (Throwable e) &#123;                throwIfFatal(e);                callFailure(e);                return;            &#125;            try &#123;                callback.onResponse(OkHttpCall.this, response);            &#125; catch (Throwable t) &#123;                throwIfFatal(t);                t.printStackTrace(); // TODO this is not great            &#125;        &#125;        @Override         public void onFailure(okhttp3.Call call, IOException e) &#123;            callFailure(e);        &#125;        private void callFailure(Throwable e) &#123;            try &#123;                callback.onFailure(OkHttpCall.this, e);            &#125; catch (Throwable t) &#123;                throwIfFatal(t);                t.printStackTrace(); // TODO this is not great            &#125;        &#125;    &#125;);&#125;private okhttp3.Call createRawCall() throws IOException &#123;    okhttp3.Call call = callFactory.newCall(requestFactory.create(args));    if (call == null) &#123;        throw new NullPointerException(&quot;Call.Factory returned null.&quot;);    &#125;    return call;&#125;</code></pre><p>çœ‹åˆ°è¿™é‡Œï¼Œä¸ç¦æ„Ÿå¹ï¼ŒRetrofit çš„å·¥å‚æ¨¡å¼çœŸæ˜¯åº”ç”¨å¾—å‡ºç¥å…¥åŒ–ï¼Œæ— è®ºæ˜¯ Callï¼Œè¿˜æ˜¯ Requestï¼Œå…¨éƒ¨ç”¨å·¥å‚æ¨¡å¼æ¥åˆ›å»ºã€‚</p><p>åœ¨ä¸Šé¢æˆ‘ä»¬è®²è¿‡ï¼ŒRequestFactory çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯ <code>parseAnnotation()</code>ï¼Œç°åœ¨å®ƒçš„å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½æ¥äº†â€”â€”æ„å»º Requestã€‚</p><pre><code class="java">// retrofit2.RequestFactory.javaokhttp3.Request create(Object[] args) throws IOException &#123;    @SuppressWarnings(&quot;unchecked&quot;) // It is an error to invoke a method with the wrong arg types.    // è¿˜è®°å¾— parseAnnotations() æ–¹æ³•å—ï¼Œè§£æå‡ºæ¥çš„ parameterHandlers æ­¤å¤„æ´¾ä¸Šç”¨åœºäº†    ParameterHandler&lt;Object&gt;[] handlers = (ParameterHandler&lt;Object&gt;[]) parameterHandlers;    int argumentCount = args.length;    if (argumentCount != handlers.length) &#123;        throw new IllegalArgumentException(&quot;Argument count (&quot; + argumentCount            + &quot;) doesn&#39;t match expected count (&quot; + handlers.length + &quot;)&quot;);    &#125;    RequestBuilder requestBuilder = new RequestBuilder(httpMethod, baseUrl, relativeUrl,        headers, contentType, hasBody, isFormEncoded, isMultipart);    if (isKotlinSuspendFunction) &#123;        // The Continuation is the last parameter and the handlers array contains null at that index.        argumentCount--;    &#125;    List&lt;Object&gt; argumentList = new ArrayList&lt;&gt;(argumentCount);    for (int p = 0; p &lt; argumentCount; p++) &#123;        argumentList.add(args[p]);        handlers[p].apply(requestBuilder, args[p]);    &#125;    return requestBuilder.get()        .tag(Invocation.class, new Invocation(method, argumentList))        .build();    &#125;&#125;</code></pre><p>æ­¤æ—¶ï¼Œæœ‰äº† Requestï¼Œå°±å¯ä»¥çœŸæ­£åœ°è°ƒç”¨<code>Okhttp.enqueue()</code>æ–¹æ³•æ¥è¿›è¡Œè¯·æ±‚äº†ã€‚</p><p>åœ¨æœ‰äº†æ­£ç¡®çš„å›è°ƒç»“æœåï¼Œè¿˜éœ€è¦æœ‰ä¸€æ­¥<code>response = parseResponse(rawResponse)</code>æ¥è§£ææ•°æ®ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åšçš„ï¼š</p><pre><code class="java">Response&lt;T&gt; parseResponse(okhttp3.Response rawResponse) throws IOException &#123;    ResponseBody rawBody = rawResponse.body();    // Remove the body&#39;s source (the only stateful object) so we can pass the response along.    rawResponse = rawResponse.newBuilder()        .body(new NoContentResponseBody(rawBody.contentType(), rawBody.contentLength()))        .build();    int code = rawResponse.code();    if (code &lt; 200 || code &gt;= 300) &#123;        try &#123;        // Buffer the entire body to avoid future I/O.        ResponseBody bufferedBody = Utils.buffer(rawBody);        return Response.error(bufferedBody, rawResponse);        &#125; finally &#123;        rawBody.close();        &#125;    &#125;    if (code == 204 || code == 205) &#123;        rawBody.close();        return Response.success(null, rawResponse);    &#125;    ExceptionCatchingResponseBody catchingBody = new ExceptionCatchingResponseBody(rawBody);    try &#123;        T body = responseConverter.convert(catchingBody);        return Response.success(body, rawResponse);    &#125; catch (RuntimeException e) &#123;        // If the underlying source threw an exception, propagate that rather than indicating it was        // a runtime exception.        catchingBody.throwIfCaught();        throw e;    &#125;&#125;</code></pre><p>å›è°ƒæ“ä½œï¼Œè¿™é‡Œè¿˜æ˜¯åœ¨å­çº¿ç¨‹ï¼Œé€šè¿‡ ExecutorCallbackCall é‡Œé¢çš„æµç¨‹ï¼Œè°ƒç”¨åˆ°ä¸»çº¿ç¨‹ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±çœŸæ­£çš„èµ°è¿‡äº†ä¸€æ¬¡ Retrofit ä» create åˆ›å»º Call åˆ°å‘é€è¯·æ±‚ï¼Œç„¶ååˆ°å›è°ƒä¸»çº¿ç¨‹çš„æ“ä½œäº†ã€‚</p><p>è‡³æ­¤ï¼Œæ•´ä¸ª Retrofit çš„ä¸€æ¬¡å®Œæ•´çš„æµç¨‹ä¾¿å®Œæˆäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢ä¸€å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹ï¼š</p><p><img src="/img/28.png"></p><h3 id="åˆ›å»ºRetrofitå®ä¾‹é˜¶æ®µ"><a href="#åˆ›å»ºRetrofitå®ä¾‹é˜¶æ®µ" class="headerlink" title="åˆ›å»ºRetrofitå®ä¾‹é˜¶æ®µ"></a>åˆ›å»ºRetrofitå®ä¾‹é˜¶æ®µ</h3><ol><li>è°ƒç”¨<code>new Retrofit.Builder().build()</code></li><li>Retrofit ç±»åœ¨<code>build()</code>æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š<ol><li>åˆ›å»º OkHttpClient å®ä¾‹</li><li>MainThreadExecutor å®ä¾‹</li><li>è°ƒç”¨<code>Platform.defaultCallAdapterFactories()</code>æ–¹æ³•åˆ›å»º CallAdapter</li><li>è°ƒç”¨<code>Platform.defaultConverterFactoriesSize()</code>æ–¹æ³•åˆ›å»º Converter</li><li>æ–°å»ºå¹¶è¿”å› Retrofit å®ä¾‹</li></ol></li></ol><h3 id="åˆ›å»ºæ¥å£ä»£ç†é˜¶æ®µ"><a href="#åˆ›å»ºæ¥å£ä»£ç†é˜¶æ®µ" class="headerlink" title="åˆ›å»ºæ¥å£ä»£ç†é˜¶æ®µ"></a>åˆ›å»ºæ¥å£ä»£ç†é˜¶æ®µ</h3><ol><li>è°ƒç”¨<code>Retrofit.create()</code>æ–¹æ³•åˆ›å»ºæ¥å£å®ä¾‹</li><li>åœ¨<code>Retrofit.create()</code>æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š<ol><li>æ£€æŸ¥æ¥å£</li><li>è°ƒç”¨<code>loadServiceMethod()</code>æ–¹æ³•</li><li>åˆ›å»ºä¸€ä¸ªæ–¹æ³•ä»£ç†å¹¶è¿”å›</li></ol></li><li>åœ¨<code>loadServiceMethod()</code>æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š<ol><li>è§£ææ³¨è§£</li><li>è§£æå‚æ•°</li><li>ç”Ÿæˆ RequestFactory å®ä¾‹</li><li>è°ƒç”¨<code>HttpServiceMethod.parseAnnotations()</code>æ–¹æ³•</li></ol></li><li>åœ¨<code>HttpServiceMethod.parseAnnotations()</code>æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š<ol><li>è°ƒç”¨<code>createCallAdapter()</code>æ–¹æ³•ï¼Œä» Retrofit å®ä¾‹çš„ callAdapterFactories ä¸­æ‹¿å– CallAdapter</li><li>è¿”å› HttpServiceMethod çš„æ´¾ç”Ÿç±» CallAdapted | SuspendForResponse | SuspendForBody çš„å®ä¾‹</li></ol></li><li>å°†ä¸Šä¸€æ­¥è¿”å›çš„å®ä¾‹æ·»åŠ åˆ°ç¼“å­˜ä¸­ç­‰å¾…è¯»å–å’Œè°ƒç”¨</li></ol><h3 id="è§¦å‘ä»£ç†æœºåˆ¶é˜¶æ®µ"><a href="#è§¦å‘ä»£ç†æœºåˆ¶é˜¶æ®µ" class="headerlink" title="è§¦å‘ä»£ç†æœºåˆ¶é˜¶æ®µ"></a>è§¦å‘ä»£ç†æœºåˆ¶é˜¶æ®µ</h3><ol><li>è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œè§¦å‘ä»£ç†æœºåˆ¶</li><li>åœ¨ä»£ç†çš„<code>invoke()</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæœ‰å¦‚ä¸‹æ­¥éª¤ï¼š<ol><li>ä½¿ç”¨<code>loadServiceMethod()</code>è·å–è¯¥æ–¹æ³•å¯¹åº”çš„ServiceMethod</li><li>è°ƒç”¨<code>ServiceMethod.invoke()</code>æ–¹æ³•</li><li>è°ƒç”¨<code>HttpServiceMethod.invoke()</code>æ–¹æ³•</li><li>è°ƒç”¨ HttpServiceMethod çš„<code>adapt()</code>æ–¹æ³•ï¼Œå…¶æ´¾ç”Ÿç±»ä¹‹ä¸€çš„<code>adapt()</code>æ–¹æ³•è¢«è°ƒç”¨</li><li><code>CallAdapter.adapt()</code>è¢«è°ƒç”¨</li><li>è¿”å› ExecutorCallbackCall å®ä¾‹</li></ol></li></ol><h3 id="è¯·æ±‚é˜¶æ®µ"><a href="#è¯·æ±‚é˜¶æ®µ" class="headerlink" title="è¯·æ±‚é˜¶æ®µ"></a>è¯·æ±‚é˜¶æ®µ</h3><ol><li> è°ƒç”¨<code>ExecutorCallbackCall.enqueue()</code>æ–¹æ³•å‘èµ·è¯·æ±‚</li><li> åœ¨<code>ExecutorCallbackCall.enqueue()</code>æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š</li></ol><ol><li>åˆ›å»º Request å®ä¾‹ï¼Œå¹¶è°ƒç”¨<code>callFactory.newCall(Request)</code>æ–¹æ³•åˆ›å»º RealCall å®ä¾‹</li><li>è°ƒç”¨<code>RealCall.enqueue()</code>æ–¹æ³•ï¼Œä½¿ç”¨ okhttp å‘èµ·è¯·æ±‚</li><li> å›è°ƒåˆ°ä¸»çº¿ç¨‹</li><li> è§£æå¹¶åˆ©ç”¨ Converter ååºåˆ—åŒ–è¿”å›çš„ç»“æœ</li><li> å›è°ƒåˆ°è°ƒç”¨è€…</li></ol>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> ä¸‰æ–¹åº“ </tag>
            
            <tag> Retrofit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android å±å¹•é€‚é…</title>
      <link href="/2023-01-31/android-screen-adaptation/"/>
      <url>/2023-01-31/android-screen-adaptation/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/onelikeone/p/9583446.html">çœ‹è¿™ç¯‡</a><br><a href="https://www.jianshu.com/p/759375113de9">å’Œè¿™ç¯‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> é€‚é… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºæ’ä»¶åŒ–</title>
      <link href="/2023-01-31/pluginazation/"/>
      <url>/2023-01-31/pluginazation/</url>
      
        <content type="html"><![CDATA[<p>æ’ä»¶åŒ–å‡ ä¹æ˜¯ç°åœ¨ Android å¼€å‘å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ä¹‹ä¸€äº†ã€‚åœ¨å‰å‡ å¹´ï¼ŒAndroid çš„å®‰å…¨æœºåˆ¶ä¸æ˜¯å¾ˆå®Œå–„çš„æ—¶å€™ï¼Œæ’ä»¶åŒ–çš„ç¡®å¤§æ”¾å¼‚å½©äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯éšç€ Android å˜å¾—è¶Šæ¥è¶Šå®‰å…¨ï¼Œæ’ä»¶åŒ–çš„é£å¤´ä¹Ÿæœ‰æ‰€æ”¶æ•›ã€‚ä»æœ€åˆåªæ”¯æŒ Activity çš„åŠ¨æ€åŠ è½½å‘å±•åˆ°å¯ä»¥å®Œå…¨æ¨¡æ‹Ÿ app è¿è¡Œæ—¶çš„æ²™ç®±ç³»ç»Ÿï¼Œæ’ä»¶åŒ–çš„æŠ€æœ¯ä¹Ÿä¸€æ­¥æ­¥è¶‹äºæˆç†Ÿã€‚</p><span id="more"></span><h2 id="ä¸€ã€å‘å±•å†å²"><a href="#ä¸€ã€å‘å±•å†å²" class="headerlink" title="ä¸€ã€å‘å±•å†å²"></a>ä¸€ã€å‘å±•å†å²</h2><p>æ’ä»¶åŒ–æŠ€æœ¯æœ€åˆæºäºå…å®‰è£…è¿è¡Œapkçš„æƒ³æ³•ï¼Œè¿™ä¸ªå…å®‰è£…çš„ apk å¯ä»¥ç†è§£ä¸ºæ’ä»¶ã€‚æ”¯æŒæ’ä»¶åŒ–çš„ app å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ è½½å’Œè¿è¡Œæ’ä»¶ï¼Œè¿™æ ·ä¾¿å¯ä»¥å°† app ä¸­ä¸€äº›ä¸å¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—åšæˆæ’ä»¶ï¼Œä¸€æ–¹é¢å‡å°äº†å®‰è£…åŒ…çš„å¤§å°ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥å®ç° app åŠŸèƒ½çš„åŠ¨æ€æ‰©å±•ã€‚æƒ³è¦å®ç°æ’ä»¶åŒ–ï¼Œä¸»è¦æ˜¯è§£å†³ä¸‹é¢ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li>æ’ä»¶ä¸­ä»£ç çš„åŠ è½½å’Œä¸ä¸»å·¥ç¨‹çš„äº’ç›¸è°ƒç”¨</li><li>æ’ä»¶ä¸­èµ„æºçš„åŠ è½½å’Œä¸ä¸»å·¥ç¨‹çš„äº’ç›¸è®¿é—®</li><li>å››å¤§ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</li></ul><p>ä¸‹é¢æ˜¯æ¯”è¾ƒå‡ºåçš„å‡ ä¸ªå¼€æºçš„æ’ä»¶åŒ–æ¡†æ¶ï¼ŒæŒ‰ç…§å‡ºç°çš„æ—¶é—´æ’åºã€‚ç ”ç©¶å®ƒä»¬çš„å®ç°åŸç†ï¼Œå¯ä»¥å¤§è‡´çœ‹å‡ºæ’ä»¶åŒ–æŠ€æœ¯çš„å‘å±•ï¼Œæ ¹æ®å®ç°åŸç†æˆ‘æŠŠè¿™å‡ ä¸ªæ¡†æ¶åˆ’åˆ†æˆäº†ä¸‰ä»£ã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/tnZGrhTk4dfxmHLtbLMzmQMjmjhjWq2XeJ1qLUic0kGzLIzr2n3pv5Emich2bYibQLrCic1oibAUWUEwibP1sePxyeUQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1"></p><p>ç¬¬ä¸€ä»£ï¼šdynamic-load-apkæœ€æ—©ä½¿ç”¨ ProxyActivity è¿™ç§é™æ€ä»£ç†æŠ€æœ¯ï¼Œç”± ProxyActivity å»æ§åˆ¶æ’ä»¶ä¸­ PluginActivity çš„ç”Ÿå‘½å‘¨æœŸã€‚è¯¥ç§æ–¹å¼ç¼ºç‚¹æ˜æ˜¾ï¼Œæ’ä»¶ä¸­çš„ activity å¿…é¡»ç»§æ‰¿ PluginActivityï¼Œå¼€å‘æ—¶è¦å°å¿ƒå¤„ç† contextã€‚è€Œ DroidPlugin é€šè¿‡ Hook ç³»ç»ŸæœåŠ¡çš„æ–¹å¼å¯åŠ¨æ’ä»¶ä¸­çš„ Activityï¼Œä½¿å¾—å¼€å‘æ’ä»¶çš„è¿‡ç¨‹å’Œå¼€å‘æ™®é€šçš„ app æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯ç”±äº hook è¿‡å¤šç³»ç»ŸæœåŠ¡ï¼Œå¼‚å¸¸å¤æ‚ä¸”ä¸å¤Ÿç¨³å®šã€‚</p><p>ç¬¬äºŒä»£ï¼šä¸ºäº†åŒæ—¶è¾¾åˆ°æ’ä»¶å¼€å‘çš„ä½ä¾µå…¥æ€§ï¼ˆåƒå¼€å‘æ™®é€š app ä¸€æ ·å¼€å‘æ’ä»¶ï¼‰å’Œæ¡†æ¶çš„ç¨³å®šæ€§ï¼Œåœ¨å®ç°åŸç†ä¸Šéƒ½æ˜¯è¶‹è¿‘äºé€‰æ‹©å°½é‡å°‘çš„ hookï¼Œå¹¶é€šè¿‡åœ¨ manifest ä¸­é¢„åŸ‹ä¸€äº›ç»„ä»¶å®ç°å¯¹å››å¤§ç»„ä»¶çš„æ’ä»¶åŒ–ã€‚å¦å¤–å„ä¸ªæ¡†æ¶æ ¹æ®å…¶è®¾è®¡æ€æƒ³éƒ½åšäº†ä¸åŒç¨‹åº¦çš„æ‰©å±•ï¼Œå…¶ä¸­ Small æ›´æ˜¯åšæˆäº†ä¸€ä¸ªè·¨å¹³å°ï¼Œç»„ä»¶åŒ–çš„å¼€å‘æ¡†æ¶ã€‚</p><p>ç¬¬ä¸‰ä»£ï¼šVirtualApp æ¯”è¾ƒå‰å®³ï¼Œèƒ½å¤Ÿå®Œå…¨æ¨¡æ‹Ÿ app çš„è¿è¡Œç¯å¢ƒï¼Œèƒ½å¤Ÿå®ç° app çš„å…å®‰è£…è¿è¡Œå’ŒåŒå¼€æŠ€æœ¯ã€‚Atlas æ˜¯é˜¿é‡Œå¼€æºå‡ºæ¥çš„ä¸€ä¸ªç»“åˆç»„ä»¶åŒ–å’Œçƒ­ä¿®å¤æŠ€æœ¯çš„ä¸€ä¸ª app åŸºç¡€æ¡†æ¶ï¼Œå…¶å¹¿æ³›çš„åº”ç”¨ä¸é˜¿é‡Œç³»çš„å„ä¸ª appï¼Œå…¶å·ç§°æ˜¯ä¸€ä¸ªå®¹å™¨åŒ–æ¡†æ¶ã€‚</p><p>ä¸‹é¢è¯¦ç»†ä»‹ç»æ’ä»¶åŒ–æ¡†æ¶çš„åŸç†ï¼Œåˆ†åˆ«å¯¹åº”ç€å®ç°æ’ä»¶åŒ–çš„ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ã€‚</p><h2 id="äºŒã€åŸºæœ¬åŸç†"><a href="#äºŒã€åŸºæœ¬åŸç†" class="headerlink" title="äºŒã€åŸºæœ¬åŸç†"></a>äºŒã€åŸºæœ¬åŸç†</h2><p>åœ¨æ¢ç´¢åŸºæœ¬åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€å¼  Android Apk æ‰“åŒ…çš„æµç¨‹å›¾ï¼š</p><p><img src="/img/682616-20191129131701331-804618503.png"></p><p>åŸºæœ¬åˆ†ä¸º7ä¸ªé˜¶æ®µï¼š</p><ol><li><p>æ‰“åŒ…èµ„æºæ–‡ä»¶ï¼Œç”ŸæˆR.javaæ–‡ä»¶</p><p>æ‰“åŒ…èµ„æºçš„å·¥å…·æ˜¯aaptï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé¡¹ç›®ä¸­çš„AndroidManifest.xmlæ–‡ä»¶å’Œå¸ƒå±€æ–‡ä»¶XMLéƒ½ä¼šç¼–è¯‘ï¼Œç„¶åç”Ÿæˆç›¸åº”çš„R.javaï¼Œå¦å¤–AndroidManifest.xmlä¼šè¢«aaptç¼–è¯‘æˆäºŒè¿›åˆ¶ã€‚å­˜æ”¾åœ¨APPçš„resç›®å½•ä¸‹çš„èµ„æºï¼Œè¯¥ç±»èµ„æºåœ¨APPæ‰“åŒ…å‰å¤§å¤šä¼šè¢«ç¼–è¯‘ï¼Œå˜æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¼šä¸ºæ¯ä¸ªè¯¥ç±»æ–‡ä»¶èµ‹äºˆä¸€ä¸ªresource idã€‚å¯¹äºè¯¥ç±»èµ„æºçš„è®¿é—®ï¼Œåº”ç”¨å±‚ä»£ç åˆ™æ˜¯é€šè¿‡resource idè¿›è¡Œè®¿é—®çš„ã€‚Androidåº”ç”¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­aaptå·¥å…·ä¼šå¯¹èµ„æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªresource.arscæ–‡ä»¶ï¼Œresource.arscæ–‡ä»¶ç›¸å½“äºä¸€ä¸ªæ–‡ä»¶ç´¢å¼•è¡¨ï¼Œè®°å½•äº†å¾ˆå¤šè·Ÿèµ„æºç›¸å…³çš„ä¿¡æ¯ã€‚</p></li><li><p>å¤„ç†aidlæ–‡ä»¶ï¼Œç”Ÿæˆç›¸åº”çš„Javaæ–‡ä»¶</p><p>aidlå·¥å…·è§£ææ¥å£å®šä¹‰æ–‡ä»¶ç„¶åç”Ÿæˆç›¸åº”çš„Javaä»£ç æ¥å£ä¾›ç¨‹åºè°ƒç”¨ã€‚å¦‚æœåœ¨é¡¹ç›®æ²¡æœ‰ä½¿ç”¨åˆ°aidlæ–‡ä»¶ï¼Œåˆ™å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚</p></li><li><p>ç¼–è¯‘é¡¹ç›®æºä»£ç ï¼Œç”Ÿæˆclassæ–‡ä»¶</p><p>é¡¹ç›®ä¸­æ‰€æœ‰çš„Javaä»£ç ï¼ŒåŒ…æ‹¬R.javaå’Œ.aidlæ–‡ä»¶ï¼Œéƒ½ä¼šå˜Javaç¼–è¯‘å™¨ï¼ˆjavacï¼‰ç¼–è¯‘æˆ.classæ–‡ä»¶ï¼Œç”Ÿæˆçš„classæ–‡ä»¶ä½äºå·¥ç¨‹ä¸­çš„bin/classesç›®å½•ä¸‹ã€‚</p></li><li><p>è½¬æ¢æ‰€æœ‰çš„classæ–‡ä»¶ï¼Œç”Ÿæˆclasses.dexæ–‡ä»¶</p><p>dexå·¥å…·ç”Ÿæˆå¯ä¾›Androidç³»ç»ŸDalvikè™šæ‹Ÿæœºæ‰§è¡Œçš„classes.dexæ–‡ä»¶ï¼Œä»»ä½•ç¬¬ä¸‰æ–¹çš„librarieså’Œ.classæ–‡ä»¶éƒ½ä¼šè¢«è½¬æ¢æˆ.dexæ–‡ä»¶ã€‚dxå·¥å…·çš„ä¸»è¦å·¥ä½œæ˜¯å°†Javaå­—èŠ‚ç è½¬æˆæˆDalvikå­—èŠ‚ç ã€å‹ç¼©å¸¸é‡æ± ã€æ¶ˆé™¤å†—ä½™ä¿¡æ¯ç­‰ã€‚</p></li><li><p>æ‰“åŒ…ç”ŸæˆAPKæ–‡ä»¶</p><p>æ‰€æœ‰æ²¡æœ‰ç¼–è¯‘çš„èµ„æºï¼Œå¦‚imagesã€assetsç›®å½•ä¸‹èµ„æºï¼ˆè¯¥ç±»æ–‡ä»¶æ˜¯ä¸€äº›åŸå§‹æ–‡ä»¶ï¼ŒAPPæ‰“åŒ…æ—¶å¹¶ä¸ä¼šå¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œè€Œæ˜¯ç›´æ¥æ‰“åŒ…åˆ°APPä¸­ï¼Œå¯¹äºè¿™ä¸€ç±»èµ„æºæ–‡ä»¶çš„è®¿é—®ï¼Œåº”ç”¨å±‚ä»£ç éœ€è¦é€šè¿‡æ–‡ä»¶åå¯¹å…¶è¿›è¡Œè®¿é—®ï¼‰ï¼›ç¼–è¯‘è¿‡çš„èµ„æºå’Œ.dexæ–‡ä»¶éƒ½ä¼šè¢«apkbuilderå·¥å…·æ‰“åŒ…åˆ°æœ€ç»ˆçš„.apkæ–‡ä»¶ä¸­ã€‚</p></li><li><p>å¯¹APKæ–‡ä»¶è¿›è¡Œç­¾å</p><p>ä¸€æ—¦APKæ–‡ä»¶ç”Ÿæˆï¼Œå®ƒå¿…é¡»è¢«ç­¾åæ‰èƒ½è¢«å®‰è£…åœ¨è®¾å¤‡ä¸Šã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸»è¦ç”¨åˆ°çš„å°±æ˜¯ä¸¤ç§ç­¾åçš„keystoreã€‚ä¸€ç§æ˜¯ç”¨äºè°ƒè¯•çš„debug.keystoreï¼Œå®ƒä¸»è¦ç”¨äºè°ƒè¯•ï¼Œåœ¨Eclipseæˆ–è€…Android Studioä¸­ç›´æ¥runä»¥åè·‘åœ¨æ‰‹æœºä¸Šçš„å°±æ˜¯ä½¿ç”¨çš„debug.keystoreã€‚å¦ä¸€ç§å°±æ˜¯ç”¨äºå‘å¸ƒæ­£å¼ç‰ˆæœ¬çš„keystoreã€‚</p></li><li><p>å¯¹ç­¾ååçš„APKæ–‡ä»¶è¿›è¡Œå¯¹é½å¤„ç†</p><p>å¦‚æœä½ å‘å¸ƒçš„apkæ˜¯æ­£å¼ç‰ˆçš„è¯ï¼Œå°±å¿…é¡»å¯¹APKè¿›è¡Œå¯¹é½å¤„ç†ï¼Œç”¨åˆ°çš„å·¥å…·æ˜¯ zipalignã€‚å¯¹é½çš„ä¸»è¦è¿‡ç¨‹æ˜¯å°†APKåŒ…ä¸­æ‰€æœ‰çš„èµ„æºæ–‡ä»¶è·ç¦»æ–‡ä»¶èµ·å§‹åç§»ä¸º4å­—èŠ‚æ•´æ•°å€ï¼Œè¿™æ ·é€šè¿‡å†…å­˜æ˜ å°„è®¿é—®apkæ–‡ä»¶æ—¶çš„é€Ÿåº¦ä¼šæ›´å¿«ã€‚å¯¹é½çš„ä½œç”¨å°±æ˜¯å‡å°‘è¿è¡Œæ—¶å†…å­˜çš„ä½¿ç”¨ã€‚</p></li></ol><p>é‚£ä¹ˆï¼Œå…¶å®æ’ä»¶åŒ–çš„çªç ´å£ï¼Œå°±åœ¨ç”Ÿæˆçš„ .dex æ–‡ä»¶å’Œ Compiled Resources æ–‡ä»¶é‡Œã€‚</p><h3 id="1-ç±»åŠ è½½"><a href="#1-ç±»åŠ è½½" class="headerlink" title="1. ç±»åŠ è½½"></a>1. ç±»åŠ è½½</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJava ä¸­ç±»çš„åŠ è½½ä½¿ç”¨çš„æ˜¯ ClassLoaderï¼Œå®ƒè´Ÿè´£å°† <strong>*.class åŠ è½½ä¸ºå†…å­˜ä¸­çš„ Class å¯¹è±¡</strong>ã€‚å®ƒçš„åŠ è½½æœºåˆ¶ä¸ºã€<strong>åŒäº²å§”æ´¾</strong>ã€ï¼Œå³èƒ½äº¤ç»™çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½çš„ï¼Œç»ä¸è‡ªè¡ŒåŠ è½½ã€‚è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥ä»å®ƒçš„æºç ä¸­çœ‹å‡ºï¼š</p><pre><code class="java">public abstract class ClassLoader &#123;    ...    // çˆ¶ class loader çš„å§”æ‰˜    // æ³¨æ„ï¼šVM å°†è¯¥å˜é‡çš„åç§»é‡ç¡¬ç¼–ç äº†ï¼Œæ‰€ä»¥æ–°çš„æˆå‘˜å˜é‡å¿…é¡»è¦å£°æ˜åœ¨è¿™ä¸ªå˜é‡ä¹‹å    private final ClassLoader parent;    ...        protected Class&lt;?&gt; loadClass(String name, boolean resolve)                 throws ClassNotFoundException &#123;            // ç¬¬ä¸€æ­¥ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŠ è½½äº†            Class&lt;?&gt; c = findLoadedClass(name);            if (c == null) &#123;                try &#123;                    if (parent != null) &#123;                        // è¿™é‡Œä½¿ç”¨äº†ã€åŒäº²å§”æ‰˜ã€æœºåˆ¶ï¼Œé€’å½’è°ƒç”¨çˆ¶ç±»çš„ loadClass æ–¹æ³•                        c = parent.loadClass(name, false);                    &#125; else &#123;                        c = findBootstrapClassOrNull(name);                    &#125;                &#125; catch (ClassNotFoundException e) &#123;                &#125;                if (c == null) &#123;                    // å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼Œå°±è°ƒç”¨ findClass æ–¹æ³•æ¥æ‰¾åˆ°ç±»                    c = findClass(name);                &#125;            &#125;            return c;    &#125;</code></pre><p>åŒäº²å§”æ´¾æœºåˆ¶æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>é˜²æ­¢é‡å¤åŠ è½½åŒä¸€ä¸ª class ã€‚é€šè¿‡å§”æ‰˜å»å‘ä¸Šé¢é—®ä¸€é—®ï¼ŒåŠ è½½è¿‡äº†ï¼Œå°±ä¸ç”¨å†åŠ è½½ä¸€éã€‚ä¿è¯æ•°æ®å®‰å…¨ã€‚</li><li>ä¿è¯æ ¸å¿ƒ class ä¸èƒ½è¢«ç¯¡æ”¹ã€‚é€šè¿‡å§”æ‰˜æ–¹å¼ï¼Œä¸ä¼šå»ç¯¡æ”¹æ ¸å¿ƒ classï¼Œå³ä½¿ç¯¡æ”¹ä¹Ÿä¸ä¼šå»åŠ è½½ï¼Œå³ä½¿åŠ è½½äº†ä¹Ÿä¸ä¼šæ˜¯åŒä¸€ä¸ª class å¯¹è±¡äº†ã€‚ä¸åŒçš„åŠ è½½å™¨åŠ è½½åŒä¸€ä¸ª class ä¹Ÿä¸æ˜¯åŒä¸€ä¸ª Class å¯¹è±¡ã€‚è¿™æ ·ä¿è¯äº† Class æ‰§è¡Œå®‰å…¨ã€‚</li></ol><p>åœ¨ Android ä¸­ ClassLoader æœ‰å¤šä¸ªæ´¾ç”Ÿç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/65.png"></p><p>å…¶ä¸­æœ€å¸¸ç”¨ä¹Ÿæœ€é‡è¦çš„ä¸¤ä¸ªç±»ï¼Œå°±æ˜¯ DexClassLoader å’Œ PathClassLoader äº†ã€‚å®ƒä»¬éƒ½ç»§æ‰¿è‡ª BaseDexClassLoaderã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ DexClassLoader çš„ä»£ç ï¼š</p><p>DexClassLoaderï¼š</p><pre><code class="java">public class DexClassLoader extends BaseDexClassLoader &#123;    // å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š    // dexPathï¼šåŒ…å« dex æ–‡ä»¶çš„ jar åŒ…æˆ– apk æ–‡ä»¶çš„è·¯å¾„    // optimizedDirectoryï¼šdex æ–‡ä»¶é‡Šæ”¾ç›®å½•/ç¼“å­˜ç›®å½•ï¼Œå¿…é¡»ä¸ºåº”ç”¨çš„ private ç›®å½•ï¼Œä¸èƒ½ä¸ºç©º    // librarySearchPathï¼šnative åº“çš„è·¯å¾„ï¼Œå¯ä»¥ä¸ºç©º    // parentï¼š çˆ¶ç±»åŠ è½½å™¨ï¼ˆç”¨äºåŒäº²å§”æ´¾ï¼‰    public DexClassLoader(String dexPath, String optimizedDirectory,            String librarySearchPath, ClassLoader parent) &#123;        super(dexPath, null, librarySearchPath, parent);    &#125;&#125;</code></pre><p>DexClassLoader çš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>ç”¨äºåŠ è½½åŒ…å« *.dex æ–‡ä»¶çš„ jar åŒ…æˆ– apk æ–‡ä»¶</li><li>è¦æ±‚ä¸€ä¸ª<strong>åº”ç”¨ç§æœ‰å¯å†™çš„ç›®å½•å»ç¼“å­˜ç¼–è¯‘çš„ class æ–‡ä»¶</strong></li><li><strong>ä¸å…è®¸åŠ è½½å¤–éƒ¨å­˜å‚¨ç©ºé—´çš„æ–‡ä»¶</strong>ï¼Œä»¥é˜²æ³¨å…¥æ”»å‡»</li></ul><p>ä» API 26 å¼€å§‹ï¼Œ<code>optimizedDirectory</code>å°†ä¸å†èµ·ä½œç”¨ï¼Œè¿™ä¸ªå­—æ®µå°†ä¼šè¢«åºŸé™¤æ‰ã€‚</p><p>PathClassLoaderï¼š</p><pre><code class="java">public class PathClassLoader extends BaseDexClassLoader &#123;    public PathClassLoader(String dexPath, ClassLoader parent) &#123;        super((String)null, (File)null, (String)null, (ClassLoader)null);        throw new RuntimeException(&quot;Stub!&quot;);    &#125;    // ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š    // dexPathï¼šåŒ…å« dex æ–‡ä»¶çš„ jar åŒ…æˆ– apk æ–‡ä»¶çš„è·¯å¾„    // librarySearchPathï¼šnative åº“çš„è·¯å¾„ï¼Œå¯ä»¥ä¸ºç©º    // parentï¼š çˆ¶ç±»åŠ è½½å™¨ï¼ˆç”¨äºåŒäº²å§”æ´¾ï¼‰    public PathClassLoader(String dexPath, String librarySearchPath, ClassLoader parent) &#123;        super((String)null, (File)null, (String)null, (ClassLoader)null);    &#125;&#125;</code></pre><p>æ— è®ºå“ªç§åŠ¨æ€åŠ è½½ï¼ŒåŠ è½½çš„<strong>å¯æ‰§è¡Œæ–‡ä»¶ä¸€å®šè¦å­˜æ”¾åœ¨å†…éƒ¨å­˜å‚¨</strong>ã€‚DexClassLoader å¯ä»¥æŒ‡å®šè‡ªå·±çš„<code>optimizedDirectory</code>ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åŠ è½½å¤–éƒ¨çš„ dex ï¼Œæœ€ç»ˆè¿™ä¸ª dex ä¼šè¢«<strong>å¤åˆ¶åˆ°å†…éƒ¨è·¯å¾„</strong>çš„<code>optimizedDirectory</code>ä¸­ï¼›è€Œ PathClassLoader æ²¡æœ‰<code>optimizedDirectory</code>ï¼Œæ‰€ä»¥å®ƒåªèƒ½åŠ è½½å†…éƒ¨çš„ dexï¼Œè¿™äº›å¤§éƒ½æ˜¯å­˜åœ¨ç³»ç»Ÿä¸­å·²ç»å®‰è£…è¿‡çš„ apk é‡Œé¢çš„ã€‚PathClassLoader åœ¨ ART è™šæ‹Ÿæœºä¸Šå¯ä»¥åŠ è½½æœªå®‰è£…çš„ apk çš„ dex ï¼Œåœ¨ Dalvik åˆ™ä¸è¡Œã€‚</p><h3 id="2-èµ„æºåŠ è½½"><a href="#2-èµ„æºåŠ è½½" class="headerlink" title="2. èµ„æºåŠ è½½"></a>2. èµ„æºåŠ è½½</h3><p>Android ä¸­çš„èµ„æºåˆ†ä¸ºä¸¤ç±»ï¼š</p><p>ç¬¬ä¸€ç±»æ˜¯ res ç›®å½•ä¸‹å­˜æ”¾çš„å¯ç¼–è¾‘çš„èµ„æºæ–‡ä»¶ï¼Œè¿™ç±»æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨Ræ–‡ä»¶ä¸­ç”Ÿæˆèµ„æºæ–‡ä»¶çš„16è¿›åˆ¶å€¼ã€‚ä¾‹å¦‚ï¼š</p><pre><code class="java">public final class R &#123;    public static final class anim &#123;ã€€ã€€ã€€ã€€  public static final int abc_fade_in=0x7f050000; ã€€ã€€ã€€ã€€ public static final int abc_fade_in=0x7f050000;ã€€ã€€ã€€ã€€  ...     &#125; &#125;</code></pre><p>å¹³æ—¶å¼€å‘æ—¶ï¼Œè®¿é—®è¿™ç±»èµ„æºæ¯”è¾ƒç®€å•ï¼Œåªè¦ç”¨<code>Context.getResource()</code>æ–¹æ³•å³å¯ã€‚</p><p>ç¬¬äºŒç±»æ˜¯ assets ç›®å½•ä¸‹å­˜æ”¾çš„èµ„æºæ–‡ä»¶ã€‚APK æ‰“åŒ…æ—¶å¹¶ä¸ä¼šå¤„ç†è¿™äº›èµ„æºï¼Œè€Œæ˜¯ç›´æ¥å°†å…¶æ‰“åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œåªèƒ½ç”¨<code>AssetManager.open()</code>æ–¹æ³•æ¥å®ç°å¯¹ assets ç›®å½•ä¸‹èµ„æºæ–‡ä»¶çš„è®¿é—®ã€‚å¦‚ä¸‹ï¼š</p><pre><code class="java">Resource resource = getResource();AssetsManager am = getResource().getAssets();InputStream is  = getResource().getAssets().open(&quot;filename&quot;);</code></pre><p>é€šè¿‡å¯¹è¿™ä¸¤ç±»èµ„æºçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥åˆæ­¥åšå‡ºä¸€ä¸ªç»“è®ºï¼šæˆ‘ä»¬èƒ½ä½¿ç”¨çš„ Resources ç±»æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç±»ï¼Œé€šè¿‡æ­¤ç±»æä¾›çš„ç›¸å…³ API ï¼Œæˆ‘ä»¬èƒ½æ“ä½œèµ„æºçš„åŠ è½½ã€‚</p><p>è°ˆåŠèµ„æºæ’ä»¶åŒ–ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¯¹ AssetsManager çš„ API å¤šè¯´ä¸€äº›ã€‚</p><p>AssetsManager ä¸­æœ‰ä¸€ä¸ª<code>addAssetsPath(String Path)</code>æ–¹æ³•ï¼ŒApp å¯åŠ¨çš„æ—¶å€™å°±ä¼šå°†å½“å‰çš„ apk è·¯å¾„ä¼ è¿›å»ï¼Œæ¥ä¸‹æ¥ AssetsManager å’Œ Resources å°±èƒ½è®¿é—®å½“å‰ apk çš„æ‰€æœ‰èµ„æºäº†ã€‚</p><p>AssetsManager çš„<code>addAssetsPath</code>æ–¹æ³•ä¸å¯¹å¤–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„çš„æ–¹å¼ï¼ŒæŠŠæ’ä»¶ apk çš„è·¯å¾„ä¼ åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™æ ·å°±æŠŠæ’ä»¶çš„èµ„æºæ·»åŠ åˆ°ä¸€ä¸ªèµ„æºæ± ä¸­äº†ã€‚App æœ‰å‡ ä¸ªæ’ä»¶ï¼Œæˆ‘ä»¬å°±è°ƒç”¨å‡ æ¬¡<code>addAssetsPath</code>æ–¹æ³•ï¼ŒæŠŠæ’ä»¶çš„èµ„æºéƒ½å¡åˆ°æ± å­é‡Œã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼Œæ¯”å¦‚åœ¨æ’ä»¶çš„ apk é‡Œå­˜åœ¨ä¸€ä¸ªåä¸º<code>plugin_s_1</code>çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨å®¿ä¸»ä¸­è®¿é—®å®ƒã€‚</p><p>å…ˆç†é¡ºä¸€ä¸‹æ€è·¯ï¼š</p><ol><li>å…ˆè¦åˆ›å»º AssetManager å¯¹è±¡ï¼Œè¯»å–æ’ä»¶ä¸­çš„èµ„æº</li><li>ç”¨ DexClassLoader åŠ è½½æ’ä»¶ï¼Œå¹¶ç”Ÿæˆè¯¥æ’ä»¶å¯¹åº”çš„ ClassLoader</li><li>åå°„è·å–æ’ä»¶ä¸­çš„ç±»ï¼Œå¹¶å°†å…¶å®ä¾‹åŒ–ï¼Œå°±å¯ä»¥è®©æ’ä»¶ç±»è¯»å–æ’ä»¶èµ„æºäº†</li></ol><p>å†™æˆä»£ç å¯ä»¥å¦‚ä¸‹ï¼š</p><pre><code class="java">public class MainActivity extends Activity &#123;    private AssetManager mAssetManager;    private Resources mResources;    private Resources.Theme mTheme;    private String dexPath = null;    //apkæ–‡ä»¶åœ°å€    private File fileRelease = null;  //é‡Šæ”¾ç›®å½•    protected DexClassLoader classLoader = null;    private String pluginName = &quot;plugin1.apk&quot;;    TextView mTextView;    @Override    protected void attachBaseContext(Context newBase) &#123;        super.attachBaseContext(newBase);        // åœ¨attachBaseContextæ—¶å°±æ‹·è´æ’ä»¶æ–‡ä»¶ï¼Œä»¥ä¾¿åé¢è¿›è¡Œæ“ä½œ        extractAssets(newBase, pluginName);    &#125;    @SuppressLint(&quot;NewApi&quot;)    @Override    protected void onCreate(Bundle savedInstanceState) &#123;        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        File extractFile = this.getFileStreamPath(pluginName);        dexPath = extractFile.getPath();        fileRelease = getDir(&quot;dex&quot;, 0);        // æ–°å»º DexClassLoader        classLoader = new DexClassLoader(dexPath, fileRelease.getAbsolutePath(), null, getClassLoader());        mTextView = findViewById(R.id.tv);        // å¯¹èµ„æºæ–‡ä»¶çš„è°ƒç”¨        findViewById(R.id.btn).setOnClickListener(new View.OnClickListener() &#123;            @Override            public void onClick(View v) &#123;                loadResources();                try &#123;                    Class mLoadClassDynamic = classLoader.loadClass(&quot;com.plugin1.Dynamic&quot;);                    Object dynamicObject = mLoadClassDynamic.newInstance();                    IDynamic dynamic = (IDynamic) dynamicObject;                    String content = dynamic.getStringForResId(MainActivity.this);                    mTextView.setText(content);                    Toast.makeText(getApplicationContext(), content + &quot;&quot;, Toast.LENGTH_LONG).show();                &#125; catch (Exception e) &#123;                    e.printStackTrace();                &#125;            &#125;        &#125;);    &#125;    protected void loadResources() &#123;        try &#123;            AssetManager assetManager = AssetManager.class.newInstance();            Method addAssetPath = assetManager.getClass().getMethod(&quot;addAssetPath&quot;, String.class);            addAssetPath.invoke(assetManager, dexPath);            mAssetManager = assetManager;        &#125; catch (Exception e) &#123;            e.printStackTrace();        &#125;        Resources superRes = super.getResources();        superRes.getDisplayMetrics();        superRes.getConfiguration();        mResources = new Resources(mAssetManager, superRes.getDisplayMetrics(), superRes.getConfiguration());        mTheme = mResources.newTheme();        mTheme.setTo(super.getTheme());    &#125;    @Override    public AssetManager getAssets() &#123;        return mAssetManager == null ? super.getAssets() : mAssetManager;    &#125;    @Override    public Resources getResources() &#123;        return mResources == null ? super.getResources() : mResources;    &#125;    @Override    public Resources.Theme getTheme() &#123;        return mTheme == null ? super.getTheme() : mTheme;    &#125;    /**     * æŠŠAssetsé‡Œé¢å¾—æ–‡ä»¶å¤åˆ¶åˆ° /data/data/files ç›®å½•ä¸‹     *     * @param context     * @param sourceName     */    public static void extractAssets(Context context, String sourceName) &#123;        AssetManager am = context.getAssets();        InputStream is = null;        FileOutputStream fos = null;        try &#123;            is = am.open(sourceName);            File extractFile = context.getFileStreamPath(sourceName);            fos = new FileOutputStream(extractFile);            byte[] buffer = new byte[1024];            int count = 0;            while ((count = is.read(buffer)) &gt; 0) &#123;                fos.write(buffer, 0, count);            &#125;            fos.flush();        &#125; catch (IOException e) &#123;            e.printStackTrace();        &#125; finally &#123;            closeSilently(is);            closeSilently(fos);        &#125;    &#125;    private static void closeSilently(Closeable closeable) &#123;        if (closeable == null) &#123;            return;        &#125;        try &#123;            closeable.close();        &#125; catch (Throwable e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><p>åŸºäºè¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨æ’ä»¶èµ„æºæ›¿æ¢å½“å‰æ˜¾ç¤ºçš„å†…å®¹ï¼Œå®ç°æ¢è‚¤æ•ˆæœï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p><h2 id="ä¸‰ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†"><a href="#ä¸‰ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†" class="headerlink" title="ä¸‰ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†"></a>ä¸‰ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</h2><p>Android ä¸­çš„å››å¤§ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç”±ç³»ç»Ÿç®¡ç†çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å»ç†ä¼šï¼Œä½†æ˜¯åœ¨æ’ä»¶ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯æ„é€ å‡ºä¸€ä¸ªå®ä¾‹æ˜¯æ²¡ç”¨çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ¥ç®¡å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚å…¶ä¸­ Activity çš„ç”Ÿå‘½å‘¨æœŸæœ€ä¸ºå¤æ‚ï¼Œä½¿ç”¨çš„ä¹Ÿæœ€å¤šï¼Œæˆ‘ä»¬æ¥ä»¥æ­¤ä¸ºä¾‹è®²ä¸€ä¸‹æ’ä»¶åŒ–å¦‚ä½•ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>æ’ä»¶åŒ–ç®¡ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¤§è‡´åˆ†ä¸ºä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š</p><h3 id="ProxyActivity"><a href="#ProxyActivity" class="headerlink" title="ProxyActivity"></a>ProxyActivity</h3><p>é€šè¿‡<strong>ä»£ç†æ–¹å¼</strong>æ¥ç®¡ç†æ’ä»¶ä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ–¹å¼æœ€æ—©ç”± dynamic-load-apk æå‡ºï¼Œå®ƒçš„æ€è·¯æ˜¯åœ¨ä¸»å·¥ç¨‹ä¸­åšä¸€ä¸ª ProxyActivityï¼Œå¯åŠ¨æ’ä»¶ä¸­çš„ Activity æ—¶ä¼šå…ˆå¯åŠ¨ ProxyActivityï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º Activityï¼Œå¹¶åŒæ­¥ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://pic1.zhimg.com/80/v2-9cb17820f51c69637de66afc0105b664_720w.jpg"></p><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆéœ€è¦é€šè¿‡<strong>ç»Ÿä¸€çš„å…¥å£ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„ PluginManagerï¼‰å¯åŠ¨æ’ä»¶ Activity</strong>ï¼Œå…¶å†…éƒ¨ä¼šå°†å¯åŠ¨çš„æ’ä»¶Activityä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œå¹¶å°† intent æ›¿æ¢ä¸ºå¯åŠ¨ ProxyActivity çš„intentã€‚</li><li>ProxyActivity æ ¹æ®æ’ä»¶çš„ä¿¡æ¯æ‹¿åˆ°è¯¥æ’ä»¶çš„ ClassLoader å’Œ Resourceï¼Œé€šè¿‡åå°„åˆ›å»º PluginActivity å¹¶è°ƒç”¨å…¶<code>onCreate()</code>æ–¹æ³•ã€‚</li><li>PluginActivty è°ƒç”¨çš„<code>setContentView()</code>è¢«é‡å†™äº†ï¼Œä¼šå»è°ƒç”¨ ProxyActivty çš„<code>setContentView()</code>ã€‚ç”±äº ProxyActivity é‡å†™äº†<code>getResource()</code>è¿”å›çš„æ˜¯æ’ä»¶çš„ Resourceï¼Œæ‰€ä»¥<code>setContentView()</code>èƒ½å¤Ÿè®¿é—®åˆ°æ’ä»¶ä¸­çš„èµ„æºã€‚åŒæ ·<code>findViewById()</code>ä¹Ÿæ˜¯è°ƒç”¨ProxyActivity çš„ã€‚</li><li>åœ¨ ProxyActivity ä¸­æ‰§è¡Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨ PluginActivity ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</li></ol><p>åœ¨å®ç°è¿™ç§æ–¹å¼æ—¶ï¼ŒProxyActivity ä¸­éœ€è¦é‡å†™<code>getResouces()</code>ã€<code>getAssets()</code>ã€<code>getClassLoader()</code>æ–¹æ³•è¿”å›æ’ä»¶çš„ç›¸åº”å¯¹è±¡ã€‚ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥åŠå’Œç”¨æˆ·äº¤äº’ç›¸å…³å‡½æ•°ï¼Œå¦‚<code>onResume()</code>ã€<code>onStop()</code>ã€<code>onBackPressed()</code>ç­‰éœ€è¦è½¬å‘ç»™æ’ä»¶ Activityã€‚åŒæ—¶ï¼ŒPluginActivity ä¸­æ‰€æœ‰ä¸ Context çš„ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚<code>setContentView()</code>ã€<code>getLayoutInflater()</code>ã€<code>getSystemService()</code>ç­‰éƒ½éœ€è¦è°ƒç”¨ ProxyActivity ä¸­çš„ç›¸åº”æ–¹æ³•ã€‚</p><p>ç¼ºç‚¹ï¼šè¿™ç§æ–¹å¼ï¼Œæ’ä»¶ä¸­çš„æ‰€æœ‰ Activity å¿…é¡»ç»§æ‰¿è‡ª PluginActivityï¼Œå¼€å‘çš„ä¾µå…¥æ€§å¼ºã€‚å¦‚æœæŸä¸ª Activity è¿˜éœ€è¦ç‰¹åˆ«çš„å¯åŠ¨æ¨¡å¼ï¼Œé‚£è¿˜éœ€è¦è‡ªå·±ç®¡ç† Activity æ ˆï¼Œå®ç°èµ·æ¥å¾ˆå¤æ‚ã€‚æ’ä»¶ä¸­å¦‚æœè¦ç”¨åˆ° Contextï¼Œå¿…é¡»ç”±å®¿ä¸»æ¥å®ç°ã€‚</p><p>åœ¨ dynamic-load-apk ä¹‹åï¼Œå¾ˆå°‘æœ‰æ’ä»¶åŒ–æ–¹æ¡ˆä¼šè¿™ä¹ˆåšäº†ã€‚</p><h3 id="Hook-Activity"><a href="#Hook-Activity" class="headerlink" title="Hook Activity"></a>Hook Activity</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨ Activity çš„ï¼š</p><p><img src="https://pic3.zhimg.com/80/v2-99654057a348ceea14bb63b9f789795a_720w.jpg"></p><p>ç®€å•æè¿°ä¸€ä¸‹æ­¥éª¤ã€‚</p><ol><li>æŸå¤„è°ƒç”¨<code>startActivity()</code>æ–¹æ³•ï¼Œå®é™…ä¼šè°ƒç”¨<code>Instrumentation.execStartActivity()</code>æ–¹æ³•ã€‚</li><li>é€šè¿‡è·¨è¿›ç¨‹çš„ binder è°ƒç”¨ï¼Œè¿›å…¥åˆ° ActivityManagerService ä¸­ï¼Œå…¶å†…éƒ¨ä¼šå¤„ç† Activity æ ˆã€‚ä¹‹ååˆé€šè¿‡è·¨è¿›ç¨‹è°ƒç”¨è¿›å…¥åˆ° Activity2æ‰€åœ¨çš„è¿›ç¨‹ä¸­ã€‚</li><li>ApplicationThread æ˜¯ä¸€ä¸ª binder å¯¹è±¡ï¼Œå…¶è¿è¡Œåœ¨ binder çº¿ç¨‹æ± ä¸­ï¼Œå†…éƒ¨åŒ…å«ä¸€ä¸ª H ç±»ï¼Œè¯¥ç±»ç»§æ‰¿äºç±» Handlerã€‚ApplicationThread å°†å¯åŠ¨ Activity2 çš„ä¿¡æ¯é€šè¿‡ H å¯¹è±¡å‘é€ç»™ä¸»çº¿ç¨‹ã€‚</li><li>ä¸»çº¿ç¨‹æ‹¿åˆ° Activity2 çš„ä¿¡æ¯åï¼Œæ‰§è¡Œ<code>Instrumentation.newActivity()</code>æ–¹æ³•ï¼Œå…¶å†…é€šè¿‡ ClassLoader åå°„åˆ›å»º Activity2 å®ä¾‹ã€‚</li></ol><p>å¦‚æœæ˜¯è¿™ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦å…³å¿ƒä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æ’ä»¶ä¸­çš„ Activityæ²¡æœ‰åœ¨ AndroidManifest ä¸­æ³¨å†Œï¼Œå¦‚ä½•ç»•è¿‡æ£€æµ‹ï¼›</li><li>å¦‚ä½•æ„é€ Activityå®ä¾‹ï¼ŒåŒæ­¥ç”Ÿå‘½å‘¨æœŸã€‚</li></ul><p>è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬ä»¥ VirtualApk ä¸ºä¾‹ï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>å…ˆåœ¨ Manifest ä¸­<strong>é¢„åŸ‹ StubActivity</strong>ï¼Œå¯åŠ¨æ—¶ hook ä¸Šå›¾ç¬¬1æ­¥ï¼Œå°† Intent çš„ç›®æ ‡ Activity æ›¿æ¢æˆ StubActivityã€‚</li><li>hook ç¬¬10æ­¥ï¼Œé€šè¿‡æ’ä»¶çš„ ClassLoader åå°„åˆ›å»ºæ’ä»¶ Activity</li><li>ä¹‹å Activity çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒéƒ½ä¼šé€šçŸ¥ç»™æ’ä»¶ Activity</li></ol><p>VirtualAPK åœ¨åˆå§‹åŒ–æ—¶ä¼šè°ƒç”¨<code>hookInstrumentationAndHandler()</code>ï¼Œè¯¥æ–¹æ³•hookäº†ç³»ç»Ÿçš„ Instrumentaiton ç±»ï¼Œç”±ä¸Šæ–‡å¯çŸ¥è¯¥ç±»å’ŒActivityçš„å¯åŠ¨æ¯æ¯ç›¸å…³ï¼š</p><pre><code class="java">protected void hookInstrumentationAndHandler() &#123;    try &#123;        ActivityThread activityThread = ActivityThread.currentActivityThread();        Instrumentation baseInstrumentation = activityThread.getInstrumentation();        final VAInstrumentation instrumentation = createInstrumentation(baseInstrumentation);                Reflector.with(activityThread).field(&quot;mInstrumentation&quot;).set(instrumentation);        Handler mainHandler = Reflector.with(activityThread).method(&quot;getHandler&quot;).call();        Reflector.with(mainHandler).field(&quot;mCallback&quot;).set(instrumentation);        this.mInstrumentation = instrumentation;        Log.d(TAG, &quot;hookInstrumentationAndHandler succeed : &quot; + mInstrumentation);    &#125; catch (Exception e) &#123;        Log.w(TAG, e);    &#125;&#125;</code></pre><p>è¯¥æ®µä»£ç å°†ä¸»çº¿ç¨‹ä¸­çš„<code>mInstrumentation</code>å¯¹è±¡æ›¿æ¢æˆäº†è‡ªå®šä¹‰çš„ VAInstrumentation ç±»ã€‚åœ¨å¯åŠ¨å’Œåˆ›å»ºæ’ä»¶ Activity æ—¶ï¼ŒVAInstrumentation éƒ½ä¼šå·å·åšä¸€äº›æ‰‹è„šï¼Œæˆ‘ä»¬ç®€å•çœ‹çœ‹ï¼š</p><pre><code class="java">@Overridepublic ActivityResult execStartActivity(Context who, IBinder contextThread, IBinder token, Activity target, Intent intent, int requestCode) &#123;    injectIntent(intent);    return mBase.execStartActivity(who, contextThread, token, target, intent, requestCode);&#125;...@Overridepublic void callActivityOnCreate(Activity activity, Bundle icicle, PersistableBundle persistentState) &#123;    injectActivity(activity);    mBase.callActivityOnCreate(activity, icicle, persistentState);&#125;</code></pre><p>å·æ¢æ¢æŸ±çš„å·¥ä½œå¦‚ä¸‹ï¼š</p><pre><code class="java">protected void injectIntent(Intent intent) &#123;    // å°† Intent è½¬æ¢ä¸ºæ˜¾å¼ Intent    mPluginManager.getComponentsHandler().transformIntentToExplicitAsNeeded(intent);    // å¦‚æœ Component ä¸º nullï¼Œè¯´æ˜æ˜¯éšå¼ Intent    if (intent.getComponent() != null) &#123;        Log.i(TAG, String.format(&quot;execStartActivity[%s : %s]&quot;, intent.getComponent().getPackageName(), intent.getComponent().getClassName()));        // resolve intent with Stub Activity if needed        this.mPluginManager.getComponentsHandler().markIntentIfNeeded(intent);    &#125;&#125;...protected void injectActivity(Activity activity) &#123;    final Intent intent = activity.getIntent();    if (PluginUtil.isIntentFromPlugin(intent)) &#123;        Context base = activity.getBaseContext();        try &#123;            LoadedPlugin plugin = this.mPluginManager.getLoadedPlugin(intent);            Reflector.with(base).field(&quot;mResources&quot;).set(plugin.getResources());            Reflector reflector = Reflector.with(activity);            reflector.field(&quot;mBase&quot;).set(plugin.createPluginContext(activity.getBaseContext()));            reflector.field(&quot;mApplication&quot;).set(plugin.getApplication());            // set screenOrientation            ActivityInfo activityInfo = plugin.getActivityInfo(PluginUtil.getComponent(intent));            if (activityInfo.screenOrientation != ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED) &#123;                activity.setRequestedOrientation(activityInfo.screenOrientation);            &#125;            // for native activity            ComponentName component = PluginUtil.getComponent(intent);            Intent wrapperIntent = new Intent(intent);            wrapperIntent.setClassName(component.getPackageName(), component.getClassName());            activity.setIntent(wrapperIntent);                    &#125; catch (Exception e) &#123;            Log.w(TAG, e);        &#125;    &#125;&#125;</code></pre><p>ç”¨è¿™ç§æ–¹å¼æ¬ºéª—äº†ç³»ç»Ÿï¼Œè®©ç³»ç»Ÿè¯¯ä»¥ä¸ºè¿™æ˜¯ä¸ªæ­£å¸¸çš„ Activityï¼Œåœ¨ Activity æ ˆä¸­ä¹Ÿä¼šå‡ºç°è¿™ä¸ªæ’ä»¶ Activityã€‚åŒæ—¶ï¼Œä¸ºäº†è®©è¿™ä¸ªæ’ä»¶ Activity èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œè¿˜éœ€è¦åšä¸€äº›æ›¿æ¢å·¥ä½œï¼Œå¦‚ Resourceã€Contextã€Application ç­‰ã€‚ä¹‹åï¼Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¼šç”± AMS ä¼ é€’ç»™æ’ä»¶ Activity çš„å®ä¾‹ã€‚</p><h2 id="å››ã€æ¯”è¾ƒçŸ¥åçš„æ’ä»¶åŒ–åº“"><a href="#å››ã€æ¯”è¾ƒçŸ¥åçš„æ’ä»¶åŒ–åº“" class="headerlink" title="å››ã€æ¯”è¾ƒçŸ¥åçš„æ’ä»¶åŒ–åº“"></a>å››ã€æ¯”è¾ƒçŸ¥åçš„æ’ä»¶åŒ–åº“</h2><p>ç°åœ¨å·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„æ’ä»¶åŒ–åº“äº†ï¼Œç®€å•ä»‹ç»å‡ ä¸ªã€‚</p><h3 id="1-DynamicLoadApk"><a href="#1-DynamicLoadApk" class="headerlink" title="1. DynamicLoadApk"></a>1. DynamicLoadApk</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸è‘—åçš„åŠ¨æ€åŠ è½½åº“ã€‚ä½œè€…æ˜¯æ¯”è¾ƒæœ‰åçš„ Android ä¸“å®¶ä»»ç‰åˆšã€‚å®ƒçš„è®¾è®¡æ€è·¯å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/66.png"></p><p>å®ƒæ€»ä½“ä¸Šåˆ†ä¸ºå››ä¸ªæ¨¡å—ï¼š</p><ol><li>DLPluginManagerã€‚æ’ä»¶ç®¡ç†æ¨¡å—ï¼Œè´Ÿè´£æ’ä»¶çš„åŠ è½½ã€ç®¡ç†ä»¥åŠå¯åŠ¨æ’ä»¶ç»„ä»¶ã€‚</li><li>Proxyã€‚ä»£ç†ç»„ä»¶æ¨¡å—ï¼Œç›®å‰åŒ…æ‹¬ DLProxyActivity(ä»£ç† Activity)ã€DLProxyFragmentActivity(ä»£ç† FragmentActivity)ã€DLProxyService(ä»£ç† Service)ã€‚</li><li>ProxyImplã€‚ä»£ç†ç»„ä»¶å…¬ç”¨é€»è¾‘æ¨¡å—ï¼Œä¸ Proxy ä¸åŒçš„æ˜¯ï¼Œè¿™éƒ¨åˆ†å¹¶ä¸æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè€Œæ˜¯è´Ÿè´£æ„å»ºã€åŠ è½½æ’ä»¶ç»„ä»¶çš„ç®¡ç†å™¨ã€‚è¿™äº› ProxyImpl é€šè¿‡åå°„å¾—åˆ°æ’ä»¶ç»„ä»¶ï¼Œç„¶åå°†æ’ä»¶ä¸ Proxy ç»„ä»¶å»ºç«‹å…³è”ï¼Œæœ€åè°ƒç”¨æ’ä»¶ç»„ä»¶çš„ onCreate å‡½æ•°è¿›è¡Œå¯åŠ¨ã€‚</li><li>Base Pluginã€‚æ’ä»¶ç»„ä»¶çš„åŸºç±»æ¨¡å—ï¼Œç›®å‰åŒ…æ‹¬ DLBasePluginActivity(æ’ä»¶ Activity çš„åŸºç±»)ã€DLBasePluginFragmentActivity(æ’ä»¶ FragmentActivity çš„åŸºç±»)ã€DLBasePluginService(æ’ä»¶ Service çš„åŸºç±»)ã€‚</li></ol><p>å®ƒçš„è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/img/67.png"></p><p>ä¸Šé¢æ˜¯è°ƒç”¨æ’ä»¶ Activity çš„æµç¨‹å›¾ï¼Œå…¶ä»–ç»„ä»¶è°ƒç”¨æµç¨‹ç±»ä¼¼ã€‚</p><ol><li>é¦–å…ˆé€šè¿‡ DLPluginManager çš„<code>loadApk()</code>æ–¹æ³•åŠ è½½æ’ä»¶ï¼Œè¿™æ­¥æ¯ä¸ªæ’ä»¶åªéœ€è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>é€šè¿‡ DLPluginManager çš„<code>startPluginActivity()</code>æ–¹æ³•å¯åŠ¨ä»£ç† Activityã€‚</li><li>ä»£ç† Activity å¯åŠ¨è¿‡ç¨‹ä¸­æ„å»ºã€å¯åŠ¨æ’ä»¶ Activityã€‚</li></ol><p>ä½†æ˜¯ç”±äº Android P ä¹‹åï¼Œç³»ç»Ÿç¦æ­¢è°ƒç”¨ç§æœ‰ APIï¼ˆç»è¿‡ @hide ä¿®é¥°çš„æ–¹æ³•ï¼‰ï¼Œè¿™ä¸ªåº“ä¹Ÿå°±æ¸æ¸çš„å¤±å»äº†å®ƒçš„èƒ½åŠ›ã€‚</p><h3 id="2-Small"><a href="#2-Small" class="headerlink" title="2. Small"></a>2. Small</h3><p>å®ƒé‡‡å–çš„æ–¹å¼ä¸ Virtual ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…ˆåœ¨ AndroidManifest ä¸­åŸ‹ä¸‹ä¸€ä¸ªç‰¹æ®Šå‘½åçš„ Activity æ¥æ¬ºéª— Instrumentationï¼Œç”¨ä»¥è·å¾—ç”Ÿå‘½å‘¨æœŸã€‚ç„¶åé€šè¿‡æ›¿æ¢ Instrumentation çš„æ–¹å¼æ¥åˆ›å»ºæ–° Activity çš„å®ä¾‹ã€‚</p><h3 id="3-rePlugin"><a href="#3-rePlugin" class="headerlink" title="3. rePlugin"></a>3. rePlugin</h3><p>è¿™æ˜¯ 360 å…¬å¸ç ”å‘çš„æ’ä»¶åŒ–ç³»ç»Ÿã€‚å®ƒé€‰æ‹©äº† hook ç³»ç»Ÿçš„ ClassLoaderï¼Œå½“å¯åŠ¨ Activity æ—¶ï¼Œå¦‚æœåˆ¤æ–­è¦å¯åŠ¨çš„ Activity æ˜¯æ’ä»¶ Activityï¼Œä¼šé€šè¿‡æ’ä»¶ä¸­çš„ ClassLoader æ¥åˆ›å»ºç›¸åº”çš„å¯¹è±¡ã€‚åŒæ—¶ï¼Œå®ƒä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé€‰æ‹©äº†å°‘ hookï¼Œå¹¶æ²¡æœ‰ hook <code>startActivity()</code>æ–¹æ³•ï¼Œè€Œæ˜¯é‡å†™äº†<code>startActivity()</code>ã€‚æ‰€ä»¥ï¼Œæ’ä»¶ Activity ä¹Ÿå¿…é¡»è¦ç»§æ‰¿è‡ªä¸€ä¸ªç±»ä¼¼ PluginActivity çš„åŸºç±»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> æ’ä»¶åŒ– </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºç»„ä»¶åŒ–</title>
      <link href="/2023-01-31/componentization/"/>
      <url>/2023-01-31/componentization/</url>
      
        <content type="html"><![CDATA[<p>éšç€APPç‰ˆæœ¬ä¸æ–­çš„è¿­ä»£ï¼Œæ–°åŠŸèƒ½çš„ä¸æ–­å¢åŠ ï¼Œä¸šåŠ¡ä¹Ÿä¼šå˜çš„è¶Šæ¥è¶Šå¤æ‚ï¼ŒAPPä¸šåŠ¡æ¨¡å—çš„æ•°é‡æœ‰å¯èƒ½è¿˜ä¼šç»§ç»­å¢åŠ ï¼Œè€Œä¸”æ¯ä¸ªæ¨¡å—çš„ä»£ç ä¹Ÿå˜çš„è¶Šæ¥è¶Šå¤šï¼Œè¿™æ ·å‘å±•ä¸‹å»å•ä¸€å·¥ç¨‹ä¸‹çš„APPæ¶æ„åŠ¿å¿…ä¼šå½±å“å¼€å‘æ•ˆç‡ï¼Œå¢åŠ é¡¹ç›®çš„ç»´æŠ¤æˆæœ¬ï¼Œæ¯ä¸ªå·¥ç¨‹å¸ˆéƒ½è¦ç†Ÿæ‚‰å¦‚æ­¤ä¹‹å¤šçš„ä»£ç ï¼Œå°†å¾ˆéš¾è¿›è¡Œå¤šäººåä½œå¼€å‘ï¼Œè€Œä¸”Androidé¡¹ç›®åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ç”µè„‘ä¼šéå¸¸å¡ï¼Œåˆå› ä¸ºå•ä¸€å·¥ç¨‹ä¸‹ä»£ç è€¦åˆä¸¥é‡ï¼Œæ¯ä¿®æ”¹ä¸€å¤„ä»£ç åéƒ½è¦é‡æ–°ç¼–è¯‘æ‰“åŒ…æµ‹è¯•ï¼Œå¯¼è‡´éå¸¸è€—æ—¶ï¼Œæœ€é‡è¦çš„æ˜¯è¿™æ ·çš„ä»£ç æƒ³è¦åšå•å…ƒæµ‹è¯•æ ¹æœ¬æ— ä»ä¸‹æ‰‹ï¼Œæ‰€ä»¥å¿…é¡»è¦æœ‰æ›´çµæ´»çš„æ¶æ„ä»£æ›¿è¿‡å»å•ä¸€çš„å·¥ç¨‹æ¶æ„ã€‚</p><span id="more"></span><h2 id="ä¸ºä»€ä¹ˆé‡‡ç”¨ç»„ä»¶åŒ–"><a href="#ä¸ºä»€ä¹ˆé‡‡ç”¨ç»„ä»¶åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆé‡‡ç”¨ç»„ä»¶åŒ–"></a>ä¸ºä»€ä¹ˆé‡‡ç”¨ç»„ä»¶åŒ–</h2><p>æˆ‘ä»¬ä»ä¸¤ä¸ªè§’åº¦æ¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="å•ä¸€å·¥ç¨‹æ¨¡å¼å¼€å‘çš„ç—›ç‚¹"><a href="#å•ä¸€å·¥ç¨‹æ¨¡å¼å¼€å‘çš„ç—›ç‚¹" class="headerlink" title="å•ä¸€å·¥ç¨‹æ¨¡å¼å¼€å‘çš„ç—›ç‚¹"></a>å•ä¸€å·¥ç¨‹æ¨¡å¼å¼€å‘çš„ç—›ç‚¹</h3><ol><li><p>å¯¹å·¥ç¨‹çš„ä»»æ„ä¿®æ”¹è°ƒè¯•éƒ½è¦ç¼–è¯‘æ•´ä¸ªå·¥ç¨‹ï¼Œæ•ˆç‡ååˆ†ä½ä¸‹ã€‚</p><p>åšAPPå¼€å‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸åœ¨æ‰‹æœºæˆ–æ¨¡æ‹Ÿå™¨ä¸Šè¿›è¡Œè°ƒè¯•ï¼Œè€Œæ¯æ¬¡è°ƒè¯•éƒ½éœ€è¦å¯¹æ•´ä¸ªå·¥ç¨‹è¿›è¡Œç¼–è¯‘ï¼Œç„¶åå®‰è£…åœ¨æ‰‹æœºä¸Šè¿è¡Œã€‚å³ä¾¿ä½ åªæ˜¯æ”¹äº†ä¸€å¥ä»£ç ï¼Œæˆ–æ˜¯UIè°ƒæ•´äº†ä¸€ä¸ªåƒç´ ç‚¹ï¼ŒåŒæ ·éœ€è¦å®Œæ•´çš„ç¼–è¯‘å·¥ç¨‹ã€‚å½“å·¥ç¨‹ä»£ç è¶Šæ¥è¶Šå¤šæ—¶ï¼Œç¼–è¯‘ä¹Ÿä¼šè¶Šæ¥è¶Šæ…¢ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹æˆ‘ä¿®æ”¹äº†æŸå¥ä»£ç ï¼Œç¼–è¯‘ä¸€ä¸‹éœ€è¦ç­‰å¾…4ã€5åˆ†é’Ÿæ‰èƒ½æˆåŠŸè¿è¡Œçš„åœºæ™¯ä¹ˆï¼Œé‚£ç®€ç›´è®©äººå´©æºƒï¼Œä¸¥é‡å½±å“äº†å¼€å‘æ•ˆç‡ï¼ˆæƒ³èµ·æ›¾ç»ç”¨eclipseå¼€å‘Androidæ—¶ï¼Œå„ç§è½¬èŠèŠ±ï¼Œå¡é¡¿å¾—è®©äººæƒ³æ­»çš„å¿ƒéƒ½æœ‰ï¼‰ã€‚</p></li><li><p>ä¸åˆ©äºå¤šäººå›¢é˜ŸååŒå¼€å‘ã€‚</p><p>æ—©æœŸä¸€ä¸ªAPPå¯èƒ½å°±1ã€2ä¸ªäººæ¥å¼€å‘ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„æ‰©å¼ ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘å±•åˆ°ä¸€ä¸ªå›¢é˜Ÿæ¥å¼€å‘ä¸€ä¸ªAPPï¼Œå°‘åˆ™4ã€5ä¸ªäººï¼Œå¤šåˆ™10å‡ ä¸ªäººç”šè‡³æ›´å¤šã€‚åƒæ‰‹æœºæ·˜å®ã€å¾®ä¿¡ã€æ”¯ä»˜å®è¿™äº›å·¨æ— éœ¸APPï¼Œä»–ä»¬çš„APPå¼€å‘äººå‘˜ä¼°è®¡èµ·ç æœ‰æ•°ç™¾ä¸ªã€‚</p><p>ä»¥10äººå›¢é˜Ÿä¸ºä¾‹ï¼Œå¦‚æœ10ä¸ªäººéƒ½æ˜¯åŸºäºåŒä¸€ä¸ªå·¥ç¨‹çš„ä»£ç æ‹‰åˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œæ¯äººçš„å¼€å‘ä»»åŠ¡è™½ç„¶ä¸åŒï¼Œä½†æ˜¯éƒ½èƒ½ä¿®æ”¹æ•´ä¸ªå·¥ç¨‹çš„ä»»æ„åœ°æ–¹ã€‚ä¸ºäº†é€‚åº”è‡ªå·±çš„éœ€æ±‚ï¼Œå›¢é˜Ÿå†…æŸäººæ”¹äº†æŸå¥ä»£ç ï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨åˆæœ‰å¯èƒ½å½±å“åˆ«äººçš„å¼€å‘ï¼Œè¿™æ ·å¼€å‘äººå‘˜ä¹‹é—´åŠ¿å¿…è¦èŠ±æ›´å¤šçš„æ—¶é—´å»æ²Ÿé€šå’Œåè°ƒï¼Œæ²¡æ³•ä¸“æ³¨è‡ªå·±çš„åŠŸèƒ½ç‚¹ã€‚æœ€åè¿›è¡Œ10ä¸ªäººçš„ä»£ç åˆå¹¶æ—¶ï¼Œæœ‰è¿‡è¿™æ–¹é¢ç»å†çš„äººï¼Œå°±çŸ¥é“è¿™æ˜¯ä¸€ä»¶å¤šä¹ˆç—›è‹¦çš„äº‹æƒ…ï¼Œè§£å†³å†²çªè§£å†³å¾—ä½ è¦æ€€ç–‘äººç”Ÿã€‚</p></li><li><p>æ— æ³•åšåˆ°åŠŸèƒ½å¤ç”¨ã€‚</p><p>æˆ‘æ›¾ç»åšè¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªå¼€é€šè¿™ä¸ªä¸šåŠ¡çš„åŸå¸‚ï¼Œéƒ½è¦åšä¸€ä¸ªå•ç‹¬çš„APPï¼ŒåˆæœŸæˆ‘ä»¬åªå¼€é€šäº†3ã€4ä¸ªåŸå¸‚ï¼Œéœ€è¦åŒæ—¶å‘å¸ƒ3ã€4ä¸ªAPPï¼Œè¿™äº›APPå¤§æ¦‚6ã€70%åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯éƒ½éœ€è¦åŠ å…¥åœ°æ–¹å®šåˆ¶åŠŸèƒ½ã€‚å¦‚æœä½ æ¯ä¸ªAPPéƒ½é‡‡ç”¨å•ä¸€å·¥ç¨‹æ¨¡å¼å¼€å‘ï¼Œåˆšå¼€å§‹ä½ å¯èƒ½æ¯ä¸ªå·¥ç¨‹éƒ½æœ‰åŒæ ·çš„ä»£ç å­˜åœ¨ï¼Œåªéœ€è¦å¤åˆ¶æ‹·è´ä¸€ä¸‹å°±è¡Œï¼Œä½†æ˜¯å¦‚æœæœ‰éœ€æ±‚è¦å¯¹è¿™äº›è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä½ å¿…é¡»å¾—æ¯ä¸ªå·¥ç¨‹éƒ½é€ä¸€ä¿®æ”¹ä¸€éï¼Œç„¶åæ¯ä¸ªAPPéƒ½æµ‹è¯•ä¸€éï¼Œå·¥ä½œé‡ç›´æ¥ç¿»äº†æ•°å€ã€‚</p></li><li><p>ä¸šåŠ¡æ¨¡å—é—´è€¦åˆä¸¥é‡ã€‚</p><p>é‡‡ç”¨å•ä¸€å·¥ç¨‹æ¨¡å¼å¼€å‘é¡¹ç›®ï¼Œåˆ°æœ€ååŠ¿å¿…ä¼šé€ æˆä¸šåŠ¡æ¨¡å—é«˜åº¦è€¦åˆï¼Œå¯ä»¥è¯´æ˜¯ä½ ä¸­æœ‰æˆ‘ã€æˆ‘ä¸­æœ‰ä½ ï¼Œä¿®æ”¹ä»»ä½•ä¸šåŠ¡éƒ½æœ‰å¯èƒ½å¯¼è‡´ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆ©äºåæœŸé¡¹ç›®åŠŸèƒ½ç»´æŠ¤ä»¥åŠè¿­ä»£å¼€å‘çš„ã€‚</p></li></ol><h3 id="ç»„ä»¶åŒ–å¼€å‘çš„ä¼˜ç‚¹"><a href="#ç»„ä»¶åŒ–å¼€å‘çš„ä¼˜ç‚¹" class="headerlink" title="ç»„ä»¶åŒ–å¼€å‘çš„ä¼˜ç‚¹"></a>ç»„ä»¶åŒ–å¼€å‘çš„ä¼˜ç‚¹</h3><ol><li>æå¤§æé«˜å·¥ç¨‹ç¼–è¯‘é€Ÿåº¦ã€‚è¿›è¡Œç»„ä»¶åŒ–æ‹†åˆ†åï¼Œæ¯ä¸ªä¸šåŠ¡æˆ–è€…åŠŸèƒ½éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„å·¥ç¨‹ï¼Œè¿™ä¸ªå•ç‹¬çš„å·¥ç¨‹å¯ä»¥ç‹¬ç«‹ç¼–è¯‘è¿è¡Œï¼Œæ‹†åˆ†åçš„å·¥ç¨‹é€šå¸¸éƒ½æ¯”è¾ƒå°ï¼Œä»£ç é‡ä¹Ÿæ¯”è¾ƒå°‘ï¼Œæˆ‘å†ä¹Ÿä¸ç”¨åƒä»¥å‰ç¼–è¯‘ä¸€ä¸‹å¾—ç­‰å¾…å¥½å‡ åˆ†é’Ÿäº†ã€‚</li><li>ä¸šåŠ¡æ¨¡å—è§£è€¦ï¼Œæœ‰åˆ©äºå¤šäººå›¢é˜Ÿåä½œå¼€å‘ã€‚ä¸šåŠ¡ç»„ä»¶ä¹‹é—´ä¸èƒ½ç›¸äº’å¼•ç”¨ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æŠŠå¯¹åº”çš„ä¸šåŠ¡åŠŸèƒ½æ”¶æ•›åœ¨ä¸€ä¸ªå·¥ç¨‹é‡Œï¼Œå½¼æ­¤äº’ä¸æ‰“æ‰°ã€‚ åœ¨å¤šäººå›¢é˜Ÿé‡Œï¼Œæ¯ä¸ªäººåªè´Ÿè´£è‡ªå·±çš„ä¸šåŠ¡æ¨¡å—ï¼Œä»–å¯¹ä¸šåŠ¡åŠŸèƒ½çš„å¢åˆ æ”¹æŸ¥ï¼Œéƒ½åªé™å®šåœ¨è‡ªå·±çš„è¿™ä¸ªä¸šåŠ¡æ¨¡å—é‡Œï¼Œä¸ä¼šå½±å“å…¶ä»–äººçš„ä¸šåŠ¡ï¼Œä»–ä»£ç è´¨é‡çš„å¥½åä¹Ÿåªä¼šå½±å“åˆ°è‡ªå·±çš„ä¸šåŠ¡æ¨¡å—ï¼›å¯¹æµ‹è¯•æ¥è¯´ï¼Œä¹Ÿååˆ†æ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç€é‡æµ‹è¯•ä¿®æ”¹è¿‡çš„ä¸šåŠ¡ç»„ä»¶å³å¯ï¼Œè€Œä¸ç”¨è€æ˜¯è¿›è¡Œå…¨éƒ¨å›å½’æµ‹è¯•ã€‚</li><li>ç»„ä»¶åŒ–æ˜¯åŠŸèƒ½é‡ç”¨çš„åŸºçŸ³ã€‚ä¸šåŠ¡ç»„ä»¶ç±»ä¼¼ä¸€ä¸ªä¸ªç§¯æœ¨ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç§¯æœ¨æ­å»ºå‡ºä¸åŒçš„æˆ¿å­ï¼ŒåŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒçš„APPã€‚æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤å¥½æ¯ä¸ªç»„ä»¶ï¼Œéœ€è¦ç”¨åˆ°è¯¥ç»„ä»¶çš„åŠŸèƒ½æ—¶ï¼Œä¸€å»ºå¼•ç”¨é›†æˆå°±å¯ä»¥äº†ã€‚</li></ol><p>å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´ç»„ä»¶åŒ–å¼€å‘åªæœ‰ä¼˜ç‚¹æ²¡æœ‰ç¼ºç‚¹ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ç»„ä»¶åŒ–å¼€å‘å‰æœŸå¯èƒ½è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´æ¥è¿›è¡Œæ¨¡å—æ‹†åˆ†ï¼›</li><li>ä¸€ä¸ªäººçš„å°é¡¹ç›®å®Œå…¨æ²¡å¿…è¦ç»„ä»¶åŒ–å¼€å‘ï¼Œé‚£æ ·åªä¼šç»™è‡ªå·±å¸¦æ¥æ›´å¤šçš„å·¥ä½œé‡ï¼›</li><li>ç»„ä»¶åŒ–å¯èƒ½ä¼šå¸¦æ¥æ›´å¤šé‡å¤çš„ä»£ç ï¼›</li><li>ç»„ä»¶åŒ–éœ€è¦è‰¯å¥½çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ€ä¹ˆæ‹†åˆ†ä¸šåŠ¡ï¼Œç»„ä»¶ä¹‹é—´æ€ä¹ˆé€šä¿¡ç­‰ç­‰ï¼Œéœ€è¦æœ‰ä¸ªé«˜æ°´å¹³çš„æ¶æ„å¸ˆç»Ÿç­¹å…¨å±€ï¼Œç»éªŒä¸è¶³çš„åŒå­¦ç›²ç›®è¿›è¡Œç»„ä»¶åŒ–åè€Œä¼šé€‚å¾—å…¶åï¼Œå¸¦æ¥æ›´å¤šçš„éº»çƒ¦ã€‚</li></ul><h2 id="ç»„ä»¶åŒ–æ¶æ„è®¾è®¡"><a href="#ç»„ä»¶åŒ–æ¶æ„è®¾è®¡" class="headerlink" title="ç»„ä»¶åŒ–æ¶æ„è®¾è®¡"></a>ç»„ä»¶åŒ–æ¶æ„è®¾è®¡</h2><p>åœ¨è¿›è¡Œç»„ä»¶åŒ–å¼€å‘ä¹‹å‰ï¼Œä¸€å®šè¦è®¾è®¡å¥½æ„æ¶æ–¹æ¡ˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¼šåˆ†ä¸ºè‡³å°‘4å±‚ï¼šAPPå£³å·¥ç¨‹ã€å¸¸è§„ä¸šåŠ¡ç»„ä»¶å±‚ã€åŸºç¡€/å…¬å…±ä¸šåŠ¡ç»„ä»¶å±‚å’ŒåŸºç¡€åŠŸèƒ½ç»„ä»¶å±‚ã€‚</p><p>ä¸‹é¢ä¸€ä¸ªå›¾ç¤ºæ„äº†ä¸€ä¸ªå·¥ç¨‹çš„å…¸å‹åˆ†å±‚ï¼š</p><p><img src="../img/64.png"></p><p>æˆ‘ä»¬æ¥ä»ä¸‹å¾€ä¸Šåˆ†æä¸€ä¸‹è¿™æ ·åˆ†å±‚çš„æ€è·¯ã€‚</p><ul><li><p><strong>åŸºç¡€åŠŸèƒ½ç»„ä»¶å±‚</strong></p><p>è¿™ä¸€å±‚çš„åŠŸèƒ½éƒ½æ˜¯æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œé€šå¸¸ä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå¯ä»¥è¯´è¿™äº›ç»„ä»¶æ˜¯ä¸€äº›é€šç”¨çš„å·¥å…·ç±»ã€‚ä¾‹å¦‚æ—¥å¿—è®°å½•ç»„ä»¶ï¼Œå®ƒåªæ˜¯æä¾›äº†æ—¥å¿—è®°å½•çš„èƒ½åŠ›ï¼Œä½ è¦è®°å½•ä»€ä¹ˆæ ·çš„æ—¥å¿—ï¼Œå®ƒå¹¶ä¸å…³å¿ƒï¼›ä¾‹å¦‚åŸºç¡€UIç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨å±€é€šç”¨çš„ UI èµ„æºåº“ï¼›ä¾‹å¦‚ç½‘ç»œæœåŠ¡ç»„ä»¶ï¼Œå®ƒå°è£…äº†ç½‘ç»œçš„è¯·æ±‚èƒ½åŠ›ï¼Œç­‰ç­‰ã€‚</p></li><li><p><strong>åŸºç¡€ä¸šåŠ¡ç»„ä»¶å±‚</strong></p><p>è¿™ä¸€å±‚å±‚ç»„ä»¶æ˜¯å¯¹ä¸€äº›ç³»ç»Ÿé€šç”¨çš„ä¸šåŠ¡èƒ½åŠ›è¿›è¡Œå°è£…çš„ç»„ä»¶ã€‚ä¾‹å¦‚å…¬å…±ä¸šåŠ¡ç»„ä»¶é‡Œï¼Œå¯ä»¥å°è£… BaseActivityã€BaseFragment ç­‰ï¼›ä¾‹å¦‚åˆ†äº«èƒ½åŠ›ç»„ä»¶ï¼Œæˆ‘å°è£…äº†å¾®ä¿¡ã€QQã€å¾®åšç­‰çš„åˆ†äº«èƒ½åŠ›ï¼Œå…¶ä»–ä¸šåŠ¡åªè¦é›†æˆè¯¥ç»„ä»¶å°±èƒ½è¿›è¡Œç›¸å…³åˆ†äº«ï¼›ä¾‹å¦‚å…±äº«å…¬å…±æ•°æ®ç»„ä»¶ï¼Œå¯ä»¥å°è£…åº”ç”¨èƒ½å¤Ÿå…¨å±€è®¿é—®çš„æ•°æ®ï¼Œå¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯ç­‰ã€‚</p></li><li><p><strong>å¸¸è§„ä¸šåŠ¡ç»„ä»¶</strong></p><p>è¯¥å±‚çš„ç»„ä»¶å°±æ˜¯æˆ‘ä»¬çœŸæ­£çš„ä¸šåŠ¡ç»„ä»¶äº†ã€‚æˆ‘ä»¬é€šå¸¸æŒ‰ç…§åŠŸèƒ½æ¨¡å—æ¥åˆ’åˆ†ä¸šåŠ¡ç»„ä»¶ï¼Œä¾‹å¦‚æ³¨å†Œç™»å½•ã€ç”¨æˆ·ä¸ªäººä¸­å¿ƒã€APPçš„é¦–é¡µæ¨¡å—ç­‰ã€‚è¿™é‡Œçš„æ¯ä¸ªä¸šåŠ¡ç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªå°çš„APPï¼Œå®ƒå¿…é¡»å¯ä»¥å•ç‹¬ç¼–è¯‘ï¼Œå•ç‹¬æ‰“åŒ…æˆAPKåœ¨æ‰‹æœºä¸Šè¿è¡Œã€‚</p></li><li><p><strong>æ ¸å¿ƒç®¡ç†ç»„ä»¶</strong></p><p>ä¸»è¦åŒ…æ‹¬è·¯ç”±æœåŠ¡ç»„ä»¶ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ç»„ä»¶ã€‚è·¯ç”±ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ç»„ä»¶é—´é€šä¿¡é—®é¢˜ï¼Œè€Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ç»„ä»¶çš„åˆå§‹åŒ–ç­‰é—®é¢˜ã€‚</p></li><li><p><strong>APPå£³å·¥ç¨‹</strong></p><p>å£³å·¥ç¨‹ä¾èµ–äº†éœ€è¦é›†æˆçš„ä¸šåŠ¡ç»„ä»¶ï¼Œå®ƒå¯èƒ½åªæœ‰ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•ä»£ç é€»è¾‘ã€‚æ ¹æ®ä½ çš„éœ€è¦é€‰æ‹©é›†æˆä½ çš„ä¸šåŠ¡ç»„ä»¶ï¼Œä¸åŒçš„ä¸šåŠ¡ç»„ä»¶å°±ç»„æˆäº†ä¸åŒçš„ APPã€‚</p></li></ul><p>åœ¨ç»„ä»¶ä¹‹é—´å¿…é¡»éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>åªèƒ½ä¸Šå±‚ç»„ä»¶å¼•ç”¨ä¸‹å±‚ç»„ä»¶ï¼Œä¸èƒ½åå‘ä¾èµ–ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µ</li><li>åŒä¸€å±‚ç»„ä»¶ä¹‹å‰ä¸èƒ½ç›¸äº’ä¾èµ–ï¼Œè¿™æ˜¯ä¸ºäº†ç»„ä»¶é—´å½»åº•è§£è€¦åˆ</li></ul><h2 id="ç»„ä»¶é—´çš„é€šä¿¡é—®é¢˜"><a href="#ç»„ä»¶é—´çš„é€šä¿¡é—®é¢˜" class="headerlink" title="ç»„ä»¶é—´çš„é€šä¿¡é—®é¢˜"></a>ç»„ä»¶é—´çš„é€šä¿¡é—®é¢˜</h2><p>åœ¨ç»„ä»¶åŒ–å®æ–½çš„è¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šé‡åˆ°å‡ ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><blockquote><p>æ€ä¹ˆä»è¿™ä¸ªç»„ä»¶è·³è½¬åˆ°å¦ä¸€ä¸ªç»„ä»¶çš„é¡µé¢<br>ç»„ä»¶ä¹‹é—´æ€ä¹ˆä¼ é€’æ•°æ®<br>æ€ä¹ˆè·å–å…¶ä»–ç»„ä»¶çš„æ•°æ®æˆ–æœåŠ¡<br>ç»„ä»¶æ€ä¹ˆé€šçŸ¥å…¶ä»–ç»„ä»¶å“åº”æŸä¸ªäº‹ä»¶</p></blockquote><p>è¿™äº›é—®é¢˜å¯ä»¥ç»Ÿç»Ÿå®šä¹‰ä¸ºï¼šç»„ä»¶ä¹‹é—´çš„é€šä¿¡é—®é¢˜ã€‚</p><p>æˆ‘ä»¬æ¥æŒ‰ç…§ä½¿ç”¨åœºæ™¯æ¥åˆ†æä¸€ä¸‹ã€‚</p><h3 id="é¡µé¢è·³è½¬"><a href="#é¡µé¢è·³è½¬" class="headerlink" title="é¡µé¢è·³è½¬"></a>é¡µé¢è·³è½¬</h3><p>åœ¨å•ä¸€å·¥ç¨‹ä¸­ï¼Œé¡µé¢è·³è½¬å¯ä»¥ç›´æ¥ç”¨<code>startActivity()</code>æ–¹æ³•è·³è½¬é¡µé¢ã€‚ä½†æ˜¯ç»„ä»¶åŒ–ä¹‹åï¼ŒåŒä¸€ç»„ä»¶å±‚çš„ç»„ä»¶æ˜¯ä¸èƒ½ç›¸äº’ä¾èµ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•å†é€šè¿‡<code>startActivity()</code>æ¥è¿›è¡Œè·³è½¬äº†ã€‚è¿™å°±å¿…é¡»è¦å¼•ç”¨ä¸€ä¸ªæ–°çš„æ€è·¯ï¼šé¡µé¢è·¯ç”±ã€‚</p><p>è·¯ç”±æ¡†æ¶ç°åœ¨æˆç†Ÿçš„æœ‰å¾ˆå¤šäº†ï¼Œæ¯”å¦‚<a href="https://tech.meituan.com/meituan_waimai_android_open_source_routing_framework.html">ç¾å›¢çš„WMRouter</a>å’Œ<a href="https://github.com/alibaba/ARouter">é˜¿é‡Œçš„ARouter</a>ã€‚</p><p>è·¯ç”±æ¡†æ¶çš„æ ¸å¿ƒåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬æ¥ç®€å•åˆ†æä¸€ä¸‹ã€‚</p><p>å®ç°æ€è·¯æ˜¯ä¸“é—¨æŠ½å–ä¸€ä¸ª Module ä½œä¸ºè·¯ç”±æœåŠ¡ï¼Œæ¯ä¸ªç»„ä»¶å£°æ˜è‡ªå·±æä¾›çš„æœåŠ¡ Service APIï¼Œè¿™äº› Service éƒ½æ˜¯ä¸€äº›æ¥å£ï¼Œç»„ä»¶è´Ÿè´£å°†è¿™äº›  Service å®ç°å¹¶æ³¨å†Œåˆ°ä¸€ä¸ªç»Ÿä¸€çš„è·¯ç”± Router ä¸­å»ï¼Œå¦‚æœè¦ä½¿ç”¨æŸä¸ªç»„ä»¶çš„åŠŸèƒ½ï¼Œåªéœ€è¦å‘ Router è¯·æ±‚è¿™ä¸ª Service çš„å®ç°ï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚æˆ‘ä»¬å…¨ç„¶ä¸å…³å¿ƒï¼Œåªè¦èƒ½è¿”å›æˆ‘ä»¬éœ€è¦çš„ç»“æœå°±å¯ä»¥äº†ã€‚çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒ Flutter çš„è·¯ç”±ï¼Ÿ</p><h3 id="æ•°æ®ä¼ é€’"><a href="#æ•°æ®ä¼ é€’" class="headerlink" title="æ•°æ®ä¼ é€’"></a>æ•°æ®ä¼ é€’</h3><p>æœ‰äº†è·¯ç”±ç³»ç»Ÿï¼Œæ•°æ®ä¼ é€’è‡ªç„¶ä¹Ÿå¯ä»¥äº¤ç»™è·¯ç”±ç³»ç»Ÿã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p>æˆ‘æœ‰ä¸€ä¸ªè·¯ç”±ï¼ŒURIä¸ºï¼š</p><pre><code>myscheme://custompath/pageA?param1=*&amp;param2=*</code></pre><p>param1 å’Œ param2 è‡ªç„¶å°±å¯ä»¥åšä¸ºå‚æ•°ä¼ å…¥ç›®æ ‡ç»„ä»¶ã€‚</p><h3 id="æ•°æ®å…±äº«ã€äº‹ä»¶å“åº”"><a href="#æ•°æ®å…±äº«ã€äº‹ä»¶å“åº”" class="headerlink" title="æ•°æ®å…±äº«ã€äº‹ä»¶å“åº”"></a>æ•°æ®å…±äº«ã€äº‹ä»¶å“åº”</h3><p>æ•°æ®å…±äº«å’Œäº‹ä»¶å“åº”å¯ä»¥é‡‡ç”¨ EventBus æ¥å®ç°ï¼Œä½†æ˜¯ EventBus åœ¨ç»„ä»¶åŒ–å¼€å‘æ—¶ï¼Œä¸€å®šè¦æ³¨æ„äº‹ä»¶åçš„å‘½åï¼Œç»„ä»¶äº‹ä»¶åæœ€å¥½æœ‰è§„èŒƒçš„å®šä¹‰æ–¹å¼ï¼Œé¿å…ä¸åŒäººå‘˜å¼€å‘æ—¶å‡ºç°å†²çªï¼Œæ—¥åä¸å¥½ç»´æŠ¤ã€‚</p><p>å½“ç„¶å¦‚<a href="https://tech.meituan.com/meituan_waimai_android_open_source_routing_framework.html">ç¾å›¢çš„WMRouter</a>ä¹Ÿæœ‰æ¯”è¾ƒæˆç†Ÿçš„ ServiceLoader çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæä¾›æœåŠ¡å…±äº«ã€æ•°æ®å…±äº«ã€‚</p><h2 id="ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†"><a href="#ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†" class="headerlink" title="ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†"></a>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</h2><p>æ¯ä¸ªAndroidåº”ç”¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šå…ˆåˆ›å»ºä¸€ä¸ª Applicationã€‚é€šå¸¸åœ¨ Application é‡Œæˆ‘ä»¬ä¼šåšä¸€äº›åº”ç”¨åˆå§‹åŒ–çš„æ“ä½œï¼Œå¸¸è§çš„æœ‰ç¬¬ä¸‰æ–¹ SDK åˆå§‹åŒ–ã€‚åœ¨åº”ç”¨ç»„ä»¶åŒ–ä¹‹åï¼Œç»„ä»¶ä¸å£³å·¥ç¨‹æ˜¯éš”ç¦»å¼€æ¥çš„ï¼Œä½†æ˜¯ç»„ä»¶æœ‰æ—¶å€™ä¹Ÿéœ€è¦è·å–åº”ç”¨çš„ Applicationï¼Œä¹Ÿéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™å°±æ¶‰åŠåˆ°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†é—®é¢˜ã€‚</p><ol><li>æŠ½è±¡å‡ºä¸€ä¸ªç±»ä¼¼Applicationçš„ç±»ï¼Œå®ƒæ¨¡æ‹Ÿäº†Applicationçš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š</li></ol><pre><code class="java">public abstract class BaseAppLike &#123;    public static final int MAX_PRIORITY = 10;    public static final int MIN_PRIORITY = 1;    public static final int NORM_PRIORITY = 5;    /**     * è¿”å›ç»„ä»¶çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§èŒƒå›´ä¸º[1-10]ï¼Œ10ä¸ºæœ€é«˜ï¼Œ1ä¸ºæœ€ä½ï¼Œé»˜è®¤ä¼˜å…ˆçº§æ˜¯5     *     * @return     */    public int getPriority() &#123;        return NORM_PRIORITY;    &#125;    /**     * åº”ç”¨åˆå§‹åŒ–     *     * @param context     */    public abstract void onCreate(Context context);    public abstract void onTerminate();&#125;</code></pre><p>è€Œç»„ä»¶å†…éƒ¨éƒ½è¦å®ç°ä¸€ä¸ªç»§æ‰¿ BaseAppLike çš„ç±»ï¼Œå¹¶å°†å…¶å½“åš Application çš„å®¹å™¨ã€‚ç»„ä»¶å¯ä»¥åœ¨è¿™é‡Œè·å– Application å®ä¾‹ã€æ‰§è¡Œå¯åŠ¨æ—¶çš„åˆå§‹åŒ–ç­‰ç­‰ã€‚</p><p>è¿™æ—¶æˆ‘ä»¬å‡è®¾æœ‰ä¸‰ä¸ªç»„ä»¶ ModuleAã€ModuleBã€ModuleCï¼Œè¿™ä¸‰ä¸ªç»„ä»¶å†…éƒ¨åˆ†åˆ«æœ‰ ModuleAAppLikeã€ModuleBAppLikeã€ModuleCAppLikeï¼Œé‚£ä¹ˆåœ¨å£³å·¥ç¨‹ä¸­ï¼Œåˆå§‹åŒ–æ—¶å¯ä»¥è¿™æ ·åšï¼š</p><pre><code class="java">class MyApplication extends Application &#123;    @Override    public void onCreate() &#123;        super.onCreate();        ModuleAAppLike moduleA = new ModuleAAppLike();        ModuleBAppLike moduleB = new ModuleBAppLike();        ModuleCAppLike moduleC = new ModuleCAppLike();        moduleA.onCreate(this);        moduleB.onCreate(this);        moduleC.onCreate(this);    &#125;   &#125;</code></pre><p>è¿™æ ·ä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿæœ‰ã€‚</p><h3 id="ç»„ä»¶åˆå§‹åŒ–çš„é¡ºåº"><a href="#ç»„ä»¶åˆå§‹åŒ–çš„é¡ºåº" class="headerlink" title="ç»„ä»¶åˆå§‹åŒ–çš„é¡ºåº"></a>ç»„ä»¶åˆå§‹åŒ–çš„é¡ºåº</h3><p>å‰é¢ä»‹ç»è¿‡ï¼Œä¸Šå±‚ä¸šåŠ¡ç»„ä»¶æ˜¯ä¾èµ–ä¸‹å±‚ä¸šåŠ¡ç»„ä»¶çš„ï¼Œå¦‚æœä¸‹å±‚ç»„ä»¶åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¹Ÿéœ€è¦åˆå§‹åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨åŠ è½½ç»„ä»¶æ—¶ï¼Œå¿…ç„¶è¦å…ˆåŠ è½½ä¸‹å±‚ç»„ä»¶ï¼Œå¦åˆ™åŠ è½½ä¸Šå±‚ç»„ä»¶æ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯ç»„ä»¶è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ€ä¹ˆç¡®å®šè¦å…ˆåŠ è½½è°ååŠ è½½è°å‘¢ï¼Œå½“ç„¶ä½ å¯ä»¥æ‰‹åŠ¨ç»´æŠ¤ï¼Œä»£ç é‡Œå†™æ­»ï¼Œä½†æ˜¯å½“ä¸šåŠ¡è¶Šæ¥è¶Šå¤šã€æ—¶é—´è¶Šæ¥è¶Šä¹…ï¼Œè‚¯å®šä¸çµæ´»ï¼Œä½ æ–°åŠ ä¸€ä¸ªä¸šåŠ¡ç»„ä»¶è¿›æ¥ï¼Œä½ éƒ½éœ€è¦ç¡®å®šç»„ä»¶åˆå§‹åŒ–å…ˆåé¡ºåºã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸ªæœºåˆ¶æ¥ç¡®å®šç»„ä»¶åˆå§‹åŒ–å…ˆåé¡ºåºã€‚</p><p>ç±»ä¼¼çº¿ç¨‹ä¼˜å…ˆçº§ä¸€æ ·ï¼Œ ä¸ºæ¯ä¸ªç»„ä»¶å®šä¹‰äº†ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œé€šè¿‡é‡å†™<code>getPriority()</code>æ–¹æ³•å¯ä»¥è®¾ç½®ç»„ä»¶çš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§èŒƒå›´ä»[1-10]ï¼Œé»˜è®¤ä¼˜å…ˆçº§éƒ½ä¸º5ï¼Œä¸‹å±‚ç»„ä»¶æˆ–éœ€è¦å…ˆåˆå§‹åŒ–çš„ç»„ä»¶ï¼Œä¼˜å…ˆçº§è®¾ç½®é«˜ä¸€ç‚¹ã€‚è¿™æ ·æˆ‘ä»¬åœ¨åŠ è½½ç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆå¯¹æ‰€æœ‰ç»„ä»¶çš„ä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œä¼˜å…ˆçº§é«˜çš„æ’å‰é¢ï¼Œç„¶åå†æŒ‰é¡ºåºè¿›è¡ŒåŠ è½½ç»„ä»¶ï¼Œå°±å¯è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> ç»„ä»¶åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>View çš„ç»˜åˆ¶æµç¨‹</title>
      <link href="/2023-01-31/view-draw-mechanism/"/>
      <url>/2023-01-31/view-draw-mechanism/</url>
      
        <content type="html"><![CDATA[<h1 id="Viewçš„ç»˜åˆ¶æµç¨‹"><a href="#Viewçš„ç»˜åˆ¶æµç¨‹" class="headerlink" title="Viewçš„ç»˜åˆ¶æµç¨‹"></a>Viewçš„ç»˜åˆ¶æµç¨‹</h1><h2 id="Viewæ ‘çš„ç»˜åˆ¶æµç¨‹"><a href="#Viewæ ‘çš„ç»˜åˆ¶æµç¨‹" class="headerlink" title="Viewæ ‘çš„ç»˜åˆ¶æµç¨‹"></a>Viewæ ‘çš„ç»˜åˆ¶æµç¨‹</h2><p>å½“ Activity æ¥æ”¶åˆ°ç„¦ç‚¹çš„æ—¶å€™ï¼Œå®ƒä¼šè¢«è¯·æ±‚ç»˜åˆ¶å¸ƒå±€ã€‚è¯¥è¯·æ±‚ç”± Android Framework å¤„ç†ã€‚ç»˜åˆ¶æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹å¸ƒå±€æ ‘è¿›è¡Œ measure å’Œ drawã€‚æ•´ä¸ª View æ ‘çš„ç»˜å›¾æµç¨‹åœ¨ ViewRoot ç±»çš„<code>performTraversals()</code>å‡½æ•°å±•å¼€ï¼Œè¯¥å‡½æ•°æ‰€åšçš„å·¥ä½œå¯ç®€å•æ¦‚å†µä¸º<strong>æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—è§†å›¾å¤§å°</strong>ï¼ˆmeasureï¼‰ã€<strong>æ˜¯å¦éœ€è¦é‡æ–°å®‰ç½®è§†å›¾çš„ä½ç½®</strong>ï¼ˆlayoutï¼‰ã€ä»¥åŠ<strong>æ˜¯å¦éœ€è¦é‡ç»˜</strong>ï¼ˆdrawï¼‰ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/1.png" alt="Viewçš„ç»˜åˆ¶æµç¨‹å›¾"></p><span id="more"></span><h2 id="View-ç»˜åˆ¶æµç¨‹å‡½æ•°è°ƒç”¨é“¾"><a href="#View-ç»˜åˆ¶æµç¨‹å‡½æ•°è°ƒç”¨é“¾" class="headerlink" title="View ç»˜åˆ¶æµç¨‹å‡½æ•°è°ƒç”¨é“¾"></a>View ç»˜åˆ¶æµç¨‹å‡½æ•°è°ƒç”¨é“¾</h2><p><img style="width: 50%; text-align: center" src="/img/2.png"></img></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·ä¸»åŠ¨è°ƒç”¨<code>invalidate()</code>è¯·æ±‚é‡ç»˜ View æ ‘ï¼Œå³ draw è¿‡ç¨‹ï¼Œå‡å¦‚è§†å›¾å‘ç”Ÿå¤§å°æ²¡æœ‰å˜åŒ–å°±ä¸ä¼šè°ƒç”¨<code>layout()</code>ï¼Œå¹¶ä¸”åªç»˜åˆ¶é‚£äº›è°ƒç”¨äº†<code>invalidate()</code>æ–¹æ³•çš„ Viewã€‚</p><p>ä½†æ˜¯å½“å¸ƒå±€å˜åŒ–çš„æ—¶å€™ï¼Œæ¯”å¦‚æ–¹å‘å˜åŒ–ï¼Œå°ºå¯¸çš„å˜åŒ–ï¼Œä¼šè°ƒç”¨<code>requestLayout()</code>æ–¹æ³•ã€‚åœ¨è‡ªå®šä¹‰çš„è§†å›¾ä¸­ï¼Œå¦‚æœæŸäº›æƒ…å†µä¸‹å¸Œæœ›é‡æ–°æµ‹é‡å°ºå¯¸å¤§å°ï¼Œåº”è¯¥æ‰‹åŠ¨å»è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå®ƒä¼šè§¦å‘<code>measure()</code>å’Œ<code>layout()</code>ï¼Œä½†ä¸ä¼šè¿›è¡Œ<code>draw</code>ã€‚</p><p>ä»æ•´ä½“ä¸Šæ¥çœ‹<code>Measure</code>å’Œ<code>Layout</code>ä¸¤ä¸ªæ­¥éª¤çš„æ‰§è¡Œï¼š</p><p><img src="/img/3.png" alt="Viewçš„ç»˜åˆ¶æµç¨‹å›¾"></p><p>æ ‘çš„éå†æ˜¯æœ‰åºçš„ï¼Œç”±çˆ¶è§†å›¾åˆ°å­è§†å›¾ï¼Œæ¯ä¸€ä¸ª<code>ViewGroup</code>è´Ÿè´£æµ‹ç»˜å®ƒæ‰€æœ‰çš„å­è§†å›¾ï¼Œè€Œæœ€åº•å±‚çš„<code>View</code>ä¼šè´Ÿè´£æµ‹ç»˜è‡ªèº«ã€‚</p><p><code>Draw</code>çš„æ‰§è¡Œæµç¨‹ï¼š</p><p><img src="/img/4.png" alt="Drawæµç¨‹"></p><h2 id="Measureè¿‡ç¨‹åˆ†æ"><a href="#Measureè¿‡ç¨‹åˆ†æ" class="headerlink" title="Measureè¿‡ç¨‹åˆ†æ"></a><code>Measure</code>è¿‡ç¨‹åˆ†æ</h2><p><code>measure</code>è¿‡ç¨‹æ˜¯åœ¨è°ƒç”¨<code>measure(int, int)</code>æ–¹æ³•ï¼Œä»ä¸Šåˆ°ä¸‹æœ‰åºçš„æµ‹é‡<code>View</code>ï¼Œåœ¨<code>measure</code>è¿‡ç¨‹çš„æœ€åï¼Œæ¯ä¸ªè§†å›¾å­˜å‚¨äº†è‡ªå·±çš„å°ºå¯¸å¤§å°å’Œæµ‹é‡è§„æ ¼ã€‚</p><p><code>layout</code>è¿‡ç¨‹æ˜¯åœ¨è°ƒç”¨<code>layout(int, int, int, int)</code>æ–¹æ³•ï¼Œä¹Ÿæ˜¯è‡ªä¸Šè€Œä¸‹è¿›è¡Œéå†ã€‚åœ¨è¯¥è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªçˆ¶è§†å›¾ä¼šæ ¹æ®<code>measure</code>è¿‡ç¨‹å¾—åˆ°çš„å°ºå¯¸æ¥æ‘†æ”¾è‡ªå·±çš„å­è§†å›¾ã€‚</p><p><code>measure</code>è¿‡ç¨‹ä¼šä¸ºä¸€ä¸ª<code>View</code>åŠæ‰€æœ‰å­èŠ‚ç‚¹çš„<code>mMeasuredWidth</code>å’Œ<code>mMeasuredHeight</code>å˜é‡èµ‹å€¼ï¼Œè¯¥å€¼å¯ä»¥é€šè¿‡ <code>getMeasuredWidth()</code>å’Œ<code>getMeasuredHeight()</code>æ–¹æ³•è·å¾—ã€‚è€Œä¸”è¿™ä¸¤ä¸ªå€¼å¿…é¡»åœ¨çˆ¶<code>View</code>çº¦æŸèŒƒå›´ä¹‹å†…ï¼Œè¿™æ ·æ‰å¯ä»¥ä¿è¯æ‰€æœ‰çš„çˆ¶<code>View</code>éƒ½æ¥æ”¶æ‰€æœ‰å­<code>View</code>çš„æµ‹é‡ã€‚å¦‚æœå­<code>View</code>å¯¹äº<code>measure</code>å¾—åˆ°çš„å¤§å°ä¸æ»¡æ„çš„æ—¶å€™ï¼Œçˆ¶<code>View</code>ä¼šä»‹å…¥å¹¶è®¾ç½®æµ‹é‡è§„åˆ™è¿›è¡Œç¬¬äºŒæ¬¡<code>measure</code>ã€‚</p><p>æ¯”å¦‚ï¼Œçˆ¶<code>View</code>å¯ä»¥å…ˆæ ¹æ®æœªç»™å®šçš„<code>dimension</code>å»æµ‹é‡æ¯ä¸€ä¸ªå­<code>View</code>ï¼Œå¦‚æœæœ€ç»ˆå­<code>View</code>çš„æœªçº¦æŸå°ºå¯¸å¤ªå¤§æˆ–è€…å¤ªå°çš„æ—¶å€™ï¼Œçˆ¶<code>View</code>å°±ä¼šä½¿ç”¨ä¸€ä¸ªç¡®åˆ‡çš„å¤§å°å†æ¬¡å¯¹å­<code>View</code>è¿›è¡Œ<code>measure</code>ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„æµç¨‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æºç ï¼š</p><p><a href="../../source/android/ViewGroup.java"><code>ViewGroup.java</code></a>:</p><pre><code class="java">    /**     * å‘Šè¯‰æ‰€æœ‰å­ viewï¼šç»™ä½ ä»¬ä¸ª MeasureSpecï¼Œå»è‡ªä¸ªå„¿æµ‹é‡è‡ªä¸ªå„¿çš„å¤§å°åˆ‡ï¼     * PS: å¦‚æœè°çš„çŠ¶æ€æ˜¯ GONEï¼Œé‚£ä½ ä»¬å°±åˆ«æäº†ï¼     *     * @param widthMeasureSpec      * @param heightMeasureSpec     */    protected void measureChildren(int widthMeasureSpec, int heightMeasureSpec) &#123;        final int size = mChildrenCount;        final View[] children = mChildren;        for (int i = 0; i &lt; size; ++i) &#123;            final View child = children[i];            if ((child.mViewFlags &amp; VISIBILITY_MASK) != GONE) &#123;                measureChild(child, widthMeasureSpec, heightMeasureSpec);            &#125;        &#125;    &#125;</code></pre><p>çœ‹çœ‹<code>measureChild</code>æ˜¯å¦‚ä½•åšçš„ï¼š</p><pre><code class="java">    /**     * è°ƒç”¨å­ view çš„ measure æ–¹æ³•æ¥æµ‹é‡ï¼Œæ ¹æ®çˆ¶ç±»çš„ç»™çš„ MeasureSpec å’Œè‡ªå·±çš„ padding å€¼ï¼Œ     * è®© getChildMeasureSpec() å»è·å–å…·ä½“çš„ MeasureSpecã€‚     *      * @param child      * @param parentWidthMeasureSpec     * @param parentHeightMeasureSpec     */    protected void measureChild(View child, int parentWidthMeasureSpec,            int parentHeightMeasureSpec) &#123;        final LayoutParams lp = child.getLayoutParams();        final int childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,                mPaddingLeft + mPaddingRight, lp.width);        final int childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,                mPaddingTop + mPaddingBottom, lp.height);        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);    &#125;</code></pre><p>æœ€å¤æ‚çš„å·¥ä½œï¼š<code>getChildMeasureSpec()</code>:</p><pre><code class="java">    /**     * ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ ¹æ®æŸä¸ªæ–¹å‘çš„ çˆ¶view çš„ MeasureSpec çš„å€¼å’Œ padding å’Œ childDimensionï¼Œ     * æ¥å†³å®šè¿™ä¸ª view çš„ MeasureSpec: ä¸€ä¸ªintå€¼     *     * @param spec The requirements for this view     * @param padding The padding of this view for the current dimension and     *        margins, if applicable     * @param childDimension How big the child wants to be in the current     *        dimension     * @return a MeasureSpec integer for the child     */    public static int getChildMeasureSpec(int spec, int padding, int childDimension) &#123;        int specMode = MeasureSpec.getMode(spec);        int specSize = MeasureSpec.getSize(spec);        int size = Math.max(0, specSize - padding);        int resultSize = 0;        int resultMode = 0;        switch (specMode) &#123;        // Parent has imposed an exact size on us        case MeasureSpec.EXACTLY:            if (childDimension &gt;= 0) &#123;                resultSize = childDimension;                resultMode = MeasureSpec.EXACTLY;            &#125; else if (childDimension == LayoutParams.MATCH_PARENT) &#123;                // Child wants to be our size. So be it.                resultSize = size;                resultMode = MeasureSpec.EXACTLY;            &#125; else if (childDimension == LayoutParams.WRAP_CONTENT) &#123;                // Child wants to determine its own size. It can&#39;t be                // bigger than us.                resultSize = size;                resultMode = MeasureSpec.AT_MOST;            &#125;            break;        // Parent has imposed a maximum size on us        case MeasureSpec.AT_MOST:            if (childDimension &gt;= 0) &#123;                // Child wants a specific size... so be it                resultSize = childDimension;                resultMode = MeasureSpec.EXACTLY;            &#125; else if (childDimension == LayoutParams.MATCH_PARENT) &#123;                // Child wants to be our size, but our size is not fixed.                // Constrain child to not be bigger than us.                resultSize = size;                resultMode = MeasureSpec.AT_MOST;            &#125; else if (childDimension == LayoutParams.WRAP_CONTENT) &#123;                // Child wants to determine its own size. It can&#39;t be                // bigger than us.                resultSize = size;                resultMode = MeasureSpec.AT_MOST;            &#125;            break;        // Parent asked to see how big we want to be        case MeasureSpec.UNSPECIFIED:            if (childDimension &gt;= 0) &#123;                // Child wants a specific size... let him have it                resultSize = childDimension;                resultMode = MeasureSpec.EXACTLY;            &#125; else if (childDimension == LayoutParams.MATCH_PARENT) &#123;                // Child wants to be our size... find out how big it should                // be                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;                resultMode = MeasureSpec.UNSPECIFIED;            &#125; else if (childDimension == LayoutParams.WRAP_CONTENT) &#123;                // Child wants to determine its own size.... find out how                // big it should be                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;                resultMode = MeasureSpec.UNSPECIFIED;            &#125;            break;        &#125;        //noinspection ResourceType        return MeasureSpec.makeMeasureSpec(resultSize, resultMode);    &#125;</code></pre><p>è·å–åˆ°äº†å­<code>view</code>çš„<code>MeasureSpec</code>ï¼Œç„¶åå°±ä¼šè¿›å…¥ <code>View.java</code>:</p><pre><code class="java">    /**     * è°ƒç”¨è¯¥æ–¹æ³•æ¥è·å–ä¸€ä¸ªviewåˆ°åº•è¯¥æœ‰å¤šå¤§ã€‚çˆ¶è§†å›¾æä¾›widthä¸heightçº¦æŸä¿¡æ¯     *     * æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œå®é™…çš„æµ‹é‡ç»“æœä¼šç”± onMeasure(int, int) è¿™ä¸ªæ–¹æ³•è¿”å›ã€‚     * ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ onMeasure(int, int) è¿™ä¸ªæ–¹æ³•èƒ½è¢«å­ç±»è¦†å†™ã€‚     *     * @param widthMeasureSpec æ°´å¹³æ–¹å‘çˆ¶ç±»å¼ºåŠ çš„Measureéœ€æ±‚     * @param heightMeasureSpec å‚ç›´æ–¹å‘çˆ¶ç±»å¼ºåŠ çš„Measureéœ€æ±‚     *     */    public final void measure(int widthMeasureSpec, int heightMeasureSpec) &#123;        boolean optical = isLayoutModeOptical(this);        if (optical != isLayoutModeOptical(mParent)) &#123;            Insets insets = getOpticalInsets();            int oWidth  = insets.left + insets.right;            int oHeight = insets.top  + insets.bottom;            widthMeasureSpec  = MeasureSpec.adjust(widthMeasureSpec,  optical ? -oWidth  : oWidth);            heightMeasureSpec = MeasureSpec.adjust(heightMeasureSpec, optical ? -oHeight : oHeight);        &#125;        // Suppress sign extension for the low bytes        long key = (long) widthMeasureSpec &lt;&lt; 32 | (long) heightMeasureSpec &amp; 0xffffffffL;        if (mMeasureCache == null) mMeasureCache = new LongSparseLongArray(2);        final boolean forceLayout = (mPrivateFlags &amp; PFLAG_FORCE_LAYOUT) == PFLAG_FORCE_LAYOUT;        // Optimize layout by avoiding an extra EXACTLY pass when the view is        // already measured as the correct size. In API 23 and below, this        // extra pass is required to make LinearLayout re-distribute weight.        final boolean specChanged = widthMeasureSpec != mOldWidthMeasureSpec                || heightMeasureSpec != mOldHeightMeasureSpec;        final boolean isSpecExactly = MeasureSpec.getMode(widthMeasureSpec) == MeasureSpec.EXACTLY                &amp;&amp; MeasureSpec.getMode(heightMeasureSpec) == MeasureSpec.EXACTLY;        final boolean matchesSpecSize = getMeasuredWidth() == MeasureSpec.getSize(widthMeasureSpec)                &amp;&amp; getMeasuredHeight() == MeasureSpec.getSize(heightMeasureSpec);        final boolean needsLayout = specChanged                &amp;&amp; (sAlwaysRemeasureExactly || !isSpecExactly || !matchesSpecSize);        if (forceLayout || needsLayout) &#123;            // first clears the measured dimension flag            mPrivateFlags &amp;= ~PFLAG_MEASURED_DIMENSION_SET;            resolveRtlPropertiesIfNeeded();            int cacheIndex = forceLayout ? -1 : mMeasureCache.indexOfKey(key);            if (cacheIndex &lt; 0 || sIgnoreMeasureCache) &#123;                // measure ourselves, this should set the measured dimension flag back                // è¿™é‡Œè¿”å›äº†æµ‹é‡ç»“æœ                onMeasure(widthMeasureSpec, heightMeasureSpec);                mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;            &#125; else &#123;                long value = mMeasureCache.valueAt(cacheIndex);                // Casting a long to int drops the high 32 bits, no mask needed                setMeasuredDimensionRaw((int) (value &gt;&gt; 32), (int) value);                mPrivateFlags3 |= PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;            &#125;            // flag not set, setMeasuredDimension() was not invoked, we raise            // an exception to warn the developer            if ((mPrivateFlags &amp; PFLAG_MEASURED_DIMENSION_SET) != PFLAG_MEASURED_DIMENSION_SET) &#123;                throw new IllegalStateException(&quot;View with id &quot; + getId() + &quot;: &quot;                        + getClass().getName() + &quot;#onMeasure() did not set the&quot;                        + &quot; measured dimension by calling&quot;                        + &quot; setMeasuredDimension()&quot;);            &#125;            mPrivateFlags |= PFLAG_LAYOUT_REQUIRED;        &#125;        mOldWidthMeasureSpec = widthMeasureSpec;        mOldHeightMeasureSpec = heightMeasureSpec;        mMeasureCache.put(key, ((long) mMeasuredWidth) &lt;&lt; 32 |                (long) mMeasuredHeight &amp; 0xffffffffL); // suppress sign extension    &#125;</code></pre><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹<code>onMeasure(int, int)</code>:</p><pre><code class="java">    /**     * æµ‹é‡viewè‡ªèº«å’Œå®ƒçš„å†…å®¹æ¥ç¡®å®šviewçš„widthå’Œheightã€‚è¯¥æ–¹æ³•ç”± measure(int, int) è°ƒç”¨     * å¹¶ä¸”åº”è¯¥è¢«å­ç±»è¦†å†™ï¼Œæ¥è·å–å‡†ç¡®ä¸”é«˜æ•ˆçš„æµ‹é‡ç»“æœã€‚     *     * æ³¨æ„ï¼šåœ¨è¦†å†™è¯¥æ–¹æ³•çš„æ—¶å€™ï¼Œä½ å¿…é¡»è°ƒç”¨ setMeasuredDimension(int, int) æ–¹æ³•æ¥å­˜å‚¨è¯¥ view çš„ width å’Œ heightã€‚     * å¦‚æœä¸è¿™ä¹ˆå¹²çš„è¯ï¼Œå°†ä¼šè§¦å‘ IllegalStateException å¼‚å¸¸ã€‚ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„ onMeasure(int, int) æ— æ•ˆã€‚     *     * åŸºç±»å®ç°æµ‹é‡æ—¶ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯èƒŒæ™¯çš„ sizeï¼Œé™¤é MeasureSpec æä¾›äº†ä¸€ä¸ªæ›´å¤§çš„ sizeã€‚     * å­ç±»åº”è¯¥åœ¨è¦†å†™ onMeasure(int, int) æ—¶æä¾›å®ƒçš„å†…å®¹çš„ç²¾ç¡®æµ‹é‡æ–¹æ³•     *     * å¦‚æœè¯¥æ–¹æ³•è¢«è¦†å†™ï¼Œå­ç±»åº”ç¡®ä¿æµ‹é‡çš„ width å’Œ height è¦å¤§äº view çš„æœ€å° width å’Œæœ€å° heightï¼Œ     * å¯ä»¥åˆ†åˆ«é€šè¿‡ getSuggestedMinimumWidth() å’Œ getSuggestedMinimumHeight() æ¥è·å–     *     * @param widthMeasureSpec æ°´å¹³æ–¹å‘çˆ¶ç±»å¼ºåŠ çš„Measureéœ€æ±‚     * @param heightMeasureSpec å‚ç›´æ–¹å‘çˆ¶ç±»å¼ºåŠ çš„Measureéœ€æ±‚     *      */    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));    &#125;</code></pre><p>è‡³æ­¤ï¼Œ<code>measure</code>è¿‡ç¨‹ç»“æŸã€‚</p><h2 id="Layoutè¿‡ç¨‹åˆ†æ"><a href="#Layoutè¿‡ç¨‹åˆ†æ" class="headerlink" title="Layoutè¿‡ç¨‹åˆ†æ"></a><code>Layout</code>è¿‡ç¨‹åˆ†æ</h2><p>é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯ï¼Œå­<code>View</code>çš„å…·ä½“ä½ç½®éƒ½æ˜¯ç›¸å¯¹äºçˆ¶<code>View</code>è€Œè¨€çš„ã€‚</p><p>åœ¨<code>layout</code>è¿‡ç¨‹ä¸­ï¼Œå­<code>View</code>ä¼šè°ƒç”¨<code>getMeasuredWidth()</code>å’Œ<code>getMeasuredHeight()</code>æ–¹æ³•è·å–åˆ°<code>measure</code>è¿‡ç¨‹å¾—åˆ°çš„<code>mMeasuredWidth</code>å’Œ<code>mMeasuredHeight</code>ï¼Œåšä¸ºè‡ªå·±çš„<code>width</code>å’Œ<code>height</code>ã€‚ç„¶åè°ƒç”¨æ¯ä¸€ä¸ªå­<code>View</code>çš„<code>layout(l, t, r, b)</code>å‡½æ•°ï¼Œæ¥ç¡®å®šæ¯ä¸ªå­<code>View</code>åœ¨çˆ¶<code>View</code>ä¸­çš„ä½ç½®ã€‚</p><p><strong>æ³¨æ„ï¼Œ<code>View</code>çš„<code>onLayout</code>æ–¹æ³•ä¸ºç©ºå®ç°ï¼Œè€Œ<code>ViewGroup</code>çš„<code>onLayout</code>ä¸º<code>abstract</code>ï¼Œå› æ­¤ï¼Œå¦‚æœè‡ªå®šä¹‰çš„ View è¦ç»§æ‰¿ ViewGroup æ—¶ï¼Œå¿…é¡»å®ç°<code>onLayout</code>å‡½æ•°ã€‚</strong></p><p><a href="../../source/android/View.java"><code>View.java</code></a></p><p>é¦–å…ˆçœ‹çœ‹<code>View</code>ç±»çš„<code>layout()</code>æ–¹æ³•ï¼š</p><pre><code class="java">    /**     * å°† size å’Œ position åº”ç”¨åˆ°è¯¥ view å’Œå®ƒæ‰€æœ‰çš„å­å­™ view ä¸­     *      * è¿™æ˜¯ layout æœºåˆ¶çš„ç¬¬äºŒé˜¶æ®µï¼ˆç¬¬ä¸€é˜¶æ®µå½“ç„¶æ˜¯ measureå•¦ï¼‰ã€‚     * åœ¨è¿™ä¸ªé˜¶æ®µé‡Œï¼Œæ¯ä¸ªçˆ¶ view ä¼šè°ƒç”¨æ‰€æœ‰å­ view çš„ layout() æ–¹æ³•æ¥ç»™å®ƒä»¬æŒ‡å®š positionã€‚     * ä¸€èˆ¬æƒ…å†µä¸‹ä¼šä½¿ç”¨å­˜å‚¨åœ¨å­ view é‡Œçš„ measure å€¼æ¥å®šä½ã€‚     *     * æ´¾ç”Ÿç±»ä¸è¦è¦†å†™è¿™ä¸ªæ–¹æ³•ã€‚     * æœ‰å­ view çš„æ´¾ç”Ÿç±»åº”è¯¥è¦†å†™ onLayout æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œè°ƒç”¨å®ƒæ‰€æœ‰å­ view çš„ layout æ–¹æ³•ã€‚     *     * @param l Left position, relative to parent     * @param t Top position, relative to parent     * @param r Right position, relative to parent     * @param b Bottom position, relative to parent     */    @SuppressWarnings(&#123;&quot;unchecked&quot;&#125;)    public void layout(int l, int t, int r, int b) &#123;        if ((mPrivateFlags3 &amp; PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT) != 0) &#123;            onMeasure(mOldWidthMeasureSpec, mOldHeightMeasureSpec);            mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;        &#125;        int oldL = mLeft;        int oldT = mTop;        int oldB = mBottom;        int oldR = mRight;        boolean changed = isLayoutModeOptical(mParent) ?                setOpticalFrame(l, t, r, b) : setFrame(l, t, r, b);        if (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) &#123;            onLayout(changed, l, t, r, b);            if (shouldDrawRoundScrollbar()) &#123;                if(mRoundScrollbarRenderer == null) &#123;                    mRoundScrollbarRenderer = new RoundScrollbarRenderer(this);                &#125;            &#125; else &#123;                mRoundScrollbarRenderer = null;            &#125;            mPrivateFlags &amp;= ~PFLAG_LAYOUT_REQUIRED;            ListenerInfo li = mListenerInfo;            if (li != null &amp;&amp; li.mOnLayoutChangeListeners != null) &#123;                ArrayList&lt;OnLayoutChangeListener&gt; listenersCopy =                        (ArrayList&lt;OnLayoutChangeListener&gt;)li.mOnLayoutChangeListeners.clone();                int numListeners = listenersCopy.size();                for (int i = 0; i &lt; numListeners; ++i) &#123;                    listenersCopy.get(i).onLayoutChange(this, l, t, r, b, oldL, oldT, oldR, oldB);                &#125;            &#125;        &#125;        final boolean wasLayoutValid = isLayoutValid();        mPrivateFlags &amp;= ~PFLAG_FORCE_LAYOUT;        mPrivateFlags3 |= PFLAG3_IS_LAID_OUT;        if (!wasLayoutValid &amp;&amp; isFocused()) &#123;            mPrivateFlags &amp;= ~PFLAG_WANTS_FOCUS;            if (canTakeFocus()) &#123;                // We have a robust focus, so parents should no longer be wanting focus.                clearParentsWantFocus();            &#125; else if (getViewRootImpl() == null || !getViewRootImpl().isInLayout()) &#123;                // This is a weird case. Most-likely the user, rather than ViewRootImpl, called                // layout. In this case, there&#39;s no guarantee that parent layouts will be evaluated                // and thus the safest action is to clear focus here.                clearFocusInternal(null, /* propagate */ true, /* refocus */ false);                clearParentsWantFocus();            &#125; else if (!hasParentWantsFocus()) &#123;                // original requestFocus was likely on this view directly, so just clear focus                clearFocusInternal(null, /* propagate */ true, /* refocus */ false);            &#125;            // otherwise, we let parents handle re-assigning focus during their layout passes.        &#125; else if ((mPrivateFlags &amp; PFLAG_WANTS_FOCUS) != 0) &#123;            mPrivateFlags &amp;= ~PFLAG_WANTS_FOCUS;            View focused = findFocus();            if (focused != null) &#123;                // Try to restore focus as close as possible to our starting focus.                if (!restoreDefaultFocus() &amp;&amp; !hasParentWantsFocus()) &#123;                    // Give up and clear focus once we&#39;ve reached the top-most parent which wants                    // focus.                    focused.clearFocusInternal(null, /* propagate */ true, /* refocus */ false);                &#125;            &#125;        &#125;        if ((mPrivateFlags3 &amp; PFLAG3_NOTIFY_AUTOFILL_ENTER_ON_LAYOUT) != 0) &#123;            mPrivateFlags3 &amp;= ~PFLAG3_NOTIFY_AUTOFILL_ENTER_ON_LAYOUT;            notifyEnterOrExitForAutoFillIfNeeded(true);        &#125;    &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨<code>layout</code>è¿‡ç¨‹ä¸­è°ƒç”¨äº†<code>onLayout()</code> æ–¹æ³•ï¼Œæ´¾ç”Ÿç±»æ­¤æ—¶å¯ä»¥è¦†å†™<code>onLayout()</code>æ–¹æ³•ï¼Œæ¥è·å–<code>view</code>çš„ä½ç½®ã€‚</p><pre><code class="java">    /**     * Called from layout when this view should     * assign a size and position to each of its children.     *     * Derived classes with children should override     * this method and call layout on each of     * their children.     * @param changed This is a new size or position for this view     * @param left Left position, relative to parent     * @param top Top position, relative to parent     * @param right Right position, relative to parent     * @param bottom Bottom position, relative to parent     */    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;    &#125;</code></pre><p>è®©æˆ‘ä»¬ä¸¾ä¸ªæ —å­æ¥çœ‹çœ‹<code>LinearLayout</code>çš„<code>onLayout()</code>ï¼š</p><pre><code class="java">    @Override    protected void onLayout(boolean changed, int l, int t, int r, int b) &#123;        if (mOrientation == VERTICAL) &#123;            layoutVertical(l, t, r, b);        &#125; else &#123;            layoutHorizontal(l, t, r, b);        &#125;    &#125;    /**     * å¦‚æœè¯¥ LinearLayout çš„ orientation è¢«è®¾ç½®æˆ VERTICAL çš„è¯ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ¥ç¡®å®šå®ƒçš„ position     *     * @param left     * @param top     * @param right     * @param bottom     */    void layoutVertical(int left, int top, int right, int bottom) &#123;        final int paddingLeft = mPaddingLeft;        int childTop;        int childLeft;        // Where right end of child should go        final int width = right - left;        int childRight = width - mPaddingRight;        // Space available for child        int childSpace = width - paddingLeft - mPaddingRight;        final int count = getVirtualChildCount();        final int majorGravity = mGravity &amp; Gravity.VERTICAL_GRAVITY_MASK;        final int minorGravity = mGravity &amp; Gravity.RELATIVE_HORIZONTAL_GRAVITY_MASK;        switch (majorGravity) &#123;           case Gravity.BOTTOM:               // mTotalLength contains the padding already               childTop = mPaddingTop + bottom - top - mTotalLength;               break;               // mTotalLength contains the padding already           case Gravity.CENTER_VERTICAL:               childTop = mPaddingTop + (bottom - top - mTotalLength) / 2;               break;           case Gravity.TOP:           default:               childTop = mPaddingTop;               break;        &#125;        for (int i = 0; i &lt; count; i++) &#123;            final View child = getVirtualChildAt(i);            if (child == null) &#123;                childTop += measureNullChild(i);            &#125; else if (child.getVisibility() != GONE) &#123;                final int childWidth = child.getMeasuredWidth();                final int childHeight = child.getMeasuredHeight();                final LinearLayout.LayoutParams lp =                        (LinearLayout.LayoutParams) child.getLayoutParams();                int gravity = lp.gravity;                if (gravity &lt; 0) &#123;                    gravity = minorGravity;                &#125;                final int layoutDirection = getLayoutDirection();                final int absoluteGravity = Gravity.getAbsoluteGravity(gravity, layoutDirection);                switch (absoluteGravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) &#123;                    case Gravity.CENTER_HORIZONTAL:                        childLeft = paddingLeft + ((childSpace - childWidth) / 2)                                + lp.leftMargin - lp.rightMargin;                        break;                    case Gravity.RIGHT:                        childLeft = childRight - childWidth - lp.rightMargin;                        break;                    case Gravity.LEFT:                    default:                        childLeft = paddingLeft + lp.leftMargin;                        break;                &#125;                if (hasDividerBeforeChildAt(i)) &#123;                    childTop += mDividerHeight;                &#125;                childTop += lp.topMargin;                setChildFrame(child, childLeft, childTop + getLocationOffset(child),                        childWidth, childHeight);                childTop += childHeight + lp.bottomMargin + getNextLocationOffset(child);                i += getChildrenSkipCount(child, i);            &#125;        &#125;    &#125;    /**     * å¦‚æœè¯¥ LinearLayout çš„ orientation è¢«è®¾ç½®æˆ HORIZONTAL çš„è¯ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ¥ç¡®å®šå®ƒçš„ position     *     * @param left     * @param top     * @param right     * @param bottom     */    void layoutHorizontal(int left, int top, int right, int bottom) &#123;        final boolean isLayoutRtl = isLayoutRtl();        final int paddingTop = mPaddingTop;        int childTop;        int childLeft;        // Where bottom of child should go        final int height = bottom - top;        int childBottom = height - mPaddingBottom;        // Space available for child        int childSpace = height - paddingTop - mPaddingBottom;        final int count = getVirtualChildCount();        final int majorGravity = mGravity &amp; Gravity.RELATIVE_HORIZONTAL_GRAVITY_MASK;        final int minorGravity = mGravity &amp; Gravity.VERTICAL_GRAVITY_MASK;        final boolean baselineAligned = mBaselineAligned;        final int[] maxAscent = mMaxAscent;        final int[] maxDescent = mMaxDescent;        final int layoutDirection = getLayoutDirection();        switch (Gravity.getAbsoluteGravity(majorGravity, layoutDirection)) &#123;            case Gravity.RIGHT:                // mTotalLength contains the padding already                childLeft = mPaddingLeft + right - left - mTotalLength;                break;            case Gravity.CENTER_HORIZONTAL:                // mTotalLength contains the padding already                childLeft = mPaddingLeft + (right - left - mTotalLength) / 2;                break;            case Gravity.LEFT:            default:                childLeft = mPaddingLeft;                break;        &#125;        int start = 0;        int dir = 1;        //In case of RTL, start drawing from the last child.        if (isLayoutRtl) &#123;            start = count - 1;            dir = -1;        &#125;        for (int i = 0; i &lt; count; i++) &#123;            final int childIndex = start + dir * i;            final View child = getVirtualChildAt(childIndex);            if (child == null) &#123;                childLeft += measureNullChild(childIndex);            &#125; else if (child.getVisibility() != GONE) &#123;                final int childWidth = child.getMeasuredWidth();                final int childHeight = child.getMeasuredHeight();                int childBaseline = -1;                final LinearLayout.LayoutParams lp =                        (LinearLayout.LayoutParams) child.getLayoutParams();                if (baselineAligned &amp;&amp; lp.height != LayoutParams.MATCH_PARENT) &#123;                    childBaseline = child.getBaseline();                &#125;                int gravity = lp.gravity;                if (gravity &lt; 0) &#123;                    gravity = minorGravity;                &#125;                switch (gravity &amp; Gravity.VERTICAL_GRAVITY_MASK) &#123;                    case Gravity.TOP:                        childTop = paddingTop + lp.topMargin;                        if (childBaseline != -1) &#123;                            childTop += maxAscent[INDEX_TOP] - childBaseline;                        &#125;                        break;                    case Gravity.CENTER_VERTICAL:                        // Removed support for baseline alignment when layout_gravity or                        // gravity == center_vertical. See bug #1038483.                        // Keep the code around if we need to re-enable this feature                        // if (childBaseline != -1) &#123;                        //     // Align baselines vertically only if the child is smaller than us                        //     if (childSpace - childHeight &gt; 0) &#123;                        //         childTop = paddingTop + (childSpace / 2) - childBaseline;                        //     &#125; else &#123;                        //         childTop = paddingTop + (childSpace - childHeight) / 2;                        //     &#125;                        // &#125; else &#123;                        childTop = paddingTop + ((childSpace - childHeight) / 2)                                + lp.topMargin - lp.bottomMargin;                        break;                    case Gravity.BOTTOM:                        childTop = childBottom - childHeight - lp.bottomMargin;                        if (childBaseline != -1) &#123;                            int descent = child.getMeasuredHeight() - childBaseline;                            childTop -= (maxDescent[INDEX_BOTTOM] - descent);                        &#125;                        break;                    default:                        childTop = paddingTop;                        break;                &#125;                if (hasDividerBeforeChildAt(childIndex)) &#123;                    childLeft += mDividerWidth;                &#125;                childLeft += lp.leftMargin;                setChildFrame(child, childLeft + getLocationOffset(child), childTop,                        childWidth, childHeight);                childLeft += childWidth + lp.rightMargin +                        getNextLocationOffset(child);                i += getChildrenSkipCount(child, childIndex);            &#125;        &#125;    &#125;</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>VERTICAL</code>æ–¹å‘çš„<code>LinearLayout</code>å’Œ<code>HORIZONTAL</code>æ–¹å‘çš„<code>LinearLayout</code>ï¼Œåœ¨å®šä½è¿‡ç¨‹ä¸­ï¼ŒåŒºåˆ«å¹¶ä¸å¤§ã€‚å”¯ä¸€ä¸å¤ªç›¸åŒçš„åœ°æ–¹ï¼Œå°±æ˜¯<code>HORIZONTAL</code>çš„<code>LinearLayout</code>éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸º<code>RTL(Right-to-Left)</code>å¸ƒå±€ã€‚</p><h2 id="Drawè¿‡ç¨‹åˆ†æ"><a href="#Drawè¿‡ç¨‹åˆ†æ" class="headerlink" title="Drawè¿‡ç¨‹åˆ†æ"></a><code>Draw</code>è¿‡ç¨‹åˆ†æ</h2><p><code>Draw</code>è¿‡ç¨‹æœ€é‡è¦çš„ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>View.dispatchDraw(Canvas)</code>:<br>è¯¥æ–¹æ³•å‘èµ·å¯¹å­è§†å›¾çš„ç»˜åˆ¶ã€‚<code>View</code>ä¸­é»˜è®¤æ˜¯ç©ºå®ç°ï¼Œ<code>ViewGroup</code>è¦†å†™äº†<code>dispatchDraw()</code>æ¥å¯¹å…¶å­è§†å›¾è¿›è¡Œç»˜åˆ¶ã€‚è¯¥æ–¹æ³•æˆ‘ä»¬ä¸ç”¨å»ç®¡ï¼Œè‡ªå®šä¹‰çš„<code>ViewGroup</code>ä¸åº”è¯¥å¯¹<code>dispatchDraw()</code>è¿›è¡Œå¤å†™ã€‚</li><li><code>View.draw(Canvas)</code>:<br>ç”±äº<code>ViewGroup</code>å¹¶æ²¡æœ‰è¦†å†™æ­¤æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ‰€æœ‰çš„è§†å›¾æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨<code>View</code>çš„<code>draw</code>æ–¹æ³•è¿›è¡Œç»˜åˆ¶çš„ã€‚åœ¨è‡ªå®šä¹‰çš„è§†å›¾ä¸­ï¼Œä¹Ÿä¸åº”è¯¥è¦†å†™è¯¥æ–¹æ³•ï¼Œè€Œæ˜¯è¦†å†™<code>onDraw(Canvas)</code>æ–¹æ³•è¿›è¡Œç»˜åˆ¶ï¼Œå¦‚æœè‡ªå®šä¹‰çš„è§†å›¾ç¡®å®è¦è¦†å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆè¯·å…ˆè°ƒç”¨<code>super.draw(canvas)</code>å®Œæˆç³»ç»Ÿçš„ç»˜åˆ¶ï¼Œç„¶åå†è¿›è¡Œè‡ªå®šä¹‰çš„ç»˜åˆ¶ã€‚</li><li><code>View.onDraw(Canvas)</code>:<br><code>View.onDraw(Canvas)</code>é»˜è®¤æ˜¯ç©ºå®ç°ï¼Œè‡ªå®šä¹‰ç»˜åˆ¶è¿‡ç¨‹éœ€è¦è¦†å†™çš„æ–¹æ³•ï¼Œç”¨æ¥ç»˜åˆ¶è‡ªèº«çš„å†…å®¹ã€‚</li></ul><p>æ¥çœ‹çœ‹æºç å§ï¼š</p><p>å…ˆæ¥çœ‹<code>ViewGroup.dispatchDraw(Canvas)</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•ç”±ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸»åŠ¨è°ƒç”¨ï¼š</p><pre><code class="java">    @Override    protected void dispatchDraw(Canvas canvas) &#123;        boolean usingRenderNodeProperties = canvas.isRecordingFor(mRenderNode);        final int childrenCount = mChildrenCount;        final View[] children = mChildren;        int flags = mGroupFlags;        if ((flags &amp; FLAG_RUN_ANIMATION) != 0 &amp;&amp; canAnimate()) &#123;            final boolean buildCache = !isHardwareAccelerated();            for (int i = 0; i &lt; childrenCount; i++) &#123;                final View child = children[i];                if ((child.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE) &#123;                    final LayoutParams params = child.getLayoutParams();                    attachLayoutAnimationParameters(child, params, i, childrenCount);                    bindLayoutAnimation(child);                &#125;            &#125;            final LayoutAnimationController controller = mLayoutAnimationController;            if (controller.willOverlap()) &#123;                mGroupFlags |= FLAG_OPTIMIZE_INVALIDATE;            &#125;            controller.start();            mGroupFlags &amp;= ~FLAG_RUN_ANIMATION;            mGroupFlags &amp;= ~FLAG_ANIMATION_DONE;            if (mAnimationListener != null) &#123;                mAnimationListener.onAnimationStart(controller.getAnimation());            &#125;        &#125;        int clipSaveCount = 0;        final boolean clipToPadding = (flags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK;        if (clipToPadding) &#123;            clipSaveCount = canvas.save(Canvas.CLIP_SAVE_FLAG);            canvas.clipRect(mScrollX + mPaddingLeft, mScrollY + mPaddingTop,                    mScrollX + mRight - mLeft - mPaddingRight,                    mScrollY + mBottom - mTop - mPaddingBottom);        &#125;        // We will draw our child&#39;s animation, let&#39;s reset the flag        mPrivateFlags &amp;= ~PFLAG_DRAW_ANIMATION;        mGroupFlags &amp;= ~FLAG_INVALIDATE_REQUIRED;        boolean more = false;        final long drawingTime = getDrawingTime();        if (usingRenderNodeProperties) canvas.insertReorderBarrier();        final int transientCount = mTransientIndices == null ? 0 : mTransientIndices.size();        int transientIndex = transientCount != 0 ? 0 : -1;        // Only use the preordered list if not HW accelerated, since the HW pipeline will do the        // draw reordering internally        final ArrayList&lt;View&gt; preorderedList = usingRenderNodeProperties                ? null : buildOrderedChildList();        final boolean customOrder = preorderedList == null                &amp;&amp; isChildrenDrawingOrderEnabled();        // å¼€å§‹ç»˜åˆ¶ child        for (int i = 0; i &lt; childrenCount; i++) &#123;            while (transientIndex &gt;= 0 &amp;&amp; mTransientIndices.get(transientIndex) == i) &#123;                final View transientChild = mTransientViews.get(transientIndex);                if ((transientChild.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE ||                        transientChild.getAnimation() != null) &#123;                    more |= drawChild(canvas, transientChild, drawingTime);                &#125;                transientIndex++;                if (transientIndex &gt;= transientCount) &#123;                    transientIndex = -1;                &#125;            &#125;            final int childIndex = getAndVerifyPreorderedIndex(childrenCount, i, customOrder);            final View child = getAndVerifyPreorderedView(preorderedList, children, childIndex);            if ((child.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE || child.getAnimation() != null) &#123;                more |= drawChild(canvas, child, drawingTime);            &#125;        &#125;        while (transientIndex &gt;= 0) &#123;            // there may be additional transient views after the normal views            final View transientChild = mTransientViews.get(transientIndex);            if ((transientChild.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE ||                    transientChild.getAnimation() != null) &#123;                more |= drawChild(canvas, transientChild, drawingTime);            &#125;            transientIndex++;            if (transientIndex &gt;= transientCount) &#123;                break;            &#125;        &#125;        if (preorderedList != null) preorderedList.clear();        // Draw any disappearing views that have animations        if (mDisappearingChildren != null) &#123;            final ArrayList&lt;View&gt; disappearingChildren = mDisappearingChildren;            final int disappearingCount = disappearingChildren.size() - 1;            // Go backwards -- we may delete as animations finish            for (int i = disappearingCount; i &gt;= 0; i--) &#123;                final View child = disappearingChildren.get(i);                more |= drawChild(canvas, child, drawingTime);            &#125;        &#125;        if (usingRenderNodeProperties) canvas.insertInorderBarrier();        if (debugDraw()) &#123;            onDebugDraw(canvas);        &#125;        if (clipToPadding) &#123;            canvas.restoreToCount(clipSaveCount);        &#125;        // mGroupFlags might have been updated by drawChild()        flags = mGroupFlags;        if ((flags &amp; FLAG_INVALIDATE_REQUIRED) == FLAG_INVALIDATE_REQUIRED) &#123;            invalidate(true);        &#125;        if ((flags &amp; FLAG_ANIMATION_DONE) == 0 &amp;&amp; (flags &amp; FLAG_NOTIFY_ANIMATION_LISTENER) == 0 &amp;&amp;                mLayoutAnimationController.isDone() &amp;&amp; !more) &#123;            // We want to erase the drawing cache and notify the listener after the            // next frame is drawn because one extra invalidate() is caused by            // drawChild() after the animation is over            mGroupFlags |= FLAG_NOTIFY_ANIMATION_LISTENER;            final Runnable end = new Runnable() &#123;               @Override               public void run() &#123;                   notifyAnimationListener();               &#125;            &#125;;            post(end);        &#125;    &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>dispatchDraw(Canvas)</code>æ–¹æ³•ä¸»è¦æœ‰å¤„ç†åŠ¨ç”»ç›¸å…³çš„äº‹åŠ¡ã€ç»˜åˆ¶childã€ç»˜åˆ¶æ¶ˆå¤±çš„childã€‚</p><p>åœ¨ç»˜åˆ¶childæ—¶ï¼Œè°ƒç”¨çš„<code>drawChild()</code>å¦‚ä¸‹ï¼š</p><pre><code class="java">    /**     * ç»˜åˆ¶è¯¥ ViewGroup å…¶ä¸­ä¸€ä¸ª childã€‚è¯¥æ–¹æ³•çš„ä¸»è¦èŒè´£æ˜¯å°† canvas ç½®ä¸ºåˆé€‚çš„çŠ¶æ€ï¼ˆåŒ…æ‹¬ clippingã€translatingç­‰ï¼‰ï¼Œ     * è®© child çš„åˆå§‹æ»šåŠ¨ä½ç½®ç½®ä¸º 0,0ï¼Œå¹¶åº”ç”¨åŠ¨ç”»æ•ˆæœã€‚     *     * @param canvas The canvas on which to draw the child     * @param child Who to draw     * @param drawingTime The time at which draw is occurring     * @return True if an invalidate() was issued     */    protected boolean drawChild(Canvas canvas, View child, long drawingTime) &#123;        return child.draw(canvas, this, drawingTime);    &#125;</code></pre><p>æ¥ç€å°±æ˜¯<code>View.draw(Canvas)</code>éƒ¨åˆ†ï¼š</p><pre><code class="java">    /**     * ä½¿ç”¨ç»™å®šçš„ canvas æ‰‹åŠ¨æ¸²æŸ“è¿™ä¸ª viewï¼ˆå’Œå®ƒçš„å­ view ä»¬ï¼‰ã€‚     * è¯¥ view å¿…é¡»å·²ç»å®Œæˆäº† layout è¿‡ç¨‹ï¼Œæ‰èƒ½è°ƒç”¨è¯¥æ–¹æ³•ã€‚     * å½“å®ç°è‡ªå®šä¹‰ view æ—¶ï¼Œè¦†å†™onDraw(Canvas)æ–¹æ³•ï¼Œè€Œä¸æ˜¯è¦†å†™draw(Canvas)æ–¹æ³•ã€‚å¦‚æœçœŸçš„è¦è¦†å†™ï¼Œé‚£å…ˆè°ƒç”¨ä¸€ä¸ªsuper.draw(canvas)     *     * @param canvas The Canvas to which the View is rendered.     */    @CallSuper    public void draw(Canvas canvas) &#123;        final int privateFlags = mPrivateFlags;        mPrivateFlags = (privateFlags &amp; ~PFLAG_DIRTY_MASK) | PFLAG_DRAWN;        /*         * éå†ç»˜åˆ¶éœ€è¦æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥ï¼š         *         *      1. ç»˜åˆ¶èƒŒæ™¯         *      2. å¦‚æœéœ€è¦ç»˜åˆ¶è¾¹ç¼˜æ¸éšï¼Œåˆ™éœ€è¦ä¿å­˜ canvas çš„å›¾å±‚         *      3. ç»˜åˆ¶ view çš„å†…å®¹         *      4. ç»˜åˆ¶ child         *      5. å¦‚æœéœ€è¦ï¼Œç»˜åˆ¶è¾¹ç¼˜æ¸éšå¹¶æ¢å¤å›¾å±‚         *      6. ç»˜åˆ¶å…¶ä»–è£…é¥°ï¼ˆæ¯”å¦‚ scrollbarï¼‰         */        // ç¬¬1æ­¥ï¼Œç»˜åˆ¶èƒŒæ™¯        int saveCount;        drawBackground(canvas);        // å¦‚æœå¯èƒ½çš„è¯ï¼Œè·³è¿‡ç¬¬2æ­¥å’Œç¬¬5æ­¥ã€‚        final int viewFlags = mViewFlags;        boolean horizontalEdges = (viewFlags &amp; FADING_EDGE_HORIZONTAL) != 0;        boolean verticalEdges = (viewFlags &amp; FADING_EDGE_VERTICAL) != 0;        if (!verticalEdges &amp;&amp; !horizontalEdges) &#123;            // ç¬¬3æ­¥ï¼Œç»˜åˆ¶å†…å®¹            onDraw(canvas);            // ç¬¬4æ­¥ï¼Œç»˜åˆ¶å­child            dispatchDraw(canvas);            drawAutofilledHighlight(canvas);            // Overlay ä¹Ÿæ˜¯å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œç»˜åˆ¶åœ¨å‰æ™¯çš„ä¸‹å±‚            if (mOverlay != null &amp;&amp; !mOverlay.isEmpty()) &#123;                mOverlay.getOverlayView().dispatchDraw(canvas);            &#125;            // ç¬¬6æ­¥ï¼Œç»˜åˆ¶å…¶ä»–è£…é¥°ï¼ˆå‰æ™¯è‰²å•Š scrollbar å•Šï¼‰            onDrawForeground(canvas);            // ç¬¬7æ­¥ï¼Œç»˜åˆ¶é»˜è®¤çš„ç„¦ç‚¹é«˜äº®            drawDefaultFocusHighlight(canvas);            if (debugDraw()) &#123;                debugDrawFocus(canvas);            &#125;            // å®Œäº‹å„¿èµ°äºº            return;        &#125;        /*         * è¿™å„¿å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„æµç¨‹ï¼Œè¿™ä¸ªæµç¨‹å¹¶ä¸å¸¸è§ï¼Œå› ä¸ºå®ƒä¼šå¯¹é€Ÿåº¦æœ‰ä¸€å®šçš„å½±å“ã€‚         */        boolean drawTop = false;        boolean drawBottom = false;        boolean drawLeft = false;        boolean drawRight = false;        float topFadeStrength = 0.0f;        float bottomFadeStrength = 0.0f;        float leftFadeStrength = 0.0f;        float rightFadeStrength = 0.0f;        // ç¬¬2æ­¥ï¼Œä¿å­˜ canvas çš„å›¾å±‚        int paddingLeft = mPaddingLeft;        final boolean offsetRequired = isPaddingOffsetRequired();        if (offsetRequired) &#123;            paddingLeft += getLeftPaddingOffset();        &#125;        int left = mScrollX + paddingLeft;        int right = left + mRight - mLeft - mPaddingRight - paddingLeft;        int top = mScrollY + getFadeTop(offsetRequired);        int bottom = top + getFadeHeight(offsetRequired);        if (offsetRequired) &#123;            right += getRightPaddingOffset();            bottom += getBottomPaddingOffset();        &#125;        final ScrollabilityCache scrollabilityCache = mScrollCache;        final float fadeHeight = scrollabilityCache.fadingEdgeLength;        int length = (int) fadeHeight;        // clip the fade length if top and bottom fades overlap        // overlapping fades produce odd-looking artifacts        if (verticalEdges &amp;&amp; (top + length &gt; bottom - length)) &#123;            length = (bottom - top) / 2;        &#125;        // also clip horizontal fades if necessary        if (horizontalEdges &amp;&amp; (left + length &gt; right - length)) &#123;            length = (right - left) / 2;        &#125;        if (verticalEdges) &#123;            topFadeStrength = Math.max(0.0f, Math.min(1.0f, getTopFadingEdgeStrength()));            drawTop = topFadeStrength * fadeHeight &gt; 1.0f;            bottomFadeStrength = Math.max(0.0f, Math.min(1.0f, getBottomFadingEdgeStrength()));            drawBottom = bottomFadeStrength * fadeHeight &gt; 1.0f;        &#125;        if (horizontalEdges) &#123;            leftFadeStrength = Math.max(0.0f, Math.min(1.0f, getLeftFadingEdgeStrength()));            drawLeft = leftFadeStrength * fadeHeight &gt; 1.0f;            rightFadeStrength = Math.max(0.0f, Math.min(1.0f, getRightFadingEdgeStrength()));            drawRight = rightFadeStrength * fadeHeight &gt; 1.0f;        &#125;        saveCount = canvas.getSaveCount();        int topSaveCount = -1;        int bottomSaveCount = -1;        int leftSaveCount = -1;        int rightSaveCount = -1;        int solidColor = getSolidColor();        if (solidColor == 0) &#123;            if (drawTop) &#123;                topSaveCount = canvas.saveUnclippedLayer(left, top, right, top + length);            &#125;            if (drawBottom) &#123;                bottomSaveCount = canvas.saveUnclippedLayer(left, bottom - length, right, bottom);            &#125;            if (drawLeft) &#123;                leftSaveCount = canvas.saveUnclippedLayer(left, top, left + length, bottom);            &#125;            if (drawRight) &#123;                rightSaveCount = canvas.saveUnclippedLayer(right - length, top, right, bottom);            &#125;        &#125; else &#123;            scrollabilityCache.setFadeColor(solidColor);        &#125;        // ç¬¬3æ­¥ï¼Œç»˜åˆ¶å†…å®¹         onDraw(canvas);        // ç¬¬4æ­¥ï¼Œç»˜åˆ¶child        dispatchDraw(canvas);        // ç¬¬5æ­¥ï¼Œç»˜åˆ¶æ¸éšè¾¹ç¼˜å¹¶æ¢å¤å›¾å±‚        final Paint p = scrollabilityCache.paint;        final Matrix matrix = scrollabilityCache.matrix;        final Shader fade = scrollabilityCache.shader;        // è¿˜å¾—æŒ‰ç…§ä¿å­˜çš„é¡ºåºåå‘æ¢å¤        if (drawRight) &#123;            matrix.setScale(1, fadeHeight * rightFadeStrength);            matrix.postRotate(90);            matrix.postTranslate(right, top);            fade.setLocalMatrix(matrix);            p.setShader(fade);            if (solidColor == 0) &#123;                canvas.restoreUnclippedLayer(rightSaveCount, p);            &#125; else &#123;                canvas.drawRect(right - length, top, right, bottom, p);            &#125;        &#125;        if (drawLeft) &#123;            matrix.setScale(1, fadeHeight * leftFadeStrength);            matrix.postRotate(-90);            matrix.postTranslate(left, top);            fade.setLocalMatrix(matrix);            p.setShader(fade);            if (solidColor == 0) &#123;                canvas.restoreUnclippedLayer(leftSaveCount, p);            &#125; else &#123;                canvas.drawRect(left, top, left + length, bottom, p);            &#125;        &#125;        if (drawBottom) &#123;            matrix.setScale(1, fadeHeight * bottomFadeStrength);            matrix.postRotate(180);            matrix.postTranslate(left, bottom);            fade.setLocalMatrix(matrix);            p.setShader(fade);            if (solidColor == 0) &#123;                canvas.restoreUnclippedLayer(bottomSaveCount, p);            &#125; else &#123;                canvas.drawRect(left, bottom - length, right, bottom, p);            &#125;        &#125;        if (drawTop) &#123;            matrix.setScale(1, fadeHeight * topFadeStrength);            matrix.postTranslate(left, top);            fade.setLocalMatrix(matrix);            p.setShader(fade);            if (solidColor == 0) &#123;                canvas.restoreUnclippedLayer(topSaveCount, p);            &#125; else &#123;                canvas.drawRect(left, top, right, top + length, p);            &#125;        &#125;        canvas.restoreToCount(saveCount);        drawAutofilledHighlight(canvas);        // Overlay ä¹Ÿæ˜¯å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œç»˜åˆ¶åœ¨å‰æ™¯çš„ä¸‹å±‚        if (mOverlay != null &amp;&amp; !mOverlay.isEmpty()) &#123;            mOverlay.getOverlayView().dispatchDraw(canvas);        &#125;        // ç¬¬6æ­¥ï¼Œç»˜åˆ¶å…¶ä»–è£…é¥°ï¼ˆå‰æ™¯è‰²å•Š scrollbar å•Šï¼‰        onDrawForeground(canvas);        if (debugDraw()) &#123;            debugDrawFocus(canvas);        &#125;    &#125;</code></pre><p>ç”±ä»£ç å¯ä»¥çœ‹å‡ºï¼Œç¬¬2æ­¥å’Œç¬¬5æ­¥æ˜¯å¯ä»¥çœç•¥ä¸åšçš„ï¼Œå¹¶ä¸”å¯ä»¥æå¤§åœ°æé«˜æ€§èƒ½ã€‚æ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸è¦è®¾ç½®FadingEdgeã€‚</p><p>::: tip</p><p>FadingEdgeæ˜¯ä¸ªå•¥ï¼Ÿ</p><p>å°±æ˜¯<strong>è¾¹ç¼˜æ¸éš</strong>ï¼Œé€šå¸¸é•¿è¿™ä¸ªæ ·å­ï¼š</p><p><img width="20%" src="/img/5.png"></img></p><p>æ ¹æ®<a href="https://developer.android.com/reference/android/R.attr.html#fadingEdge">å®˜æ–¹æ–‡æ¡£</a>æ¥çœ‹ï¼Œandroid:fadingEdgeå·²ç»è¢«å¼ƒç”¨äº†ã€‚å¦‚æœæƒ³å®ç°è¿™ç§æ•ˆæœï¼Œè¦è¿™æ ·è®¾ç½®ï¼š</p><pre><code class="xml">android:requiresFadingEdge=&quot;horizontal&quot;android:fadingEdgeLength=&quot;40dp&quot;android:ellipsize=&quot;none&quot;</code></pre><p>åŒæ—¶ï¼Œå°½é‡å°†<code>layout_width</code>è®¾ç½®ä¸º<code>match_parent</code>æˆ–è€…<code>100dp</code>ä¹‹ç±»çš„ã€‚<br>:::</p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ‹¿<code>LinearLayout</code>æ¥ä¸¾ä¾‹ï¼Œçœ‹çœ‹å®ƒçš„<code>onDraw(Canvas)</code>æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p><pre><code class="java">    @Override    protected void onDraw(Canvas canvas) &#123;        if (mDivider == null) &#123;            return;        &#125;        if (mOrientation == VERTICAL) &#123;            drawDividersVertical(canvas);        &#125; else &#123;            drawDividersHorizontal(canvas);        &#125;    &#125;    void drawDividersVertical(Canvas canvas) &#123;        final int count = getVirtualChildCount();        for (int i = 0; i &lt; count; i++) &#123;            final View child = getVirtualChildAt(i);            if (child != null &amp;&amp; child.getVisibility() != GONE) &#123;                if (hasDividerBeforeChildAt(i)) &#123;                    final LayoutParams lp = (LayoutParams) child.getLayoutParams();                    final int top = child.getTop() - lp.topMargin - mDividerHeight;                    drawHorizontalDivider(canvas, top);                &#125;            &#125;        &#125;        if (hasDividerBeforeChildAt(count)) &#123;            final View child = getLastNonGoneChild();            int bottom = 0;            if (child == null) &#123;                bottom = getHeight() - getPaddingBottom() - mDividerHeight;            &#125; else &#123;                final LayoutParams lp = (LayoutParams) child.getLayoutParams();                bottom = child.getBottom() + lp.bottomMargin;            &#125;            drawHorizontalDivider(canvas, bottom);        &#125;    &#125;    void drawDividersHorizontal(Canvas canvas) &#123;        final int count = getVirtualChildCount();        final boolean isLayoutRtl = isLayoutRtl();        for (int i = 0; i &lt; count; i++) &#123;            final View child = getVirtualChildAt(i);            if (child != null &amp;&amp; child.getVisibility() != GONE) &#123;                if (hasDividerBeforeChildAt(i)) &#123;                    final LayoutParams lp = (LayoutParams) child.getLayoutParams();                    final int position;                    if (isLayoutRtl) &#123;                        position = child.getRight() + lp.rightMargin;                    &#125; else &#123;                        position = child.getLeft() - lp.leftMargin - mDividerWidth;                    &#125;                    drawVerticalDivider(canvas, position);                &#125;            &#125;        &#125;        if (hasDividerBeforeChildAt(count)) &#123;            final View child = getLastNonGoneChild();            int position;            if (child == null) &#123;                if (isLayoutRtl) &#123;                    position = getPaddingLeft();                &#125; else &#123;                    position = getWidth() - getPaddingRight() - mDividerWidth;                &#125;            &#125; else &#123;                final LayoutParams lp = (LayoutParams) child.getLayoutParams();                if (isLayoutRtl) &#123;                    position = child.getLeft() - lp.leftMargin - mDividerWidth;                &#125; else &#123;                    position = child.getRight() + lp.rightMargin;                &#125;            &#125;            drawVerticalDivider(canvas, position);        &#125;    &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>LinearLayout</code>çš„<code>onDraw(Canvas)</code>æ–¹æ³•ä¸­ï¼Œåªæ˜¯å¤šç»˜åˆ¶äº†ä¸€ä¸ª<code>divider</code>ï¼Œå¦‚æœæ²¡æœ‰<code>divider</code>çš„è¯ï¼Œé‚£å°±ä¸å†å¤„ç†ã€‚</p><h2 id="å…¶ä»–çš„é‡è¦æ–¹æ³•"><a href="#å…¶ä»–çš„é‡è¦æ–¹æ³•" class="headerlink" title="å…¶ä»–çš„é‡è¦æ–¹æ³•"></a>å…¶ä»–çš„é‡è¦æ–¹æ³•</h2><ul><li><code>invalidate()</code>æ–¹æ³•ï¼š</li></ul><p>è¯¥æ–¹æ³•è¯·æ±‚é‡ç»˜<code>View</code>æ ‘ï¼Œå³<code>draw</code>è¿‡ç¨‹ï¼Œå‡å¦‚è§†å›¾å‘ç”Ÿå¤§å°æ²¡æœ‰å˜åŒ–å°±ä¸ä¼šè°ƒç”¨<code>layout</code>è¿‡ç¨‹ï¼Œå¹¶ä¸”åªç»˜åˆ¶é‚£äº›ã€éœ€è¦é‡ç»˜çš„ã€<br>è§†å›¾ï¼Œå³è°è¯·æ±‚<code>invalidate()</code>æ–¹æ³•ï¼Œå°±ç»˜åˆ¶è°(<code>View</code>çš„è¯ï¼Œåªç»˜åˆ¶è¯¥<code>View</code>ï¼›<code>ViewGroup</code>ï¼Œåˆ™ç»˜åˆ¶æ•´ä¸ª<code>ViewGroup</code>)ã€‚</p><p>ä¸€èˆ¬å¼•èµ·<code>invalidate()</code>æ“ä½œçš„å‡½æ•°å¦‚ä¸‹ï¼š</p><ol><li><p>ç›´æ¥è°ƒç”¨<code>invalidate()</code>æ–¹æ³•ï¼Œè¯·æ±‚é‡æ–°<code>draw()</code>ï¼Œä½†åªä¼šç»˜åˆ¶è°ƒç”¨è€…æœ¬èº«ã€‚</p></li><li><p><code>setSelection()</code>æ–¹æ³• ï¼šè¯·æ±‚é‡æ–°<code>draw()</code>ï¼Œä½†åªä¼šç»˜åˆ¶è°ƒç”¨è€…æœ¬èº«ã€‚</p></li><li><p><code>setVisibility()</code>æ–¹æ³• ï¼š å½“<code>View</code>å¯è§†çŠ¶æ€åœ¨<code>INVISIBLE</code>è½¬æ¢<code>VISIBLE</code>æ—¶ï¼Œä¼šé—´æ¥è°ƒç”¨<code>invalidate()</code>æ–¹æ³•ï¼Œ<br>ç»§è€Œç»˜åˆ¶è¯¥Viewã€‚</p></li><li><p><code>setEnabled()</code>æ–¹æ³• ï¼š è¯·æ±‚é‡æ–°<code>draw()</code>ï¼Œä½†ä¸ä¼šé‡æ–°ç»˜åˆ¶ä»»ä½•è§†å›¾åŒ…æ‹¬è¯¥è°ƒç”¨è€…æœ¬èº«ã€‚</p></li></ol><ul><li><code>requestLayout()</code>æ–¹æ³•ï¼š</li></ul><p>çœ‹å­—é¢æ„æ€ã€è¯·æ±‚å¸ƒå±€ã€ã€‚è°ƒç”¨è¯¥æ–¹æ³•ä¼šå¯¼è‡´è°ƒç”¨<code>measure</code>è¿‡ç¨‹å’Œ<code>layout</code>è¿‡ç¨‹ï¼Œä½†åªæ˜¯å¯¹<code>View</code>æ ‘é‡æ–°å¸ƒå±€ï¼Œä¸ä¼šè°ƒç”¨<code>draw</code>è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šé‡æ–°ç»˜åˆ¶ã€‚</p><p>çœ‹ä¸€çœ¼å®ƒçš„æºç å§ï¼š</p><pre><code class="java">    /**     * å½“æŸäº›ä¸œè¥¿å‘ç”Ÿäº†æ”¹å˜å¹¶åˆ·æ–°äº† View å¸ƒå±€æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚     * è¯¥æ–¹æ³•ä¼šå¯¹ View æ ‘è¿›è¡Œä¸€æ¬¡ layout æµç¨‹ã€‚     * è¯¥æ–¹æ³•ä¸åº”è¯¥åœ¨ view æ ‘æ­£åœ¨è¿›è¡Œ layout æµç¨‹ï¼ˆå¯ç”± isInLayout()æ–¹æ³•åˆ¤æ–­ï¼‰æ—¶è¢«è°ƒç”¨ã€‚     * å¦‚æœè°ƒç”¨è¯¥æ–¹æ³•æ—¶æ­£åœ¨è¿›è¡Œ layout æµç¨‹ï¼Œè¿™æ¬¡çš„è¯·æ±‚ä¼šè¢«æ”¾åœ¨å½“å‰ layout æµç¨‹ç»“æŸä¹‹åï¼ˆä¹Ÿå°±æ˜¯å†è·‘ä¸€æ¬¡ï¼‰ï¼Œæˆ–è€…æ˜¯     * ç»˜åˆ¶å®Œå½“å‰å¸§ä¹‹åã€‚     *     * å­ç±»è¦†å†™è¯¥æ–¹æ³•æ—¶ï¼Œè¦è°ƒç”¨ super.requestLayout() ä»¥ä¿è¯èƒ½æ­£ç¡®å¤„ç†ä¸€äº› request-during-layout çš„é”™è¯¯ã€‚     */    @CallSuper    public void requestLayout() &#123;        if (mMeasureCache != null) mMeasureCache.clear();        if (mAttachInfo != null &amp;&amp; mAttachInfo.mViewRequestingLayout == null) &#123;            // Only trigger request-during-layout logic if this is the view requesting it,            // not the views in its parent hierarchy            ViewRootImpl viewRoot = getViewRootImpl();            if (viewRoot != null &amp;&amp; viewRoot.isInLayout()) &#123;                if (!viewRoot.requestLayoutDuringLayout(this)) &#123;                    return;                &#125;            &#125;            mAttachInfo.mViewRequestingLayout = this;        &#125;        mPrivateFlags |= PFLAG_FORCE_LAYOUT;        mPrivateFlags |= PFLAG_INVALIDATED;        if (mParent != null &amp;&amp; !mParent.isLayoutRequested()) &#123;            mParent.requestLayout();        &#125;        if (mAttachInfo != null &amp;&amp; mAttachInfo.mViewRequestingLayout == this) &#123;            mAttachInfo.mViewRequestingLayout = null;        &#125;    &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>requestLayout()</code>æ–¹æ³•ä¼šä¸æ–­å‘ä¸Šä¼ ï¼Œå‘çˆ¶<code>view</code>è¯·æ±‚å¸ƒå±€ï¼Œæœ€åä¼šäº¤ç»™<code>DecorView</code>ï¼Œä¹Ÿå³æ ¹<code>view</code>ï¼Œæœ€ç»ˆä¼šè¢«<code>ViewRootImpl</code>æ¥æ”¶å¹¶å¾—åˆ°å¤„ç†ã€‚å…³äº<code>ViewRootImpl</code>ï¼Œä¼šå•å¼€ä¸€ç¯‡æ–‡ç« å†æ¥è®²ï¼Œé‡Œé¢ä¼šæ¶‰åŠåˆ°<code>Activity</code>ã€<code>Window</code>ã€<code>WindowManager</code>ç­‰å†…å®¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Framework </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jetpack ç”±æµ…å…¥æ·±</title>
      <link href="/2023-01-31//"/>
      <url>/2023-01-31//</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¼šæŠŠ Jetpack ä¸­æ‰€æœ‰çš„ç»„ä»¶ï¼Œä»¥å•ç¯‡æ–‡ç« çš„å½¢å¼æ¥ä¸€ä¸€è®²è§£ã€‚</p><p>ç´¢å¼•ï¼š</p><ul><li><a href="">LiveModel</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2023-01-31//"/>
      <url>/2023-01-31//</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å…¶ä»–æ‰©å±•é¢è¯•é¢˜</title>
      <link href="/2021-01-09//"/>
      <url>/2021-01-09//</url>
      
        <content type="html"><![CDATA[<h2 id="å…¶ä»–æ‰©å±•é¢è¯•é¢˜"><a href="#å…¶ä»–æ‰©å±•é¢è¯•é¢˜" class="headerlink" title="å…¶ä»–æ‰©å±•é¢è¯•é¢˜"></a>å…¶ä»–æ‰©å±•é¢è¯•é¢˜</h2><span id="more"></span><h3 id="ä¸€ã€Kotlin-ï¼ˆâ­â­ï¼‰"><a href="#ä¸€ã€Kotlin-ï¼ˆâ­â­ï¼‰" class="headerlink" title="ä¸€ã€Kotlin ï¼ˆâ­â­ï¼‰"></a>ä¸€ã€Kotlin ï¼ˆâ­â­ï¼‰</h3><h4 id="1ã€Kotlin-ç‰¹æ€§ï¼Œå’Œ-Java-ç›¸æ¯”æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹"><a href="#1ã€Kotlin-ç‰¹æ€§ï¼Œå’Œ-Java-ç›¸æ¯”æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹" class="headerlink" title="1ã€Kotlin ç‰¹æ€§ï¼Œå’Œ Java ç›¸æ¯”æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹?"></a>1ã€Kotlin ç‰¹æ€§ï¼Œå’Œ Java ç›¸æ¯”æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹?</h4><ul><li>èƒ½ç›´æ¥ä¸Javaç›¸äº’è°ƒç”¨ï¼Œèƒ½ä¸Javaå·¥ç¨‹å…±å­˜</li><li>å¤§å¤§å‡å°‘æ ·æ¿ä»£ç </li><li>å¯ä»¥å°†Kotlinä»£ç ç¼–è¯‘ä¸ºæ— éœ€è™šæ‹Ÿæœºå°±å¯è¿è¡Œçš„åŸç”ŸäºŒè¿›åˆ¶æ–‡ä»¶</li><li>æ”¯æŒåç¨‹</li><li>æ”¯æŒé«˜é˜¶å‡½æ•°</li><li>è¯­è¨€å±‚é¢è§£å†³ç©ºæŒ‡é’ˆé—®é¢˜</li><li>å¯¹å­—ç¬¦ä¸²æ ¼å¼åŒ–çš„å¤„ç†ï¼ˆ$å˜é‡åï¼‰</li><li>æ›´åƒPythonçš„è¯­æ³•</li><li>å¯¹Î»è¡¨è¾¾å¼æ”¯æŒæ›´å¥½</li></ul><p><a href="https://mp.weixin.qq.com/s/FqXLNz5p9M-5vcMUkxJyFQ">https://mp.weixin.qq.com/s/FqXLNz5p9M-5vcMUkxJyFQ</a></p><h4 id="2ã€Kotlinä¸ºä»€ä¹ˆèƒ½å’ŒJavaæ··ç¼–"><a href="#2ã€Kotlinä¸ºä»€ä¹ˆèƒ½å’ŒJavaæ··ç¼–" class="headerlink" title="2ã€Kotlinä¸ºä»€ä¹ˆèƒ½å’ŒJavaæ··ç¼–?"></a>2ã€Kotlinä¸ºä»€ä¹ˆèƒ½å’ŒJavaæ··ç¼–?</h4><h4 id="3ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ</h4><h3 id="äºŒã€å¤§å‰ç«¯-ï¼ˆâ­â­ï¼‰"><a href="#äºŒã€å¤§å‰ç«¯-ï¼ˆâ­â­ï¼‰" class="headerlink" title="äºŒã€å¤§å‰ç«¯ ï¼ˆâ­â­ï¼‰"></a>äºŒã€å¤§å‰ç«¯ ï¼ˆâ­â­ï¼‰</h3><h4 id="1ã€Hybridé€šä¿¡åŸç†æ˜¯ä»€ä¹ˆï¼Œæœ‰åšç ”ç©¶å—ï¼Ÿ"><a href="#1ã€Hybridé€šä¿¡åŸç†æ˜¯ä»€ä¹ˆï¼Œæœ‰åšç ”ç©¶å—ï¼Ÿ" class="headerlink" title="1ã€Hybridé€šä¿¡åŸç†æ˜¯ä»€ä¹ˆï¼Œæœ‰åšç ”ç©¶å—ï¼Ÿ"></a>1ã€Hybridé€šä¿¡åŸç†æ˜¯ä»€ä¹ˆï¼Œæœ‰åšç ”ç©¶å—ï¼Ÿ</h4><h4 id="2ã€JSçš„äº¤äº’ç†è§£å—ï¼Ÿå¹³æ—¶å·¥ä½œç”¨çš„å¤šå—ï¼Œé¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä¸Webäº¤äº’çš„ï¼Ÿ"><a href="#2ã€JSçš„äº¤äº’ç†è§£å—ï¼Ÿå¹³æ—¶å·¥ä½œç”¨çš„å¤šå—ï¼Œé¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä¸Webäº¤äº’çš„ï¼Ÿ" class="headerlink" title="2ã€JSçš„äº¤äº’ç†è§£å—ï¼Ÿå¹³æ—¶å·¥ä½œç”¨çš„å¤šå—ï¼Œé¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä¸Webäº¤äº’çš„ï¼Ÿ"></a>2ã€JSçš„äº¤äº’ç†è§£å—ï¼Ÿå¹³æ—¶å·¥ä½œç”¨çš„å¤šå—ï¼Œé¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä¸Webäº¤äº’çš„ï¼Ÿ</h4><h5 id="Androidé€šè¿‡WebViewè°ƒç”¨JSä»£ç ï¼š"><a href="#Androidé€šè¿‡WebViewè°ƒç”¨JSä»£ç ï¼š" class="headerlink" title="Androidé€šè¿‡WebViewè°ƒç”¨JSä»£ç ï¼š"></a>Androidé€šè¿‡WebViewè°ƒç”¨JSä»£ç ï¼š</h5><p>1ã€é€šè¿‡WebViewçš„loadUrl()ï¼š</p><ul><li><p>è®¾ç½®ä¸Jsäº¤äº’çš„æƒé™ï¼š</p><p>webSettings.setJavaScriptEnabled(true)</p></li><li><p>è®¾ç½®å…è®¸JSå¼¹çª—ï¼š</p><p>webSettings.setJavaScriptCanOpenWindowsAutomatically(true)</p></li><li><p>è½½å…¥JSä»£ç ï¼š</p><p>mWebView.loadUrl(â€œfile:///android_asset/javascript.htmlâ€)</p></li><li><p>webviewåªæ˜¯è½½ä½“ï¼Œå†…å®¹çš„æ¸²æŸ“éœ€è¦ä½¿ç”¨webviewChromClientç±»å»å®ç°ï¼Œé€šè¿‡è®¾ç½®WebChromeClientå¯¹è±¡å¤„ç†JavaScriptçš„å¯¹è¯æ¡†ã€‚</p></li></ul><p>ç‰¹åˆ«æ³¨æ„ï¼š</p><p>JSä»£ç è°ƒç”¨ä¸€å®šè¦åœ¨ onPageFinishedï¼ˆï¼‰ å›è°ƒä¹‹åæ‰èƒ½è°ƒç”¨ï¼Œå¦åˆ™ä¸ä¼šè°ƒç”¨ã€‚</p><p>2ã€é€šè¿‡WebViewçš„evaluateJavascript()ï¼š</p><ul><li>è¯¥æ–¹æ³•æ¯”ç¬¬ä¸€ç§æ–¹æ³•æ•ˆç‡æ›´é«˜ã€ä½¿ç”¨æ›´ç®€æ´ï¼Œå› ä¸ºè¯¥æ–¹æ³•çš„æ‰§è¡Œä¸ä¼šä½¿é¡µé¢åˆ·æ–°ï¼Œè€Œç¬¬ä¸€ç§æ–¹æ³•ï¼ˆloadUrl ï¼‰çš„æ‰§è¡Œåˆ™ä¼šã€‚</li><li>Android 4.4 åæ‰å¯ä½¿ç”¨ã€‚</li></ul><p>åªéœ€è¦å°†ç¬¬ä¸€ç§æ–¹æ³•çš„loadUrl()æ¢æˆevaluateJavascript()å³å¯ï¼Œé€šè¿‡onReceiveValue()å›è°ƒæ¥æ”¶è¿”å›å€¼ã€‚</p><p>å»ºè®®ï¼šä¸¤ç§æ–¹æ³•æ··åˆä½¿ç”¨ï¼Œå³Android 4.4ä»¥ä¸‹ä½¿ç”¨æ–¹æ³•1ï¼ŒAndroid 4.4ä»¥ä¸Šæ–¹æ³•2ã€‚</p><h5 id="JSé€šè¿‡WebViewè°ƒç”¨-Android-ä»£ç ï¼š"><a href="#JSé€šè¿‡WebViewè°ƒç”¨-Android-ä»£ç ï¼š" class="headerlink" title="JSé€šè¿‡WebViewè°ƒç”¨ Android ä»£ç ï¼š"></a>JSé€šè¿‡WebViewè°ƒç”¨ Android ä»£ç ï¼š</h5><p>1ã€é€šè¿‡ WebViewçš„addJavascriptInterfaceï¼ˆï¼‰è¿›è¡Œå¯¹è±¡æ˜ å°„ï¼š</p><p>-å®šä¹‰ä¸€ä¸ªä¸JSå¯¹è±¡æ˜ å°„å…³ç³»çš„Androidç±»ï¼šAndroidtoJsï¼š</p><ul><li>å®šä¹‰JSéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œè¢«JSè°ƒç”¨çš„æ–¹æ³•å¿…é¡»åŠ å…¥@JavascriptInterfaceæ³¨è§£ã€‚</li><li>é€šè¿‡addJavascriptInterface()å°†Javaå¯¹è±¡æ˜ å°„åˆ°JSå¯¹è±¡ã€‚</li></ul><p>ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ï¼Œä»…å°†Androidå¯¹è±¡å’ŒJSå¯¹è±¡æ˜ å°„å³å¯ã€‚</p><p>ç¼ºç‚¹ï¼šaddJavascriptInterface æ¥å£å¼•èµ·è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ¼æ´äº§ç”ŸåŸå› æ˜¯ï¼š</p><p>å½“JSæ‹¿åˆ°Androidè¿™ä¸ªå¯¹è±¡åï¼Œå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªAndroidå¯¹è±¡ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ç³»ç»Ÿç±»ï¼ˆjava.lang.Runtime ç±»ï¼‰ï¼Œä»è€Œè¿›è¡Œä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>2ã€é€šè¿‡ WebViewClient çš„æ–¹æ³•shouldOverrideUrlLoading ()å›è°ƒæ‹¦æˆª urlï¼š</p><ul><li><p>Androidé€šè¿‡ WebViewClient çš„å›è°ƒæ–¹æ³•shouldOverrideUrlLoading ()æ‹¦æˆª urlã€‚</p></li><li><p>è§£æè¯¥ url çš„åè®®ã€‚</p></li><li><p>å¦‚æœæ£€æµ‹åˆ°æ˜¯é¢„å…ˆçº¦å®šå¥½çš„åè®®ï¼Œå°±è°ƒç”¨ç›¸åº”æ–¹æ³•ã€‚</p><p>æ ¹æ®åè®®çš„å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯æ‰€éœ€è¦çš„urlã€‚<br>ä¸€èˆ¬æ ¹æ®schemeï¼ˆåè®®æ ¼å¼ï¼‰ &amp; authorityï¼ˆåè®®åï¼‰åˆ¤æ–­ï¼ˆå‰ä¸¤ä¸ªå‚æ•°ï¼‰ã€‚</p></li></ul><p>ä¼˜ç‚¹ï¼šä¸å­˜åœ¨æ–¹å¼1çš„æ¼æ´ï¼›</p><p>ç¼ºç‚¹ï¼šJSè·å–Androidæ–¹æ³•çš„è¿”å›å€¼å¤æ‚,å¦‚æœJSæƒ³è¦å¾—åˆ°Androidæ–¹æ³•çš„è¿”å›å€¼ï¼Œåªèƒ½é€šè¿‡ WebView çš„ loadUrl ï¼ˆï¼‰å»æ‰§è¡Œ JS æ–¹æ³•æŠŠè¿”å›å€¼ä¼ é€’å›å»ã€‚</p><p>3ã€é€šè¿‡ WebChromeClient çš„onJsAlert()ã€onJsConfirm()ã€onJsPromptï¼ˆï¼‰æ–¹æ³•å›è°ƒæ‹¦æˆªJSå¯¹è¯æ¡†alert()ã€confirm()ã€promptï¼ˆï¼‰ æ¶ˆæ¯ï¼š</p><p>åŸç†ï¼š</p><p>Androidé€šè¿‡ WebChromeClient çš„onJsAlert()ã€onJsConfirm()ã€onJsPromptï¼ˆï¼‰æ–¹æ³•å›è°ƒåˆ†åˆ«æ‹¦æˆªJSå¯¹è¯æ¡†<br>ï¼ˆè­¦å‘Šæ¡†ã€ç¡®è®¤æ¡†ã€è¾“å…¥æ¡†ï¼‰ï¼Œå¾—åˆ°ä»–ä»¬çš„æ¶ˆæ¯å†…å®¹ï¼Œç„¶åè§£æå³å¯ã€‚</p><p>å¸¸ç”¨çš„æ‹¦æˆªæ˜¯ï¼šæ‹¦æˆª JSçš„è¾“å…¥æ¡†ï¼ˆå³promptï¼ˆï¼‰æ–¹æ³•ï¼‰ï¼Œå› ä¸ºåªæœ‰promptï¼ˆï¼‰å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„å€¼ï¼Œæ“ä½œæœ€å…¨é¢æ–¹ä¾¿ã€æ›´åŠ çµæ´»ï¼›è€Œalertï¼ˆï¼‰å¯¹è¯æ¡†æ²¡æœ‰è¿”å›å€¼ï¼›confirmï¼ˆï¼‰å¯¹è¯æ¡†åªèƒ½è¿”å›ä¸¤ç§çŠ¶æ€ï¼ˆç¡®å®š / å–æ¶ˆï¼‰ä¸¤ä¸ªå€¼ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/944365-613b57c93dff2eb8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p><p><a href="https://blog.csdn.net/carson_ho/article/details/64904691">Androidï¼šä½ è¦çš„WebViewä¸ JS äº¤äº’æ–¹å¼ éƒ½åœ¨è¿™é‡Œäº†</a></p><h4 id="3ã€react-nativeæœ‰å¤šå°‘äº†è§£ï¼Ÿè®²ä¸€ä¸‹åŸç†ã€‚"><a href="#3ã€react-nativeæœ‰å¤šå°‘äº†è§£ï¼Ÿè®²ä¸€ä¸‹åŸç†ã€‚" class="headerlink" title="3ã€react nativeæœ‰å¤šå°‘äº†è§£ï¼Ÿè®²ä¸€ä¸‹åŸç†ã€‚"></a>3ã€react nativeæœ‰å¤šå°‘äº†è§£ï¼Ÿè®²ä¸€ä¸‹åŸç†ã€‚</h4><h4 id="4ã€weexäº†è§£å—ï¼Ÿå¦‚ä½•è‡ªå·±å®ç°ç±»ä¼¼æŠ€æœ¯ï¼Ÿ"><a href="#4ã€weexäº†è§£å—ï¼Ÿå¦‚ä½•è‡ªå·±å®ç°ç±»ä¼¼æŠ€æœ¯ï¼Ÿ" class="headerlink" title="4ã€weexäº†è§£å—ï¼Ÿå¦‚ä½•è‡ªå·±å®ç°ç±»ä¼¼æŠ€æœ¯ï¼Ÿ"></a>4ã€weexäº†è§£å—ï¼Ÿå¦‚ä½•è‡ªå·±å®ç°ç±»ä¼¼æŠ€æœ¯ï¼Ÿ</h4><h4 id="5ã€flutteräº†è§£å—ï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿå¦‚ä½•å®ç°å¤šNativeé¡µé¢æ¥å…¥ï¼Ÿå¦‚ä½•å®ç°å¯¹ç°æœ‰å·¥ç¨‹çš„flutterè¿ç§»ï¼Ÿ"><a href="#5ã€flutteräº†è§£å—ï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿå¦‚ä½•å®ç°å¤šNativeé¡µé¢æ¥å…¥ï¼Ÿå¦‚ä½•å®ç°å¯¹ç°æœ‰å·¥ç¨‹çš„flutterè¿ç§»ï¼Ÿ" class="headerlink" title="5ã€flutteräº†è§£å—ï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿå¦‚ä½•å®ç°å¤šNativeé¡µé¢æ¥å…¥ï¼Ÿå¦‚ä½•å®ç°å¯¹ç°æœ‰å·¥ç¨‹çš„flutterè¿ç§»ï¼Ÿ"></a>5ã€flutteräº†è§£å—ï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿå¦‚ä½•å®ç°å¤šNativeé¡µé¢æ¥å…¥ï¼Ÿå¦‚ä½•å®ç°å¯¹ç°æœ‰å·¥ç¨‹çš„flutterè¿ç§»ï¼Ÿ</h4><h4 id="6ã€Dartè¯­è¨€æœ‰ç ”ç©¶è¿‡å—ï¼Ÿ"><a href="#6ã€Dartè¯­è¨€æœ‰ç ”ç©¶è¿‡å—ï¼Ÿ" class="headerlink" title="6ã€Dartè¯­è¨€æœ‰ç ”ç©¶è¿‡å—ï¼Ÿ"></a>6ã€Dartè¯­è¨€æœ‰ç ”ç©¶è¿‡å—ï¼Ÿ</h4><h4 id="7ã€å¿«åº”ç”¨äº†è§£å—ï¼Ÿè·Ÿå…¶å¥¹æ–¹å¼ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#7ã€å¿«åº”ç”¨äº†è§£å—ï¼Ÿè·Ÿå…¶å¥¹æ–¹å¼ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="7ã€å¿«åº”ç”¨äº†è§£å—ï¼Ÿè·Ÿå…¶å¥¹æ–¹å¼ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"></a>7ã€å¿«åº”ç”¨äº†è§£å—ï¼Ÿè·Ÿå…¶å¥¹æ–¹å¼ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h4><h4 id="8ã€è¯´è¯´ä½ ç”¨è¿‡çš„æ··åˆå¼€å‘æŠ€æœ¯æœ‰å“ªäº›ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#8ã€è¯´è¯´ä½ ç”¨è¿‡çš„æ··åˆå¼€å‘æŠ€æœ¯æœ‰å“ªäº›ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="8ã€è¯´è¯´ä½ ç”¨è¿‡çš„æ··åˆå¼€å‘æŠ€æœ¯æœ‰å“ªäº›ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"></a>8ã€è¯´è¯´ä½ ç”¨è¿‡çš„æ··åˆå¼€å‘æŠ€æœ¯æœ‰å“ªäº›ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h4><h3 id="ä¸‰ã€è„šæœ¬è¯­è¨€-ï¼ˆâ­â­ï¼‰"><a href="#ä¸‰ã€è„šæœ¬è¯­è¨€-ï¼ˆâ­â­ï¼‰" class="headerlink" title="ä¸‰ã€è„šæœ¬è¯­è¨€ ï¼ˆâ­â­ï¼‰"></a>ä¸‰ã€è„šæœ¬è¯­è¨€ ï¼ˆâ­â­ï¼‰</h3><h4 id="1ã€è„šæœ¬è¯­è¨€ä¼šå—"><a href="#1ã€è„šæœ¬è¯­è¨€ä¼šå—" class="headerlink" title="1ã€è„šæœ¬è¯­è¨€ä¼šå—?"></a>1ã€è„šæœ¬è¯­è¨€ä¼šå—?</h4><h4 id="2ã€Pythonä¼šå—ï¼Ÿ"><a href="#2ã€Pythonä¼šå—ï¼Ÿ" class="headerlink" title="2ã€Pythonä¼šå—ï¼Ÿ"></a>2ã€Pythonä¼šå—ï¼Ÿ</h4><p><a href="https://jsonchao.github.io/2018/07/26/%20Python%E5%85%A5%E9%97%A8%E7%AF%87/">PythonåŸºç¡€</a></p><p><a href="https://jsonchao.github.io/2018/03/18/%E5%88%9D%E8%AF%86%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">äººå·¥æ™ºèƒ½äº†è§£</a></p><h4 id="3ã€Gradleäº†è§£å¤šå°‘ï¼Ÿgroovyè¯­æ³•ä¼šå—ï¼Ÿ"><a href="#3ã€Gradleäº†è§£å¤šå°‘ï¼Ÿgroovyè¯­æ³•ä¼šå—ï¼Ÿ" class="headerlink" title="3ã€Gradleäº†è§£å¤šå°‘ï¼Ÿgroovyè¯­æ³•ä¼šå—ï¼Ÿ"></a>3ã€Gradleäº†è§£å¤šå°‘ï¼Ÿgroovyè¯­æ³•ä¼šå—ï¼Ÿ</h4>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kotlin </tag>
            
            <tag> coroutine </tag>
            
            <tag> åç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java ä¸­çº¿ç¨‹çš„çŠ¶æ€åŠè½¬æ¢</title>
      <link href="/2020-12-07/java-thread/"/>
      <url>/2020-12-07/java-thread/</url>
      
        <content type="html"><![CDATA[<p>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­èƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½äº†ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¸­ï¼Œæ˜¯è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒçœŸæ­£çš„ã€æ‰“å·¥äººã€ã€‚æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸”è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹å­˜åœ¨ï¼Œé»˜è®¤çš„çº¿ç¨‹æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå«ä½œã€ä¸»çº¿ç¨‹ã€ã€‚</p><p>åœ¨ Java ä¸­ï¼Œè¿›è¡Œçº¿ç¨‹çš„åˆ‡æ¢æ˜¯ä¸€ä»¶æ¯”è¾ƒæµªè´¹èµ„æ–™çš„äº‹æƒ…ï¼Œè¿™æ„å‘³ç€ä»£ç çš„æ‰§è¡Œéœ€è¦ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç„¶åå†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚ä½†è¿™ä¹Ÿä¸æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½ç”¨çº¿ç¨‹ï¼Œåˆç†çš„ä½¿ç”¨å¯ä»¥æé«˜ç¨‹åºæ‰§è¡Œçš„ååç‡ã€‚</p><p>æ—¢ç„¶ä¸Šé¢æåˆ°äº†ã€çº¿ç¨‹åˆ‡æ¢ã€ï¼Œé‚£æˆ‘ä»¬å°±æ¥èŠèŠï¼Œçº¿ç¨‹çš„å‡ ç§çŠ¶æ€ã€‚</p><span id="more"></span><h2 id="çº¿ç¨‹çš„å…­ç§çŠ¶æ€"><a href="#çº¿ç¨‹çš„å…­ç§çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„å…­ç§çŠ¶æ€"></a>çº¿ç¨‹çš„å…­ç§çŠ¶æ€</h2><p>æ ¹æ®<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.State.html">å®˜æ–¹æ–‡æ¡£</a>æ¥çœ‹ï¼ŒJava ä¸­çº¿ç¨‹æœ‰å…­ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ <code>NEW</code>ã€<code>RUNNABLE</code>ã€<code>BLOCKED</code>ã€<code>WAITING</code>ã€<code>TIMED_WAITING</code> å’Œ <code>TERMINATED</code>ã€‚</p><h3 id="NEW"><a href="#NEW" class="headerlink" title="NEW"></a><strong>NEW</strong></h3><p>åˆšåˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œçº¿ç¨‹å°±å¤„åœ¨è¿™ä¸ªçŠ¶æ€ã€‚è¯¥çŠ¶æ€åªèƒ½å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ <code>RUNNABLE</code> å‘ç”Ÿè½¬æ¢ï¼Œä¸€æ—¦å‘ç”Ÿè½¬æ¢ï¼Œåˆ™æ— æ³•å†å›åˆ° <code>NEW</code> çŠ¶æ€ã€‚</p><p>æ¯”å¦‚ä¸‹æ–¹ä»£ç ï¼š</p><pre><code class="java">Runnable runnable = new Runnable() &#123;    @Override    public void run() &#123; &#125;&#125;;Thread thread = new Thread(runnable);System.out.println(&quot;t1 state: &quot; + thread.getState());</code></pre><p>åˆ™ä¼šçœ‹åˆ°è¾“å‡ºï¼š</p><pre><code>t1 state: NEW</code></pre><h3 id="RUNNABLE"><a href="#RUNNABLE" class="headerlink" title="RUNNABLE"></a><strong>RUNNABLE</strong></h3><p>å½“åº”ç”¨ç¨‹åºè°ƒç”¨äº†çº¿ç¨‹å¯¹è±¡çš„ <code>start()</code> æ–¹æ³•ä¹‹åï¼Œè¯¥çº¿ç¨‹å°±ä¼šè¿›å…¥ <code>RUNNABLE</code> çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šè¢«ç½®äºå¯è¿è¡Œçš„çº¿ç¨‹æ± ä¸­ï¼Œç­‰å¾…è¢«çº¿ç¨‹è°ƒåº¦é€‰ä¸­ï¼Œè·å– CPU çš„ä½¿ç”¨æƒã€‚ä¸€æ—¦çº¿ç¨‹è·å–åˆ° CPU çš„ä½¿ç”¨æƒï¼Œåˆ™å¼€å§‹çœŸæ­£æ‰§è¡Œç¨‹åºä»£ç ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å°†è¿™ä¸ªçŠ¶æ€ç»†åˆ†ä¸º <code>READY</code> å’Œ <code>RUNNING</code> ä¸¤ç§çŠ¶æ€ï¼Œç”¨äºåŒºåˆ†çº¿ç¨‹æ˜¯å¦æŠ¢å åˆ° CPUï¼Œå·²ç»å¼€å§‹è¿è¡Œä»£ç äº†ã€‚</p><pre><code class="java">Runnable runnable = new Runnable() &#123;    @Override    public void run() &#123; &#125;&#125;;Thread thread = new Thread(runnable);thread.start();System.out.println(&quot;t1 state: &quot; + thread.getState());</code></pre><p>åˆ™ä¼šè¾“å‡ºï¼š</p><pre><code>t1 state: RUNNABLE</code></pre><h3 id="BLOCKED"><a href="#BLOCKED" class="headerlink" title="BLOCKED"></a><strong>BLOCKED</strong></h3><p>åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹ä¸€èˆ¬æ˜¯åœ¨ç­‰å¾… monitor çš„é”ã€‚ä¸€èˆ¬æˆ‘ä»¬ç®¡è¿™ç§çŠ¶æ€å«ã€é˜»å¡çŠ¶æ€ã€ã€‚è¿›å…¥é˜»å¡çŠ¶æ€æ˜¯å› ä¸ºæŸç§åŸå› ä¸‹ï¼Œçº¿ç¨‹æ”¾å¼ƒäº† CPU çš„ä½¿ç”¨æƒï¼Œçº¿ç¨‹æš‚åœæ‰§è¡Œä»£ç ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p>ç”¨ä¸‹é¢çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p><pre><code class="java">public class Main &#123;    public static void main(String[] args) throws InterruptedException &#123;        Thread t1 = new Thread(new DemoThreadB());        Thread t2 = new Thread(new DemoThreadB());        t1.start();        t2.start();        Thread.sleep(1000);        System.out.println(&quot;t2 state: &quot; + t2.getState());        System.exit(0);    &#125;    static class DemoThreadB implements Runnable &#123;        @Override        public void run() &#123;            process();        &#125;        public static synchronized void process() &#123;            while(true) &#123;                // æ¨¡æ‹Ÿé‡é‡çº§çš„è¿‡ç¨‹å¤„ç†ï¼Œt1 å¦‚æœæ­£åœ¨è¿è¡Œè¯¥ä»£ç å—ï¼Œåˆ™ t2 å°±ä¼šè¿›å…¥ BLOCKED çŠ¶æ€            &#125;        &#125;    &#125;&#125;</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­åˆ›å»ºäº† t1 å’Œ t2 ä¸¤ä¸ªçº¿ç¨‹ã€‚t1 åœ¨è°ƒç”¨ <code>start()</code> æ–¹æ³•åè¿›å…¥ <code>process()</code> æ–¹æ³•ã€‚å› ä¸ºè¿™é‡Œä½¿ç”¨äº† <code>while(true)</code> æ¥ä¿è¯çº¿ç¨‹ä¸ä¼šè½»æ˜“ç‹—å¸¦ï¼Œæ‰€ä»¥ t2 å°±ç”­æƒ³æŠ¢å åˆ° CPU å¹¶æ‰§è¡Œ <code>process()</code> æ–¹æ³•ã€‚ä½† t2 ä¹Ÿè°ƒç”¨äº† <code>start()</code> æ–¹æ³•è¿›å…¥äº† <code>RUNNABLE</code> çŠ¶æ€ï¼Œåˆç”±äºæ¯” t1 æ™šäº†ä¸€æ­¥ï¼Œæ‰€ä»¥åªèƒ½è¿›å…¥ <code>BLOCKED</code> çŠ¶æ€ï¼Œç­‰å¾… t1 é‡Šæ”¾é”ã€‚</p><p>è¯¥ä¾‹å­ä¼šè¾“å‡ºï¼š</p><pre><code>t2 state: BLOCKED</code></pre><h3 id="WAITING"><a href="#WAITING" class="headerlink" title="WAITING"></a><strong>WAITING</strong></h3><p>åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹å°±æ˜¯åœ¨<strong>æ— é™æœŸ</strong>ç­‰å¾…å…¶ä»–çº¿ç¨‹å®ŒæˆæŸä¸ªæ“ä½œã€‚æ¯”å¦‚è¯´ï¼ŒæŸä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨äº† <code>Object.wait()</code>ï¼Œå°±æ˜¯åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥å¯¹è±¡è°ƒç”¨ <code>Object.notifiy()</code> æˆ–è€… <code>Object.nofityAll()</code>ã€‚æœ‰å¯èƒ½å¼•èµ·çº¿ç¨‹è¿›å…¥ <code>WATING</code> çŠ¶æ€çš„æ–¹æ³•æœ‰ä¸‹é¢å‡ ç§ï¼š<br>    - <code>Object.wait()</code> æ— è¶…æ—¶çš„ç­‰å¾…<br>    - <code>Thread.join()</code> æ— è¶…æ—¶çš„ç­‰å¾…<br>    - <code>LockSupport.park()</code></p><p>æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä¾‹å­æ¥æ¨¡æ‹Ÿè¿™ä¸ªçŠ¶æ€ï¼š</p><pre><code class="java">public class Main &#123;    static Thread t1;    public static void main(String[] args) throws InterruptedException &#123;        Thread t2 = new Thread(new DemoThreadB());        t1 = new Thread(new DemoThreadA(t2));        t1.start();    &#125;    static class DemoThreadA implements Runnable &#123;        Thread t2;        DemoThreadA(Thread thread) &#123;            this.t2 = thread;        &#125;        @Override        public void run() &#123;            this.t2.start();            try &#123;                this.t2.join();                System.out.println(&quot;t1 state: &quot; + t1.getState());            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;        &#125;    &#125;    static class DemoThreadB implements Runnable &#123;        @Override        public void run() &#123;            try &#123;                Thread.sleep(1000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;            System.out.println(&quot;t1 state: &quot; + t1.getState());        &#125;    &#125;&#125;</code></pre><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ t1 å’Œ t2ï¼Œå¹¶ä¸”åœ¨ t1 çš„ <code>run()</code> æ–¹æ³•ä¸­å¯åŠ¨äº† t2ï¼Œå¹¶ä¸”è°ƒç”¨äº† t2 çš„ <code>join()</code> æ–¹æ³•ã€‚æ­¤æ—¶ï¼Œt1 å°±è¿›å…¥äº† <code>WAITING</code> çŠ¶æ€ï¼Œå½“ t2 çš„ <code>run()</code> æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œt1 å°±ä¼šä» <code>WAIT</code> çŠ¶æ€å›åˆ° <code>RUNNABLE</code> çŠ¶æ€ã€‚</p><p>æ‰€ä»¥ä¸Šè¿°ä»£ç çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code>t1 state: WAITINGt1 state: RUNNABLE</code></pre><h3 id="TIMED-WAITING"><a href="#TIMED-WAITING" class="headerlink" title="TIMED_WAITING"></a><strong>TIMED_WAITING</strong></h3><p>é¡¾åæ€ä¹‰ï¼Œè¿™ç§çŠ¶æ€ä¹Ÿæ˜¯ <code>WAITNG</code> çŠ¶æ€ï¼Œåªä¸è¿‡è¿™ç§çŠ¶æ€æ˜¯<strong>æœ‰ç­‰å¾…æ—¶é™</strong>çš„ã€‚æœ‰å¯èƒ½å¼•èµ·çº¿ç¨‹è¿›å…¥ <code>TIMED_WAITING</code> çŠ¶æ€çš„æ–¹æ³•æœ‰ä¸‹é¢å‡ ç§ï¼š<br>    - <code>Thread.sleep(long millis)</code> ä¸å¿…ä»‹ç»<br>    - <code>Object.wait(long timeout)</code> å¸¦æœ‰æ—¶é™çš„ <code>Object.wait()</code><br>    - <code>Thread.join(long millis)</code> å¸¦æœ‰æ—¶é™çš„ <code>Thread.join()</code><br>    - <code>LockSupport.parkNanos(Object blocker, long nanos)</code><br>    - <code>LockSupport.parkUntil(Object blocker, long deadline)</code></p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºè¿™ä¸ªçŠ¶æ€ï¼š</p><pre><code class="java">public class Main &#123;    public static void main(String[] args) throws InterruptedException &#123;        Thread t1 = new Thread(new DemoThreadC());        t1.start();        Thread.sleep(1000);        System.out.println(&quot;t1 state: &quot; + t1.getState());    &#125;    static class DemoThreadC implements Runnable &#123;        @Override        public void run() &#123;            try &#123;                Thread.sleep(3000);                // Thread.join(3000);                // LockSupport.parkNanos(this, 3000000000);                // LockSupport.parkUntil(this, 3000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;        &#125;    &#125;&#125;</code></pre><p>ä¸»çº¿ç¨‹ sleep 1 ç§’å°±ç»“æŸäº†ï¼Œè€Œå­çº¿ç¨‹ t1 åˆ™ç”±äºã€ä¸šåŠ¡é‡å·¨å¤§ã€å¯¼è‡´ sleep 3 ç§’åæ‰èƒ½é€€å‡ºï¼Œåœ¨ 1 ç§’ä¹‹åè§‚å¯Ÿ t1 çš„çŠ¶æ€ï¼Œåˆ™è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>t1 state: TIMED_WAITING</code></pre><h3 id="TERMINATED"><a href="#TERMINATED" class="headerlink" title="TERMINATED"></a><strong>TERMINATED</strong></h3><p>çº¿ç¨‹çš„ <code>run()</code> æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…å› ä¸ºå¼‚å¸¸å¯¼è‡´é€€å‡ºäº† <code>run()</code> æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ï¼Œè¿›å…¥ <code>TERMINATED</code> çŠ¶æ€ã€‚è¿›å…¥ <code>TERMINATED</code> çŠ¶æ€çš„çº¿ç¨‹ä¸å¯å†æ¬¡é‡ç”Ÿã€‚</p><p>è¿™ä¸ªä¾‹å­å°±ç®€å•å¤šäº†ï¼š</p><pre><code class="java">Runnable runnable = new Runnable() &#123;    @Override    public void run() &#123; &#125;&#125;;Thread t1 = new Thread(runnable);t1.start();Thread.sleep(1000);System.out.println(&quot;t1 state: &quot; + t1.getState());</code></pre><p>çº¿ç¨‹ç¬é—´è¿è¡Œå®Œæ¯•ï¼ˆå› ä¸º run() æ–¹æ³•ä¸ºç©ºï¼‰ï¼Œ1ç§’åè§‚å¯Ÿ t1 çš„çŠ¶æ€ï¼Œå°±ä¼šæœ‰å¦‚ä¸‹è¾“å‡ºï¼š</p><pre><code>t1 state: TERMINATED</code></pre><p>ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥å±•ç¤ºè¿™å…­ç§çŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="https://s3.ax1x.com/2020/12/07/DxHtAO.png" alt="çº¿ç¨‹çš„å…­ç§çŠ¶æ€è½¬æ¢"></p><p>æŒ‰æ—¶é—´é¡ºåºæ¥è§£é‡Šä¸€ä¸‹ï¼š</p><ul><li><code>NEW</code> çŠ¶æ€ä¸‹çš„çº¿ç¨‹ï¼Œåœ¨è°ƒç”¨ <code>start()</code> æ–¹æ³•ä¹‹åï¼Œè¿›å…¥ <code>RUNNABLE</code> çŠ¶æ€ã€‚æ­¤æ—¶å¯ä»¥ç»†åˆ†ä¸º <code>READY</code> å’Œ <code>RUNNING</code> ä¸¤ç§çŠ¶æ€ï¼Œ<code>READY</code> çŠ¶æ€ä¸‹è¿˜æœªæŠ¢å åˆ° CPUï¼Œä»£ç æ— æ³•æ‰§è¡Œï¼›æŠ¢å åˆ° CPUï¼Œåˆ™è¿›å…¥ <code>RUNNING</code> çŠ¶æ€ï¼Œå¼€å§‹æ‰§è¡Œä»£ç ï¼›</li><li>å¦‚æœåœ¨ <code>RUNNABLE</code> çŠ¶æ€ä¸‹è°ƒç”¨äº† <code>Object.wait()</code> æˆ–è€… <code>Thread.join()</code> æˆ–è€… <code>LockSupport.park()</code>ï¼Œåˆ™è¿›å…¥ <code>WAIT</code> çŠ¶æ€ï¼›</li><li>å¦‚æœåœ¨ <code>RUNNABLE</code> çŠ¶æ€ä¸‹è°ƒç”¨äº† <code>Thread.sleep(long millis)</code> æˆ–è€… <code>Object.wait(long timeout)</code> æˆ–è€… <code>Thread.join(long millis)</code> æˆ–è€… <code>LockSupport.parkNanos(Object locker, long nanos)</code> æˆ–è€… <code>LockSupport.parkUntil(Object blocker, long deadline)</code>ï¼Œåˆ™è¿›å…¥ <code>TIMED_WAITING</code> çŠ¶æ€ï¼›</li><li>å¦‚æœåœ¨ <code>RUNNABLE</code> çŠ¶æ€ä¸‹è¿˜éœ€è¦ç­‰å¾… monitor é”è¿›å…¥åŒæ­¥ä»£ç å—æˆ–è€…é‡å…¥åŒæ­¥ä»£ç å—ï¼Œåˆ™è¿›å…¥ <code>BLOCKED</code> çŠ¶æ€ï¼›</li><li>åœ¨ <code>WAITING</code> æˆ–è€… <code>TIMED_WAITING</code> çŠ¶æ€ä¸‹ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨äº† <code>Object.notify()</code> æˆ–è€… <code>Object.nofityAll()</code> æ–¹æ³•ï¼Œåˆ™è¿›å…¥ <code>RUNNABLE</code> çŠ¶æ€ï¼Œ</li><li>åœ¨ <code>BLOCKED</code> çŠ¶æ€ä¸‹ï¼Œä¸€æ—¦è·å– monitor é”ï¼Œåˆ™å›åˆ° <code>RUNNABLE</code> çŠ¶æ€ï¼›</li><li>åœ¨ <code>WAITING</code> æˆ–è€… <code>TIMED_WAITING</code> æˆ–è€… <code>BLOCKED</code> çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹ä»£ç æ‰§è¡Œç»“æŸï¼Œæˆ–å› ä¸ºå¼‚å¸¸æå‰ç»“æŸï¼Œéƒ½ä¼šè¿›å…¥ <code>TERMINATED</code> çŠ¶æ€ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Thread </tag>
            
            <tag> Thread-Safe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘è€…å¿…é¡»æŒæ¡çš„è®¾è®¡æ¨¡å¼</title>
      <link href="/2020-09-09/design-pattern-must/"/>
      <url>/2020-09-09/design-pattern-must/</url>
      
        <content type="html"><![CDATA[<p>æ³¨æ„ï¼šæœ¬ç¬”è®°ä¸ºè®¾è®¡æ¨¡å¼æ ¸å¿ƒå­¦ä¹ ç¬”è®°ï¼Œä¸ºç¬”è€…å¿«é€Ÿå¤ä¹ å’Œå›é¡¾è®¾è®¡æ¨¡å¼æ—¶ä½¿ç”¨ï¼Œæ›´è¯¦ç»†çš„æ•™ç¨‹è¯·æŸ¥çœ‹æ›´ä¸“ä¸šçš„è®¾è®¡æ¨¡å¼æ•™ç¨‹ã€‚</p><span id="more"></span><h2 id="ä¸€ã€è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™"><a href="#ä¸€ã€è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™" class="headerlink" title="ä¸€ã€è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™"></a>ä¸€ã€è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™</h2><p>è®¾è®¡æ¨¡å¼æœ‰å…­å¤§åŸåˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>å•ä¸€èŒè´£åŸåˆ™</li><li>å¼€æ”¾å°é—­åŸåˆ™</li><li>é‡Œæ°æ›¿æ¢åŸåˆ™</li><li>ä¾èµ–å€’ç½®</li><li>è¿ªç±³ç‰¹åŸåˆ™</li><li>æ¥å£éš”ç¦»åŸåˆ™</li></ul><h3 id="å•ä¸€èŒè´£åŸåˆ™"><a href="#å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™"></a>å•ä¸€èŒè´£åŸåˆ™</h3><p>ä¸€ä¸ªç±»åº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ï¼Œå³ä¸è¦è®©ä¸€ä¸ªç±»æ‰¿æ‹…è¿‡å¤šçš„èŒè´£ï¼Œä»¥æ­¤é™ä½è€¦åˆæ€§ã€‚</p><h3 id="å¼€æ”¾å°é—­åŸåˆ™"><a href="#å¼€æ”¾å°é—­åŸåˆ™" class="headerlink" title="å¼€æ”¾å°é—­åŸåˆ™"></a>å¼€æ”¾å°é—­åŸåˆ™</h3><p>ç±»ã€å‡½æ•°ã€æ¨¡å—åº”è¯¥æ˜¯å¯ä»¥æ‰©å±•çš„ï¼Œä½†æ˜¯ä¸å¯ä»¥ä¿®æ”¹ï¼Œå³å¯¹æ‰©å±•å¼€æ”¾ï¼Œä¿®æ”¹å°é—­ã€‚</p><h3 id="é‡Œæ°æ›¿æ¢åŸåˆ™"><a href="#é‡Œæ°æ›¿æ¢åŸåˆ™" class="headerlink" title="é‡Œæ°æ›¿æ¢åŸåˆ™"></a>é‡Œæ°æ›¿æ¢åŸåˆ™</h3><p>æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹éƒ½èƒ½é€æ˜åœ°æ›¿æ¢ä¸ºå­ç±»å¯¹è±¡ï¼Œå³å¯ä»¥åœ¨å®šä¹‰æ—¶å°½é‡ä½¿ç”¨åŸºç±»å¯¹è±¡ï¼Œç­‰åˆ°è¿è¡Œæ—¶å†ç¡®å®šå…¶å­ç±»ç±»å‹ï¼Œç”¨å­ç±»å¯¹è±¡æ¥æ›¿æ¢çˆ¶ç±»å¯¹è±¡ã€‚</p><h3 id="ä¾èµ–å€’ç½®åŸåˆ™"><a href="#ä¾èµ–å€’ç½®åŸåˆ™" class="headerlink" title="ä¾èµ–å€’ç½®åŸåˆ™"></a>ä¾èµ–å€’ç½®åŸåˆ™</h3><p>é«˜å±‚ã€åº•å±‚æ¨¡å—ã€æ¨¡å—é—´å’Œç»†èŠ‚éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ï¼Œå³é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»äº§ç”Ÿä¾èµ–å…³ç³»ã€‚</p><h3 id="è¿ªç±³ç‰¹åŸåˆ™"><a href="#è¿ªç±³ç‰¹åŸåˆ™" class="headerlink" title="è¿ªç±³ç‰¹åŸåˆ™"></a>è¿ªç±³ç‰¹åŸåˆ™</h3><p>ä¸€ä¸ªè½¯ä»¶å®ä½“åº”è¯¥å°½å¯èƒ½å°‘åœ°ä¸å…¶å®ƒå®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œå³æœ€å°‘çŸ¥è¯†åŸåˆ™ã€‚</p><p>å¦‚æœä¸€ä¸ªå¯¹è±¡éœ€è¦è°ƒç”¨å…¶å®ƒå¯¹è±¡çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰è€…æ¥è°ƒç”¨ï¼Œè¿™ä¸ªç¬¬ä¸‰è€…çš„ä½œç”¨å°±å¦‚Androidä¸­çš„äº‹ä»¶æ€»çº¿EventBusä¸€æ ·ã€‚</p><h3 id="æ¥å£éš”ç¦»åŸåˆ™"><a href="#æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™"></a>æ¥å£éš”ç¦»åŸåˆ™</h3><p>ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</p><h2 id="äºŒã€è®¾è®¡æ¨¡å¼åˆ†ç±»"><a href="#äºŒã€è®¾è®¡æ¨¡å¼åˆ†ç±»" class="headerlink" title="äºŒã€è®¾è®¡æ¨¡å¼åˆ†ç±»"></a>äºŒã€è®¾è®¡æ¨¡å¼åˆ†ç±»</h2><p>GoFæå‡ºçš„è®¾è®¡æ¨¡å¼æœ‰23ç§ï¼ŒæŒ‰ç…§ç›®çš„å‡†åˆ™åˆ†ç±»ï¼Œæœ‰ä¸‰å¤§ç±»ï¼š</p><ul><li>åˆ›å»ºæ€§è®¾è®¡æ¨¡å¼5ç§ï¼šå•ä¾‹ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€å»ºé€ è€…ã€åŸå‹ã€‚</li><li>ç»“æ„å‹è®¾è®¡æ¨¡å¼7ç§ï¼šé€‚é…å™¨ã€è£…é¥°ã€ä»£ç†ã€å¤–è§‚ã€æ¡¥æ¥ã€ç»„åˆã€äº«å…ƒã€‚</li><li>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼11ç§ï¼šç­–ç•¥ã€æ¨¡æ¿æ–¹æ³•ã€è§‚å¯Ÿè€…ã€è¿­ä»£å™¨ã€è´£ä»»é“¾ã€å‘½ä»¤ã€å¤‡å¿˜å½•ã€çŠ¶æ€ã€è®¿é—®è€…ã€ä¸­ä»‹è€…ã€è§£é‡Šå™¨ã€‚</li></ul><h2 id="ä¸‰ã€Androidå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼"><a href="#ä¸‰ã€Androidå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¸‰ã€Androidå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼"></a>ä¸‰ã€Androidå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼</h2><h3 id="1ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"><a href="#1ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="1ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"></a>1ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼</h3><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h4><p>ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚</p><p>å•ä¾‹æ¨¡å¼å…±æœ‰5ç§å†™æ³•ï¼š</p><h5 id="1ã€é¥¿æ±‰æ¨¡å¼"><a href="#1ã€é¥¿æ±‰æ¨¡å¼" class="headerlink" title="1ã€é¥¿æ±‰æ¨¡å¼"></a>1ã€é¥¿æ±‰æ¨¡å¼</h5><pre><code class="java">public class Singleton &#123;    private static Singleton instance = new Singleton;    private Singleton () &#123;            &#125;    public static Singleton getInstance() &#123;        return instance;    &#125;&#125;</code></pre><ul><li>åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ï¼Œå¦‚æœä»å§‹è‡³ç»ˆæœªä½¿ç”¨è¿™ä¸ªå®ä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚</li></ul><h5 id="2ã€æ‡’æ±‰æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#2ã€æ‡’æ±‰æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="2ã€æ‡’æ±‰æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>2ã€æ‡’æ±‰æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h5><pre><code class="java">public class Singletion &#123;    private static Singleton instance;    private Singleton () &#123;    &#125;    public static synchronized Singleton getInstance() &#123;        if (instance == null) &#123;            instance = new Singleton();        &#125;        return instance;    &#125;&#125;</code></pre><ul><li>ä¸ºäº†å¤„ç†å¹¶å‘ï¼Œæ¯æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶éƒ½éœ€è¦è¿›è¡ŒåŒæ­¥ï¼Œä¼šæœ‰ä¸å¿…è¦çš„åŒæ­¥å¼€é”€ã€‚</li></ul><h5 id="3ã€åŒé‡æ£€æŸ¥æ¨¡å¼ï¼ˆDCLï¼‰"><a href="#3ã€åŒé‡æ£€æŸ¥æ¨¡å¼ï¼ˆDCLï¼‰" class="headerlink" title="3ã€åŒé‡æ£€æŸ¥æ¨¡å¼ï¼ˆDCLï¼‰"></a>3ã€åŒé‡æ£€æŸ¥æ¨¡å¼ï¼ˆDCLï¼‰</h5><pre><code class="java">public class Singleton &#123;    private static volatile Singleton instance;    private Singleton &#123;    &#125;    public static Singleton getInstance() &#123;        if (instance == null) &#123;            synchronized (Singleton.class) &#123;                if (instance == null) &#123;                    instance = new Singleton();                &#125;            &#125;        &#125;        return instance;    &#125;&#125;</code></pre><ul><li>ç¬¬ä¸€æ¬¡åˆ¤ç©ºï¼Œçœå»äº†ä¸å¿…è¦çš„åŒæ­¥ã€‚ç¬¬äºŒæ¬¡æ˜¯åœ¨Singletonç­‰äºç©ºæ—¶æ‰åˆ›å»ºå®ä¾‹ã€‚</li><li>ä½¿ç”¨volatileä¿è¯äº†å®ä¾‹çš„å¯è§æ€§ã€‚</li><li>DCLåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†èµ„æºçš„æ¶ˆè€—å’Œå¤šä½™çš„åŒæ­¥ã€çº¿ç¨‹å®‰å…¨ç­‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆã€‚</li></ul><p>å‡è®¾çº¿ç¨‹Aæ‰§è¡Œåˆ°instance = new Singleton()è¯­å¥ï¼Œçœ‹èµ·æ¥åªæœ‰ä¸€è¡Œä»£ç ï¼Œä½†å®é™…ä¸Šå®ƒå¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œè¿™å¥ä»£ç æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆå¤šæ¡æ±‡ç¼–æŒ‡ä»¤ï¼Œå®ƒå¤§è‡´åšäº†3ä»¶äº‹ï¼š</p><p>1ï¼‰ç»™instanceçš„å®ä¾‹åˆ†é…å†…å­˜ã€‚</p><p>2ï¼‰è°ƒç”¨Singleton()æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æˆå‘˜å­—æ®µã€‚</p><p>3ï¼‰å°†instanceå¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ­¤æ—¶instanceå°±ä¸æ˜¯nulläº†ï¼‰ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºJavaç¼–è¯‘å™¨å…è®¸å¤„ç†å™¨ä¹±åºæ‰§è¡Œï¼Œä»¥åŠJDK1.5ä¹‹å‰JMMä¸­çš„Cacheã€å¯„å­˜å™¨åˆ°ä¸»å†…å­˜å›å†™é¡ºåºçš„è§„å®šï¼Œä¸Šé¢çš„2å’Œ3çš„é¡ºåºæ˜¯æ— æ³•ä¿è¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯1-2-3ä¹Ÿå¯èƒ½æ˜¯1-3-2ã€‚å¦‚æœæ˜¯åè€…ï¼Œå¹¶ä¸”åœ¨3æ‰§è¡Œå®Œæ¯•ã€2æœªæ‰§è¡Œä¹‹å‰ï¼Œè¢«åˆ‡æ¢åˆ°çº¿ç¨‹Bä¸Šï¼Œè¿™æ—¶å€™instanceå› ä¸ºå·²ç»åœ¨çº¿ç¨‹Aå†…æ‰§è¡Œè¿‡äº†3ï¼Œinstanceå·²ç»æ˜¯éç©ºäº†ï¼Œæ‰€ä»¥ï¼Œçº¿ç¨‹Bç›´æ¥å–èµ°instanceï¼Œå†ä½¿ç”¨æ—¶å°±ä¼šå‡ºé”™ï¼Œè¿™å°±æ˜¯DCLå¤±æ•ˆé—®é¢˜ï¼Œè€Œä¸”è¿™ç§éš¾ä»¥è·Ÿè¸ªéš¾ä»¥é‡ç°çš„é”™è¯¯å¯èƒ½ä¼šéšè—å¾ˆä¹…ã€‚</p><p>åœ¨JDK1.5ä¹‹åï¼ŒSUNå®˜æ–¹å·²ç»æ³¨æ„åˆ°è¿™ç§é—®é¢˜ï¼Œè°ƒæ•´äº†JVMï¼Œå…·ä½“åŒ–äº†volatileå…³é”®å­—ï¼Œå› æ­¤ï¼Œå¦‚æœJDK1.5æˆ–ä¹‹åçš„ç‰ˆæœ¬ï¼Œåªéœ€è¦å°†instanceçš„å®šä¹‰æ”¹æˆprivate volatile static Singleton instance = nullå°±å¯ä»¥ä¿è¯instanceå¯¹è±¡æ¯æ¬¡éƒ½æ˜¯ä»ä¸»å†…å­˜ä¸­è¯»å–ï¼Œå°±å¯ä»¥ä½¿ç”¨DCLçš„å†™æ³•æ¥å®Œæˆå•ä¾‹æ¨¡å¼ã€‚å½“ç„¶ï¼Œvolatileæˆ–å¤šæˆ–å°‘ä¹Ÿä¼šå½±å“åˆ°æ€§èƒ½ï¼Œä½†è€ƒè™‘åˆ°ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œè¿™ç‚¹ç‰ºç‰²ä¹Ÿæ˜¯å€¼å¾—çš„ã€‚</p><p>DCLä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡ŒgetInstanceæ—¶å•ä¾‹å¯¹è±¡æ‰ä¼šè¢«å®ä¾‹åŒ–ï¼Œæ•ˆç‡é«˜ã€‚</p><p>ç¼ºç‚¹ï¼šç¬¬ä¸€æ¬¡åŠ è½½ç¨æ…¢ï¼Œä¹Ÿç”±äºJMMçš„åŸå› å¯¼è‡´å¶å°”ä¼šå¤±è´¥ã€‚åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä¹Ÿæœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œè™½ç„¶å‘ç”Ÿæ¦‚ç‡å¾ˆå°ã€‚DCLæ¨¡å¼æ˜¯ä½¿ç”¨æœ€å¤šçš„å•ä¾‹å®ç°æ–¹å¼ï¼Œå®ƒèƒ½å¤Ÿåœ¨éœ€è¦æ—¶æ‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä¸”èƒ½åœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ä¿è¯å¯¹è±¡çš„å”¯ä¸€æ€§ï¼Œé™¤éä½ çš„ä»£ç åœ¨å¹¶å‘åœºæ™¯æ¯”è¾ƒå¤æ‚æˆ–ä½äºJDK1.6ç‰ˆæœ¬ä¸‹ä½¿ç”¨ï¼Œå¦åˆ™ï¼Œè¿™ç§æ–¹å¼ä¸€èˆ¬èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ã€‚</p><h5 id="4ã€é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"><a href="#4ã€é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼" class="headerlink" title="4ã€é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"></a>4ã€é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</h5><pre><code class="java">public class Singleton() &#123;    private Singleton() &#123;    &#125;    public static Singleton getInstance() &#123;        return SingletonHolder.sInstance;    &#125;    private static class SingletonHolder &#123;        private static final Singleton sInstance = new Singleton();    &#125;&#125;</code></pre><ul><li>ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶è™šæ‹Ÿæœºæ‰åŠ è½½SingletonHolderå¹¶åˆå§‹åŒ–sInstanceï¼Œè¿™æ ·ä¿è¯äº†çº¿ç¨‹å®‰å…¨å’Œå®ä¾‹çš„å”¯ä¸€æ€§ã€‚</li></ul><h5 id="5ã€æšä¸¾å•ä¾‹"><a href="#5ã€æšä¸¾å•ä¾‹" class="headerlink" title="5ã€æšä¸¾å•ä¾‹"></a>5ã€æšä¸¾å•ä¾‹</h5><pre><code class="java">public enum Singleton &#123;    INSTANCE;    public void doSomeThing() &#123;    &#125;&#125;</code></pre><ul><li>é»˜è®¤æšä¸¾å®ä¾‹çš„åˆ›å»ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯å•ä¾‹ã€‚</li><li>ç®€å•ã€å¯è¯»æ€§ä¸é«˜ã€‚</li></ul><p>æ³¨æ„ï¼šä¸Šé¢çš„å‡ ç§å•ä¾‹æ¨¡å¼åˆ›å»ºçš„å•ä¾‹å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ä¼šé‡æ–°åˆ›å»ºå®ä¾‹ï¼Œå¯ä»¥é‡å†™readResloveæ–¹æ³•è¿”å›å½“å‰çš„å•ä¾‹å¯¹è±¡ã€‚</p><h4 id="ç®€å•å·¥å‚æ¨¡å¼ï¼ˆè¡¥å……ï¼‰"><a href="#ç®€å•å·¥å‚æ¨¡å¼ï¼ˆè¡¥å……ï¼‰" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼ï¼ˆè¡¥å……ï¼‰"></a>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆè¡¥å……ï¼‰</h4><p>ä¹Ÿç§°ä¸ºé™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼ä¸­æœ‰å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>å·¥å‚ç±»ï¼šæ ¸å¿ƒï¼Œè´Ÿè´£åˆ›å»ºæ‰€æœ‰å®ä¾‹çš„å†…éƒ¨é€»è¾‘ï¼Œç”±å¤–ç•Œç›´æ¥è°ƒç”¨ã€‚</li><li>æŠ½è±¡äº§å“ç±»ï¼šè¦åˆ›å»ºæ‰€æœ‰å¯¹è±¡çš„æŠ½è±¡çˆ¶ç±»ï¼Œè´Ÿè´£æè¿°æ‰€æœ‰å®ä¾‹æ‰€å…±æœ‰çš„å…¬å…±æ¥å£ã€‚</li><li>å…·ä½“äº§å“ç±»ï¼šè¦åˆ›å»ºçš„äº§å“ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€æŠ½è±¡äº§å“ç±»</p><pre><code class="java">public abstract class Computer &#123;    public abstarct void start();&#125;</code></pre><p>2ã€å…·ä½“äº§å“ç±»</p><pre><code class="java">public class LenovaComputer extends Computer &#123;    @Override    public void start() &#123;        ...    &#125;&#125;public class HpComputer extends Computer &#123;    @Override    public void start() &#123;        ...    &#125;&#125;public class AsusComputer extends Computer &#123;    @Override    public void start() &#123;        ...    &#125;&#125;</code></pre><p>3ã€å·¥å‚ç±»</p><pre><code class="java">public class ComputerFactory &#123;    public static Computer createComputer(String type) &#123;        Computer mComputer = null;        switch (type) &#123;            case &quot;lenovo&quot;:                mComputer = new LenovoComputer();                break;            case &quot;hp&quot;:                mComputer = new HpComputer();                break;            case &quot;asus&quot;:                mComputer = new AsusComputer();                break;        &#125;        return mComputer;    &#125;&#125;</code></pre><ul><li>å®ƒéœ€è¦çŸ¥é“æ‰€æœ‰å·¥å‚ç±»å‹ï¼Œå› æ­¤åªé€‚åˆå·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘çš„æƒ…å†µã€‚</li><li>é¿å…ç›´æ¥å®ä¾‹åŒ–ç±»ï¼Œé™ä½è€¦åˆæ€§ã€‚</li><li>å¢åŠ æ–°äº§å“éœ€è¦ä¿®æ”¹å·¥å‚ï¼Œè¿èƒŒå¼€æ”¾å°é—­åŸåˆ™ã€‚</li></ul><h4 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h4><p>å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½¿ç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å­ç±»ã€‚</p><p>å·¥å‚æ–¹æ³•æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡äº§å“ç±»ã€‚</li><li>å…·ä½“äº§å“ç±»ã€‚</li><li>æŠ½è±¡å·¥å‚ç±»ï¼šè¿”å›ä¸€ä¸ªæ³›å‹çš„äº§å“å¯¹è±¡ã€‚</li><li>å…·ä½“å·¥å‚ç±»ï¼šè¿”å›å…·ä½“çš„äº§å“å¯¹è±¡ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-1"><a href="#ç®€å•ç¤ºä¾‹-1" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>æŠ½è±¡äº§å“ç±»å’Œå…·ä½“äº§å“ç±»åŒç®€å•å·¥å‚ä¸€æ ·ã€‚</p><p>3ã€æŠ½è±¡å·¥å‚ç±»</p><pre><code class="java">public abstract class ComputerFactory &#123;    public abstract &lt;T extends Computer&gt; T createComputer(Class&lt;T&gt; clz);&#125;</code></pre><p>4ã€å…·ä½“å·¥å‚ç±»</p><pre><code class="java">public class GDComputerFactory extends ComputerFactory &#123;    @Override    public &lt;T extends Computer&gt; T createComputer(Class&lt;T&gt; clz) &#123;        Computer computer = null;        String classname = clz.getName();        try &#123;            computer = (Computer) Class.forName(classname).newInstance();        &#125; catch (Exception e) &#123;            e.printStackTrace();        &#125;        return (T) computer;    &#125;&#125;</code></pre><ul><li>ç›¸æ¯”ç®€å•å·¥å‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ–°å¢äº§å“ç±»ï¼Œæ— éœ€ä¿®æ”¹å·¥å‚ç±»ï¼Œç›´æ¥åˆ›å»ºäº§å“å³å¯ã€‚</li></ul><h4 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h4><p>å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºå’Œå®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</p><p>å»ºé€ è€…æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>å¯¼æ¼”ç±»ï¼šè´Ÿè´£å®‰æ’å·²æœ‰æ¨¡å—çš„å®‰è£…é¡ºåºï¼Œæœ€åé€šçŸ¥å»ºé€ è€…å¼€å§‹å»ºé€ ã€‚</li><li>å»ºé€ è€…ï¼šæŠ½è±¡Builderç±»ï¼Œç”¨äºè§„èŒƒäº§å“çš„ç»„å»ºã€‚</li><li>å…·ä½“å»ºé€ è€…ï¼šå®ç°æŠ½è±¡Builderç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶è¿”å›å»ºé€ å¥½çš„å¯¹è±¡ã€‚</li><li>äº§å“ç±»ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-2"><a href="#ç®€å•ç¤ºä¾‹-2" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€äº§å“ç±»</p><pre><code class="java">public class Computer &#123;    private String mCpu;    private Stiring mMainboard;    private String mRam;    public void setmCpu(String mCpu) &#123;        this.mCpu = mCpu;    &#125;    public void setmMainboard(String mMainboard) &#123;        this.mMainboard = mMainboard;    &#125;    public void setmRam(String mRam) &#123;        this.mRam = mRam;    &#125;&#125;</code></pre><p>2ã€æŠ½è±¡å»ºé€ è€…</p><pre><code class="java">public abstract class Builder &#123;    public abstract void buildCpu(String cpu);    public abstract void buildMainboard(String mainboard);    public abstract void buildRam(String ram);    public abstract Computer create();&#125;</code></pre><p>3ã€å…·ä½“å»ºé€ è€…</p><pre><code class="java">public class MoonComputerBuilder extends Builder &#123;    private Computer mComputer = new Computer();        @Override    public void buildCpu(String cpu) &#123;        mComputer.setmCpu(cpu);    &#125;        @Override    public void buildMainboard(String mainboard) &#123;        mComputer.setmMainboard(mainboard);    &#125;        @Override    public void buildRam(String ram) &#123;        mComputer.setmRam(ram);    &#125;        @Override    public Computer create() &#123;        return mComputer;    &#125;&#125;</code></pre><p>4ã€å¯¼æ¼”ç±»</p><pre><code class="java">public class Director &#123;    Builder mBuilder = null;    public Director (Builder builder) &#123;        this.mBuilder = builder;    &#125;        public Computer createComputer(String cpu, String mainboard, String ram) &#123;        this.mBuilder.buildCpu(cpu);        this.mBuilder.buildMainboard(mainboard);        this.mBuilder.buildRam(ram);        return mBuilder.create();    &#125;&#125;</code></pre><ul><li>å±è”½äº§å“å†…éƒ¨ç»„æˆç»†èŠ‚ã€‚</li><li>å…·ä½“å»ºé€ è€…ç±»ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå®¹æ˜“æ‰©å±•ã€‚</li><li>ä¼šäº§ç”Ÿå¤šä½™çš„å»ºé€ è€…å¯¹è±¡å’Œå¯¼æ¼”ç±»ã€‚</li></ul><h3 id="2ã€ç»“æ„å‹è®¾è®¡æ¨¡å¼"><a href="#2ã€ç»“æ„å‹è®¾è®¡æ¨¡å¼" class="headerlink" title="2ã€ç»“æ„å‹è®¾è®¡æ¨¡å¼"></a>2ã€ç»“æ„å‹è®¾è®¡æ¨¡å¼</h3><h4 id="1ã€ä»£ç†æ¨¡å¼"><a href="#1ã€ä»£ç†æ¨¡å¼" class="headerlink" title="1ã€ä»£ç†æ¨¡å¼"></a>1ã€ä»£ç†æ¨¡å¼</h4><p>ä¸ºå…¶å®ƒå¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p>ä»£ç†æ¨¡å¼ä¸­æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡ä¸»é¢˜ç±»ï¼šå£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†çš„å…±åŒæ¥å£æ–¹æ³•ã€‚</li><li>çœŸå®ä¸»é¢˜ç±»ã€‚</li><li>ä»£ç†ç±»ï¼šæŒæœ‰å¯¹çœŸå®ä¸»é¢˜ç±»çš„å¼•ç”¨ã€‚</li><li>å®¢æˆ·ç«¯ç±»ã€‚</li></ul><h5 id="é™æ€ä»£ç†ç¤ºä¾‹ä»£ç "><a href="#é™æ€ä»£ç†ç¤ºä¾‹ä»£ç " class="headerlink" title="é™æ€ä»£ç†ç¤ºä¾‹ä»£ç "></a>é™æ€ä»£ç†ç¤ºä¾‹ä»£ç </h5><p>1ã€æŠ½è±¡ä¸»é¢˜ç±»</p><pre><code class="java">public interface IShop &#123;    void buy();&#125;</code></pre><p>2ã€çœŸå®ä¸»é¢˜ç±»</p><pre><code class="java">public class JsonChao implements IShop &#123;    @Override     public void buy() &#123;        ...    &#125;&#125;</code></pre><p>3ã€ä»£ç†ç±»</p><pre><code class="java">public class Purchasing implements IShop &#123;    private IShop mShop;    public Purchasing(IShop shop) &#123;        this.mShop = shop;    &#125;        @Override     public void buy() &#123;        mShop.buy();    &#125;&#125;</code></pre><p>4ã€å®¢æˆ·ç«¯ç±»</p><pre><code class="java">public class Clent &#123;        public static void main(String[] args) &#123;        IShop jsonChao = new JsonChao();        IShop purchasing = new Purchasing(jsonChao);        purchasing.buy();    &#125;&#125;</code></pre><h5 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h5><p>åœ¨ä»£ç è¿è¡Œæ—¶é€šè¿‡åå°„æ¥åŠ¨æ€åœ°ç”Ÿæˆä»£ç†ç±»çš„å¯¹è±¡ï¼Œå¹¶ç¡®å®šåˆ°åº•æ¥ä»£ç†è°ã€‚</p><h5 id="åŠ¨æ€ä»£ç†ç¤ºä¾‹ä»£ç "><a href="#åŠ¨æ€ä»£ç†ç¤ºä¾‹ä»£ç " class="headerlink" title="åŠ¨æ€ä»£ç†ç¤ºä¾‹ä»£ç "></a>åŠ¨æ€ä»£ç†ç¤ºä¾‹ä»£ç </h5><p>æ”¹å†™é™æ€ä»£ç†çš„ä»£ç†ç±»å’Œå®¢æˆ·ç«¯ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>1ã€åŠ¨æ€ä»£ç†ç±»</p><pre><code class="java">public class DynamicPurchasing implements InvocationHandler &#123;    private Object obj;    public DynamicPurchasing(Object obj) &#123;        this.obj = obj;    &#125;        @Overrdie    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;        return method.invoke(obj, args);    &#125;&#125;</code></pre><p>2ã€å®¢æˆ·ç«¯ç±»</p><pre><code class="java">public class Clent &#123;        public static void main(String[] args) &#123;        IShop jsonChao = new JsonChao();        DynamicPurchasing mDynamicPurchasing = new DynamicPurchasing(jsonChao);        ClassLoader cl = jsonChao.getClass.getClassLoader();        IShop purchasing = Proxy.newProxyInstance(cl, new Class[]&#123;IShop.class&#125;, mDynamicPurchasing);        purchasing.buy();    &#125;&#125;</code></pre><ul><li>çœŸå®ä¸»é¢˜ç±»å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”±äºå®ƒå®ç°äº†å…¬ç”¨çš„æ¥å£ï¼Œå› æ­¤ä»£ç†ç±»ä¸éœ€è¦ä¿®æ”¹ã€‚</li></ul><h4 id="è£…é¥°æ¨¡å¼"><a href="#è£…é¥°æ¨¡å¼" class="headerlink" title="è£…é¥°æ¨¡å¼"></a>è£…é¥°æ¨¡å¼</h4><p>åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚</p><p>è£…é¥°æ¨¡å¼æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡ç»„ä»¶ï¼šæ¥å£/æŠ½è±¡ç±»ï¼Œè¢«è£…é¥°çš„æœ€åŸå§‹çš„å¯¹è±¡ã€‚</li><li>å…·ä½“ç»„ä»¶ï¼šè¢«è£…é¥°çš„å…·ä½“å¯¹è±¡ã€‚</li><li>æŠ½è±¡è£…é¥°è€…ï¼šæ‰©å±•æŠ½è±¡ç»„ä»¶çš„åŠŸèƒ½ã€‚</li><li>å…·ä½“è£…é¥°è€…ï¼šè£…é¥°è€…å…·ä½“å®ç°ç±»ã€‚</li></ul><h5 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h5><p>1ã€æŠ½è±¡ç»„ä»¶</p><pre><code class="java">public abstract class Swordsman &#123;    public abstract void attackMagic();&#125;</code></pre><p>2ã€å…·ä½“ç»„ä»¶</p><pre><code class="java">public class YangGuo extends Swordsman &#123;    @Override    public void attackMagic() &#123;        ...    &#125;&#125;</code></pre><p>3ã€æŠ½è±¡è£…é¥°è€…</p><p>æŠ½è±¡è£…é¥°è€…å¿…é¡»æŒæœ‰æŠ½è±¡ç»„ä»¶çš„å¼•ç”¨ï¼Œä»¥ä¾¿æ‰©å±•åŠŸèƒ½ã€‚</p><pre><code class="java">public abstract class Master extends Swordsman &#123;    private Swordsman swordsman;    public Master(Swordsman swordsman) &#123;        this.swordman = swordman;    &#125;        @Override    public void attackMagic() &#123;        swordsman.attackMagic();    &#125;&#125;</code></pre><p>4ã€å…·ä½“è£…é¥°è€…</p><pre><code class="java">public class HongQiGong extends Master &#123;    public HongQiGong(Swordsman swordsman) &#123;        this.swordsman = swordsman;    &#125;        public void teachAttackMagic() &#123;        ...    &#125;        @Override    public void attackMagic() &#123;        super.attackMagic();        teackAttackMagic();    &#125;&#125;</code></pre><p>5ã€ä½¿ç”¨</p><pre><code class="java">YangGuo mYangGuo = new YangGuo();HongQiGong mHongQiGong = new HongQiGong(mYangGuo);mHongQiGong.attackMagic();</code></pre><ul><li>ä½¿ç”¨ç»„åˆï¼ŒåŠ¨æ€åœ°æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œåœ¨è¿è¡Œæ—¶èƒ½å¤Ÿä½¿ç”¨ä¸åŒçš„è£…é¥°å™¨å®ç°ä¸åŒçš„è¡Œä¸ºã€‚</li><li>æ¯”ç»§æ‰¿æ›´æ˜“å‡ºé”™ï¼Œæ—¨åœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚</li></ul><h4 id="å¤–è§‚æ¨¡å¼ï¼ˆé—¨é¢æ¨¡å¼ï¼‰"><a href="#å¤–è§‚æ¨¡å¼ï¼ˆé—¨é¢æ¨¡å¼ï¼‰" class="headerlink" title="å¤–è§‚æ¨¡å¼ï¼ˆé—¨é¢æ¨¡å¼ï¼‰"></a>å¤–è§‚æ¨¡å¼ï¼ˆé—¨é¢æ¨¡å¼ï¼‰</h4><p>ä¸€ä¸ªå­ç³»ç»Ÿçš„å†…éƒ¨å’Œå¤–éƒ¨é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡è¿›è¡Œã€‚å³æä¾›ä¸€ä¸ªé«˜å±‚çš„æ¥å£ï¼Œæ–¹ä¾¿å­ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ã€‚</p><p>å¤–è§‚æ¨¡å¼æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>å¤–è§‚ç±»ï¼šå°†å®¢æˆ·ç«¯çš„è¯·æ±‚ä»£ç†ç»™é€‚å½“çš„å­ç³»ç»Ÿå¯¹è±¡ã€‚</li><li>å­ç³»ç»Ÿç±»ï¼šå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿï¼Œç”¨äºå¤„ç†å¤–è§‚ç±»æŒ‡æ´¾çš„ä»»åŠ¡ã€‚æ³¨æ„å­ç³»ç»Ÿä¸å«å¤–è§‚ç±»çš„å¼•ç”¨ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-3"><a href="#ç®€å•ç¤ºä¾‹-3" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€å­ç³»ç»Ÿç±»ï¼ˆè¿™ä¸ªæœ‰ä¸‰ä¸ªå­ç³»ç»Ÿï¼‰</p><pre><code class="java">public class ZhaoShi &#123;    public void TaiJiQuan() &#123;        ...    &#125;        public void QiShanQuan() &#123;        ...    &#125;        public void ShengHuo() &#123;        ...    &#125;&#125;public class NeiGong &#123;    public void JiuYang() &#123;        ...    &#125;        public void QianKun() &#123;        ...    &#125;&#125;public class JingMai &#123;    public void JingMai() &#123;        ...    &#125;&#125;</code></pre><p>2ã€å¤–è§‚ç±»</p><pre><code class="java">public class ZhangWuJi &#123;    private ZhaoShi zhaoShi;    private JingMai jingMai;    pirvate Neigong neiGong;        public ZhangWuJi() &#123;        zhaoShi = new ZhaoShi();        jingMai = new JingMai();        neiGong = new NeiGong();    &#125;        public void qianKun() &#123;        jingMai.JingMai();        neiGong.QianKun();    &#125;        public void qiShang() &#123;        jingMai.JingMai();        neiGong.JiuYang();        zhaoShi.QiShangQuan();    &#125;&#125;</code></pre><p>3ã€ä½¿ç”¨</p><pre><code class="java">ZhangWuJi zhangWuJi = new ZhangWuJi();zhangWuJi.QianKun();zhangWuJi.QiShang();</code></pre><ul><li>å°†å¯¹å­ç³»ç»Ÿçš„ä¾èµ–è½¬æ¢ä¸ºå¯¹å¤–è§‚ç±»çš„ä¾èµ–ã€‚</li><li>å¯¹å¤–éƒ¨éšè—å­ç³»ç»Ÿçš„å…·ä½“å®ç°ã€‚</li><li>è¿™ç§å¤–è§‚ç‰¹æ€§å¢å¼ºäº†å®‰å…¨æ€§ã€‚</li></ul><h4 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h4><p>ä½¿ç”¨å…±äº«å¯¹è±¡æœ‰æ•ˆæ”¯æŒå¤§é‡ç»†ç²’åº¦ï¼ˆæ€§è´¨ç›¸ä¼¼ï¼‰çš„å¯¹è±¡ã€‚</p><p>é¢å¤–çš„ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>1ã€å†…éƒ¨çŠ¶æ€ï¼šå…±äº«ä¿¡æ¯ï¼Œä¸å¯æ”¹å˜ã€‚</li><li>2ã€å¤–éƒ¨çŠ¶æ€ï¼šä¾èµ–æ ‡è®°ï¼Œå¯ä»¥æ”¹å˜ã€‚</li></ul><p>äº«å…ƒæ¨¡å¼æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡äº«å…ƒè§’è‰²ï¼šå®šä¹‰å¯¹è±¡å†…éƒ¨å’Œå¤–éƒ¨çŠ¶æ€çš„æ¥å£ã€‚</li><li>å…·ä½“äº«å…ƒè§’è‰²ï¼šå®ç°æŠ½è±¡äº«å…ƒè§’è‰²çš„ä»»åŠ¡ã€‚</li><li>äº«å…ƒå·¥å‚ï¼šç®¡ç†å¯¹è±¡æ± åŠåˆ›å»ºäº«å…ƒå¯¹è±¡ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-4"><a href="#ç®€å•ç¤ºä¾‹-4" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€æŠ½è±¡äº«å…ƒè§’è‰²</p><pre><code class="java">public interface IGoods &#123;    public void showGoodsPrice(String name);&#125;</code></pre><p>2ã€å…·ä½“äº«å…ƒè§’è‰²</p><pre><code class="java">public class Goods implements IGoods &#123;    private String name;    private String price;        Goods (String name) &#123;        this.name = name;    &#125;        @Override    public void showGoodsPrice(String name) &#123;        ...    &#125;&#125;</code></pre><p>3ã€äº«å…ƒå·¥å‚</p><pre><code class="java">public class GoodsFactory &#123;    private static Map&lt;String, Goods&gt; pool = new HashMap&lt;String, Goods&gt;();    public static Goods getGoods(String name) &#123;        if (pool.containsKey(name)) &#123;            return pool.get(name);        &#125; else &#123;            Goods goods = new Goods(name);            pool.put(name, goods);            return goods;        &#125;    &#125;&#125;</code></pre><p>4ã€ä½¿ç”¨</p><pre><code class="java">Goods goods1 = GoodsFactory.getGoods(&quot;Androidè¿›é˜¶ä¹‹å…‰&quot;);goods1.showGoodsPrice(&quot;æ™®é€šç‰ˆ&quot;);Goods goods2 = GoodsFactory.getGoods(&quot;Androidè¿›é˜¶ä¹‹å…‰&quot;);goods1.showGoodsPrice(&quot;æ™®é€šç‰ˆ&quot;);Goods goods3 = GoodsFactory.getGoods(&quot;Androidè¿›é˜¶ä¹‹å…‰&quot;);goods1.showGoodsPrice(&quot;ç­¾åç‰ˆ&quot;);</code></pre><p>goods1ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåé¢çš„éƒ½æ˜¯ä»å¯¹è±¡æ± ä¸­å–å‡ºçš„ç¼“å­˜å¯¹è±¡ã€‚</p><h4 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h4><p>å°†ä¸€ä¸ªæ¥å£è½¬æ¢ä¸ºå¦ä¸€ä¸ªéœ€è¦çš„æ¥å£ã€‚</p><p>é€‚é…å™¨æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>è¦è½¬æ¢çš„æ¥å£ã€‚</li><li>è¦è½¬æ¢çš„æ¥å£çš„å®ç°ç±»ã€‚</li><li>è½¬æ¢åçš„æ¥å£ã€‚</li><li>è½¬æ¢åçš„æ¥å£çš„å®ç°ç±»ã€‚</li><li>é€‚é…å™¨ç±»ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-5"><a href="#ç®€å•ç¤ºä¾‹-5" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€è¦è½¬æ¢çš„æ¥å£ï¼ˆç«é¸¡ï¼‰</p><pre><code class="java">public interface Turkey &#123;    public void gobble();    public void fly();&#125;</code></pre><p>2ã€è¦è½¬æ¢çš„æ¥å£çš„å®ç°ç±»</p><pre><code class="java">public class WildTurkey implements Turkey &#123;    @Override    public void gobble() &#123;        ...    &#125;        @Override    public void fly() &#123;        ...    &#125;&#125;</code></pre><p>3ã€è½¬æ¢åçš„æ¥å£ï¼ˆé¸­å­ï¼‰</p><pre><code class="java">public interface Duck &#123;    public void quack();    public void fly();&#125;</code></pre><p>4ã€è½¬æ¢åçš„æ¥å£çš„å®ç°ç±»ã€‚</p><pre><code class="java">public class MallardDuck implements Duck &#123;    @Override    public void quack() &#123;        ...    &#125;        @Overrdie    public void fly() &#123;        ...    &#125;&#125;</code></pre><p>5ã€é€‚é…å™¨ç±»</p><pre><code class="java">public class TurkeyAdapter implements Duck &#123;    Turkey turkey;        public TurkeyAdapter(Turkey turkey) &#123;        this.turkey = turkey;    &#125;        @Override    public void quack() &#123;        turkey.gobble();    &#125;        @Override    public void fly() &#123;        // ç«é¸¡æ²¡æœ‰é¸­å­é£çš„è¿œï¼Œå› æ­¤å¤šé£å‡ æ¬¡ï¼Œè¾¾åˆ°é€‚é…é¸­å­flyçš„ä½œç”¨        for(int i;i &lt; 5;i++) &#123;            turkey.fly();        &#125;    &#125;&#125;</code></pre><p>6ã€ä½¿ç”¨</p><pre><code class="java">WildTurkey wildTurkey = new WildTurkey();TurkeyAdapter turkeyAdapter = new TurkeyAdapter(wildTurkey);turkeyAdapter.quack();turkeyAdapter.fly();</code></pre><ul><li>æ³¨é‡é€‚åº¦ä½¿ç”¨å³å¯ã€‚</li></ul><h3 id="3ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"><a href="#3ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="3ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"></a>3ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</h3><h4 id="1ã€ç­–ç•¥æ¨¡å¼"><a href="#1ã€ç­–ç•¥æ¨¡å¼" class="headerlink" title="1ã€ç­–ç•¥æ¨¡å¼"></a>1ã€ç­–ç•¥æ¨¡å¼</h4><p>å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•éƒ½å°è£…èµ·æ¥ï¼Œå¹¶ä¸”å¯ç›¸äº’æ›¿æ¢ã€‚è¿™ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºè°ƒç”¨è€…è€Œå•ç‹¬å˜åŒ–ã€‚</p><p>ç­–ç•¥æ¨¡å¼æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>ä¸Šä¸‹æ–‡è§’è‰²ï¼šç”¨æ¥æ“ä½œç­–ç•¥ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å±è”½äº†é«˜å±‚æ¨¡å—å¯¹ç­–ç•¥å’Œç®—æ³•çš„ç›´æ¥è®¿é—®ã€‚</li><li>æŠ½è±¡ç­–ç•¥è§’è‰²ã€‚</li><li>å…·ä½“ç­–ç•¥è§’è‰²ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-6"><a href="#ç®€å•ç¤ºä¾‹-6" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€æŠ½è±¡ç­–ç•¥è§’è‰²</p><pre><code class="java">public interface FightingStrategy &#123;    public void fighting();&#125;</code></pre><p>2ã€å…·ä½“ç­–ç•¥è§’è‰²</p><pre><code class="java">public class WeakRivalStrategy implements FightingStrategy &#123;        @Override    public void fighting() &#123;        ...    &#125;&#125;public class CommonRivalStrategy implements FightingStrategy &#123;        @Override    public void fighting() &#123;        ...    &#125;&#125;public class StrongRivalStrategy implements FightingStrategy &#123;        @Override    public void fighting() &#123;        ...    &#125;&#125;</code></pre><p>3ã€ä¸Šä¸‹æ–‡è§’è‰²</p><pre><code class="java">public class Context &#123;    private FightingStrategy mFightingStrategy;        public void Context(FightingStrategy fightingStrategy) &#123;        this.mFightingStrategy = fightingStrategy;    &#125;        public void fighting() &#123;        mFightingStrategy.fighting();    &#125;&#125;</code></pre><p>4ã€ä½¿ç”¨</p><pre><code class="java">Context context;context = new Context(new WeakRivalStrategy());context.fighting();context = new Context(new CommonRivalStategy());context.fighting();context = new Context(new StrongRivalStategy());context.fighting();</code></pre><ul><li>éšè—å…·ä½“ç­–ç•¥ä¸­ç®—æ³•çš„å®ç°ç»†èŠ‚ã€‚</li><li>é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è¯­å¥ã€‚</li><li>æ˜“äºæ‰©å±•</li><li>æ¯ä¸€ä¸ªç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œå¤ç”¨æ€§å°ã€‚</li><li>ä¸Šå±‚æ¨¡å—å¿…é¡»çŸ¥é“æœ‰å“ªäº›ç­–ç•¥ç±»ï¼Œä¸è¿ªç±³ç‰¹åŸåˆ™ç›¸è¿èƒŒã€‚</li></ul><h4 id="2ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#2ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="2ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>2ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h4><p>å®šä¹‰äº†ä¸€å¥—ç®—æ³•æ¡†æ¶ï¼Œå°†æŸäº›æ­¥éª¤äº¤ç»™å­ç±»å»å®ç°ã€‚ä½¿å¾—å­ç±»ä¸éœ€æ”¹å˜æ¡†æ¶ç»“æ„å³å¯é‡å†™ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚</p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡ç±»ï¼šå®šä¹‰äº†ä¸€å¥—ç®—æ³•æ¡†æ¶ã€‚</li><li>å…·ä½“å®ç°ç±»ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-7"><a href="#ç®€å•ç¤ºä¾‹-7" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€æŠ½è±¡ç±»</p><pre><code class="java">public abstract class AbstractSwordsman &#123;    public final void fighting() &#123;        neigong();                // è¿™ä¸ªæ˜¯å…·ä½“æ–¹æ³•        jingmai();                if (hasWeapons()) &#123;            weapons();        &#125;                moves();                hook();    &#125;        protected void hook() &#123; &#125;;    protected void abstract neigong();    protected void abstract weapons();    protected void abstract moves();    public void jingmai() &#123;        ...    &#125;        protected boolean hasWeapons() &#123;        return ture;    &#125;&#125;</code></pre><p>2ã€å…·ä½“å®ç°ç±»</p><pre><code class="java">public class ZhangWuJi extends AbstractSwordsman &#123;        @Override    public void neigong() &#123;        ...    &#125;        @Override     public void weapons() &#123;        // æ²¡æœ‰æ­¦å™¨ï¼Œä¸åšå¤„ç†    &#125;        @Override     public void moves() &#123;        ...    &#125;        @Override    public boolean hasWeapons() &#123;        return false;    &#125;&#125;public class ZhangSanFeng extends AbstractSwordsman &#123;        @Override    public void neigong() &#123;        ...    &#125;        @Override     public void weapons() &#123;        ...    &#125;        @Override     public void moves() &#123;        ...    &#125;        @Override    public void hook() &#123;        // é¢å¤–å¤„ç†        ...    &#125;&#125;</code></pre><p>3ã€ä½¿ç”¨</p><pre><code class="java">ZhangWuJi zhangWuJi = new ZhangWuJi();zhangWuJi.fighting();ZhangSanFeng zhangSanFeng = new ZhangSanFeng();zhangSanFeng.fighting();</code></pre><ul><li>å¯ä»¥ä½¿ç”¨hookæ–¹æ³•å®ç°å­ç±»å¯¹çˆ¶ç±»çš„åå‘æ§åˆ¶ã€‚</li><li>å¯ä»¥æŠŠæ ¸å¿ƒæˆ–å›ºå®šçš„é€»è¾‘æ¬ç§»åˆ°åŸºç±»ï¼Œå…¶å®ƒç»†èŠ‚äº¤ç»™å­ç±»å®ç°ã€‚</li><li>æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œå¤ç”¨æ€§å°ã€‚</li></ul><h4 id="3ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰"><a href="#3ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰" class="headerlink" title="3ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå‘å¸ƒ - è®¢é˜…æ¨¡å¼ï¼‰"></a>3ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå‘å¸ƒ - è®¢é˜…æ¨¡å¼ï¼‰</h4><p>å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§1å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œæ¯å½“è¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œå…¶å®ƒçš„å¯¹è±¡éƒ½ä¼šæ¥æ”¶åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼šå°†æ‰€æœ‰å·²æ³¨å†Œçš„è§‚å¯Ÿè€…å¯¹è±¡ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚</li><li>å…·ä½“è¢«è§‚å¯Ÿè€…ï¼šå½“å†…éƒ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†ä¼šé€šçŸ¥æ‰€æœ‰å·²æ³¨å†Œçš„è§‚å¯Ÿè€…ã€‚</li><li>æŠ½è±¡è§‚å¯Ÿè€…ï¼šå®šä¹‰äº†ä¸€ä¸ªæ›´æ–°æ¥å£ï¼Œå½“è¢«è§‚å¯Ÿè€…çŠ¶æ€æ”¹å˜æ—¶æ›´æ–°è‡ªå·±ã€‚</li><li>å…·ä½“è¢«è§‚å¯Ÿè€…ï¼šå®ç°æŠ½è±¡è§‚å¯Ÿè€…çš„æ›´æ–°æ¥å£ã€‚</li></ul><h5 id="ç®€å•ç¤ºä¾‹-8"><a href="#ç®€å•ç¤ºä¾‹-8" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h5><p>1ã€æŠ½è±¡è§‚å¯Ÿè€…</p><pre><code class="java">public interface observer &#123;        public void update(String message);&#125;</code></pre><p>2ã€å…·ä½“è§‚å¯Ÿè€…</p><pre><code class="java">public class WeXinUser implements observer &#123;    private String name;        public WeXinUser(String name) &#123;        this.name = name;    &#125;        @Override    public void update(String message) &#123;        ...    &#125;&#125;</code></pre><p>3ã€æŠ½è±¡è¢«è§‚å¯Ÿè€…</p><pre><code class="java">public interface observable &#123;        public void addWeXinUser(WeXinUser weXinUser);        public void removeWeXinUser(WeXinUser weXinUser);        public void notify(String message);&#125;</code></pre><p>4ã€å…·ä½“è¢«è§‚å¯Ÿè€…</p><pre><code class="java">public class Subscription implements observable &#123;    private List&lt;WeXinUser&gt; mUserList = new ArrayList();    @Override    public void addWeXinUser(WeXinUser weXinUser) &#123;        mUserList.add(weXinUser);    &#125;    @Override    public void removeWeXinUser(WeXinUser weXinUser) &#123;        mUserList.remove(weXinUser);    &#125;    @Override    public void notify(String message) &#123;        for(WeXinUser weXinUser : mUserList) &#123;            weXinUser.update(message);        &#125;    &#125;&#125;</code></pre><p>5ã€ä½¿ç”¨</p><pre><code class="java">Subscription subscription = new Subscription();WeXinUser hongYang = new WeXinUser(&quot;HongYang&quot;);WeXinUser rengYuGang = new WeXinUser(&quot;RengYuGang&quot;);WeXinUser liuWangShu = new WeXinUser(&quot;LiuWangShu&quot;);subscription.addWeiXinUser(hongYang);subscription.addWeiXinUser(rengYuGang);subscription.addWeiXinUser(liuWangShu);subscription.notify(&quot;New article coming&quot;);</code></pre><ul><li>å®ç°äº†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´çš„æŠ½è±¡è€¦åˆï¼Œå®¹æ˜“æ‰©å±•ã€‚</li><li>æœ‰åˆ©äºå»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚</li><li>ä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¡é¡¿ï¼Œä¼šå½±å“æ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ã€‚é‡‡ç”¨å¼‚æ­¥æœºåˆ¶å¯è§£å†³æ­¤ç±»é—®é¢˜ã€‚</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MVC-MVP-MVVM è¿›åŒ–ä¹‹è·¯</title>
      <link href="/2020-08-17/mvc-mvp-mvvm/"/>
      <url>/2020-08-17/mvc-mvp-mvvm/</url>
      
        <content type="html"><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ—¥å¸¸å¼€å‘ä¸­ï¼Œæ¯”è¾ƒå—æ¬¢è¿çš„è®¾è®¡æ¨¡å¼ï¼Œé™¤äº†å•ä¾‹ã€å·¥å‚ã€è£…é¥°å™¨ç­‰ä¹‹å¤–ï¼Œè¢«å¤§å®¶è®¨è®ºæœ€å¤šçš„ï¼Œå°±æ˜¯ MVCã€MVP å’Œ MVVM äº†ã€‚</p><p>è¿™ä¸‰ç§è®¾è®¡æ¨¡å¼å„æœ‰åƒç§‹ï¼Œè€¦åˆåº¦éƒ½æ¯”è¾ƒä½ï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯•ä¸ç»´æŠ¤ã€‚æˆ‘ä»¬ä»Šå¤©å°±æ¥è®¨è®ºä¸€ä¸‹è¿™ä¸‰ç§è®¾è®¡æ¨¡å¼åœ¨å¼€å‘ä¸­çš„åº”ç”¨ã€‚</p><span id="more"></span><blockquote><p>è¿™ç¯‡æ–‡ç« ä¸­å…³äºè®¾è®¡æ¨¡å¼çš„è®¨è®ºï¼Œéƒ½ä»¥ Android å¹³å°åšä¸ºç¤ºä¾‹ç¯å¢ƒï¼Œä»¥ Kotlin åšä¸ºç¤ºä¾‹è¯­è¨€ã€‚</p></blockquote><h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p>MVCï¼ˆModel-View-Controllerï¼‰ï¼Œå®ƒæœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š<strong>æ¨¡å‹ï¼ˆModelï¼‰</strong>ã€<strong>è§†å›¾ï¼ˆViewï¼‰</strong>å’Œ<strong>æ§åˆ¶å™¨ï¼ˆControllerï¼‰</strong>ã€‚</p><ul><li><p>Model<br>è¿™éƒ¨åˆ†åŠŸèƒ½æ¯”è¾ƒæ˜æ˜¾ï¼Œå°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨éœ€è¦æ˜¾ç¤ºçš„æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»ï¼Œå…¶ä¸­æ‰¿è½½äº†ä¸šåŠ¡æ¨¡å‹å’Œæ•°æ®æ¨¡å‹ï¼›åŒæ—¶ï¼Œå®ƒåˆæä¾›æ•°æ®çš„æ“ä½œï¼Œå¹¶ä¸”ç›´è§‚åœ°å±•ç¤ºäº†æ•°æ®çš„å˜åŒ–ï¼Œå½“ç„¶ï¼Œè¿™ç§å˜åŒ–è¦éµå¾ªä¸€å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚</p></li><li><p>View<br>View ä»£è¡¨äº† UI ç»„ä»¶ï¼Œå¦‚ XMLã€HTML ç­‰ï¼Œåœ¨ MVC æ¨¡å¼ä¸­ï¼ŒView è´Ÿè´£å±•ç° Controller äº¤è¿‡æ¥çš„æ•°æ®ï¼Œå®ƒä¼šç›‘å¬ Model çš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶å±•ç¤ºæ•°æ®æ›´æ–°åçš„ Modelã€‚Model å’Œ View çš„äº¤äº’æ˜¯åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ã€‚åœ¨ Android ä¸­ï¼Œå„ç§ XML å¸ƒå±€ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ View å±‚ã€‚</p></li><li><p>Controller<br>Controller è´Ÿè´£å¤„ç†å„ç§è¯·æ±‚ã€‚å®ƒä¼šé€šè¿‡ Model å¤„ç†ç”¨æˆ·æ•°æ®ï¼Œå¹¶å°†å¤„ç†ç»“æœäº¤ç»™ View å»å±•ç¤ºï¼Œå®ƒé€šå¸¸æ‰®æ¼”ç€ View å’Œ Model ä¹‹é—´çš„è°ƒåº¦è€…çš„è§’è‰²ã€‚æ˜¾è€Œæ˜“è§åœ°ï¼Œåœ¨ Android ä¸­ï¼ŒActivity æˆ– Fragment æ‹…å½“äº†è¿™ä¸ªè§’è‰²ã€‚</p></li></ul><p>å…¶å® Activity å¹¶éæ ‡å‡†çš„ Controllerï¼Œå®ƒä¸€æ–¹é¢ç”¨æ¥æ§åˆ¶äº†å¸ƒå±€ï¼Œå¦ä¸€æ–¹é¢è¿˜è¦åœ¨ Activity ä¸­å†™ä¸šåŠ¡ä»£ç ï¼Œé€ æˆäº† Activity æ—¢åƒ View åˆåƒ Controllerã€‚</p><p>å› æ­¤ï¼Œ<strong>è¿™ç§å¼€å‘æ–¹å¼ä¸å¤ªé€‚åˆ Android å¼€å‘</strong>ã€‚</p><p>MVC çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://blog.cigis-cloud.com/design-pattern-1597991354.png" alt="MVC ç»“æ„"></p><p>æˆ‘ä»¬ç”¨ä»£ç æ¥å±•ç¤ºä¸€ä¸‹ Android ä¸­å¦‚ä½•ä½¿ç”¨ MVC æ¨¡å¼ï¼Œæˆ‘ä»¬çš„ä¾‹å­æ˜¯ç”¨æˆ·å¡«å†™ç”¨æˆ·åå¯†ç ï¼Œç‚¹å‡»ç™»å½•æŒ‰é’®ä¹‹åï¼Œè¯·æ±‚ UserInfoï¼Œå¹¶æœ€ç»ˆå±•ç¤ºåœ¨ç•Œé¢ä¸Šã€‚</p><p>é¦–å…ˆæ˜¯ Modelï¼š</p><pre><code class="kotlin">class UserInfo &#123;    var uid: Int = 0     var name: String? = null    var phone: String? = null    var password: String? = null&#125;</code></pre><p>æ¥ä¸‹æ¥æ˜¯æˆ‘ä»¬çš„ View å±‚ï¼Œä¹Ÿå°±æ˜¯ XML å¸ƒå±€ï¼š</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;androidx.constraintlayout.widget.ConstraintLayout    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;    xmlns:tools=&quot;http://schemas.android.com/tools&quot;    android:layout_width=&quot;match_parent&quot;    android:layout_height=&quot;match_parent&quot;&gt;    &lt;LinearLayout        android:id=&quot;@+id/llPhone&quot;        android:layout_width=&quot;match_parent&quot;        android:layout_height=&quot;wrap_content&quot;        android:orientation=&quot;horizontal&quot;        android:layout_margin=&quot;16dp&quot;        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;        app:layout_constraintEnd_toEndOf=&quot;parent&quot;        app:layout_constraintStart_toStartOf=&quot;parent&quot;        app:layout_constraintTop_toTopOf=&quot;parent&quot;&gt;        &lt;TextView            android:layout_width=&quot;0dp&quot;            android:layout_height=&quot;wrap_content&quot;            android:layout_weight=&quot;1&quot;            android:text=&quot;PHONE&quot; /&gt;        &lt;EditText            android:id=&quot;@+id/etPhone&quot;            android:layout_width=&quot;0dp&quot;            android:layout_height=&quot;wrap_content&quot;            android:layout_weight=&quot;4&quot;            android:layout_marginStart=&quot;8dp&quot;            android:inputType=&quot;phone&quot;            android:hint=&quot;Input phone number&quot;             /&gt;    &lt;/LinearLayout&gt;    &lt;LinearLayout        android:id=&quot;@+id/llPassword&quot;        android:layout_width=&quot;match_parent&quot;        android:layout_height=&quot;wrap_content&quot;        android:layout_margin=&quot;16dp&quot;        android:orientation=&quot;horizontal&quot;        app:layout_constraintTop_toBottomOf=&quot;@+id/llPhone&quot;        tools:layout_editor_absoluteX=&quot;16dp&quot;&gt;        &lt;TextView            android:layout_width=&quot;0dp&quot;            android:layout_height=&quot;wrap_content&quot;            android:layout_weight=&quot;1&quot;            android:text=&quot;PASSWORD&quot; /&gt;        &lt;EditText            android:id=&quot;@+id/etPassword&quot;            android:layout_width=&quot;0dp&quot;            android:layout_height=&quot;wrap_content&quot;            android:layout_marginStart=&quot;8dp&quot;            android:layout_weight=&quot;4&quot;            android:hint=&quot;Input password&quot;            android:inputType=&quot;textVisiblePassword&quot; /&gt;    &lt;/LinearLayout&gt;    &lt;Button        android:id=&quot;@+id/btnLogin&quot;        android:layout_width=&quot;match_parent&quot;        android:layout_height=&quot;wrap_content&quot;        android:layout_margin=&quot;16dp&quot;        app:layout_constraintTop_toBottomOf=&quot;@+id/llPassword&quot;        tools:layout_editor_absoluteX=&quot;16dp&quot;        android:text=&quot;LOGIN&quot;/&gt;        &lt;TextView        android:id=&quot;@+id/tvUserInfo&quot;        android:layout_width=&quot;match_parent&quot;        android:layout_height=&quot;wrap_content&quot;        app:layout_constraintTop_toBottomOf=&quot;@id/btnLogin&quot;        android:layout_marginTop=&quot;16dp&quot; /&gt;    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</code></pre><p>æ¥ç€å°±æ˜¯ Controller å±‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ Activityï¼š</p><pre><code class="kotlin">package me.codingrabbit.jetpacklearnimport androidx.appcompat.app.AppCompatActivityimport android.os.Bundleimport com.google.android.material.snackbar.Snackbarimport kotlinx.android.synthetic.main.activity_login.*import java.io.BufferedInputStreamimport java.io.InputStreamimport java.net.HttpURLConnectionimport java.net.URLimport javax.net.ssl.HttpsURLConnectionclass LoginActivity : AppCompatActivity(), Callback &#123;    override fun onCreate(savedInstanceState: Bundle?) &#123;        super.onCreate(savedInstanceState)        setContentView(R.layout.activity_login)        btnLogin.setOnClickListener &#123;            val userInfo = UserInfo()            userInfo.phone = etPhone.editableText.toString()            userInfo.password = etPassword.editableText.toString()            requestUserInfo(userInfo, this@LoginActivity)        &#125;    &#125;    override fun onSuccess(userInfo: UserInfo) &#123;        super.onSuccess(userInfo)        Snackbar.make(tvUserInfo, &quot;UserInfo: uid=$&#123;userInfo.uid&#125;, &quot; +                &quot;name=$&#123;userInfo.name&#125;, &quot; +                &quot;phone=$&#123;userInfo.phone&#125;&quot;, Snackbar.LENGTH_SHORT)    &#125;    override fun onError(msg: String) &#123;        super.onError(msg)        Snackbar.make(tvUserInfo, &quot;Error: $&#123;msg&#125;&quot;, Snackbar.LENGTH_SHORT)    &#125;    private fun requestUserInfo(userInfo: UserInfo, callback: Callback) &#123;        // è¯·æ±‚æ•°æ®ï¼Œçœç•¥        callback.onSuccess(userInfo)    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒActivity å¦‚ä¸Šé¢æ‰€è¯´ï¼Œä¹Ÿçš„ç¡®æ˜¯åŒæ—¶æ‰®æ¼”äº† View å’Œ Controller çš„è§’è‰²ã€‚</p><p>ä¸Šé¢çš„æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ€»ç»“ï¼š</p><p><img src="http://blog.cigis-cloud.com/design-pattern-1597984167.png"></p><p>ç›˜ç‚¹ä¸€ä¸‹ MVC æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š</p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li>Model ä¸ View è€¦åˆåº¦è¾ƒä½ï¼Œæ–¹ä¾¿è¿›è¡Œå•ç‹¬çš„å•å…ƒæµ‹è¯•ï¼›</li><li>ç»“æ„ç®€å•ï¼›</li><li>ä»£ç é‡å°‘ã€‚</li></ol><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>Model ä¸ View å¹¶æ²¡æœ‰å®Œå…¨è§£è€¦ï¼ŒåæœŸä¸šåŠ¡å¤æ‚åº¦è¾ƒé«˜æ—¶ï¼Œç»´æŠ¤èµ·æ¥ç¨æ˜¾å¤æ‚ï¼›</li><li>Controller ä¸ Android API è€¦åˆåº¦å¾ˆé«˜ï¼Œæµ‹è¯•èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼›</li><li>Controller ä¸ View è€¦åˆåº¦å¾ˆé«˜ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº† Viewï¼Œé‚£ä¹ˆå›å¤´æ¥è¿˜è¦ä¿®æ”¹ Controllerï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼ŒController å°†ä¼šå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿å’Œéš¾ä»¥ç»´æŠ¤ï¼›</li><li>MVC æ¨¡å‹ä¸é€‚åˆå°å‹ APP çš„å¼€å‘ã€‚</li></ol><h2 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h2><p>MVPï¼ˆModel-View-Presenterï¼‰æ˜¯ MVC æ¨¡å¼çš„æ¼”åŒ–ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿæœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š<strong>æ¨¡å‹ï¼ˆModelï¼‰</strong>ã€<strong>è§†å›¾ï¼ˆViewï¼‰</strong>å’Œ<strong>å±•ç¤ºï¼ˆPresenterï¼‰</strong>ã€‚</p><ul><li><p>Model</p><p>ä¸ MVC ä¸­çš„ Model ä¸å¤ªç›¸åŒã€‚è¿™é‡Œçš„ Model æŒ‡å­˜å–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯<strong>ç”¨æ¥ä»æŒ‡å®šçš„æ•°æ®æºä¸­è·å–æ•°æ®</strong>ï¼Œä¸è¦å°†å…¶ç†è§£æˆ MVC ä¸­çš„ Modelã€‚åœ¨MVC ä¸­ Model æ˜¯<strong>æ•°æ®æ¨¡å‹</strong>ï¼Œè€Œåœ¨MVPä¸­ï¼Œæˆ‘ä»¬ç”¨Beanæ¥è¡¨ç¤ºæ•°æ®æ¨¡å‹ã€‚</p></li><li><p>View</p><p>ä¸ MVC ä¸­çš„ View ç›¸åŒï¼Œä¸€èˆ¬æŒ‡ XML å¸ƒå±€ã€‚</p></li><li><p>Presenter</p><p>è¿™å°±æ˜¯ MVC ä¸ MVP ä¸åŒçš„ä¸€ä¸ªéƒ¨åˆ†äº†ã€‚å®ƒè´Ÿè´£è¿æ¥ Model å’Œ Viewï¼Œè®© Model å’Œ View <strong>å½»åº•è§£è€¦</strong>ã€‚Model å’Œ View ä¸ä¼šç›´æ¥å‘ç”Ÿå…³ç³»ï¼Œå®ƒä»¬éœ€è¦é€šè¿‡ Presenter æ¥è¿›è¡Œäº¤äº’ã€‚åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥å£æ¥å®šä¹‰ä¸€äº›è§„èŒƒï¼Œç„¶åè®©æˆ‘ä»¬çš„ Model å’Œ View å®ç°å®ƒä»¬ï¼Œå¹¶å€ŸåŠ© Presenter è¿›è¡Œäº¤äº’å³å¯ã€‚</p></li></ul><p>å®ƒçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://blog.cigis-cloud.com/design-pattern-1597991166.png" alt="MVP ç»“æ„"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ MVP æ¨¡å¼æ”¹è¿›ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ï¼Œä½¿ç”¨ MVP æ¨¡å¼ä¹‹åï¼Œé¡¹ç›®ä¸‹åŒ…çš„ç»“æ„ï¼š</p><p><img src="http://blog.cigis-cloud.com/design-pattern-1597972649.png" alt="MVP åŒ…ç»“æ„"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æŠ½å‡ºäº†ä¸€ä¸ªå•ç‹¬çš„åŒ…<code>base</code>ï¼Œç”¨æ¥åšä¸€äº›é€šç”¨å‹çš„åŠŸèƒ½ï¼Œæ‰€æœ‰çš„ View éƒ½åº”è¯¥ç»§æ‰¿è‡ªè¿™ä¸ªçˆ¶ç±»ã€‚</p><p>é‚£ä¹ˆï¼Œéšç€ View å’Œ Presenter è¶Šæ¥è¶Šå¤šï¼Œç»´æŠ¤çš„éš¾åº¦ç³»æ•°ä¹Ÿä¼šè¶Šæ¥è¶Šé«˜ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å¼•å…¥æ–°çš„ä¸€å±‚ â€”â€” Contractã€‚</p><p>è¿™ä¸€å±‚çš„æ„ä¹‰åœ¨äºï¼Œå¯ä»¥å°†æŸä¸€ä¸ªä¸šåŠ¡ç›¸å…³çš„æŒ‡å®šçš„ View å’Œ Presenter æ”¾åœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œæ›´åŠ é›†ä¸­ï¼Œæ¯ä¸€ä¸ªä¸šåŠ¡æ‰€éœ€è¦çš„ View å’Œ Presenter å¯ä»¥ä¸€ç›®äº†ç„¶åœ°å±•ç°åœ¨æˆ‘ä»¬é¢å‰ã€‚ä¸Šé¢çš„ä¾‹å­å°±å¯ä»¥ä¿®æ”¹æˆï¼š</p><p><img src="http://blog.cigis-cloud.com/design-pattern-1597973055.png"></p><p>LoginContract ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="kotlin">interface LoginContract &#123;    interface IView : BaseView &#123;        fun onSuccess(userInfo: UserInfo?)        fun onError(msg: String?)    &#125;    interface IPresenter : BasePresenter &#123;        fun requestUserInfo()    &#125;&#125;</code></pre><p>è€Œ View å’Œ Presenter ç±»å®ç°çš„æ¥å£ï¼ŒåŒæ ·åœ°è¦è½¬å˜ä¸ºå®ç°è¯¥ Contract ä¸­çš„å¯¹åº”æ¥å£ï¼š</p><pre><code class="kotlin">interface LoginView : LoginContract.IView &#123;    override fun onSuccess(userInfo: UserInfo?) &#123;    &#125;    override fun onError(msg: String?) &#123;    &#125;&#125;class LoginPresenter(val view: LoginContract.IView) : LoginContract.IPresenter &#123;    override fun requestUserInfo() &#123;    &#125;&#125;</code></pre><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Presenter åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥ Viewï¼ŒPresenter é€šè¿‡ Model è·å–æ•°æ®ï¼Œå¹¶åœ¨æ‹¿åˆ°æ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡ View çš„æ–¹æ³•é€šçŸ¥ç»™ View å±‚ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬çš„ Activity å¯ä»¥ä»ä¹‹å‰çš„ Controller çš„è§’è‰²ä¸­è§£æ”¾å‡ºæ¥ï¼Œæˆä¸ºä¸‹é¢çš„æ ·å­ï¼š</p><pre><code class="kotlin">class LoginActivity : AppCompatActivity(), LoginView &#123;    var presenter: LoginContract.IPresenter = LoginPresenter(this)    override fun onCreate(savedInstanceState: Bundle?) &#123;        super.onCreate(savedInstanceState)        setContentView(R.layout.activity_login)        btnLogin.setOnClickListener &#123;            presenter.requestUserInfo(etPhone.editableText.toString(),                    etPassword.editableText.toString())        &#125;    &#125;    override fun onSuccess(userInfo: UserInfo?) &#123;        Snackbar.make(tvUserInfo, &quot;UserInfo: uid=$&#123;userInfo?.uid&#125;, &quot; +                &quot;name=$&#123;userInfo?.name&#125;, &quot; +                &quot;phone=$&#123;userInfo?.phone&#125;&quot;, Snackbar.LENGTH_SHORT)    &#125;    override fun onError(msg: String?) &#123;        Snackbar.make(tvUserInfo, &quot;Error: $&#123;msg&#125;&quot;, Snackbar.LENGTH_SHORT)    &#125;&#125;</code></pre><p>å®é™…åœ¨ View ä¸­ä¹Ÿè¦ç»´æŠ¤ä¸€ä¸ª Presenter çš„å®ä¾‹ã€‚ å½“éœ€è¦è¯·æ±‚æ•°æ®çš„æ—¶å€™ä¼šä½¿ç”¨è¯¥å®ä¾‹çš„æ–¹æ³•æ¥è¯·æ±‚æ•°æ®ï¼Œæ‰€ä»¥ï¼Œåœ¨å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è¯·æ±‚æ•°æ®çš„æƒ…å†µï¼Œåœ¨ Presenter ä¸­å®šä¹‰æ¥å£æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMVP çš„åŸç†å°±æ˜¯ <strong>View é€šè¿‡ Presenter è·å–æ•°æ®ï¼Œè·å–åˆ°æ•°æ®ä¹‹åå†å›è°ƒViewçš„æ–¹æ³•æ¥å±•ç¤ºæ•°æ®</strong>ã€‚</p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬ç›˜ç‚¹ä¸€ä¸‹ MVP çš„ä¼˜ç¼ºç‚¹ã€‚</p><h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li>é™ä½è€¦åˆåº¦ï¼Œå®ç°äº† Model å’Œ View çœŸæ­£çš„å®Œå…¨åˆ†ç¦»ï¼Œå¯ä»¥ä¿®æ”¹ View è€Œä¸å½±å“ Modelï¼›</li><li>æ¨¡å—èŒè´£åˆ’åˆ†æ˜æ˜¾ï¼Œå±‚æ¬¡æ¸…æ™°ï¼›</li><li>éšè—æ•°æ®ï¼›</li><li>Presenter å¯ä»¥å¤ç”¨ï¼Œä¸€ä¸ª Presenter å¯ä»¥ç”¨äºå¤šä¸ª Viewï¼Œè€Œä¸éœ€è¦æ›´æ”¹ Presenter çš„é€»è¾‘ï¼›</li><li>åˆ©äºæµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œä»¥å‰çš„ Android å¼€å‘æ˜¯éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•çš„ï¼›</li><li>View å¯ä»¥è¿›è¡Œç»„ä»¶åŒ–ï¼Œåœ¨ MVP å½“ä¸­ï¼ŒView ä¸ä¾èµ– Modelã€‚</li></ol><h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>Presenter ä¸­é™¤äº†åº”ç”¨é€»è¾‘ä»¥å¤–ï¼Œè¿˜æœ‰å¤§é‡çš„ View â†’ Modelï¼ŒModel â†’ View çš„æ‰‹åŠ¨åŒæ­¥é€»è¾‘ï¼Œé€ æˆ Presenter æ¯”è¾ƒç¬¨é‡ï¼Œç»´æŠ¤èµ·æ¥ä¼šæ¯”è¾ƒå›°éš¾ï¼›</li><li>ç”±äºå¯¹è§†å›¾çš„æ¸²æŸ“æ”¾åœ¨äº† Presenter ä¸­ï¼Œæ‰€ä»¥è§†å›¾å’Œ Presenter çš„äº¤äº’ä¼šè¿‡äºé¢‘ç¹ï¼›</li><li>å¦‚æœ Presenter è¿‡å¤šåœ°æ¸²æŸ“äº†è§†å›¾ï¼Œå¾€å¾€ä¼šä½¿å¾—å®ƒä¸ç‰¹å®šçš„è§†å›¾çš„è”ç³»è¿‡äºç´§å¯†ï¼Œä¸€æ—¦è§†å›¾éœ€è¦å˜æ›´ï¼Œé‚£ä¹ˆ Presenter ä¹Ÿéœ€è¦å˜æ›´äº†ã€‚</li></ol><h2 id="MVC-ä¸-MVP-çš„å¯¹æ¯”"><a href="#MVC-ä¸-MVP-çš„å¯¹æ¯”" class="headerlink" title="MVC ä¸ MVP çš„å¯¹æ¯”"></a>MVC ä¸ MVP çš„å¯¹æ¯”</h2><ol><li>MVC ä¸­æ˜¯å…è®¸ Model å’Œ View è¿›è¡Œäº¤äº’çš„ï¼Œè€Œ MVP ä¸­ï¼ŒModel ä¸ View ä¹‹é—´çš„äº¤äº’ç”± Presenter å®Œæˆï¼›</li><li>MVP æ¨¡å¼å°±æ˜¯å°† P å®šä¹‰æˆä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨æ¯ä¸ªè§¦å‘çš„äº‹ä»¶ä¸­è°ƒç”¨æ¥å£çš„æ–¹æ³•æ¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å°†é€»è¾‘æ”¾è¿›äº† P ä¸­ï¼Œéœ€è¦æ‰§è¡ŒæŸäº›æ“ä½œçš„æ—¶å€™è°ƒç”¨ P çš„æ–¹æ³•å°±è¡Œäº†ã€‚</li></ol><h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>MVVMï¼ˆModel-View-ViewModelï¼‰æ¨¡å¼æœ¬è´¨ä¸Šä¹Ÿæ˜¯ MVC çš„æ”¹è¿›ç‰ˆï¼Œå®ƒä¼šå°† View çš„çŠ¶æ€ä»¥åŠè¡Œä¸ºè¿›è¡Œ<strong>æŠ½è±¡åŒ–</strong>ï¼Œä»è€Œè®©æˆ‘ä»¬æŠŠä¸šåŠ¡ä¸è§†å›¾åˆ†å¼€ã€‚</p><ul><li><p>Model<br>è´Ÿè´£ä»å„ç§æ•°æ®æºä¸­è·å–æ•°æ®ï¼›</p></li><li><p>View<br>åœ¨ Android ä¸­å¯¹åº”äº Activity å’Œ Fragmentï¼Œç”¨äºå±•ç¤ºç»™ç”¨æˆ·å’Œå¤„ç†ç”¨æˆ·äº¤äº’ï¼Œä¼šé©±åŠ¨ ViewModel ä» Model ä¸­è·å–æ•°æ®ï¼›</p></li><li><p>ViewModel<br>ç”¨äºå°† Model å’Œ View è¿›è¡Œå…³è”ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ View ä¸­é€šè¿‡ ViewModel ä» Model ä¸­è·å–æ•°æ®ï¼›å½“è·å–åˆ°äº†æ•°æ®ä¹‹åï¼Œä¼šé€šè¿‡è‡ªåŠ¨ç»‘å®šï¼Œæ¯”å¦‚ DataBindingï¼Œæ¥å°†ç»“æœè‡ªåŠ¨åˆ·æ–°åˆ°ç•Œé¢ä¸Šã€‚</p></li></ul><p>ä¹çœ‹ä¹‹ä¸‹ï¼ŒMVVM æ¨¡å¼ä¸ MVP æ¨¡å¼å¾ˆç›¸ä¼¼ï¼Œå› ä¸ºå®ƒä»¬éƒ½å¾ˆå¥½åœ°å®Œæˆäº†å¯¹ View å±‚çŠ¶æ€å’Œè¡Œä¸ºçš„æŠ½è±¡åŒ–ã€‚åœ¨ MVP ä¸­ï¼ŒPresenter æŠ½è±¡äº†ä¸€ä¸ªç‹¬ç«‹äºç‰¹å®š UI çš„ Viewï¼Œè€Œåœ¨ MVVM æ¨¡å¼ä¸­ï¼Œå®ƒç®€åŒ–äº† UI äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹æ–¹å¼ã€‚</p><p>å¦‚æœ MVP æ¨¡å¼æ„å‘³ç€ Presenter ç›´æ¥å‘Šè¯‰ View è¦æ˜¾ç¤ºçš„å†…å®¹ï¼Œåˆ™åœ¨ MVVM ä¸­ï¼ŒViewModel å…¬å¼€ View <strong>å¯ä»¥ç»‘å®šçš„äº‹ä»¶æµ</strong>ï¼ˆStream of Eventsï¼‰ã€‚ç”±æ­¤ä¸€æ¥ï¼ŒViewModel <strong>ä¸å†éœ€è¦åƒ Presenter ä¸€æ ·æŒæœ‰å¯¹ View çš„å¼•ç”¨</strong>ã€‚è¿™ä¹Ÿæ„å‘³ç€ MVP ä¸­æ‰€éœ€è¦çš„é‚£äº›æ¥å£ï¼Œéƒ½å¯ä»¥æ‰”æ‰äº†ã€‚</p><p>View è¿˜ä¼šé€šçŸ¥ ViewModel æœ‰å…³ä¸åŒçš„æ“ä½œã€‚å› æ­¤ï¼ŒMVVM æ¨¡å¼æ”¯æŒ View å’Œ ViewModel ä¹‹é—´çš„<strong>åŒå‘æ•°æ®ç»‘å®š</strong>ï¼Œå¹¶ä¸” View å’Œ ViewModel ä¹‹é—´å­˜åœ¨å¤šå¯¹ä¸€å…³ç³»ã€‚View å¼•ç”¨äº† ViewModelï¼Œä½†æ˜¯ ViewModel æ²¡æœ‰æœ‰å…³ View çš„ä¿¡æ¯ã€‚æ•°æ®çš„ä½¿ç”¨è€…åº”è¯¥äº†è§£ç”Ÿäº§è€…ï¼Œä½†æ˜¯ç”Ÿäº§è€…â€”â€”ä¹Ÿå°±æ˜¯ViewModelâ€”â€”ä¸çŸ¥é“ï¼Œä¹Ÿä¸åœ¨ä¹è°ä½¿ç”¨æ•°æ®ã€‚</p><p>å®ƒçš„æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://blog.cigis-cloud.com/design-pattern-1597991055.png" alt="MVVM ç»“æ„"></p><p>ä½¿ç”¨ Google å®˜æ–¹çš„ Android Architecture Components ï¼Œå¯ä»¥å¾ˆè½»æ¾åœ°å°† MVVM æ¨¡å¼åº”ç”¨åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨å®ƒæ¥å±•ç¤ºä¸€ä¸‹ MVVM çš„å®é™…çš„åº”ç”¨ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ‰’æ‰ synchronized çš„åº•è£¤</title>
      <link href="/2020-07-26/synchronized/"/>
      <url>/2020-07-26/synchronized/</url>
      
        <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/29866981">zhihu</a></p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> synchronized </tag>
            
            <tag> çº¿ç¨‹å®‰å…¨ </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter çš„ Isolate ä¸äº‹ä»¶å¾ªç¯æœºåˆ¶</title>
      <link href="/2020-07-23/flutter-isolate-and-event-loop/"/>
      <url>/2020-07-23/flutter-isolate-and-event-loop/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Dart ä¸­ï¼Œæ²¡æœ‰ã€å¤šçº¿ç¨‹ã€çš„æ¦‚å¿µï¼Œåœ¨ç»å¤§å¤šæ•°çš„å¼€å‘ä¸­ï¼Œåªä¼šç”¨åˆ° UI çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ Android ä¸­æ‰€è°“çš„ã€ä¸»çº¿ç¨‹ã€ã€‚</p><p>ä½†æ˜¯ Dart ç»™æˆ‘ä»¬æä¾›äº†å¼‚æ­¥ç¼–ç¨‹çš„æ–¹å¼ï¼Œæ¥è®©æˆ‘ä»¬ã€åŒæ­¥ã€åœ°ç¼–å†™ã€å¼‚æ­¥ã€çš„ä»£ç ã€‚ä¹Ÿå³<code>await/async</code>å…³é”®å­—ã€‚åœ¨è¿è¡Œä¸€äº›ä»£ç æ—¶ï¼ŒUI çº¿ç¨‹è¿˜ä¼šç»§ç»­æ¸²æŸ“ Widget Treeï¼Œä¸ä¼šå¡æ­»ã€‚</p><p>é‚£ä¹ˆå•çº¿ç¨‹çš„ Dart æ˜¯å¦‚ä½•å®ç°è¿™ç§çœ‹èµ·æ¥åƒã€å¤šçº¿ç¨‹ã€çš„æœºåˆ¶çš„å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬è¦å…ˆä»‹ç»ä¸€ä¸ªæ¦‚å¿µï¼šIsolateã€‚</p><span id="more"></span><h2 id="Isolate"><a href="#Isolate" class="headerlink" title="Isolate"></a>Isolate</h2><p>æ¯ä¸€ä¸ª Isolate éƒ½æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œä»¥åŠä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥è¿è¡Œ event loopã€‚</p><p>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Flutter åº”ç”¨åªéœ€è¦ä¸€ä¸ª Isolate å°±å¯ä»¥äº†ï¼Œä½†å¦‚æœä½ æœ‰åºå¤§çš„è®¡ç®—éœ€æ±‚ï¼Œå¤§åˆ°æœ‰å¯èƒ½ä¼šé˜»ç¢åˆ° UI çº¿ç¨‹æ‰å¸§ï¼Œé‚£ä½ å°±å¾—åˆ›å»ºä¸€ä¸ªæ–°çš„ Isolate æ¥è¿›è¡Œè¿™äº›è®¡ç®—ã€‚</p><p>åˆ›å»ºæ–°çš„ Isolate åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹æ–¹å¼ï¼š</p><ul><li><code>Isolate.spawn()</code></li><li><code>compute()</code></li></ul><p>åˆ›å»ºå®Œæˆçš„æ–° Isolate æœ‰å®ƒè‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œå³ä¾¿æ˜¯å®ƒçš„åˆ›å»ºè€…ä¹Ÿæ— æ³•è®¿é—®è¿™éƒ¨åˆ†ç©ºé—´ã€‚è¿™ä¹Ÿæ˜¯ã€éš”ç¦»ã€çš„æ„ä¹‰æ‰€åœ¨ã€‚</p><p>å®é™…ä¸Šï¼Œè¦è®©å¤šä¸ª Isolate åˆä½œï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™éœ€è¦ç”¨åˆ°å®ƒçš„ SendPort å’Œ ReceivePortã€‚ä¸¾ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="dart">ReceivePort receivePort = ReceivePort();// åˆ›å»ºæ–°çš„ Isolateawait Isolate.spawn(complexCompute, receivePort.sendPort);SendPort sendPort = await receivePort.first;// æµçš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«æ”¶åˆ°åç›‘å¬ä¼šå…³é—­ï¼Œæ‰€ä»¥éœ€è¦æ–°æ‰“å¼€ä¸€ä¸ªReceivePortä»¥æ¥æ”¶ä¼ å…¥çš„æ¶ˆæ¯ReceivePort response = ReceivePort();int toBeComputed = 1;// ä»¥æ•°ç»„çš„å½¢å¼å°†å‚æ•°å’Œå‘é€æ–¹ä¼ å…¥ï¼Œæ–¹ä¾¿è¿›è¡Œæ•°æ®å›ä¼ sendPort.send([toBeComputed, response.sendPort]);int result = await response.first;setState(() &#123;    ...&#125;);</code></pre><p><code>complexCompute()</code>æ–¹æ³•å¿…é¡»æ˜¯ä¸ªé¡¶çº§æ–¹æ³•æˆ–è€…é™æ€æ–¹æ³•ï¼š</p><pre><code class="dart">void complexCompute(SendPort sendPort) async &#123;  ReceivePort port = ReceivePort();  sendPort.send(port.sendPort);  await for (var param in port) &#123;    int toBeComputed = param[0];    SendPort replyTo = param[1];    toBeComputed++;    replyTo.send(toBeComputed);  &#125;&#125;</code></pre><p>å½“ç„¶ï¼Œä¸Šé¢çš„è®¡ç®—ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ <code>compute()</code> æ¥è§£å†³ï¼š</p><pre><code class="dart">int result = await compute(anotherComplexCompute, 1);setState(( &#123;    ...&#125;));</code></pre><p>åŒæ ·åœ°ï¼Œ<code>anotherComplexCompute()</code> ä¹Ÿå¿…é¡»æ˜¯é¡¶çº§æ–¹æ³•ï¼š</p><pre><code class="dart">int anotherComplexCompute(int value) &#123;    return value + 1;&#125;</code></pre><h2 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h2><p>ä¸Šé¢è®²å®Œäº† Isolate æœºåˆ¶ï¼Œä¸‹é¢å°±è¯¥è®²è®²å¼‚æ­¥ä»£ç æ˜¯å¦‚ä½•è¢«è¿è¡Œèµ·æ¥çš„ã€‚</p><p>Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ä¸ Android ä¸­çš„ Looper ç±»ä¼¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android å¸ƒå±€ä¼˜åŒ–</title>
      <link href="/2020-07-16/layout-optimization/"/>
      <url>/2020-07-16/layout-optimization/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/leipDao/p/8981687.html">https://www.cnblogs.com/leipDao/p/8981687.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¢é˜Ÿç®¡ç†é¢è¯•</title>
      <link href="/2020-06-16/manager-job-interview/"/>
      <url>/2020-06-16/manager-job-interview/</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œå‡†å¤‡äº†ä¸€äº›ç®¡ç†èŒä½ç›¸å…³çš„é¢è¯•é¢˜ã€‚</p><span id="more"></span><h3 id="1-ä¹‹å‰çš„å…¬å¸çš„å›¢é˜Ÿæœ‰å¤šå°‘æŠ€æœ¯ã€äº§å“äººå‘˜ã€æµ‹è¯•äººå‘˜æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿ"><a href="#1-ä¹‹å‰çš„å…¬å¸çš„å›¢é˜Ÿæœ‰å¤šå°‘æŠ€æœ¯ã€äº§å“äººå‘˜ã€æµ‹è¯•äººå‘˜æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="1. ä¹‹å‰çš„å…¬å¸çš„å›¢é˜Ÿæœ‰å¤šå°‘æŠ€æœ¯ã€äº§å“äººå‘˜ã€æµ‹è¯•äººå‘˜æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿ"></a>1. ä¹‹å‰çš„å…¬å¸çš„å›¢é˜Ÿæœ‰å¤šå°‘æŠ€æœ¯ã€äº§å“äººå‘˜ã€æµ‹è¯•äººå‘˜æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿ</h3><p>ä¹‹å‰çš„å›¢é˜Ÿé‡Œæœ‰ 10 å Android å¼€å‘äººå‘˜ï¼Œäº§å“äººå‘˜æœ‰ 4 äººï¼Œä½†äº§å“æ˜¯ä¸€ä¸ªå•ç‹¬çš„éƒ¨é—¨ã€‚æµ‹è¯•äººå‘˜æœ‰ 4 äººã€‚æˆ‘ç®¡ç†çš„æ˜¯ Android çš„å¼€å‘äººå‘˜ï¼ŒåŒæ—¶è¿›è¡Œçš„é¡¹ç›®æœ€å¤šæœ‰ 4 ä¸ªã€‚</p><h3 id="2-ä½ å¦‚ä½•åº”å¯¹æœªè¿‡è¯•ç”¨æœŸçš„æŠ€æœ¯äººå‘˜ç¦»èŒï¼Ÿ"><a href="#2-ä½ å¦‚ä½•åº”å¯¹æœªè¿‡è¯•ç”¨æœŸçš„æŠ€æœ¯äººå‘˜ç¦»èŒï¼Ÿ" class="headerlink" title="2. ä½ å¦‚ä½•åº”å¯¹æœªè¿‡è¯•ç”¨æœŸçš„æŠ€æœ¯äººå‘˜ç¦»èŒï¼Ÿ"></a>2. ä½ å¦‚ä½•åº”å¯¹æœªè¿‡è¯•ç”¨æœŸçš„æŠ€æœ¯äººå‘˜ç¦»èŒï¼Ÿ</h3><p>å¦‚æœä»–çš„æ‰‹é‡Œæœ‰éœ€æ±‚æ¯”è¾ƒç´§æ€¥çš„ä»£ç ï¼Œæˆ‘ä¼šæŠŠä»–çš„ä»£ç é¦–å…ˆè¿›è¡Œ Reviewï¼ŒæŸ¥çœ‹è¿›åº¦ï¼Œç„¶åæŒ‡æ´¾ç»™å¯¹åº”çš„äººæ‰‹ï¼ŒåŒæ—¶ç«‹åˆ»é€šçŸ¥äººèµ„éƒ¨é—¨è¿›è¡Œæ‹›è˜ã€‚</p><h3 id="3-ä½ åœ¨é¡¹ç›®å½“ä¸­ç¢°åˆ°çš„æœ€å¤§å›°éš¾æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#3-ä½ åœ¨é¡¹ç›®å½“ä¸­ç¢°åˆ°çš„æœ€å¤§å›°éš¾æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="3. ä½ åœ¨é¡¹ç›®å½“ä¸­ç¢°åˆ°çš„æœ€å¤§å›°éš¾æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è§£å†³ï¼Ÿ"></a>3. ä½ åœ¨é¡¹ç›®å½“ä¸­ç¢°åˆ°çš„æœ€å¤§å›°éš¾æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</h3><p>é¡¹ç›®ä¸­æœ‰å¾ˆå¤šä¹‹å‰åŒäº‹ç•™ä¸‹å¤§é‡ä»£ç ï¼Œå†™å¾—æ¯«æ— ç« æ³•ï¼Œå·²ç»é—ç•™å¾ˆä¹…ï¼Œè€Œä¸”æ²¡æœ‰æ³¨é‡Šï¼Œåœ¨ä»£ç é‡æ„æ—¶é‡åˆ°äº†å¾ˆå¤§çš„å›°éš¾ã€‚</p><p>é‡æ„æ—¶å®šåˆ¶çš„æ–¹æ¡ˆæ˜¯ç»„ä»¶åŒ–ï¼Œæ‹†ä¸ºäº†å››å±‚ï¼Œåˆ†åˆ«æ˜¯å¸¸è§„ä¸šåŠ¡ç»„ä»¶å±‚ï¼ˆç™»å½•ç•Œé¢ã€å¸‚åœºç•Œé¢ã€æˆ‘çš„ç•Œé¢ã€ä¸‹è½½ç•Œé¢ç­‰ï¼‰ã€æ ¸å¿ƒç®¡ç†å±‚ï¼ˆç»„ä»¶ç”Ÿå‘½å‘¨æœŸã€è·¯ç”±æœåŠ¡ç­‰ï¼‰ã€åŸºç¡€ä¸šåŠ¡å±‚ï¼ˆåˆ†äº«ã€æ¨é€ã€ä¸‹è½½ç­‰ï¼‰ã€åŸºç¡€åŠŸèƒ½å±‚ï¼ˆæ—¥å¿—ã€ç½‘ç»œã€å·¥å…·ç±»ç­‰ï¼‰</p><p>æœ€åçš„è§£å†³åŠæ³•æ˜¯å…ˆå°†è¿™äº›é—ç•™ä»£ç å…¨éƒ¨åŒ…è£…èµ·æ¥ï¼Œç§»åŠ¨åˆ°æœ€åº•å±‚ - ç‰¹æ®Šå±‚ï¼Œå…ˆè®©é¡¹ç›®å¯ä»¥ç»§ç»­è¿è¡Œï¼Œç„¶åå®‰æ’æ‰€æœ‰äººé˜…è¯»è¿™éƒ¨åˆ†ä»£ç ï¼Œæ¯ä¸ªäººå¯¹å…¶è¿›è¡Œåˆ†ç±»ï¼Œæ˜¯å±äºå“ªä¸€å±‚ï¼Œç„¶åç§»åŠ¨åˆ°å“ªä¸€å±‚ã€‚åŒæ—¶å¯¹ä»£ç åŠ›æ‰€èƒ½åŠåœ°åŠ å…¥æ³¨é‡Šï¼Œåœ¨ä¿è¯æ—  BUG çš„æƒ…å†µä¸‹ï¼Œåˆå¹¶éƒ¨åˆ†ä»£ç ã€‚</p><h3 id="4-å›¢é˜Ÿä¸­æŠ€æœ¯äººå‘˜æŠ€æœ¯å‚å·®ä¸é½ï¼Œä½ å¦‚ä½•ä¿è¯å›¢é˜Ÿå¼€å‘äº§å“çš„è´¨é‡ï¼Ÿ"><a href="#4-å›¢é˜Ÿä¸­æŠ€æœ¯äººå‘˜æŠ€æœ¯å‚å·®ä¸é½ï¼Œä½ å¦‚ä½•ä¿è¯å›¢é˜Ÿå¼€å‘äº§å“çš„è´¨é‡ï¼Ÿ" class="headerlink" title="4. å›¢é˜Ÿä¸­æŠ€æœ¯äººå‘˜æŠ€æœ¯å‚å·®ä¸é½ï¼Œä½ å¦‚ä½•ä¿è¯å›¢é˜Ÿå¼€å‘äº§å“çš„è´¨é‡ï¼Ÿ"></a>4. å›¢é˜Ÿä¸­æŠ€æœ¯äººå‘˜æŠ€æœ¯å‚å·®ä¸é½ï¼Œä½ å¦‚ä½•ä¿è¯å›¢é˜Ÿå¼€å‘äº§å“çš„è´¨é‡ï¼Ÿ</h3><p>å…ˆé€šè¿‡ä¸€æ®µæ—¶é—´çš„ Code Review å‘ç°å›¢é˜Ÿäººå‘˜çš„ç¼–ç æ°´å¹³åŠæœ‰æ•ˆä»£ç æ•°é‡ï¼Œå¯¹å¼€å‘äººå‘˜èƒ½åŠ›åšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚ç„¶åä¸æ°´å¹³è¾ƒä½çš„å›¢é˜Ÿäººå‘˜è¿›è¡Œå•ç‹¬çš„æ²Ÿé€šï¼ŒæŒ‡å‡ºä»£ç ä¸­çš„é”™è¯¯ï¼Œå¹¶æä¾›ä¸€äº›æ€è·¯å’Œä¹ æƒ¯ä¸Šçš„å¸®åŠ©ï¼›åŒæ—¶å®‰æ’å•å…ƒæµ‹è¯•ï¼Œå¯¹æ¯ä¸€ä¸ªå®Œæˆçš„å°æ¨¡å—è¿›è¡Œæµ‹è¯•ï¼Œè®©æ‰€æœ‰çš„ä»£ç éƒ½å¿…é¡»åœ¨é€šè¿‡æµ‹è¯•çš„æƒ…å†µä¸‹äº¤ä»˜è‡³æµ‹è¯•éƒ¨é—¨ã€‚</p><h3 id="5-ç°åœ¨å›¢é˜Ÿåªæœ‰ä½ ä¸€ä¸ªäººï¼Œä½†æ˜¯å…¬å¸è¦æ±‚åœ¨-2-ä¸ªæœˆä¹‹å†…ä¸Šçº¿ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½ æœ‰ä»€ä¹ˆå·¥ä½œæ€è·¯ï¼Ÿ"><a href="#5-ç°åœ¨å›¢é˜Ÿåªæœ‰ä½ ä¸€ä¸ªäººï¼Œä½†æ˜¯å…¬å¸è¦æ±‚åœ¨-2-ä¸ªæœˆä¹‹å†…ä¸Šçº¿ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½ æœ‰ä»€ä¹ˆå·¥ä½œæ€è·¯ï¼Ÿ" class="headerlink" title="5. ç°åœ¨å›¢é˜Ÿåªæœ‰ä½ ä¸€ä¸ªäººï¼Œä½†æ˜¯å…¬å¸è¦æ±‚åœ¨ 2 ä¸ªæœˆä¹‹å†…ä¸Šçº¿ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½ æœ‰ä»€ä¹ˆå·¥ä½œæ€è·¯ï¼Ÿ"></a>5. ç°åœ¨å›¢é˜Ÿåªæœ‰ä½ ä¸€ä¸ªäººï¼Œä½†æ˜¯å…¬å¸è¦æ±‚åœ¨ 2 ä¸ªæœˆä¹‹å†…ä¸Šçº¿ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½ æœ‰ä»€ä¹ˆå·¥ä½œæ€è·¯ï¼Ÿ</h3><p>é€šè¿‡ç†Ÿäººæˆ–è€…æ‹›è˜å¹³å°ï¼Œå¿«é€Ÿæ‹›è˜å›¢é˜Ÿäººå‘˜ï¼Œçœ‹åŠŸèƒ½çš„ä½“é‡é€‰æ‹©æ‹›è˜çš„äººæ•°ï¼›å¦å¤–å¯ä»¥ä½¿ç”¨å¤–åŒ…æœåŠ¡ï¼Œæ”¯ä»˜å°‘é‡é‡‘é’±çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå®Œæˆå·¥ä½œã€‚å¦‚æœè¯¥åŠŸèƒ½æœ‰å¤§é‡çš„åæœŸç»´æŠ¤éœ€æ±‚ï¼Œå†ç»§ç»­æ‹›è˜å›¢é˜Ÿäººå‘˜ï¼Œè¿›è¡Œä»£ç äº¤æ¥å’ŒåæœŸç»´æŠ¤ã€‚</p><h3 id="6-åœ¨ä¹‹å‰çš„å¼€å‘ä¸­ä½¿ç”¨åˆ°é‚£äº›æ–°æŠ€æœ¯ï¼Œå¯¹è¿™ç§æŠ€æœ¯æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ"><a href="#6-åœ¨ä¹‹å‰çš„å¼€å‘ä¸­ä½¿ç”¨åˆ°é‚£äº›æ–°æŠ€æœ¯ï¼Œå¯¹è¿™ç§æŠ€æœ¯æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ" class="headerlink" title="6. åœ¨ä¹‹å‰çš„å¼€å‘ä¸­ä½¿ç”¨åˆ°é‚£äº›æ–°æŠ€æœ¯ï¼Œå¯¹è¿™ç§æŠ€æœ¯æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ"></a>6. åœ¨ä¹‹å‰çš„å¼€å‘ä¸­ä½¿ç”¨åˆ°é‚£äº›æ–°æŠ€æœ¯ï¼Œå¯¹è¿™ç§æŠ€æœ¯æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ</h3><p>åœ¨ Kotlin åˆšåº”ç”¨äº Android æ—¶ä½¿ç”¨è¿‡ Kotlinï¼Œå®ƒæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œåœ¨éç©ºæ£€æŸ¥ä¸Šæœ‰æ¯”è¾ƒå¼ºçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè®©å¼€å‘äººå‘˜åœ¨æé«˜æ•ˆç‡çš„åŒæ—¶ï¼Œè®©ä»£ç çš„ç¨³å¥æ€§æ›´å¥½ï¼›åœ¨åæœŸ Kotlin æ¨å‡ºåç¨‹æ—¶ä¹Ÿå°†åç¨‹åº”ç”¨åˆ°äº†å¼€å‘ä¸­ï¼Œä½¿ä»£ç ç¼–å†™èµ·æ¥æ›´åƒæ˜¯ã€åŒæ­¥ã€çš„ã€‚</p><h3 id="7-è§‰å¾—è‡ªèº«æœ‰å“ªäº›ä¼˜ç‚¹å’Œä¸è¶³ï¼Œæœ‰å“ªäº›éœ€è¦æå‡çš„åœ°æ–¹ï¼Ÿ"><a href="#7-è§‰å¾—è‡ªèº«æœ‰å“ªäº›ä¼˜ç‚¹å’Œä¸è¶³ï¼Œæœ‰å“ªäº›éœ€è¦æå‡çš„åœ°æ–¹ï¼Ÿ" class="headerlink" title="7. è§‰å¾—è‡ªèº«æœ‰å“ªäº›ä¼˜ç‚¹å’Œä¸è¶³ï¼Œæœ‰å“ªäº›éœ€è¦æå‡çš„åœ°æ–¹ï¼Ÿ"></a>7. è§‰å¾—è‡ªèº«æœ‰å“ªäº›ä¼˜ç‚¹å’Œä¸è¶³ï¼Œæœ‰å“ªäº›éœ€è¦æå‡çš„åœ°æ–¹ï¼Ÿ</h3><p>é€šè¿‡å€™é€‰äººçš„å›ç­”æ¥ç¡®å®šå€™é€‰äººçš„å“è¡Œï¼Œæ˜¯å¦è¯šå®ã€è°¦é€Šä¸ºäººç­‰å“è¡Œã€‚</p><h3 id="8-å¯¹æ–°äººæ€ä¹ˆåŸ¹è®­å’Œç®¡ç†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Ÿ"><a href="#8-å¯¹æ–°äººæ€ä¹ˆåŸ¹è®­å’Œç®¡ç†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Ÿ" class="headerlink" title="8. å¯¹æ–°äººæ€ä¹ˆåŸ¹è®­å’Œç®¡ç†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Ÿ"></a>8. å¯¹æ–°äººæ€ä¹ˆåŸ¹è®­å’Œç®¡ç†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Ÿ</h3><p>é€šè¿‡å€™é€‰äººçš„å›ç­”ï¼Œè€ƒå¯Ÿå…¶æœ‰æ²¡æœ‰çœŸæ­£çš„å¸¦é˜Ÿç»éªŒï¼Œå›¢é˜Ÿå»ºè®¾çš„èƒ½åŠ›ã€‚</p><h3 id="9-åœ¨æŠ€æœ¯æ¶æ„ï¼ŒæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œä¸»è¦è€ƒè™‘å“ªæ–¹é¢çš„å› ç´ ï¼Œæœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ"><a href="#9-åœ¨æŠ€æœ¯æ¶æ„ï¼ŒæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œä¸»è¦è€ƒè™‘å“ªæ–¹é¢çš„å› ç´ ï¼Œæœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ" class="headerlink" title="9. åœ¨æŠ€æœ¯æ¶æ„ï¼ŒæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œä¸»è¦è€ƒè™‘å“ªæ–¹é¢çš„å› ç´ ï¼Œæœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ"></a>9. åœ¨æŠ€æœ¯æ¶æ„ï¼ŒæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œä¸»è¦è€ƒè™‘å“ªæ–¹é¢çš„å› ç´ ï¼Œæœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ</h3><p>è€ƒæŸ¥æŠ€æœ¯æ¶æ„èƒ½åŠ›ï¼Œæ¯”å¦‚èƒ½å¦æ ¹æ®ä¸šåŠ¡ä¸åŒé€‰æ‹©ä¸åŒçš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œæœ‰æ²¡æœ‰è€ƒè™‘å¹¶å‘ã€åˆ†åº“åˆ†è¡¨ç­‰æ–¹é¢ã€‚</p><h3 id="10-å¯¹æœªæ¥çš„èŒä¸šè§„åˆ’ï¼Ÿ"><a href="#10-å¯¹æœªæ¥çš„èŒä¸šè§„åˆ’ï¼Ÿ" class="headerlink" title="10. å¯¹æœªæ¥çš„èŒä¸šè§„åˆ’ï¼Ÿ"></a>10. å¯¹æœªæ¥çš„èŒä¸šè§„åˆ’ï¼Ÿ</h3><p>è€ƒå¯Ÿå€™é€‰äººå¯¹è‡ªå·±çš„æœªæ¥æœ‰æ²¡æœ‰æ¸…æ™°çš„è®¡åˆ’å’Œç›®æ ‡ï¼Œå¦‚æœä¸€ä¸ªæŠ€æœ¯ç»ç†ã€CTOå¯¹è‡ªå·±æœªæ¥æ²¡æœ‰æ¸…æ™°çš„è®¤è¯†çš„è¯ï¼Œå•çº¯æ˜¯ä¸ºäº†æŒ£é’±è€Œå·¥ä½œçš„è¯ï¼Œå»ºè®®æ…é‡è€ƒè™‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> èŒåœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Manager&#39;s Path</title>
      <link href="/2020-06-04/the-managers-path/"/>
      <url>/2020-06-04/the-managers-path/</url>
      
        <content type="html"><![CDATA[<p>ã€ŠThe Managerâ€™s Pathã€‹å…¨æœ¬ï¼Œæ­£åœ¨ç¿»è¯‘ä¸­ã€‚</p><span id="more"></span><h3 id="è‹±æ–‡ç‰ˆç›®å½•ï¼š"><a href="#è‹±æ–‡ç‰ˆç›®å½•ï¼š" class="headerlink" title="è‹±æ–‡ç‰ˆç›®å½•ï¼š"></a>è‹±æ–‡ç‰ˆç›®å½•ï¼š</h3><ul><li><a href="/the-managers-path/the-managers-path-intro/">Introduction</a></li><li><a href="/the-managers-path-chapter-1/">Chapter 1. Management 101</a></li><li><a href="/the-managers-path-chapter-2/">Chapter 2. Mentoring</a></li><li><a href="/the-managers-path-chapter-3/">Chapter 3. Tech Lead</a></li><li><a href="/the-managers-path-chapter-4/">Chapter 4. Managing People</a></li><li><a href="/the-managers-path-chapter-5/">Chapter 5. Managing a Team</a></li><li><a href="/the-managers-path-chapter-6/">Chapter 6. Managing Multiple Teams</a></li><li><a href="/the-managers-path-chapter-7/">Chapter 7. Managing Managers</a></li><li><a href="/the-managers-path-chapter-8/">Chapter 8. The Big Leagues</a></li><li><a href="/the-managers-path-chapter-9/">Chapter 9. Bootstrapping Culture</a></li><li><a href="/the-managers-path-chapter-10/">Chapter 10. Conclusion</a></li></ul><h3 id="ä¸­æ–‡ç‰ˆç›®å½•ï¼š"><a href="#ä¸­æ–‡ç‰ˆç›®å½•ï¼š" class="headerlink" title="ä¸­æ–‡ç‰ˆç›®å½•ï¼š"></a>ä¸­æ–‡ç‰ˆç›®å½•ï¼š</h3><ul><li><a href="/the-managers-path-intro-zh/">åºè¨€</a></li><li><a href="/the-managers-path-chapter-1-zh/">ç¬¬ä¸€ç« ï¼šç®¡ç† 101</a></li><li><a href="/the-managers-path-chapter-2-zh/">ç¬¬äºŒç« ï¼šå¯¼å¸ˆ</a></li><li><a href="/the-managers-path-chapter-3-zh/">ç¬¬ä¸‰ç« ï¼šæŠ€æœ¯é¢†å¯¼</a></li><li><a href="/the-managers-path-chapter-4-zh/">ç¬¬å››ç« ï¼šäººå‘˜ç®¡ç†</a></li><li><a href="/the-managers-path-chapter-5-zh/">ç¬¬äº”ç« ï¼šå›¢é˜Ÿç®¡ç†</a></li><li><a href="/the-managers-path-chapter-6-zh/">ç¬¬å…­ç« ï¼šå¤šå›¢é˜Ÿç®¡ç†</a></li><li><a href="/the-managers-path-chapter-7-zh/">ç¬¬ä¸ƒç« ï¼šç®¡ç†ç®¡ç†äººå‘˜</a></li><li><a href="/the-managers-path-chapter-8-zh/">ç¬¬å…«ç« ï¼šå¤§è”ç›Ÿ</a></li><li><a href="/the-managers-path-chapter-9-zh/">ç¬¬ä¹ç« ï¼šå¼•å¯¼æ–‡åŒ–</a></li><li><a href="/the-managers-path-chapter-10-zh/">ç¬¬åç« ï¼šæ€»ç»“</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Book </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¹¦ç± </tag>
            
            <tag> ç¿»è¯‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Activity å¯åŠ¨æµç¨‹åˆ†æ</title>
      <link href="/2020-05-27/activity-start-process/"/>
      <url>/2020-05-27/activity-start-process/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¤šäººå¯¹ Activity å¯åŠ¨è¿‡ç¨‹ä¸ç”šäº†è§£ï¼Œæˆ‘ä»¬æ¥æ‹ä¸€ä¸‹å®ƒçš„å¯åŠ¨æµç¨‹ã€‚</p><span id="more"></span><p>å¯åŠ¨ Activity æ— éæ˜¯ä¸‹é¢å‡ ç§åœºæ™¯ï¼š</p><ol><li>ä»åº”ç”¨ä¸­å¯åŠ¨è‡ªèº« Activity</li><li>ä»åº”ç”¨ä¸­å¯åŠ¨å…¶ä»–åº”ç”¨ä¸­çš„ Activity</li><li>ä»æ¡Œé¢ç‚¹å‡»åº”ç”¨å›¾æ ‡å¯åŠ¨ Activity</li></ol><p>ç†è®ºä¸Šæ¥è¯´ï¼Œæ¡Œé¢æ˜¯ä¸€ä¸ª<strong>å•ç‹¬è¿›ç¨‹</strong>ï¼Œç‚¹å‡»åº”ç”¨å›¾æ ‡æ‰“å¼€æ–°çš„ Activity å±äºä¸Šè¿°ç¬¬2ç§æƒ…å†µã€‚<br>æ‰€ä»¥ï¼Œä¸Šé¢çš„3ç§æƒ…å†µï¼Œå¯ä»¥å½’ç»“ä¸ºä¸¤ç±»ï¼š</p><ol><li>å¯åŠ¨è‡ªèº«è¿›ç¨‹å†…çš„ Activity</li><li>å¯åŠ¨å…¶ä»–è¿›ç¨‹å†…çš„ Activity</li></ol><p>æˆ‘ä»¬æ¥çœ‹çœ‹ Android ç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°çš„ã€‚äº†è§£å¯åŠ¨è¿‡ç¨‹ï¼Œéœ€è¦ç†è§£ ActvitiyTaskManagerService å’Œ ActivityThread çš„åŠŸèƒ½ï¼Œä»¥åŠ Binder é€šè®¯æœºåˆ¶ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢ä¼šæ…¢æ…¢è®²åˆ°ã€‚</p><blockquote><p>æ³¨ï¼šæœ¬æ–‡æºä»£ç åŸºäº Android API 29</p></blockquote><h2 id="æºè¿›ç¨‹ä¸­çš„æµç¨‹"><a href="#æºè¿›ç¨‹ä¸­çš„æµç¨‹" class="headerlink" title="æºè¿›ç¨‹ä¸­çš„æµç¨‹"></a>æºè¿›ç¨‹ä¸­çš„æµç¨‹</h2><p>å¯åŠ¨è‡ªèº«è¿›ç¨‹çš„çš„ Activity å°±æ˜¯åœ¨ä»£ç ä¸­è°ƒç”¨<code>startActivity()</code>æˆ–<code>startActivityForResult()</code>æ¥å¯åŠ¨ç›®æ ‡ Activityã€‚æˆ‘ä»¬æ¥çœ‹çœ‹<code>startActivity()</code>å’Œ<code>startActivityForResult()</code>éƒ½åšäº†ä»€ä¹ˆã€‚</p><pre><code class="java">@Overridepublic void startActivity(Intent intent, @Nullable Bundle options) &#123;    if (options != null) &#123;        startActivityForResult(intent, -1, options);    &#125; else &#123;        // Note we want to go through this call for compatibility with        // applications that may have overridden the method.        startActivityForResult(intent, -1);    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè°ƒç”¨äº†<code>startActivityForResult()</code>æ–¹æ³•ï¼Œåªä¸è¿‡ä¼ å…¥äº†<code>requestCode</code>ä¸º<code>-1</code>ï¼Œè¡¨ç¤ºã€æˆ‘ä¸è¦ç»“æœã€ã€‚</p><pre><code class="java">public void startActivityForResult(@RequiresPermission Intent intent, int requestCode,            @Nullable Bundle options) &#123;    if (mParent == null) &#123;        options = transferSpringboardActivityOptions(options);        Instrumentation.ActivityResult ar =            mInstrumentation.execStartActivity(                this, mMainThread.getApplicationThread(), mToken, this,                intent, requestCode, options);        if (ar != null) &#123;            mMainThread.sendActivityResult(                mToken, mEmbeddedID, requestCode, ar.getResultCode(),                ar.getResultData());        &#125;        if (requestCode &gt;= 0) &#123;            // If this start is requesting a result, we can avoid making            // the activity visible until the result is received.  Setting            // this code during onCreate(Bundle savedInstanceState) or onResume() will keep the            // activity hidden during this time, to avoid flickering.            // This can only be done when a result is requested because            // that guarantees we will get information back when the            // activity is finished, no matter what happens to it.            mStartedActivity = true;        &#125;        cancelInputsAndStartExitTransition(options);        // TODO Consider clearing/flushing other event sources and events for child windows.    &#125; else &#123;        if (options != null) &#123;            mParent.startActivityFromChild(this, intent, requestCode, options);        &#125; else &#123;            // Note we want to go through this method for compatibility with            // existing applications that may have overridden it.            mParent.startActivityFromChild(this, intent, requestCode);        &#125;    &#125;&#125;</code></pre><p><code>startActivityForResult()</code>æ–¹æ³•ä¼šå…ˆåˆ¤æ–­<code>mParent</code>çš„å€¼æ˜¯å¦ä¸ºç©ºï¼Œè¿™ä¸ª<code>mParent</code>ä¹Ÿæ˜¯ä¸€ä¸ª Activity ç±»å‹çš„å˜é‡ï¼Œåœ¨<code>Activity.attach()</code>æ—¶è¢«èµ‹å€¼ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨ Activity æ—¶å¿…ç„¶ä¸ºç©ºã€‚æ¥ä¸‹æ¥å°±å°†ä»»åŠ¡è½¬äº¤ç»™äº†<code>Instrumentation.execStartActivity()</code>æ–¹æ³•ã€‚</p><p>mInstrumentation ä¹Ÿæ˜¯åœ¨<code>Activity.attach()</code>ä¸­è¢«åˆå§‹åŒ–ï¼Œç”± ActivityThread ä¼ å…¥ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„<code>execStartActivity()</code>æ–¹æ³•ï¼š</p><pre><code class="java">public ActivityResult execStartActivity(        Context who, IBinder contextThread, IBinder token, Activity target,        Intent intent, int requestCode, Bundle options) &#123;    ...    try &#123;        ...        int result = ActivityTaskManager.getService()            .startActivity(whoThread, who.getBasePackageName(), intent,                    intent.resolveTypeIfNeeded(who.getContentResolver()),                    token, target != null ? target.mEmbeddedID : null,                    requestCode, 0, null, options);        checkStartActivityResult(result, intent);    &#125; catch (RemoteException e) &#123;        throw new RuntimeException(&quot;Failure from system&quot;, e);    &#125;    return null;&#125;</code></pre><p>åœ¨è¿™é‡Œï¼ŒInstumentation å°†ä»»åŠ¡é€šè¿‡ Binder é€šä¿¡çš„æ–¹å¼äº¤ç»™äº† ActivityTaskManagerServiceï¼ˆä¸‹ç§°ATMSï¼‰ã€‚ç›²çŒœè¿™é‡Œæ˜¯è¦å…ˆåˆ¤æ–­è¦å¯åŠ¨çš„ Activity æ˜¯å¦å·²ç»æœ‰äº†ç›¸åº”ä»»åŠ¡æ ˆï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±è¦åˆ›å»ºæ–°çš„ä»»åŠ¡æ ˆï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç æ¥çœ‹çœ‹å®ƒæ˜¯å¦æ˜¯è¿™ä¹ˆåšçš„ã€‚</p><h2 id="ActivityTaskManagerService-ä¸­çš„æµç¨‹"><a href="#ActivityTaskManagerService-ä¸­çš„æµç¨‹" class="headerlink" title="ActivityTaskManagerService ä¸­çš„æµç¨‹"></a>ActivityTaskManagerService ä¸­çš„æµç¨‹</h2><pre><code class="java">// com.android.server.wm.ActivityTaskManagerService.java@Overridepublic final int startActivity(IApplicationThread caller, String callingPackage,        Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,        int startFlags, ProfilerInfo profilerInfo, Bundle bOptions) &#123;    return startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,            resultWho, requestCode, startFlags, profilerInfo, bOptions,            UserHandle.getCallingUserId());&#125;@Overridepublic int startActivityAsUser(IApplicationThread caller, String callingPackage,        Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,        int startFlags, ProfilerInfo profilerInfo, Bundle bOptions, int userId) &#123;    return startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,            resultWho, requestCode, startFlags, profilerInfo, bOptions, userId,            true /*validateIncomingUser*/);&#125;int startActivityAsUser(IApplicationThread caller, String callingPackage,        Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,        int startFlags, ProfilerInfo profilerInfo, Bundle bOptions, int userId,        boolean validateIncomingUser) &#123;    enforceNotIsolatedCaller(&quot;startActivityAsUser&quot;);    userId = getActivityStartController().checkTargetUser(userId, validateIncomingUser,            Binder.getCallingPid(), Binder.getCallingUid(), &quot;startActivityAsUser&quot;);    // TODO: Switch to user app stacks here.    return getActivityStartController().obtainStarter(intent, &quot;startActivityAsUser&quot;)            .setCaller(caller)            .setCallingPackage(callingPackage)            .setResolvedType(resolvedType)            .setResultTo(resultTo)            .setResultWho(resultWho)            .setRequestCode(requestCode)            .setStartFlags(startFlags)            .setProfilerInfo(profilerInfo)            .setActivityOptions(bOptions)            .setMayWait(userId)            .execute();&#125;ActivityStartController getActivityStartController() &#123;    return mActivityStartController;&#125;</code></pre><p>ActivityStartController æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œç”¨æ¥ä»£ç†çš„ Activity å¯åŠ¨ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯æŠŠ Activity çš„å¯åŠ¨è¯·æ±‚è¿›è¡Œæ•´ç†ï¼Œå¹¶äº¤ç»™ ActivityStarter ç±»ã€‚å®ƒçš„<code>obtainStarter()</code>æ–¹æ³•å°±æ˜¯è·å–ä¸€ä¸ª ActivityStarter çš„å®ä¾‹ã€‚å¯è§ ActivityStarter ä½¿ç”¨çš„æ˜¯ Builder æ¨¡å¼ï¼Œæœ€ç»ˆçš„æ‰§è¡Œåœ¨å®ƒçš„<code>execute()</code>æ–¹æ³•ä¸­ï¼š</p><pre><code class="java">int execute() &#123;    try &#123;        if (mRequest.mayWait) &#123;            return startActivityMayWait(mRequest.caller, mRequest.callingUid,                    mRequest.callingPackage, mRequest.realCallingPid, mRequest.realCallingUid,                    mRequest.intent, mRequest.resolvedType,                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,                    mRequest.resultWho, mRequest.requestCode, mRequest.startFlags,                    mRequest.profilerInfo, mRequest.waitResult, mRequest.globalConfig,                    mRequest.activityOptions, mRequest.ignoreTargetSecurity, mRequest.userId,                    mRequest.inTask, mRequest.reason,                    mRequest.allowPendingRemoteAnimationRegistryLookup,                    mRequest.originatingPendingIntent, mRequest.allowBackgroundActivityStart);        &#125; else &#123;            return startActivity(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,                    mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,                    mRequest.resultWho, mRequest.requestCode, mRequest.callingPid,                    mRequest.callingUid, mRequest.callingPackage, mRequest.realCallingPid,                    mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,                    mRequest.ignoreTargetSecurity, mRequest.componentSpecified,                    mRequest.outActivity, mRequest.inTask, mRequest.reason,                    mRequest.allowPendingRemoteAnimationRegistryLookup,                    mRequest.originatingPendingIntent, mRequest.allowBackgroundActivityStart);        &#125;    &#125; finally &#123;        onExecutionComplete();    &#125;&#125;</code></pre><p>åœ¨ ActivityStarter ä¸­æœ‰ä¸ªå†…éƒ¨ç±» Requestï¼Œç”¨æ¥å­˜å‚¨ä¸€æ¬¡å¯åŠ¨è¯·æ±‚ï¼ŒåŒ…æ‹¬ä¼ é€’çš„ Intentã€è¯·æ±‚è€…çš„èº«ä»½ã€å¯åŠ¨æ¨¡å¼çš„ FLAGã€requestCode ç­‰ç­‰ã€‚è¿™é‡Œå•ç‹¬è®²ä¸€ä¸‹<code>Request.mayWait</code>å˜é‡ï¼Œè¿™ä¸ªå˜é‡è¡¨ç¤ºæ˜¯å¦è¦ç­‰å¾…å¯åŠ¨ç»“æœã€‚å½“è°ƒç”¨<code>Request.setMayWait()</code>æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªå€¼å°±ä¼šè¢«ç½®ä¸º<code>true</code>ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç é‡Œçœ‹åˆ°ï¼Œå®ƒçš„å€¼ä¸º<code>true</code>ï¼Œæ‰€ä»¥ä¼šç»§ç»­è°ƒç”¨<code>startActivityMayWait()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// com.android.server.wm.ActivityStarter.javaprivate int startActivityMayWait(IApplicationThread caller, int callingUid,        String callingPackage, int requestRealCallingPid, int requestRealCallingUid,        Intent intent, String resolvedType, IVoiceInteractionSession voiceSession,        IVoiceInteractor voiceInteractor, IBinder resultTo, String resultWho, int requestCode,        int startFlags, ProfilerInfo profilerInfo, WaitResult outResult,        Configuration globalConfig, SafeActivityOptions options, boolean ignoreTargetSecurity,        int userId, TaskRecord inTask, String reason,        boolean allowPendingRemoteAnimationRegistryLookup,        PendingIntentRecord originatingPendingIntent, boolean allowBackgroundActivityStart) &#123;    // ä¸€ç³»åˆ—åˆ¤æ–­ + åˆå§‹åŒ–    ...    ActivityInfo aInfo = mSupervisor.resolveActivity(intent, rInfo, startFlags, profilerInfo);    ...    synchronized (mService.mGlobalLock) &#123;        ...        int res = startActivity(caller, intent, ephemeralIntent, resolvedType, aInfo, rInfo,                voiceSession, voiceInteractor, resultTo, resultWho, requestCode, callingPid,                callingUid, callingPackage, realCallingPid, realCallingUid, startFlags, options,                ignoreTargetSecurity, componentSpecified, outRecord, inTask, reason,                allowPendingRemoteAnimationRegistryLookup, originatingPendingIntent,                allowBackgroundActivityStart);        ...        return res;    &#125;&#125;</code></pre><p><code>mSupervisor</code>æ˜¯ ActivityStackSupervisor ç±»ï¼Œä»å‘½åä¸Šçœ‹ï¼Œæ˜¯ç®¡ç† Activity æ ˆçš„ä¸€ä¸ªç±»ï¼Œä½†å…¶å®è¿™ä¸ªç±»åœ¨ä¸ä¹…çš„ç‰ˆæœ¬é‡Œï¼Œå¯èƒ½ä¼šè¢«åºŸé™¤æ‰ï¼ŒæŠŠå®ƒçš„åŠŸèƒ½éƒ½ç§»åŠ¨åˆ° ActivityLifeCycleã€AMS ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ç”¨å¤ªåœ¨æ„ï¼Œç»§ç»­å‘ä¸‹çœ‹<code>ActivityStarter.startActivity()</code>æ–¹æ³•ï¼š</p><pre><code class="java">private int startActivity(IApplicationThread caller, Intent intent, Intent ephemeralIntent,        String resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,        IBinder resultTo, String resultWho, int requestCode, int callingPid, int callingUid,        String callingPackage, int realCallingPid, int realCallingUid, int startFlags,        SafeActivityOptions options,        boolean ignoreTargetSecurity, boolean componentSpecified, ActivityRecord[] outActivity,        TaskRecord inTask, boolean allowPendingRemoteAnimationRegistryLookup,        PendingIntentRecord originatingPendingIntent, boolean allowBackgroundActivityStart) &#123;    ...    // å„ç§åˆ¤æ–­ä¸åˆå§‹åŒ–    ....    ActivityRecord r = new ActivityRecord(mService, callerApp, callingPid, callingUid,            callingPackage, intent, resolvedType, aInfo, mService.getGlobalConfiguration(),            resultRecord, resultWho, requestCode, componentSpecified, voiceSession != null,            mSupervisor, checkedOptions, sourceRecord);    if (outActivity != null) &#123;        outActivity[0] = r;    &#125;    ...    final int res = startActivity(r, sourceRecord, voiceSession, voiceInteractor, startFlags,            true /* doResume */, checkedOptions, inTask, outActivity, restrictedBgActivity);    mSupervisor.getActivityMetricsLogger().notifyActivityLaunched(res, outActivity[0]);    return res;&#125;private int startActivity(final ActivityRecord r, ActivityRecord sourceRecord,            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,            int startFlags, boolean doResume, ActivityOptions options, TaskRecord inTask,            ActivityRecord[] outActivity, boolean restrictedBgActivity) &#123;    int result = START_CANCELED;    final ActivityStack startedActivityStack;    try &#123;        mService.mWindowManager.deferSurfaceLayout();        result = startActivityUnchecked(r, sourceRecord, voiceSession, voiceInteractor,                startFlags, doResume, options, inTask, outActivity, restrictedBgActivity);    &#125; finally &#123;        ...    &#125;    return result;&#125;private int startActivityUnchecked(final ActivityRecord r, ActivityRecord sourceRecord,        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,        int startFlags, boolean doResume, ActivityOptions options, TaskRecord inTask,        ActivityRecord[] outActivity, boolean restrictedBgActivity) &#123;    ...    // å„ç§åˆ¤æ–­ä¸åˆå§‹åŒ–    reusedActivity = setTargetStackAndMoveToFrontIfNeeded(reusedActivity);    ...    mTargetStack.startActivityLocked(mStartActivity, topFocused, newTask, mKeepCurTransition,            mOptions);    ...    return START_SUCCESS;&#125;</code></pre><p>ä¸Šé¢æœ€åçš„ä»£ç ä¸­ï¼Œ<code>mTargetStack</code>æ˜¯ ActivityStack ç±»å‹çš„å˜é‡ï¼Œæ˜¯åœ¨<code>setTargetStackAndMoveToFrontIfNeeded()</code>æ–¹æ³•ä¸­è¢«èµ‹å€¼çš„ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹çœ‹<code>ActivityStack.startActivityLocked()</code>ï¼š</p><pre><code class="java">void startActivityLocked(ActivityRecord r, ActivityRecord focusedTopActivity,        boolean newTask, boolean keepCurTransition, ActivityOptions options) &#123;    TaskRecord rTask = r.getTaskRecord();    final int taskId = rTask.taskId;    final boolean allowMoveToFront = options == null || !options.getAvoidMoveToFront();    // mLaunchTaskBehind tasks get placed at the back of the task stack.    if (!r.mLaunchTaskBehind &amp;&amp; allowMoveToFront            &amp;&amp; (taskForIdLocked(taskId) == null || newTask)) &#123;        // Last activity in task had been removed or ActivityManagerService is reusing task.        // Insert or replace.        // Might not even be in.        insertTaskAtTop(rTask, r);    &#125;    TaskRecord task = null;    if (!newTask) &#123;        // å¦‚æœä¸æ˜¯æ–°çš„ä»»åŠ¡æ ˆï¼Œé‚£å°±æ‰¾åˆ°å®ƒæ‰€å±çš„ä»»åŠ¡æ ˆ        boolean startIt = true;        for (int taskNdx = mTaskHistory.size() - 1; taskNdx &gt;= 0; --taskNdx) &#123;            task = mTaskHistory.get(taskNdx);            if (task.getTopActivity() == null) &#123;                // All activities in task are finishing.                continue;            &#125;            if (task == rTask) &#123;                // æ‰¾åˆ°äº†å¯¹åº”çš„ TaskRecordï¼Œå¦‚æœå½“å‰ä»»åŠ¡æ ˆè¿˜æœªå¯¹ç”¨æˆ·å¯è§ï¼Œé‚£å°±åªæ·»åŠ ï¼Œä¸å¯åŠ¨                if (!startIt) &#123;                    if (DEBUG_ADD_REMOVE) Slog.i(TAG, &quot;Adding activity &quot; + r + &quot; to task &quot;                            + task, new RuntimeException(&quot;here&quot;).fillInStackTrace());                    r.createAppWindowToken();                    ActivityOptions.abort(options);                    return;                &#125;                break;            &#125; else if (task.numFullscreen &gt; 0) &#123;                startIt = false;            &#125;        &#125;    &#125;    // åœ¨æ ˆé¡¶æ”¾ç›®æ ‡ Activityï¼Œä¸‹ä¸€ä¸ªä¸ç”¨æˆ·äº¤äº’çš„ Activity å°±æ˜¯å®ƒ    // å¦‚æœä¸æŠŠç›®æ ‡ Activity æ”¾åˆ°æœ€å‰ï¼Œå°±ä¸è¦ç»™å®é™…çš„å½“å‰æœ€å‰çš„ Activity å‘é€ onUserLeaving æ¶ˆæ¯    final TaskRecord activityTask = r.getTaskRecord();    if (task == activityTask &amp;&amp; mTaskHistory.indexOf(task) != (mTaskHistory.size() - 1)) &#123;        mStackSupervisor.mUserLeaving = false;        if (DEBUG_USER_LEAVING) Slog.v(TAG_USER_LEAVING,                &quot;startActivity() behind front, mUserLeaving=false&quot;);    &#125;    task = activityTask;    // Slot the activity into the history stack and proceed    if (DEBUG_ADD_REMOVE) Slog.i(TAG, &quot;Adding activity &quot; + r + &quot; to stack to task &quot; + task,            new RuntimeException(&quot;here&quot;).fillInStackTrace());    // TODO: Need to investigate if it is okay for the controller to already be created by the    // time we get to this point. I think it is, but need to double check.    // Use test in b/34179495 to trace the call path.    if (r.mAppWindowToken == null) &#123;        r.createAppWindowToken();    &#125;    // å°† Activity ç§»åˆ° task æœ€å‰    task.setFrontOfTask();    // å¦‚æœ allowMoveToFront ä¸º falseï¼Œåˆ™ä¸éœ€è¦åˆ‡æ¢åŠ¨ç”»ï¼Œå› ä¸º Activity ä¸å¯è§    if ((!isHomeOrRecentsStack() || numActivities() &gt; 0) &amp;&amp; allowMoveToFront) &#123;        final DisplayContent dc = getDisplay().mDisplayContent;        if (DEBUG_TRANSITION) Slog.v(TAG_TRANSITION,                &quot;Prepare open transition: starting &quot; + r);        if ((r.intent.getFlags() &amp; Intent.FLAG_ACTIVITY_NO_ANIMATION) != 0) &#123;            dc.prepareAppTransition(TRANSIT_NONE, keepCurTransition);            mStackSupervisor.mNoAnimActivities.add(r);        &#125; else &#123;            int transit = TRANSIT_ACTIVITY_OPEN;            if (newTask) &#123;                if (r.mLaunchTaskBehind) &#123;                    transit = TRANSIT_TASK_OPEN_BEHIND;                &#125; else if (getDisplay().isSingleTaskInstance()) &#123;                    transit = TRANSIT_SHOW_SINGLE_TASK_DISPLAY;                &#125; else &#123;                    // If a new task is being launched, then mark the existing top activity as                    // supporting picture-in-picture while pausing only if the starting activity                    // would not be considered an overlay on top of the current activity                    // (eg. not fullscreen, or the assistant)                    if (canEnterPipOnTaskSwitch(focusedTopActivity,                            null /* toFrontTask */, r, options)) &#123;                        focusedTopActivity.supportsEnterPipOnTaskSwitch = true;                    &#125;                    transit = TRANSIT_TASK_OPEN;                &#125;            &#125;            dc.prepareAppTransition(transit, keepCurTransition);            mStackSupervisor.mNoAnimActivities.remove(r);        &#125;        boolean doShow = true;        if (newTask) &#123;            // Even though this activity is starting fresh, we still need            // to reset it to make sure we apply affinities to move any            // existing activities from other tasks in to it.            // If the caller has requested that the target task be            // reset, then do so.            if ((r.intent.getFlags() &amp; Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) != 0) &#123;                resetTaskIfNeededLocked(r, r);                doShow = topRunningNonDelayedActivityLocked(null) == r;            &#125;        &#125; else if (options != null &amp;&amp; options.getAnimationType()                == ActivityOptions.ANIM_SCENE_TRANSITION) &#123;            doShow = false;        &#125;        if (r.mLaunchTaskBehind) &#123;            // Don&#39;t do a starting window for mLaunchTaskBehind. More importantly make sure we            // tell WindowManager that r is visible even though it is at the back of the stack.            r.setVisibility(true);            // è¿™é‡Œç»§ç»­æ·±å…¥            ensureActivitiesVisibleLocked(null, 0, !PRESERVE_WINDOWS);        &#125; else if (SHOW_APP_STARTING_PREVIEW &amp;&amp; doShow) &#123;            // Figure out if we are transitioning from another activity that is            // &quot;has the same starting icon&quot; as the next one.  This allows the            // window manager to keep the previous window it had previously            // created, if it still had one.            TaskRecord prevTask = r.getTaskRecord();            ActivityRecord prev = prevTask.topRunningActivityWithStartingWindowLocked();            if (prev != null) &#123;                // We don&#39;t want to reuse the previous starting preview if:                // (1) The current activity is in a different task.                if (prev.getTaskRecord() != prevTask) &#123;                    prev = null;                &#125;                // (2) The current activity is already displayed.                else if (prev.nowVisible) &#123;                    prev = null;                &#125;            &#125;            r.showStartingWindow(prev, newTask, isTaskSwitch(r, focusedTopActivity));        &#125;    &#125; else &#123;        // If this is the first activity, don&#39;t do any fancy animations,        // because there is nothing for it to animate on top of.        ActivityOptions.abort(options);    &#125;&#125;</code></pre><p>è¿™é‡Œçš„ä»£ç æˆ‘æ²¡æœ‰ç²¾ç®€ï¼Œè¿™æ®µä»£ç å±•ç¤ºäº†å¯¹äº TaskRecord åŠå†…éƒ¨ Activity é¡ºåºçš„å¤„ç†ã€‚Activity åˆ°ç°åœ¨è¿˜æœªè¿›è¡Œåˆ›å»ºï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸‹èµ°ï¼Œçœ‹<code>ensureActivitiesVisibleLocked()</code>æ–¹æ³•ï¼š</p><pre><code class="java">final void ensureActivitiesVisibleLocked(ActivityRecord starting, int configChanges,        boolean preserveWindows, boolean notifyClients) &#123;    ...    try &#123;        for (int taskNdx = mTaskHistory.size() - 1; taskNdx &gt;= 0; --taskNdx) &#123;            final TaskRecord task = mTaskHistory.get(taskNdx);            final ArrayList&lt;ActivityRecord&gt; activities = task.mActivities;            for (int activityNdx = activities.size() - 1; activityNdx &gt;= 0; --activityNdx) &#123;                ...                if (reallyVisible) &#123;                    ...                    if (!r.attachedToProcess()) &#123;                        if (makeVisibleAndRestartIfNeeded(starting, configChanges, isTop,                                resumeNextActivity, r)) &#123;                            if (activityNdx &gt;= activities.size()) &#123;                                // Record may be removed if its process needs to restart.                                activityNdx = activities.size() - 1;                            &#125; else &#123;                                resumeNextActivity = false;                            &#125;                        &#125;                    &#125; else if (r.visible) &#123;                        ...                    &#125; else &#123;                        ...                    &#125;                    // Aggregate current change flags.                    configChanges |= r.configChangeFlags;                &#125;                ...            &#125;            ...        &#125;        ...    &#125; finally &#123;        ...    &#125;&#125;private boolean makeVisibleAndRestartIfNeeded(ActivityRecord starting, int configChanges,        boolean isTop, boolean andResume, ActivityRecord r) &#123;    if (isTop || !r.visible) &#123;        ...        if (r != starting) &#123;            // We should not resume activities that being launched behind because these            // activities are actually behind other fullscreen activities, but still required            // to be visible (such as performing Recents animation).            mStackSupervisor.startSpecificActivityLocked(r, andResume &amp;&amp; !r.mLaunchTaskBehind,                    true /* checkConfig */);            return true;        &#125;    &#125;    return false;&#125;</code></pre><p>è¿™é‡Œåˆå‡ºç°äº†ä¸€ä¸ª<code>mStackSupervisor</code>çš„å˜é‡ï¼Œå®ƒæ˜¯ ActivityStackSupervisor ç±»å‹ï¼Œä¸Šé¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œæˆ‘ä»¬çœ‹å®ƒçš„<code>startSpecificActivityLocked()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// com.android.server.wm.ActivityStackSupervisor.javavoid startSpecificActivityLocked(ActivityRecord r, boolean andResume, boolean checkConfig) &#123;    // Activity æ‰€å±çš„åº”ç”¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ    final WindowProcessController wpc =            mService.getProcessController(r.processName, r.info.applicationInfo.uid);    boolean knownToBeDead = false;    if (wpc != null &amp;&amp; wpc.hasThread()) &#123; // åˆ¤æ–­å®ƒçš„ ActivityThread æ˜¯å¦ä¸º null        // å¦‚æœå·²ç»åœ¨è¿è¡Œï¼Œåˆ™å¼€å§‹åˆ›å»º Activity å®ä¾‹        try &#123;            realStartActivityLocked(r, wpc, andResume, checkConfig);            return;        &#125; catch (RemoteException e) &#123;            Slog.w(TAG, &quot;Exception when starting activity &quot;                    + r.intent.getComponent().flattenToShortString(), e);        &#125;        // If a dead object exception was thrown -- fall through to        // restart the application.        knownToBeDead = true;    &#125;    // Suppress transition until the new activity becomes ready, otherwise the keyguard can    // appear for a short amount of time before the new process with the new activity had the    // ability to set its showWhenLocked flags.    if (getKeyguardController().isKeyguardLocked()) &#123;        r.notifyUnknownVisibilityLaunched();    &#125;    final boolean isTop = andResume &amp;&amp; r.isTopRunningActivity();    mService.startProcessAsync(r, knownToBeDead, isTop, isTop ? &quot;top-activity&quot; : &quot;activity&quot;);&#125;</code></pre><p>å¥½ï¼Œæ¥ä¸‹æ¥æ˜¯é‡å¤´æˆï¼Œ<code>realStartActivityLocked()</code>ï¼š</p><pre><code class="java"> boolean realStartActivityLocked(ActivityRecord r, WindowProcessController proc,            boolean andResume, boolean checkConfig) throws RemoteException &#123;    ...    // ä¸€ç³»åˆ—æ£€æŸ¥    ...    try &#123;        ...        try &#123;            ...            // æ£€æŸ¥æ˜¯å¦è¦è¾“å‡º Transaction too large çš„æ—¥å¿—ï¼Œé¢ç†Ÿå—ï¼Ÿ            logIfTransactionTooLarge(r.intent, r.icicle);            // åˆ›å»ºå¯åŠ¨ Activity çš„äº‹åŠ¡            final ClientTransaction clientTransaction = ClientTransaction.obtain(                    proc.getThread(), r.appToken);            final DisplayContent dc = r.getDisplay().mDisplayContent;            clientTransaction.addCallback(LaunchActivityItem.obtain(new Intent(r.intent),                    System.identityHashCode(r), r.info,                    // TODO: Have this take the merged configuration instead of separate global                    // and override configs.                    mergedConfiguration.getGlobalConfiguration(),                    mergedConfiguration.getOverrideConfiguration(), r.compat,                    r.launchedFromPackage, task.voiceInteractor, proc.getReportedProcState(),                    r.icicle, r.persistentState, results, newIntents,                    dc.isNextTransitionForward(), proc.createProfilerInfoIfNeeded(),                            r.assistToken));            // è®¾ç½®æœ€ç»ˆçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€            final ActivityLifecycleItem lifecycleItem;            // åˆ›å»ºä¸‹ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸäº‹åŠ¡            if (andResume) &#123;                lifecycleItem = ResumeActivityItem.obtain(dc.isNextTransitionForward());            &#125; else &#123;                lifecycleItem = PauseActivityItem.obtain();            &#125;            clientTransaction.setLifecycleStateRequest(lifecycleItem);            // å®‰æ’ä¸Šäº†ã€‚            mService.getLifecycleManager().scheduleTransaction(clientTransaction);            ...        &#125; catch (RemoteException e) &#123;            ...        &#125;    &#125; finally &#123;        ...    &#125;    ...    return true;&#125;</code></pre><p>ä» Android 26 ä¹‹åï¼Œå¼•å…¥äº†äº‹åŠ¡æœºåˆ¶ï¼Œå¹¶å°† Activity çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†éƒ½äº¤ç»™ä¸€ä¸ªåä¸º ClientLifecycleManager çš„å·¥å…·ç±»æ¥è¿›è¡Œè¾…åŠ©ç®¡ç†ã€‚ClientTransaction æŒ‡å®šè¦æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹ï¼ˆå¦‚ LaunchActivityItemï¼‰åŠæ‰€åœ¨è¿›ç¨‹ï¼ŒClientLifecycleManager è´Ÿè´£ä¼ é€’æ¶ˆæ¯ã€‚</p><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒmService æ˜¯ ATMS çš„å®ä¾‹ï¼Œåœ¨æ„é€  ActivityStackSupervisor å®ä¾‹æ—¶ç”±å¤–éƒ¨ä¼ å…¥ã€‚<code>ActivityTaskManagerService.getLifecycleManager()</code>è¿”å›çš„å³æ˜¯ ATMS ä¸­ ClientLifecycleManager çš„å®ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code>ClientLifecycleManager.scheduleTransaction()</code>éƒ½åšäº†äº›ä»€ä¹ˆï¼š</p><pre><code class="java">void scheduleTransaction(ClientTransaction transaction) throws RemoteException &#123;    final IApplicationThread client = transaction.getClient();    transaction.schedule();    if (!(client instanceof Binder)) &#123;        // If client is not an instance of Binder - it&#39;s a remote call and at this point it is        // safe to recycle the object. All objects used for local calls will be recycled after        // the transaction is executed on client in ActivityThread.        transaction.recycle();    &#125;&#125;</code></pre><p>å“¦ï¼Ÿåˆäº¤è¿˜ç»™ ClientTransaction è‡ªå·±å» schedule äº†ï¼š</p><pre><code class="java">public void schedule() throws RemoteException &#123;    mClient.scheduleTransaction(this);&#125;</code></pre><p><code>mClient</code> è‡ªç„¶å°±æ˜¯ ApplicationThread çš„å®ä¾‹ï¼Œé€šè¿‡ Binder æ–¹å¼è¿œç¨‹è°ƒç”¨äº†å®ƒçš„<code>scheduleTransaction()</code>æ–¹æ³•ã€‚</p><p>è‡³æ­¤ï¼ŒActivity å¯åŠ¨çš„è¯·æ±‚å°±äº¤è¿˜ç»™äº†ç›®æ ‡è¿›ç¨‹çš„ ApplicationThreadã€‚</p><h2 id="ActivityThread-ä¸­çš„æµç¨‹"><a href="#ActivityThread-ä¸­çš„æµç¨‹" class="headerlink" title="ActivityThread ä¸­çš„æµç¨‹"></a>ActivityThread ä¸­çš„æµç¨‹</h2><p>æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹çœ‹<code>ApplicationThread.scheduleTransaction()</code>ï¼š</p><pre><code class="java">// android.app.ActivityThread.ApplicationThread.javaprivate class ApplicationThread extends IApplicationThread.Stub &#123;    public void scheduleTransaction(ClientTransaction transaction) throws RemoteException &#123;        ActivityThread.this.scheduleTransaction(transaction);    &#125;&#125;// android.app.ActivityThread.javapublic final class ActivityThread extends ClientTransactionHandler &#123;    void scheduleTransaction(ClientTransaction transaction) &#123;        transaction.preExecute(this);        sendMessage(ActivityThread.H.EXECUTE_TRANSACTION, transaction);    &#125;&#125;</code></pre><p>H æ˜¯ ActivityThread ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ƒç»§æ‰¿è‡ª Handlerã€‚è¿™é‡Œè°ƒç”¨äº†<code>sendMessage()</code>æ–¹æ³•ï¼Œä¼å›¾å‘è¿™ä¸ª Handler å‘é€æ¶ˆæ¯ï¼š</p><pre><code class="java">void sendMessage(int what, Object obj) &#123;    sendMessage(what, obj, 0, 0, false);&#125;private void sendMessage(int what, Object obj, int arg1, int arg2, boolean async) &#123;    Message msg = Message.obtain();    msg.what = what;    msg.obj = obj;    msg.arg1 = arg1;    msg.arg2 = arg2;    if (async) &#123;        msg.setAsynchronous(true);    &#125;    mH.sendMessage(msg);&#125;</code></pre><p><code>mH</code>è‡ªç„¶å°±æ˜¯ H çš„å®ä¾‹ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å¤„ç†<code>EXECUTE_TRANSACTION</code>æ¶ˆæ¯çš„ï¼š</p><pre><code class="java">case EXECUTE_TRANSACTION:    final ClientTransaction transaction = (ClientTransaction) msg.obj;    mTransactionExecutor.execute(transaction);    if (isSystem()) &#123;        // Client transactions inside system process are recycled on the client side        // instead of ClientLifecycleManager to avoid being cleared before this        // message is handled.        transaction.recycle();    &#125;    // TODO(lifecycler): Recycle locally scheduled transactions.    break;</code></pre><p>åˆè¹¦å‡ºä¸ªä¸œè¥¿å« TransactionExecutorï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©äº‹åŠ¡èƒ½å¤ŸæŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚</p><pre><code class="java">// android.app.servertransaction.TransactionExecutor.javapublic void execute(ClientTransaction transaction) &#123;    ...    executeCallbacks(transaction);    // å¦‚æœæŒ‡å®šçš„æœ€ç»ˆçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œé‚£å°±å†ç»§ç»­æ‰§è¡Œäº‹åŠ¡ç›´åˆ°æŒ‡å®šçŠ¶æ€    executeLifecycleState(transaction);    ...&#125;public void executeCallbacks(ClientTransaction transaction) &#123;    final List&lt;ClientTransactionItem&gt; callbacks = transaction.getCallbacks();    ...    final IBinder token = transaction.getActivityToken();    ...    final int size = callbacks.size();    for (int i = 0; i &lt; size; ++i) &#123;        final ClientTransactionItem item = callbacks.get(i);        ...        item.execute(mTransactionHandler, token, mPendingActions);        item.postExecute(mTransactionHandler, token, mPendingActions);        if (r == null) &#123;            // Launch activity request will create an activity record.            r = mTransactionHandler.getActivityClient(token);        &#125;        if (postExecutionState != UNDEFINED &amp;&amp; r != null) &#123;            // Skip the very last transition and perform it by explicit state request instead.            final boolean shouldExcludeLastTransition =                    i == lastCallbackRequestingState &amp;&amp; finalState == postExecutionState;            cycleToPath(r, postExecutionState, shouldExcludeLastTransition, transaction);        &#125;    &#125;&#125;</code></pre><p>è¿™é‡Œçœ‹åˆ°äº†ï¼Œæ˜¯æ‹¿åˆ°äº‹åŠ¡çš„ callbackï¼Œå¹¶è¿›è¡Œå›è°ƒã€‚è°ƒç”¨å®ƒçš„<code>execute()</code>æ–¹æ³•æ¥çœŸæ­£æ‰§è¡Œæ“ä½œã€‚</p><p>é‚£ä¹ˆè¿™ä¸ª callback æ˜¯ä»€ä¹ˆæ—¶å€™è®¾ç½®çš„å‘¢ï¼Ÿå‘ä¸Šç¿»ç¿»ä»£ç ï¼Œåœ¨ ClientTransaction åˆ›å»ºæ—¶ï¼Œæœ‰è¿™æ ·çš„ä¸€å¥ä»£ç ï¼š</p><pre><code class="java">clientTransaction.addCallback(LaunchActivityItem.obtain(new Intent(r.intent),        System.identityHashCode(r), r.info,        // TODO: Have this take the merged configuration instead of separate global        // and override configs.        mergedConfiguration.getGlobalConfiguration(),        mergedConfiguration.getOverrideConfiguration(), r.compat,        r.launchedFromPackage, task.voiceInteractor, proc.getReportedProcState(),        r.icicle, r.persistentState, results, newIntents,        dc.isNextTransitionForward(), proc.createProfilerInfoIfNeeded(),                r.assistToken));</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ã€å¯åŠ¨ Activityã€è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œcallback æ˜¯ LaunchActivityItem çš„å®ä¾‹ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼š</p><pre><code class="java">public class LaunchActivityItem extends ClientTransactionItem &#123;    private Intent mIntent;    ...    private ActivityInfo mInfo;    ...    private Bundle mState;    private PersistableBundle mPersistentState;    private List&lt;ResultInfo&gt; mPendingResults;    ...    @Override    public void execute(ClientTransactionHandler client, IBinder token,            PendingTransactionActions pendingActions) &#123;        ...        ActivityClientRecord r = new ActivityClientRecord(token, mIntent, mIdent, mInfo,                mOverrideConfig, mCompatInfo, mReferrer, mVoiceInteractor, mState, mPersistentState,                mPendingResults, mPendingNewIntents, mIsForward,                mProfilerInfo, client, mAssistToken);        client.handleLaunchActivity(r, pendingActions, null /* customIntent */);        ...    &#125;    @Override    public void postExecute(ClientTransactionHandler client, IBinder token,            PendingTransactionActions pendingActions) &#123;        client.countLaunchingActivities(-1);    &#125;&#125;</code></pre><p>åœ¨<code>execute()</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ„é€ äº†ä¸€ä¸ª ActivityClientRecord ç±»å‹çš„å˜é‡<code>r</code>ï¼Œç„¶åå°†å®ƒäº¤ç»™äº† ClientTransactionHandlerã€‚è¿™ä¸ªç±»æ˜¯å•¥å‘¢ï¼Ÿå®ƒæ˜¯ ActivityThread çš„çˆ¶ç±»ã€‚è¿™ä¸ª<code>client</code>ä¹Ÿå³<code>TransactionExecutor.mTransactionHandler</code>ï¼Œè€Œ<code>mTransactionHander</code>æ˜¯åœ¨ TransactionExecutor æ„é€ æ—¶ä¼ å…¥çš„ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ¼ï¼š</p><pre><code class="java">public final class ActivityThread extends ClientTransactionHandler &#123;    ...    private final TransactionExecutor mTransactionExecutor = new TransactionExecutor(this);    ...&#125;</code></pre><p>è½¬æ¥è½¬å»ï¼Œåˆå›åˆ°äº† ActivityThread ä¸­ã€‚</p><pre><code class="java">@Overridepublic Activity handleLaunchActivity(ActivityClientRecord r,        PendingTransactionActions pendingActions, Intent customIntent) &#123;    ...    // åˆå§‹åŒ– WindowManagerGlobal    // è¿™ä¸ªç±»ç”¨æ¥ä¸ WindowManagerService è¿›è¡Œé€šè®¯    WindowManagerGlobal.initialize();    ...    final Activity a = performLaunchActivity(r, customIntent);    ...    return a;&#125;/**  Core implementation of activity launch. */private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;    ActivityInfo aInfo = r.activityInfo;    if (r.packageInfo == null) &#123;        r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,                Context.CONTEXT_INCLUDE_CODE);    &#125;    ComponentName component = r.intent.getComponent();    if (component == null) &#123;        component = r.intent.resolveActivity(            mInitialApplication.getPackageManager());        r.intent.setComponent(component);    &#125;    if (r.activityInfo.targetActivity != null) &#123;        component = new ComponentName(r.activityInfo.packageName,                r.activityInfo.targetActivity);    &#125;    ContextImpl appContext = createBaseContextForActivity(r);    // åˆ›å»º Activity å®ä¾‹    Activity activity = null;    try &#123;        ClassLoader cl = appContext.getClassLoader();        activity = mInstrumentation.newActivity(                cl, component.getClassName(), r.intent);        StrictMode.incrementExpectedActivityCount(activity.getClass());        r.intent.setExtrasClassLoader(cl);        r.intent.prepareToEnterProcess();        if (r.state != null) &#123;            r.state.setClassLoader(cl);        &#125;    &#125; catch (Exception e) &#123;        if (!mInstrumentation.onException(activity, e)) &#123;            throw new RuntimeException(                &quot;Unable to instantiate activity &quot; + component                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;    try &#123;        // å¦‚æœåº”ç”¨æœªå¯åŠ¨ï¼Œåˆ™è¦åˆ›å»ºåº”ç”¨çš„ Application        // å¦‚æœåˆ›å»ºè¿‡äº†ï¼Œåˆ™ç›´æ¥è¿”å›å·²åˆ›å»ºçš„å®ä¾‹        Application app = r.packageInfo.makeApplication(false, mInstrumentation);        if (localLOGV) Slog.v(TAG, &quot;Performing launch of &quot; + r);        if (localLOGV) Slog.v(                TAG, r + &quot;: app=&quot; + app                + &quot;, appName=&quot; + app.getPackageName()                + &quot;, pkg=&quot; + r.packageInfo.getPackageName()                + &quot;, comp=&quot; + r.intent.getComponent().toShortString()                + &quot;, dir=&quot; + r.packageInfo.getAppDir());        if (activity != null) &#123;            CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());            Configuration config = new Configuration(mCompatConfiguration);            if (r.overrideConfig != null) &#123;                config.updateFrom(r.overrideConfig);            &#125;            if (DEBUG_CONFIGURATION) Slog.v(TAG, &quot;Launching activity &quot;                    + r.activityInfo.name + &quot; with config &quot; + config);            Window window = null;            if (r.mPendingRemoveWindow != null &amp;&amp; r.mPreserveWindow) &#123;                window = r.mPendingRemoveWindow;                r.mPendingRemoveWindow = null;                r.mPendingRemoveWindowManager = null;            &#125;            appContext.setOuterContext(activity);            // è°ƒç”¨ Activity.attach() æ–¹æ³•ï¼Œå¯¹ Activity è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¯”å¦‚åˆ›å»º PhoneWindowï¼Œç»‘å®š ActivityThread ç­‰            activity.attach(appContext, this, getInstrumentation(), r.token,                    r.ident, app, r.intent, r.activityInfo, title, r.parent,                    r.embeddedID, r.lastNonConfigurationInstances, config,                    r.referrer, r.voiceInteractor, window, r.configCallback,                    r.assistToken);            if (customIntent != null) &#123;                activity.mIntent = customIntent;            &#125;            r.lastNonConfigurationInstances = null;            checkAndBlockForNetworkAccess();            activity.mStartedActivity = false;            int theme = r.activityInfo.getThemeResource();            if (theme != 0) &#123;                activity.setTheme(theme);            &#125;            activity.mCalled = false;            // è°ƒç”¨ Activity ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå®Œæˆåˆ›å»º            if (r.isPersistable()) &#123;                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);            &#125; else &#123;                mInstrumentation.callActivityOnCreate(activity, r.state);            &#125;            if (!activity.mCalled) &#123;                throw new SuperNotCalledException(                    &quot;Activity &quot; + r.intent.getComponent().toShortString() +                    &quot; did not call through to super.onCreate()&quot;);            &#125;            r.activity = activity;        &#125;        r.setState(ON_CREATE);        // updatePendingActivityConfiguration() reads from mActivities to update        // ActivityClientRecord which runs in a different thread. Protect modifications to        // mActivities to avoid race.        synchronized (mResourcesManager) &#123;            mActivities.put(r.token, r);        &#125;    &#125; catch (SuperNotCalledException e) &#123;        throw e;    &#125; catch (Exception e) &#123;        if (!mInstrumentation.onException(activity, e)) &#123;            throw new RuntimeException(                &quot;Unable to start activity &quot; + component                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;    return activity;&#125;</code></pre><p>ä¸Šé¢çš„ä»£ç åˆ†ä¸ºä¸‰å¤§æ­¥ï¼š</p><ol><li>åˆ©ç”¨ Instrumentation åå°„åˆ›å»º Activity çš„å®ä¾‹ï¼›</li><li>è°ƒç”¨<code>Activity.attach()</code>å¯¹ Activity è¿›è¡Œ Context ç»‘å®šã€åˆ›å»º PhoneWindow å®ä¾‹ç­‰ï¼›</li><li>è°ƒç”¨<code>Instrumentation.callActivityOnCreate()</code>ä»è€Œè°ƒç”¨åˆ° Activity çš„<code>onCreate()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</li></ol><p>é‚£ä¹ˆï¼ŒActivity çš„<code>onCreate()</code>è¢«è°ƒç”¨å®Œæˆåï¼Œè¿˜ä¼šç»§ç»­è°ƒç”¨<code>onStart()</code>å’Œ<code>onResume()</code>å‘¢ï¼Œå®ƒä»¬æ˜¯åœ¨å“ªé‡Œè¢«è°ƒç”¨çš„å‘¢ï¼Ÿ</p><p>è¿˜è®°å¾—ä¸Šé¢æœ‰è¿™æ ·ä¸€æ®µå—ï¼Ÿ</p><pre><code class="java">// å¦‚æœæŒ‡å®šçš„æœ€ç»ˆçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œé‚£å°±å†ç»§ç»­æ‰§è¡Œäº‹åŠ¡ç›´åˆ°æŒ‡å®šçŠ¶æ€executeLifecycleState(transaction);</code></pre><p>è¿™é‡Œå°±æ‰§è¡Œäº†åˆ›å»º ClientTransactionItem è¯·æ±‚æ—¶ï¼Œé¡ºå¸¦åˆ›å»ºçš„ ActivityLifecycleItem è¯·æ±‚ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ<code>transaction</code>æ˜¯ ResumeActivityItem çš„å®ä¾‹ã€‚</p><p>ç»è¿‡ä¸ä¸Šé¢ç›¸åŒçš„æ­¥éª¤ï¼Œæœ€ç»ˆä¼šæ¥åˆ° ActivityThread çš„<code>handleResumeActivity()</code>æ–¹æ³•ä¸­ï¼š</p><pre><code class="java">public void handleResumeActivity(IBinder token, boolean finalStateRequest, boolean isForward,        String reason) &#123;    ...    final ActivityClientRecord r = performResumeActivity(token, finalStateRequest, reason);    ...    final Activity a = r.activity;    ...    // If the window hasn&#39;t yet been added to the window manager,    // and this guy didn&#39;t finish itself or start another activity,    // then go ahead and add the window.    boolean willBeVisible = !a.mStartedActivity;    if (!willBeVisible) &#123;        try &#123;            willBeVisible = ActivityTaskManager.getService().willActivityBeVisible(                    a.getActivityToken());        &#125; catch (RemoteException e) &#123;            throw e.rethrowFromSystemServer();        &#125;    &#125;    if (r.window == null &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) &#123;        r.window = r.activity.getWindow();        View decor = r.window.getDecorView();        decor.setVisibility(View.INVISIBLE);        ViewManager wm = a.getWindowManager();        WindowManager.LayoutParams l = r.window.getAttributes();        a.mDecor = decor;        l.type = WindowManager.LayoutParams.TYPE_BASE_APPLICATION;        l.softInputMode |= forwardBit;        if (r.mPreserveWindow) &#123;            a.mWindowAdded = true;            r.mPreserveWindow = false;            // Normally the ViewRoot sets up callbacks with the Activity            // in addView-&gt;ViewRootImpl#setView. If we are instead reusing            // the decor view we have to notify the view root that the            // callbacks may have changed.            ViewRootImpl impl = decor.getViewRootImpl();            if (impl != null) &#123;                impl.notifyChildRebuilt();            &#125;        &#125;        if (a.mVisibleFromClient) &#123;            if (!a.mWindowAdded) &#123;                a.mWindowAdded = true;                wm.addView(decor, l);            &#125; else &#123;                // The activity will get a callback for this &#123;@link LayoutParams&#125; change                // earlier. However, at that time the decor will not be set (this is set                // in this method), so no action will be taken. This call ensures the                // callback occurs with the decor set.                a.onWindowAttributesChanged(l);            &#125;        &#125;        // If the window has already been added, but during resume        // we started another activity, then don&#39;t yet make the        // window visible.    &#125; else if (!willBeVisible) &#123;        if (localLOGV) Slog.v(TAG, &quot;Launch &quot; + r + &quot; mStartedActivity set&quot;);        r.hideForNow = true;    &#125;    // Get rid of anything left hanging around.    cleanUpPendingRemoveWindows(r, false /* force */);    // The window is now visible if it has been added, we are not    // simply finishing, and we are not starting another activity.    if (!r.activity.mFinished &amp;&amp; willBeVisible &amp;&amp; r.activity.mDecor != null &amp;&amp; !r.hideForNow) &#123;        if (r.newConfig != null) &#123;            performConfigurationChangedForActivity(r, r.newConfig);            if (DEBUG_CONFIGURATION) &#123;                Slog.v(TAG, &quot;Resuming activity &quot; + r.activityInfo.name + &quot; with newConfig &quot;                        + r.activity.mCurrentConfig);            &#125;            r.newConfig = null;        &#125;        if (localLOGV) Slog.v(TAG, &quot;Resuming &quot; + r + &quot; with isForward=&quot; + isForward);        WindowManager.LayoutParams l = r.window.getAttributes();        if ((l.softInputMode                &amp; WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION)                != forwardBit) &#123;            l.softInputMode = (l.softInputMode                    &amp; (~WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION))                    | forwardBit;            if (r.activity.mVisibleFromClient) &#123;                ViewManager wm = a.getWindowManager();                View decor = r.window.getDecorView();                wm.updateViewLayout(decor, l);            &#125;        &#125;        r.activity.mVisibleFromServer = true;        mNumVisibleActivities++;        if (r.activity.mVisibleFromClient) &#123;            // è®© Activity å¯è§çš„é‡è¦æ–¹æ³•            r.activity.makeVisible();        &#125;    &#125;&#125;</code></pre><p>è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨<code>performResumeActivity()</code>æ–¹æ³•ï¼Œç„¶ååˆå§‹åŒ–ä¸€äº› Window ç›¸å…³çš„æ•°æ®ï¼Œå¹¶æœ€ç»ˆé€šè¿‡è°ƒç”¨ <code>Activity.makeVisible()</code>æ–¹æ³•è®© Activity å¯è§ã€‚</p><pre><code class="java">public ActivityClientRecord performResumeActivity(IBinder token, boolean finalStateRequest,        String reason) &#123;    final ActivityClientRecord r = mActivities.get(token);    ...    try &#123;        ...        r.activity.performResume(r.startsNotResumed, reason);    &#125; catch (Exception e) &#123;        ...    &#125;&#125;</code></pre><p>Activity çš„<code>performResume()</code>å¦‚ä¸‹ï¼š</p><pre><code class="java">final void performResume(boolean followedByPause, String reason) &#123;    ...    performRestart(true /* start */, reason); //     ...    // mResumed is set by the instrumentation    mInstrumentation.callActivityOnResume(this);    ...    onPostResume();    ...    dispatchActivityPostResumed();&#125;final void performRestart(boolean start, String reason) &#123;    ...    if (mStopped) &#123;        ...        mInstrumentation.callActivityOnRestart(this);        ...        if (start) &#123;            performStart(reason);        &#125;    &#125;&#125;final void performStart(String reason) &#123;    ...    mInstrumentation.callActivityOnStart(this);    ...    dispatchActivityPostStarted();&#125;</code></pre><p>Activity ç”Ÿå‘½å‘¨æœŸæµç¨‹å¾—åˆ°äº†ä½è¯ï¼Œä¼šç”±<code>onCreate()</code>â†’<code>onRestart()</code>â†’<code>onStart()</code>â†’<code>onResume()</code></p><p>çœŸçš„æ˜¯å¾ˆé•¿çš„ä¸€ä¸ªæµç¨‹ã€‚æˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li>æºè¿›ç¨‹è°ƒç”¨<code>startActivity()</code>ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>Instrumentation.execStartActivity()</code>æ–¹æ³•ï¼›</li><li>é€šè¿‡ Binder è°ƒç”¨ ActivityTaskManagerService çš„<code>startActivity()</code>æ–¹æ³•ï¼›</li><li>ATMS ä¼šä½¿ç”¨ ActivityStack ç±»å’Œ ActivityStackSupervisor ç±»æ¥å¤„ç† Task ä¸ Activity çš„å…¥æ ˆæ“ä½œï¼›</li><li>æ¥ç€åœ¨<code>ActivityStackSupervisor.realStartActivityLocked()</code>æ–¹æ³•ä¸­ï¼Œä½¿ç”¨æäº¤äº‹åŠ¡çš„æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªå¯åŠ¨ Activity çš„äº‹åŠ¡ï¼Œå¹¶æäº¤ç»™ ClientLifecycleManagerï¼›</li><li>ClientLifecycleManager ä¼šé€šè¿‡ Binder è°ƒç”¨ ActivityThread çš„<code>scheduleTransaction()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå‘ ActivityThread ä¸­çš„ Handler å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼›</li><li>Handler æ¥æ”¶æ¶ˆæ¯åï¼Œåˆ©ç”¨ TransactionExecutor æŒ‰é¡ºåºæ‰§è¡Œäº‹åŠ¡ï¼›</li><li>åœ¨è¿™ä¸ªã€å¯åŠ¨ Activityã€çš„äº‹åŠ¡å›è°ƒä¸­ï¼Œåˆè°ƒç”¨äº† ActivityThread çš„<code>handleLaunchActivity()</code>æ–¹æ³•ï¼Œè¿›è€Œåˆè°ƒç”¨äº†<code>performLaunchActivity()</code>æ–¹æ³•ï¼›</li><li>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œåˆ©ç”¨åå°„åˆ›å»ºäº† Activity çš„å®ä¾‹ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œè¿˜åˆ©ç”¨åå°„åˆ›å»ºäº† Application çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨<code>Activity.attach()</code>æ–¹æ³•ï¼Œåˆ›å»º PhoneWindowã€ç»‘å®š Contextï¼›</li><li>æœ€åè°ƒç”¨äº†<code>Instrumentation.callActivityOnCreate()</code>æ–¹æ³•ï¼Œæ‰§è¡Œäº† Activity çš„<code>onCreate()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼›</li><li>æ¥ç€ TransactionExecutor åˆå¼€å§‹æ‰§è¡Œç”Ÿå‘½å‘¨æœŸäº‹åŠ¡ï¼Œæœ€åä¾æ¬¡è°ƒç”¨åˆ°<code>onStart()</code>ã€<code>onResume()</code>ã€‚</li></ol><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>æœ¬æ–‡ä»£ç åˆ†æåŸºäº Android 10.0ï¼Œåœ¨ 10.0 ä¸­ï¼Œå‡ºç°äº† ATMSï¼ŒAMS ä¸­åŸæ¥çš„<code>startActivity()</code>å…¨éƒ¨ç”± ATMS æ¥æ‰§è¡Œã€‚</p><p>å¯ä»¥ä»ä¸‹é¢é“¾æ¥ä¸­è§‚å¯Ÿä¸¤è€…çš„ä¸åŒï¼š<br><a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java;l=3521;bpv=0;bpt=1">10.0.0_r30 ä¸­çš„ ActivityManagerService</a><br><a href="https://cs.android.com/android/platform/superproject/+/android-9.0.0_r34:frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java;l=5088;bpv=0;bpt=1">9.0.0_r34 ä¸­çš„ ActivityManagerService</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Activity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº GC</title>
      <link href="/2020-05-21/gc/"/>
      <url>/2020-05-21/gc/</url>
      
        <content type="html"><![CDATA[<p>GCï¼ˆGarbage Collectï¼‰æ˜¯ Java è™šæ‹Ÿæœºæœ€è‘—åçš„ä¸€ä¸ªæœºåˆ¶â€”â€”<strong>å†…å­˜å›æ”¶</strong>ã€‚</p><p>æˆ‘ä»¬æŒ‰ç€ä¸‹é¢çš„æµç¨‹æ¥è®²è¿° GCï¼š</p><blockquote><ol><li>ä»€ä¹ˆæ˜¯ GC</li><li>GC å¸¸ç”¨ç®—æ³•</li><li>åƒåœ¾æ”¶é›†å™¨æ˜¯ä»€ä¹ˆ</li><li><code>finalize()</code>æ–¹æ³•è¯¦è§£</li><li>æ€»ç»“</li></ol></blockquote><span id="more"></span><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯-GC"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯-GC" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ GC"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ GC</h2><p>åœ¨æˆ‘ä»¬çš„å¼€å‘å·¥ä½œä¸­ï¼Œå‡ ä¹æ‰€æœ‰äººéƒ½é‡åˆ°è¿‡å†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚å› ä¸ºç¨‹åºè¿è¡Œæ—¶ï¼Œå†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åŠæ—¶çš„æŠŠä¸å†ä½¿ç”¨çš„å¯¹è±¡æ¸…é™¤å°†å†…å­˜é‡Šæ”¾å‡ºæ¥ï¼Œè¿™å°±æ˜¯ GC è¦åšçš„äº‹ã€‚</p><p>ç†è§£ GC æœºåˆ¶å°±ä»ï¼šã€GC çš„åŒºåŸŸåœ¨å“ªé‡Œã€ï¼Œã€GC çš„å¯¹è±¡æ˜¯ä»€ä¹ˆã€ï¼Œã€GC çš„æ—¶æœºæ˜¯ä»€ä¹ˆã€ï¼Œã€GC åšäº†å“ªäº›äº‹ã€å‡ æ–¹é¢æ¥åˆ†æã€‚</p><h3 id="1ã€éœ€è¦GCçš„å†…å­˜åŒºåŸŸ"><a href="#1ã€éœ€è¦GCçš„å†…å­˜åŒºåŸŸ" class="headerlink" title="1ã€éœ€è¦GCçš„å†…å­˜åŒºåŸŸ"></a>1ã€éœ€è¦GCçš„å†…å­˜åŒºåŸŸ</h3><p>æˆ‘ä»¬å…ˆæ¥ä»ä¸€ä¸ªè¾ƒé«˜çš„ç»´åº¦æ¥çœ‹ JVM ä¸ç³»ç»Ÿè°ƒç”¨ä¹‹é—´çš„å…³ç³»ï¼š</p><div class="center-img"><p><img src="/img/gc-1588648765.png"></p></div><p>ç”±ä¸Šå›¾å¯è§ï¼ŒJVM ä¸­ï¼Œè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨å› ä¸ºæ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>ï¼ˆä¹Ÿå³çº¿ç¨‹éš”ç¦»ï¼‰ï¼Œéƒ½æ˜¯éšçº¿ç¨‹è€Œç”Ÿéšçº¿ç¨‹è€Œç­ï¼Œæ ˆå¸§éšç€æ–¹æ³•çš„è¿›å…¥å’Œé€€å‡ºåšå…¥æ ˆå’Œå‡ºæ ˆæ“ä½œï¼Œå®ç°äº†<strong>è‡ªåŠ¨çš„å†…å­˜æ¸…ç†</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„å†…å­˜åƒåœ¾å›æ”¶ä¸»è¦é›†ä¸­äº java <strong>å †å’Œæ–¹æ³•åŒº</strong>ä¸­ï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œè¿™éƒ¨åˆ†å†…å­˜çš„åˆ†é…å’Œä½¿ç”¨éƒ½æ˜¯åŠ¨æ€çš„ã€‚</p><p>å¹¶ä¸”ï¼ŒJVM è¿è¡Œæ—¶çš„æ•°æ®åŒºå¤§è‡´å¯ä»¥åˆ†ä¸º5ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><p><strong>æ–¹æ³•åŒº</strong></p><p>è¿™ä¸ªåŒºåŸŸ<strong>ç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®</strong>ã€‚JVM è¿è¡Œæ—¶ï¼ŒClass Loader å°†ä¼šæå– class æ–‡ä»¶é‡Œé¢çš„ç±»ä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­ã€‚ä¾‹å¦‚ç±»çš„åç§°ã€ç±»çš„ç±»å‹ï¼ˆæšä¸¾ã€ç±»ã€æ¥å£ï¼‰ã€å­—æ®µã€æ–¹æ³•ç­‰ç­‰ã€‚</p></li><li><p><strong>å †ï¼ˆ Heapï¼‰</strong></p><p>ç†Ÿæ‚‰ c/c++ ç¼–ç¨‹çš„åŒå­¦ä»¬åº”è¯¥ç›¸å½“ç†Ÿæ‚‰ Heap äº†ï¼Œè€Œå¯¹äº Java è€Œè¨€ï¼Œå¯¹å¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œå †æ˜¯ Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Java å †æ˜¯è¢«<strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯<strong>å­˜æ”¾å¯¹è±¡å®ä¾‹</strong>ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚<strong>æ¯ä¸ªåº”ç”¨éƒ½å”¯ä¸€å¯¹åº”ä¸€ä¸ª JVM å®ä¾‹</strong>ï¼Œè€Œ<strong>æ¯ä¸€ä¸ª JVM å®ä¾‹å”¯ä¸€å¯¹åº”ä¸€ä¸ªå †</strong>ã€‚å †ç”± JVM çš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶æ‰€ç®¡ç†ï¼Œä¹Ÿå³æœ¬æ–‡çš„ä¸»è§’ â€”â€” GCï¼ˆGarbage Collectionï¼‰ã€‚</p></li><li><p><strong>è™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰</strong></p><p>æ“ä½œç³»ç»Ÿå†…æ ¸<strong>ä¸ºæŸä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å»ºç«‹çš„å­˜å‚¨åŒºåŸŸ</strong>ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œ<strong>å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ</strong>ã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯ <strong>Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹</strong>ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚<strong>æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹</strong>ã€‚</p></li><li><p><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></p><p>ç”¨æ¥è°ƒç”¨å…¶ä½™è¯­è¨€çš„æœ¬åœ°æ–¹æ³•ï¼Œä¸ºè™šæ‹Ÿå™¨ä½¿ç”¨åˆ°çš„ native æ–¹æ³•æœåŠ¡ï¼Œä¾‹å¦‚ C/C++ å†™çš„æœ¬åœ°ä»£ç ï¼Œè¿™äº›æ–¹æ³•åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­æ‰§è¡Œï¼Œè€Œä¸ä¼šåœ¨ Java æ ˆä¸­æ‰§è¡Œã€‚</p></li><li><p><strong>ç¨‹åºè®¡æ•°å™¨</strong></p><p><strong>çº¿ç¨‹ç§æœ‰</strong>ã€‚æœ‰æ—¶ä¹Ÿå«ã€PC å¯„å­˜å™¨ï¼ˆPC Registerï¼‰ã€ï¼Œæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„<strong>è¡Œå·æŒ‡ç¤ºå™¨</strong>ï¼Œç”¨äºå­˜æ”¾ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ã€‚</p><blockquote><p><strong>å°çŸ¥è¯†</strong><br>JVM ä¸­ï¼Œåªæœ‰ç¨‹åºè®¡æ•°å™¨éƒ¨åˆ†ä¸ä¼šå‡ºç° OOMã€‚</p></blockquote></li></ol><p>åœ¨ JVM ä¸­ç»å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯è‹±å¹´æ—©é€çš„ï¼Œåœ¨ç¼–ç æ—¶å¤§éƒ¨åˆ†å †ä¸­çš„å†…å­˜éƒ½æ˜¯çŸ­æš‚ä¸´æ—¶åˆ†é…çš„ï¼Œæ‰€ä»¥æ— è®ºæ˜¯æ•ˆç‡è¿˜æ˜¯å¼€é”€æ–¹é¢ï¼Œéšç€åˆ†é…çš„å¯¹è±¡å¢å¤šï¼ŒGC çš„æ—¶é—´ä¸å¼€é”€å°†ä¼šè¶Šæ¥è¶Šå¤§ã€‚æ‰€ä»¥ï¼ŒJVM çš„å†…å­˜è¢«åˆ†ä¸ºäº†ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š<strong>æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å’Œæ°¸ä¹…ä»£</strong>ã€‚</p><div class="center-img"><p><img src="/img/gc-1588651828.png"></p></div><ul><li><p><strong>æ–°ç”Ÿä»£</strong></p><p>æ‰€æœ‰æ–°äº§ç”Ÿçš„å¯¹è±¡ä¸€å¾‹éƒ½åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œ Eden åŒºä¿å­˜æœ€æ–°çš„å¯¹è±¡ï¼Œæœ‰ä¸¤ä¸ª Survivor Space â€”â€” S0 å’Œ S1ï¼Œä¸‰ä¸ªåŒºåŸŸçš„æ¯”ä¾‹å¤§è‡´ä¸º Eden:S0:S1 = 8:1:1ã€‚<strong>å½“ Eden åŒºæ»¡æ—¶ï¼Œè§¦å‘ Minor GC</strong>ã€‚Minor GC æ˜¯ä¸€ç§ Stop the World äº‹ä»¶ï¼Œåœ¨å›æ”¶æ—¶ä¼šæš‚åœå½“å‰çº¿ç¨‹æ­£åœ¨åšçš„æ‰€æœ‰äº‹æƒ…ã€‚</p></li><li><p><strong>è€å¹´ä»£</strong></p><p>è€å¹´ä»£ç”¨æ¥å­˜å‚¨å­˜æ´»æ—¶é—´è¾ƒé•¿çš„å¯¹è±¡ï¼Œè€å¹´ä»£åŒºåŸŸçš„ GC æ˜¯ Major GCï¼Œè€å¹´ä»£ä¸­çš„å†…å­˜ä¸å¤Ÿæ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ª Stop the Worldäº‹ä»¶ï¼Œä½†æ˜¯çœ‹åå­—å°±çŸ¥é“ï¼Œè¿™ä¸ªå›æ”¶è¿‡ç¨‹ä¼šç›¸å½“æ…¢ï¼Œç”±äºè¿™<strong>åŒ…æ‹¬äº†å¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ‰€æœ‰å¯¹è±¡çš„å›æ”¶</strong>ï¼Œä¹Ÿå« Full GCã€‚</p></li><li><p><strong>æ°¸ä¹…ä»£</strong>ï¼ˆJDK1.7åŠä¹‹å‰ï¼‰</p><p>æ°¸ä¹…ä»£ä½äºæ–¹æ³•åŒºï¼Œä¸»è¦å­˜æ”¾å…ƒæ•°æ®ï¼Œä¾‹å¦‚ Classã€ Method çš„å…ƒä¿¡æ¯ï¼Œä¸ GC è¦å›æ”¶çš„å¯¹è±¡å…¶å®å…³ç³»å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæˆ‘ä»¬å¯ä»¥å‡ ä¹å¿½ç•¥å…¶å¯¹ GC çš„å½±å“ã€‚é™¤äº† JavaHotSpot è¿™ç§è¾ƒæ–°çš„è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¼šå›æ”¶æ— ç”¨çš„å¸¸é‡å’Œçš„ç±»ï¼Œä»¥å…å¤§é‡è¿ç”¨åå°„è¿™ç±»é¢‘ç¹è‡ªå·±è®¾ç½® ClassLoader çš„æ“ä½œæ—¶æ–¹æ³•åŒºæº¢å‡ºã€‚</p></li></ul><h3 id="2ã€GC-çš„å¯¹è±¡ä»¥åŠåˆ¤æ–­æ–¹æ³•"><a href="#2ã€GC-çš„å¯¹è±¡ä»¥åŠåˆ¤æ–­æ–¹æ³•" class="headerlink" title="2ã€GC çš„å¯¹è±¡ä»¥åŠåˆ¤æ–­æ–¹æ³•"></a>2ã€GC çš„å¯¹è±¡ä»¥åŠåˆ¤æ–­æ–¹æ³•</h3><p>éœ€è¦è¿›è¡Œ GC çš„å¯¹è±¡å°±æ˜¯å·²ç»æ²¡æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»å¸¸ç”¨çš„æœ‰è¿™å‡ ç§åŠæ³•ï¼š<strong>å¼•ç”¨è®¡æ•°</strong>ã€<strong>å¯è¾¾æ€§åˆ†æ</strong>ã€<strong>ä¸¤æ¬¡æ ‡è®°</strong>å’Œ**finalize()**ã€‚</p><h4 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h4><p>å¼•ç”¨è®¡æ•°ç®—æ³•æ˜¯åœ¨JVMä¸­è¢«æ‘’å¼ƒçš„ä¸€ç§å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•ï¼Œä¸è¿‡å®ƒä¹Ÿæœ‰ä¸€äº›çŸ¥åçš„åº”ç”¨åœºæ™¯ï¼ˆå¦‚Pythonã€FlashPlayerï¼‰ï¼Œå› æ­¤åœ¨è¿™é‡Œä¹Ÿç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p><p>ç”¨å¼•ç”¨è®¡æ•°å™¨åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š<strong>ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„</strong>ã€‚æ­¤æ–¹æ³•ç®€å•ï¼Œä½†<strong>æ— æ³•è§£å†³å¯¹è±¡ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜</strong>ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class="java">public class ReferenceCountingGC &#123;    public Object instance = null;    private static final int _1MB = 1024 * 1024;    /** * è¿™ä¸ªæˆå‘˜å±æ€§çš„å”¯ä¸€æ„ä¹‰å°±æ˜¯å ç‚¹å†…å­˜ï¼Œä»¥ä¾¿åœ¨èƒ½åœ¨GCæ—¥å¿—ä¸­çœ‹æ¸…æ¥šæ˜¯å¦æœ‰å›æ”¶è¿‡ */    private byte[] bigSize = new byte[2 * _1MB];    public static void testGC() &#123;        ReferenceCountingGC objA = new ReferenceCountingGC();        ReferenceCountingGC objB = new ReferenceCountingGC();        objA.instance = objB;        objB.instance = objA;        objA = null;        objB = null;        // å‡è®¾åœ¨è¿™è¡Œå‘ç”ŸGCï¼ŒobjAå’ŒobjBæ˜¯å¦èƒ½è¢«å›æ”¶ï¼Ÿ        System.gc();    &#125;&#125;</code></pre><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œå¯¹è±¡<code>objA</code>å’Œå¯¹è±¡<code>objB</code>éƒ½æœ‰å­—æ®µ<code>instance</code>ï¼Œèµ‹å€¼ä»¤<code>objA.instance = objB;</code>ã€<code>objB.instance = objA;</code>ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡å†æ— å¼•ç”¨ã€‚å¦‚æœ JVM é‡‡ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œ<strong>è¿™ä¸¤ä¸ªå¯¹è±¡ä¸å¯èƒ½å†è¢«è®¿é—®</strong>ï¼Œä½†æ˜¯ä»–ä»¬<strong>äº’ç›¸å¼•ç”¨ç€å¯¹æ–¹</strong>ï¼Œå¯¼è‡´å®ƒä»¬<strong>å¼•ç”¨è®¡æ•°ä¸ä¸º0</strong>ï¼Œæ‰€ä»¥å¼•ç”¨è®¡æ•°å™¨æ— æ³•é€šçŸ¥ GC æ”¶é›†å™¨å›æ”¶å®ƒä»¬ã€‚</p><p>è€Œäº‹å®ä¸Šæ‰§è¡Œè¿™æ®µä»£ç ï¼Œ<code>objA</code>å’Œ<code>objB</code>æ˜¯å¯ä»¥è¢«å›æ”¶çš„ï¼Œä¸‹é¢ä¸€èŠ‚å°†ä»‹ç» JVM å®é™…ä½¿ç”¨çš„å­˜æ´»åˆ¤å®šç®—æ³•ã€‚</p><h4 id="å¯è¾¾æ€§åˆ†æï¼ˆReachability-Analysisï¼‰"><a href="#å¯è¾¾æ€§åˆ†æï¼ˆReachability-Analysisï¼‰" class="headerlink" title="å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰"></a>å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰</h4><p>åœ¨ä¸»æµå•†ç”¨ç¨‹åºè¯­è¨€çš„å®ç°ä¸­ï¼Œéƒ½æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æï¼ˆtracing GCï¼‰æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚æ­¤ç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯ï¼š<strong>é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸ºã€GC Rootsã€çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆReference Chainï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼ˆç”¨å›¾è®ºçš„è¯æ¥è¯´ï¼Œå°±æ˜¯GC Roots åˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾ï¼‰æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„</strong>ã€‚ç”¨ä¸‹å›¾æ¥åŠ ä»¥è¯´æ˜ï¼š</p><p><img src="/img/48.png"></p><p>ä¸Šå›¾ä¸­ï¼Œå¯¹è±¡object 5ã€object 6ã€object 7è™½ç„¶äº’æœ‰å…³è”ï¼Œä½†æ˜¯å®ƒä»¬åˆ°GC Rootsæ˜¯ä¸å¯è¾¾çš„ï¼Œæ‰€ä»¥å®ƒä»¬å°†ä¼šè¢«åˆ¤å®šä¸ºæ˜¯å¯å›æ”¶çš„å¯¹è±¡ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒGC Roots åœ¨å¯¹è±¡å›¾ä¹‹å¤–ï¼Œæ˜¯ç‰¹åˆ«å®šä¹‰çš„ã€<strong>èµ·ç‚¹</strong>ã€ï¼Œä¸å¯èƒ½è¢«å¯¹è±¡å›¾å†…çš„å¯¹è±¡æ‰€å¼•ç”¨ã€‚</p><p>å‡†ç¡®åœ°è¯´ï¼Œ<strong>GC Roots å…¶å®ä¸æ˜¯ä¸€ç»„å¯¹è±¡ï¼Œè€Œé€šå¸¸æ˜¯ä¸€ç»„ç‰¹åˆ«ç®¡ç†çš„æŒ‡å‘å¼•ç”¨ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆ</strong>ï¼Œè¿™äº›æŒ‡é’ˆæ˜¯ tracing GC çš„ trace çš„èµ·ç‚¹ã€‚å®ƒä»¬ä¸æ˜¯å¯¹è±¡å›¾é‡Œçš„å¯¹è±¡ï¼Œå¯¹è±¡ä¹Ÿä¸å¯èƒ½å¼•ç”¨åˆ°è¿™äº›ã€å¤–éƒ¨ã€çš„æŒ‡é’ˆï¼Œè¿™ä¹Ÿæ˜¯ tracing GC ç®—æ³•ä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨é—®é¢˜çš„åŸºæœ¬ä¿è¯ã€‚å› æ­¤ä¹Ÿå®¹æ˜“å¾—å‡ºï¼Œ<strong>åªæœ‰å¼•ç”¨ç±»å‹çš„å˜é‡æ‰è¢«è®¤ä¸ºæ˜¯ Roots ï¼Œå€¼ç±»å‹çš„å˜é‡æ°¸è¿œä¸è¢«è®¤ä¸ºæ˜¯ Roots</strong>ã€‚åªæœ‰æ·±åˆ»ç†è§£å¼•ç”¨ç±»å‹å’Œå€¼ç±»å‹çš„å†…å­˜åˆ†é…å’Œç®¡ç†çš„ä¸åŒï¼Œæ‰èƒ½çŸ¥é“ä¸ºä»€ä¹ˆ root åªèƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p>åœ¨Javaè¯­è¨€ä¸­ï¼Œå¯ä»¥åšä¸º GC Roots çš„å¯¹è±¡åŒ…æ‹¬ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å®ä½“å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ã€‚</li></ul><p>å¯ä»¥æ¦‚æ‹¬å¾—å‡ºï¼Œå¯ä½œä¸º GC Roots çš„èŠ‚ç‚¹ä¸»è¦åœ¨<strong>å…¨å±€æ€§çš„å¼•ç”¨</strong>ä¸<strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ä¸­ã€‚è¦æ˜ç¡®çš„æ˜¯ï¼Œtracing gc å¿…é¡»ä»¥å½“å‰å­˜æ´»çš„å¯¹è±¡é›†ä¸ºRootsï¼Œå› æ­¤å¿…é¡»é€‰å–ç¡®å®šå­˜æ´»çš„å¼•ç”¨ç±»å‹å¯¹è±¡ã€‚GC ç®¡ç†çš„åŒºåŸŸæ˜¯ Java å †ï¼Œ<strong>è™šæ‹Ÿæœºæ ˆ</strong>ã€<strong>æ–¹æ³•åŒº</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ä¸è¢« GC æ‰€ç®¡ç†ï¼Œå› æ­¤é€‰ç”¨è¿™äº›åŒºåŸŸå†…å¼•ç”¨çš„å¯¹è±¡ä½œä¸º GC Roots ï¼Œæ˜¯ä¸ä¼šè¢« GC æ‰€å›æ”¶çš„ã€‚å…¶ä¸­è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œåªè¦çº¿ç¨‹æ²¡æœ‰ç»ˆæ­¢ï¼Œå°±èƒ½ç¡®ä¿å®ƒä»¬ä¸­å¼•ç”¨çš„å¯¹è±¡çš„å­˜æ´»ã€‚è€Œæ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡æ˜¯æ˜¾ç„¶å­˜æ´»çš„ã€‚å¸¸é‡å¼•ç”¨çš„å¯¹è±¡åœ¨å½“å‰å¯èƒ½å­˜æ´»ï¼Œå› æ­¤ï¼Œä¹Ÿå¯èƒ½æ˜¯ GC roots çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨ JDK1.2ä¹‹åï¼ŒJavaå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨4ç§ï¼Œè¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡å‡å¼±ã€‚</p><h4 id="ä¸¤æ¬¡æ ‡è®°ä¸-finalize-æ–¹æ³•"><a href="#ä¸¤æ¬¡æ ‡è®°ä¸-finalize-æ–¹æ³•" class="headerlink" title="ä¸¤æ¬¡æ ‡è®°ä¸ finalize()æ–¹æ³•"></a>ä¸¤æ¬¡æ ‡è®°ä¸ <code>finalize()</code>æ–¹æ³•</h4><p>å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯ä¸€å®šä¼šæ­»äº¡çš„ï¼Œå®ƒä»¬æš‚æ—¶éƒ½å¤„äºã€ç¼“åˆ‘ã€é˜¶æ®µï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡ã€æ­»äº¡ã€ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p><ol><li><p>å¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸ GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«<strong>ç¬¬ä¸€æ¬¡æ ‡è®°</strong>å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯<strong>æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize</strong>()æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†å†™<code>finalize()</code>æ–¹æ³•ï¼Œæˆ–è€…<code>finalize()</code>æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºã€æ²¡æœ‰å¿…è¦æ‰§è¡Œã€ã€‚</p></li><li><p>å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œ<code>finalize()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡å°†ä¼šæ”¾ç½®åœ¨ä¸€ä¸ªå«åš F-Queue çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€ä¸ªè™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½ä¼˜å…ˆçº§çš„ Finalizer çº¿ç¨‹å»æ‰§è¡Œå®ƒã€‚è¿™é‡Œæ‰€è°“çš„ã€æ‰§è¡Œã€æ˜¯æŒ‡è™šæ‹Ÿæœºä¼šè§¦å‘æ­¤æ–¹æ³•ï¼Œä½†å¹¶ä¸æ‰¿è¯ºä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸï¼ŒåŸå› æ˜¯ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨<code>finalize()</code>æ–¹æ³•ä¸­æ‰§è¡Œç¼“æ…¢ï¼Œæˆ–è€…å‘ç”Ÿäº†æ­»å¾ªç¯ï¼ˆæ›´æç«¯çš„æƒ…å†µï¼‰ï¼Œå°†å¾ˆå¯èƒ½å¯¼è‡´ F-Queue é˜Ÿåˆ—ä¸­çš„å…¶å®ƒå¯¹è±¡æ°¸ä¹…å¤„äºç­‰å¾…ï¼Œç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›æ”¶ç³»ç»Ÿå´©æºƒã€‚</p><p> <code>finalize()</code>æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼šï¼Œç¨å GC å°†å¯¹ F-Queue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œ<strong>ç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°</strong>ã€‚å¦‚æœå¯¹è±¡æƒ³åœ¨<code>finalize()</code>æ–¹æ³•ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±ï¼Œåªè¦<strong>é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯</strong>ï¼Œä¾‹å¦‚æŠŠ<strong>è‡ªå·±ï¼ˆthiså…³é”®å­—ï¼‰èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡</strong>ï¼Œè¿™æ ·åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†è¢«ç§»å‡ºã€å³å°†å›æ”¶ã€çš„é›†åˆï¼›å¦‚æœå¯¹è±¡è¿™æ—¶å€™è¿˜æ²¡æœ‰é€ƒè„±ï¼ŒåŸºæœ¬ä¸Šå®ƒå°±çœŸçš„è¢«å›æ”¶äº†ã€‚</p></li></ol><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»£ç ä¸­æœ‰ä¸¤æ®µä¸€æ¨¡ä¸€æ ·çš„ä»£ç æ®µï¼Œæ‰§è¡Œç»“æœå´æ˜¯ä¸€æ¬¡é€ƒè„±æˆåŠŸï¼Œä¸€æ¬¡å¤±è´¥ã€‚è¿™æ˜¯å› ä¸ºä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•éƒ½åªä¼šè¢«ç³»ç»Ÿè°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœå¯¹è±¡é¢ä¸´ä¸‹ä¸€æ¬¡å›æ”¶ï¼Œå®ƒçš„<code>finalize()</code>æ–¹æ³•ä¸ä¼šå†è¢«æ‰§è¡Œï¼Œå› æ­¤ç¬¬äºŒæ¬¡é€ƒè„±è¡ŒåŠ¨å¤±è´¥ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä½¿ç”¨<code>finalize()</code>æ–¹æ³•æ¥ã€æ‹¯æ•‘ã€å¯¹è±¡æ˜¯ä¸å€¼å¾—æå€¡çš„ï¼Œå› ä¸ºå®ƒä¸æ˜¯ C/C++ ä¸­çš„ææ„å‡½æ•°ï¼Œè€Œæ˜¯ Java åˆšè¯ç”Ÿæ—¶ä¸ºäº†ä½¿ C/C++ ç¨‹åºå‘˜æ›´å®¹æ˜“æ¥å—å®ƒæ‰€åšçš„ä¸€ä¸ªå¦¥åã€‚å®ƒçš„<strong>è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåº</strong>ã€‚<code>finalize()</code>èƒ½åšçš„å·¥ä½œï¼Œä½¿ç”¨ <code>try-catch-finally</code> æˆ–è€…å…¶å®ƒæ–¹æ³•éƒ½æ›´é€‚åˆã€åŠæ—¶ï¼Œæ‰€ä»¥å…”å­å»ºè®®å¤§å®¶å¯ä»¥å¿˜æ‰æ­¤æ–¹æ³•çš„å­˜åœ¨ã€‚</p><h3 id="3ã€ä»€ä¹ˆæ—¶å€™è§¦å‘GC"><a href="#3ã€ä»€ä¹ˆæ—¶å€™è§¦å‘GC" class="headerlink" title="3ã€ä»€ä¹ˆæ—¶å€™è§¦å‘GC"></a>3ã€ä»€ä¹ˆæ—¶å€™è§¦å‘GC</h3><ul><li>ç¨‹åºè°ƒç”¨<code>System.gc()</code>æ—¶å¯ä»¥è§¦å‘</li><li>ç³»ç»Ÿè‡ªèº«æ¥å†³å®š GC è§¦å‘çš„æ—¶æœºï¼ˆæ ¹æ® Eden åŒºå’Œ From Space åŒºçš„å†…å­˜å¤§å°æ¥å†³å®šã€‚å½“å†…å­˜å¤§å°ä¸è¶³æ—¶ï¼Œåˆ™ä¼šå¯åŠ¨ GC çº¿ç¨‹å¹¶åœæ­¢åº”ç”¨çº¿ç¨‹ï¼‰ã€‚</li></ul><p>ä¸Šæ–‡æåˆ°äº† Minor GC å’Œ Full GCï¼Œè¿™ä¸¤ç§ GC è§¦å‘çš„æ¡ä»¶ä¹Ÿä¸å¤ªç›¸åŒï¼š</p><ul><li><strong>Minor GC è§¦å‘</strong>ï¼šå½“ Eden åŒºæ»¡æ—¶è§¦å‘</li><li><strong>Full GC è§¦å‘</strong>ï¼š<ul><li>è°ƒç”¨<code>System.gc()</code>æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡Œ Full GCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œ</li><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li><li>é€šè¿‡ Minor GC åè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li><li>ç”± Eden åŒºã€S0 åŒºå‘ S1 åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äº S1 å¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è¯¥å¯¹è±¡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li></ul></li></ul><h3 id="4ã€GCåšäº†ä»€ä¹ˆäº‹"><a href="#4ã€GCåšäº†ä»€ä¹ˆäº‹" class="headerlink" title="4ã€GCåšäº†ä»€ä¹ˆäº‹"></a>4ã€GCåšäº†ä»€ä¹ˆäº‹</h3><p>ä¸»è¦åšäº†æ¸…ç†å¯¹è±¡ï¼Œæ•´ç†å†…å­˜çš„å·¥ä½œã€‚Javaå †åˆ†ä¸º<strong>æ–°ç”Ÿä»£</strong>å’Œ<strong>è€å¹´ä»£</strong>ï¼Œé‡‡ç”¨äº†ä¸åŒçš„å›æ”¶æ–¹å¼ã€‚ï¼ˆå›æ”¶æ–¹å¼å³å›æ”¶ç®—æ³•è¯¦è§åæ–‡ï¼‰</p><h2 id="äºŒã€GCå¸¸ç”¨ç®—æ³•"><a href="#äºŒã€GCå¸¸ç”¨ç®—æ³•" class="headerlink" title="äºŒã€GCå¸¸ç”¨ç®—æ³•"></a>äºŒã€GCå¸¸ç”¨ç®—æ³•</h2><p>GCå¸¸ç”¨ç®—æ³•æœ‰ï¼š<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼Œ<strong>æ ‡è®°-å‹ç¼©ç®—æ³•</strong>ï¼Œ<strong>å¤åˆ¶ç®—æ³•</strong>ï¼Œ<strong>åˆ†ä»£æ”¶é›†ç®—æ³•</strong>ã€‚</p><p>::: tip<br>ç›®å‰ä¸»æµçš„JVMï¼ˆHotSpotï¼‰é‡‡ç”¨çš„æ˜¯åˆ†ä»£æ”¶é›†ç®—æ³•ã€‚<br>::: </p><h3 id="1-æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#1-æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="1. æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>1. æ ‡è®°-æ¸…é™¤ç®—æ³•</h3><p>ä¸ºæ¯ä¸ªå¯¹è±¡å­˜å‚¨ä¸€ä¸ªæ ‡è®°ä½ï¼Œè®°å½•å¯¹è±¡çš„çŠ¶æ€ï¼ˆæ´»ç€æˆ–æ˜¯æ­»äº¡ï¼‰ã€‚åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯æ ‡è®°é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå†…ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡æ›´æ–°æ ‡è®°ä½ï¼Œæ£€æŸ¥å¯¹è±¡æ˜¯å¦æ­»äº¡ï¼›ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯æ¸…é™¤é˜¶æ®µï¼Œè¯¥é˜¶æ®µå¯¹æ­»äº¡çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ï¼Œæ‰§è¡Œ GC æ“ä½œã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/34.jpeg"></p><ul><li><span style="color: green">ä¼˜ç‚¹</span>ï¼šæ ‡è®°â€”æ¸…é™¤ç®—æ³•ä¸­<strong>æ¯ä¸ªæ´»ç€çš„å¯¹è±¡çš„å¼•ç”¨åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå³å¯</strong>ï¼Œæ‰¾åˆ°ä¸€ä¸ªå°±å¯ä»¥åˆ¤æ–­å®ƒä¸ºæ´»çš„ã€‚æ­¤å¤–ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªç®—æ³•å¹¶ä¸ç§»åŠ¨å¯¹è±¡çš„ä½ç½®ã€‚</li><li><span style="color: red">ç¼ºç‚¹</span>ï¼šæ•ˆç‡æ¯”è¾ƒä½ï¼ˆé€’å½’ä¸å…¨å †å¯¹è±¡éå†ï¼‰ã€‚æ¯ä¸ªæ´»ç€çš„å¯¹è±¡éƒ½è¦åœ¨æ ‡è®°é˜¶æ®µéå†ä¸€éï¼›æ‰€æœ‰å¯¹è±¡éƒ½è¦åœ¨æ¸…é™¤é˜¶æ®µæ‰«æä¸€éï¼Œå› æ­¤ç®—æ³•å¤æ‚åº¦è¾ƒé«˜ã€‚æ²¡æœ‰ç§»åŠ¨å¯¹è±¡ï¼Œå¯¼è‡´å¯èƒ½<strong>å‡ºç°å¾ˆå¤šç¢ç‰‡ç©ºé—´æ— æ³•åˆ©ç”¨</strong>çš„æƒ…å†µã€‚</li></ul><h3 id="2-æ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•"><a href="#2-æ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•" class="headerlink" title="2. æ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•"></a>2. æ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•</h3><p><strong>æ ‡è®°-å‹ç¼©</strong>æ˜¯ <strong>æ ‡è®°-æ¸…é™¤</strong>çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆã€‚åŒæ ·ï¼Œåœ¨æ ‡è®°é˜¶æ®µï¼Œè¯¥ç®—æ³•ä¹Ÿå°†æ‰€æœ‰å¯¹è±¡æ ‡è®°ä¸ºå­˜æ´»å’Œæ­»äº¡ä¸¤ç§çŠ¶æ€ï¼›ä¸åŒçš„æ˜¯ï¼Œåœ¨ç¬¬äºŒä¸ªé˜¶æ®µï¼Œè¯¥ç®—æ³•å¹¶æ²¡æœ‰ç›´æ¥å¯¹æ­»äº¡çš„å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯å°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡æ•´ç†ä¸€ä¸‹ï¼Œæ”¾åˆ°å¦ä¸€å¤„ç©ºé—´ï¼Œç„¶åæŠŠå‰©ä¸‹çš„æ‰€æœ‰å¯¹è±¡å…¨éƒ¨æ¸…é™¤ã€‚è¿™æ ·å°±è¾¾åˆ°äº†æ ‡è®°-æ•´ç†çš„ç›®çš„ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/35.jpeg"></p><p>å·¦è¾¹æ˜¯æ ‡è®°é˜¶æ®µï¼Œå³è¾¹æ˜¯æ•´ç†ä¹‹åçš„çŠ¶æ€ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç®—æ³•ä¸ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡å†…å­˜ç©ºé—´ã€‚</p><ul><li><span style="color: green">ä¼˜ç‚¹</span>ï¼šè¯¥ç®—æ³•ä¸ä¼šåƒæ ‡è®°-æ¸…é™¤ç®—æ³•é‚£æ ·äº§ç”Ÿå¤§é‡çš„ç¢ç‰‡ç©ºé—´ã€‚</li><li><span style="color: red">ç¼ºç‚¹</span>ï¼šå¦‚æœå­˜æ´»çš„å¯¹è±¡è¿‡å¤šï¼Œæ•´ç†é˜¶æ®µå°†ä¼šæ‰§è¡Œè¾ƒå¤šå¤åˆ¶æ“ä½œï¼Œå¯¼è‡´ç®—æ³•æ•ˆç‡é™ä½ã€‚</li></ul><h3 id="3-å¤åˆ¶ç®—æ³•"><a href="#3-å¤åˆ¶ç®—æ³•" class="headerlink" title="3. å¤åˆ¶ç®—æ³•"></a>3. å¤åˆ¶ç®—æ³•</h3><p>è¯¥ç®—æ³•å°†å†…å­˜å¹³å‡åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç„¶åæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå½“è¿™éƒ¨åˆ†å†…å­˜æ»¡çš„æ—¶å€™ï¼Œå°†å†…å­˜ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜ä¸­ï¼Œç„¶åå°†ä¹‹å‰çš„å†…å­˜æ¸…ç©ºï¼Œåªä½¿ç”¨è¿™éƒ¨åˆ†å†…å­˜ï¼Œå¾ªç¯ä¸‹å»ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/36.jpeg"></p><p>è¿™ä¸ªç®—æ³•ä¸æ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•çš„åŒºåˆ«åœ¨äºï¼Œè¯¥ç®—æ³•ä¸æ˜¯åœ¨åŒä¸€ä¸ªåŒºåŸŸå¤åˆ¶ï¼Œè€Œæ˜¯å°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªåŒºåŸŸå†…ã€‚</p><ul><li><span style="color: green">ä¼˜ç‚¹</span>ï¼šå®ç°ç®€å•ï¼›ä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡</li><li><span style="color: red">ç¼ºç‚¹</span>ï¼šæ¯æ¬¡è¿è¡Œï¼Œæ€»æœ‰ä¸€åŠå†…å­˜æ˜¯ç©ºçš„ï¼Œå¯¼è‡´å¯ä½¿ç”¨çš„å†…å­˜ç©ºé—´åªæœ‰åŸæ¥çš„ä¸€åŠã€‚</li></ul><h3 id="4-åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#4-åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="4. åˆ†ä»£æ”¶é›†ç®—æ³•"></a>4. åˆ†ä»£æ”¶é›†ç®—æ³•</h3><p>ç°åœ¨çš„è™šæ‹Ÿæœº GC å¤§å¤šé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå®ƒæ ¹æ®å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸï¼Œå°†å †åˆ†ä¸ºæ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰å’Œè€å¹´ä»£ï¼ˆTenured Generationï¼‰ã€‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œç”±äºå¯¹è±¡ç”Ÿå­˜æœŸçŸ­ï¼Œæ¯æ¬¡å›æ”¶éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œé‚£ä¹ˆè¿™æ—¶å°±é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚è€å¹´ä»£é‡Œçš„å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<strong>æ ‡è®°-æ•´ç†</strong>æˆ–è€…<strong>æ ‡è®°-æ¸…é™¤</strong>ã€‚</p><p>æ–°ç”Ÿä»£åˆåˆ†ä¸º Eden åŒºã€From Survivor 0ï¼ˆS0ï¼‰åŒºã€To Survivor 1ï¼ˆS1ï¼‰åŒºã€‚</p><p>è€å¹´ä»£ä¸åˆ†åŒºã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div class="center-img"><p><img src="/img/37.png"></p></div><p>å½“ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæ€»æ˜¯åœ¨ Eden åŒºæ“ä½œï¼Œå½“è¿™ä¸ªåŒºæ»¡äº†ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ä¸€æ¬¡ Young GCï¼Œä¹Ÿå°±æ˜¯å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ã€‚ä¸€èˆ¬æ¥è¯´è¿™æ—¶å€™ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½æ²¡ç”¨äº†ï¼Œæ‰€ä»¥å°±ä¼šæŠŠè¿˜èƒ½ç”¨çš„å¯¹è±¡å¤åˆ¶åˆ° S0 åŒºã€‚ </p><blockquote><p>Minor GC ä¸ Young GC å¹¶ä¸ç›¸åŒã€‚Minor GC åªè´Ÿè´£ Eden åŒºï¼Œè€Œ Young GC è´Ÿè´£ Eden + S0 + S1 ä¸‰ä¸ªåŒº</p></blockquote><div class="center-img"><p><img src="/img/38.png"></p></div><p>è¿™æ ·æ•´ä¸ª Eden åŒºå°±è¢«æ¸…ç†å¹²å‡€äº†ï¼Œå¯ä»¥ç»§ç»­åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå½“ Eden åŒºå†æ¬¡è¢«ç”¨å®Œï¼Œå°±å†è§¦å‘ä¸€æ¬¡ Young GCã€‚ç„¶åå‘¢ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™è·Ÿåˆšæ‰ç¨ç¨æœ‰ç‚¹åŒºåˆ«ã€‚è¿™æ¬¡è§¦å‘ Young GC åï¼Œä¼šå°† Eden åŒºè¿˜åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡ä¸ S0 åŒºè¿˜åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡å¤åˆ¶åˆ° S1 åŒºã€‚</p><div class="center-img"><p><img src="/img/39.png"></p></div><p>å†ä¸‹ä¸€æ¬¡ Young GC çš„æ—¶å€™ï¼Œåˆ™æ˜¯å°† Eden åŒºè¿˜åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡ä¸ S1 åŒºä¸­è¿˜åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡å¤åˆ¶åˆ° S0 åŒºã€‚</p><div class="center-img"><p><img src="/img/40.png"></p></div><p>ç»è¿‡è‹¥å¹²æ¬¡ Young GC åï¼Œæœ‰äº›å¯¹è±¡åœ¨ S0 ä¸ S1 ä¹‹é—´æ¥å›æ¸¸è¡ï¼Œæ¯å¤åˆ¶ä¸€æ¬¡ï¼Œå¹´é¾„å°± +1ï¼Œè¿™æ—¶å€™ S0 åŒºä¸ S1 åŒºäº®å‡ºäº†åº•çº¿ï¼ˆä¸´ç•Œå€¼ï¼Œç”±<code>-XX:MaxTenuringThreshold</code>æ¥è®¾ï¼ŒHotSpotè™šæ‹Ÿæœºé»˜è®¤ä¸º 15ï¼‰ï¼Œè¿™äº›å®¶ä¼™è¦æ˜¯åˆ°ç°åœ¨è¿˜æ²¡æŒ‚æ‰ï¼Œæ­å–œä½ ä»¬ï¼Œä½ ä»¬å·²ç»é•¿å¤§äº†ï¼Œå»ï¼ˆå¤åˆ¶åˆ°ï¼‰è€å¹´ä»£å§ã€‚ </p><div class="center-img"><p><img src="/img/41.png"></p></div><p>è€å¹´ä»£ç»è¿‡è¿™ä¹ˆå‡ æ¬¡æŠ˜è…¾ï¼Œä¹Ÿå°±æ‰›ä¸ä½äº†ï¼ˆç©ºé—´è¢«ç”¨å®Œï¼‰ï¼Œå¥½ï¼Œé‚£å°±æ¥æ¬¡é›†ä½“å¤§æ‰«é™¤ï¼ˆFull GCï¼‰ï¼Œä¹Ÿå°±æ˜¯å…¨é‡å›æ”¶ã€‚å¦‚æœ Full GC ä½¿ç”¨å¤ªé¢‘ç¹çš„è¯ï¼Œæ— ç–‘ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½äº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚æ‰€ä»¥è¦åˆç†è®¾ç½®å¹´è½»ä»£ä¸è€å¹´ä»£çš„å¤§å°ï¼Œå°½é‡å‡å°‘ Full GC çš„æ“ä½œã€‚</p><h2 id="ä¸‰ã€åƒåœ¾æ”¶é›†å™¨"><a href="#ä¸‰ã€åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ä¸‰ã€åƒåœ¾æ”¶é›†å™¨"></a>ä¸‰ã€åƒåœ¾æ”¶é›†å™¨</h2><p>å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚</p><p>Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•å®ç°å¹¶æ²¡æœ‰ä»»ä½•è§„å®šï¼Œå› æ­¤ä¸åŒçš„å‚å•†ã€ç‰ˆæœ¬çš„è™šæ‹Ÿæœºæ‰€æä¾›çš„åƒåœ¾æ”¶é›†å™¨éƒ½å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®åˆ«ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½ä¼šæä¾›å‚æ•°ä¾›ç”¨æˆ·æ ¹æ®è‡ªå·±çš„åº”ç”¨ç‰¹ç‚¹å’Œè¦æ±‚<strong>ç»„åˆå‡ºå„ä¸ªå¹´ä»£æ‰€ä½¿ç”¨çš„æ”¶é›†å™¨</strong>ã€‚æ¥ä¸‹æ¥è®¨è®ºçš„æ”¶é›†å™¨åŸºäº JDK1.7 Update 14 ä¹‹åçš„ HotSpot è™šæ‹Ÿæœºï¼ˆåœ¨æ­¤ç‰ˆæœ¬ä¸­æ­£å¼æä¾›äº†å•†ç”¨çš„ G1 æ”¶é›†å™¨ï¼Œä¹‹å‰ G1 ä»å¤„äºå®éªŒçŠ¶æ€ï¼‰ï¼Œè¯¥è™šæ‹ŸæœºåŒ…å«çš„æ‰€æœ‰æ”¶é›†å™¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div class="center-img"><p><img src="/img/42.png"></p></div><p>ä¸Šå›¾å±•ç¤ºäº†7ç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ï¼Œå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚æ”¶é›†å™¨æ‰€å¤„çš„åŒºåŸŸï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯å±äºæ–°ç”Ÿä»£æ”¶é›†å™¨è¿˜æ˜¯è€å¹´ä»£æ”¶é›†å™¨ã€‚Hotspot å®ç°äº†å¦‚æ­¤å¤šçš„æ”¶é›†å™¨ï¼Œæ­£æ˜¯å› ä¸ºç›®å‰å¹¶æ— å®Œç¾çš„æ”¶é›†å™¨å‡ºç°ï¼Œåªæ˜¯é€‰æ‹©å¯¹å…·ä½“åº”ç”¨æœ€é€‚åˆçš„æ”¶é›†å™¨ã€‚</p><p>å…ˆè§£é‡Šä¸€äº›ä¸‹é¢ä¼šç”¨åˆ°çš„æ¦‚å¿µï¼š</p><ul><li>å¹¶è¡Œå’Œå¹¶å‘<ul><li>å¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡<strong>å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œ</strong>ï¼Œä½†æ­¤æ—¶<strong>ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€</strong>ã€‚</li><li>å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡<strong>ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œ</strong>ï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œã€‚è€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Šã€‚</li></ul></li><li>ååé‡ï¼ˆThroughputï¼‰ååé‡å°±æ˜¯ CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³<code>ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰</code>ã€‚å‡è®¾è™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚</li></ul><p>ä¸‹é¢é€ä¸ªä»‹ç»ä¸Šé¢çš„7ç§æ”¶é›†å™¨ã€‚</p><h3 id="æ–°ç”Ÿä»£æ”¶é›†å™¨"><a href="#æ–°ç”Ÿä»£æ”¶é›†å™¨" class="headerlink" title="æ–°ç”Ÿä»£æ”¶é›†å™¨"></a>æ–°ç”Ÿä»£æ”¶é›†å™¨</h3><h4 id="1-Serial-æ”¶é›†å™¨"><a href="#1-Serial-æ”¶é›†å™¨" class="headerlink" title="1. Serial æ”¶é›†å™¨"></a>1. Serial æ”¶é›†å™¨</h4><p><strong>Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨</strong>æ˜¯æœ€åŸºæœ¬ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ï¼Œå®ƒæ˜¯é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œæ›¾ç»ï¼ˆJDK 1.3.1ä¹‹å‰ï¼‰æ˜¯è™šæ‹Ÿæœºæ–°ç”Ÿä»£æ”¶é›†çš„å”¯ä¸€é€‰æ‹©ã€‚å®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´è‡³ Serial æ”¶é›†å™¨æ”¶é›†ç»“æŸä¸ºæ­¢ï¼ˆä¹Ÿå³ Stop the Worldï¼‰ã€‚è¿™é¡¹å·¥ä½œæ˜¯ç”±è™šæ‹Ÿæœºåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆçš„ï¼Œåœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹æŠŠç”¨æˆ·æ­£å¸¸å·¥ä½œçš„çº¿ç¨‹å…¨éƒ¨åœæ‰ï¼Œè¿™å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´æ˜¯éš¾ä»¥æ¥å—çš„ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº† Serial æ”¶é›†å™¨ï¼ˆè€å¹´ä»£é‡‡ç”¨ Serial Old æ”¶é›†å™¨ï¼‰çš„è¿è¡Œè¿‡ç¨‹ï¼š</p><div class="center-img"><p><img src="/img/43.jpeg"></p></div><p>ä¸ºäº†æ¶ˆé™¤æˆ–å‡å°‘å·¥ä½œçº¿ç¨‹å› å†…å­˜å›æ”¶è€Œå¯¼è‡´çš„åœé¡¿ï¼ŒHotSpot è™šæ‹Ÿæœºå¼€å‘å›¢é˜Ÿåœ¨ JDK 1.3 ä¹‹åçš„ Java å‘å±•å†ç¨‹ä¸­ç ”å‘å‡ºäº†å„ç§å…¶ä»–çš„ä¼˜ç§€æ”¶é›†å™¨ï¼Œè¿™äº›å°†åœ¨ç¨åä»‹ç»ã€‚ä½†æ˜¯è¿™äº›æ”¶é›†å™¨çš„è¯ç”Ÿå¹¶ä¸æ„å‘³ç€ Serial æ”¶é›†å™¨å·²ç»ã€è€è€Œæ— ç”¨ã€ï¼Œå®é™…ä¸Šåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå®ƒ<strong>ä¾ç„¶æ˜¯ HotSpot è™šæ‹Ÿæœºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„é»˜è®¤çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚</strong> å®ƒä¹Ÿæœ‰ç€ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼š<strong>ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ª CPU çš„ç¯å¢ƒæ¥è¯´ï¼ŒSerial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æ›´é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚</strong></p><p>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬ä¸ä¼šå¾ˆå¤§ï¼Œæ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£ï¼ˆä»…ä»…æ˜¯æ–°ç”Ÿä»£ä½¿ç”¨çš„å†…å­˜ï¼Œæ¡Œé¢åº”ç”¨åŸºæœ¬ä¸ä¼šå†å¤§äº†ï¼‰ï¼Œåœé¡¿æ—¶é—´å®Œå…¨å¯ä»¥æ§åˆ¶åœ¨å‡ åæ¯«ç§’æœ€å¤šä¸€ç™¾æ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œè¿™ç‚¹åœé¡¿æ—¶é—´å¯ä»¥æ¥å—ã€‚æ‰€ä»¥ï¼ŒSerial æ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><h4 id="2-ParNew-æ”¶é›†å™¨"><a href="#2-ParNew-æ”¶é›†å™¨" class="headerlink" title="2. ParNew æ”¶é›†å™¨"></a>2. ParNew æ”¶é›†å™¨</h4><p>ParNewæ”¶é›†å™¨å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬ Serial æ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ï¼ˆå¤åˆ¶ç®—æ³•ï¼‰ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰ä¸ Serial æ”¶é›†å™¨å®Œå…¨ç›¸åŒï¼Œä¸¤è€…å…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ã€‚</p><p>ParNewæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼ˆè€å¹´ä»£é‡‡ç”¨Serial Oldæ”¶é›†å™¨ï¼‰ï¼š</p><div class="center-img"><p><img src="/img/44.jpeg"></p></div><p>ParNew æ”¶é›†å™¨é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹æ”¶é›†å¤–ï¼Œå…¶ä»–ä¸ Serial æ”¶é›†å™¨ç›¸æ¯”å¹¶æ— å¤ªå¤šåˆ›æ–°ä¹‹å¤„ï¼Œä½†å®ƒå´æ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä¸­é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸æ€§èƒ½æ— å…³çš„é‡è¦åŸå› æ˜¯ï¼Œ<strong>é™¤äº† Serial æ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½å’Œ CMS æ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰é…åˆå·¥ä½œ</strong>ï¼ŒCMS æ”¶é›†å™¨æ˜¯ JDK 1.5 æ¨å‡ºçš„ä¸€ä¸ªå…·æœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„æ”¶é›†å™¨ï¼Œå…·ä½“å†…å®¹å°†åœ¨ç¨åè¿›è¡Œä»‹ç»ã€‚</p><p>ParNew æ”¶é›†å™¨åœ¨å•CPUçš„ç¯å¢ƒä¸­ç»å¯¹ä¸ä¼šæœ‰æ¯” Serial æ”¶é›†å™¨æœ‰æ›´å¥½çš„æ•ˆæœï¼Œç”šè‡³ç”±äºå­˜åœ¨çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè¯¥æ”¶é›†å™¨åœ¨é€šè¿‡è¶…çº¿ç¨‹æŠ€æœ¯å®ç°çš„ä¸¤ä¸ª CPU çš„ç¯å¢ƒä¸­éƒ½ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾åœ°ä¿è¯å¯ä»¥è¶…è¶Š Serial æ”¶é›†å™¨ã€‚åœ¨å¤š CPU ç¯å¢ƒä¸‹ï¼Œéšç€ CPU çš„æ•°é‡å¢åŠ ï¼Œå®ƒå¯¹äº GC æ—¶ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨æ˜¯å¾ˆæœ‰å¥½å¤„çš„ã€‚å®ƒé»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸ CPU çš„æ•°é‡ç›¸åŒï¼Œåœ¨ CPU éå¸¸å¤šçš„æƒ…å†µä¸‹å¯ä½¿ç”¨<code>-XX:ParallerGCThreads</code>å‚æ•°è®¾ç½®ã€‚</p><h4 id="3-Parallel-Scavenge-æ”¶é›†å™¨"><a href="#3-Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="3. Parallel Scavenge æ”¶é›†å™¨"></a>3. Parallel Scavenge æ”¶é›†å™¨</h4><p>Parallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„å¤šçº¿ç¨‹æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå®ƒä¹Ÿä½¿ç”¨å¤åˆ¶ç®—æ³•ã€‚Parallel Scavenge æ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼ŒCMS ç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œ Parallel Scavenge æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯<strong>è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰</strong>ã€‚</p><p>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨<strong>åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</strong>ã€‚</p><p>Parallel Scavenge æ”¶é›†å™¨é™¤äº†ä¼šæ˜¾è€Œæ˜“è§åœ°æä¾›å¯ä»¥ç²¾ç¡®æ§åˆ¶ååé‡çš„å‚æ•°ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå‚æ•°<code>-XX:+UseAdaptiveSizePolicy</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œæ‰“å¼€å‚æ•°åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ<code>-Xmn</code>ï¼‰ã€Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹ï¼ˆ<code>-XX:SurvivorRatio</code>ï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ<code>-XX:PretenureSizeThreshold</code>ï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºGCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ã€‚è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯ Parallel Scavenge æ”¶é›†å™¨ä¸ ParNew æ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚</p><p>å¦å¤–å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒParallel Scavenge æ”¶é›†å™¨æ— æ³•ä¸ CMS æ”¶é›†å™¨é…åˆä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ JDK 1.6 æ¨å‡º Parallel Old ä¹‹å‰ï¼Œ<strong>å¦‚æœæ–°ç”Ÿä»£é€‰æ‹© Parallel Scavenge æ”¶é›†å™¨ï¼Œè€å¹´ä»£åªæœ‰ Serial Old æ”¶é›†å™¨èƒ½ä¸ä¹‹é…åˆä½¿ç”¨</strong>ã€‚</p><p>Parallel Scavenge æ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><div class="center-img"><p><img src="/img/45.jpeg"></p></div><h3 id="è€å¹´ä»£æ”¶é›†å™¨"><a href="#è€å¹´ä»£æ”¶é›†å™¨" class="headerlink" title="è€å¹´ä»£æ”¶é›†å™¨"></a>è€å¹´ä»£æ”¶é›†å™¨</h3><h4 id="1-Serial-Old-æ”¶é›†å™¨"><a href="#1-Serial-Old-æ”¶é›†å™¨" class="headerlink" title="1. Serial Old æ”¶é›†å™¨"></a>1. Serial Old æ”¶é›†å™¨</h4><p>Serial Old æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ª<strong>å•çº¿ç¨‹</strong>æ”¶é›†å™¨ï¼Œä½¿ç”¨ã€æ ‡è®°-æ•´ç†ã€ç®—æ³•ã€‚</p><p>æ­¤æ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯åœ¨äºç»™ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœåœ¨ Serve ræ¨¡å¼ä¸‹ï¼Œå®ƒè¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼š</p><ul><li>åœ¨ JDK1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</li><li>ä½œä¸º CM æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ã€‚</li></ul><p>å®ƒçš„å·¥ä½œæµç¨‹ä¸Serialæ”¶é›†å™¨å®Œå…¨ç›¸åŒã€‚</p><h4 id="2-Parallel-Old-æ”¶é›†å™¨"><a href="#2-Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="2. Parallel Old æ”¶é›†å™¨"></a>2. Parallel Old æ”¶é›†å™¨</h4><p>Parallel Old æ”¶é›†å™¨æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œã€æ ‡è®°-æ•´ç†ã€ç®—æ³•ã€‚å‰é¢å·²ç»æåˆ°è¿‡ï¼Œè¿™ä¸ªæ”¶é›†å™¨æ˜¯åœ¨JDK 1.6 ä¸­æ‰å¼€å§‹æä¾›çš„ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå¦‚æœæ–°ç”Ÿä»£é€‰æ‹©äº† Parallel Scavenge æ”¶é›†å™¨ï¼Œè€å¹´ä»£é™¤äº† Serial Old ä»¥å¤–åˆ«æ— é€‰æ‹©ï¼Œæ‰€ä»¥åœ¨Parallel Old è¯ç”Ÿä»¥åï¼Œã€ååé‡ä¼˜å…ˆã€æ”¶é›†å™¨ç»ˆäºæœ‰äº†æ¯”è¾ƒåå‰¯å…¶å®çš„åº”ç”¨ç»„åˆï¼Œåœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨ã€‚Parallel Old æ”¶é›†å™¨çš„å·¥ä½œæµç¨‹ä¸ Parallel Scavenge å®Œå…¨ç›¸åŒã€‚</p><h4 id="3-CMSæ”¶é›†å™¨"><a href="#3-CMSæ”¶é›†å™¨" class="headerlink" title="3. CMSæ”¶é›†å™¨"></a>3. CMSæ”¶é›†å™¨</h4><p>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥<strong>è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå®ƒéå¸¸ç¬¦åˆé‚£äº›é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€… B/S ç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šçš„ Java åº”ç”¨ï¼Œè¿™äº›åº”ç”¨éƒ½éå¸¸é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ã€‚ä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯åŸºäºã€æ ‡è®°-æ¸…é™¤ã€ç®—æ³•å®ç°çš„ã€‚</p><p>CMSæ”¶é›†å™¨å·¥ä½œçš„æ•´ä¸ªæµç¨‹åˆ†ä¸ºä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰</strong>ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦ Stop The Worldã€‚</li><li><strong>å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰</strong>ï¼šè¿›è¡Œ GC Roots Tracing çš„è¿‡ç¨‹ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰</strong>ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°çš„æ—¶é—´çŸ­ã€‚æ­¤é˜¶æ®µä¹Ÿéœ€è¦ Stop The Worldã€‚</li><li><strong>å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰</strong></li></ul><p>ç”±äºæ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥ï¼Œä»æ€»ä½“ä¸Šæ¥è¯´ï¼ŒCMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚é€šè¿‡ä¸‹å›¾å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ° CMS 46æ”¶é›†å™¨çš„è¿ä½œæ­¥éª¤ä¸­å¹¶å‘å’Œéœ€è¦åœé¡¿çš„æ—¶é—´ï¼š</p><div class="center-img"><p><img src="/img/46.jpeg"></p></div><p><span style="color: green">ä¼˜ç‚¹</span>ï¼šCMS æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨ï¼Œå®ƒçš„ä¸»è¦ä¼˜ç‚¹åœ¨åå­—ä¸Šå·²ç»ä½“ç°å‡ºæ¥äº†ï¼š<strong>å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œ</strong>å› æ­¤CMSæ”¶é›†å™¨ä¹Ÿè¢«ç§°ä¸º<strong>å¹¶å‘ä½åœé¡¿æ”¶é›†å™¨ï¼ˆConcurrent Low Pause Collectorï¼‰</strong>ã€‚</p><p><span style="color: red">ç¼ºç‚¹</span>ï¼š</p><ul><li><strong>å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ</strong>ã€‚å…¶å®ï¼Œé¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹ CPU èµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´ CPU èµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚CMS é»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯<code>(CPUæ•°é‡+3)/ 4</code>ï¼Œä¹Ÿå°±æ˜¯å½“ CPU åœ¨4ä¸ªä»¥ä¸Šæ—¶ï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸å°‘äº 25% çš„CPUèµ„æºï¼Œå¹¶ä¸”éšç€ CPU æ•°é‡çš„å¢åŠ è€Œä¸‹é™ã€‚ä½†æ˜¯å½“ CPU ä¸è¶³4ä¸ªæ—¶ï¼ˆæ¯”å¦‚2ä¸ªï¼‰ï¼ŒCMS å¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ï¼Œå¦‚æœæœ¬æ¥ CPU è´Ÿè½½å°±æ¯”è¾ƒå¤§ï¼Œè¿˜è¦åˆ†å‡ºä¸€åŠçš„è¿ç®—èƒ½åŠ›å»æ‰§è¡Œæ”¶é›†å™¨çº¿ç¨‹ï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦å¿½ç„¶é™ä½äº†50%ï¼Œå…¶å®ä¹Ÿè®©äººæ— æ³•æ¥å—ã€‚</li><li><strong>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼ˆFloating Garbageï¼‰</strong>ã€‚å¯èƒ½å‡ºç°ã€Concurrent Mode Failureã€å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡ Full GC çš„äº§ç”Ÿã€‚ <strong>ç”±äºCMS å¹¶å‘æ¸…ç†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨è¿è¡Œç€ï¼Œä¼´éšç¨‹åºè¿è¡Œè‡ªç„¶å°±è¿˜ä¼šæœ‰æ–°çš„åƒåœ¾ä¸æ–­äº§ç”Ÿã€‚</strong> è¿™ä¸€éƒ¨åˆ†åƒåœ¾å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ä¹‹åï¼ŒCMS æ— æ³•å†å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡ GC æ—¶å†æ¸…ç†æ‰ã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±è¢«ç§°ä¸ºã€<strong>æµ®åŠ¨åƒåœ¾</strong>ã€ã€‚ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜éœ€è¦è¿è¡Œï¼Œé‚£ä¹Ÿå°±è¿˜éœ€è¦é¢„ç•™æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤ CMS æ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œéœ€è¦é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´æä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚</li><li><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡</strong>ã€‚CMSæ˜¯ä¸€æ¬¾åŸºäºã€æ ‡è®°-æ¸…é™¤ã€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œè¿™æ„å‘³ç€æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ã€‚</li></ul><h3 id="G1æ”¶é›†å™¨"><a href="#G1æ”¶é›†å™¨" class="headerlink" title="G1æ”¶é›†å™¨"></a>G1æ”¶é›†å™¨</h3><p>G1ï¼ˆGarbage-Firstï¼‰æ”¶é›†å™¨æ˜¯å½“ä»Šæ”¶é›†å™¨æŠ€æœ¯å‘å±•æœ€å‰æ²¿çš„æˆæœä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€æ¬¾<strong>é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨</strong>ï¼ŒHotSpotå¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯ï¼ˆåœ¨æ¯”è¾ƒé•¿æœŸçš„ï¼‰æœªæ¥å¯ä»¥æ›¿æ¢æ‰ JDK 1.5 ä¸­å‘å¸ƒçš„ CMS æ”¶é›†å™¨ã€‚ä¸å…¶ä»– GC æ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1 å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong> G1 èƒ½å……åˆ†åˆ©ç”¨å¤š CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPU æ¥ç¼©çŸ­ã€Stop The Worldã€åœé¡¿æ—¶é—´ï¼Œéƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼Œ<strong>G1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© Java ç¨‹åºç»§ç»­æ‰§è¡Œ</strong>ã€‚</li><li><strong>åˆ†ä»£æ”¶é›†</strong> ä¸å…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£æ¦‚å¿µåœ¨ G1 ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚è™½ç„¶ <strong>G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒæ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²å­˜æ´»ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡ GC çš„æ—§å¯¹è±¡</strong>æ¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚</li><li><strong>ç©ºé—´æ•´åˆ</strong> G1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºã€æ ‡è®°-æ•´ç†ã€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ª Region ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºã€å¤åˆ¶ã€ç®—æ³•å®ç°çš„ã€‚è¿™æ„å‘³ç€ G1 è¿è¡ŒæœŸé—´<strong>ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡</strong>ï¼Œæ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚æ­¤ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡ GCã€‚</li><li><strong>å¯é¢„æµ‹çš„åœé¡¿</strong> è¿™æ˜¯ G1 ç›¸å¯¹ CMS çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†é™ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ï¼Œè¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶ Javaï¼ˆRTSJï¼‰çš„åƒåœ¾æ”¶é›†å™¨çš„ç‰¹å¾äº†ã€‚</li></ul><h4 id="æ¨ªè·¨æ•´ä¸ªå †å†…å­˜"><a href="#æ¨ªè·¨æ•´ä¸ªå †å†…å­˜" class="headerlink" title="æ¨ªè·¨æ•´ä¸ªå †å†…å­˜"></a>æ¨ªè·¨æ•´ä¸ªå †å†…å­˜</h4><p>åœ¨ G1 ä¹‹å‰çš„å…¶ä»–æ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€ç”Ÿä»£ï¼Œè€Œ G1 ä¸å†æ˜¯è¿™æ ·ã€‚G1åœ¨ä½¿ç”¨æ—¶ï¼ŒJava å †çš„å†…å­˜å¸ƒå±€ä¸å…¶ä»–æ”¶é›†å™¨æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œ<strong>å®ƒå°†æ•´ä¸ª Java å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰</strong>ï¼Œè™½ç„¶è¿˜ä¿ç•™æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œè€Œéƒ½æ˜¯ä¸€éƒ¨åˆ† Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆ</strong>ã€‚</p><h4 id="å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹"><a href="#å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹" class="headerlink" title="å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹"></a>å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹</h4><p>G1 æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥<strong>æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ª Java å †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†</strong>ã€‚G1 è·Ÿè¸ªå„ä¸ª Region é‡Œé¢çš„åƒåœ¾å †ç§¯çš„<strong>ä»·å€¼å¤§å°</strong>ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œ<strong>åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨</strong>ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionï¼ˆè¿™ä¹Ÿå°±æ˜¯ Garbage-First åç§°çš„æ¥ç”±ï¼‰ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p><h4 id="é¿å…å…¨å †æ‰«æ-â€”â€”-Remembered-Set"><a href="#é¿å…å…¨å †æ‰«æ-â€”â€”-Remembered-Set" class="headerlink" title="é¿å…å…¨å †æ‰«æ â€”â€” Remembered Set"></a>é¿å…å…¨å †æ‰«æ â€”â€” Remembered Set</h4><p>G1 æŠŠ Java å †åˆ†ä¸ºå¤šä¸ª Regionï¼Œå°±æ˜¯ã€åŒ–æ•´ä¸ºé›¶ã€ã€‚ä½†æ˜¯ Region ä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªå¯¹è±¡åˆ†é…åœ¨æŸä¸ª Region ä¸­ï¼Œå¯ä»¥ä¸æ•´ä¸ª Java å †ä»»æ„çš„å¯¹è±¡å‘ç”Ÿå¼•ç”¨å…³ç³»ã€‚åœ¨åšå¯è¾¾æ€§åˆ†æç¡®å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„æ—¶å€™ï¼Œéœ€è¦æ‰«ææ•´ä¸ª Java å †æ‰èƒ½ä¿è¯å‡†ç¡®æ€§ï¼Œè¿™æ˜¾ç„¶æ˜¯å¯¹ GC æ•ˆç‡çš„æå¤§ä¼¤å®³ã€‚</p><p>ä¸ºäº†é¿å…å…¨å †æ‰«æçš„å‘ç”Ÿï¼Œè™šæ‹Ÿæœº<strong>ä¸º G1 ä¸­æ¯ä¸ª Region ç»´æŠ¤äº†ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ Remembered Set</strong>ã€‚è™šæ‹Ÿæœºå‘ç°ç¨‹åºåœ¨å¯¹ Reference ç±»å‹çš„æ•°æ®è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª Write Barrier æš‚æ—¶ä¸­æ–­å†™æ“ä½œï¼Œæ£€æŸ¥ Reference å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å¤„äºä¸åŒçš„ Region ä¹‹ä¸­ï¼ˆåœ¨åˆ†ä»£çš„ä¾‹å­ä¸­å°±æ˜¯æ£€æŸ¥æ˜¯å¦è€å¹´ä»£ä¸­çš„å¯¹è±¡å¼•ç”¨äº†æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œä¾¿é€šè¿‡ CardTable æŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°è¢«å¼•ç”¨å¯¹è±¡æ‰€å±çš„ Region çš„ Remembered Set ä¹‹ä¸­ã€‚å½“è¿›è¡Œå†…å­˜å›æ”¶æ—¶ï¼Œåœ¨ GC æ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´ä¸­åŠ å…¥ Remembered Set å³å¯ä¿è¯ä¸å¯¹å…¨å †æ‰«æä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚</p><p>å¦‚æœä¸è®¡ç®—ç»´æŠ¤Remembered Setçš„æ“ä½œï¼ŒG1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰</strong> ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹ NTMSï¼ˆNest Top Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ä»¥çš„ Region ä¸­åˆ›å»ºå¯¹è±¡ï¼Œæ­¤é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚</li><li><strong>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</strong> ä» GC Root å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾åˆ°å­˜æ´»å¯¹è±¡ï¼Œæ­¤é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li><li><strong>æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰</strong> ä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logs çš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li><strong>ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰</strong> é¦–å…ˆå¯¹å„ä¸ª Region çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚</li></ul><p>é€šè¿‡ä¸‹å›¾å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ°G1æ”¶é›†å™¨çš„è¿ä½œæ­¥éª¤ä¸­å¹¶å‘å’Œéœ€è¦åœé¡¿çš„é˜¶æ®µï¼ˆSafepointå¤„ï¼‰ï¼š</p><div class="center-img"><p><img src="/img/47.jpeg"></p></div><p>ç”¨ä¸€å¼ è¡¨çœ‹7ç§æ”¶é›†å™¨çš„å¯¹æ¯”ï¼š</p><table><thead><tr><th>æ”¶é›†å™¨</th><th>ä¸²è¡Œã€å¹¶è¡Œorå¹¶å‘</th><th>æ–°ç”Ÿä»£/è€å¹´ä»£</th><th>ç®—æ³•</th><th>ç›®æ ‡</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Serial</strong></td><td>ä¸²è¡Œ</td><td>æ–°ç”Ÿä»£</td><td>å¤åˆ¶ç®—æ³•</td><td>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td>å• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼</td></tr><tr><td><strong>Serial Old</strong></td><td>ä¸²è¡Œ</td><td>è€å¹´ä»£</td><td>æ ‡è®°-æ•´ç†</td><td>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td>å• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼ã€CMS çš„åå¤‡é¢„æ¡ˆ</td></tr><tr><td><strong>ParNew</strong></td><td>å¹¶è¡Œ</td><td>æ–°ç”Ÿä»£</td><td>å¤åˆ¶ç®—æ³•</td><td>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td>å¤š CPU ç¯å¢ƒæ—¶åœ¨ Server æ¨¡å¼ä¸‹ä¸ CMS é…åˆ</td></tr><tr><td><strong>Parallel Scavenge</strong></td><td>å¹¶è¡Œ</td><td>æ–°ç”Ÿä»£</td><td>å¤åˆ¶ç®—æ³•</td><td>ååé‡ä¼˜å…ˆ</td><td>åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</td></tr><tr><td><strong>Parallel Old</strong></td><td>å¹¶è¡Œ</td><td>è€å¹´ä»£</td><td>æ ‡è®°-æ•´ç†</td><td>ååé‡ä¼˜å…ˆ</td><td>åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</td></tr><tr><td><strong>CMS</strong></td><td>å¹¶å‘</td><td>è€å¹´ä»£</td><td>æ ‡è®°-æ¸…é™¤</td><td>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td>é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ– B/S ç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„ Java åº”ç”¨</td></tr><tr><td><strong>G1</strong></td><td>å¹¶å‘</td><td>both</td><td>æ ‡è®°-æ•´ç†+å¤åˆ¶ç®—æ³•</td><td>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td>é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢ CMS</td></tr></tbody></table><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>æ ¹æ® GC çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§å’Œæ–¹å¼ï¼Œè®© GC è¿è¡Œæ›´åŠ æœ‰æ•ˆç‡ï¼Œæ›´åŠ ç¬¦åˆåº”ç”¨ç¨‹åºçš„è¦æ±‚ã€‚ä¸€äº›å…³äºç¨‹åºè®¾è®¡çš„å‡ ç‚¹å»ºè®®ï¼šÂ </p><ol><li><p>æœ€åŸºæœ¬çš„å»ºè®®å°±æ˜¯å°½æ—©é‡Šæ”¾æ— ç”¨å¯¹è±¡çš„å¼•ç”¨ã€‚å¤§å¤šæ•°ç¨‹åºå‘˜åœ¨ä½¿ç”¨ä¸´æ—¶å˜é‡çš„æ—¶å€™ï¼Œéƒ½æ˜¯è®©å¼•ç”¨å˜é‡åœ¨é€€å‡ºæ´»åŠ¨åŸŸï¼ˆscopeï¼‰åï¼Œè‡ªåŠ¨è®¾ç½®ä¸º <code>null</code>ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ç§æ–¹å¼æ—¶å€™ï¼Œå¿…é¡»ç‰¹åˆ«æ³¨æ„ä¸€äº›å¤æ‚çš„å¯¹è±¡å›¾ï¼Œä¾‹å¦‚æ•°ç»„ï¼Œé˜Ÿåˆ—ï¼Œæ ‘ï¼Œå›¾ç­‰ï¼Œè¿™äº›å¯¹è±¡ä¹‹é—´æœ‰ç›¸äº’å¼•ç”¨å…³ç³»è¾ƒä¸ºå¤æ‚ã€‚å¯¹äºè¿™ç±»å¯¹è±¡ï¼ŒGC å›æ”¶å®ƒä»¬ä¸€èˆ¬æ•ˆç‡è¾ƒä½ã€‚å¦‚æœç¨‹åºå…è®¸ï¼Œå°½æ—©å°†ä¸ç”¨çš„å¼•ç”¨å¯¹è±¡èµ‹ä¸º <code>null</code>ï¼Œè¿™æ ·å¯ä»¥åŠ é€Ÿ GC çš„å·¥ä½œã€‚Â </p></li><li><p>å°½é‡å°‘ç”¨<code>finalize()</code>å‡½æ•°ã€‚<code>finalize()</code>å‡½æ•°æ˜¯ Java æä¾›ç»™ç¨‹åºå‘˜ä¸€ä¸ªé‡Šæ”¾å¯¹è±¡æˆ–èµ„æºçš„æœºä¼šã€‚ä½†æ˜¯ï¼Œå®ƒä¼šåŠ å¤§ GC çš„å·¥ä½œé‡ï¼Œå› æ­¤å°½é‡å°‘é‡‡ç”¨<code>finalize()</code>æ–¹å¼å›æ”¶èµ„æºã€‚Â </p></li><li><p>å¦‚æœéœ€è¦ä½¿ç”¨ç»å¸¸ä½¿ç”¨çš„å›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨ç±»å‹ï¼ˆSoft Referenceï¼‰ã€‚å®ƒå¯ä»¥å°½å¯èƒ½å°†å›¾ç‰‡ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä¾›ç¨‹åºè°ƒç”¨ï¼Œè€Œä¸å¼•èµ· OutOfMemoryError.Â </p></li><li><p>æ³¨æ„é›†åˆæ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ•°ç»„ï¼Œæ ‘ï¼Œå›¾ï¼Œé“¾è¡¨ç­‰æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„å¯¹ GC æ¥è¯´ï¼Œå›æ”¶æ›´ä¸ºå¤æ‚ã€‚å¦å¤–ï¼Œæ³¨æ„ä¸€äº›å…¨å±€çš„å˜é‡ï¼Œä»¥åŠä¸€äº›é™æ€å˜é‡ã€‚è¿™äº›å˜é‡å¾€å¾€å®¹æ˜“å¼•èµ·æ‚¬æŒ‚å¯¹è±¡ï¼ˆdangling referenceï¼‰ï¼Œé€ æˆå†…å­˜æµªè´¹ã€‚Â </p></li><li><p>å½“ç¨‹åºæœ‰ä¸€å®šçš„ç­‰å¾…æ—¶é—´ï¼Œç¨‹åºå‘˜å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ<code>System.gc()</code>ï¼Œé€šçŸ¥ GC è¿è¡Œï¼Œä½†æ˜¯ Java è¯­è¨€è§„èŒƒå¹¶ä¸ä¿è¯ GC ä¸€å®šä¼šæ‰§è¡Œã€‚ä½¿ç”¨å¢é‡å¼ GC å¯ä»¥ç¼©çŸ­ Java ç¨‹åºçš„æš‚åœæ—¶é—´ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
            <tag> GC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kotlin åç¨‹</title>
      <link href="/2020-05-13/kotlin-coroutine/"/>
      <url>/2020-05-13/kotlin-coroutine/</url>
      
        <content type="html"><![CDATA[<p>Kotlin è¯­è¨€å‘å±•è‡³ä»Šï¼Œä¹Ÿæœ‰9ä¸ªå¹´å¤´äº†ã€‚å½“åˆå‘æ˜ä¹‹åä¸€ç›´ä¸æ„ ä¸ç«ï¼Œç›´åˆ°è¿‘å¹´ Google å®£å¸ƒå°†æ”¯æŒä½¿ç”¨ Kotlin è¯­è¨€æ”¯æŒ Android å¼€å‘ä¹‹åï¼ŒKotlin æ‰ç®—æ˜¯çœŸæ­£ç«èµ·æ¥ã€‚</p><p>åœ¨ Android å¼€å‘ä¸­ï¼ŒKotlin è¯­è¨€ä¸ Java è¯­è¨€å¯ä»¥æ— ç¼è¡”æ¥ï¼Œå…¶å®èƒŒåè¿˜æ˜¯ Android è™šæ‹Ÿæœºçš„åŠŸåŠ³ï¼Œå®ƒä¼šå°† Kotlin æ–‡ä»¶è½¬æ¢ä¸º class æ–‡ä»¶ï¼Œç„¶ååŠ è½½åˆ°è™šæ‹Ÿæœºä¸­è¿è¡Œã€‚åœ¨æœ¬æ–‡å†™ä½œæ—¶ï¼ŒKotlin ç‰ˆæœ¬å·²ç»åˆ°äº† <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.3.72">1.3.72</a>ï¼Œ<a href="https://blog.jetbrains.com/kotlin/2020/03/kotlin-1-4-m1-released/">1.4.0</a> æ­£å¤„äº preview é˜¶æ®µã€‚å…³äº Kotlin è¯­è¨€çš„å­¦ä¹ ï¼Œæˆ‘ä¼šå•å¼€ä¸€ç¯‡æ–‡ç« æ¥è®²ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è®²è®² Kotlin ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§â€”â€”åç¨‹ï¼ˆCoroutineï¼‰ã€‚</p><span id="more"></span><h2 id="åç¨‹çš„æ¦‚å¿µ"><a href="#åç¨‹çš„æ¦‚å¿µ" class="headerlink" title="åç¨‹çš„æ¦‚å¿µ"></a>åç¨‹çš„æ¦‚å¿µ</h2><p>åç¨‹çš„æ¦‚å¿µç”±æ¥å·²ä¹…ï¼Œå½“åˆé‚“è¶…ä»£è¨€å¹¿å‘Šçš„æ—¶å€™ã€‚ã€‚ã€‚å–‚å–‚å–‚ï¼Œæ­¤åç¨‹éå½¼æºç¨‹å•Šï¼</p><p>å¥½ï¼Œé‡æ–°æ¥ã€‚</p><p>åç¨‹çš„æ¦‚å¿µç”±æ¥å·²ä¹…ï¼Œå®ƒåˆè¢«ç§°ä¸ºã€<strong>å¾®çº¿ç¨‹</strong>ã€ã€ã€<strong>çº¤ç¨‹</strong>ã€ã€‚ä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯ä¸€ç§éå¸¸è½»é‡çº§çš„æ¦‚å¿µã€‚å®ƒå¾ˆæ—©å°±è¢«æå‡ºæ¥äº†ï¼Œè¿›ç¨‹ä¸‹æœ‰çº¿ç¨‹ï¼Œé‚£çº¿ç¨‹ä¸‹æ˜¯ä¸æ˜¯ä¹Ÿå¾—åˆ†ä¸€åˆ†ï¼Ÿå¥½ï¼Œå°±å«åç¨‹å§ã€‚è™½ç„¶æ¦‚å¿µçš„æå‡ºå¾ˆæ—©ï¼Œä½†ä¹Ÿåªæ˜¯è¿‘å‡ å¹´æ‰å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p><p><img src="/img/coroutine-1589349773.png"></p><div style="text-align:center"><p><em>è¿›ç¨‹ä¸‹æœ‰å¤šä¸ªçº¿ç¨‹</em></p></div><p><img src="/img/coroutine-1589349908.png"></p><div style="text-align:center"><p><em>çº¿ç¨‹ä¸‹æœ‰å¤šä¸ªåç¨‹</em></p></div><p>æˆ‘ä»¬å¯ä»¥ç»™å®ƒä¸‹ä¸€ä¸ªå®šä¹‰ï¼š<strong>åç¨‹æ˜¯èƒ½å¤Ÿåœ¨å•ä¸ªçº¿ç¨‹ä¸‹ï¼Œè¿˜èƒ½å¤Ÿå¹¶å‘è¿è¡Œçš„ä¸€ç§æœºåˆ¶</strong>ã€‚å®ƒæœ€é‡è¦çš„ç‰¹ç‚¹æ˜¯ï¼Œå®ƒ<strong>ä¸ä¼šè¢«æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€ç®¡ç†</strong>ï¼Œè€Œ<strong>å®Œå…¨ç”±ç”¨æˆ·ç¨‹åºæ¥æ§åˆ¶</strong>ï¼Œä¹Ÿå°±æ˜¯åœ¨<strong>ç”¨æˆ·æ€</strong>æ‰§è¡Œï¼Œè€Œéå†…æ ¸æ€ã€‚è¿™æ ·å¸¦æ¥çš„å¥½å¤„æ˜¯<strong>å¯ä»¥çœå»ä¼ ç»Ÿå¤šçº¿ç¨‹æœºåˆ¶ä¸­çº¿ç¨‹åˆ‡æ¢æ—¶çš„æ€§èƒ½æŸè€—</strong>ï¼Œå¤§å¹…åº¦æé«˜å¹¶å‘æ€§èƒ½ã€‚</p><p>åœ¨ Python ä¸­å¾ˆæ—©å°±å¼•å…¥äº†åç¨‹çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çœ‹ä¸€ä¸‹ä¸€ä¸ªå¾ˆç®€å•çš„<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„ä¾‹å­</strong>ï¼š</p><pre><code class="python"># æ¶ˆè´¹è€…def consume():    while True:        number = yield  # åœ¨è¿™åœé¡¿        print(&#39;Start Consuming&#39;, number)consumer = consume()# åˆå§‹åŒ–åç¨‹ï¼Œå¹¶åœ¨ yield å¤„åœæ­¢next(consumer)# ç”Ÿäº§è€…for num in range(0, 100):    print(&#39;Start Producing&#39;, num)    consumer.send(num)</code></pre><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåç¨‹<code>consumer</code>ï¼Œç„¶ååœ¨ä¸»çº¿ç¨‹ä¸­ç”Ÿäº§æ•°æ®ï¼Œå¹¶äº¤ç»™åç¨‹å»æ¶ˆè´¹ã€‚<code>yield</code>æ˜¯ Python çš„è¯­æ³•ï¼ŒæŒ‡çš„æ˜¯ç¨‹åºæ‰§è¡Œåˆ°è¿™å„¿çš„æ—¶å€™ï¼Œä¼šåœé¡¿ï¼Œç­‰å¾…ä¸»çº¿çº¿ä½¿ç”¨<code>send()</code>å‘é€æ¶ˆæ¯æ—¶ï¼Œæ‰ä¼šæ¥æ”¶æ¶ˆæ¯å¹¶ç»§ç»­æ‰§è¡Œã€‚</p><p>ä¸Šé¢çš„ä»£ç è¿è¡Œå¦‚ä¸‹ï¼š</p><pre><code>Start Producing 0Start Consuming 0Start Producing 1Start Consuming 1Start Producing 2Start Consuming 2Start Producing 3Start Consuming 3......Start Producing 97Start Consuming 97Start Producing 98Start Consuming 98Start Producing 99Start Consuming 99</code></pre><p>å„ä½åŒå­¦ä»¬çœ‹å‡ºæ¥äº†æ²¡æœ‰ï¼Œå®é™…ä¸Šè¿™æ˜¯ä¸€ç§ã€éšœçœ¼æ³•ã€ï¼Œä¸¤æ®µä»£ç å®Œå…¨æ˜¯åœ¨ç¨‹åºçš„æ§åˆ¶ä¸‹äº¤æ›¿æ‰§è¡Œï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹ + åŒæ­¥æœºåˆ¶ä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹åˆ‡æ¢çš„èµ„æºæ¶ˆè€—ä»¥åŠæ€§èƒ½ä¸Šï¼Œå°±æ¯”è¿™ç§åšæ³•è¦å·®ä¸Šé‚£ä¹ˆã€ä¸€ nai naiã€ã€‚</p><blockquote><p>åœ¨ Python 3.5+ ä¸Šï¼Œä½¿ç”¨<code>async/await</code>æ¥æ›¿ä»£äº†<code>yield/send()</code>ã€‚</p></blockquote><p>è¿˜æœ‰å…¶ä»–çš„è¯­è¨€ä¹Ÿä½¿ç”¨äº†åç¨‹çš„æ¦‚å¿µï¼Œæ¯”å¦‚ Luaã€Goã€C# ç­‰ç­‰ã€‚</p><h2 id="åç¨‹ä¸çº¿ç¨‹çš„æ¯”è¾ƒ"><a href="#åç¨‹ä¸çº¿ç¨‹çš„æ¯”è¾ƒ" class="headerlink" title="åç¨‹ä¸çº¿ç¨‹çš„æ¯”è¾ƒ"></a>åç¨‹ä¸çº¿ç¨‹çš„æ¯”è¾ƒ</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº†ï¼Œåç¨‹æ˜¯æ¯”çº¿ç¨‹è¿˜è¦ä½ä¸€çº§çš„å¹¶å‘æœºåˆ¶ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸¤ä¸ªæœ‰ä»€ä¹ˆç›¸åŒç‚¹å’Œä¸åŒä¹‹å¤„å‘¢ï¼Ÿç†è®ºä¸Šæ¥è¯´ï¼Œè¿™ä¸¤ç§æ¦‚å¿µä¸å¤ªåº”è¯¥ç”¨æ¥æ¯”è¾ƒï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯åˆ—ä¸¾ä¸€ä¸‹ï¼Œä¹Ÿæ–¹ä¾¿æˆ‘ä»¬ç†è§£åç¨‹çš„ä¼˜ç¼ºç‚¹ã€‚</p><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><p>çº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„æ ˆã€å±€éƒ¨å˜é‡ã€å¯ä»¥å…±äº«è¿›ç¨‹çš„å†…å­˜ã€‚åœ¨ä½¿ç”¨å…±äº«æ•°æ®æ—¶ï¼Œä¸ºäº†é¿å…é€ æˆæ•°æ®é”™è¯¯ï¼Œéœ€è¦æ§åˆ¶çº¿ç¨‹çš„çŠ¶æ€ã€‚ä½†è¿™ç§æ§åˆ¶æ˜¯ç”±å†…æ ¸æ¥åšçš„ï¼Œæ‰€ä»¥ç¨‹åºä¼šä¸æ–­åœ°åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ç§åˆ‡æ¢çš„æ¶ˆè€—å’Œä»£ä»·æ˜¯æ¯”è¾ƒå¤§çš„ã€‚</p><h3 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h3><p>åç¨‹ä¹Ÿæ‹¥æœ‰è‡ªå·±çš„æ ˆã€å±€éƒ¨å˜é‡ï¼Œå¯ä»¥å…±äº«çº¿ç¨‹å†…çš„å†…å­˜ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå¯ä»¥åŒæ—¶è·‘å¤šä¸ªåç¨‹ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªåç¨‹è¢«æ‰§è¡Œï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨å•çº¿ç¨‹ä¸Šæ¨¡æ‹Ÿå¤šçº¿ç¨‹å¹¶å‘ã€‚åç¨‹çš„è¿è¡Œå’Œæš‚åœï¼Œå…¨éƒ¨æ˜¯ç”±å¼€å‘è€…è‡ªå·±å†³å®šçš„ï¼Œä¸éœ€è¦åˆ‡æ¢è‡³å†…æ ¸æ€ï¼Œå¤§å¤§å‡å°‘äº†æ¶ˆè€—ï¼Œæé«˜äº†æ€§èƒ½ã€‚</p><p>åç¨‹é»˜è®¤æ˜¯éé˜»å¡å¼çš„ï¼ˆä¹Ÿå¯ä»¥é˜»å¡ï¼‰ï¼Œä¸€ä¸ªåç¨‹åœ¨<strong>è¿›å…¥é˜»å¡åä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹</strong>ï¼Œå½“å‰çº¿ç¨‹ä¼šå»æ‰§è¡Œå…¶ä»–åç¨‹ä»»åŠ¡ã€‚</p><h2 id="Kotlin-ä¸­çš„åç¨‹"><a href="#Kotlin-ä¸­çš„åç¨‹" class="headerlink" title="Kotlin ä¸­çš„åç¨‹"></a>Kotlin ä¸­çš„åç¨‹</h2><p>Kotlin çš„åç¨‹çš„ä¸­å¿ƒæ€æƒ³æ˜¯ï¼š<strong>æš‚åœè®¡ç®—</strong>ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œåˆ°æŸå¤„çš„æ—¶å€™ï¼Œå¯ä»¥æš‚åœï¼Œç„¶ååœ¨åˆ°è¾¾æŸä¸€ä¸ªæ—¶é—´èŠ‚ç‚¹æ—¶ï¼Œç»§ç»­è¿è¡Œã€‚æŠŠè¿™ç§æ¦‚å¿µåº”ç”¨åˆ°ç¼–ç¨‹ä¸­ï¼Œå°±æ˜¯å¯ä»¥<strong>ç›´æ¥ç¼–å†™æ— é˜»å¡çš„ä»£ç </strong>ï¼Œèƒ½è¾¾åˆ°ä¸é˜»å¡ä»£ç ç›¸åŒçš„æ•ˆæœã€‚å®˜ç½‘ç»™å‡ºäº†ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class="kotlin">fun postItem(item: Item) &#123;    launch &#123;        val token = preparePost()        val post = submitPost(token, item)        processPost(post)    &#125;&#125;suspend fun preparePost(): Token &#123;    // æ‰§è¡Œè¯·æ±‚ï¼Œæš‚åœåç¨‹    return suspendCoroutine &#123; /* ... */ &#125; &#125;</code></pre><p>è¿™å—ä»£ç å¹¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œ<code>preparePost()</code>è¢«ç§°ä¸ºã€<strong>å¯ä¸­æ­¢æ–¹æ³•</strong>ã€ã€‚ä¸ä¸Šé¢è®²è¿‡çš„ä¸­å¿ƒæ€æƒ³ä¸€è‡´ï¼šæ–¹æ³•è¢«æ‰§è¡Œ â†’ æš‚åœæ‰§è¡Œ â†’ åœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹ç»§ç»­æ‰§è¡Œã€‚</p><p>ä½¿ç”¨ Kotlin çš„åç¨‹æœ‰ä¸‹é¢å‡ ä¸ªä¼˜ç‚¹ï¼š</p><ol><li>æ–¹æ³•æœ¬èº«ä¸å˜ï¼Œå”¯ä¸€çš„å˜åŒ–æ˜¯åŠ ä¸Šäº†<code>suspend</code>å…³é”®å­—ï¼›</li><li>å†™ä»£ç æ—¶ç›´æ¥é‡‡ç”¨åŒæ­¥å†™æ³•ï¼Œçœ‹èµ·æ¥å°±æ˜¯ã€ç”±ä¸Šè‡³ä¸‹ã€çš„æ‰§è¡Œæ–¹å¼ï¼Œä¸ç”¨ä»»ä½•ç‰¹æ®Šçš„è¯­æ³•ã€ç‰¹æ®Šçš„å¤„ç†ã€‚æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨<code>launch</code>å…³é”®å­—æ¥å¯åŠ¨åç¨‹å¹¶æ‰§è¡Œå¯ä¸­æ­¢æ–¹æ³•å³å¯ï¼›</li><li>Kotlin ä¸­å…¶ä»–çš„ API ç­‰ç…§å¸¸ä½¿ç”¨ï¼Œä½ å¯ä»¥éšä¾¿ä½¿ç”¨å¾ªç¯ã€å¼‚å¸¸å¤„ç†ä¹‹ç±»çš„ï¼Œä¸éœ€è¦å†å­¦ä¹ ä»€ä¹ˆæ–°çš„ APIï¼›</li><li>å¹³å°æ— å…³æ€§ã€‚æ— è®ºä½ çš„ä»£ç æ˜¯è¿è¡Œåœ¨ JVM ä¸Šï¼ŒJavascipt å¹³å°æˆ–è€…æ˜¯å…¶ä»–å¹³å°ï¼Œä»£ç æ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼Œè®©ç¼–è¯‘å™¨æ¥å¸®ä½ åšè¿™äº›é€‚é…çš„å·¥ä½œã€‚</li></ol><h2 id="Android-ä¸­çš„-Kotlin-åç¨‹"><a href="#Android-ä¸­çš„-Kotlin-åç¨‹" class="headerlink" title="Android ä¸­çš„ Kotlin åç¨‹"></a>Android ä¸­çš„ Kotlin åç¨‹</h2><p>è¦åœ¨ Android ä¸­ä½¿ç”¨ Kotlin åç¨‹ï¼Œè¦åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>å°† Kotlin é›†æˆåˆ°é¡¹ç›®ä¸­ã€‚</li></ol><p>é¦–å…ˆåœ¨é¡¹ç›®çš„ build.gradle æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p><pre><code class="gradle">buildscript &#123;    ext.kotlin_version = &#39;1.3.72&#39;  // kotlin çš„ç‰ˆæœ¬    repositories &#123;        google()        jcenter()            &#125;    dependencies &#123;        classpath &#39;com.android.tools.build:gradle:3.6.3&#39;  // è¦ä½¿ç”¨ kotlinï¼Œgradle ç‰ˆæœ¬å¿…é¡»åœ¨ 3.0.0 ä»¥ä¸Š        classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot;          // NOTE: Do not place your application dependencies here; they belong        // in the individual module build.gradle files    &#125;&#125;...</code></pre><p>ç„¶ååœ¨æ¨¡å—çš„ build.gradle æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ä»£ç ï¼š</p><pre><code class="gradle">apply plugin: &#39;com.android.application&#39;apply plugin: &#39;kotlin-android&#39;apply plugin: &#39;kotlin-android-extensions&#39;android &#123;    ...    kotlinOptions &#123;        jvmTarget = &quot;1.8&quot;    &#125;&#125;dependencies &#123;    ...    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot;    ...&#125;</code></pre><p>åŒæ­¥ gradleï¼ŒKotlin å°±é›†æˆå®Œæ¯•äº†ã€‚</p><ol start="2"><li>åŠ å…¥åç¨‹çš„ä¾èµ–</li></ol><p>åœ¨æ¨¡å—çš„ buidl.gradle æ–‡ä»¶ä¸­ï¼Œåšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š</p><pre><code class="gradle">dependencies &#123;    ...    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib:1.3.72&quot;    implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.6&quot;&#125;</code></pre><p>å°±å®Œæˆäº†åç¨‹çš„é›†æˆå·¥ä½œã€‚</p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨åç¨‹æ¥å†™ä¸€ä¸ªç®€å•çš„å€’è®¡æ—¶çš„å°ä¾‹å­ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ª textView å’Œä¸€ä¸ª buttonï¼Œå½“ç‚¹å‡» button æ—¶ï¼ŒtextView å°±ä¼šæ˜¾ç¤º 10 ç§’é’Ÿçš„å€’è®¡æ—¶ï¼Œç²¾ç¡®åˆ°æ¯«ç§’ã€‚</p><pre><code class="kotlin">button.setOnClickListener &#123;    GlobalScope.launch(Dispatchers.Main) &#123;        println(Looper.myLooper() == Looper.getMainLooper())        for (i in 1000 downTo 0) &#123;            textView.text = formatTime(i)            delay(1)        &#125;    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œä¸ä¸Šé¢ç®€å•ä»‹ç»çš„ suspendã€launch å…³é”®å­—ä¸åŒï¼Œè¿™é‡Œåˆå¤šäº†ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚</p><ul><li>GlobalScope</li></ul><p>GlobalScope ç”¨æ¥å¯åŠ¨é¡¶çº§çš„åç¨‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸ Application ä¸€è‡´ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–çš„ Scopeï¼Œæˆ‘ä»¬å›å¤´æ…¢æ…¢ä»‹ç»ã€‚</p><ul><li>Dispatchers</li></ul><p>ç”¨æ¥æŒ‡å®šåç¨‹è¿è¡Œåœ¨å“ªä¸ªçº¿ç¨‹é‡Œã€‚æ¯•ç«Ÿç½‘ç»œè¯·æ±‚è¿˜æ˜¯è¦åœ¨å­çº¿ç¨‹ä¸­ï¼Œæ›´æ–° UI è¿˜æ˜¯è¦åœ¨ä¸»çº¿ç¨‹å“‡ã€‚åé¢ä¼šè®²ä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚çš„ä¾‹å­ã€‚</p><p>Dispatcher æœ‰å‡ ç§ç±»å‹ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>å¸¸é‡</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>Default</td><td></td></tr><tr><td>Main</td><td>è®©åç¨‹è¿è¡Œåœ¨ä¸»çº¿ç¨‹</td></tr><tr><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kotlin </tag>
            
            <tag> coroutine </tag>
            
            <tag> åç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ConcurrentHashMap</title>
      <link href="/2020-05-12/concurrent-hashmap/"/>
      <url>/2020-05-12/concurrent-hashmap/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/covers/cover-java-2020-05-12.png" alt="cover"><br>ConcurrentHashMap åº•å±‚æ˜¯åŸºäº<strong>æ•°ç»„ + é“¾è¡¨</strong>ç»„æˆçš„ï¼Œä¸è¿‡åœ¨ jdk1.7 å’Œ 1.8 ä¸­å…·ä½“å®ç°ç¨æœ‰ä¸åŒã€‚</p><span id="more"></span><h2 id="JDK-1-7"><a href="#JDK-1-7" class="headerlink" title="JDK 1.7"></a>JDK 1.7</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>åœ¨ JDK1.7 ä¸­æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/img/concurrent-hashmap-1589261515.png"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ç”± Segment æ•°ç»„ã€HashEntry ç»„æˆï¼Œå’Œ HashMap ä¸€æ ·ï¼Œä»ç„¶æ˜¯<strong>æ•°ç»„åŠ é“¾è¡¨</strong>ã€‚</p><p>Segment æ˜¯ ConcurrentHashMap çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä¸»è¦çš„ç»„æˆå¦‚ä¸‹ï¼š</p><pre><code class="java">staticÂ finalÂ classÂ Segment&lt;K,V&gt;Â extendsÂ ReentrantLockÂ implementsÂ SerializableÂ &#123;Â Â Â Â     privateÂ staticÂ finalÂ longÂ serialVersionUIDÂ =Â 2249069246763182397L;Â Â Â Â     //Â å’ŒÂ HashMapÂ ä¸­çš„Â HashEntryÂ ä½œç”¨ä¸€æ ·ï¼ŒçœŸæ­£å­˜æ”¾æ•°æ®çš„åœ°æ–¹Â Â Â     transientÂ volatileÂ HashEntry&lt;K,V&gt;[]Â table;Â Â Â Â     transientÂ intÂ count;    // ç”¨äº fail-fastï¼Œå¿«é€Ÿå¤±è´¥    transientÂ intÂ modCount;    //Â å¤§å°    transientÂ intÂ threshold;    //Â è´Ÿè½½å› å­    finalÂ floatÂ loadFactor;&#125;</code></pre><p>HashEntry è·Ÿ HashMap ä¸­çš„ Entry åŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯ä¸åŒç‚¹æ˜¯ï¼Œä»–**ä½¿ç”¨<code>volatile</code>å»ä¿®é¥°äº†ä»–çš„æ•°æ®<code>value</code>è¿˜æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹<code>next</code>**ã€‚</p><blockquote><p><strong><code>volatile</code>çš„åŠŸèƒ½</strong></p><p>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚ï¼ˆå®ç°å¯è§æ€§ï¼‰</p><p>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚ï¼ˆå®ç°æœ‰åºæ€§ï¼‰</p><p>æ³¨æ„ï¼š<code>volatile</code>åªèƒ½ä¿è¯å¯¹<strong>å•æ¬¡è¯»/å†™çš„åŸå­æ€§</strong>ã€‚i++ è¿™ç§æ“ä½œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p></blockquote><p>åŸç†ä¸Šæ¥è¯´ï¼ŒConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­<strong>Segment ç»§æ‰¿äº ReentrantLock</strong>ã€‚</p><p>å®ƒä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯<code>put()</code>è¿˜æ˜¯<code>get()</code>æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel (å€¼ä¸º Segment æ•°ç»„æ•°é‡ï¼‰çš„çº¿ç¨‹å¹¶å‘ã€‚</p><p>æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚</p><p>å°±æ˜¯è¯´å¦‚æœ Segment å½“å‰å¤§å°æ˜¯16ä»–çš„å¹¶å‘åº¦å°±æ˜¯16ï¼Œå¯ä»¥åŒæ—¶å…è®¸16ä¸ªçº¿ç¨‹æ“ä½œ16ä¸ª Segment è€Œä¸”è¿˜æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h3 id="put"><a href="#put" class="headerlink" title="put()"></a><code>put()</code></h3><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ ConcurrentHashMap çš„<code>put()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// jdk1.7 ConcurrentHashMap.javapublicÂ VÂ put(KÂ key,Â VÂ value)Â &#123;    Segment&lt;K,V&gt;Â s;    ifÂ (valueÂ ==Â null)        throwÂ newÂ NullPointerException(); //è¿™å°±æ˜¯ä¸ºå•¥ä»–ä¸å¯ä»¥putÂ nullå€¼çš„åŸå›     intÂ hashÂ =Â hash(key);    intÂ jÂ =Â (hashÂ &gt;&gt;&gt;Â segmentShift)Â &amp;Â segmentMask;    // if ä¸­æ‹¿åˆ°çš„ s ä¸æ˜¯ volatile çš„ï¼Œå°†ä¼šåœ¨ ensureSegment ä¸­é‡æ–°è¿›è¡Œæ£€æŸ¥    ifÂ ((sÂ =Â (Segment&lt;K,V&gt;)UNSAFE.getObject(segments,Â (jÂ &lt;&lt;Â SSHIFT)Â +Â SBASE))Â ==Â null)        sÂ =Â ensureSegment(j);    returnÂ s.put(key,Â hash,Â value,Â false);&#125;</code></pre><p>ä»–å…ˆå®šä½åˆ°å½“å‰ key å±äºå“ªä¸ª Segmentï¼Œç„¶åå†å¯¹è¯¥ Segment è¿›è¡Œ<code>put()</code>æ“ä½œã€‚</p><p>ç„¶åæˆ‘ä»¬çœ‹çœ‹ Segment çš„<code>put()</code>æºä»£ç ï¼Œä½ å°±çŸ¥é“ä»–æ˜¯æ€ä¹ˆåšåˆ°çº¿ç¨‹å®‰å…¨çš„äº†ï¼Œå…³é”®å¥å­æˆ‘æ³¨é‡Šäº†ã€‚</p><pre><code class="java">final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123;    // å°†å½“å‰ Segment ä¸­çš„ table é€šè¿‡ key çš„ hashcode å®šä½åˆ° HashEntry    // å› ä¸º Segment ç»§æ‰¿è‡ª ReentrantLockï¼Œæ‰€ä»¥æ­¤å¤„ç›´æ¥è°ƒç”¨äº†çˆ¶ç±»çš„ tryLock() æ–¹æ³•ï¼ŒæŒæœ‰å½“å‰é”    HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value);    V oldValue;    try &#123;        HashEntry&lt;K,V&gt;[] tab = table;        // è®¡ç®— index        int index = (tab.length - 1) &amp; hash;        HashEntry&lt;K,V&gt; first = entryAt(tab, index);        for (HashEntry&lt;K,V&gt; e = first;;) &#123;            // å¦‚æœæ‹¿åˆ°çš„å½“å‰ index çš„å€¼ä¸ä¸ºç©ºï¼Œè¡¨ç¤ºè¯¥ index ä¸Šæœ‰æ•°æ®ï¼Œéœ€è¦è¿›è¡Œè¦†ç›–            if (e != null) &#123;                K k;                // éå†è¯¥ HashEntryï¼Œ                // å¦‚æœä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¼ å…¥çš„ key å’Œå½“å‰éå†çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–æ—§çš„ valueã€‚                if ((k = e.key) == key ||                    (e.hash == hash &amp;&amp; key.equals(k))) &#123;                    oldValue = e.value;                    if (!onlyIfAbsent) &#123;                        e.value = value;                        ++modCount;                    &#125;                    break;                &#125;                e = e.next;            &#125;            else &#123;                // ä¸ä¸ºç©ºåˆ™éœ€è¦æ–°å»ºä¸€ä¸ª HashEntry å¹¶åŠ å…¥åˆ° Segment ä¸­ï¼ŒåŒæ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹                if (node != null)                    node.setNext(first);                else                    node = new HashEntry&lt;K,V&gt;(hash, key, value, first);                int c = count + 1;                // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹                if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)                    rehash(node);                else                    setEntryAt(tab, index, node);                ++modCount;                count = c;                oldValue = null;                break;            &#125;        &#125;    &#125; finally &#123;        //é‡Šæ”¾é”        unlock();    &#125;    return oldValue;&#125;private HashEntry&lt;K,V&gt; scanAndLockForPut(K key, int hash, V value) &#123;    HashEntry&lt;K,V&gt; first = entryForHash(this, hash);    HashEntry&lt;K,V&gt; e = first;    HashEntry&lt;K,V&gt; node = null;    int retries = -1;    while (!tryLock()) &#123;  // è‡ªæ—‹è·å–é”        HashEntry&lt;K,V&gt; f;        if (retries &lt; 0) &#123;            if (e == null) &#123;                if (node == null) // å°è¯•åˆ›å»ºæ–°çš„ HashEntry                    node = new HashEntry&lt;K,V&gt;(hash, key, value, null);                retries = 0;            &#125;            else if (key.equals(e.key))                retries = 0;            else                e = e.next;        &#125;        else if (++retries &gt; MAX_SCAN_RETRIES) &#123;             // ç›´æ¥ä½¿ç”¨é˜»å¡é”çš„æ–¹å¼ï¼Œæš´åŠ›è€Œæœ‰æ•ˆ            lock();            break;        &#125;        else if ((retries &amp; 1) == 0 &amp;&amp;                    (f = entryForHash(this, hash)) != first) &#123;            e = first = f; // re-traverse if entry changed            retries = -1;        &#125;    &#125;    return node;&#125;</code></pre><p>é¦–å…ˆç¬¬ä¸€æ­¥çš„æ—¶å€™ä¼šå°è¯•<strong>è·å–é”</strong>ï¼Œå¦‚æœè·å–å¤±è´¥è‚¯å®šå°±æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰ï¼Œåˆ™åˆ©ç”¨<code>scanAndLockForPut()</code><strong>è‡ªæ—‹è·å–é”</strong>ã€‚å¦‚æœé‡è¯•çš„æ¬¡æ•°è¾¾åˆ°äº†<code>MAX_SCAN_RETRIES</code>ï¼ˆCPUæ•°é‡å¤§äº1æ—¶ï¼Œå€¼ä¸º64ï¼Œå¦åˆ™ä¸º1ï¼‰åˆ™æ”¹ä¸ºé˜»å¡é”è·å–ï¼Œä¿è¯èƒ½è·å–æˆåŠŸã€‚</p><blockquote><p>è‡ªæ—‹å°±æ˜¯æ‰§è¡Œä¸€æ®µæ— æ„ä¹‰çš„å¾ªç¯ã€‚</p></blockquote><h3 id="get"><a href="#get" class="headerlink" title="get()"></a><code>get()</code></h3><p><code>get()</code>é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå®šä½ Segment â†’ å®šä½ HashEntry â†’ å®šä½é“¾è¡¨èŠ‚ç‚¹ï¼š</p><pre><code class="java">    public V get(Object key) &#123;        Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead        HashEntry&lt;K,V&gt;[] tab;        int h = hash(key.hashCode());        long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;        // å®šä½ Segment        if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp;            (tab = s.table) != null) &#123;            // å®šä½ HashEntry            for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile                     (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE);                 e != null; e = e.next) &#123;                K k;                // å®šä½é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹                if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k)))                    return e.value;            &#125;        &#125;        return null;    &#125;</code></pre><p>ç”±äº HashEntry ä¸­çš„<code>value</code>å±æ€§æ˜¯ç”¨<code>volatile</code>å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡è·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼ã€‚æ‰€ä»¥ ConcurrentHashMap çš„<code>get()</code>æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚</p><p>ä½†æ˜¯ï¼Œè™½ç„¶ JDK1.7 ä¸­å¯ä»¥æ”¯æŒæ¯ä¸ª Segment å¹¶å‘è®¿é—®ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š<strong>æˆ‘ä»¬å»æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿˜å¾—éå†é“¾è¡¨</strong>ï¼Œä¼šå¯¼è‡´æ•ˆç‡å¾ˆä½ï¼Œè¿™ä¸ªè·Ÿ JDK1.7 çš„ HashMap æ˜¯å­˜åœ¨çš„ä¸€æ ·é—®é¢˜ï¼Œæ‰€ä»¥ä»–åœ¨ JDK1.8 å®Œå…¨ä¼˜åŒ–äº†ã€‚</p><h3 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h3><p>ç„¶åè®²è®²åœ¨ JDK1.7 ä¸­çš„æ‰©å®¹æœºåˆ¶ã€‚</p><p>æˆ‘ä»¬å‘ä¸Šç¿»ä¸€ä¸‹ï¼Œåœ¨<code>put()</code>æ–¹æ³•ä¸­ï¼Œå½“åˆ¤æ–­éœ€è¦æ‰©å®¹æ—¶ï¼Œè°ƒç”¨çš„æ˜¯<code>rehash()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åšçš„ï¼š</p><pre><code class="java">private void rehash(HashEntry&lt;K,V&gt; node) &#123;    HashEntry&lt;K,V&gt;[] oldTable = table;    int oldCapacity = oldTable.length;    int newCapacity = oldCapacity &lt;&lt; 1; // ä¸ HashMap ç›¸åŒï¼Œé‡‡ç”¨2æ¬¡å¹‚æ‰©å®¹    threshold = (int)(newCapacity * loadFactor);    HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity];    int sizeMask = newCapacity - 1;    for (int i = 0; i &lt; oldCapacity ; i++) &#123;        HashEntry&lt;K,V&gt; e = oldTable[i];        if (e != null) &#123;            HashEntry&lt;K,V&gt; next = e.next;            int idx = e.hash &amp; sizeMask;            if (next == null)   // é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹                newTable[idx] = e;            else &#123; // å°†åŸæ¥çš„é¡ºåºåŸå°ä¸åŠ¨åœ°ç§»åˆ°æ–°çš„ table ä¸­                HashEntry&lt;K,V&gt; lastRun = e;                int lastIdx = idx;                for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) &#123;                    int k = last.hash &amp; sizeMask;                    if (k != lastIdx) &#123;                        lastIdx = k;                        lastRun = last;                    &#125;                &#125;                newTable[lastIdx] = lastRun;                               for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123;                    V v = p.value;                    int h = p.hash;                    int k = h &amp; sizeMask;                    HashEntry&lt;K,V&gt; n = newTable[k];                    newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n);                &#125;            &#125;        &#125;    &#125;    int nodeIndex = node.hash &amp; sizeMask; // å°†æ–°çš„èŠ‚ç‚¹åŠ å…¥    node.setNext(newTable[nodeIndex]);    newTable[nodeIndex] = node;    table = newTable;&#125;</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œä¸ HashMap æ‰©å®¹æœºåˆ¶ç±»ä¼¼ï¼Œé‡‡å–äº†<strong>2æ¬¡å¹‚çš„æ–¹å¼</strong>æ¥å†³å®šæ–°æ•°ç»„çš„å¤§å°ã€‚ä½†æ˜¯ï¼ŒSegment æ²¡æœ‰æ‰©å®¹æœºåˆ¶ï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œå°±æŒ‡å®šå¥½äº† Segment æ•°ç»„çš„å¤§å°ï¼Œä¹Ÿæ—¢è¯¥ ConcurrentHashMap çš„å¹¶å‘æ•°ã€‚</p><h3 id="size"><a href="#size" class="headerlink" title="size()"></a><code>size()</code></h3><p>æ—¢ç„¶è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œåœ¨è·å– ConcurrentHashMap çš„å¤§å°æ—¶ï¼Œä¹Ÿè¦ç‰¹æ®Šå¤„ç†ä¸€ä¸‹ã€‚è¿™é‡Œé‡‡ç”¨çš„æ˜¯<strong>å¤šæ¬¡å¯¹æ¯”æœºåˆ¶</strong>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">public int size() &#123;    final Segment&lt;K,V&gt;[] segments = this.segments;    int size;    boolean overflow; // true if size overflows 32 bits    long sum;         // sum of modCounts    long last = 0L;   // previous sum    int retries = -1; // first iteration isn&#39;t retry    try &#123;        for (;;) &#123;            if (retries++ == RETRIES_BEFORE_LOCK) &#123;  // é‡è¯•æ¬¡æ•°è¾¾åˆ°2                for (int j = 0; j &lt; segments.length; ++j)                    ensureSegment(j).lock(); // å¼ºåˆ¶è®©æ‰€æœ‰ Segment è·å¾—é˜»å¡é”            &#125;            sum = 0L;            size = 0;            overflow = false;            for (int j = 0; j &lt; segments.length; ++j) &#123;                Segment&lt;K,V&gt; seg = segmentAt(segments, j);                if (seg != null) &#123;                    sum += seg.modCount;                    int c = seg.count;                    if (c &lt; 0 || (size += c) &lt; 0)                        overflow = true;                &#125;            &#125;            // å¦‚æœæ­¤æ¬¡è·å–çš„å¤§å°ä¸ä¸Šæ¬¡ä¸€è‡´ï¼Œåˆ™è®¤ä¸ºè¿™å°±æ˜¯å½“å‰å¤§å°            if (sum == last)                break;            last = sum;        &#125;    &#125; finally &#123;        if (retries &gt; RETRIES_BEFORE_LOCK) &#123;            for (int j = 0; j &lt; segments.length; ++j)                segmentAt(segments, j).unlock();  // æ¯”å¯¹å®Œæˆåè®©æ‰€æœ‰ Segment è§£é”        &#125;    &#125;    return overflow ? Integer.MAX_VALUE : size;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè‡³å°‘è¦è¿›è¡Œä¸¤æ¬¡éå†ï¼Œå¦‚æœ<strong>ç›¸é‚»çš„ä¸¤æ¬¡éå†è®¡ç®—å‡ºçš„ key-value çš„æ•°é‡æ˜¯ç›¸ç­‰</strong>çš„ï¼Œé‚£å°±è®¤ä¸ºè¿™ä¸ªæ•°é‡æ˜¯å½“å‰çš„æ­£ç¡®æ•°é‡ã€‚å¦‚æœä¸€ç›´å¯¹æ¯”ä¸ä¸Šï¼Œè¿™è¯´æ˜æ•°æ®åœ¨ä¸æ–­åœ°æ›´æ”¹ï¼Œæ­¤æ—¶è¦è®©<strong>æ‰€æœ‰ Segment è·å–é˜»å¡é”</strong>ï¼Œç„¶åå†è¿›è¡Œå¯¹æ¯”ï¼Œå¯¹æ¯”æˆåŠŸåï¼Œè§£é”ï¼Œè¿”å›æ•°é‡ã€‚</p><h2 id="JDK-1-8"><a href="#JDK-1-8" class="headerlink" title="JDK 1.8"></a>JDK 1.8</h2><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>åœ¨ JDK1.8 ä¸­ï¼ŒConcurrentHashMap æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚</p><p>è™½ç„¶å®ƒçš„æºç ä¸­è¿˜æ˜¯ä¼šåŒ…å« Segment ç±»ï¼Œä½†æ˜¯ä¹Ÿåªç”¨åœ¨ Serializable çš„<strong>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong>ä¸­ï¼Œè€Œä¸”å¤šäºäº† Serializable çš„<code>serialVersionUID</code>ç‰¹æ€§ï¼Œåªè¦ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ï¼ŒSegment å¯ä»¥åœ¨ JDK1.7 å’Œ JDK1.8 ç”šè‡³ JDKX.X ä¹‹é—´è‡ªç”±è½¬æ¢ï¼ŒJVM ä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªç±»ã€‚</p><p>è·Ÿ HashMap çš„1.7 â†’ 1.8å¾ˆåƒï¼ŒConcurrentHashMap ä¹ŸæŠŠä¹‹å‰ JDK1.7 ä¸­çš„ HashEntry æ”¹æˆäº† Nodeï¼Œä½†æ˜¯ä½œç”¨ä¸å˜ï¼ŒæŠŠ<code>value</code>å’Œ<code>next</code>é‡‡ç”¨äº†<code>volatile</code>å»ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ï¼Œå¹¶ä¸”ä¹Ÿå¼•å…¥äº†<strong>çº¢é»‘æ ‘</strong>ï¼Œåœ¨é“¾è¡¨å¤§äºä¸€å®šå€¼çš„æ—¶å€™ä¼šè½¬æ¢ï¼ˆé»˜è®¤æ˜¯8ï¼‰ã€‚</p><p>å®ƒçš„æ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/concurrent-hashmap-1589262515.png"></p><p>å¯¹äºæ¯ä¸€ä¸ªé“¾è¡¨ï¼ŒConcurrentHashMap å°†å…¶ç§°ä¹‹ <strong>ã€æ¡¶ã€ï¼ˆbinï¼‰</strong>ã€‚</p><h3 id="put-1"><a href="#put-1" class="headerlink" title="put()"></a><code>put()</code></h3><p>å…ˆçœ‹ä¸€ä¸‹å®ƒçš„ put æ–¹æ³•ï¼š</p><pre><code class="java">public V put(K key, V value) &#123;    return putVal(key, value, false);&#125;final V putVal(K key, V value, boolean onlyIfAbsent) &#123;    if (key == null || value == null) throw new NullPointerException();    // è®¡ç®— hashCode    int hash = spread(key.hashCode());    int binCount = 0;    for (Node&lt;K,V&gt;[] tab = table;;) &#123;  // æ­»å¾ªç¯ç¡®ä¿å¯ä»¥æ’å…¥æ•°æ®        Node&lt;K,V&gt; f;         int n, i, fh;        // å¦‚æœ Node æ•°ç»„ä¸º nullï¼Œåˆ™éœ€è¦åˆå§‹åŒ–ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œ put æ—¶æ‰ä¼šè¿›è¡Œè¿™ä¸ªæ“ä½œ        if (tab == null || (n = tab.length) == 0)            tab = initTable();        else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; // åˆ©ç”¨ (n - 1) &amp; hash è®¡ç®— indexï¼Œå¾—å‡ºè¦æ’å…¥çš„ Node æ•°ç»„çš„ index            // å¦‚æœèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™åˆ©ç”¨ CAS æœºåˆ¶å†™å…¥æ•°æ®            if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) // å‘ç©ºæ¡¶ä¸­æ’å…¥æ•°æ®                break;  // å‘ç©ºçš„æ¡¶ä¸­æ·»åŠ æ•°æ®æ—¶ï¼Œä¸éœ€è¦åŠ é”        &#125;        // è¦æ‰©å®¹äº†        else if ((fh = f.hash) == MOVED)            tab = helpTransfer(tab, f);        else &#123;            // å°è¯•ä½¿ç”¨ synchronized å†™å…¥æ•°æ®            V oldVal = null;            synchronized (f) &#123;                if (tabAt(tab, i) == f) &#123;                    if (fh &gt;= 0) &#123;                        binCount = 1;                        for (Node&lt;K,V&gt; e = f;; ++binCount) &#123;                            K ek;                            if (e.hash == hash &amp;&amp;                                ((ek = e.key) == key ||                                    (ek != null &amp;&amp; key.equals(ek)))) &#123;                                oldVal = e.val;                                if (!onlyIfAbsent)                                    e.val = value;                                break;                            &#125;                            Node&lt;K,V&gt; pred = e;                            if ((e = e.next) == null) &#123;                                pred.next = new Node&lt;K,V&gt;(hash, key,                                                            value, null);                                break;                            &#125;                        &#125;                    &#125;                    // å·²ç»è¢«è½¬æ¢ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹äº†ï¼Œéœ€è¦ç”¨ putTreeVal æ¥è¿›è¡Œæ’å…¥                    else if (f instanceof TreeBin) &#123;                        Node&lt;K,V&gt; p;                        binCount = 2;                        if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,                                                        value)) != null) &#123;                            oldVal = p.val;                            if (!onlyIfAbsent)                                p.val = value;                        &#125;                    &#125;                    else if (f instanceof ReservationNode)                        throw new IllegalStateException(&quot;Recursive update&quot;);                &#125;            &#125;            if (binCount != 0) &#123;                // æ¡¶ä¸­èŠ‚ç‚¹çš„æ•°é‡å¤§äº TREEIFY_THRESHOLDï¼Œå€¼ä¸º8ï¼Œè½¬æ¢çº¢é»‘æ ‘                if (binCount &gt;= TREEIFY_THRESHOLD)                    treeifyBin(tab, i);                if (oldVal != null)                    return oldVal;                break;            &#125;        &#125;    &#125;    addCount(1L, binCount);    return null;&#125;</code></pre><p>ConcurrentHashMap åœ¨è¿›è¡Œ<code>put()</code>æ“ä½œçš„è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®ï¼Œåˆ™éœ€è¦è°ƒç”¨<code>initTable()</code>åˆå§‹åŒ– Node æ•°ç»„ï¼›</li><li>åˆ©ç”¨<code>(n - 1) &amp; hash</code>å¾—å‡ºè¦æ’å…¥çš„æ•°ç»„ indexï¼›</li><li>å¦‚æœæ•°ç»„çš„ index ä½ç½®ä¸º nullï¼Œåˆ™ç›´æ¥åˆ©ç”¨ CAS æœºåˆ¶æ’å…¥ï¼Œä¸éœ€è¦åŠ é”ï¼›</li><li>å¦‚æœæ•°ç»„çš„ index ä½ç½®ä¸ä¸º nullï¼Œåˆ™è¦ä½¿ç”¨ synchronized æ–¹å¼æ’å…¥åˆ°æ¡¶ï¼ˆé“¾è¡¨ï¼‰ä¸­ï¼›</li><li>å¦‚æœæ’å…¥å®Œæˆåï¼Œæ¡¶çš„èŠ‚ç‚¹æ•°é‡å¤§äºç­‰äº8äº†ï¼Œå°±è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼ˆçº¢é»‘æ¡¶ğŸ›¢ï¼‰ï¼›</li><li>å¦‚æœèŠ‚ç‚¹çš„ hash å€¼ä¸º -1ï¼Œåˆ™éœ€è¦æ‰©å®¹ã€‚</li></ol><blockquote><p><strong>CASï¼ˆCompare And Swapï¼‰</strong></p><p>CAS æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæ˜¯ä¸€ç§è½»é‡çº§é”ï¼ŒJUC ä¸­å¾ˆå¤šå·¥å…·ç±»çš„å®ç°å°±æ˜¯åŸºäº CAS çš„ã€‚<br>CAS çš„ä¸­å¿ƒæ€æƒ³æ˜¯çº¿ç¨‹<strong>åœ¨è¯»å–æ•°æ®æ—¶ä¸è¿›è¡ŒåŠ é”</strong>ï¼Œåœ¨å‡†å¤‡å†™å›æ•°æ®æ—¶ï¼Œ<strong>æ¯”è¾ƒåŸå€¼æ˜¯å¦ä¿®æ”¹</strong>ï¼Œè‹¥æœªè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹åˆ™å†™å›ï¼Œè‹¥å·²è¢«ä¿®æ”¹ï¼Œåˆ™&gt; é‡æ–°æ‰§è¡Œè¯»å–æµç¨‹ã€‚<br>è¿™æ˜¯ä¸€ç§<strong>ä¹è§‚ç­–ç•¥</strong>ï¼Œè®¤ä¸ºå¹¶å‘æ“ä½œå¹¶ä¸æ€»ä¼šå‘ç”Ÿã€‚</p><p>ä½†æ˜¯ç»å…¸çš„ ABA é—®é¢˜ï¼Œå®ƒå°±æ— æ³•åˆ¤æ–­äº†ã€‚å°±æ˜¯æ•°æ®ä» A å˜ä¸º B åˆå˜æˆ Aï¼Œçœ‹ä¼¼æ²¡ä¿®æ”¹è¿‡ï¼Œä½†å®é™…ä¸Šæ˜¯ä¿®æ”¹è¿‡çš„ã€‚<br>æƒ³è¦è§£å†³ ABA é—®é¢˜ï¼Œè¦ä¹ˆä½¿ç”¨ç‰ˆæœ¬å·ï¼Œè¦ä¹ˆä½¿ç”¨æ—¶é—´æˆ³æ ‡è¯†ï¼Œéƒ½å¯ä»¥ã€‚</p></blockquote><h3 id="get-1"><a href="#get-1" class="headerlink" title="get()"></a><code>get()</code></h3><p>å†æ¥çœ‹å®ƒçš„<code>get()</code>ï¼š</p><pre><code class="java">public V get(Object key) &#123;    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek;    int h = spread(key.hashCode());    // æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æœå°±åœ¨é“¾è¡¨ä¸Šé‚£ä¹ˆç›´æ¥è¿”å›å€¼ã€‚    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;        (e = tabAt(tab, (n - 1) &amp; h)) != null) &#123;        // å¦‚æœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼è·å–å€¼ã€‚        if ((eh = e.hash) == h) &#123;            if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))                return e.val;        &#125;        // éƒ½ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†è·å–å€¼ã€‚        else if (eh &lt; 0)            return (p = e.find(h, key)) != null ? p.val : null;        while ((e = e.next) != null) &#123;            if (e.hash == h &amp;&amp;                ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))))                return e.val;        &#125;    &#125;    return null;&#125;</code></pre><p>æ¯”è¾ƒç®€å•ï¼Œä¹Ÿä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºèŠ‚ç‚¹çš„å€¼éƒ½æ˜¯ volatile çš„ã€‚</p><h3 id="æ‰©å®¹æœºåˆ¶-1"><a href="#æ‰©å®¹æœºåˆ¶-1" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h3><p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) &#123;    int n = tab.length, stride;    if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)        stride = MIN_TRANSFER_STRIDE; // subdivide range    if (nextTab == null) &#123;            // initiating        try &#123;            @SuppressWarnings(&quot;unchecked&quot;)            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1];            nextTab = nt;        &#125; catch (Throwable ex) &#123;      // try to cope with OOME            sizeCtl = Integer.MAX_VALUE;            return;        &#125;        nextTable = nextTab;        transferIndex = n;    &#125;    int nextn = nextTab.length;    ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab);    boolean advance = true;    boolean finishing = false; // to ensure sweep before committing nextTab    for (int i = 0, bound = 0;;) &#123;        Node&lt;K,V&gt; f; int fh;        while (advance) &#123;            int nextIndex, nextBound;            if (--i &gt;= bound || finishing)                advance = false;            else if ((nextIndex = transferIndex) &lt;= 0) &#123;                i = -1;                advance = false;            &#125;            else if (U.compareAndSwapInt                        (this, TRANSFERINDEX, nextIndex,                        nextBound = (nextIndex &gt; stride ?                                    nextIndex - stride : 0))) &#123;                bound = nextBound;                i = nextIndex - 1;                advance = false;            &#125;        &#125;        if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) &#123;            int sc;            if (finishing) &#123;                nextTable = null;                table = nextTab;                sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1);                return;            &#125;            if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) &#123;                if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)                    return;                finishing = advance = true;                i = n; // recheck before commit            &#125;        &#125;        else if ((f = tabAt(tab, i)) == null)            advance = casTabAt(tab, i, null, fwd);        else if ((fh = f.hash) == MOVED)            advance = true; // already processed        else &#123;            synchronized (f) &#123;                if (tabAt(tab, i) == f) &#123;                    Node&lt;K,V&gt; ln, hn;                    if (fh &gt;= 0) &#123;                        int runBit = fh &amp; n;                        Node&lt;K,V&gt; lastRun = f;                        for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) &#123;                            int b = p.hash &amp; n;                            if (b != runBit) &#123;                                runBit = b;                                lastRun = p;                            &#125;                        &#125;                        if (runBit == 0) &#123;                            ln = lastRun;                            hn = null;                        &#125;                        else &#123;                            hn = lastRun;                            ln = null;                        &#125;                        for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;                            int ph = p.hash; K pk = p.key; V pv = p.val;                            if ((ph &amp; n) == 0)                                ln = new Node&lt;K,V&gt;(ph, pk, pv, ln);                            else                                hn = new Node&lt;K,V&gt;(ph, pk, pv, hn);                        &#125;                        setTabAt(nextTab, i, ln);                        setTabAt(nextTab, i + n, hn);                        setTabAt(tab, i, fwd);                        advance = true;                    &#125;                    else if (f instanceof TreeBin) &#123;                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;                        TreeNode&lt;K,V&gt; lo = null, loTail = null;                        TreeNode&lt;K,V&gt; hi = null, hiTail = null;                        int lc = 0, hc = 0;                        for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) &#123;                            int h = e.hash;                            TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;                                (h, e.key, e.val, null, null);                            if ((h &amp; n) == 0) &#123;                                if ((p.prev = loTail) == null)                                    lo = p;                                else                                    loTail.next = p;                                loTail = p;                                ++lc;                            &#125;                            else &#123;                                if ((p.prev = hiTail) == null)                                    hi = p;                                else                                    hiTail.next = p;                                hiTail = p;                                ++hc;                            &#125;                        &#125;                        ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :                            (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t;                        hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :                            (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t;                        setTabAt(nextTab, i, ln);                        setTabAt(nextTab, i + n, hn);                        setTabAt(tab, i, fwd);                        advance = true;                    &#125;                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><p>ConcurrentHashMap çš„ JDK1.8 ä¸ JDK1.7 ç‰ˆæœ¬çš„å¹¶å‘å®ç°ç›¸æ¯”ï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äº JDK1.8 çš„<strong>é”çš„ç²’åº¦æ›´ç»†</strong>ã€‚</p><p>ç†æƒ³æƒ…å†µä¸‹ table æ•°ç»„å…ƒç´ çš„å¤§å°å°±æ˜¯å…¶æ”¯æŒå¹¶å‘çš„æœ€å¤§ä¸ªæ•°ï¼Œåœ¨ JDK1.7 é‡Œé¢æœ€å¤§å¹¶å‘ä¸ªæ•°å°±æ˜¯ Segment çš„ä¸ªæ•°ï¼Œé»˜è®¤å€¼æ˜¯16ï¼Œå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ”¹å˜ä¸€ç»åˆ›å»ºä¸å¯æ›´æ”¹ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å¹¶å‘çš„ç²’åº¦ï¼Œæ¯ä¸€ä¸ª Segment ä¸‹é¢ç®¡ç†ä¸€ä¸ª table æ•°ç»„ï¼ŒåŠ é”çš„æ—¶å€™å…¶å®é”ä½çš„æ˜¯æ•´ä¸ª Segmentï¼Œè¿™æ ·è®¾è®¡çš„å¥½å¤„åœ¨äºæ•°ç»„çš„æ‰©å®¹æ˜¯ä¸ä¼šå½±å“å…¶ä»–çš„ Segmentï¼Œç®€åŒ–äº†å¹¶å‘è®¾è®¡ï¼Œä¸è¶³ä¹‹å¤„åœ¨äºå¹¶å‘çš„ç²’åº¦ç¨ç²—ï¼Œæ‰€ä»¥åœ¨ JDK1.8 é‡Œé¢ï¼Œå»æ‰äº†åˆ†æ®µé”ï¼Œå°†é”çš„çº§åˆ«æ§åˆ¶åœ¨äº†æ›´ç»†ç²’åº¦çš„ table å…ƒç´ çº§åˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´åªéœ€è¦<strong>é”ä½è¿™ä¸ªé“¾è¡¨çš„ head èŠ‚ç‚¹ï¼Œå¹¶ä¸ä¼šå½±å“å…¶ä»–çš„ table å…ƒç´ çš„è¯»å†™</strong>ï¼Œå¥½å¤„åœ¨äº<strong>å¹¶å‘çš„ç²’åº¦æ›´ç»†ï¼Œå½±å“æ›´å°</strong>ï¼Œä»è€Œå¹¶å‘æ•ˆç‡æ›´å¥½ï¼Œä½†ä¸è¶³ä¹‹å¤„åœ¨äºå¹¶å‘æ‰©å®¹çš„æ—¶å€™ï¼Œç”±äºæ“ä½œçš„ table éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¸åƒ JDK1.7 ä¸­åˆ†æ®µæ§åˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œ<strong>éœ€è¦ç­‰æ‰©å®¹å®Œä¹‹åï¼Œæ‰€æœ‰çš„è¯»å†™æ“ä½œæ‰èƒ½è¿›è¡Œ</strong>ï¼Œæ‰€ä»¥æ‰©å®¹çš„æ•ˆç‡å°±æˆä¸ºäº†æ•´ä¸ªå¹¶å‘çš„ä¸€ä¸ªç“¶é¢ˆç‚¹ã€‚å¥½åœ¨ Doug lea å¤§ç¥å¯¹æ‰©å®¹åšäº†ä¼˜åŒ–ï¼Œæœ¬æ¥åœ¨ä¸€ä¸ªçº¿ç¨‹æ‰©å®¹çš„æ—¶å€™ï¼Œå¦‚æœå½±å“äº†å…¶ä»–çº¿ç¨‹çš„æ•°æ®ï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹çš„è¯»å†™æ“ä½œéƒ½<strong>åº”è¯¥é˜»å¡</strong>ï¼Œä½†æ˜¯ä»–ä»¬é—²ç€ä¹Ÿæ˜¯é—²ç€ï¼Œä¸å¦‚æ¥ä¸€èµ·å‚ä¸æ‰©å®¹ä»»åŠ¡ï¼Œè¿™æ ·äººå¤šåŠ›é‡å¤§ï¼ŒåŠå®Œäº‹ä½ ä»¬è¯¥å¹²å•¥å¹²å•¥ï¼Œåˆ«æµªè´¹æ—¶é—´ï¼Œäºæ˜¯åœ¨ JDK1.8 çš„æºç é‡Œé¢å°±å¼•å…¥äº†ä¸€ä¸ª ForwardingNode ç±»ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹å‘èµ·æ‰©å®¹çš„æ—¶å€™ï¼Œå°±ä¼šæ”¹å˜ <code>sizeCtl</code> è¿™ä¸ªå€¼ï¼Œå…¶å«ä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p><strong>sizeCtl</strong> ï¼šé»˜è®¤ä¸º0ï¼Œç”¨æ¥æ§åˆ¶tableçš„åˆå§‹åŒ–å’Œæ‰©å®¹æ“ä½œï¼Œå…·ä½“åº”ç”¨åœ¨åç»­ä¼šä½“ç°å‡ºæ¥ã€‚<br>å€¼ä¸º -1 æ—¶ä»£è¡¨ table æ­£åœ¨åˆå§‹åŒ–<br>å€¼ä¸º -(1 + n) æ—¶ï¼Œè¡¨ç¤ºæ­£åœ¨æœ‰ n ä¸ªçº¿ç¨‹æ­£åœ¨æ‰©å®¹<br>å¦‚æœ table æœªåˆå§‹åŒ–ï¼Œå€¼è¡¨ç¤º table éœ€è¦åˆå§‹åŒ–çš„å¤§å°<br>å¦‚æœ table åˆå§‹åŒ–å®Œæˆï¼Œè¡¨ç¤º table çš„å®¹é‡ï¼Œå€¼æ˜¯ <code>table çš„å¤§å° x è´Ÿè½½å› å­</code></p></blockquote><p>æ‰©å®¹æ—¶å€™ä¼šåˆ¤æ–­è¿™ä¸ªå€¼ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼å°±è¦æ‰©å®¹ï¼Œé¦–å…ˆæ ¹æ®è¿ç®—å¾—åˆ°éœ€è¦éå†çš„æ¬¡æ•°iï¼Œç„¶ååˆ©ç”¨<code>tabAt()</code>æ–¹æ³•è·å¾—<code>i</code>ä½ç½®çš„å…ƒç´ <code>f</code>ï¼Œåˆå§‹åŒ–ä¸€ä¸ªForwardingNode å®ä¾‹<code>fwd</code>ï¼Œå¦‚æœ<code>f == null</code>ï¼Œåˆ™åœ¨tableä¸­çš„<code>i</code>ä½ç½®æ”¾å…¥<code>fwd</code>ï¼Œå¦åˆ™é‡‡ç”¨å¤´æ’æ³•çš„æ–¹å¼æŠŠå½“å‰æ—§ table æ•°ç»„çš„æŒ‡å®šä»»åŠ¡èŒƒå›´çš„æ•°æ®ç»™è¿ç§»åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œç„¶å ç»™æ—§ table åŸä½ç½®èµ‹å€¼<code>fwd</code>ã€‚ç›´åˆ°éå†è¿‡æ‰€æœ‰çš„èŠ‚ç‚¹ä»¥åå°±å®Œæˆäº†å¤åˆ¶å·¥ä½œï¼ŒæŠŠ table æŒ‡å‘ nextTableï¼Œå¹¶æ›´æ–°<code>sizeCtl</code>ä¸ºæ–°æ•°ç»„å¤§å°çš„0.75å€ ï¼Œæ‰©å®¹å®Œæˆã€‚åœ¨æ­¤æœŸé—´å¦‚æœå…¶ä»–çº¿ç¨‹çš„æœ‰è¯»å†™æ“ä½œéƒ½ä¼šåˆ¤æ–­<code>head</code>èŠ‚ç‚¹æ˜¯å¦ä¸º ForwardingNode èŠ‚ç‚¹ ï¼Œå¦‚æœæ˜¯å°±å¸®åŠ©æ‰©å®¹ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ ForwadingNode çš„ä»£ç ï¼š</p><pre><code class="java">static final int MOVED     = -1; // hash for forwarding nodes/** * A node inserted at head of bins during transfer operations. */static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;    final Node&lt;K,V&gt;[] nextTable;    ForwardingNode(Node&lt;K,V&gt;[] tab) &#123;        super(MOVED, null, null, null);        this.nextTable = tab;    &#125;    Node&lt;K,V&gt; find(int h, Object k) &#123;        // ä½¿ç”¨å¾ªç¯ï¼Œé¿å…å¤šæ¬¡ç¢°åˆ° ForwardingNode å¯¼è‡´é€’å½’è¿‡æ·±        outer: for (Node&lt;K,V&gt;[] tab = nextTable;;) &#123;            Node&lt;K,V&gt; e; int n;            if (k == null || tab == null || (n = tab.length) == 0 ||                (e = tabAt(tab, (n - 1) &amp; h)) == null)                return null;            for (;;) &#123;                int eh; K ek;                if ((eh = e.hash) == h &amp;&amp;                    ((ek = e.key) == k || (ek != null &amp;&amp; k.equals(ek))))  // ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›                    return e;                if (eh &lt; 0) &#123;                    if (e instanceof ForwardingNode) &#123;                        tab = ((ForwardingNode&lt;K,V&gt;)e).nextTable;                        continue outer;                    &#125;                    else                        return e.find(h, k);  // ç‰¹æ®ŠèŠ‚ç‚¹ï¼Œè°ƒç”¨å…¶findæ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾                &#125;                if ((e = e.next) == null)  // æ™®é€šèŠ‚ç‚¹ç›´æ¥å¾ªç¯éå†é“¾è¡¨                    return null;            &#125;        &#125;    &#125;&#125;</code></pre><p>ForwardingNode æ˜¯ä¸€ç§ä¸´æ—¶èŠ‚ç‚¹ï¼Œåœ¨<strong>æ‰©å®¹è¿›è¡Œä¸­</strong>æ‰ä¼šå‡ºç°ï¼Œhash å€¼å›ºå®šä¸º -1ï¼Œå¹¶ä¸”å®ƒä¸å­˜å‚¨å®é™…çš„æ•°æ®æ•°æ®ã€‚å¦‚æœæ—§æ•°ç»„çš„ä¸€ä¸ª hash æ¡¶ä¸­å…¨éƒ¨çš„èŠ‚ç‚¹éƒ½è¿ç§»åˆ°æ–°æ•°ç»„ä¸­ï¼Œæ—§æ•°ç»„å°±åœ¨è¿™ä¸ª hash æ¡¶ä¸­æ”¾ç½®ä¸€ä¸ª ForwardingNodeã€‚è¯»æ“ä½œæˆ–è€…è¿­ä»£è¯»æ—¶ç¢°åˆ° ForwardingNode æ—¶ï¼Œå°†æ“ä½œè½¬å‘åˆ°æ‰©å®¹åçš„æ–°çš„ table æ•°ç»„ä¸Šå»æ‰§è¡Œï¼Œå†™æ“ä½œç¢°è§å®ƒæ—¶ï¼Œåˆ™å°è¯•å¸®åŠ©æ‰©å®¹ã€‚</p><h3 id="size-1"><a href="#size-1" class="headerlink" title="size()"></a><code>size()</code></h3><p>ä¸ jdk1.7 ä¸­çš„è®¡æ•°æ–¹å¼ä¸åŒï¼Œjdk1.8 ä¸­çš„ ConcurrentHashMap å¼•å…¥äº†ä¸€ä¸ª CounterCell ç±»ï¼Œç”¨äºè®°å½•æ¯ä¸€ä¸ªæ¡¶ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼Œåœ¨<code>put()</code>å€¼æ—¶ï¼Œæœ€åè°ƒç”¨çš„<code>addCount()</code>ä¸­ï¼Œå°±ä¼šå¯¹è¿™ä¸ªå€¼åšå‡ºä¿®æ”¹ï¼Œæ‰€ä»¥åœ¨<code>size()</code>æ—¶ï¼Œç›´æ¥ä½¿ç”¨å¾ªç¯æ–¹å¼ç´¯åŠ æ‰€æœ‰çš„ CounterCell çš„å€¼å³å¯å¾—å‡ºå½“å‰çš„ key-value çš„æ•°é‡ã€‚</p><pre><code class="java">public int size() &#123;    long n = sumCount();    return ((n &lt; 0L) ? 0 :            (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :            (int)n);&#125;static final class CounterCell &#123;    volatile long value;    CounterCell(long x) &#123; value = x; &#125;&#125;final long sumCount() &#123;    CounterCell[] as = counterCells; CounterCell a;    long sum = baseCount;    if (as != null) &#123;        for (int i = 0; i &lt; as.length; ++i) &#123;            if ((a = as[i]) != null)                sum += a.value;        &#125;    &#125;    return sum;&#125;</code></pre><blockquote><p>çº¢é»‘æ ‘ï¼ˆRed Black Treeï¼‰ æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å®ƒæ˜¯ä¸€ç§ç‰¹åŒ–çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œéƒ½æ˜¯åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶é€šè¿‡ç‰¹å®šæ“ä½œä¿æŒäºŒå‰æŸ¥æ‰¾&gt; æ ‘çš„å¹³è¡¡ï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æŸ¥æ‰¾æ€§èƒ½ã€‚å®ƒçš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ˜¯O(log n)ã€‚</p><p>çº¢é»‘æ ‘æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰é¢œè‰²å±æ€§çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œé¢œè‰²æˆ–çº¢è‰²æˆ–é»‘è‰²ã€‚åœ¨äºŒå‰æŸ¥æ‰¾æ ‘å¼ºåˆ¶ä¸€èˆ¬è¦æ±‚ä»¥å¤–ï¼Œå¯¹äºä»»ä½•æœ‰æ•ˆçš„çº¢é»‘æ ‘æˆ‘ä»¬å¢åŠ äº†å¦‚ä¸‹çš„&gt; é¢å¤–è¦æ±‚:</p><ol><li>èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰² </li><li>æ‰€æœ‰å¶å­éƒ½æ˜¯é»‘è‰²ã€‚ï¼ˆå¶å­æ˜¯NUILèŠ‚ç‚¹ï¼‰</li><li>æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ã€‚ï¼ˆä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ï¼‰</li><li>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹</li></ol></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Service</title>
      <link href="/2020-05-10/service/"/>
      <url>/2020-05-10/service/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Android ç³»ç»Ÿä¸­ï¼Œå››å¤§ç»„ä»¶ä¸­ï¼ŒService çš„é‡è¦æ€§ä¹Ÿæ˜¯ä¸è¨€è€Œå–»çš„ï¼Œå®ƒå¯ä»¥é•¿æ—¶é—´åœ¨åå°ç”Ÿå­˜ï¼Œæ‰§è¡Œä¸€äº›å¤æ‚çš„æˆ–è€…è€—æ—¶çš„å·¥ä½œã€‚å³ä¾¿ç”¨æˆ·åˆ‡æ¢åˆ°äº†å…¶ä»–åº”ç”¨ï¼ŒService ä»å°†åœ¨åå°ç»§ç»­è¿è¡Œã€‚æ­¤å¤–ï¼Œç»„ä»¶å¯é€šè¿‡ç»‘å®šåˆ° Service ä¸ä¹‹è¿›è¡Œäº¤äº’ï¼Œç”šè‡³æ˜¯æ‰§è¡Œè¿›ç¨‹é—´é€šä¿¡ (IPC)ã€‚</p><span id="more"></span><h2 id="Service-çš„åˆ†ç±»"><a href="#Service-çš„åˆ†ç±»" class="headerlink" title="Service çš„åˆ†ç±»"></a>Service çš„åˆ†ç±»</h2><p>æˆ‘ä»¬ä¸€èˆ¬å°† Service åˆ†ä¸ºä¸‰å¤§ç±»ï¼šåå° Service ã€ç»‘å®š Service å’Œå‰å° Service ã€‚å…¶ä¸­ï¼Œåå° Service å’Œç»‘å®š Service æ˜¯ã€ä¸å¯è§ Serviceã€ï¼Œå‰å° Service æ˜¯ã€å¯è§ Serviceã€ã€‚</p><h3 id="åå°-Service"><a href="#åå°-Service" class="headerlink" title="åå° Service"></a>åå° Service</h3><p>åå° Service ï¼ˆBackground Serviceï¼‰ä¸€èˆ¬æ˜¯ç”¨æ¥æ‰§è¡Œä¸€äº›ç”¨æˆ·ä¸ä¼šç›´æ¥æ³¨æ„åˆ°çš„æ“ä½œï¼Œæ¯”å¦‚è§£å‹æ•°æ®åŒ…ï¼Œæ¯”å¦‚è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAPI 26ï¼ˆAndroid 8.0ï¼‰ä¹‹åï¼Œå¦‚æœåº”ç”¨æœ¬èº«æ²¡æœ‰åœ¨å‰å°è¿è¡Œï¼Œç³»ç»Ÿä¼šå¯¹åå°<strong>å¯æ‰§è¡Œçš„æ“ä½œå¢åŠ ä¸€äº›é™åˆ¶</strong>ã€‚è¿™äº›é™åˆ¶æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li><p><strong>åå° Service é™åˆ¶</strong>ã€‚è¿™äº›é™åˆ¶ä¸é€‚ç”¨äºå‰å° Serviceï¼Œå› ä¸ºå‰å° Service æ›´å®¹æ˜“å¼•èµ·ç”¨æˆ·æ³¨æ„ã€‚</p><p>åœ¨åå°è¿è¡Œçš„ Service ä¼šæ¶ˆè€—èµ„æºï¼Œè¿™æœ‰å¯èƒ½ä¼šé€ æˆä¸è‰¯çš„ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥ Android å¯¹åº”ç”¨çŠ¶æ€è¿›è¡Œäº†åŒºåˆ†ï¼š<strong>å‰å°åº”ç”¨</strong>å’Œ<strong>åå°åº”ç”¨</strong>ã€‚æ»¡è¶³ä¸‹é¢ä»»æ„æ¡ä»¶ï¼Œå³å¯è§†ä¸ºå‰å°åº”ç”¨ï¼š</p><ul><li>å…·æœ‰å¯è§çš„ Activity</li><li>å…·æœ‰å‰å° Service</li><li>å¦ä¸€ä¸ªå‰å°åº”ç”¨å·²å…³è”åˆ°è¯¥åº”ç”¨ï¼Œæ¯”å¦‚è¯´è¾“å…¥æ³•åœ¨åº”ç”¨ä¸­å¼¹å‡ºï¼Œåº”ç”¨æ­£åœ¨ä¸å±å¹•è¯†åˆ«å’Œè¯»å–åŠŸèƒ½äº¤äº’ç­‰ç­‰ã€‚</li></ul><p>å¦‚æœä¸Šé¢çš„æ¡ä»¶<strong>éƒ½ä¸æ»¡è¶³</strong>ï¼Œåº”ç”¨å°±ä¼šè¢«è§†ä¸º<strong>åå°åº”ç”¨</strong>ã€‚</p><p>å½“åº”ç”¨å¤„äºå‰å°æ—¶ï¼Œå¯ä»¥éšæ„åˆ›å»ºå’Œè¿è¡Œå‰å°ã€åå° Serviceã€‚å½“è¿›å…¥åå°æ—¶ï¼Œä¼šæœ‰å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œåº”ç”¨ä»ç„¶å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨ Serviceï¼Œè¿™ä¸ªæ—¶é—´ä¸€è¿‡ï¼Œåº”ç”¨å°±ä¼šè¢«è§†ä¸ºå¤„äº<strong>ç©ºé—²</strong>çŠ¶æ€ï¼Œè¿™æ—¶ï¼Œç³»ç»Ÿå°†<strong>åœæ­¢åº”ç”¨çš„åå° Service</strong>ã€‚</p><p>ä½†æ˜¯ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ JobScheduler æ¥å®Œæˆ Service èƒ½å®Œæˆçš„æ“ä½œã€‚å¯¹äº JobScheduler çš„è§£æï¼Œåœ¨<br><a href="/jobscheduler-and-workmanager/" target="_blank">è¿™ç¯‡æ–‡ç« é‡Œ</a>ã€‚</p></li><li><p><strong>å¹¿æ’­é™åˆ¶</strong>ã€‚é™¤äº†ä¸€äº›ç‰¹æ®Šçš„ä¾‹å¤–æƒ…å†µï¼Œåº”ç”¨<strong>æ— æ³•ä½¿ç”¨ AndroidManifest æ³¨å†Œéšå¼å¹¿æ’­</strong>ã€‚ä½†æ˜¯ä»ç„¶å¯ä»¥åœ¨è¿è¡Œæ—¶æ³¨å†Œå¹¿æ’­ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ AndroidManifest æ³¨å†Œ<strong>ä¸“é—¨é’ˆå¯¹å®ƒä»¬çš„æ˜¾å¼å¹¿æ’­</strong>ã€‚å…·ä½“çš„é™åˆ¶å¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨<strong>ä¸èƒ½åœ¨ AndroidManifest ä¸­ä¸ºéšå¼å¹¿æ’­æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨</strong>ã€‚ä¾‹å¦‚<code>ACTION_PACKAGE_REPLACED</code>å¹¿æ’­ã€‚æ˜¾å¼å¹¿æ’­ä¸å—å½±å“ã€‚</li><li>åº”ç”¨å¯ä»¥ä½¿ç”¨<code>Context.registerReceiver()</code>ä¸ºä»»æ„å¹¿æ’­ï¼ˆä¸ç®¡æ˜¯æ˜¾å¼è¿˜æ˜¯éšå¼ï¼‰æ³¨å†Œæ¥æ”¶å™¨ã€‚</li><li>éœ€è¦<strong>ç­¾åæƒé™çš„å¹¿æ’­ä¸å—æ­¤é™åˆ¶æ‰€é™</strong>ï¼Œå› ä¸ºè¿™äº›å¹¿æ’­åªä¼šå‘é€åˆ°ä½¿ç”¨ç›¸åŒè¯ä¹¦ç­¾åçš„åº”ç”¨ï¼Œè€Œä¸æ˜¯å‘é€åˆ°è®¾å¤‡ä¸Šçš„æ‰€æœ‰åº”ç”¨ã€‚</li></ul><p>åŒæ ·åœ°ï¼Œä¹‹å‰ä½¿ç”¨éšå¼å¹¿æ’­çš„åº”ç”¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>JobScheduler + åŠ¨æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨</strong>æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p></li></ol><h3 id="ç»‘å®š-Service"><a href="#ç»‘å®š-Service" class="headerlink" title="ç»‘å®š Service"></a>ç»‘å®š Service</h3><p>å½“ç³»ç»Ÿç»„ä»¶ä¸ Service è¿›è¡Œç»‘å®šæ—¶ï¼Œ Service å°±å¤„äºã€<strong>ç»‘å®šçŠ¶æ€</strong>ã€ã€‚ç»‘å®š Service ä¼šä»¥ C/S æ¨¡å¼æä¾›æ¥å£ï¼Œä»¥ä¾¿ç»„ä»¶ä¸ Service è¿›è¡Œäº¤äº’ã€å‘é€è¯·æ±‚ã€æ¥æ”¶ç»“æœï¼Œç”šè‡³æ˜¯è·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰æ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚ç»‘å®š Service åªä¼š<strong>åœ¨ä¸æŸä¸ªç³»ç»Ÿç»„ä»¶ç»‘å®šæ—¶æ‰ä¼šè¿è¡Œ</strong>ã€‚å¤šä¸ªç»„ä»¶å¯åŒæ—¶ç»‘å®šåˆ°è¯¥ Service ï¼Œå…¨éƒ¨å–æ¶ˆç»‘å®šåï¼Œè¯¥ Service æ‰ä¼šè¢«é”€æ¯ã€‚</p><p>ä½†æ˜¯ï¼Œç»‘å®š Service å¹¶ä¸æ˜¯è¯´ä¸èƒ½ä»¥æ­£å¸¸çš„æ–¹å¼æ¥è¿è¡Œï¼Œä¸€ä¸ª Service ï¼Œå®ƒæ—¢å¯ä»¥æ˜¯å¯åŠ¨ Service ï¼ˆä»¥æ— é™æœŸè¿è¡Œï¼‰ï¼Œä¹ŸåŒæ—¶æ”¯æŒç»‘å®šï¼Œçœ‹ä½ è¦è¦†å†™å“ªç§æ–¹æ³•äº†ï¼š<code>onStartCommand()</code>æ˜¯è®©ç»„ä»¶æ¥å¯åŠ¨ Service åä¼šå›è°ƒçš„æ–¹æ³•ï¼Œè€Œ<code>onBind()</code>æ˜¯ä»¥ç»‘å®šæ–¹å¼å¯åŠ¨ Service åå›è°ƒçš„æ–¹æ³•ã€‚ä½†æ— è®ºæ˜¯å“ªç§ Service ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Intent æ¥å¯åŠ¨å®ƒã€‚</p><h3 id="å‰å°-Service"><a href="#å‰å°-Service" class="headerlink" title="å‰å° Service"></a>å‰å° Service</h3><p>å‰å° Service ï¼ˆForeground Serviceï¼‰å¯ä»¥è¢«ç”¨æˆ·çœ‹åˆ°ã€‚é€šå¸¸å‰å° Service <strong>å¿…é¡»åœ¨é€šçŸ¥æ æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥</strong>ï¼Œæ¯”å¦‚å„ç§éŸ³ä¹ APPï¼š</p><p><img src="/img/service-1588775376.jpeg"></p><p>å³ä½¿ç”¨æˆ·åœæ­¢ä¸ App çš„äº¤äº’ï¼Œ Service ä¹Ÿä¾ç„¶ä¼šç»§ç»­è¿è¡Œã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Service"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Service" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Service"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Service</h2><p>å¦‚ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨ Service æœ‰è¯¸å¤šé™åˆ¶ï¼Œè€Œä¸”è¿˜åˆ†ä»€ä¹ˆå‰å°åå°ç»‘å®šï¼Œ<strong>ç”¨å­çº¿ç¨‹å®ƒä¸é¦™å—ï¼Ÿ</strong></p><p>è¿™é‡Œè¦çœ‹ä½¿ç”¨åœºæ™¯ã€‚</p><p>Service æ˜¯ä¸€ç§å³ä¾¿ç”¨æˆ·ä¸ä¸å®ƒäº¤äº’ï¼Œä¹Ÿèƒ½ä¸€ç›´è¿è¡Œåœ¨åå°çš„ç»„ä»¶ï¼Œå®ƒé»˜è®¤æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šçš„ã€‚å› æ­¤ï¼ŒService é€‚åˆ<strong>æ‰§è¡ŒçŸ­æœŸçš„ã€ä¸é˜»å¡çš„ã€ä¸ä¸ç”¨æˆ·äº¤äº’çš„ä»»åŠ¡</strong>ã€‚å¦‚æœä½ å¿…é¡»è¦åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å¯†é›†æ€§çš„ç½‘ç»œé€šä¿¡ã€æ¯”å¦‚è¿›è¡Œå¤§é‡æ•°æ®çš„åˆå§‹åŒ–å’Œè§£æï¼Œé‚£ä½ æœ€å¥½è¿˜æ˜¯é€‰æ‹©åœ¨ Service ä¸­æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥åšè¿™ä»¶äº‹ã€‚</p><h2 id="Service-çš„é£Ÿç”¨æŒ‡å—"><a href="#Service-çš„é£Ÿç”¨æŒ‡å—" class="headerlink" title="Service çš„é£Ÿç”¨æŒ‡å—"></a>Service çš„é£Ÿç”¨æŒ‡å—</h2><h3 id="è¦†å†™æ–¹æ³•"><a href="#è¦†å†™æ–¹æ³•" class="headerlink" title="è¦†å†™æ–¹æ³•"></a>è¦†å†™æ–¹æ³•</h3><p>ä½¿ç”¨ Service çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦è‡ªå®šä¹‰ä¸€ä¸ªç»§æ‰¿ Service çš„ç±»ï¼Œå¹¶è¦†å†™ä¸‹é¢å‡ ç§é‡è¦çš„æ–¹æ³•ï¼š</p><ul><li><p><code>onStartCommand(Intent intent, int flags, int startId)</code>ï¼š</p><p>å½“å¦ä¸€ä¸ªç»„ä»¶ï¼ˆå¦‚ Activityï¼‰è¯·æ±‚å¯åŠ¨ Service æ—¶ï¼Œä¸€èˆ¬ä¼šé€šè¿‡è°ƒç”¨<code>startService()</code>æ¥å¯åŠ¨ï¼Œæ­¤æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œ<code>onStartCommand()</code>æ–¹æ³•ï¼ˆå…·ä½“å¦‚ä½•è°ƒç”¨çš„ï¼ŒæŸ¥çœ‹<a href="#%E6%99%AE%E9%80%9A%20-Service-%20%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B">è¿™ä¸€ç« èŠ‚</a>ï¼‰ï¼Œå¦‚æœæ­¤æ—¶æœ‰ Intent ä¼ å…¥ï¼Œåˆ™å¯ä»¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ Service å·²ç»å¯åŠ¨äº†ã€‚å¦‚æœæ˜¯è¦è¦†å†™è¯¥æ–¹æ³•çš„è¯ï¼Œé‚£ä½ å¾—ä½¿ç”¨<code>stopSelf()</code>æˆ– <code>stopService()</code>æ¥åœæ­¢ Service ã€‚å¦‚æœåªæƒ³æä¾›ä¸€ä¸ªç»‘å®š Service ï¼Œåˆ™æ— éœ€è¦†å†™æ­¤æ–¹æ³•ã€‚</p><blockquote><p>ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œåœ¨è¦†å†™æ—¶ï¼Œè¿˜æœ‰ä¸ª<code>onStart()</code>æ–¹æ³•ï¼Œå¦‚æœæŸ¥çœ‹æºç çš„è¯ï¼Œåœ¨<code>onStartCommand()</code>ä¸­ç›´æ¥è°ƒç”¨äº†<code>onStart()</code>ã€‚è¯¥æ–¹æ³•åœ¨ Android 4.0.3ä¹‹åå°±è¢«åºŸå¼ƒäº†ï¼Œç°åœ¨éƒ½é‡‡ç”¨ç›´æ¥è¦†å†™<code>onStartCommand()</code>æ–¹æ³•äº†ã€‚</p></blockquote></li></ul><p>  å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Intentï¼Œæ˜¯å¯åŠ¨ Service æ—¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ Intentï¼Œå¯ä»¥ç”¨äºåˆå§‹åŒ–ã€‚<strong>è¿™ä¸ª Intent æœ‰å¯èƒ½ä¸º null</strong>ï¼Œå“ªæ€•ä½ æ˜æ˜ä¼ é€’äº†é null çš„ Intentã€‚å…·ä½“åŸå› åœ¨ä¸‹é¢ä¼šè®²åˆ°ã€‚</p><p>  å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª int å€¼ï¼Œæ˜¯å¯åŠ¨ Service æ—¶ç³»ç»Ÿç»™çš„é¢å¤–å‚æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯0ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯<code>START_FLAT_REDELIVERY</code>ï¼ˆIntent ä¹‹å‰ä¼ é€’è¿‡ï¼‰å’Œ<code>START_FLAG_RETRY</code>ï¼ˆä¹‹å‰çš„ Intent æ²¡æœ‰æ­£ç¡®ä¼ é€’è¿‡æ¥ï¼Œé‡è¯•ä¼ é€’ï¼‰çš„<strong>æˆ–å€¼</strong>ã€‚</p><p>  å®ƒçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª int å€¼ï¼Œå«<code>startId</code>ï¼Œå®ƒç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€æ¬¡å¯åŠ¨è¯·æ±‚ï¼Œä¼šåœ¨<code>stopSelfResult(int)</code>è¿™ä¸ªæ–¹æ³•ä¸­ç”¨åˆ°è¿™ä¸ªå€¼ï¼Œç”¨ä»¥ç»ˆæ­¢å½“å‰ Serviceã€‚å®ƒå’Œ<code>stopService()</code>æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ<code>stopService()</code>æ–¹æ³•ä¸€æ—¦è¢«è°ƒç”¨ï¼Œå°±ç›´æ¥ä¸€åˆ€ç æ­» Serviceï¼Œæ¯«ä¸ç•™æƒ…ï¼›ä½†<code>stopSelfResult()</code>ä¼šæ£€æŸ¥<code>startId</code>ï¼Œå¦‚æœåœ¨è°ƒç”¨<code>stopSelfResult()</code>çš„æ—¶å€™åˆæ¥äº†ä¸ªå¯åŠ¨çš„è¯·æ±‚ï¼Œæ­¤æ—¶<code>startId</code>å‘ç”Ÿäº†å˜åŒ–ï¼Œå®ƒå°±ä¼šå¤§å–Šä¸€å£°ã€åˆ€ä¸‹ç•™äºº~~~~ã€ï¼ŒService å°±ä¸ä¼šæ­»æ‰äº†ã€‚</p><p>  å®ƒçš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª int å€¼ï¼Œæœ‰ä¸‹é¢å‡ ç§é€‰æ‹©ï¼š</p><ul><li><code>START_STICKY</code>ï¼šè¢«ç³»ç»Ÿæ¸…ç†åï¼Œä¼šä¿ç•™ Service çš„å¯åŠ¨çŠ¶æ€ï¼Œä½†ä¸ä¿ç•™ Intentï¼Œç³»ç»Ÿé‡å¯ Service åä¼šé‡æ–°è°ƒç”¨<code>onStartCommand()</code>æ–¹æ³•ï¼Œä½†å¦‚æœè¿™æœŸé—´æ²¡æœ‰æ”¶åˆ°ä»»ä½• Intentï¼Œé‚£ä¼ å…¥çš„ Intent å°±æ˜¯ nullï¼Œéœ€è¦å°å¿ƒå¤„ç†ã€‚</li><li><code>START_STICKY_COMPATIBILITY</code>ï¼š<code>START_STICKY</code> çš„å…¼å®¹ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯<code>onStartCommand()</code>ä¼šè¢«è°ƒç”¨ã€‚</li><li><code>START_NOT_STICKY</code>ï¼šè¢«ç³»ç»Ÿæ¸…ç†åï¼Œä¸ä¿ç•™ Service çŠ¶æ€ã€‚</li><li><code>START_REDELIVER_INTENT</code>ï¼šè¢«ç³»ç»Ÿæ¸…ç†åï¼Œä¼šä¿ç•™ Service çŠ¶æ€ï¼ŒåŒæ—¶ä¼šä¿ç•™ Intentï¼Œç³»ç»Ÿé‡å¯ Service åä¼šé‡æ–°è°ƒç”¨<code>onStartCommand()</code>æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šä¼ å…¥ä¹‹å‰ä¿ç•™çš„ Intentã€‚</li></ul><p>  é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>onStartCommand()</code>ä¼šè¿”å›<code>START_STICKY_COMPATIBILITY</code>æˆ–è€…<code>START_STICKY</code>ã€‚</p><ul><li><p><code>onBind(Intent intent)</code>ï¼š</p><p>å½“ä»¥ç»‘å®šæ–¹å¼å¯åŠ¨ Service æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆå…·ä½“å¦‚ä½•è°ƒç”¨çš„ï¼ŒæŸ¥çœ‹<a href="##service-%E7%9A%84%E5%88%86%E7%B1%BB">è¿™ä¸€ç« èŠ‚</a>ï¼‰ï¼Œå¦‚æœæ­¤æ—¶æœ‰ Intent ä¼ å…¥ï¼Œåˆ™å¯ä»¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚å¦‚æœè¦å®ç°ä¸ Client ç«¯é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å¿…é¡»è¦è¿”å›ä¸€ä¸ª IBinder çš„æ¥å£ï¼›å¦‚æœè¯¥ Service ä¸å¸Œæœ›ä¸ Client ç«¯é€šä¿¡ï¼Œå¯ä»¥ç›´æ¥è¿”å› nullã€‚</p></li><li><p><code>onCreate()</code>ï¼š</p><p>è¿™ä¸€çœ‹å°±æ˜¯ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨<code>onStartCommand()</code>å’Œ<code>onBind()</code>ä¹‹å‰è¢«è°ƒç”¨ã€‚å¦‚æœ Service å·²ç»åœ¨è¿è¡Œäº†ï¼Œè€Œå†æ¬¡å°è¯•å¯åŠ¨ Service çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•<strong>ä¸ä¼šå†è¢«è°ƒç”¨</strong>ã€‚</p></li><li><p><code>onDestroy()</code>ï¼š</p><p>ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ï¼Œåœ¨ Service è¢«é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥åœ¨è¿™é‡Œé¢åšä¸€äº›å›æ”¶çº¿ç¨‹ã€æ³¨é”€ BroadcastReceiver ä¹‹ç±»çš„å·¥ä½œã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒService åœ¨<strong>ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šè¢«é”€æ¯</strong>ï¼Œå¦‚æœè¿™ä¸ª Service æ˜¯å‰å° Service ï¼Œé‚£å®ƒ<strong>å‡ ä¹æ°¸è¿œä¸ä¼šç»ˆæ­¢</strong>ï¼ˆè¿è¡Œåœ¨æŸäº›å›½äº§OSä¸Šé™¤å¤–ï¼Œè¯´ç å°±ç æ²¡å¾—å•†é‡ğŸ”ªï¼‰ï¼›å¦‚æœ Service è¢«ç»‘å®šåˆ°å‰å° Activity ä¸Šï¼Œå®ƒä¹Ÿ<strong>ä¸å¤ªå¯èƒ½ä¼šç»ˆæ­¢</strong>ï¼›å¦‚æœç³»ç»Ÿåœ¨<strong>ä½å†…å­˜ä¸”å¿…é¡»å›æ”¶èµ„æºä»¥ä¿è¯å‰å° Activity ä¸ç”¨æˆ·çš„äº¤äº’</strong>çš„æƒ…å†µä¸‹ç»ˆæ­¢äº† Service ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µç¼“è§£æ—¶ä¼š<strong>ç«‹å³é‡å¯ Service</strong> â€”â€”å½“ç„¶ï¼Œè¦çœ‹<code>onStartCommand()</code>ä¸­ä½ è¿”å›äº†ä¸ªå•¥ã€‚</p></li></ul><h3 id="å£°æ˜-Service"><a href="#å£°æ˜-Service" class="headerlink" title="å£°æ˜ Service"></a>å£°æ˜ Service</h3><p>å¦‚æœæƒ³è¦è¯¥ Service å¯ç”¨ï¼Œå¿…é¡»åœ¨ AndroidManifest ä¸­æ³¨å†Œè¿™ä¸ª Service ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="xml">&lt;manifest ...&gt;  &lt;application ...&gt;    &lt;service android:name=&quot;.CustomService&quot; /&gt;  &lt;/application&gt;&lt;/manifest&gt;</code></pre><p>åœ¨<code>&lt;service&gt;</code>æ ‡ç­¾ä¸­ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å±æ€§å¯ä»¥è®¾ç½®ï¼Œæˆ‘ä»¬æ¥ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ã€‚</p><ul><li><code>android:name</code>ï¼šè¿™æ˜¯å”¯ä¸€å¿…éœ€çš„å±æ€§ï¼Œç”¨äº<strong>æŒ‡å®š Service çš„ç±»å</strong>ã€‚åœ¨ç»´æŠ¤ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå°½é‡ä¿æŒè¿™ä¸ªç±»åä¸å˜ï¼Œä»¥é¿å…ä¸€äº›ç”¨<strong>æ˜¾å¼ Intent å¯åŠ¨ Service</strong> çš„ä»£ç ç¢°é’‰å­ã€‚</li></ul><blockquote><p><strong>æ˜¾å¼ Intent</strong></p><p>éšå¼ Intent æŒ‡çš„æ˜¯<strong>ä¸æŒ‡å®šç‰¹å®šå¤„ç†è€…</strong>çš„ Intentï¼Œè°éƒ½å¯ä»¥æ¥æ”¶å’Œå¤„ç†ï¼›è€Œ<strong>æ˜¾å¼ Intent æŒ‡å®šäº†æ¥æ”¶è€…</strong>ï¼Œé™¤äº†æŒ‡å®šçš„æ¥æ”¶è€…å¤–ï¼Œä»»ä½•åº”ç”¨éƒ½æ— æ³•æ¥æ”¶å’Œä½¿ç”¨è¿™ä¸ª Intentï¼Œä½¿å¾—åº”ç”¨æ›´åŠ å®‰å…¨ã€‚<br>ä» Android 5.0 å¼€å§‹ï¼Œå¦‚æœä½¿ç”¨éšå¼ Intent è°ƒç”¨<code>bindService()</code>ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š<br>java.lang.IllegalArgumentException: Service Intent must be explicit</p></blockquote><ul><li><p><code>android:enabled</code>ï¼šè¡¨ç¤ºç³»ç»Ÿæ˜¯å¦å¯ä»¥å®ä¾‹åŒ–è¯¥ Service ã€‚é»˜è®¤ä¸º<code>true</code>ï¼Œè¡¨ç¤ºå¯ä»¥ã€‚å¦‚æœè®¾ç½®äº†<code>false</code>ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨<code>PackageManager.setComponentEnabledSetting()</code>æ–¹æ³•åŠ¨æ€å¼€å¯ã€‚</p></li><li><p><code>android:exported</code>ï¼šè¡¨ç¤º<strong>å…¶ä»–çš„åº”ç”¨èƒ½å¦è°ƒç”¨è¯¥ Service æˆ–è€…ä¸ä¹‹äº¤äº’</strong>ã€‚è¯¥å±æ€§çš„é»˜è®¤å€¼å–å†³äºè¯¥ Service æ˜¯å¦åŒ…å« Intent Filterã€‚å¦‚æœæ²¡æœ‰ä»»ä½• Filter åˆ™è¡¨ç¤º Service åªèƒ½é€šè¿‡æŒ‡å®šç¡®åˆ‡çš„ç±»åæ¥è°ƒç”¨ï¼Œä¹Ÿæ„å‘³ç€è¯¥ Service æ˜¯ã€åº”ç”¨å†…éƒ¨ä¸“äº«ã€ï¼Œå› ä¸ºå…¶ä»–çš„åº”ç”¨ä¸çŸ¥é“å®ƒçš„ç±»åï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼æ˜¯<code>false</code>ï¼›åä¹‹å¦‚æœæœ‰ä»»æ„ä¸€ä¸ª Filter åˆ™è¡¨æ˜ Service å¯ä»¥ä¾›å¤–éƒ¨ä½¿ç”¨ï¼Œè¿™æ—¶é»˜è®¤å€¼æ˜¯<code>true</code>ã€‚</p><p>å¦å¤–ï¼Œè¦é™åˆ¶è¿™ä¸ª Service çš„æš´éœ²ï¼Œå°†è¯¥å­—æ®µè®¾ç½®ä¸º false å¹¶ä¸æ˜¯å”¯ä¸€çš„æ–¹å¼ã€‚è¿˜å¯ä»¥ä½¿ç”¨æƒé™æ§åˆ¶<code>android:permission</code>æ¥é™åˆ¶å“ªäº›å¤–éƒ¨åº”ç”¨å¯ä»¥ä¸ Service äº¤äº’ã€‚ä¸‹é¢ä¼šè®²åˆ°ã€‚</p></li><li><p><code>android:permission</code>ï¼šç»„ä»¶å¯åŠ¨ Service æˆ–ç»‘å®šåˆ° Service æ‰€å¿…éœ€çš„æƒé™çš„åç§°ã€‚å¦‚æœ<code>startService()</code>ã€<code>bindService()</code>æˆ–<code>stopService()</code>çš„è°ƒç”¨è€…<strong>å°šæœªè·å¾—æ­¤æƒé™</strong>ï¼Œé‚£è¯¥æ–¹æ³•å°†<strong>ä¸èµ·ä½œç”¨</strong>ï¼Œä¸”ç³»ç»Ÿä¸ä¼šå°† Intent å¯¹è±¡ä¼ é€ç»™ Service ï¼Œä¹Ÿå³æ— æ³•å®Œæˆäº¤äº’ã€‚<strong>å¦‚æœæœªè®¾ç½®è¯¥å±æ€§ï¼Œåˆ™ç³»ç»Ÿå°†ä¼šå°†å…¶è®¾ç½®ä¸º<code>&lt;application&gt;</code>æ ‡ç­¾ä¸­<code>permission</code>å±æ€§æ‰€è®¾ç½®çš„æƒé™</strong>ï¼ˆæ³¨æ„ï¼šä¸æ˜¯<code>&lt;uses-permisson&gt;</code>æ ‡ç­¾ï¼‰ã€‚å¦‚æœä¸¤ä¸ªå±æ€§éƒ½æ²¡è®¾ç½®ï¼Œåˆ™ Service ä¸å—æƒé™ä¿æŠ¤ã€‚</p></li><li><p><code>android:process</code>ï¼šå°†è¿è¡Œ Service çš„è¿›ç¨‹åç§°ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œåº”ç”¨çš„æ‰€æœ‰ç»„ä»¶éƒ½ä¼šåœ¨ä¸º<strong>åº”ç”¨åˆ›å»ºçš„é»˜è®¤è¿›ç¨‹</strong>ä¸­è¿è¡Œã€‚è¯¥åç§°ä¸<strong>åº”ç”¨åŒ…åç›¸åŒ</strong>ã€‚<code>&lt;application&gt;</code> å…ƒç´ çš„<code>process</code>å±æ€§å¯ä¸ºæ‰€æœ‰ç»„ä»¶è®¾ç½®é»˜è®¤è¿›ç¨‹åç§°ã€‚ä¸è¿‡ï¼Œç»„ä»¶å¯ä»¥ä½¿ç”¨è‡ªå·±çš„<code>process</code>å±æ€§æ›¿æ¢é»˜è®¤å€¼ï¼Œä»è€Œå°†åº”ç”¨æ•£å¸ƒåˆ°å¤šä¸ªè¿›ç¨‹ä¸­ã€‚</p><p>å¦‚æœä¸ºæ­¤å±æ€§åˆ†é…çš„åç§°<strong>ä»¥å†’å·<code>:</code>å¼€å¤´</strong>ï¼Œåˆ™ç³»ç»Ÿä¼š<strong>åœ¨éœ€è¦æ—¶åˆ›å»ºåº”ç”¨ä¸“ç”¨çš„æ–°è¿›ç¨‹</strong>ï¼Œå¹¶ä¸” Service ä¼š<strong>åœ¨è¯¥è¿›ç¨‹ä¸­è¿è¡Œ</strong>ã€‚å¦‚æœè¿›ç¨‹åç§°<strong>ä»¥å°å†™å­—ç¬¦å¼€å¤´</strong>ï¼Œåˆ™ Service å°†åœ¨<strong>ä½¿ç”¨è¯¥åç§°çš„å…¨å±€è¿›ç¨‹ä¸­è¿è¡Œï¼Œå‰ææ˜¯å®ƒæ‹¥æœ‰ç›¸åº”çš„æƒé™</strong>ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¸åŒåº”ç”¨ä¸­çš„ç»„ä»¶ä¾¿å¯å…±äº«è¿›ç¨‹ï¼Œä»è€Œå‡å°‘èµ„æºä½¿ç”¨ã€‚</p></li></ul><h3 id="å¯åŠ¨-Service"><a href="#å¯åŠ¨-Service" class="headerlink" title="å¯åŠ¨ Service"></a>å¯åŠ¨ Service</h3><p>å¯åŠ¨ Service æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸Šé¢è®²è¿‡äº†ï¼Œ<code>startService()</code>å’Œ<code>bindService()</code>æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜æ˜¯åˆ†å¼€æ¥è®²ã€‚</p><h4 id="é€šè¿‡startService-å¯åŠ¨çš„-Service"><a href="#é€šè¿‡startService-å¯åŠ¨çš„-Service" class="headerlink" title="é€šè¿‡startService()å¯åŠ¨çš„ Service"></a>é€šè¿‡<code>startService()</code>å¯åŠ¨çš„ Service</h4><pre><code class="java">Intent intent = new Intent(this, CustomService.class);startService(intent);</code></pre><p>è¿™ç§æ–¹å¼å¯åŠ¨ Service ï¼Œç³»ç»Ÿå°†ä¼šè°ƒç”¨<code>onStartCommand()</code>æ–¹æ³•ã€‚è¿™ç§ Service åœ¨å¯åŠ¨ä¹‹åï¼Œ<strong>å…¶ç”Ÿå‘½å‘¨æœŸå°†ç‹¬ç«‹äºå®ƒçš„å¯åŠ¨è€…</strong>ã€‚ä¾‹å¦‚ä¸€ä¸ª Activity é€šè¿‡è¿™ç§æ–¹å¼å¯åŠ¨äº† Service ï¼Œå“ªæ€• Activity ä¸å¯è§äº†ã€ç”šè‡³è¢«é”€æ¯äº†ï¼Œ Service ä¹Ÿä¼šç»§ç»­è¿è¡Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ Service å®Œæˆå·¥ä½œåï¼Œè°ƒç”¨å®ƒçš„<code>stopSelf()</code>æ¥åœæ­¢è¿è¡Œï¼Œæˆ–è€…ç”±å…¶ä»–çš„ç»„ä»¶è°ƒç”¨<code>stopService()</code>æ¥åœæ­¢è¯¥ Service ã€‚</p><p>åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ª Intent å¯¹è±¡ç»™ Service ï¼Œ Service ä¼šåœ¨<code>onStartCommand()</code>ä¸­æ¥æ”¶åˆ°è¿™ä¸ª Intentã€‚å¤šæ¬¡é€šè¿‡è¿™ç§æ–¹å¼å¯åŠ¨ï¼Œä¼šå¤šæ¬¡è°ƒç”¨åˆ°<code>onStartCommand()</code>æ–¹æ³•ã€‚<strong>è¿™é€šå¸¸è¢«ç”¨æ¥å‘ Service ä¼ é€’æ•°æ®</strong>ã€‚</p><p>æ­¤å¤„å¿…é¡»å†å¼ºè°ƒä¸€æ¬¡ï¼Œ Service å¯åŠ¨åï¼Œ<strong>æ˜¯å·¥ä½œåœ¨ä¸»çº¿ç¨‹ä¸Šçš„</strong>ã€‚å¦‚æœäº¤ç»™ Service å»åšä¸€äº›å¯†é›†æ€§çš„ã€è€—æ—¶çš„ã€é˜»å¡çš„ä»»åŠ¡ï¼Œå¯èƒ½ä¼šå½±å“ Activity çš„æ€§èƒ½ã€‚å¦‚æœè¦ä½¿ç”¨ Service åšè¿™äº›äº‹ï¼Œä½ å¯ä»¥åœ¨ Service ä¸­æ–°å»ºçº¿ç¨‹æ¥åšè¿™äº›äº‹ã€‚</p><h4 id="é€šè¿‡bindService-å¯åŠ¨çš„-Service"><a href="#é€šè¿‡bindService-å¯åŠ¨çš„-Service" class="headerlink" title="é€šè¿‡bindService()å¯åŠ¨çš„ Service"></a>é€šè¿‡<code>bindService()</code>å¯åŠ¨çš„ Service</h4><pre><code class="java">ServiceConnection conn = new ServiceConnection() &#123;    @Override    public void onServiceConnected(ComponentName className,                  IBinder service) &#123;        LocalBinder binder = (LocalBinder) service;        mService = binder.getService();        mBound = true;    &#125;    @Override    public void onServiceDisconnected(ComponentName arg0) &#123;        mBound = false;    &#125;&#125;Intent intent = new Intent(this, CustomService.class);bindService(intent, conn, Context.BIND_AUTO_CREATE);</code></pre><p>ç»„ä»¶å¯ä»¥é€šè¿‡ä¸Šè¿°æ–¹å¼ä¸ Service è¿›è¡Œé•¿æœŸç»‘å®šã€‚è¿™ç§ Service åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å…è®¸ç»„ä»¶é€šè¿‡è°ƒç”¨<code>startService()</code>æ–¹æ³•æ¥å¯åŠ¨å®ƒã€‚å®ƒé€šå¸¸åªåœ¨<strong>ä¸ºå…¶ä»–åº”ç”¨ç»„ä»¶æä¾›æœåŠ¡æ—¶</strong>å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸ä¼šæ— é™æœŸåœ°åœ¨åå°è¿è¡Œã€‚</p><p>è¿™ç§å¯åŠ¨æ–¹å¼å¤šç”¨åœ¨ä¸ Activity æˆ–è€…å…¶ä»–ç»„ä»¶çš„äº¤äº’ï¼Œä»¥åŠé€šè¿‡è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ä¸å…¶ä»–åº”ç”¨äº§ç”Ÿäº¤äº’ã€‚</p><p>ä¸€æ—¦ç»‘å®šï¼ŒService å°±ä¼šå¯åŠ¨ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½•ç»„ä»¶ä¸ Service æ˜¯ç»‘å®šçŠ¶æ€ï¼Œé‚£ Service <strong>å°±ä¼šè¢«ç³»ç»Ÿé”€æ¯</strong>ï¼Œæ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ Service ï¼Œæˆ‘ä»¬**ä¸å¿…è°ƒç”¨<code>stopSelf()</code>æˆ–è€…<code>stopService()</code>**ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼ŒåŒä¸€ä¸ª Service å¯ä»¥<strong>åŒæ—¶è¢«å¤šä¸ªç»„ä»¶ç»‘å®š</strong>ã€‚</p><p>åœ¨ä»¥è¿™ç§æ–¹å¼ç»‘å®š Service æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨<code>onBind()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦<strong>è‡ªå·±å®ç°<code>onBind()</code>å›è°ƒæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª IBinder å¯¹è±¡ï¼Œä¾› Client æ¥ä¸ Service è¿›è¡Œäº¤äº’</strong>ã€‚å¤šæ¬¡ç»‘å®šåŒä¸€ä¸ª Service ï¼Œå¹¶ä¸ä¼šé‡å¤è°ƒç”¨<code>onBind()</code>æ–¹æ³•ï¼Œç³»ç»Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ç»‘å®šæ—¶ç”Ÿæˆ IBinder å¯¹è±¡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç¼“å­˜ï¼Œåœ¨ä¹‹åçš„ç»‘å®šä¸­ï¼Œç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ç»™ Clientã€‚</p><p>ServiceConnection ä¼šç›‘æ§ä¸ Service çš„è¿æ¥çŠ¶æ€ï¼Œå¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œå®ƒæœ‰ä¸¤ä¸ªéœ€è¦è¦†å†™çš„æ–¹æ³•ï¼š<code>onServiceConnected()</code>å’Œ<code>onServiceDisconnected()</code>ã€‚å‰è€…ä¼šä¼ é€’ä¸€ä¸ª IBinder å¯¹è±¡è¿›æ¥ï¼ŒClient è¿™æ—¶éœ€è¦<strong>å¼ºè½¬æˆè‡ªå·±éœ€è¦çš„ Binder å¯¹è±¡</strong>ï¼Œå¹¶å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œå®Œæˆä¸ Service çš„é€šä¿¡ã€‚åè€…åˆ™æ˜¯<strong>ä¸ Service ä¸»åŠ¨è§£ç»‘æˆ–ä¸¢å¤±é“¾æ¥</strong>æ—¶çš„å›è°ƒã€‚</p><h4 id="å¯åŠ¨å‰å°-Service"><a href="#å¯åŠ¨å‰å°-Service" class="headerlink" title="å¯åŠ¨å‰å° Service"></a>å¯åŠ¨å‰å° Service</h4><p>ä¸Šé¢çš„ä¸¤ç§ Service éƒ½æ˜¯ã€åå° Service ã€ï¼Œæ¢è¨€ä¹‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«ç”¨æˆ·å¯è§ã€‚å¦‚æœè¦å¯åŠ¨ç”¨æˆ·å¯è§çš„ã€å‰å° Service ã€ï¼Œéœ€è¦è°ƒç”¨<code>startForegroundService()</code>æ–¹æ³•ã€‚</p><pre><code class="java">Intent intent = new Intent(this, CustomService.class);startForegroundService(intent);</code></pre><p>ä½¿ç”¨è¿™ç§æ–¹æ³•å¯åŠ¨ Service ï¼Œå°±æ„å‘³ç€ Service åœ¨å¯åŠ¨ä¹‹åï¼Œå°±ä¼š<strong>ç«‹åˆ»è°ƒç”¨å®ƒçš„<code>startForeground(int, Notification)</code>æ–¹æ³•</strong>ï¼Œç”¨äºåœ¨é€šçŸ¥æ ä¸­åˆ›å»ºé€šçŸ¥ã€‚</p><pre><code class="java">final int ONGOING_NOTIFICATION_ID = 1;  // è¯¥å€¼ä¸å¯ä¸º0Intent notificationIntent = new Intent(this, MainActivity.class);PendingIntent pendingIntent =        PendingIntent.getActivity(this, 0, notificationIntent, 0);Notification notification =          new Notification.Builder(this, CHANNEL_DEFAULT_IMPORTANCE)    .setContentTitle(getText(R.string.notification_title))    .setContentText(getText(R.string.notification_message))    .setSmallIcon(R.drawable.icon)    .setContentIntent(pendingIntent)    .setTicker(getText(R.string.ticker_text))    .build();startForeground(ONGOING_NOTIFICATION_ID, notification);</code></pre><p>ä½¿ç”¨å‰å° Service å¯ä»¥å˜ç›¸å®ç°ã€ä¿æ´»ã€ï¼Œå› ä¸ºç³»ç»Ÿå‡ ä¹ä¸ä¼šè€ƒè™‘å°†å®ƒåœæ­¢ï¼Œå“ªæ€•å†…å­˜ç©ºé—´ä¸è¶³ã€‚ä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨æˆ‘ä»¬å¯ä»¥æ»¥ç”¨å‰å° Service ï¼Œå› ä¸ºæ¯ä¸€ä¸ª Service éƒ½ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚</p><p>å¦‚æœè¦ç§»é™¤å‰å° Serviceï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>stopForeground(bool)</code>ï¼Œå‚æ•°è¡¨ç¤ºæ˜¯å¦è¦åŒæ—¶ç§»é™¤é€šçŸ¥æ çš„é€šçŸ¥ã€‚<strong>è¿™ä¸ªæ–¹æ³•ä¸ä¼šç»ˆæ­¢ Service</strong>ã€‚å¦‚æœä½¿ç”¨äº†<code>stopServie()</code>æ¥ç»ˆæ­¢ Serviceï¼Œé‚£ä¹ˆé€šçŸ¥æ ä¸­çš„é€šçŸ¥ä¹Ÿä¼šéšä¹‹è¢«ç§»é™¤ã€‚</p><h3 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h3><p>IntentService æ˜¯ Service çš„å­ç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ª HandlerThreadï¼Œè¿™æ„å‘³ç€å®ƒ<strong>å¹¶ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šå·¥ä½œ</strong>çš„ï¼Œå¯ä»¥å°†ä¸€äº›å…·æœ‰é¡ºåºæ€§çš„ã€ä¸éœ€è¦åŒæ—¶å¤„ç†çš„ä»»åŠ¡äº¤ç»™ IntentService æ¥å¤„ç†ã€‚</p><p>è¦ä½¿ç”¨è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°å®ƒçš„<code>onHandleIntent()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ¥æ”¶æ¯ä¸ªå¯åŠ¨è¯·æ±‚ä¸­çš„ Intentï¼Œå¹¶äº¤ç»™ HandlerThread å»å¤„ç†ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ IntentService æ—¶ï¼Œå¦‚æœä½ éœ€è¦é‡å†™<code>onStartCommand()</code>æ–¹æ³•ï¼Œåœ¨å¤„ç†å®Œè‡ªå·±çš„å·¥ä½œåï¼Œ<strong>å¿…é¡»è¦è°ƒç”¨<code>return super.onStartCommand()</code>æ–¹æ³•æ¥è¿”å›</strong>ï¼Œä»¥ä¿è¯åœ¨<code>onHandleIntent()</code>ä¸­èƒ½æ­£ç¡®æ¥æ”¶åˆ° Intentã€‚</p><p>IntentService åœ¨å¤„ç†å®Œæ‰€æœ‰è¯·æ±‚åä¼šåœæ­¢ Service ï¼Œæ‰€ä»¥ï¼Œ<strong>ä¸å¿…è°ƒç”¨<code>stopSelf()</code>æ–¹æ³•</strong>ã€‚</p><blockquote><p>IntentService åœ¨ API 30 ä¸­è¢«åºŸå¼ƒäº†ã€‚</p></blockquote><h2 id="Service-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Service-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Service çš„ç”Ÿå‘½å‘¨æœŸ"></a>Service çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ç›—ä¸ªå®˜ç½‘çš„å›¾ï¼Œç¾æ»‹å„¿æ»‹å„¿ï¼š</p><div class="center-img"><p><img src="/img/service-1588840496.png"></p><p><em>å·¦è¾¹æ˜¯ä½¿ç”¨startService()è°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³è¾¹æ˜¯bindService()</em></p></div><p>å¯è§ï¼ŒService çš„ç”Ÿå‘½å‘¨æœŸå¾ˆç®€å•ï¼Œä¸ Activity ç›¸æ¯”ç®€ç›´æ˜¯å°å·«è§æ ¼æ ¼å·«ã€‚ä¸‹é¢çš„ä»£ç ï¼Œå°±å¯ä»¥ç›‘æ§ Service çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸï¼š</p><pre><code class="java">public class CustomService extends Service &#123;    int startMode;       // indicates how to behave if the service is killed    IBinder binder;      // interface for clients that bind    boolean allowRebind; // indicates whether onRebind should be used    @Override    public void onCreate() &#123;        // Service åˆ›å»ºæ—¶å›è°ƒ    &#125;    @Override    public int onStartCommand(Intent intent, int flags, int startId) &#123;        // æœåŠ¡å·²å¯åŠ¨ï¼Œæ¯ä¸€æ¬¡ä½¿ç”¨ startService() å¯åŠ¨æœåŠ¡æ—¶å›è°ƒ        return mStartMode;    &#125;    @Override    public IBinder onBind(Intent intent) &#123;        // ä¸€ä¸ª Client æ­£åœ¨å°è¯•è°ƒç”¨ bindService() ç»‘å®šè¯¥æœåŠ¡        return mBinder;    &#125;    @Override    public boolean onUnbind(Intent intent) &#123;        // ä¸€ä¸ª Client æ­£åœ¨å°è¯•è°ƒç”¨ unbindService() ä¸è¯¥æœåŠ¡è§£ç»‘        return mAllowRebind;    &#125;    @Override    public void onRebind(Intent intent) &#123;        // ä¸€ä¸ª Client åœ¨è§£ç»‘ååˆå°è¯•é‡æ–°ç»‘å®š    &#125;    @Override    public void onDestroy() &#123;        // Service é”€æ¯ä¹‹å‰å›è°ƒ    &#125;&#125;</code></pre><p>çœ‹å‡ºæ¥äº†å—ï¼Ÿä¸ Activity ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ï¼Œæ¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œ<strong>éƒ½ä¸éœ€è¦è°ƒç”¨è¶…ç±»çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>ã€‚</p><h2 id="Serviceè¯¦è§£"><a href="#Serviceè¯¦è§£" class="headerlink" title="Serviceè¯¦è§£"></a>Serviceè¯¦è§£</h2><p>å¥½ï¼Œæ¥åˆ°è¿™ç¯‡æ–‡ç« æœ€æ ¸å¿ƒæœ€å¤æ‚çš„éƒ¨åˆ†äº†ã€‚æˆ‘ä»¬å…ˆæå‡ºå‡ ä¸ªé—®é¢˜ï¼Œç„¶åå¸¦ç€é—®é¢˜å»ç†è§£è¿™éƒ¨åˆ†ã€‚</p><blockquote><p>Service æ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Ÿ</p><p>ä¼ é€’ç»™ Service çš„ Intent æ˜¯å¦‚ä½•äº¤åˆ° Service æ‰‹ä¸­çš„ï¼Ÿ</p><p>IntentService æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p></blockquote><p>æˆ‘ä»¬æ¥é€ä¸ªè§£é‡Šã€‚</p><h3 id="æ™®é€š-Service-çš„å¯åŠ¨è¿‡ç¨‹"><a href="#æ™®é€š-Service-çš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="æ™®é€š Service çš„å¯åŠ¨è¿‡ç¨‹"></a>æ™®é€š Service çš„å¯åŠ¨è¿‡ç¨‹</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯åŠ¨ Service æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯<code>Context.startService()</code>ï¼Œæˆ‘ä»¬å°±ä»è¿™å„¿å…¥æ‰‹ï¼Œçœ‹çœ‹ Service çš„å¯åŠ¨è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼š</p><pre><code class="java">// android.content.Context.javapublic abstract ComponentName startService(Intent service);</code></pre><p>Service ç»§æ‰¿è‡ª ContextWrapperï¼Œæ‰€ä»¥</p><p>Context æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„ä¸»è¦å®ç°åœ¨ ContextImpl ç±»é‡Œï¼š</p><pre><code class="java">// android.app.ContextImpl.java@Overridepublic ComponentName startService(Intent service) &#123;    warnIfCallingFromSystemProcess(); // æ£€æŸ¥å½“å‰è¿›ç¨‹çš„ uid æ˜¯å¦ä¸ Process.SYSTEM_UID ç›¸ç­‰    return startServiceCommon(service, false, mUser);&#125;private ComponentName startServiceCommon(Intent service, boolean requireForeground,            UserHandle user) &#123;        try &#123;            validateServiceIntent(service);            service.prepareToLeaveProcess(this);            ComponentName cn = ActivityManager.getService().startService(                mMainThread.getApplicationThread(), service, service.resolveTypeIfNeeded(                            getContentResolver()), requireForeground,                            getOpPackageName(), user.getIdentifier());            ...            return cn;        &#125; catch (RemoteException e) &#123;            throw e.rethrowFromSystemServer();        &#125;    &#125;</code></pre><p>ç”±ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒContext å°†å¯åŠ¨ Service çš„ä»»åŠ¡è½¬äº¤ç»™äº† ActivityManagerã€‚åŒæ—¶äº¤ç»™ ActivityManager çš„ï¼Œè¿˜æœ‰å½“å‰ App çš„ä¸»çº¿ç¨‹ã€‚è¿™é‡Œå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆ Service å¯åŠ¨æ—¶ä¼šé»˜è®¤åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</p><p>æœ‰äººè¦æ äº†ï¼šè¿™ä¸æ˜æ˜æ˜¯ Service å˜›ï¼Œä¸ºå•¥äº¤ç»™ ActivityManager æ¥å¯åŠ¨ï¼Ÿå…ˆåˆ«æ ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ·±å…¥ï¼š</p><pre><code class="java">// android.app.ActivityManager.javapublic static IActivityManager getService() &#123;    return IActivityManagerSingleton.get();&#125;</code></pre><p>è¿™é‡Œä½¿ç”¨å•ä¾‹æ¨¡å¼è¿”å›äº† IActivityManager çš„ Binder å¯¹è±¡ï¼Œä¹Ÿå³çœŸæ­£çš„<code>startService()</code>å·¥ä½œæ˜¯åœ¨ ActivityManagerService ä¸­å®Œæˆçš„ã€‚</p><pre><code class="java">// com.android.server.ActivityManagerServicepublic class ActivityManagerService extends IActivityManager.Stub        implements Watchdog.Monitor, BatteryStatsImpl.BatteryCallback &#123;    ...    ActiveServices mServices;    ...    @Override    public ComponentName startService(IApplicationThread caller, Intent service,            String resolvedType, boolean requireForeground, String callingPackage, int userId)            throws TransactionTooLargeException &#123;        ...        // ä½¿ç”¨ synchronized æ¥ä¿è¯åˆ›å»º Service æ—¶çš„çº¿ç¨‹å®‰å…¨        synchronized(this) &#123;            final int callingPid = Binder.getCallingPid();            final int callingUid = Binder.getCallingUid();            final long origId = Binder.clearCallingIdentity();            ComponentName res;            try &#123;                res = mServices.startServiceLocked(caller, service,                        resolvedType, callingPid, callingUid,                        requireForeground, callingPackage, userId);            &#125; finally &#123;                Binder.restoreCallingIdentity(origId);            &#125;            return res;        &#125;    &#125;    ...&#125;</code></pre><p>ç»§ç»­çœ‹<code>ActiveServices.startServiceLocked()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// com.android.server.am.ActiveServices.javaComponentName startServiceLocked(IApplicationThread caller, Intent service, String resolvedType,        int callingPid, int callingUid, boolean fgRequired, String callingPackage, final int userId)        throws TransactionTooLargeException &#123;    return startServiceLocked(caller, service, resolvedType, callingPid, callingUid, fgRequired,            callingPackage, userId, false);&#125;ComponentName startServiceLocked(IApplicationThread caller, Intent service, String resolvedType,        int callingPid, int callingUid, boolean fgRequired, String callingPackage,        final int userId, boolean allowBackgroundActivityStarts)        throws TransactionTooLargeException &#123;    ...    // å„ç§å¯åŠ¨å‰çš„æ£€æŸ¥ã€å¦‚ App æ˜¯å¦å­˜åœ¨ã€AndroidManifest ä¸­æ˜¯å¦æ³¨å†Œã€æƒé™æ˜¯å¦åˆç†    ...    // å°† Intent åŒ…è£…è¿›äº† ServiceRecord çš„æ–°å®ä¾‹ä¸­    r.pendingStarts.add(new ServiceRecord.StartItem(r, false, r.makeNextStartId(),              service, neededGrants, callingUid));    if (fgRequired) &#123;        // å‰å°æœåŠ¡å¯åŠ¨æˆåŠŸ        ServiceState stracker = r.getTracker();        if (stracker != null) &#123;            stracker.setForeground(true, mAm.mProcessStats.getMemFactorLocked(),                    r.lastActivity);        &#125;        mAm.mAppOpsService.startOperation(AppOpsManager.getToken(mAm.mAppOpsService),                AppOpsManager.OP_START_FOREGROUND, r.appInfo.uid, r.packageName, true);    &#125;    ...    ComponentName cmp = startServiceInnerLocked(smap, service, r, callerFg, addToStarting);    return cmp;&#125;ComponentName startServiceInnerLocked(ServiceMap smap, Intent service, ServiceRecord r,        boolean callerFg, boolean addToStarting) throws TransactionTooLargeException &#123;    ...    // è®°å½•ä¸€æ¬¡è¿è¡Œï¼Œæ–¹ä¾¿ç³»ç»Ÿè®¡ç®—ç”µé‡ä¸è¿è¡Œæ—¶é—´çš„å…³ç³»    synchronized (r.stats.getBatteryStats()) &#123;        r.stats.startRunningLocked();    &#125;    String error = bringUpServiceLocked(r, service.getFlags(), callerFg, false, false);    ...    return r.name;&#125;private String bringUpServiceLocked(ServiceRecord r, int intentFlags, boolean execInFg,        boolean whileRestarting, boolean permissionsReviewRequired)        throws TransactionTooLargeException &#123;    ...    // è¿˜æ˜¯å„ç§æ£€æŸ¥    // Service æ­£åœ¨è¢«å¯åŠ¨ï¼Œæ­¤æ—¶å®ƒä¸èƒ½è¢« force stop    try &#123;        AppGlobals.getPackageManager().setPackageStoppedState(                r.packageName, false, r.userId);    &#125; catch (RemoteException e) &#123;    &#125; catch (IllegalArgumentException e) &#123;        Slog.w(TAG, &quot;Failed trying to unstop package &quot;                + r.packageName + &quot;: &quot; + e);    &#125;    ...    ProcessRecord app;    if (!isolated) &#123;        app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false);        if (app != null &amp;&amp; app.thread != null) &#123;            try &#123;                app.addPackage(r.appInfo.packageName, r.appInfo.longVersionCode, mAm.mProcessStats);                // è¿™é‡Œå¼€å§‹å¯åŠ¨æœåŠ¡                realStartServiceLocked(r, app, execInFg);                return null;            &#125; catch (TransactionTooLargeException e) &#123;                throw e;            &#125; catch (RemoteException e) &#123;                Slog.w(TAG, &quot;Exception when starting service &quot; + r.shortInstanceName, e);            &#125;            // If a dead object exception was thrown -- fall through to            // restart the application.        &#125;    &#125; else &#123;        ...    &#125;    ...    return null;&#125;private final void realStartServiceLocked(ServiceRecord r,            ProcessRecord app, boolean execInFg) throws RemoteException &#123;    ...    // å¥½ç†Ÿæ‚‰çš„ä¸€å¥è¯ï¼Œåœ¨ AMS ä¸­ï¼Œä¹Ÿæ˜¯ä½¿ç”¨äº† ActivityThread ä¸­çš„ scheduleXXX æ¥å®ç°çš„åˆ›å»º Activity çš„åŠŸèƒ½    app.thread.scheduleCreateService(r, r.serviceInfo,            mAm.compatibilityInfoForPackage(r.serviceInfo.applicationInfo),            app.getReportedProcState());    ...    // è¿™é‡Œå¼€å§‹å‘ Service å‘é€ Intentï¼Œä¹Ÿå³è°ƒç”¨ onStartCommand() æ–¹æ³•    sendServiceArgsLocked(r, execInFg, true);    ...&#125;private final void sendServiceArgsLocked(ServiceRecord r, boolean execInFg,            boolean oomAdjusted) throws TransactionTooLargeException &#123;    ...    r.app.thread.scheduleServiceArgs(r, slice);    ...&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ AMS åˆ›å»º Activity çš„è¿‡ç¨‹å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ ActivityThread æ¥å®Œæˆæœ€åçš„åˆ›å»ºå·¥ä½œï¼Œä¹‹å‰æ‰€æœ‰çš„æ£€æŸ¥å·¥ä½œï¼Œéƒ½æ˜¯ä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼ŒåŒæ—¶è®°å½•ä¸€äº› Service çš„å¯åŠ¨ä¿¡æ¯ï¼Œä»¥ä¾¿è¿›è¡ŒåæœŸç®¡ç†ã€‚</p><p><code>scheduleCreateService()</code>å’Œ<code>scheduleCreateArgs()</code>åˆ†åˆ«å‘ ActivityThread ä¸­çš„ Handler å‘é€äº†<code>CREATE_SERVICE</code>å’Œ<code>SERVICE_ARGS</code>äº‹ä»¶ï¼Œå¹¶åˆ†åˆ«è°ƒç”¨åˆ°<code>handleCreateService()</code>å’Œ<code>handleServiceArgs((ServiceArgsData)msg.obj)</code>æ–¹æ³•ï¼š</p><pre><code class="java">// android.app.ActivityThread.javaprivate void handleCreateService(CreateServiceData data) &#123;    ...    LoadedApk packageInfo = getPackageInfoNoCheck(            data.info.applicationInfo, data.compatInfo);    Service service = null;    try &#123;        // åˆ©ç”¨åå°„åˆ›å»º Service çš„å®ä¾‹        java.lang.ClassLoader cl = packageInfo.getClassLoader();        service = packageInfo.getAppFactory()                .instantiateService(cl, data.info.name, data.intent);    &#125; catch (Exception e) &#123;        if (!mInstrumentation.onException(service, e)) &#123;            throw new RuntimeException(                &quot;Unable to instantiate service &quot; + data.info.name                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;    try &#123;        if (localLOGV) Slog.v(TAG, &quot;Creating service &quot; + data.info.name);        ContextImpl context = ContextImpl.createAppContext(this, packageInfo);        context.setOuterContext(service);        Application app = packageInfo.makeApplication(false, mInstrumentation);        service.attach(context, this, data.info.name, data.token, app,                ActivityManager.getService());        // è°ƒç”¨äº† Service çš„ onCreate ç”Ÿå‘½å‘¨æœŸæ–¹æ³•        service.onCreate();        mServices.put(data.token, service);        try &#123;            ActivityManager.getService().serviceDoneExecuting(                    data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);        &#125; catch (RemoteException e) &#123;            throw e.rethrowFromSystemServer();        &#125;    &#125; catch (Exception e) &#123;        if (!mInstrumentation.onException(service, e)) &#123;            throw new RuntimeException(                &quot;Unable to create service &quot; + data.info.name                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;&#125;private void handleServiceArgs(ServiceArgsData data) &#123;    Service s = mServices.get(data.token);    if (s != null) &#123;        try &#123;            if (data.args != null) &#123;                data.args.setExtrasClassLoader(s.getClassLoader());                data.args.prepareToEnterProcess();            &#125;            int res;            if (!data.taskRemoved) &#123;                // è°ƒç”¨äº† onStartCommand ç”Ÿå‘½å‘¨æœŸæ–¹æ³•                res = s.onStartCommand(data.args, data.flags, data.startId);            &#125; else &#123;                s.onTaskRemoved(data.args);                res = Service.START_TASK_REMOVED_COMPLETE;            &#125;            QueuedWork.waitToFinish();            try &#123;                ActivityManager.getService().serviceDoneExecuting(                        data.token, SERVICE_DONE_EXECUTING_START, data.startId, res);            &#125; catch (RemoteException e) &#123;                throw e.rethrowFromSystemServer();            &#125;        &#125; catch (Exception e) &#123;            if (!mInstrumentation.onException(s, e)) &#123;                throw new RuntimeException(                        &quot;Unable to start service &quot; + s                        + &quot; with &quot; + data.args + &quot;: &quot; + e.toString(), e);            &#125;        &#125;    &#125;&#125;</code></pre><p>è‡³æ­¤ï¼ŒService å®Œæˆäº†åˆ›å»ºå’Œ Intent çš„ä¼ é€’ã€‚æˆ‘ä»¬ç”¨ä¸€å¼ æ—¶åºå›¾ï¼Œæ¥å±•ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="/img/service-1588840496.png"></p><h3 id="ç»‘å®š-Service-çš„å¯åŠ¨è¿‡ç¨‹"><a href="#ç»‘å®š-Service-çš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="ç»‘å®š Service çš„å¯åŠ¨è¿‡ç¨‹"></a>ç»‘å®š Service çš„å¯åŠ¨è¿‡ç¨‹</h3><p>è¿˜æ˜¯ä»å…¥å£æ–¹æ³•<code>Context.bindService()</code>å¼€å§‹çœ‹ï¼š</p><pre><code class="java">// android.app.ContextImpl.java@Overridepublic boolean bindService(Intent service, ServiceConnection conn, int flags) &#123;    warnIfCallingFromSystemProcess(); // æ£€æŸ¥å½“å‰è¿›ç¨‹çš„ uid æ˜¯ä¸æ˜¯ Process.SYSTEM_UID    return bindServiceCommon(service, conn, flags, null, mMainThread.getHandler(), null, getUser());&#125;private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags,        String instanceName, Handler handler, Executor executor, UserHandle user) &#123;    ...    int res = ActivityManager.getService().bindIsolatedService(        mMainThread.getApplicationThread(), getActivityToken(), service,        service.resolveTypeIfNeeded(getContentResolver()),        sd, flags, instanceName, getOpPackageName(), user.getIdentifier());    ...&#125;</code></pre><p>ä¸ä¸Šé¢ç›¸åŒï¼Œè¿˜æ˜¯æ¥åˆ°äº† ActivityManagerService ä¸­ï¼Œçœç•¥éƒ¨åˆ†ä»£ç ï¼š</p><pre><code class="java">// com.android.server.ActivityManagerServicepublic class ActivityManagerService extends IActivityManager.Stub        implements Watchdog.Monitor, BatteryStatsImpl.BatteryCallback &#123;    ...    ActiveServices mServices;    ...    public int bindIsolatedService(IApplicationThread caller, IBinder token, Intent service,        String resolvedType, IServiceConnection connection, int flags, String instanceName,        String callingPackage, int userId) throws TransactionTooLargeException &#123;        ...        synchronized(this) &#123;            return mServices.bindServiceLocked(caller, token, service,                resolvedType, connection, flags, instanceName, callingPackage, userId);        &#125;    &#125;    ...&#125;</code></pre><p>è¿™é‡Œä¸æ™®é€š Service ä¸åŒçš„æ˜¯ï¼Œå®ƒæ²¡æœ‰è¿”å› ComponentNameï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ª int å€¼ã€‚</p><pre><code class="java">// com.android.server.am.ActiveServices.javaint bindServiceLocked(IApplicationThread caller, IBinder token, Intent service,        String resolvedType, final IServiceConnection connection, int flags,        String instanceName, String callingPackage, final int userId)        throws TransactionTooLargeException &#123;    ...    // å„ç§æ£€æŸ¥    ...    // è¿™é‡Œæœ‰ä¸ªå¾ˆé‡è¦çš„æ“ä½œã€‚    // å¦‚æœåœ¨åº”ç”¨çš„ä»»ä½•ç»„ä»¶è¿è¡Œä¹‹å‰ï¼Œéœ€è¦è®©ç”¨æˆ·æ£€æŸ¥æ˜¯å¦å¯ä»¥ç»™äºˆæƒé™ï¼Œè¿™æ—¶ä¼šå…ˆè®¡åˆ’ä¸€ä¸ªç»‘å®šæœåŠ¡ï¼Œä½†æ˜¯å¹¶ä¸å¯ç”¨å®ƒï¼Œ    // ç„¶åå¯åŠ¨ review Activityï¼Œå¹¶ç»™å®ƒä¸€ä¸ª callbackï¼Œç”¨æˆ·äº¤äº’å®Œæˆåï¼Œå†å®ŒæˆæœåŠ¡çš„ç»‘å®šå·¥ä½œ    if (mAm.getPackageManagerInternalLocked().isPermissionsReviewRequired(            s.packageName, s.userId)) &#123;        permissionsReviewRequired = true;        final ServiceRecord serviceRecord = s;        final Intent serviceIntent = service;        RemoteCallback callback = new RemoteCallback(                new RemoteCallback.OnResultListener() &#123;            @Override            public void onResult(Bundle result) &#123;                synchronized(mAm) &#123;                    final long identity = Binder.clearCallingIdentity();                    try &#123;                        if (!mPendingServices.contains(serviceRecord)) &#123;                            return;                        &#125;                        // If there is still a pending record, then the service                        // binding request is still valid, so hook them up. We                        // proceed only if the caller cleared the review requirement                        // otherwise we unbind because the user didn&#39;t approve.                        if (!mAm.getPackageManagerInternalLocked()                                .isPermissionsReviewRequired(                                        serviceRecord.packageName,                                        serviceRecord.userId)) &#123;                            try &#123;                                // ç”¨æˆ·é€šè¿‡äº†æƒé™éªŒè¯ï¼Œåˆ™åˆ›å»º Service å®ä¾‹                                bringUpServiceLocked(serviceRecord,                                        serviceIntent.getFlags(),                                        callerFg, false, false);                            &#125; catch (RemoteException e) &#123;                                /* ignore - local call */                            &#125;                        &#125; else &#123;                            unbindServiceLocked(connection);                        &#125;                    &#125; finally &#123;                        Binder.restoreCallingIdentity(identity);                    &#125;                &#125;            &#125;        &#125;);        final Intent intent = new Intent(Intent.ACTION_REVIEW_PERMISSIONS);        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK                | Intent.FLAG_ACTIVITY_MULTIPLE_TASK                | Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS);        intent.putExtra(Intent.EXTRA_PACKAGE_NAME, s.packageName);        intent.putExtra(Intent.EXTRA_REMOTE_CALLBACK, callback);        mAm.mHandler.post(new Runnable() &#123;            @Override            public void run() &#123;                mAm.mContext.startActivityAsUser(intent, new UserHandle(userId));            &#125;        &#125;);    &#125;    final long origId = Binder.clearCallingIdentity();    try &#123;        ...        // å¦‚æœè¿™æ—¶ Service è¿˜æ²¡æœ‰è¢«åˆ›å»ºï¼Œåˆ™åˆ›å»º Service å®ä¾‹        if ((flags&amp;Context.BIND_AUTO_CREATE) != 0) &#123;            s.lastActivity = SystemClock.uptimeMillis();            if (bringUpServiceLocked(s, service.getFlags(), callerFg, false,                    permissionsReviewRequired) != null) &#123;                return 0;            &#125;        &#125;        ...        if (s.app != null &amp;&amp; b.intent.received) &#123;            // Service å·²ç»åœ¨è¿è¡Œäº†ï¼Œå°±å¯ä»¥ç›´æ¥è¿›è¡Œ connect            // æ­¤å¤„çš„ connected æ˜¯ IServiceConnection.aidl ä¸­å®šä¹‰çš„ï¼Œè¿™ä¸ªæ–¹æ³•ç”± LoadedApk æ¥å®ç°ï¼Œå…·ä½“æŸ¥çœ‹ã€å…³äº Contextã€ä¸€æ–‡ï¼Œæ­¤å¤„ç•¥è¿‡            // æœ€åä¼šè°ƒç”¨åˆ° ServiceConnection.onServiceConnected() æ–¹æ³•ï¼Œå®Œæˆäº†ç»‘å®šå·¥ä½œ            try &#123;                c.conn.connected(s.name, b.intent.binder, false);            &#125; catch (Exception e) &#123;                Slog.w(TAG, &quot;Failure sending service &quot; + s.shortInstanceName                        + &quot; to connection &quot; + c.conn.asBinder()                        + &quot; (in &quot; + c.binding.client.processName + &quot;)&quot;, e);            &#125;            // å¦‚æœæ˜¯é‡æ–°ç»‘å®š            if (b.intent.apps.size() == 1 &amp;&amp; b.intent.doRebind) &#123;                requestServiceBindingLocked(s, b.intent, callerFg, true);            &#125;        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç»‘å®š        &#125; else if (!b.intent.requested) &#123;            requestServiceBindingLocked(s, b.intent, callerFg, false);        &#125;        getServiceMapLocked(s.userId).ensureNotStartingBackgroundLocked(s);    &#125; finally &#123;        Binder.restoreCallingIdentity(origId);    &#125;    return 1;&#125;private final boolean requestServiceBindingLocked(ServiceRecord r, IntentBindRecord i,        boolean execInFg, boolean rebind) throws TransactionTooLargeException &#123;    ...    r.app.thread.scheduleBindService(r, i.intent.getIntent(), rebind,            r.app.getReportedProcState());    ...&#125;</code></pre><p>ç»§ç»­äº¤ç»™ ActivityThread å»åšè¿™ä»¶äº‹ï¼Œç»è¿‡å‘é€<code>BIND_SERVICE</code>çš„æ¶ˆæ¯åï¼Œæ¥åˆ°äº†<code>ActivityThread.handleBindService()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// android.app.ActivityThreadprivate void handleBindService(BindServiceData data) &#123;    Service s = mServices.get(data.token);    if (s != null) &#123;        try &#123;            data.intent.setExtrasClassLoader(s.getClassLoader());            data.intent.prepareToEnterProcess();            try &#123;                if (!data.rebind) &#123;                    // è°ƒç”¨ Servcie å¯¹è±¡çš„ onBind ç”Ÿå‘½å‘¨æœŸæ–¹æ³•                    IBinder binder = s.onBind(data.intent);                    ActivityManager.getService().publishService(                            data.token, data.intent, binder);                &#125; else &#123;                    // è°ƒç”¨ Servcie å¯¹è±¡çš„ onRebind ç”Ÿå‘½å‘¨æœŸæ–¹æ³•                    s.onRebind(data.intent);                    ActivityManager.getService().serviceDoneExecuting(                            data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);                &#125;            &#125; catch (RemoteException ex) &#123;                throw ex.rethrowFromSystemServer();            &#125;        &#125; catch (Exception e) &#123;            if (!mInstrumentation.onException(s, e)) &#123;                throw new RuntimeException(                        &quot;Unable to bind to service &quot; + s                        + &quot; with &quot; + data.intent + &quot;: &quot; + e.toString(), e);            &#125;        &#125;    &#125;&#125;</code></pre><p>åˆå›åˆ°äº† ActivityManagerService ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸¤ä¸ªæ–¹æ³•<code>publishService()</code>å’Œ<code>serviceDoneExecuting()</code>ã€‚è¿½è¸ªä¸‹å»ï¼Œå‘ç°<code>publishService()</code>æ–¹æ³•æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº† LoadedApk.connected() æ–¹æ³•ï¼›è€Œ<code>serviceDoneExecuting()</code>æ–¹æ³•å¹¶æ²¡æœ‰ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ rebind çš„æƒ…å†µä¸‹æ‰ä¼šè°ƒç”¨ï¼Œåˆšæ‰åœ¨ ActiveServices.bindServiceLocked å·²ç»é’ˆå¯¹ rebind æƒ…å†µè°ƒç”¨è¿‡ä¸€æ¬¡ LoadedApk.connected() äº†ã€‚</p><p>è‡³æ­¤ï¼Œç»‘å®š Service çš„å¯åŠ¨å®Œæˆã€‚</p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€å¼ æ—¶åºå›¾æ¥å±•ç¤ºä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="/img/service-1588840496.png"></p><h3 id="IntentService-åŸç†è§£æ"><a href="#IntentService-åŸç†è§£æ" class="headerlink" title="IntentService åŸç†è§£æ"></a>IntentService åŸç†è§£æ</h3><p>IntentService çš„ç‰¹ç‚¹å°±ä¸å†èµ˜è¿°äº†ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å®ƒå…³é”®çš„ä»£ç ï¼Œç„¶åå†è§£é‡Šå®ƒçš„åŸç†ï¼š</p><pre><code class="java">public abstract class IntentService extends Service &#123;    // æœ‰è‡ªå·±çš„ Looper    private volatile Looper mServiceLooper;    // æœ‰è‡ªå®šä¹‰çš„ Handler    private volatile ServiceHandler mServiceHandler;    private String mName;    private boolean mRedelivery;    // å°† Handler ç»‘å®šåˆ°åˆå§‹åŒ–çš„çº¿ç¨‹ä¸­    private final class ServiceHandler extends Handler &#123;        public ServiceHandler(Looper looper) &#123;            super(looper);        &#125;        @Override        public void handleMessage(Message msg) &#123;            onHandleIntent((Intent)msg.obj);            stopSelf(msg.arg1);        &#125;    &#125;    // ä¼ å…¥ name ä»¥ä¾›å†…éƒ¨çš„ HandlerThread ä½¿ç”¨ï¼Œæ–¹ä¾¿è¿›è¡Œè°ƒè¯•    public IntentService(String name) &#123;        super();        mName = name;    &#125;    // è®¾ç½® intent æ˜¯å¦ä¼šè¢«é‡æ–°ä¼ é€’    //    // å¦‚æœè®¾ç½®ä¸º trueï¼ŒonStartCommand() ä¼šè¿”å› Serivce.START_REDELIVER_INTENTï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ    // å¦‚æœ onHandleIntent() è¿˜æ²¡æœ‰æ‰§è¡Œå®Œè¿”å›ï¼Œè¿›ç¨‹å°±æ­»æ‰äº†ï¼Œè¿™æ—¶è¿›ç¨‹ä¼šè¢«é‡å¯ç„¶åé‡æ–°ä¼ é€’åˆšæ‰çš„ intentã€‚    // å¦‚æœä¹‹å‰å‘é€äº†å¤šä¸ª intent ï¼ˆå…¶ä»–çš„åœ¨ç­‰å¾…ï¼‰ï¼Œåªæœ‰æœ€è¿‘å‘é€çš„ä¸€ä¸ªèƒ½ä¿è¯è¢«é€è¾¾ï¼ˆå…¶ä»–çš„ä¸ä¸€å®šäº†ï¼‰ã€‚    //     // å¦‚æœè®¾ç½®ä¸º false onStartCommand() ä¼šè¿”å› Serivce.START_NOT_STICKYï¼Œå¦‚æœè¿›è¡Œæ­»æ‰ï¼Œintent ä¹Ÿå°±éšé£æ¶ˆæ•£äº†    //    public void setIntentRedelivery(boolean enabled) &#123;        mRedelivery = enabled;    &#125;    @Override    public void onCreate() &#123;        super.onCreate();        // æ–°å»ºäº†ä¸€ä¸ªå±€éƒ¨çš„ HandlerThreadï¼Œä¹Ÿå³ä¸å…è®¸å¤–éƒ¨ç›´æ¥ç®¡ç†è¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€ã€‚        HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;);        thread.start();        mServiceLooper = thread.getLooper();        mServiceHandler = new ServiceHandler(mServiceLooper);    &#125;    @Override    public void onStart(@Nullable Intent intent, int startId) &#123;        Message msg = mServiceHandler.obtainMessage();        msg.arg1 = startId;        msg.obj = intent;        mServiceHandler.sendMessage(msg);    &#125;    // ä¸è¦é‡å†™è¿™ä¸ªæ–¹æ³•    @Override    public int onStartCommand(@Nullable Intent intent, int flags, int startId) &#123;        onStart(intent, startId);        return mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;    &#125;    @Override    public void onDestroy() &#123;        mServiceLooper.quit();    &#125;    // é™¤éä½ éœ€è¦ç»‘å®šè¿™ä¸ªæœåŠ¡ï¼Œå¦åˆ™ä¸ç”¨é‡å†™è¿™ä¸ªæ–¹æ³•    @Override    @Nullable    public IBinder onBind(Intent intent) &#123;        return null;    &#125;    // å”¯ä¸€éœ€è¦é‡å†™çš„çš„æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¯ä»¥å¤„ç†è°ƒç”¨è€…å‘é€æ¥çš„æ•°æ®    @WorkerThread    protected abstract void onHandleIntent(@Nullable Intent intent);&#125;</code></pre><p>å¯è§è¿™ä¸ªç±»å¹¶ä¸æ˜¯å¾ˆç¥ç§˜ï¼š</p><ol><li>ç»§æ‰¿äº† Service ç±»ï¼›</li><li>é‡å†™äº†<code>onCreate()</code>æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨çš„ HandlerThreadï¼Œå¹¶ä¸å…è®¸å¤–éƒ¨ç›´æ¥è®¿é—®ï¼›</li><li>å®šä¹‰äº†ä¸€ä¸ª ServiceHandler å¹¶ä¸æ–°å»ºçš„ HandlerThread ç»‘å®šï¼›</li><li>é‡å†™äº†<code>onStart()</code>æ–¹æ³•ï¼Œåœ¨æ¯æ¬¡å¯åŠ¨æœåŠ¡è°ƒç”¨åˆ°<code>onStartCommand()</code>çš„æ—¶å€™ï¼Œè°ƒç”¨<code>onStart()</code>ï¼Œå¹¶å°†æ¶ˆæ¯ä¼ é€’ç»™ ServiceHandlerï¼›</li><li>å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•<code>onHandleIntent(Intent)</code>ä¾›å­ç±»ä½¿ç”¨ï¼Œç”¨äºçœŸæ­£å¤„ç†è¯·æ±‚ã€‚</li></ol><p>è¿™ä¸ªç±»è™½ç„¶å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯ Google å†³å®šåœ¨ Android Rï¼ˆAndroid 11ï¼‰ä¸­ï¼Œå°†ä¼š<strong>åºŸå¼ƒè¿™ä¸ªç±»</strong>ï¼ŒåŸå› ä¸æœ€å¼€å§‹æåˆ°çš„ã€åå°æ“ä½œé™åˆ¶ã€ç›¸åŒï¼Œä¸€ä¸ªæ€»æ˜¯åœ¨åå°è¿è¡Œçš„æœåŠ¡ï¼Œå¿…ç„¶ä¼šé€ æˆèµ„æºçš„æ¶ˆè€—ä¸æµªè´¹ã€‚Android ç°åœ¨å¤§åŠ›æ¨å® çš„æ˜¯ androidx ä¸­çš„ <a href="https://developer.android.com/reference/androidx/work/WorkManager.html">WorkManager</a> å’Œ <a href="https://developer.android.com/reference/androidx/core/app/JobIntentService.html">JobIntentService</a>ï¼Œæˆ‘å°†ä¼šåœ¨å…¶ä»–çš„æ–‡ç« é‡Œè®²è§£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Framework </tag>
            
            <tag> Service </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JobScheduler å’Œ WorkManager</title>
      <link href="/2020-04-26/jobscheduler-and-workmanager/"/>
      <url>/2020-04-26/jobscheduler-and-workmanager/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è®²è®² JobScheduler å’Œ WorkManagerã€‚</p><span id="more"></span><h2 id="JobScheduler"><a href="#JobScheduler" class="headerlink" title="JobScheduler"></a>JobScheduler</h2><p>JobScheduler æ˜¯ Google åœ¨ API 21ï¼ˆAndroid 5.0ï¼‰ä¸­æ¨å‡ºçš„ä¸€ç§åå°æ‰§è¡Œä»»åŠ¡çš„æ–¹å¼ã€‚å› ä¸ºæ™®é€šçš„ Service ä¼šåœ¨åå°ä¸€ç›´è¿è¡Œï¼Œåªæœ‰ç³»ç»Ÿèµ„æºä¸è¶³æ—¶æ‰ä¼šå°†å…¶å›æ”¶ï¼Œå“ªæ€•è¿™ä¸ª Service ç°åœ¨æ²¡æœ‰åœ¨åšä»»ä½•äº‹æƒ…ï¼Œè¿™æ˜¾ç„¶ä¼šå¯¹ç³»ç»Ÿèµ„æºé€ æˆç›¸å½“å¤§çš„æµªè´¹ï¼Œæ¯•ç«Ÿå¯åŠ¨ä¸€ä¸ª Service å¯¹å¼€å‘è€…æ¥è¯´æ²¡ä»€ä¹ˆæˆæœ¬æ˜¯å§ï¼Ÿ</p><p>JobScheduler æä¾›çš„æ˜¯<strong>æ ¹æ®æŸä¸ªæ¡ä»¶æ¥æ‰§è¡Œä»»åŠ¡</strong>ï¼Œè€Œä¸æ˜¯åœ¨æŸä¸ªæ—¶é—´æ¥æ‰§è¡Œã€‚å®ƒèƒ½ç¡®ä¿æŠŠä½ çš„ä»»åŠ¡æ‰§è¡Œäº†ï¼Œä½†æ˜¯ä¸èƒ½å‘Šè¯‰ä½ ä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œã€‚<img class="sticker" src="http://img.doutula.com/production/uploads/image/2017/11/12/20171112500197_UKzaih.jpg" /></p><p>è¿™è®©æˆ‘æƒ³èµ·äº†ä¸€å¥åè¨€ï¼š</p><blockquote><p>æˆ‘ä¼šè¿˜ä½ é’±çš„ï¼Œä½†æˆ‘æ²¡è¯´ä»€ä¹ˆæ—¶å€™è¿˜ä½ ã€‚</p></blockquote><p>å½“ç„¶ï¼Œæƒ…å†µæ²¡æœ‰é‚£ä¹ˆä¸¥é‡ã€‚ç³»ç»Ÿåªæ˜¯ä¼š<strong>æ™ºèƒ½åˆ†é…</strong>ç›®å‰æ‰€æœ‰çš„ç”¨ JobScheduler æ–¹å¼æäº¤çš„ä»»åŠ¡ï¼Œå¹¶å°è¯•æ‰¹é‡æ‰§è¡Œï¼Œå¹¶ä¸”èƒ½æ¨è¿Ÿå¤šä¹…å°±æ¨è¿Ÿå¤šä¹…ã€‚è¿™ä¹ˆè¯´å§ï¼Œä½ è¦æ˜¯ä¸ç»™è¿™ä¸ª Job æŒ‡å®šä¸€ä¸ª deadlineï¼Œé‚£å®ƒçœŸçš„å¯èƒ½ä¼šåœ¨å¾ˆä¹…ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</p><p>é‚£è¿™ç©æ„è¿™ä¹ˆä¸é è°±ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ç”¨å®ƒå‘¢ï¼Ÿ</p><p>å› ä¸ºéšç€ Android ç‰ˆæœ¬çš„ä¸æ–­æ›´è¿­ï¼Œç³»ç»Ÿä¹Ÿé€æ¸å˜å¾—æµç•…ï¼Œè¿™èƒŒåæ˜¯å¯¹ App æ›´å¤šçš„é™åˆ¶ï¼šé™åˆ¶åå°è¿›ç¨‹çš„è¿è¡Œæ—¶é—´ã€é™åˆ¶åå°„å¯è°ƒç”¨çš„æ¥å£ã€é™åˆ¶æŸäº›è€—ç”µè¡Œä¸ºã€é™åˆ¶ä½ å¯ä»¥æ¥æ”¶åˆ°çš„å¹¿æ’­ã€‚ã€‚ã€‚Android å¿…é¡»ä¹Ÿè¦æ¨å‡ºä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œè®© App èƒ½å¤Ÿåœ¨æŸç§æ¡ä»¶ä¸‹ï¼Œå®ŒæˆæŸç§ä»»åŠ¡ã€‚JobScheduler å°±åº”è¿è€Œç”Ÿäº†ã€‚</p><h3 id="JobScheduler-çš„ä½¿ç”¨"><a href="#JobScheduler-çš„ä½¿ç”¨" class="headerlink" title="JobScheduler çš„ä½¿ç”¨"></a>JobScheduler çš„ä½¿ç”¨</h3><p>è¦ä½¿ç”¨ JobSchedulerï¼Œå¿…é¡»è¦å…ˆäº†è§£å®ƒçš„ä¸€å®¶äººï¼š</p><ul><li>JobInfoï¼šæäº¤ä»»åŠ¡æ—¶è¦ä¼ é€’çš„å‚æ•°ï¼ŒåŒ…å«äº†ä»»åŠ¡æ¦‚è¦ã€æ‰§è¡Œæ¡ä»¶ã€deadline ç­‰ã€‚</li><li>JobServiceï¼šå½“ç³»ç»Ÿè°ƒåº¦åˆ°ä½ è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œè¦å¦‚ä½•å¤„ç†ä»»åŠ¡ï¼Œä½ è¦è‡ªå·±å»å®ç°ã€‚</li><li>JobSchedulerï¼šç”¨äºå‘ç³»ç»Ÿæäº¤ä»»åŠ¡ã€‚</li></ul><p>å®ƒçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š</p><h3 id="1-åˆ›å»º-JobService-çš„å­ç±»"><a href="#1-åˆ›å»º-JobService-çš„å­ç±»" class="headerlink" title="1. åˆ›å»º JobService çš„å­ç±»"></a>1. åˆ›å»º JobService çš„å­ç±»</h3><p>JobService ç»§æ‰¿è‡ª Serviceï¼Œä¹Ÿæ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦è‡ªå·±å†™ä¸€ä¸ªå­ç±»ï¼š</p><blockquote><p>æ³¨æ„ï¼è¿™æ˜¯ä¸€ä¸ª Seviceï¼Œæ„å‘³ç€å®ƒæ˜¯åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸­è¢«å›è°ƒçš„ï¼æ‰€ä»¥ï¼Œè¿™é‡Œå¦‚æœè¦è®¿é—®ç½‘ç»œè¿›è¡Œå¯†é›†ã€è€—æ—¶çš„æ“ä½œï¼Œè¿˜æ˜¯éœ€è¦å¦èµ·çº¿ç¨‹æ¥åšã€‚</p></blockquote><pre><code class="java">public class CustomJobService extends JobService &#123;    @Override    public boolean onStartJob(JobParameters params) &#123;        jobFinished(params, true);        return true;    &#125;    @Override    public boolean onStopJob(JobParameters params) &#123;        return false;    &#125;&#125;</code></pre><p>å®ƒåªéœ€è¦å®ç°ä¸¤ä¸ªæ–¹æ³•ï¼š<code>onStartJob(JobParameters)</code>å’Œ<code>onStopJob(JobParameters)</code>ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä»»åŠ¡å¼€å§‹çš„å›è°ƒå’Œä»»åŠ¡åœæ­¢çš„å›è°ƒã€‚è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³•æ˜¯<code>jobFinished(JobParameters, boolean)</code>ï¼Œæˆ‘ä»¬è§£é‡Šä¸€ä¸‹è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</p><ul><li><p><code>onStartJob()</code>ï¼šä¼ å…¥äº† JobParameters ç±»å‹çš„å˜é‡ï¼Œå®ƒåŒ…å«äº†<code>jobId</code>å’Œæäº¤ä»»åŠ¡æ—¶åˆ›å»º JobInfo æ—¶ä¼ å…¥çš„ Bundle ç­‰æ•°æ®ã€‚åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶ï¼Œéœ€è¦è°ƒç”¨<code>jobFinished()</code>æ¥å‘Šè¯‰ç³»ç»Ÿï¼šæˆ‘çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆäº†ã€‚å®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ª booleanï¼š</p><ul><li>è¿”å›<code>true</code>å°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œæˆ‘è¿˜åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œä¸€ä¼šä»»åŠ¡å®Œæˆäº†ï¼Œæˆ‘ä¼šè°ƒç”¨<code>jobFinished()</code>æ¥å‘Šè¯‰ä½ çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œä»»åŠ¡çš„æ‰§è¡Œç¯å¢ƒå‘ç”Ÿäº†å˜æ›´ï¼Œæ¯”å¦‚åœ¨æäº¤ä»»åŠ¡æ—¶æŒ‡å®šã€å……ç”µæ—¶æ‰§è¡Œã€ï¼Œä½†ç”¨æˆ·è¿™æ—¶å€™æŠŠå……ç”µçº¿æ‹”æ‰äº†ï¼Œé‚£å°±ä¼š<strong>ç«‹åˆ»ç»“æŸä»»åŠ¡</strong>ï¼Œå¹¶è°ƒç”¨<code>onStopJob()</code>ï¼›</li><li>è¿”å›<code>false</code>åˆ™å‘Šè¯‰ç³»ç»Ÿï¼Œæˆ‘æ‰§è¡Œå®Œäº†ã€‚ç³»ç»Ÿä¹Ÿä¸ä¼šå†å»è°ƒç”¨<code>onStopJob()</code>æ–¹æ³•ã€‚</li></ul></li><li><p><code>jobFinished()</code>ï¼šåªèƒ½åœ¨<code>onStartJob()</code>ä¸­è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è¢« final ä¿®é¥°çš„ï¼Œä¸èƒ½è¢«è¦†å†™ã€‚å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ JobParametersï¼Œç¬¬äºŒä¸ªæ˜¯ boolean ç±»å‹çš„å‚æ•°ï¼Œä¼ å…¥<code>true</code>æ˜¯å¸Œæœ›ç³»ç»Ÿèƒ½æ ¹æ®åˆ›å»ºä»»åŠ¡æ—¶çš„æ ‡å‡†<strong>å†æ¬¡å°†è¿™ä¸ªä»»åŠ¡æä¸Šæ—¥ç¨‹</strong>ï¼Œä¼ å…¥<code>false</code>åˆ™ç›¸åã€‚</p></li><li><p><code>onStopJob()</code>ï¼šå½“è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè¡¨ç¤ºä»»åŠ¡è¦è¢«å¼ºåˆ¶ä¸­æ–­äº†ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ä»»åŠ¡æ‰§è¡Œæ¡ä»¶ä¸æ»¡è¶³æ—¶ã€‚è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œç³»ç»Ÿå°±ä¼šé‡Šæ”¾ Wakelockã€‚è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª booleanï¼šå¦‚æœè¿”å›<code>true</code>è¡¨ç¤ºã€æ•™ç»ƒï¼Œæˆ‘æƒ³å†è¯•è¯•ğŸ€ã€ï¼Œæ•™ç»ƒä¼šåœ¨åˆé€‚çš„æ—¶é—´å†å®‰æ’ä½ æ‰“ç¯®çƒï¼ˆå¤§è¯¯ï¼‰ï¼›è¿”å›<code>false</code>è¡¨ç¤ºã€æˆ‘ä¸è¡Œäº†â˜ ï¸ã€ï¼Œæ•™ç»ƒæ‰­å¤´å°±èµ°ã€‚ä½†ä¸ç®¡ä½ è¿”å›ä»€ä¹ˆï¼Œä»»åŠ¡æ˜¯è‚¯å®šä¼šè¢«ç»ˆæ­¢çš„ã€‚</p></li></ul><p>åœ¨<code>onStartJob()</code>è¢«è°ƒç”¨ä¹‹å‰ï¼Œç³»ç»Ÿä¼šç»™ App ç»‘å®šä¸€ä¸ª Wakelockï¼Œä»¥é˜²æ­¢ç³»ç»Ÿè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè¿™ä¸ª Wakelock ä¼šåœ¨ä½ è°ƒç”¨<code>jobFinished()</code>æˆ–è€…ç³»ç»Ÿè°ƒç”¨<code>onStopJob()</code>æ—¶è¢«é‡Šæ”¾æ‰ã€‚</p><h3 id="2-åˆ›å»º-JobInfo"><a href="#2-åˆ›å»º-JobInfo" class="headerlink" title="2. åˆ›å»º JobInfo"></a>2. åˆ›å»º JobInfo</h3><p>JobInfo æ˜¯ä¸€ä¸ª Parcelableï¼Œæ˜¾ç„¶æ˜¯ç”¨äº IPC çš„ã€‚å®ƒé‡‡ç”¨äº† Builder è®¾è®¡æ¨¡å¼æ¥åˆ›å»ºå®ä¾‹ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p><pre><code class="java">public static final int JOB_ID = 0;JobInfo jobInfo = new JobInfo.Builder(    JOB_ID,    new ComponentName(context, CustomJobService.class))        .setRequiredNetWork()        .setRequireCharging()        .build();</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œç»™è¿™ä¸ª JobInfo è®¾ç½®äº†è¦å¤„ç†ä»»åŠ¡çš„ç±»ï¼Œè®¾ç½®äº† jobIdï¼Œè®¾ç½®äº†æ‰§è¡Œä»»åŠ¡çš„æ¡ä»¶ç­‰ã€‚</p><p>å®ƒçš„ Builder ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•ï¼Œä¸‹é¢æ˜¯å®ƒæ‰€æœ‰çš„æ–¹æ³•ï¼š</p><p><img src="/img/job-1589006675.png"></p><h3 id="3-æäº¤ä»»åŠ¡"><a href="#3-æäº¤ä»»åŠ¡" class="headerlink" title="3. æäº¤ä»»åŠ¡"></a>3. æäº¤ä»»åŠ¡</h3><p>JobScheduler æ˜¯ç³»ç»ŸæœåŠ¡ï¼Œä¸èƒ½ç›´æ¥è¢«å®ä¾‹åŒ–ï¼Œè¦é€šè¿‡<code>Context.getSystemService()</code>æ¥è·å–ã€‚</p><pre><code class="java">JobScheduler js = (JobScheduler) context.getSystemService(Context.JOB_SCHEDULER_SERVICE);js.schedule(jobInfo);</code></pre><p>è‡³æ­¤ï¼Œä¸€ä¸ªä»»åŠ¡å°±è¢«ã€å®‰æ’ä¸Šäº†ã€ã€‚<img class="sticker" src="/img/anpai.jpg" /></p><p>JobScheduler ä¸­æœ€å¸¸ç”¨çš„æ˜¯<code>schedule()</code>æ–¹æ³•ï¼Œç”¨äºæäº¤ä»»åŠ¡ã€‚å¤šæ¬¡è°ƒç”¨çš„è¯ï¼Œå¦‚æœç³»ç»Ÿä¸­å·²ç»æœ‰ç›¸åŒ jobId çš„ä»»åŠ¡ï¼Œåˆ™ä¼šç”¨æ–°çš„ç›´æ¥æ›¿æ¢æ‰æ—§ä»»åŠ¡ï¼Œå¦‚æœæ—§ä»»åŠ¡å½“å‰æ­£åœ¨è¿è¡Œï¼Œé‚£å®ƒ<strong>ä¼šè¢«ç»ˆæ­¢</strong>ã€‚</p><p>å®ƒè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯<code>enqueue(JobInfo, JobWorkItem)</code>ï¼Œç”¨æ¥ç»™æŸä¸ªä»»åŠ¡ï¼ˆæ–°ä»»åŠ¡æˆ–è€…å·²å­˜åœ¨ä»»åŠ¡çš†å¯ï¼‰æ’å…¥å·¥ä½œå†…å®¹ï¼ˆJobWorkItemï¼‰ã€‚å¦‚æœç³»ç»Ÿä¸­å·²ç»æœ‰ç›¸åŒ jobId çš„ä»»åŠ¡ï¼Œåˆ™ä¼šç”¨æ–°çš„ç›´æ¥æ›¿æ¢æ—§ä»»åŠ¡ï¼Œå¦‚æœæ—§ä»»åŠ¡å½“å‰æ­£åœ¨è¿è¡Œï¼Œä¼ å…¥çš„ JobWorkItem ä¼šè¢«<strong>æ’å…¥ä»»åŠ¡çš„å·¥ä½œé˜Ÿåˆ—</strong>ï¼Œä»»åŠ¡<strong>å¹¶ä¸ä¼šè¢«ç»ˆæ­¢</strong>ã€‚è™½ç„¶ä¸ä¼šç»ˆæ­¢ä»»åŠ¡ï¼Œä½†è¿˜æ˜¯<strong>å¼ºçƒˆå»ºè®®ä½¿ç”¨åŒä¸€ä¸ª JobInfo</strong>æ¥æ’å…¥å·¥ä½œå†…å®¹ï¼Œè¿™æ ·ï¼Œç³»ç»Ÿå°±ä¸ä¼šåˆ†é…é¢å¤–çš„èµ„æºå»æ›´æ”¹ JobInfoï¼Œä»è€Œèƒ½æ›´ä¸“æ³¨äºæ‰§è¡Œä»»åŠ¡ã€‚</p><h2 id="JobScheduler-å®ç°åŸç†"><a href="#JobScheduler-å®ç°åŸç†" class="headerlink" title="JobScheduler å®ç°åŸç†"></a>JobScheduler å®ç°åŸç†</h2><p>æ—¢ç„¶æ˜¯ç³»ç»ŸæœåŠ¡ï¼Œé‚£å¿…ç„¶æ˜¯éµå¾ªè€å¥—è·¯ï¼Œå¾—æœ‰ä¸ªç±»ä¼¼ JobSchedulerService ä¹‹ç±»çš„ä¸œè¥¿ï¼Œå¹¶ä¸”ç”± system_server è¿›ç¨‹å¯åŠ¨ï¼Œæˆ‘ä»¬ç›´æ¥æ‰’ SystemServer ç±»çš„ä»£ç ï¼š</p><pre><code class="java">// android.server.SystemServer.javaprivate void startOtherServices() &#123;    ...    traceBeginAndSlog(&quot;StartJobScheduler&quot;);    mSystemServiceManager.startService(JobSchedulerService.class);    traceEnd();    ...&#125;</code></pre><p>âœŒï¸âœŒï¸âœŒï¸æœç„¶å¦‚æ­¤ï¼Œæ¥ä¸‹æ¥å°±åˆ†æä¸€ä¸‹ JobSchedulerService çš„ä»£ç ï¼š</p><pre><code class="java"></code></pre><h2 id="WorkManager"><a href="#WorkManager" class="headerlink" title="WorkManager"></a>WorkManager</h2><p>WorkManager æ˜¯ Android Jetpack ä¸­çš„ä¸€ä¸ªç»„ä»¶ã€‚å®ƒæä¾›äº†æ›´ä¸ºå¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å‘ä¸‹å…¼å®¹åˆ° API 14</li><li>å¯ä»¥æ·»åŠ å·¥ä½œæ¡ä»¶çº¦æŸï¼šæ¯”å¦‚æœ‰ Wifi è¿æ¥ã€æ­£åœ¨å……ç”µç­‰ç­‰ï¼ˆè¿™å¾ˆåˆé€‚åœ¨åå°ä¸‹è½½ App çš„æ›´æ–°åŒ…ï¼‰</li><li>å¯ä»¥æ‰§è¡Œä¸€æ¬¡æ€§çš„æˆ–è€…å‘¨æœŸæ€§çš„ä»»åŠ¡</li><li>èƒ½å¤Ÿç›‘å¬å’Œç®¡ç†å·²è®¡åˆ’çš„ä»»åŠ¡</li><li>å°†å¤šä¸ªä»»åŠ¡é“¾æ¥èµ·æ¥ï¼ˆå¦™å•Šï¼‰</li><li>ä¿è¯ä»»åŠ¡ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œå“ªæ€• App é‡å¯ç”šè‡³è®¾å¤‡é‡å¯</li><li>éµå¾ªæ‰‹æœºçš„çœç”µæ¨¡å¼</li></ul><p>WorkManager é€‚åˆè¿è¡Œé‚£ç§<strong>éå³æ—¶çš„ã€ç¡®å®šè¦æ‰§è¡Œ</strong>çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´åœ¨æŸä¸ªæ—¶é—´æ®µå‘åå°å‘é€æ—¥å¿—ã€åŒæ­¥æ•°æ®ï¼Œæˆ–è€…å®šæœŸæ£€æŸ¥ App ç‰ˆæœ¬æƒ…å†µå¹¶ä¸‹è½½æ–°ç‰ˆæœ¬ç­‰ç­‰ã€‚</p><p>While a job is running, the system holds a wakelock on behalf of your app. For this reason, you do not need to take any action to guarantee that the device stays awake for the duration of the job.</p><p>You do not instantiate this class directly; instead, retrieve it through Context.getSystemService(Context.JOB_SCHEDULER_SERVICE).</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Jetpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android ä¼˜åŒ–æµ…è°ˆ</title>
      <link href="/2020-04-24/android-optimization/"/>
      <url>/2020-04-24/android-optimization/</url>
      
        <content type="html"><![CDATA[<p>Android ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ï¼Œä¸»è¦å¯ä»¥å…¥ä»¥ä¸‹ 5 ä¸ªè§’åº¦å…¥æ‰‹ï¼š</p><p><a href="#%E4%B8%80%20-%20%E7%A8%B3%E5%AE%9A%E6%80%A7">1. ç¨³å®šæ€§</a><br><a href="#%E4%BA%8C%20-%20%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8">2. å†…å­˜å ç”¨</a><br><a href="#%E4%B8%89%20-%20%E6%B5%81%E7%95%85%E5%BA%A6">3. æµç•…åº¦</a><br><a href="#%E5%9B%9B%20-%20%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97">4. èµ„æºæ¶ˆè€—ï¼ˆç½‘ç»œæµé‡ã€ç”µé‡ç­‰ï¼‰</a><br><a href="#%E4%BA%94%20-%20%E5%AE%89%E8%A3%85%E5%8C%85%E5%A4%A7%E5%B0%8F">5. å®‰è£…åŒ…å¤§å°</a></p><span id="more"></span><h2 id="ä¸€-ç¨³å®šæ€§"><a href="#ä¸€-ç¨³å®šæ€§" class="headerlink" title="ä¸€. ç¨³å®šæ€§"></a>ä¸€. ç¨³å®šæ€§</h2><p>ä¸€ä¸ªå¥½çš„åº”ç”¨ï¼Œé¦–å…ˆè¦æ±‚çš„å°±æ˜¯ç¨³å®šæ€§ã€‚å¦‚æœç”¨æˆ·ç‚¹ç‚¹ç‚¹ï¼Œå°±å´©æºƒäº†ï¼Œé‚£ç”¨æˆ·é‡çš„æŸå¤±å¯ä¸æ˜¯èƒ½å¤Ÿè½»æ˜“æŒ½å›çš„ã€‚</p><p>ä¸€èˆ¬é€ æˆåº”ç”¨ä¸ç¨³å®šçš„åŸå› æœ‰ä¸‹é¢å‡ ç§ï¼š</p><ol><li>ANR</li><li>Crash</li><li>æ­»é”</li><li>Panic</li></ol><h3 id="1-ANR"><a href="#1-ANR" class="headerlink" title="1. ANR"></a>1. ANR</h3><p>ANR å³ Application Not Respondingï¼Œæ˜¯æ¯”è¾ƒå¸¸è§çš„ç°è±¡ï¼Œè¿™ç§ç°è±¡ä¸€èˆ¬å‡ºç°åœ¨åº”ç”¨<strong>ä¸»çº¿ç¨‹æ— æ³•åœ¨è§„å®šæ—¶é—´å†…å–å‡º Looper ä¸­çš„ä¸‹ä¸€ä¸ªæ¶ˆæ¯è¿›è¡Œå¤„ç†</strong>æ—¶ï¼Œå±å¹•ä¸Šä¼šå¼¹å‡ºã€åº”ç”¨æ— å“åº”ï¼Œæ˜¯å¦å…³é—­ï¼Ÿã€çš„å¯¹è¯æ¡†ï¼Œæ˜¯ä»¤æ— æ•°å¼€å‘è€…å¤´ç–¼çš„é—®é¢˜ã€‚</p><p><img src="https://global-uploads.webflow.com/5c741219fd0819aad790e78b/5cc68a117c5efa97aed96e76_android-anr-photosnap.png" alt="FUCK ANR"></p><p>Android å¯¹ä¸»çº¿ç¨‹ä¸‹è¿è¡Œçš„ç»„ä»¶éƒ½æœ‰è¦æ±‚ï¼šä¸»çº¿ç¨‹5ç§’å†…æ— å“åº”ï¼›BroadcastReceiver 10 ç§’å†…æœªè¿”å›ï¼›åå° Service å¤„ç†è¶…æ—¶è¶…è¿‡20ç§’ï¼›å‰å° Service è¶…è¿‡5ç§’ï¼›ç»‘å®šæœåŠ¡è¶…è¿‡200ç§’ã€‚æ— æ³•è¾¾åˆ°ä¸Šè¿°è¦æ±‚ï¼Œå³è¢«ç³»ç»Ÿå®šä¹‰ä¸º ANRã€‚é€ æˆè¿™ç§é—®é¢˜çš„åŸå› çš„æ¯”è¾ƒå¤šï¼Œä½†å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>çº¿ç¨‹è‡ªèº«ä¸»çº¿ç¨‹å‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚è¿›è¡Œ IO æ–‡ä»¶æ“ä½œæ—¶é—´è¿‡é•¿ï¼Œè¿›è¡Œäº†å¤§é‡é¢‘ç¹çš„æ•°æ®åº“æ“ä½œï¼Œæ­»å¾ªç¯ç­‰ç­‰ã€‚</li><li>è°ƒç”¨ AMSã€PMS ç­‰é•¿æ—¶é—´æœªå“åº”ï¼Œè¿™ç§æƒ…å†µæœ‰å¯èƒ½å‘ç”Ÿåœ¨ <strong>system_server è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªé”ï¼Œæ— æ³•å“åº”åº”ç”¨å½“å‰çš„è¯·æ±‚</strong>ã€‚</li><li>io æ“ä½œæ—¶çš„ iowait è¿‡é«˜ï¼Œæ¯”å¦‚ä¸‹åœ¨ç”¨å¤šçº¿ç¨‹ä¸‹è½½æ–‡ä»¶ï¼Œè¿›è¡Œé¢‘ç¹å†™æ“ä½œã€‚</li><li>cpu å ç”¨ç‡è¿‡é«˜ï¼Œç”±å…¶ä»–åº”ç”¨å ç”¨äº†å¤ªå¤šçš„ CPU æ“ä½œï¼Œæœ¬è¿›ç¨‹æ— æ³•æŠ¢å åˆ° CPUã€‚</li><li>å†…å­˜è¿‡ä½ï¼Œç³»ç»Ÿåœ¨ä¸æ–­åœ°å°è¯•è¿›è¡Œ GC é‡Šæ”¾å†…å­˜ï¼Œå¯èƒ½ä¼šå¼•èµ· ANRã€‚</li></ul><p>äº§ç”Ÿ ANR æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨<code>/data/anr</code>ä¸‹ç”Ÿæˆä¸€ä¸ª<code>traces.txt</code>æ–‡ä»¶ï¼Œå®ƒé‡Œé¢è®°å½•äº† ANR äº§ç”Ÿçš„åŸå› å’Œæ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡åˆ†æå¾—å‡º ANR çš„å…·ä½“åŸå› ã€‚</p><h3 id="2-Crash"><a href="#2-Crash" class="headerlink" title="2. Crash"></a>2. Crash</h3><p>Crash é—®é¢˜ä¹Ÿæ¯”è¾ƒå¸¸è§ï¼Œç»å¤§å¤šæƒ…å†µæ˜¯æ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„ try-catchï¼Œå½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚è¿™äº›é—®é¢˜ä¸€èˆ¬éœ€è¦æ ¹æ®ç³»ç»Ÿçš„ logcat å»æŸ¥æ‰¾å¯¹åº”çš„ StackTraceï¼Œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹ SDK å¦‚ Bugly ç­‰å·¥å…·ï¼Œæ¥è·å–å´©æºƒæ—¶çš„ StackTraceã€‚</p><h3 id="3-æ­»é”"><a href="#3-æ­»é”" class="headerlink" title="3. æ­»é”"></a>3. æ­»é”</h3><p>é€ æˆè¿™ç§ç°è±¡çš„åŸå› ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ A è¿›ç¨‹æ­£åœ¨ä½¿ç”¨æŸä¸ªèµ„æºï¼Œæ­¤æ—¶ B ä¹Ÿä½¿ç”¨è¿™ä¸ªèµ„æºï¼Œäºæ˜¯ç­‰å¾… A é‡Šæ”¾é”ï¼Œä½†è¿™æ—¶ A åˆè¦ä½¿ç”¨ B æ­£åœ¨ä½¿ç”¨çš„èµ„æºï¼ŒB æ­¤æ—¶åˆæ— æ³•é‡Šæ”¾è¯¥èµ„æºçš„é”ï¼Œå› ä¸ºå®ƒåœ¨ç­‰å¾… A é‡Šæ”¾å®ƒæƒ³è¦çš„èµ„æºçš„é”ï¼Œå°±å‡ºç°äº†ä½ ç­‰æˆ‘æˆ‘ç­‰ä½ çš„ç°è±¡ï¼Œç§°ä¹‹ä¸ºæ­»é”ã€‚</p><p>å®ƒäº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶æ˜¯ï¼š</p><ol><li><strong>äº’æ–¥æ¡ä»¶</strong>ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºä»…ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ã€‚æ­¤æ—¶è‹¥æœ‰å…¶ä»–è¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼Œåˆ™è¯·æ±‚è¿›ç¨‹åªèƒ½ç­‰å¾…ï¼›</li><li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶</strong>ï¼šè¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†å¯¹è‡ªå·±å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ï¼›</li><li><strong>ä¸å¯å‰¥å¤ºæ¡ä»¶</strong>ï¼šè¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•ä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œå³åªèƒ½ç”±è·å¾—è¯¥èµ„æºçš„è¿›ç¨‹è‡ªå·±æ¥é‡Šæ”¾ï¼ˆåªèƒ½æ˜¯ä¸»åŠ¨é‡Šæ”¾)ï¼›</li><li><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶</strong>: è‹¥å¹²è¿›ç¨‹é—´å½¢æˆé¦–å°¾ç›¸æ¥å¾ªç¯ç­‰å¾…èµ„æºçš„å…³ç³»ã€‚</li></ol><p>é¿å…æ­»é”çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šç³»ç»Ÿå¯¹è¿›ç¨‹å‘å‡ºçš„æ¯ä¸€ä¸ªç³»ç»Ÿèƒ½å¤Ÿæ»¡è¶³çš„èµ„æºç”³è¯·è¿›è¡Œ<strong>åŠ¨æ€æ£€æŸ¥</strong>ï¼Œå¹¶æ ¹æ®æ£€æŸ¥ç»“æœå†³å®šæ˜¯å¦åˆ†é…èµ„æºï¼Œå¦‚æœåˆ†é…åç³»ç»Ÿå¯èƒ½å‘ç”Ÿæ­»é”ï¼Œåˆ™ä¸äºˆåˆ†é…ï¼Œå¦åˆ™äºˆä»¥åˆ†é…ï¼Œè¿™æ˜¯ä¸€ç§ä¿è¯ç³»ç»Ÿä¸è¿›å…¥æ­»é”çŠ¶æ€çš„åŠ¨æ€ç­–ç•¥ã€‚</p><h3 id="4-Panic"><a href="#4-Panic" class="headerlink" title="4. Panic"></a>4. Panic</h3><p>Panic æ˜¯å†…æ ¸çº§åˆ«çš„å´©æºƒã€‚è¿™ç§å´©æºƒåœ¨é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ— èƒ½ä¸ºåŠ›ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ kernel_log æ¥åˆ†æå¹¶å®šä½é—®é¢˜ï¼Œå¹¶åœ¨ä»£ç ä¸­å°½é‡é¿å…ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ç‚¹æˆ–è€…æ–¹æ³•ã€‚</p><h2 id="äºŒ-å†…å­˜å ç”¨"><a href="#äºŒ-å†…å­˜å ç”¨" class="headerlink" title="äºŒ. å†…å­˜å ç”¨"></a>äºŒ. å†…å­˜å ç”¨</h2><p>å› ä¸º Android æ˜¯ç§»åŠ¨å¹³å°ï¼Œæ‰€ä»¥å¯¹æ¯ä¸ªåº”ç”¨æ¥è¯´ï¼Œéƒ½æ˜¯æœ‰å†…å­˜é™åˆ¶çš„ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ä½¿ç”¨çš„å†…å­˜ç©ºé—´è¿‡å¤§ï¼Œåˆ™ä¼šè§¦å‘ LMKï¼ˆLow Memory Killerï¼‰æœºåˆ¶ï¼Œå¯¼è‡´åº”ç”¨å‡ºç°é—ªé€€ã€‚è¿™ç§ç°è±¡å¤§éƒ¨åˆ†åŸå› æ¥è‡ªå†…å­˜æ³„æ¼ã€‚</p><h3 id="å†…å­˜æ³„æ¼çš„åŸå› "><a href="#å†…å­˜æ³„æ¼çš„åŸå› " class="headerlink" title="å†…å­˜æ³„æ¼çš„åŸå› "></a>å†…å­˜æ³„æ¼çš„åŸå› </h3><p>ä¸€èˆ¬æ˜¯ç¼–ç é—®é¢˜ã€ç¬¬ä¸‰æ–¹åº“é—®é¢˜å’Œ Android è‡ªèº«é—®é¢˜ã€‚</p><ul><li><strong>ç¼–ç é—®é¢˜</strong>ï¼šæ¯”å¦‚è¯´é™æ€å˜é‡<strong>å¼•ç”¨äº†ç”Ÿå‘½å‘¨æœŸç»„ä»¶</strong>ï¼Œå¯¼è‡´è¯¥ç»„ä»¶ä¸€ç›´æ— æ³•é‡Šæ”¾ï¼›æˆ–è€…éé™æ€å†…éƒ¨ç±»ä¸€ç›´æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œç­‰ç­‰ã€‚</li><li><strong>ç¬¬ä¸‰æ–¹åº“</strong>ï¼šç¬¬ä¸‰æ–¹çš„ SDK æˆ‘ä»¬æ— æ³•ä¿è¯å…¶æ˜¯å¦ä¼šæœ‰å†…å­˜æ³„æ¼ï¼Œä¸€æ—¦å‡ºç°ï¼Œåªèƒ½å®šä½ï¼Œä¸å¤ªå¥½è§£å†³ã€‚</li><li><strong>Android è‡ªèº«é—®é¢˜</strong>ï¼šæ¯”å¦‚éå¸¸è‘—åçš„ <strong>WebView å†…å­˜æ³„æ¼</strong>ï¼Œå®ƒçš„<strong>å†…éƒ¨çº¿ç¨‹ä¼šæŒæœ‰ Activity çš„å¯¹è±¡ï¼Œå¯¼è‡´ Activity å¯¹è±¡æ— æ³•é‡Šæ”¾</strong>ã€‚å¦‚ä½•è§£å†³è¯·ç»§ç»­é˜…è¯»ã€‚</li></ul><h3 id="å†…å­˜æ³„æ¼çš„æ£€æµ‹å’Œå®šä½"><a href="#å†…å­˜æ³„æ¼çš„æ£€æµ‹å’Œå®šä½" class="headerlink" title="å†…å­˜æ³„æ¼çš„æ£€æµ‹å’Œå®šä½"></a>å†…å­˜æ³„æ¼çš„æ£€æµ‹å’Œå®šä½</h3><p>å¦‚æœæœ‰å†…å­˜æ³„æ¼ï¼Œæœ€ç›´è§‚çš„æ„Ÿå—ï¼Œå°±æ˜¯åº”ç”¨çš„å†…å­˜å ç”¨å™Œå™Œå™Œåœ°å¾€ä¸Šæ¶¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›å·¥å…·æ¥è§‚æµ‹å†…å­˜å ç”¨æƒ…å†µï¼Œä»è€Œç¡®å®šæ˜¯å¦æœ‰å†…å­˜æ³„æ¼çš„ç°è±¡ã€‚</p><ol><li><strong>Memory Monitor</strong>ã€‚ç”± Android Studio æä¾›ï¼Œå¯ä»¥ç›‘æµ‹å†…å­˜çš„å ç”¨æƒ…å†µï¼Œä½†æ— æ³•å¾—çŸ¥å†…å­˜æ³„æ¼çš„åŸå› ã€‚</li><li><strong>Memory Analyzer</strong>ã€‚ä¸€ä¸ªå¿«é€Ÿã€åŠŸèƒ½ä¸°å¯Œçš„ Java å †åˆ†æå·¥å…·ã€‚ä¼šé€šè¿‡å†…å­˜çš„ Snapshot ç”Ÿæˆ HPROF æ–‡ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹æ¯ä¸€ä¸ªå¯¹è±¡åœ¨å †ä¸­æ‰€å çš„å¤§å°ï¼Œä»è€Œå®šä½é€ æˆå†…å­˜æ³„æ¼çš„å¯¹è±¡æ˜¯å“ªä¸ªã€‚</li><li><strong>LeakCanary</strong>ã€‚ç”± Square å…¬å¸å‡ºå“ï¼Œå¯ä»¥ä»¥ SDK çš„æ–¹å¼é›†æˆåˆ°åº”ç”¨ä¸­ï¼Œå®ƒä¼šåœ¨åº”ç”¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒåŠæ—¶åœ°æé†’å¼€å‘è€…å“ªäº›åœ°æ–¹å‡ºç°äº†å†…å­˜æ³„æ¼ï¼Œå¹¶æä¾›ç›¸åº”çš„ StackTrace å¸®åŠ©å®šä½ï¼Œå®ƒçš„å…·ä½“åŸç†å¯ä»¥æŸ¥çœ‹<a href="/leakcanary/">è¿™ç¯‡æ–‡ç« </a>ã€‚</li><li><strong>Android Lint</strong>ã€‚ç”± Android Studio æä¾›ï¼Œå®ƒå¯ä»¥åŸºäºæºä»£ç å¿«é€Ÿåˆ†æä»£ç ä¸­å¯èƒ½å‡ºç°å†…å­˜æ³„æ¼çš„åœ°æ–¹ï¼Œå¹¶åŠ ä»¥æç¤ºï¼Œä»æºå¤´éåˆ¶å†…å­˜æ³„æ¼çš„äº§ç”Ÿã€‚å®ƒè¿˜æä¾›äº†ä¸€äº›å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Layout ä¼˜åŒ–ã€æç¤ºæœªä½¿ç”¨çš„å˜é‡ç­‰ç­‰ã€‚</li></ol><h3 id="å†…å­˜æ³„æ¼çš„è§£å†³"><a href="#å†…å­˜æ³„æ¼çš„è§£å†³" class="headerlink" title="å†…å­˜æ³„æ¼çš„è§£å†³"></a>å†…å­˜æ³„æ¼çš„è§£å†³</h3><ol><li><p>é¦–å…ˆè¦æ³¨æ„ Activity å®ä¾‹æ˜¯ä¸æ˜¯è¢«å¼•ç”¨åæ— æ³•é‡Šæ”¾ã€‚å¼•èµ·è¿™ç§æƒ…å†µä¸€èˆ¬æœ‰ä¸¤ç§åŸå› ï¼š</p><ol><li><strong>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨å¼•ç”¨</strong>çš„æƒ…å†µä¸‹ï¼Œå¯¼è‡´ Activity æ³„æ¼ï¼š<br>è¿™ç§æƒ…å†µä¸‹ï¼Œå°±é¿å…ä½¿ç”¨å†…éƒ¨ç±»ï¼Œå¯ä»¥ä½¿ç”¨é™æ€ç±»å†…éƒ¨æ¥è§£å†³ï¼Œé™æ€å†…éƒ¨ç±»ä¸æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ã€‚å¦‚æœå¿…é¡»è¦ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨è¿™ä¸ªå†…éƒ¨ç±»æ—¶ï¼Œè¦å¼ºåˆ¶å°†è¯¥ç±»çš„å®ä¾‹ç½®ä¸º nullã€‚</li><li><strong>Activity çš„ Context è¢«é—´æ¥å¼•ç”¨</strong>ï¼š<br>è¿™ç§æƒ…å†µå¦‚æœå¯ä»¥çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ Android çš„ ApplicationContext æ¥æ›¿ä»£ Activity çš„ Contextã€‚</li></ol></li><li><p>ç„¶åè¦æ³¨æ„é™æ€å˜é‡ä»¥åŠå•ä¾‹æ¨¡å¼ï¼Œ<strong>é™æ€å˜é‡å®ƒçš„ç”Ÿå‘½å‘¨æœŸåŸºæœ¬ä¸æ‰€åœ¨è¿›ç¨‹ä¸€æ ·é•¿</strong>ï¼Œæ‰€ä»¥è¦å°å¿ƒé™æ€å˜é‡å¼•ç”¨å…¶ä»–ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚å•ä¾‹æ¨¡å¼çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿä¸åº”ç”¨è¿›ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥ä¸é™æ€å˜é‡ä¸€æ ·ï¼Œè¦å°å¿ƒä½¿ç”¨ã€‚</p></li><li><p>è‡ªå®šä¹‰çš„ç›‘å¬å™¨çš„æ³¨é”€ã€‚å› ä¸ºç›‘å¬å™¨ä¸­ä¸€èˆ¬ä¼šç»´æŠ¤ä¸€ç»„é™æ€çš„ç›‘å¬è€…çš„å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœä¸åŠæ—¶æ³¨é”€ï¼Œæœ‰å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„æ¼ã€‚</p></li><li><p>æ•°æ®åº“ Cursor çš„åŠæ—¶å…³é—­ã€‚</p></li><li><p>å¯¹äº WebView çš„å†…å­˜æ³„æ¼ï¼Œå¯ä»¥é‡‡å–åº”ç”¨é€€å‡ºæ—¶ç›´æ¥è°ƒç”¨<code>System.exit(0)</code>æ¥è§£å†³ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå¤ªæš´åŠ›ã€‚ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ–°çš„è¿›ç¨‹æ¥åŠ è½½ WebViewï¼Œä½†æ˜¯è¿™å°±æ¶‰åŠåˆ°è¿›ç¨‹é—´é€šä¿¡ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</p></li></ol><h2 id="ä¸‰-æµç•…åº¦"><a href="#ä¸‰-æµç•…åº¦" class="headerlink" title="ä¸‰. æµç•…åº¦"></a>ä¸‰. æµç•…åº¦</h2><p>ä¸€ä¸ª App ç”¨èµ·æ¥æ˜¯å¦ã€æµç•…ã€ï¼Œæœ€å…³é”®çš„è€ƒæ ¸æŒ‡æ ‡å°±æ˜¯ã€æ˜¯å¦å¡é¡¿ã€ã€‚é€ æˆã€å¡é¡¿ã€æ„Ÿè§‰ä¸€èˆ¬åŸå› æ˜¯ç”¨æˆ·çš„è¾“å…¥æ— æ³•å¾—åˆ°åŠæ—¶å“åº”ï¼Œæ¯”å¦‚æ»‘åŠ¨æ—¶åˆ—è¡¨ä¸æµç•…ã€é¡µé¢è·³è½¬åˆ‡æ¢ä¸æµç•…ã€äº‹ä»¶å“åº”ä¸åŠæ—¶ç­‰ç­‰ã€‚Android ä¸­æœ‰ <strong>VSYNC</strong> æœºåˆ¶ï¼Œå®ƒæ¯éš”<strong>16ms</strong>å°±å‘å‡º VSYNC ä¿¡å·ï¼Œè§¦å‘å¯¹ UI çš„æ¸²æŸ“ï¼Œå¦‚æœæ¯æ¬¡éƒ½æ¸²æŸ“æˆåŠŸï¼Œåˆ™èƒ½è¾¾åˆ°å¦‚ä¸èˆ¬é¡ºæ»‘çš„ 60 å¸§æ•ˆæœï¼ˆ1ç§’=1000æ¯«ç§’ï¼Œ1000 / 16 = 62.5ï¼‰ã€‚å¦‚æœæŸä¸ªæ“ä½œèŠ±è´¹æ—¶é—´<strong>è¶…è¿‡ 24ms</strong>ï¼Œé‚£æ”¶åˆ° VSYNC ä¿¡å·æ—¶å°±æ— æ³•æ­£å¸¸æ¸²æŸ“ï¼Œå°±ä¼šå¯¼è‡´ã€ä¸¢å¸§ã€ç°è±¡å‡ºç°ã€‚</p><p>ä½†è¿™äº›åŸå› åŸºæœ¬ä¸Šéƒ½å¯ä»¥å½’ç»“ä¸ºä»¥ä¸‹ä¸¤ç±»ä¼˜åŒ–å±‚é¢ï¼š</p><ol><li>ç•Œé¢ç»˜åˆ¶é—®é¢˜</li><li>æ•°æ®å¤„ç†é—®é¢˜</li></ol><h3 id="1-ç•Œé¢ç»˜åˆ¶é—®é¢˜"><a href="#1-ç•Œé¢ç»˜åˆ¶é—®é¢˜" class="headerlink" title="1. ç•Œé¢ç»˜åˆ¶é—®é¢˜"></a>1. ç•Œé¢ç»˜åˆ¶é—®é¢˜</h3><p>è¿™ç§é—®é¢˜ä¸€èˆ¬æ˜¯ç”±äº <strong>UI å¸ƒå±€å¤ªå¤æ‚ï¼ŒåµŒå¥—å±‚çº§æ¯”è¾ƒæ·±ï¼Œåˆ·æ–°æœºåˆ¶ä¸åˆç†</strong>å¯¼è‡´çš„ã€‚æˆ‘ä»¬çŸ¥é“ Android çš„ç»˜åˆ¶éœ€è¦ç»è¿‡ measureã€layoutã€draw ä¸‰ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥å¸ƒå±€çš„å±‚çº§è¶Šæ·±ã€å…ƒç´ è¶Šå¤šã€è€—æ—¶ä¹Ÿå°±è¶Šé•¿ã€‚</p><p>é’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œä¸€èˆ¬ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><ul><li><p><strong>å¸ƒå±€ä¼˜åŒ–</strong>ï¼š</p><ul><li>å‡å°‘ View å±‚çº§ï¼Œä¼˜åŒ– xml å¸ƒå±€æ–‡ä»¶ï¼›</li><li>å¤šä½¿ç”¨<code>&lt;inclue&gt;</code>æ ‡ç­¾é‡ç”¨ layoutï¼›</li><li>ä½¿ç”¨<code>&lt;merge&gt;</code>æ ‡ç­¾æ›¿æ¢çˆ¶çº§å¸ƒå±€ï¼›</li><li>ä½¿ç”¨ ViewStub å»¶è¿Ÿ View çš„åŠ è½½ï¼›</li><li>åˆ é™¤æ— ç”¨å±æ€§ç­‰ã€‚</li></ul><p> æ›´å¤šå¸ƒå±€ä¼˜åŒ–å‚è§<a href="/layout-optimization/">è¿™ç¯‡æ–‡ç« </a></p></li><li><p><strong>æ¸²æŸ“ä¼˜åŒ–</strong>ï¼š</p><ul><li>å‡å°‘ Overdraw ç°è±¡ï¼Œå¤šä¸ªé‡å çš„ View æ³¨æ„èƒŒæ™¯çš„å¤šæ¬¡ç»˜åˆ¶é—®é¢˜ï¼›</li><li>è‡ªå®šä¹‰ View ä¸­ï¼Œä½¿ç”¨<code>canvas.clipRect()</code><strong>å¸®åŠ©ç³»ç»Ÿè¯†åˆ«å¯è§åŒºåŸŸ</strong>ï¼Œåªæœ‰åœ¨è¿™ä¸ªåŒºåŸŸå†…æ‰ä¼šè¢«ç»˜åˆ¶ã€‚</li></ul></li><li><p><strong>å¯åŠ¨ä¼˜åŒ–</strong>ï¼š</p><ul><li>ä¼˜åŒ–é—ªå±é¡µå¸ƒå±€</li><li>ä¼˜åŒ–å¯åŠ¨é€»è¾‘ï¼Œå¯ä»¥é‡‡ç”¨åˆ†æ­¥åŠ è½½ã€å»¶è¿ŸåŠ è½½ç­‰æ–¹æ³•æé«˜åº”ç”¨å¯åŠ¨é€Ÿåº¦</li></ul></li><li><p><strong>åŠ¨ç”»æ•ˆæœä¼˜åŒ–</strong>ï¼š</p><p>å¥½çš„åŠ¨ç”»æ•ˆæœå¯ä»¥è®©ç”¨æˆ·æ„Ÿè§‰ä¸é‚£ä¹ˆã€å¡é¡¿ã€ï¼Œåœ¨åˆé€‚çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯ç”¨ã€ç¡¬ä»¶åŠ é€Ÿã€æ¥å¸®åŠ©ç»˜åˆ¶åŠ¨ç”»æ•ˆæœã€‚</p></li></ul><h3 id="2-æ•°æ®å¤„ç†é—®é¢˜"><a href="#2-æ•°æ®å¤„ç†é—®é¢˜" class="headerlink" title="2. æ•°æ®å¤„ç†é—®é¢˜"></a>2. æ•°æ®å¤„ç†é—®é¢˜</h3><p>äº§ç”Ÿè¿™ç§é—®é¢˜ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ol><li>åœ¨ä¸»çº¿ç¨‹å¤„ç†æ•°æ®ã€‚è¦å°½é‡é¿å…è¿™æ ·åšï¼Œä¸»çº¿ç¨‹å°½é‡åªç”¨æ¥ç»˜åˆ¶å’Œå¤„ç† UI å±‚é¢çš„ä¸œè¥¿ã€‚</li><li>æ•°æ®å¤„ç†å ç”¨äº†å¤ªå¤š CPUã€‚å³ä¾¿ä½¿ç”¨äº†æ–°çº¿ç¨‹å»å¤„ç†æ•°æ®ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ä¸»çº¿ç¨‹æ— æ³•æŠ¢å åˆ° CPUï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘å¤šä¸ªçº¿ç¨‹å¤„ç†ï¼Œæˆ–è€…åˆ†æ—¶ã€åˆ†æ®µå¤„ç†ã€‚</li><li>å†…å­˜é¢‘ç¹ GC å¼•èµ·å¡é¡¿ã€‚ä¸è¦åšå¼•èµ·é¢‘ç¹ GC çš„æ“ä½œï¼Œå¦‚ä½¿ç”¨å¤§é‡ä¸´æ—¶å˜é‡ç­‰ã€‚</li></ol><h2 id="å››-èµ„æºæ¶ˆè€—"><a href="#å››-èµ„æºæ¶ˆè€—" class="headerlink" title="å››. èµ„æºæ¶ˆè€—"></a>å››. èµ„æºæ¶ˆè€—</h2><p>èµ„æºçš„æ¶ˆè€—å¯ä»¥ä»ä¸‰ä¸ªè§’åº¦æ¥ä¼˜åŒ–ï¼š</p><h3 id="1-ç½‘ç»œæµé‡ä¼˜åŒ–"><a href="#1-ç½‘ç»œæµé‡ä¼˜åŒ–" class="headerlink" title="1. ç½‘ç»œæµé‡ä¼˜åŒ–"></a>1. ç½‘ç»œæµé‡ä¼˜åŒ–</h3><p>è™½ç„¶ç°åœ¨å¤§å®¶éƒ½ä¸å·®æµé‡ï¼Œä½†æ˜¯å¦‚æœæµé‡å¤ªå¤šï¼Œè¿˜æ˜¯ä¼šå¼•èµ·ç”¨æˆ·çš„åæ„Ÿã€‚é’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä»è¿™ä¸¤ä¸ªå±‚é¢æ¥ç€æ‰‹ä¼˜åŒ–ï¼š</p><ul><li><strong>å›¾ç‰‡ç½‘ç»œä¼˜åŒ–</strong>ï¼šå›¾ç‰‡å¯ä»¥è¿›è¡Œåˆ†ç±»ï¼Œä¸€ç§æ˜¯é«˜æ¸…å›¾ï¼ˆåŸå›¾ï¼‰ï¼Œä¸€ç§æ˜¯å‹ç¼©å›¾ï¼Œè¿˜æœ‰ç¼©ç•¥å›¾ã€‚åœ¨ä¸åŒçš„æƒ…å†µä¸‹å¼•ç”¨ä¸åŒç‰ˆæœ¬çš„å›¾ç‰‡ï¼Œå¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç¼“è§£ç½‘ç»œæµé‡å¤§çš„é—®é¢˜ã€‚æ¯”å¦‚åœ¨ ListView ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨ç¼©ç•¥å›¾ï¼Œå½“è¿›å…¥è¯¦æƒ…é¡µæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‹ç¼©å›¾ï¼Œå½“ç‚¹å‡»å›¾ç‰‡æ—¶ï¼Œå†ä½¿ç”¨åŸå›¾ã€‚è¿˜æœ‰ï¼Œå¯ä»¥åˆ¤æ–­å½“å‰ç½‘ç»œï¼Œå¦‚æœç½‘ç»œæ˜¯ Wifiï¼Œé‚£å¯ä»¥ä½¿ç”¨åŸå›¾æˆ–å‹ç¼©å›¾ï¼Œå¦‚æœå½“å‰æ˜¯3g/4gï¼Œåˆ™è¦è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦ä½¿ç”¨åŸå›¾/å‹ç¼©å›¾ã€‚</li><li><strong>ç½‘ç»œè¯·æ±‚ä¼˜åŒ–</strong>ï¼š<strong>è¿æ¥å¤ç”¨ã€åˆå¹¶è¯·æ±‚ã€å‹ç¼©è¯·æ±‚</strong>éƒ½æ˜¯æ¯”è¾ƒåˆç†çš„æ‰‹æ®µã€‚</li></ul><h3 id="2-ç”µé‡æ¶ˆè€—ä¼˜åŒ–"><a href="#2-ç”µé‡æ¶ˆè€—ä¼˜åŒ–" class="headerlink" title="2. ç”µé‡æ¶ˆè€—ä¼˜åŒ–"></a>2. ç”µé‡æ¶ˆè€—ä¼˜åŒ–</h3><p>åœ¨æ‰‹æœºç”µæ± å®¹é‡å·²ç»å‘å±•åˆ° 4000mAh çš„ä»Šå¤©ï¼Œç”µé‡ä¾æ—§æ˜¯è€ƒé‡æ‰‹æœºæ˜¯å¦å¼ºåŠ²çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚å¯¹äº App æ¥è¯´ï¼Œè€—ç”µä¼˜åŒ–æ˜¯ä¸ä¼šåœæ­¢çš„è¿½æ±‚ï¼Œã€ç”µæ± ç»ˆç»“è€…ã€æœ€ç»ˆçš„ä¸‹åœºå°±æ˜¯è¢«å¸è½½ã€‚</p><p>åœ¨ Android 5.0 ä¹‹åï¼Œå¼•å…¥äº†ä¸€ä¸ªè·å–è®¾å¤‡ç”µé‡æ¶ˆè€—çš„ API â€”â€” Battery Historianï¼Œå¯ä»¥é€šè¿‡å›¾å½¢åŒ–æ•°æ®åˆ†æï¼Œç›´è§‚åœ°å±•ç¤ºæ‰‹æœºçš„ç”µé‡æ¶ˆè€—è¿‡ç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…å®šä½ç”µé‡æ¶ˆè€—çš„æºå¤´ã€‚</p><p>æˆ‘ä»¬èƒ½åšçš„ï¼Œé™¤äº†ä½¿ç”¨ Battery Historian ä¹‹å¤–ï¼Œä¹Ÿè¦å°‘ä½¿ç”¨é•¿æ—¶é—´å ç”¨åå°çš„ Serviceï¼Œå‡å°‘ UI ç»˜åˆ¶çš„å¤æ‚åº¦ï¼Œå°½é‡ä¸è¦æœ‰æ­»å¾ªç¯ä»¥åŠæœ‰å¯èƒ½å¤§é‡ä½¿ç”¨ CPU çš„è¡Œä¸ºã€‚</p><h2 id="äº”-å®‰è£…åŒ…å¤§å°"><a href="#äº”-å®‰è£…åŒ…å¤§å°" class="headerlink" title="äº”. å®‰è£…åŒ…å¤§å°"></a>äº”. å®‰è£…åŒ…å¤§å°</h2><p>å®‰è£…åŒ…çš„å¤§å°ç›´æ¥å¯¼è‡´ç”¨æˆ·æ˜¯å¦ä¼šé€‰æ‹©ä¸‹è½½ä½ è¿™ä¸ªåº”ç”¨ï¼ˆå½“å‰ï¼Œå¦‚æœä½ çš„åº”ç”¨æ˜¯ã€æ‰‹æœºå¿…å¤‡ã€çš„ï¼Œå¯ä»¥å¦è°ˆğŸ¥´ï¼‰ã€‚å¦ä¸€ä¸ªç›´è§‚çš„å½±å“å°±æ˜¯åº”ç”¨çš„å®‰è£…æ—¶é—´ï¼Œè¶Šå¤§çš„åŒ…ï¼Œå®‰è£…æ—¶é—´ä¼šè¶Šé•¿ã€‚å°¤å…¶æ˜¯åœ¨ Android 5.0 ä¹‹åå¼•å…¥äº† ART æ¨¡å¼ï¼Œç”±äºåœ¨å®‰è£…æ—¶ä¼šæŠŠç¨‹åºä»£ç è½¬æ¢æˆæœºå™¨è¯­è¨€ï¼Œå®‰è£…æ—¶é—´ä¼šå˜é•¿ã€‚æ‰€ä»¥è¯´ï¼Œå®‰è£…åŒ…çš„å¤§å°æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é—¨æ§›ï¼Œè¿™ç›´æ¥å…³ä¹åˆ°ç”¨æˆ·çš„ä½¿ç”¨æ„æ„¿ã€‚</p><p>åœ¨ Android Studio ä¸­ï¼Œä½¿ç”¨ Apk Analyzer å¯ä»¥å±•ç¤º Apk åŒ…ä¸­æ¯ä¸€ä¸ªæ–‡ä»¶çš„ç©ºé—´å ç”¨æƒ…å†µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/img/android-op-1589181336.png"></p><p>å¯è§ï¼Œæœ€ä¸»è¦å ç”¨ç©ºé—´çš„ï¼Œæ˜¯ dex æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶ï¼ˆåŒ…æ‹¬ resã€assets ç­‰ï¼‰ã€‚é€šå¸¸æˆ‘ä»¬ä¼šé‡‡ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼ä¼˜åŒ– Apk çš„ä½“ç§¯ï¼š</p><ol><li><strong>ä»£ç æ··æ·†</strong>ï¼šé€šè¿‡ proguard æ¥å®ç°ï¼Œå®ƒå¯ä»¥åœ¨æ‰“åŒ…é˜¶æ®µå‹ç¼©ä»£ç ã€ä¼˜åŒ–æ— ç”¨ä»£ç ã€æ··æ·†ç±»åç­‰ç­‰ã€‚</li><li><strong>èµ„æºä¼˜åŒ–</strong>ï¼šä½¿ç”¨ Android Lint æ‰«æå†—ä½™èµ„æºï¼Œå°†æ–‡ä»¶æœ€åŒ–ï¼›åŒæ—¶åˆç†åˆ†é… drawable çš„è·¯å¾„ï¼Œå¯¹ä¸åˆé€‚çš„ drawable è¿›è¡Œåˆ é™¤ï¼›ç§»é™¤ä¸å¿…è¦çš„å­—ç¬¦ä¸²èµ„æºç­‰ã€‚</li><li><strong>å›¾ç‰‡ä¼˜åŒ–</strong>ï¼šå¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œæˆ–è€…ä½¿ç”¨ webp ç­‰æ ¼å¼æ¥æ›¿æ¢ã€‚</li><li><strong>æ’ä»¶åŒ–</strong>ï¼šå°†åŠŸèƒ½æ¨¡å—åˆ†ç¦»å®¿ä¸» Apkï¼Œå¯ä»¥å¤§å¤§å‡å°‘ Apk çš„ä½“ç§¯ã€‚</li></ol><p><a href="https://juejin.im/post/5e69a4fd51882549003d2f0e">å†çœ‹çœ‹è¿™ç¯‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Activityå››å¤§å¯åŠ¨æ¨¡å¼è§£æ</title>
      <link href="/2020-04-22/activity-launchmode/"/>
      <url>/2020-04-22/activity-launchmode/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Š Activity çš„å››ç§å¯åŠ¨æ¨¡å¼ã€‚</p><span id="more"></span><h1 id="Activityçš„å››ç§å¯åŠ¨æ¨¡å¼"><a href="#Activityçš„å››ç§å¯åŠ¨æ¨¡å¼" class="headerlink" title="Activityçš„å››ç§å¯åŠ¨æ¨¡å¼"></a>Activityçš„å››ç§å¯åŠ¨æ¨¡å¼</h1><p>å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul><li>standard</li><li>singleTop</li><li>singleTask</li><li>singleInstance</li></ul><p>ä¸‹é¢æ¥åˆ†åˆ«åšä»‹ç»ã€‚</p><p>è¿™äº›æ¨¡å¼å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼šstandardå’ŒsingleTopä¸ºä¸€ç±»ï¼ŒsingleTaskå’ŒsingleInstanceä¸ºå¦ä¸€ç±»ã€‚</p><p>ä½¿ç”¨standardæˆ–singleTopå¯åŠ¨æ¨¡å¼çš„ Activity å¯å¤šæ¬¡è¿›è¡Œå®ä¾‹åŒ–ã€‚å®ä¾‹å¯å½’å±ä»»ä½•ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä½äº Activity å †æ ˆä¸­çš„ä»»ä½•ä½ç½®ã€‚é€šå¸¸ï¼Œå®ƒä»¬ä¼šå¯åŠ¨åˆ°åä¸º <code>startActivity()</code>çš„ä»»åŠ¡ä¸­ï¼ˆé™¤é Intent å¯¹è±¡åŒ…å« FLAG_ACTIVITY_NEW_TASK æŒ‡ä»¤ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ä¼šé€‰æ‹©å…¶ä»–ä»»åŠ¡ â€” è¯·å‚é˜… taskAffinityå±æ€§ï¼‰ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒsingleTaskå’ŒsingleInstanceåªèƒ½å¯åŠ¨ä»»åŠ¡ã€‚å®ƒä»¬å§‹ç»ˆä½äº Activity å †æ ˆçš„æ ¹ä½ç½®ã€‚æ­¤å¤–ï¼Œè®¾å¤‡ä¸€æ¬¡åªèƒ½ä¿ç•™ä¸€ä¸ª Activity å®ä¾‹ï¼Œå³ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ­¤ç±»ä»»åŠ¡ã€‚</p><h2 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h2><p>é¡¾åæ€ä¹‰ï¼Œstandardè‹±æ–‡æ„æ€å°±æ˜¯ã€æ ‡å‡†çš„ã€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´è¿™ç§å¯åŠ¨æ¨¡å¼æ˜¯é»˜è®¤çš„ï¼Œæˆ‘ä»¬å¹³æ—¶åœ¨å¼€å‘ä¸­ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯standardæ¨¡å¼çš„ã€‚</p><p>å¦‚æœä¸€ä¸ªActivityçš„å¯åŠ¨æ¨¡å¼è¢«è®¾ç½®æˆstandardï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ— é™åˆ¶çš„åˆ›å»ºã€‚ä½ æ¯ä¸€æ¬¡é€šè¿‡Intentå»å¯åŠ¨è¿™ç§æ¨¡å¼çš„Activityéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªã€‚</p><p>å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹é‚®ç®±é‡Œçš„æ”¶ä»¶ç®±ï¼ˆå‡è®¾æˆ‘ä»¬å°†æ‰“å¼€é‚®ä»¶çš„Activityçš„å¯åŠ¨æ¨¡å¼è®¾ç½®ä¸ºStandardï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼ï¼‰é‡Œæœ‰10å°é‚®ä»¶ã€‚æˆ‘ä»¬ç»™æŸ¥çœ‹é‚®ä»¶çš„Activityèµ·åä¸ºCheckEmailActivity,æˆ‘ç‚¹å‡»ç¬¬ä¸€å°é‚®ä»¶å°†ä¼šæ‰“å¼€ä¸€ä¸ªCheckEmailActivityï¼Œå½“æˆ‘çœ‹å®Œä¹‹åç‚¹å‡»ä¸‹ä¸€å°é‚®ä»¶ï¼Œå¦ä¸€ä¸ªCheckEmailActivityåˆä¼šè¢«åˆ›å»ºï¼Œè¿™æ ·å¦‚æœæˆ‘ä»¬å°†10å°é‚®ä»¶å…¨éƒ¨çœ‹å®Œï¼Œé‚£åœ¨Activityä»»åŠ¡æ ˆä¸­å°†ä¼šæœ‰10ä¸ªCheckEmailActivityï¼Œè€Œä¸”å¦‚æœæˆ‘æƒ³å›åˆ°æ”¶ä»¶ç®±é¡µé¢è¿˜å¿…é¡»ç‚¹10æ¬¡è¿”å›é”®ï¼æƒ³æƒ³æ˜¯ä¸æ˜¯å¾ˆå¯æ€•ï¼Ÿ</p><p>æ‰€ä»¥è¯´standardæ¨¡å¼è™½ç„¶å¾ˆå¸¸ç”¨ï¼Œä½†ä¹Ÿä¸æ˜¯é€‚ç”¨äºä»»ä½•åœºåˆã€‚</p><p>å¦å¤–è¯´ä¸€ç‚¹ï¼Œstandardæ¨¡å¼åœ¨Android 5.0ï¼ˆLollipopï¼‰ä¹‹å‰å’Œä¹‹åæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><h3 id="Android-Lollipopä¹‹å‰"><a href="#Android-Lollipopä¹‹å‰" class="headerlink" title="Android Lollipopä¹‹å‰"></a>Android Lollipopä¹‹å‰</h3><p>standardæ¨¡å¼çš„Activityæ€»æ˜¯ä¼šè¢«åˆ›å»ºåœ¨å¯åŠ¨å®ƒçš„ActivityåŒä¸€ä¸ªä»»åŠ¡æ ˆä¸­é¡¶ç«¯ï¼ˆä»»åŠ¡æ ˆæ˜¯ä¸€ä¸ªæ ˆç»“æ„ï¼Œå…ˆè¿›åå‡º First In Last Outï¼‰ï¼Œå°±ç®—ä»–ä»¬æ¥è‡ªä¸åŒçš„åº”ç”¨ã€‚</p><p>æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä½ åœ¨Aåº”ç”¨ä¸­è¦åˆ†äº«ä¸€ä¸ªæœ¬åœ°å›¾ç‰‡ï¼Œè¿™æ ·ä¼šæ‰“å¼€ç³»ç»Ÿçš„å›¾ç‰‡æŸ¥çœ‹åº”ç”¨ä¸­çš„å›¾ç‰‡é€‰æ‹©å™¨Activityï¼Œè™½ç„¶è¿™ä¸¤ä¸ªActivityæ¥è‡ªä¸åŒçš„åº”ç”¨ï¼Œä½†Androidç³»ç»Ÿä»å°†ä¼šæŠŠä»–ä»¬æ”¾åœ¨åŒä¸€ä¸ªä»»åŠ¡æ ˆä¸­ï¼Œå³Aåº”ç”¨çš„ä»»åŠ¡æ ˆä¸­ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/16.png" alt="webp"></p><h3 id="Android-Lollipopä¹‹å"><a href="#Android-Lollipopä¹‹å" class="headerlink" title="Android Lollipopä¹‹å"></a>Android Lollipopä¹‹å</h3><p>å¦‚æœå°†è¦å¯åŠ¨çš„Activityå’Œå¯åŠ¨å®ƒçš„Activityæ¥è‡ªåŒä¸€ä¸ªåº”ç”¨ï¼Œé‚£æ²¡è¯è¯´ï¼Œå’ŒLollipopä¹‹å‰ä¸€æ ·ï¼Œæ–°çš„Activityä¼šè¢«åˆ›å»ºåœ¨å½“å‰ä»»åŠ¡æ ˆä¸­çš„é¡¶ç«¯ã€‚</p><p>ä½†æ˜¯å¦‚æœå®ƒä»¬æ¥è‡ªä¸åŒçš„åº”ç”¨ï¼Œé‚£å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡æ ˆï¼Œå†æŠŠè¦å¯åŠ¨çš„Activityæ”¾åœ¨æ–°çš„ä»»åŠ¡æ ˆä¸­ï¼Œè¿™æ—¶è¿™ä¸ªæ–°å¯åŠ¨çš„Activityå°±æ˜¯æ–°åˆ›å»ºçš„ä»»åŠ¡ç«™ç‚¹çš„æ ¹Activityã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/17.png" alt="webp"></p><h2 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h2><p>é¡¾åæ€ä¹‰ï¼ŒsingleTopçš„æ„æ€å°±æ˜¯ã€åœ¨é¡¶éƒ¨åªèƒ½æœ‰ä¸€ä¸ªã€ï¼Œä¹Ÿå³ã€æ ˆé¡¶å¤ç”¨ã€ã€‚</p><p>è¿™ç§å¯åŠ¨æ¨¡å¼éå¸¸ç±»ä¼¼äºstandardï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›åŒºåˆ«ï¼š</p><p>å¦‚æœåœ¨å¯åŠ¨è¿™ç§æ¨¡å¼çš„Activityçš„æ—¶å€™ï¼Œå½“å‰ä»»åŠ¡æ ˆçš„é¡¶ç«¯å·²ç»å­˜åœ¨äº†ç›¸åŒçš„Activityï¼Œé‚£ç³»ç»Ÿå°±ä¸ä¼šå†åˆ›å»ºæ–°çš„ï¼Œè€Œæ˜¯å›è°ƒä»»åŠ¡æ ˆä¸­å·²ç»å­˜åœ¨çš„è¯¥Activityçš„<code>onNewIntent()</code>æ–¹æ³•ã€‚è¯·çœ‹ä¸‹é¢çš„ç¤ºæ„å›¾ï¼š</p><p><img src="/img/18.png" alt="webp"></p><p>ä¹Ÿæ­£å› ä¸ºsingleTopå¯åŠ¨æ¨¡å¼çš„ç‰¹æ®Šæ€§ï¼Œæ‰€ä»¥åœ¨å¼€å‘æ—¶ï¼Œå¦‚æœæŒ‡å®šäº†ä¸€ä¸ªActivityçš„å¯åŠ¨æ¨¡å¼æ˜¯singleTopçš„é‚£å°±åº”è¯¥æ—¢è¦é‡å†™<code>onCreated()</code>æ–¹æ³•ç”¨äºåº”å¯¹ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æƒ…å†µï¼Œä¹Ÿè¦é‡å†™<code>onNewIntent()</code>æ–¹æ³•æ¥åº”å¯¹é‡å¤åˆ›å»ºçš„æƒ…å†µã€‚</p><p>å…¶å®å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œè¿™ç§å¯åŠ¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ã€‚Androidæ—¢ç„¶æä¾›äº†è¿™ç§å¯åŠ¨æ¨¡å¼ï¼Œè¯´æ˜è‚¯å®šæœ‰åº”æœ‰åœºæ™¯éœ€è¦è¿™æ ·çš„æ–¹å¼ã€‚å…¶å®æœ€å¸¸ç”¨çš„åœºæ™¯å°±æ˜¯æœç´¢ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æƒ³è¦æœç´¢çš„å†…å®¹ç‚¹å‡»æœç´¢è¿›å…¥SearchResultActivtyæŸ¥çœ‹æœç´¢çš„ç»“æœï¼ˆä¸€èˆ¬æˆ‘ä»¬ä¹Ÿä¼šåœ¨æœç´¢ç»“æœé¡µæä¾›æœç´¢æ¡†ï¼Œè¿™æ ·ç”¨æˆ·æ— éœ€ç‚¹å‡»è¿”å›é”®å›åˆ°ä¸Šä¸€ä¸ªé¡µé¢å†åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æœç´¢å†…å®¹ç‚¹å‡»æœç´¢ï¼‰ï¼Œå¦‚æœæ­¤æ—¶ç”¨æˆ·è¿˜æƒ³æœç‚¹åˆ«çš„ä¸œè¥¿ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨å½“å‰çš„æœç´¢ç»“æœé¡µSearchResultActivtyä¸­çš„æœç´¢æ¡†è¾“å…¥æœç´¢å†…å®¹ç»§ç»­æœç´¢ã€‚</p><p>å¤§å®¶æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠSearchResultActivtyçš„å¯åŠ¨æ¨¡å¼è®¾ç½®ä¸ºStandardçš„è¯ä¼šæ˜¯ä»€ä¹ˆæ ·çš„æ™¯è±¡ã€‚æ¯”å¦‚æˆ‘ä»¬è¿ç€æœäº†10ä¸ªå†…å®¹ï¼Œé‚£å°±ä¼šå¯åŠ¨10ä¸ªä¸åŒçš„SearchResultActivtyï¼Œç„¶è€Œè¿™äº›SearchResultActivtyåŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åˆ›å»ºè¿™ä¹ˆå¤šï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªå’Œä¸Šä¸€èŠ‚ä¸­çš„é‚®ç®±ä¸€æ ·çš„é—®é¢˜ï¼Œå°±æ˜¯ç”¨æˆ·æœç´¢ç»“æŸæƒ³å›åˆ°é¦–é¡µï¼Œé‚£å°±è¿˜å¾—æŒ‰10æ¬¡è¿”å›é”®æ‰èƒ½å›åˆ°é¦–é¡µï¼Œ- -ï¼</p><p>è¿™æ—¶ï¼ŒsingleTopå¯åŠ¨æ¨¡å¼å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œæˆ‘ä»¬é¦–å…ˆæŠŠSearchResultActivtyçš„å¯åŠ¨æ¨¡å¼è®¾ç½®ä¸ºsingleTopï¼Œè¿™æ ·ç”¨æˆ·åœ¨SearchResultActivtyé¡µé¢ä¸­ç»§ç»­æœç´¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€æŠŠç”¨æˆ·è¦æœç´¢çš„å†…å®¹æ”¾åœ¨Intenté‡Œé¢ç„¶åå¯åŠ¨SearchResultActivtyï¼Œè¿™æ—¶ç³»ç»Ÿå¹¶ä¸ä¼šé‡æ–°åˆ›å»ºæ–°çš„SearchResultActivtyï¼Œè€Œæ˜¯å›è°ƒå½“å‰ä»»åŠ¡æ ˆæ ˆé¡¶çš„SearchResultActivtyçš„<code>onNewIntent()</code>æ–¹æ³•æ¥æ¥æ”¶å¸¦æœ‰ç”¨æˆ·æœç´¢å†…å®¹ä¿¡æ¯çš„Intentï¼Œç„¶åæˆ‘ä»¬æ‹¿åˆ°ç”¨æˆ·æœç´¢å†…å®¹åè°ƒæœç´¢æ¥å£ï¼Œå¹¶æ ¹æ®æ¥å£è¿”å›å†…å®¹é‡æ–°åˆ·æ–°å¸ƒå±€å³å¯ï¼Œä¼¼ä¸ä¼¼å¾ˆç¥å¥‡ï¼Ÿå…¶å®æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚æåˆ°çš„é‚®ç®±çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³çš„ï¼ŒåŸç†å’Œæœç´¢ä¸€æ ·çš„ã€‚</p><p>è¿˜æœ‰æ¯”è¾ƒå¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯IMåº”ç”¨çš„èŠå¤©ç•Œé¢ï¼Œæ¶ˆæ¯è¢«æ¨é€è¿‡æ¥ä¹‹åï¼Œå°±ä¼šä»¥singleTopçš„æ–¹å¼æ¥å¯åŠ¨è¯¥Activityï¼Œå¹¶åœ¨<code>onNewIntent()</code>ä¸­å¤„ç†æ•°æ®å°±å¯ä»¥äº†ã€‚</p><blockquote><p>â€œstandardâ€å’Œâ€œsingleTopâ€æ¨¡å¼åªæœ‰ä¸€å¤„ä¸åŒï¼šæ¯æ¬¡â€œstandardâ€Activity æœ‰æ–°çš„ Intent æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šåˆ›å»ºæ–°çš„ç±»å®ä¾‹æ¥å“åº”è¯¥ Intentã€‚æ¯ä¸ªå®ä¾‹å¤„ç†å•ä¸ª Intentã€‚åŒæ ·åœ°ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„â€œsingleTopâ€Activity å®ä¾‹æ¥å¤„ç†æ–°çš„ Intentã€‚ä¸è¿‡ï¼Œå¦‚æœç›®æ ‡ä»»åŠ¡çš„ Activity å †æ ˆé¡¶éƒ¨å·²æœ‰ä¸€ä¸ª Activity å®ä¾‹ï¼Œåˆ™è¯¥å®ä¾‹ä¼šï¼ˆé€šè¿‡è°ƒç”¨ onNewIntent()ï¼‰æ¥æ”¶æ–°çš„ Intentï¼›æ­¤æ—¶ä¸ä¼šåˆ›å»ºæ–°å®ä¾‹ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœâ€œsingleTopâ€Activity çš„æŸä¸ªç°æœ‰å®ä¾‹è™½åœ¨ç›®æ ‡ä»»åŠ¡å†…ï¼Œä½†æœªå¤„äºå †æ ˆé¡¶éƒ¨ï¼Œæˆ–è€…è™½ç„¶ä½äºå †æ ˆé¡¶éƒ¨ï¼Œä½†ä¸åœ¨ç›®æ ‡ä»»åŠ¡ä¸­ï¼‰ï¼Œç³»ç»Ÿä¼šåˆ›å»ºæ–°å®ä¾‹å¹¶å°†å…¶é€å…¥å †æ ˆã€‚</p></blockquote><h2 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h2><p>è¿™ç§å¯åŠ¨æ¨¡å¼çš„Activityåœ¨Androidç³»ç»Ÿä¸­åªå…è®¸å­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚</p><p>å¦‚æœç³»ç»Ÿä¸­å·²ç»å­˜åœ¨äº†è¯¥ç§å¯åŠ¨æ¨¡å¼çš„ç›®æ ‡Activityï¼Œåˆ™ç³»ç»Ÿå¹¶ä¸ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªç›®æ ‡Activityï¼Œè€Œæ˜¯é¦–å…ˆå°†æŒæœ‰ç›®æ ‡Activityçš„æ•´ä¸ªä»»åŠ¡æ ˆéƒ½ä¼šè¢«ç½®äºå‰å°ï¼ˆç”¨æˆ·å¯è§ï¼‰ï¼Œå¹¶ä¸”é€šè¿‡<code>onNewIntent()</code>æ–¹æ³•å°†å¯åŠ¨ç›®æ ‡Activityçš„Intentä¼ é€’ç»™ç›®æ ‡Activityï¼Œç½®äºç›®æ ‡Activityæ‹¿åˆ°è¿™ä¸ªIntentä¹‹åè¦åšä»€ä¹ˆæ“ä½œï¼Œç³»ç»Ÿå°±ä¸ç®¡äº†ï¼Œéšä¾¿ä½ æ‹¿æ¥å¹²ä»€ä¹ˆã€‚</p><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç›®æ ‡Activityå’ŒæºActivityæ˜¯ä¸æ˜¯æ¥è‡ªåŒä¸€åº”ç”¨ã€‚</p><ul><li><p>æºActivityå’Œç›®æ ‡Activityæ¥è‡ª<strong>åŒä¸€ä¸ªåº”ç”¨</strong></p><p>  è¿™ç§æƒ…å†µè¿˜è¦åˆ†ä¸¤ç§æƒ…å†µè¯´ï¼š</p><ol><li><p>å½“å‰ç³»ç»Ÿä¸­è¿˜æ²¡æœ‰ç›®æ ‡Activityçš„å®ä¾‹ã€‚è¿™ç§æƒ…å†µæœ€ç®€å•ï¼Œç›´æ¥åœ¨å½“å‰çš„ä»»åŠ¡æ ˆä¸­åˆ›å»ºsingleTaskæ¨¡å¼çš„Activityå¹¶ç½®äºæ ˆé¡¶å³å¯ã€‚</p></li><li><p>å½“å‰ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨ç›®æ ‡Activityçš„å®ä¾‹ã€‚è¿™ç§æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºç³»ç»Ÿä¼šæŠŠä»»åŠ¡æ ˆä¸­ç›®æ ‡Activityä¹‹ä¸Šçš„æ‰€æœ‰Activityé”€æ¯ï¼Œä»¥è®©ç›®æ ‡Activityå¤„åœ¨æ ˆé¡¶çš„ä½ç½®ã€‚</p></li></ol><p>  è¿™é‡Œè¿˜è¦è¿˜è¦å†æé†’å¤§å®¶çš„æ˜¯ï¼Œå› ä¸ºç›®æ ‡Activityå·²ç»å­˜åœ¨ï¼Œç³»ç»Ÿä¸ä¼šé‡æ–°åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡<code>onNewIntent()</code>çš„æ–¹å¼æŠŠIntentä¼ é€’è¿‡æ¥ï¼Œè¿™ç‚¹å’ŒsingleTopæ¨¡å¼æœ‰äº›ç±»ä¼¼ã€‚æ³¨æ„äº†ï¼Œè¿™é‡Œè®©æˆ‘ä»¬å›æƒ³ä¸€ä¸‹æ–‡ç« å¼€å¤´çš„æˆ‘æ‰€è¯´çš„åœºæ™¯ï¼Œå¦‚ä½•è®©ç”¨æˆ·åœ¨æ”¯ä»˜å®Œæˆé¡µç›´æ¥è·³è½¬åˆ°é¦–é¡µï¼Œå¹¶æŠŠä¸éœ€è¦çš„Activityé”€æ¯ï¼ŸsingleTaskå¯åŠ¨æ¨¡å¼æ˜¯ä¸æ˜¯åˆšå¥½å’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸€è‡´ï¼Ÿè¯·çœ‹ä¸‹é¢çš„ç¤ºæ„å›¾ï¼š</p><p>  <img src="/img/19.png" alt="singleTaskç¤ºä¾‹"></p></li><li><p>æºActivityå’Œç›®æ ‡Activityæ¥è‡ª<strong>ä¸åŒåº”ç”¨</strong></p><p>  è¿™ç§æƒ…å†µä¹Ÿè¦åˆ†ä¸¤ç§æƒ…å†µè¯´ï¼š</p><ol><li>å½“å‰ç³»ç»Ÿä¸­è¿˜æ²¡æœ‰ç›®æ ‡Activityçš„å®ä¾‹ã€‚è¿™æ—¶ç³»ç»Ÿé¦–å…ˆä¼šçœ‹ä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¯å¦æœ‰ç›®æ ‡Actvityæ‰€åœ¨åº”ç”¨çš„ä»»åŠ¡æ ˆï¼Ÿå¦‚æœæœ‰çš„è¯ï¼Œé‚£å°±ç›´æ¥åœ¨ç›®æ ‡Activityæ‰€åœ¨åº”ç”¨çš„ä»»åŠ¡æ ˆçš„æ ˆé¡¶åˆ›å»ºå³å¯ã€‚å¦‚æœä»»åŠ¡ç®¡ç†å™¨ä¸­æ²¡æœ‰ç›®æ ‡Activityæ‰€åœ¨åº”ç”¨çš„ä»»åŠ¡æ ˆï¼Œç³»ç»Ÿå°±ä¼šåˆ›å»ºå…¶æ‰€åœ¨åº”ç”¨çš„ä»»åŠ¡æ ˆå’Œç›®æ ‡Activityï¼Œå¹¶ä¸”æŠŠç›®æ ‡Activityä½œä¸ºæ–°å»ºä»»åŠ¡æ ˆçš„æ ¹Activityã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ol><p>  <img src="/img/20.png" alt="singleTaskç¤ºä¾‹"></p><ol start="2"><li>å½“å‰ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨ç›®æ ‡Activityçš„å®ä¾‹ã€‚ç›®æ ‡Activityæ‰€åœ¨ä»»åŠ¡æ ˆä¼šè¢«ç½®äºå‰å°ï¼ˆå³ç”¨æˆ·å¯è§ï¼‰ï¼Œè€Œä¸”ä¹Ÿä¼šæŠŠç›®æ ‡Activityä¹‹ä¸Šçš„æ‰€æœ‰Actvityå…¨éƒ¨é”€æ¯ã€‚</li></ol></li></ul><p>ä¸Šæ–¹çš„å‡ ç§æƒ…å†µï¼Œå¯ä»¥æ€»ç»“ä¸ºä¸‹é¢çš„æµç¨‹å›¾ï¼š</p><p><img src="/img/21.png"></p><p>singleTaskæ¯”è¾ƒå¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯å½“åº”ç”¨çš„ä¸»é¡µé¢ï¼Œä»å±‚çº§æ¯”è¾ƒæ·±çš„é¡µé¢ï¼ˆå¦‚è®¢å•å®Œæˆé¡µé¢ï¼‰ç›´æ¥è¿”å›ä¸»é¡µçš„æ—¶å€™ï¼Œå°±å¯ä»¥æ¸…é™¤å…¶ä»–çš„Activityï¼Œåªä¿ç•™ä¸»é¡µé¢Activityã€‚</p><h2 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h2><p>è¿™ç§å¯åŠ¨æ¨¡å¼å’ŒsingleTaskå‡ ä¹ä¸€æ ·ï¼Œå®ƒä¹Ÿåªå…è®¸ç³»ç»Ÿä¸­å­˜åœ¨ä¸€ä¸ªç›®æ ‡Activityçš„å®ä¾‹ï¼ŒåŒ…æ‹¬ä¸Šé¢æˆ‘ä»¬æ‰€è¯´çš„singleTaskçš„ä¸€äº›ç‰¹æ€§singleInstanceéƒ½æœ‰ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ï¼ŒæŒæœ‰ç›®æ ‡Activityçš„ä»»åŠ¡æ ˆä¸­åªèƒ½æœ‰ç›®æ ‡Activityä¸€ä¸ªActvitiyï¼Œä¸èƒ½å†æœ‰åˆ«çš„Activityã€‚</p><p>å¯¹ï¼å°±æ˜¯æ‰¿åŒ…äº†è¿™ç‰‡é±¼å¡˜ï¼<img src="/img/doge.png"></p><p>å…¶å®ä»è¿™ç§å¯åŠ¨æ¨¡å¼çš„åå­—ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥å®ƒè¡¨ç¤ºçš„æ„æ€ï¼ŒsingleInstanceç›´è¯‘è¿‡æ¥å°±æ˜¯ã€å•ä¸€å®ä¾‹ã€ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæœ‰ä¸¤å±‚æ„æ€ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p><ol><li>è·Ÿç³»ç»Ÿè¯´ï¼Œã€æˆ‘æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸è®¸å’Œæˆ‘ä¸€æ ·çš„äººå­˜åœ¨ï¼ã€ï¼Œè¿™å°±æ˜¯è¯´ç³»ç»Ÿä¸­å­˜åœ¨ä¸€ä¸ªç›®æ ‡Activityï¼›</li><li>è·Ÿä»»åŠ¡æ ˆè¯´ï¼Œã€æˆ‘æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸è®¸ä½ å¿ƒé‡Œå†è£…åˆ«çš„äººï¼ã€ï¼Œè¿™å°±æ˜¯è¯´æŒæœ‰ç›®æ ‡Activityçš„ä»»åŠ¡æ ˆä¸­åªèƒ½æœ‰ç›®æ ‡Activityä¸€ä¸ªActivityã€‚</li></ol><p>æ‰€ä»¥ï¼Œå¦‚æœè¦å¯åŠ¨singleInstanceæ¨¡å¼çš„Activityï¼Œé‚£åªèƒ½æ–°åˆ›å»ºä¸€ä¸ªä»»åŠ¡æ ˆç”¨æ¥æ”¾å®ƒã€‚åŒæ ·çš„ï¼Œå¦‚æœä»è¿™ç§å¯åŠ¨æ¨¡å¼çš„Activityä¸­å¯åŠ¨åˆ«çš„Activityï¼Œé‚£ä¸å¥½æ„æ€ï¼Œæˆ‘ä¸ç®¡ä½ æ˜¯ä¸æ˜¯å’Œæˆ‘å¤„åœ¨åŒä¸€ä¸ªåº”ç”¨ï¼Œæˆ‘æ‰€åœ¨çš„ä»»åŠ¡æ ˆåªèƒ½æ‹¥æœ‰æˆ‘ä¸€ä¸ªäººï¼Œæ‚¨å‘ï¼Œå¦å¤–è®©ç³»ç»Ÿç»™ä½ åˆ›å»ºä¸€ä¸ªä»»åŠ¡æ ˆå¾…ç€å»å§ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯ç”¨åœ¨æ¯”è¾ƒé¢‘ç¹è°ƒç”¨çš„Activityã€‚æ¯”å¦‚ç³»ç»Ÿæµè§ˆå™¨ï¼Œæ¯”å¦‚é—¹é’Ÿç­‰ã€‚</p><blockquote><p>â€œsingleTaskâ€å’Œâ€œsingleInstanceâ€æ¨¡å¼åŒæ ·åªæœ‰ä¸€å¤„ä¸åŒï¼šâ€œsingleTaskâ€Activity å…è®¸å…¶ä»– Activity æˆä¸ºå…¶ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ Activity å§‹ç»ˆä½äºå…¶ä»»åŠ¡çš„æ ¹ä½ç½®ï¼Œä½†å…¶ä»– Activityï¼ˆå¿…ç„¶æ˜¯â€œstandardâ€å’Œâ€œsingleTopâ€Activityï¼‰å¯ä»¥å¯åŠ¨åˆ°è¯¥ä»»åŠ¡ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œâ€œsingleInstanceâ€Activity ä¸å…è®¸å…¶ä»– Activity æˆä¸ºå…¶ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚å®ƒæ˜¯ä»»åŠ¡ä¸­å”¯ä¸€çš„ Activityã€‚å¦‚æœå®ƒå¯åŠ¨å¦ä¸€ä¸ª Activityï¼Œåˆ™ç³»ç»Ÿä¼šå°†è¯¥ Activity åˆ†é…ç»™å…¶ä»–ä»»åŠ¡ï¼Œå°±å¦‚åŒ Intent ä¸­åŒ…å« FLAG_ACTIVITY_NEW_TASK ä¸€æ ·ã€‚</p></blockquote><p>å¥½äº†ï¼Œè‡³æ­¤æˆ‘ä»¬ä»‹ç»äº†Activityçš„4ç§å¯åŠ¨æ¨¡å¼äº†ï¼Œä¹Ÿå¤§è‡´äº†è§£äº†æ¯ç§å¯åŠ¨æ¨¡å¼çš„ç‰¹ç‚¹äº†ã€‚</p><p>å†å¼•ç”¨ä¸€ä¸‹å®˜ç½‘å¯¹å››ç§å¯åŠ¨æ¨¡å¼çš„è§£é‡Šï¼š</p><table>    <tr>        <th>ç”¨ä¾‹</th>        <th>å¯åŠ¨æ¨¡å¼</th>        <th>å¤šä¸ªå®ä¾‹ï¼Ÿ</th>          <th>æ³¨é‡Š</th>      </tr>    <tr>        <td rowspan="2">å¤§å¤šæ•° Activity çš„æ­£å¸¸å¯åŠ¨</td>        <td>standard</td>        <td>æ˜¯</td>        <td>é»˜è®¤ã€‚ç³»ç»Ÿå§‹ç»ˆä¼šåœ¨ç›®æ ‡ä»»åŠ¡ä¸­åˆ›å»ºæ–°çš„ Activity å®ä¾‹ï¼Œå¹¶å‘å…¶ä¼ é€ Intentã€‚</td>    </tr>    <tr>        <td>singleTop</td>        <td>è§†æƒ…å†µè€Œå®š</td>        <td>å¦‚æœç›®æ ‡ä»»åŠ¡çš„é¡¶éƒ¨å·²å­˜åœ¨ Activity å®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨è¯¥å®ä¾‹çš„ <span style="color: #1E90FF">onNewIntent()</span> æ–¹æ³•å‘å…¶ä¼ é€ Intentï¼Œè€Œéåˆ›å»ºæ–°çš„ Activity å®ä¾‹ã€‚</td>    </tr>    <tr>        <td rowspan="2">ä¸“ç”¨å¯åŠ¨<br/>ï¼ˆä¸å»ºè®®åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ï¼‰</td>        <td>singleTask</td>        <td>å¦</td>        <td>ç³»ç»Ÿä¼šåœ¨æ–°ä»»åŠ¡çš„æ ¹ä½ç½®åˆ›å»º Activity å¹¶å‘å…¶ä¼ é€ Intentã€‚ä¸è¿‡ï¼Œå¦‚æœå·²å­˜åœ¨ Activity å®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šè°ƒç”¨è¯¥å®ä¾‹çš„ <span style="color: #1E90FF">onNewIntent()</span> æ–¹æ³•ï¼ˆè€Œéåˆ›å»ºæ–°çš„ Activity å®ä¾‹ï¼‰ï¼Œå‘å…¶ä¼ é€ Intentã€‚</td>    </tr>    <tr>        <td>singleInstance</td>        <td>å¦</td>        <td>ä¸<b>ã€singleTaskã€</b>ç›¸åŒï¼Œåªæ˜¯ç³»ç»Ÿä¸ä¼šå°†ä»»ä½•å…¶ä»– Activity å¯åŠ¨åˆ°åŒ…å«å®ä¾‹çš„ä»»åŠ¡ä¸­ã€‚è¯¥ Activity å§‹ç»ˆæ˜¯å…¶ä»»åŠ¡ä¸­çš„å”¯ä¸€ Activityã€‚</td>    </tr></table><p>åŒæ—¶ï¼Œå®˜æ–¹æå‡ºï¼š</p><blockquote><p>å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œstandard æ˜¯é»˜è®¤æ¨¡å¼ï¼Œå¹¶ä¸”é€‚ç”¨äºå¤§å¤šæ•°ç±»å‹çš„ Activityã€‚å¯¹ä¼—å¤šç±»å‹çš„ Activity è€Œè¨€ï¼ŒSingleTop ä¹Ÿæ˜¯å¸¸è§ä¸”æœ‰ç”¨çš„å¯åŠ¨æ¨¡å¼ã€‚å…¶ä»–æ¨¡å¼ï¼ˆsingleTask å’Œ singleInstanceï¼‰<span style="color:red">ä¸é€‚ç”¨äºå¤§å¤šæ•°åº”ç”¨</span>ï¼Œå› ä¸ºå®ƒä»¬æ‰€å½¢æˆçš„äº¤äº’æ¨¡å¼å¯èƒ½è®©ç”¨æˆ·æ„Ÿåˆ°é™Œç”Ÿï¼Œå¹¶ä¸”ä¸å¤§å¤šæ•°å…¶ä»–åº”ç”¨å·®åˆ«è¾ƒå¤§ã€‚</p></blockquote><blockquote><p>æ— è®ºæ‚¨é€‰æ‹©å“ªç§å¯åŠ¨æ¨¡å¼ï¼Œåœ¨ Activity å¯åŠ¨æœŸé—´ä»¥åŠä½¿ç”¨è¿”å›æŒ‰é’®ä»å…¶ä»– Activity å’Œä»»åŠ¡è¿”å›è¯¥ Activity æ—¶ï¼Œè¯·åŠ¡å¿…å¯¹å…¶è¿›è¡Œæ˜“ç”¨æ€§æµ‹è¯•ã€‚</p></blockquote><h2 id="å…³äºtaskAffinity"><a href="#å…³äºtaskAffinity" class="headerlink" title="å…³äºtaskAffinity"></a>å…³äºtaskAffinity</h2><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯è¿™æ ·ä»‹ç»<code>android:taskAffinity</code>å±æ€§çš„ï¼š</p><blockquote><p>ä¸è¯¥ Activity æœ‰ç€ç›¸ä¼¼æ€§çš„ä»»åŠ¡ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå…·æœ‰åŒä¸€ç›¸ä¼¼æ€§çš„ Activity å½’å±åŒä¸€ä»»åŠ¡ï¼ˆä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œåˆ™æ˜¯å½’å±åŒä¸€ã€åº”ç”¨ã€ï¼‰ã€‚ä»»åŠ¡çš„ç›¸ä¼¼æ€§ç”±å…¶æ ¹ Activity çš„ç›¸ä¼¼æ€§ç¡®å®šã€‚</p><p>ç›¸ä¼¼æ€§ç¡®å®šä¸¤ç‚¹å†…å®¹ â€” Activity æ›´æ”¹çˆ¶é¡¹åçš„ä»»åŠ¡ï¼ˆè¯·å‚é˜…<code>allowTaskReparenting</code>å±æ€§ï¼‰ï¼Œä»¥åŠé€šè¿‡<code>FLAG_ACTIVITY_NEW_TASK</code>æ ‡è®°å¯åŠ¨ Activity æ—¶ï¼Œç”¨äºå®¹çº³è¯¥ Activity çš„ä»»åŠ¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ä¸­çš„æ‰€æœ‰ Activity éƒ½å…·æœ‰åŒä¸€ç›¸ä¼¼æ€§ã€‚æ‚¨å¯ä»¥è®¾ç½®è¯¥å±æ€§ï¼Œä»¥ä¸åŒæ–¹å¼å°†å…¶åˆ†ç»„ï¼Œç”šè‡³å¯ä»¥åœ¨åŒä¸€ä»»åŠ¡å†…æ”¾ç½®ä¸åŒåº”ç”¨ä¸­å®šä¹‰çš„ Activityã€‚å¦‚è¦æŒ‡å®š Activity ä¸ä»»ä½•ä»»åŠ¡å‡æ— ç›¸ä¼¼æ€§ï¼Œè¯·å°†å…¶è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœæœªè®¾ç½®è¯¥å±æ€§ï¼Œåˆ™ Activity ä¼šç»§æ‰¿ä¸ºåº”ç”¨è®¾ç½®çš„ç›¸ä¼¼æ€§ï¼ˆè¯·å‚é˜… <code>&lt;application\&gt;</code> å…ƒç´ çš„<code>taskAffinity</code>å±æ€§ï¼‰ã€‚åº”ç”¨é»˜è®¤ç›¸ä¼¼æ€§çš„åç§°ä¸º <code>&lt;manifest&gt;</code> å…ƒç´ æ‰€è®¾ç½®çš„è½¯ä»¶åŒ…åç§°ã€‚</p></blockquote><p><code>taskAffinity</code>ï¼Œå¯ä»¥ç¿»è¯‘ä¸º<strong>ä»»åŠ¡ç›¸å…³æ€§</strong>ã€‚è¿™ä¸ªå‚æ•°æ ‡è¯†äº†ä¸€ä¸ª Activity æ‰€éœ€è¦çš„ä»»åŠ¡æ ˆçš„åå­—ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ Activity æ‰€éœ€çš„ä»»åŠ¡æ ˆçš„åå­—ä¸ºåº”ç”¨çš„åŒ…åï¼Œå½“ Activity è®¾ç½®äº† <code>taskAffinity</code> å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ª Activity åœ¨è¢«åˆ›å»ºæ—¶å°±ä¼šè¿è¡Œåœ¨å’Œ <code>taskAffinity</code> åå­—ç›¸åŒçš„ä»»åŠ¡æ ˆä¸­ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ–°å»º <code>taskAffinity</code> æŒ‡å®šçš„ä»»åŠ¡æ ˆï¼Œå¹¶å°† Activity æ”¾å…¥è¯¥æ ˆä¸­ã€‚å¦å¤– <code>taskAffinity</code> å±æ€§ä¸»è¦å’Œ <code>singleTask</code> æˆ–è€…  <code>allowTaskReparenting</code> å±æ€§é…å¯¹ä½¿ç”¨ï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹æ²¡æœ‰æ„ä¹‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Activity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android ä¸­çš„åºåˆ—åŒ–</title>
      <link href="/2020-04-20/android-serialization/"/>
      <url>/2020-04-20/android-serialization/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Android ä¸­ä¼ é€’ä¸€äº›æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®åºåˆ—åŒ–ã€‚åºåˆ—åŒ–ç»å¸¸ä¼šç”¨åˆ° Serializable å’Œ Parcelable è¿™ä¸¤ä¸ªç±»ï¼Œé‚£ä¹ˆä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä»–ä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ç¯‡æ–‡ç« æ¥åˆ†æä¸€ä¸‹å„è‡ªçš„ç‰¹ç‚¹åŠä¼˜ç¼ºç‚¹ï¼Œå¹¶å¯¹æ¯”ä¸€ä¸‹ä¸¤ç§ç»“æ„çš„åŒºåˆ«ã€‚</p><span id="more"></span><p>åœ¨è®²å®ƒä»¬ä¹‹å‰ï¼Œå…ˆæä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ</p><h2 id="ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–"><a href="#ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–"></a>ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–</h2><p>Androidå¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ—¶é•¿é‡åˆ°ä¼ é€’å¯¹è±¡çš„éœ€æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•å°†å¯¹è±¡çš„å¼•ç”¨ä¼ ç»™ Activity æˆ–è€… Fragmentï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›å¯¹è±¡æ”¾åˆ°ä¸€ä¸ªIntent æˆ–è€… Bundle é‡Œé¢ï¼Œç„¶åå†ä¼ é€’ï¼Œè¿™æ—¶å€™å°±ç”¨åˆ°äº†åºåˆ—åŒ–ã€‚æ‰€è°“åºåˆ—åŒ–å°±æ˜¯<strong>æŠŠ Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹</strong>ï¼Œè¯¥å­—èŠ‚åºåˆ—å¯ä»¥è¢«å­˜å‚¨åˆ°ä¸€ä¸ªå‚¨å­˜åª’ä»‹é‡Œæˆ–è€…åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ï¼›ååºåˆ—åŒ–å°±æ˜¯æŠŠ<strong>å­—èŠ‚åºåˆ—æ¢å¤ä¸º Java å¯¹è±¡çš„è¿‡ç¨‹</strong>ã€‚ä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ä»…å¤„ç† Java å˜é‡è€Œä¸å¤„ç†æ–¹æ³•ï¼Œä»…å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p><h2 id="åºåˆ—åŒ–çš„ä¸¤ç§æ–¹å¼"><a href="#åºåˆ—åŒ–çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="åºåˆ—åŒ–çš„ä¸¤ç§æ–¹å¼"></a>åºåˆ—åŒ–çš„ä¸¤ç§æ–¹å¼</h2><p>Androidä¸­åºåˆ—åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼šSerializable ä»¥åŠ Parcelableã€‚å…¶ä¸­ Serializable æ˜¯ Java è‡ªå¸¦çš„ï¼Œè€Œ Parcelable æ˜¯ Android ä¸“æœ‰çš„ã€‚</p><h3 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h3><p>Serializable æ˜¯ Java æä¾›çš„åºåˆ—åŒ–æŠ€æœ¯ã€‚ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦è®©æŸä¸ª Class å®ç° Serializable å°±å¯ä»¥ã€‚åœ¨Serializableçš„æ–‡æ¡£ä¸­æå‡ºï¼ŒSerializable åœ¨åºåˆ—åŒ–è¿è¡Œæ—¶ä¼šå…³è”ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œç”¨<code>serialVersionUID</code>æ¥æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥éªŒè¯å‘é€è€…å’Œæ¥æ”¶è€…å¤„ç†çš„æ˜¯ä¸æ˜¯åŒä¸€ä¸ªç‰ˆæœ¬çš„ç±»ã€‚å¦‚æœç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œåˆ™ä¼šæŠ›å‡º<code>InvalidClassException</code>å¼‚å¸¸ã€‚è¦ä½¿ç”¨è¿™ä¸ªæ ‡è¯†ï¼Œéœ€è¦åœ¨ç±»é‡Œå£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">private/public/protected static final long serialVersionUID = 42L;</code></pre><p>è™½ç„¶ä¸æä¾›è¿™ä¸ªå€¼ä¹Ÿè¡Œï¼ŒJava ä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªè¯¥å€¼ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯èƒ½æä¾›ä¸€ä¸ªã€‚å› ä¸ºå—ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸åŒã€å†…æ ¸ç‰ˆæœ¬ä¸åŒç­‰ç­‰çš„å½±å“ï¼Œæœ‰å¯èƒ½åŒä¸€ä¸ªç±»è®¡ç®—å‡ºæ¥çš„<code>serialVersionUID</code>å€¼ä¸åŒï¼Œå°±ä¼šå¯¼è‡´åºåˆ—åŒ–/ååºåˆ—åŒ–å¤±è´¥ã€‚</p><p>å½“çˆ¶ç±»å®ç°äº†åºåˆ—åŒ–ï¼Œå…¶å­ç±»ä¹Ÿä¼šè‡ªåŠ¨å®ç°åºåˆ—åŒ–ï¼Œä¸éœ€è¦å†æ˜¾å¼å®ç° Serializable æ¥å£äº†ã€‚</p><blockquote><p>Seralizable æ— æ³•åºåˆ—åŒ–é™æ€å˜é‡ï¼Œä½¿ç”¨ transient ä¿®é¥°çš„å¯¹è±¡ä¹Ÿæ— æ³•åºåˆ—åŒ–ã€‚æ‰€ä»¥ï¼Œå½“ç±»ä¸­æœ‰é™æ€å˜é‡æ—¶ï¼Œåºåˆ—åŒ–å¹¶ä¸ä¼šä¿å­˜è¯¥å˜é‡ã€‚</p><h3 id="transient-å…³é”®å­—"><a href="#transient-å…³é”®å­—" class="headerlink" title="transient å…³é”®å­—"></a>transient å…³é”®å­—</h3><p>transient å…³é”®å­—çš„ä½œç”¨æ˜¯<strong>æ§åˆ¶å˜é‡çš„åºåˆ—åŒ–</strong>ï¼Œåœ¨å˜é‡å£°æ˜å‰åŠ ä¸Šè¯¥å…³é”®å­—ï¼Œå¯ä»¥<strong>é˜»æ­¢è¯¥å˜é‡è¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­</strong>ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œtransient å˜é‡çš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œå¦‚ int å‹çš„æ˜¯ 0ï¼Œå¯¹è±¡å‹çš„æ˜¯ nullã€‚</p></blockquote><p>å®ç° Serializable æ—¶ï¼Œè¿˜å¯ä»¥æ·»åŠ <code>writeObject()</code>å’Œ<code>readObject()</code>æ–¹æ³•ï¼Œè™šæ‹Ÿæœºåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶ï¼Œä¼šè¯•å›¾è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥<strong>æ§åˆ¶åºåˆ—åŒ–çš„è¿‡ç¨‹</strong>ï¼Œæ¯”å¦‚å¯ä»¥åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­åŠ¨æ€æ”¹å˜åºåˆ—åŒ–çš„æ•°å€¼ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="java">class SerializableTest implements Serializable &#123;    private static final long serialVersionUID = 1L;    private String password = &quot;pass&quot;;    public String getPassword() &#123;        return password;    &#125;    public void setPassword(String password) &#123;        this.password = password;    &#125;    private String encrypt() &#123;        ...    &#125;    private String decrypt() &#123;        ...    &#125;    private void writeObject(ObjectOutputStream out) &#123;        try &#123;            PutField putFields = out.putFields();            System.out.println(&quot;åŸå¯†ç :&quot; + this.password);            this.password = encrypt(); // åŠ å¯†            putFields.put(&quot;password&quot;, this.password);            System.out.println(&quot;åŠ å¯†åçš„å¯†ç &quot; + this.password);            out.writeFields();        &#125; catch (IOException e) &#123;            e.printStackTrace();        &#125;    &#125;    private void readObject(ObjectInputStream in) &#123;        try &#123;            GetField readFields = in.readFields();            Object object = readFields.get(&quot;password&quot;, &quot;&quot;);            this.password = decrypt(object.toString())            System.out.println(&quot;è§£å¯†åçš„å¯†ç :&quot; + this.password);        &#125; catch (IOException e) &#123;            e.printStackTrace();        &#125; catch (ClassNotFoundException e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><h3 id="Parcelable"><a href="#Parcelable" class="headerlink" title="Parcelable"></a>Parcelable</h3><p>Parcelable æ˜¯ Android æä¾›çš„åºåˆ—åŒ–æ–¹æ¡ˆã€‚å®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³Serializableåœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­æ¶ˆè€—èµ„æºä¸¥é‡çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæœ¬èº«ä½¿ç”¨éœ€è¦æ‰‹åŠ¨å¤„ç†åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä¼šä¸å…·ä½“çš„ä»£ç ç»‘å®šï¼Œä½¿ç”¨è¾ƒä¸ºç¹çï¼Œä¸€èˆ¬åªè·å–å†…å­˜æ•°æ®çš„æ—¶å€™ä½¿ç”¨ã€‚</p><p>è€Œ Parcelable ä¾èµ–äºParcelï¼ŒParcel çš„æ„æ€æ˜¯åŒ…è£…ï¼Œå®ç°åŸç†æ˜¯åœ¨å†…å­˜ä¸­<strong>å»ºç«‹ä¸€å—å…±äº«æ•°æ®å—</strong>ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–å‡æ˜¯æ“ä½œè¿™ä¸€å—çš„æ•°æ®ï¼Œå¦‚æ­¤æ¥å®ç°ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/55.png"></p><p>å¬èµ·æ¥è·Ÿ Linux çš„å…±äº«å†…å­˜æœ‰æ²¡æœ‰å¾ˆåƒï¼Ÿå¯¹ï¼ŒParcelable å¯ä»¥ç”¨äº Android çš„è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåº”ç”¨çš„ Activity è¦ä¸ Service é€šä¿¡çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ Parcelableã€‚</p><p>ä½¿ç”¨ Parcelable è¦ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚å®ƒéœ€è¦å®ç°ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ç±»æœ¬èº«è¦å®ç° Parcelable æ¥å£</li><li>æœ‰ä¸€ä¸ªéç©ºçš„é™æ€æˆå‘˜å˜é‡å«<code>CREATOR</code>ï¼Œå¹¶ä¸”å®ƒè¦å®ç°<code>Parcelable.Creator</code>æ¥å£<ul><li>è¦†å†™<code>createFromParcel(Parcel in)</code>æ–¹æ³•</li><li>è¦†å†™<code>newArray(int size)</code>æ–¹æ³•</li></ul></li><li>è¦†å†™<code>describeContents()</code>æ–¹æ³•</li><li>è¦†å†™<code>writeToParcel(Parcel dest, int flags)</code>æ–¹æ³•</li></ul><p>çœ‹èµ·æ¥çœŸçš„å¥½éº»çƒ¦ã€‚æˆ‘ä»¬è¿˜æ˜¯ç”¨ä»£ç æ¥è§£é‡Šä¸€ä¸‹å§ï¼š</p><pre><code class="java">public class MyParcelable implements Parcelable &#123;    // è¦è¢«åºåˆ—åŒ–çš„æ•°æ®    private int mData;    // æè¿°åœ¨è¿™ä¸ª Parcelable å®ä¾‹çš„ä¸­å«æœ‰çš„ç‰¹æ®Šå¯¹è±¡çš„ç±»å‹ã€‚    // ä¾‹å¦‚ï¼Œå¦‚æœåœ¨å¯¹è±¡çš„ output ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œé‚£å®ƒçš„è¿”å›å€¼å¿…é¡»è¦åŒ…å« CONTENTS_FILE_DESCRIPTOR çš„ bit å€¼    // è¿”å›ä¸€ä¸ª bitmask å€¼    public int describeContents() &#123;        return 0;    &#125;    // ç”¨äºŒå‘ç®”æŠŠå¯¹è±¡ææˆ Parcelable    public void writeToParcel(Parcel out, int flags) &#123;        out.writeInt(mData);    &#125;    // ä¸€ä¸ªå¿…é¡»è¦å®ç°çš„æ¥å£ï¼Œç”¨æ¥ä»ä¸€ä¸ª Parcel åˆ›å»ºä½ è‡ªå®šä¹‰çš„ Parcelable å®ä¾‹    public static final Parcelable.Creator&lt;MyParcelable&gt; CREATOR            = new Parcelable.Creator&lt;MyParcelable&gt;() &#123;        // ä½¿ç”¨ä¹‹å‰å­˜å‚¨çš„ Parcel æ¥åˆ›å»ºå®ä¾‹        public MyParcelable createFromParcel(Parcel in) &#123;            return new MyParcelable(in);        &#125;        // åˆ›å»ºä¸€ä¸ª Parcelable çš„æ•°ç»„ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ˜¯ null        public MyParcelable[] newArray(int size) &#123;            return new MyParcelable[size];        &#125;    &#125;;    // ä»è¯»å–çš„æ•°æ®ä¸­è¿›è¡Œæ¢å¤    private MyParcelable(Parcel in) &#123;        mData = in.readInt();    &#125;&#125;</code></pre><h2 id="ä¸¤ç§åºåˆ—åŒ–æ–¹å¼çš„å¯¹æ¯”"><a href="#ä¸¤ç§åºåˆ—åŒ–æ–¹å¼çš„å¯¹æ¯”" class="headerlink" title="ä¸¤ç§åºåˆ—åŒ–æ–¹å¼çš„å¯¹æ¯”"></a>ä¸¤ç§åºåˆ—åŒ–æ–¹å¼çš„å¯¹æ¯”</h2><ol><li>Serializable ä»£ç é‡å°‘ï¼ŒParcelable ä»£ç é‡å¤šã€‚</li><li>åœ¨å†…å­˜é—´ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼ŒParcelable æ¯” Serializable æ€§èƒ½é«˜ã€å†…å­˜å¼€é”€æ–¹é¢è¾ƒå°ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ Parcelableï¼›è€Œåœ¨éœ€è¦ä¿å­˜æ•°æ®åˆ°æœ¬åœ°æˆ–è€…è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œä½¿ç”¨ Serializableã€‚</li><li>Serializable åœ¨åºåˆ—åŒ–æ—¶ä½¿ç”¨çš„æ˜¯<strong>åå°„</strong>çš„æŠ€æœ¯ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶å˜é‡ï¼Œä»è€Œå¼•èµ·é¢‘ç¹çš„ GCã€‚è€Œ Parcelable æ–¹å¼çš„å®ç°åŸç†æ˜¯å°†ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡è¿›è¡Œ<strong>å­—èŠ‚åŒ–</strong>ï¼Œè€Œ<strong>å­—èŠ‚åŒ–</strong>ä¹‹åçš„æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ Intent æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·ä¹Ÿå°±å®ç°ä¼ é€’å¯¹è±¡çš„åŠŸèƒ½äº†ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> åºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº ActivityManagerService</title>
      <link href="/2020-04-18/activity-manager-service/"/>
      <url>/2020-04-18/activity-manager-service/</url>
      
        <content type="html"><![CDATA[<p>ActivityManagerService æ˜¯ Android æä¾›çš„<strong>ç®¡ç† Activity è¿è¡ŒçŠ¶æ€çš„ç³»ç»Ÿè¿›ç¨‹</strong>ï¼Œå…¶å®å¤§å®¶åˆ«è¢«åå­—è¿·æƒ‘äº†ï¼ŒActivityManagerServiceï¼ˆåç§°AMSï¼‰å…¶å®ä¹Ÿå…¼ä»»ç®¡ç†å…¶ä»–ç»„ä»¶è¿è¡ŒçŠ¶æ€ã€‚</p><span id="more"></span><h2 id="AMSæ¦‚è¿°"><a href="#AMSæ¦‚è¿°" class="headerlink" title="AMSæ¦‚è¿°"></a>AMSæ¦‚è¿°</h2><h3 id="AMSå¯åŠ¨æµç¨‹"><a href="#AMSå¯åŠ¨æµç¨‹" class="headerlink" title="AMSå¯åŠ¨æµç¨‹"></a>AMSå¯åŠ¨æµç¨‹</h3><p>æ ¹æ®<a href="/android-boot/"></a>è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„ï¼Œinit è¿›ç¨‹æ˜¯ Android ç³»ç»Ÿä¸­çš„åˆå§‹åŒ–è¿›ç¨‹ï¼Œinit ç”Ÿæˆ Zygote è¿›ç¨‹ï¼ŒAndroid ä¸­å¤§å¤šæ•°åº”ç”¨è¿›ç¨‹å’Œç³»ç»Ÿè¿›ç¨‹éƒ½æ˜¯é€šè¿‡ Zygote è¿›ç¨‹ç”Ÿæˆçš„ã€‚</p><p><img src="/img/ams-1587379033.jpg"></p><p>ä¸Šé¢çš„æµç¨‹å›¾å±•ç¤ºäº† AMS çš„ä»£ç æ‰§è¡Œæµç¨‹ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥è¯¦ç»†è®²è®²ã€‚</p><p>AMSè¿™ç§ç³»ç»Ÿçº§åˆ«çš„æœåŠ¡ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹åœ¨ system_server è¿›ç¨‹ä¸­ï¼Œæ˜¯å¦‚ä½•å¯åŠ¨ AMS çš„ï¼š</p><pre><code class="java">// com.android.server.SystemServer.java;public final class SystemServer &#123;    /**     * The main entry point from zygote.     */    public static void main(String[] args) &#123;        new SystemServer().run();    &#125;    private void run() &#123;        ...        // Start services.        ...        startBootstrapServices();        ...    &#125;    private void startBootstrapServices() &#123;        ...        // Activity manager runs the show.        traceBeginAndSlog(&quot;StartActivityManager&quot;);        // TODO: Might need to move after migration to WM.        ActivityTaskManagerService atm = mSystemServiceManager.startService(                ActivityTaskManagerService.Lifecycle.class).getService();        // è¿™é‡ŒçœŸæ­£å¯åŠ¨äº† AMS        mActivityManagerService = ActivityManagerService.Lifecycle.startService(                mSystemServiceManager, atm);        mActivityManagerService.setSystemServiceManager(mSystemServiceManager);        mActivityManagerService.setInstaller(installer);        mWindowManagerGlobalLock = atm.getGlobalLock();        ...        // ä¸º system è¿›ç¨‹è®¾ç½® Application å®ä¾‹        mActivityManagerService.setSystemProcess();    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯åŠ¨ AMS ä½¿ç”¨çš„æ˜¯ AMS è‡ªèº«çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»çš„<code>startService()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼š</p><p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/am/ActivityManagerService.java">æŸ¥çœ‹ActivityManagerService.java</a></p><pre><code class="java">// ActivityManagerService.javapublic static final class Lifecycle extends SystemService &#123;    private final ActivityManagerService mService;    ...df    public static ActivityManagerService startService(            SystemServiceManager ssm, ActivityTaskManagerService atm) &#123;        sAtm = atm;        return ssm.startService(ActivityManagerService.Lifecycle.class).getService();    &#125;    @Override    public void onStart() &#123;        mService.start();    &#125;    ...&#125;</code></pre><p>è¿™é‡Œåˆè°ƒç”¨äº†<code>SystemServiceManager.startService(Class)</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre><code class="java">// com.android.server.SystemServiceManager.java/**    * Creates and starts a system service. The class must be a subclass of    * &#123;@link com.android.server.SystemService&#125;.    *    * @param serviceClass A Java class that implements the SystemService interface.    * @return The service instance, never null.    * @throws RuntimeException if the service fails to start.    */@SuppressWarnings(&quot;unchecked&quot;)public &lt;T extends SystemService&gt; T startService(Class&lt;T&gt; serviceClass) &#123;    ...    // é€šè¿‡åå°„çš„æ–¹å¼å®ä¾‹åŒ–è¯¥ service    Constructor&lt;T&gt; constructor = serviceClass.getConstructor(Context.class);    service = constructor.newInstance(mContext);    ...    startService(service);    return service;&#125;public void startService(@NonNull final SystemService service) &#123;    // æ³¨å†Œ    mServices.add(service);    ...    // è°ƒç”¨ Lifecycle çš„ onStart() æ–¹æ³•    service.onStart();    ...&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åè°ƒç”¨åˆ°äº†<code>ActivityManagerService.Lifecycle.onStart()</code>æ–¹æ³•ï¼Œè€Œ<code>ActivityManagerService.Lifecycle.onStart()</code>æ–¹æ³•åˆè°ƒç”¨äº†<code>mService.start()</code>æ–¹æ³•ï¼Œè¿›è¡Œäº†ä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼š</p><pre><code class="java">private void start() &#123;    removeAllProcessGroups();    mProcessCpuThread.start();    mBatteryStatsService.publish();    mAppOpsService.publish(mContext);    Slog.d(&quot;AppOps&quot;, &quot;AppOpsService published&quot;);    LocalServices.addService(ActivityManagerInternal.class, new LocalService());    mActivityTaskManager.onActivityManagerInternalAdded();    mUgmInternal.onActivityManagerInternalAdded();    mPendingIntentController.onActivityManagerInternalAdded();    // Wait for the synchronized block started in mProcessCpuThread,    // so that any other access to mProcessCpuTracker from main thread    // will be blocked during mProcessCpuTracker initialization.    try &#123;        mProcessCpuInitLatch.await();    &#125; catch (InterruptedException e) &#123;        Slog.wtf(TAG, &quot;Interrupted wait during start&quot;, e);        Thread.currentThread().interrupt();        throw new IllegalStateException(&quot;Interrupted wait during start&quot;);    &#125;&#125;</code></pre><p>åˆå§‹åŒ–å®Œæˆåï¼Œå°±ä¼šè°ƒç”¨<code>mActivityManagerService.setSystemProcess()</code>æ–¹æ³•ï¼š</p><pre><code class="java">public void setSystemProcess() &#123;    ...    ServiceManager.addService(Context.ACTIVITY_SERVICE, this, /* allowIsolated= */ true,                DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PRIORITY_NORMAL | DUMP_FLAG_PROTO);    ServiceManager.addService(ProcessStats.SERVICE_NAME, mProcessStats);    ServiceManager.addService(&quot;meminfo&quot;, new MemBinder(this), /* allowIsolated= */ false,            DUMP_FLAG_PRIORITY_HIGH);    ServiceManager.addService(&quot;gfxinfo&quot;, new GraphicsBinder(this));    ServiceManager.addService(&quot;dbinfo&quot;, new DbBinder(this));    if (MONITOR_CPU_USAGE) &#123;        ServiceManager.addService(&quot;cpuinfo&quot;, new CpuBinder(this),                /* allowIsolated= */ false, DUMP_FLAG_PRIORITY_CRITICAL);    &#125;    ServiceManager.addService(&quot;permission&quot;, new PermissionController(this));    ServiceManager.addService(&quot;processinfo&quot;, new ProcessInfoService(this));    ...&#125;</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡<code>ServiceManager.addService(Context.ACTIVITY_SERVICE, this, true)</code>æ–¹æ³•æ³¨å†Œäº†å½“å‰ AMS çš„å®ä¾‹ã€‚AMS æ˜¯ä¸€ä¸ªå…¸å‹çš„ Binder Serverï¼ŒServiceManager è¿˜æ³¨å†Œäº†ä¸ AMS æœ‰å…³çš„å…¶ä»–æœåŠ¡ï¼ˆå¦‚ CPUã€PermissionControllerç­‰ï¼‰ï¼Œè¯´æ˜åé¢ AMS ä¼šä¸è¿™äº›æœåŠ¡æœ‰å¾ˆå¤šäº¤äº’ã€‚</p><p>åˆšæ‰æˆ‘ä»¬è·³è¿‡äº† AMS çš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®ä¾‹åŒ–ä¸­ï¼Œå…·ä½“éƒ½åšäº†å“ªäº›å·¥ä½œï¼š</p><pre><code class="java">    // Note: This method is invoked on the main thread but may need to attach various    // handlers to other threads.  So take care to be explicit about the looper.    public ActivityManagerService(Context systemContext, ActivityTaskManagerService atm) &#123;        LockGuard.installLock(this, LockGuard.INDEX_ACTIVITY);        mInjector = new Injector();        mContext = systemContext;        mFactoryTest = FactoryTest.getMode();        // ç¬¬ä¸€æ­¥        mSystemThread = ActivityThread.currentActivityThread();        mUiContext = mSystemThread.getSystemUiContext();        Slog.i(TAG, &quot;Memory class: &quot; + ActivityManager.staticGetMemoryClass());        mHandlerThread = new ServiceThread(TAG,                THREAD_PRIORITY_FOREGROUND, false /*allowIo*/);        mHandlerThread.start();        mHandler = new MainHandler(mHandlerThread.getLooper());        mUiHandler = mInjector.getUiHandler(this);        mProcStartHandlerThread = new ServiceThread(TAG + &quot;:procStart&quot;,                THREAD_PRIORITY_FOREGROUND, false /* allowIo */);        mProcStartHandlerThread.start();        mProcStartHandler = new Handler(mProcStartHandlerThread.getLooper());        mConstants = new ActivityManagerConstants(mContext, this, mHandler);        final ActiveUids activeUids = new ActiveUids(this, true /* postChangesToAtm */);        mPlatformCompat = (PlatformCompat) ServiceManager.getService(                Context.PLATFORM_COMPAT_SERVICE);        mProcessList.init(this, activeUids, mPlatformCompat);        mLowMemDetector = new LowMemDetector(this);        mOomAdjuster = new OomAdjuster(this, mProcessList, activeUids);        // ç¬¬äºŒæ­¥        // Broadcast policy parameters        final BroadcastConstants foreConstants = new BroadcastConstants(                Settings.Global.BROADCAST_FG_CONSTANTS);        foreConstants.TIMEOUT = BROADCAST_FG_TIMEOUT;        final BroadcastConstants backConstants = new BroadcastConstants(                Settings.Global.BROADCAST_BG_CONSTANTS);        backConstants.TIMEOUT = BROADCAST_BG_TIMEOUT;        final BroadcastConstants offloadConstants = new BroadcastConstants(                Settings.Global.BROADCAST_OFFLOAD_CONSTANTS);        offloadConstants.TIMEOUT = BROADCAST_BG_TIMEOUT;        // by default, no &quot;slow&quot; policy in this queue        offloadConstants.SLOW_TIME = Integer.MAX_VALUE;        mEnableOffloadQueue = SystemProperties.getBoolean(                &quot;persist.device_config.activity_manager_native_boot.offload_queue_enabled&quot;, false);        mFgBroadcastQueue = new BroadcastQueue(this, mHandler,                &quot;foreground&quot;, foreConstants, false);        mBgBroadcastQueue = new BroadcastQueue(this, mHandler,                &quot;background&quot;, backConstants, true);        mOffloadBroadcastQueue = new BroadcastQueue(this, mHandler,                &quot;offload&quot;, offloadConstants, true);        mBroadcastQueues[0] = mFgBroadcastQueue;        mBroadcastQueues[1] = mBgBroadcastQueue;        mBroadcastQueues[2] = mOffloadBroadcastQueue;        // ç¬¬ä¸‰æ­¥        mServices = new ActiveServices(this);        mProviderMap = new ProviderMap(this);        mPackageWatchdog = PackageWatchdog.getInstance(mUiContext);        mAppErrors = new AppErrors(mUiContext, this, mPackageWatchdog);        // ç¬¬å››æ­¥        final File systemDir = SystemServiceManager.ensureSystemDir();        // TODO: Move creation of battery stats service outside of activity manager service.        mBatteryStatsService = new BatteryStatsService(systemContext, systemDir,                BackgroundThread.get().getHandler());        mBatteryStatsService.getActiveStatistics().readLocked();        mBatteryStatsService.scheduleWriteToDisk();        mOnBattery = DEBUG_POWER ? true                : mBatteryStatsService.getActiveStatistics().getIsOnBattery();        mBatteryStatsService.getActiveStatistics().setCallback(this);        mOomAdjProfiler.batteryPowerChanged(mOnBattery);        mProcessStats = new ProcessStatsService(this, new File(systemDir, &quot;procstats&quot;));        mAppOpsService = mInjector.getAppOpsService(new File(systemDir, &quot;appops.xml&quot;), mHandler);        mUgmInternal = LocalServices.getService(UriGrantsManagerInternal.class);        // ç¬¬äº”æ­¥        mUserController = new UserController(this);        mPendingIntentController = new PendingIntentController(                mHandlerThread.getLooper(), mUserController);                        if (SystemProperties.getInt(&quot;sys.use_fifo_ui&quot;, 0) != 0) &#123;            mUseFifoUiScheduling = true;        &#125;        mTrackingAssociations = &quot;1&quot;.equals(SystemProperties.get(&quot;debug.track-associations&quot;));        mIntentFirewall = new IntentFirewall(new IntentFirewallInterface(), mHandler);        mActivityTaskManager = atm;        mActivityTaskManager.initialize(mIntentFirewall, mPendingIntentController,                DisplayThread.get().getLooper());        mAtmInternal = LocalServices.getService(ActivityTaskManagerInternal.class);        // ç¬¬å…­æ­¥        mProcessCpuThread = new Thread(&quot;CpuTracker&quot;) &#123;            @Override            public void run() &#123;                synchronized (mProcessCpuTracker) &#123;                    mProcessCpuInitLatch.countDown();                    mProcessCpuTracker.init();                &#125;                while (true) &#123;                    try &#123;                        try &#123;                            synchronized(this) &#123;                                final long now = SystemClock.uptimeMillis();                                long nextCpuDelay = (mLastCpuTime.get()+MONITOR_CPU_MAX_TIME)-now;                                long nextWriteDelay = (mLastWriteTime+BATTERY_STATS_TIME)-now;                                //Slog.i(TAG, &quot;Cpu delay=&quot; + nextCpuDelay                                //        + &quot;, write delay=&quot; + nextWriteDelay);                                if (nextWriteDelay &lt; nextCpuDelay) &#123;                                    nextCpuDelay = nextWriteDelay;                                &#125;                                if (nextCpuDelay &gt; 0) &#123;                                    mProcessCpuMutexFree.set(true);                                    this.wait(nextCpuDelay);                                &#125;                            &#125;                        &#125; catch (InterruptedException e) &#123;                        &#125;                        updateCpuStatsNow();                    &#125; catch (Exception e) &#123;                        Slog.e(TAG, &quot;Unexpected exception collecting process stats&quot;, e);                    &#125;                &#125;            &#125;        &#125;;        mHiddenApiBlacklist = new HiddenApiSettings(mHandler, mContext);        Watchdog.getInstance().addMonitor(this);        Watchdog.getInstance().addThread(mHandler);        // bind background threads to little cores        // this is expected to fail inside of framework tests because apps can&#39;t touch cpusets directly        // make sure we&#39;ve already adjusted system_server&#39;s internal view of itself first        updateOomAdjLocked(OomAdjuster.OOM_ADJ_REASON_NONE);        try &#123;            Process.setThreadGroupAndCpuset(BackgroundThread.get().getThreadId(),                    Process.THREAD_GROUP_SYSTEM);            Process.setThreadGroupAndCpuset(                    mOomAdjuster.mAppCompact.mCompactionThread.getThreadId(),                    Process.THREAD_GROUP_SYSTEM);        &#125; catch (Exception e) &#123;            Slog.w(TAG, &quot;Setting background thread cpuset failed&quot;);        &#125;    &#125;</code></pre><p>æˆ‘æ€»å…±å°† AMS çš„å®ä¾‹åŒ–è¿‡ç¨‹æ€»ä½“åˆ†ä¸ºäº†å…­ä¸ªæ­¥éª¤ï¼š</p><ol><li>æ„é€ ä¸€äº› Contextã€Handler å’Œ Threadï¼Œå¦‚ uiHandler ç­‰ï¼Œç”¨æ¥å¤„ç† UI ç›¸å…³çš„å·¥ä½œï¼›</li><li>å®šä¹‰äº†å®¹çº³å‰å°å’Œåå°çš„å¹¿æ’­é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿè¯´æ˜äº† AMS ä¸ä»…ä»…å…³æ³¨ Activityï¼Œä¹Ÿè´Ÿè´£å…¶ä»–ç»„ä»¶çŠ¶æ€çš„ç®¡ç†ï¼›</li><li>ç®¡ç† Service å’Œ Provider çš„å¯¹è±¡æ•°ç»„ï¼›</li><li>åˆå§‹åŒ–systemä¸‹é¢éœ€è¦çš„ä¸€ç³»åˆ—æ–‡ä»¶ç›®å½•ã€‚ä¾‹å¦‚æƒé™æ–‡ä»¶ã€è¿›ç¨‹çŠ¶æ€ä¿¡æ¯æ–‡ä»¶ç­‰ç­‰ï¼›</li><li>ç®¡ç† ActivityStackï¼Œä¹Ÿç®¡ç† Activity å¯åŠ¨æ—¶ç”¨åˆ°çš„ Intent å’Œ flagï¼›</li><li>å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è·Ÿè¿› cpu å½“å‰çŠ¶æ€ä¿¡æ¯ï¼ŒAMS å¯¹å½“å‰ cpu çŠ¶æ€äº†å¦‚æŒ‡æŒï¼Œå¯ä»¥æ›´åŠ é«˜æ•ˆçš„å®‰æ’å…¶ä»–å·¥ä½œã€‚</li></ol><h2 id="Activity-çŠ¶æ€ç®¡ç†"><a href="#Activity-çŠ¶æ€ç®¡ç†" class="headerlink" title="Activity çŠ¶æ€ç®¡ç†"></a>Activity çŠ¶æ€ç®¡ç†</h2><p>å…ˆæå‡ºå‡ ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ ¹æ®é—®é¢˜å»çœ‹ä¸‹é¢çš„éƒ¨åˆ†ï¼š</p><blockquote><p>Activity æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ï¼Ÿ</p><p>Android æ˜¯å¦‚ä½•ç®¡ç† Activity çŠ¶æ€çš„ï¼Ÿ</p><p>ä¸€ä¸ª Task åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª Activityï¼Œä¸€ä¸ª Stack åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª Taskï¼Œè¿™å„¿å¼•å…¥ ActivityStackï¼Œè¿˜æœ‰ActivityStackSupervisor è´Ÿè´£ç®¡ç†æ‰€æœ‰çš„ Stackã€‚é‚£ä¹ˆè¿™äº›å¯¹è±¡éƒ½æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿ</p></blockquote><h3 id="Activity-çš„åˆ›å»º"><a href="#Activity-çš„åˆ›å»º" class="headerlink" title="Activity çš„åˆ›å»º"></a>Activity çš„åˆ›å»º</h3><p>æˆ‘ä»¬åœ¨<a href="/about-activity/">å…³äº Activity çš„ä¸€åˆ‡</a>è¿™ç¯‡æ–‡ç« ä¸­è®²è¿‡ï¼ŒActivity æ˜¯ç”± ActivityThread åˆ›å»ºçš„å®ä¾‹ï¼Œé‚£ä¹ˆ ActivityThread æ˜¯ç”±è°åˆ›å»ºçš„ï¼ŸAMS åˆæ˜¯å¦‚ä½•ä»‹å…¥çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚</p><p>åœ¨å‰æ–‡ä¸­è®²è¿‡ï¼Œsystem_server åœ¨å®ƒçš„<code>main()</code>æ–¹æ³•ä¸­åˆ›å»ºäº† SystemServer çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨äº†å®ƒçš„<code>run()</code>æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæœ‰è¿™ä¹ˆä¸€æ®µï¼š</p><pre><code class="java">private void run() &#123;    ...    // Initialize the system context.    createSystemContext();    ...&#125;private void createSystemContext() &#123;    ActivityThread activityThread = ActivityThread.systemMain();    mSystemContext = activityThread.getSystemContext();    mSystemContext.setTheme(DEFAULT_SYSTEM_THEME);    final Context systemUiContext = activityThread.getSystemUiContext();    systemUiContext.setTheme(DEFAULT_SYSTEM_THEME);&#125;</code></pre><p>system_server è¿›ç¨‹ä¼¼ä¹æ˜¯åˆ›å»ºäº† ActivityThread çš„å®ä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹<code>ActivityThread.systemMain()</code>æ–¹æ³•åšäº†ä»€ä¹ˆï¼š</p><pre><code class="java">final ApplicationThread mAppThread = new ApplicationThread();@UnsupportedAppUsagepublic static ActivityThread systemMain() &#123;    ...    ActivityThread thread = new ActivityThread();    thread.attach(true, 0);    return thread;&#125;private void attach(boolean system, long startSeq) &#123;    ...    // æ‰¾åˆ°äº†ï¼ŒAMS åœ¨è¿™é‡Œä»‹å…¥äº†    final IActivityManager mgr = ActivityManager.getService();    try &#123;        mgr.attachApplication(mAppThread, startSeq);    &#125; catch (RemoteException ex) &#123;        throw ex.rethrowFromSystemServer();    &#125;    ...&#125;</code></pre><p>ApplicationThread æ˜¯ IApplicationThread.Stub çš„å­ç±»ï¼Œè€Œ IApplicationThread æ˜¯ AMS ç”¨æ¥ä¸åº”ç”¨è¿›ç¨‹é€šè®¯çš„æ¥å£ã€‚</p><p>IActivityManager æ˜¯ AMS çš„ Binder æ¥å£ï¼Œåº”ç”¨è¿›ç¨‹ä¼šé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œç”¨ Binder æœºåˆ¶ä¸ AMS è¿›è¡Œé€šè®¯ã€‚</p><p>æ‰€ä»¥ï¼Œ<code>attachApplication()</code>æ–¹æ³•ä¸€ç»è°ƒç”¨ï¼Œå°±å°†åº”ç”¨è¿›ç¨‹ä¸ AMS è”ç³»äº†èµ·æ¥ï¼ŒAMS å°±å¯ä»¥ç®¡ç†åº”ç”¨è¿›ç¨‹ä¸­çš„ Activity çŠ¶æ€äº†ã€‚</p><p>å®é™…ä¸Šæˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ ActivityThread çš„ä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼ŒAMS åœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä»‹å…¥äº†ç®¡ç†ï¼Œæ¯”å¦‚ä¸‹é¢å‡ å¤„ï¼š</p><pre><code class="java">private void handleReceiver(ReceiverData data) &#123;    ...    IActivityManager mgr = ActivityManager.getService();    ...    data.sendFinished(mgr);    ...&#125;private void handleCreateService(CreateServiceData data) &#123;    ...    service.attach(context, this, data.info.name, data.token, app,                    ActivityManager.getService());    ...&#125;private void handleBindService(BindServiceData data) &#123;    ...    if (!data.rebind) &#123;        IBinder binder = s.onBind(data.intent);        ActivityManager.getService().publishService(                data.token, data.intent, binder);    &#125; else &#123;        s.onRebind(data.intent);        ActivityManager.getService().serviceDoneExecuting(                data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);    &#125;    ...&#125;</code></pre><p>å¯è§ï¼ŒAMS çœŸçš„å¦‚å¼€å¤´æ‰€è¯´ï¼Œæ˜¯ä¸ªå¤šé¢æ‰‹ï¼Œç®¡ç†äº†è®¸å¤š Android ç»„ä»¶çš„çŠ¶æ€ä¸æ•°æ®ã€‚</p><h3 id="ActivityRecordã€TaskRecordã€ActivityStack"><a href="#ActivityRecordã€TaskRecordã€ActivityStack" class="headerlink" title="ActivityRecordã€TaskRecordã€ActivityStack"></a>ActivityRecordã€TaskRecordã€ActivityStack</h3><p>å…ˆæ¥ä¸€å¼ å›¾ï¼ŒæŒ‘æ˜è¿™ä¸‰è€…çš„å…³ç³»ï¼š</p><p><img src="/img/ams-1587440232.png"></p><ul><li>ä¸€ä¸ª ActivityStack ä¸­åŒ…å«å¤šä¸ª TaskRecord</li><li>ä¸€ä¸ª TaskRecord ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª ActivityRecordï¼Œ</li><li>ä¸€ä¸ª ActivityRecord å°±å¯¹åº”ç€ä¸€ä¸ª Activityï¼Œä¿å­˜äº†å®ƒçš„æ‰€æœ‰ä¿¡æ¯ï¼›åŒæ—¶ä¸€ä¸ª Activity å¯èƒ½ä¼šç”Ÿæˆå¤šä¸ª ActivityRecordï¼Œå› ä¸ºç”±äºå…¶å¯åŠ¨æ¨¡å¼å†³å®šäº†ï¼Œå®ƒæœ‰å¯èƒ½è¢«å¤šæ¬¡å¯åŠ¨ï¼Œä¼šå­˜åœ¨å¤šä¸ªå®ä¾‹</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬ä»ä¸‹å¾€ä¸Šåˆ†æï¼Œå…ˆæ¥çœ‹çœ‹ ActivityRecordã€‚</p><h4 id="ActivityRecord"><a href="#ActivityRecord" class="headerlink" title="ActivityRecord"></a>ActivityRecord</h4><blockquote><p>An entry in the history stack, representing an activity.</p></blockquote><p>å¦‚ä»£ç æ³¨é‡Šä¸­æ‰€è¨€ï¼ŒActivityRecord æ˜¯ Activity å†å²æ ˆä¸­çš„ä¸€ä¸ªæ¡ç›®ï¼Œä»£è¡¨äº†ä¸€ä¸ª Activityã€‚æˆ‘ä»¬çœ‹çœ‹å®ƒæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ä»£ç ï¼š</p><pre><code class="java">// package com.android.server.wm.ActivityRecord.javafinal class ActivityRecord extends ConfigurationContainer &#123;    final ActivityTaskManagerService mAtmService; // owner    final IApplicationToken.Stub appToken; // window manager token    final ActivityInfo info; // all about me    ApplicationInfo appInfo; // information about activity&#39;s app    final Intent intent;    // the original intent that generated us    final ComponentName mActivityComponent;  // the intent component, or target of an alias.    final String taskAffinity; // as per ActivityInfo.taskAffinity    private TaskRecord task;        // the task this is in.    ActivityRecord resultTo; // who started this entry, so will get our reply    final int requestCode;  // code given by requester (resultTo)    int launchMode;         // the launch mode activity attribute.    final ActivityStackSupervisor mStackSupervisor;&#125;</code></pre><h3 id="Android-å¦‚ä½•ç®¡ç†-Activity-çŠ¶æ€"><a href="#Android-å¦‚ä½•ç®¡ç†-Activity-çŠ¶æ€" class="headerlink" title="Android å¦‚ä½•ç®¡ç† Activity çŠ¶æ€"></a>Android å¦‚ä½•ç®¡ç† Activity çŠ¶æ€</h3><p>å…ˆæ¥ä¸€å¼ å›¾ï¼Œæˆ‘ä»¬çœ‹çœ‹ Activity çš„å„ç§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯åœ¨ä½•æ—¶è¢«è°ƒç”¨ï¼š</p><p><img src="/img/ams-1587435208.jpg"></p><p>è¿™å„¿å†™æ˜äº†å›è°ƒå„ä¸ªæµç¨‹çš„æ—¶æœºï¼Œå…¶ä¸­åŒ…å«è¿™å¯¹ Activity çŠ¶æ€çš„å¤„ç†ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ŒAndroid ç³»ç»Ÿå¤„ç†çš„ Activity å¾ˆå¤šï¼Œæˆ‘ä»¬å‡†ç¡®æŒ‡ç¤ºå½“å‰ Activity çš„çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯ Activity è°ƒç”¨çš„æ­£ç¡®æ€§ã€‚</p><p>æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸€ä¸ªäº‹ä»¶ï¼šActivity çš„<code>onPause()</code>äº‹ä»¶æ˜¯å¦‚ä½•ä»è§¦æ‘¸å±å¹•å¼€å§‹è§¦å‘çš„ã€‚å› ä¸ºè§¦å‘<code>onPause()</code>çš„é€”å¾„æœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ç§ â€”â€” <strong>æŒ‰ä¸‹äº† HOME é”®</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¾—ä¸€æ­¥æ­¥æ¥ã€‚</p><p>æˆ‘ä»¬åœ¨<a href="/view-event-dispatch/">Viewäº‹ä»¶ä¼ é€’æœºåˆ¶</a>ä¸­æåˆ°è¿‡ï¼Œè§¦æ‘¸ä½œä¸ºä¸€ä¸ª InputEventï¼Œç”± InputManagerService æ¥è¿›è¡Œå¤„ç†ã€‚</p><p>InputManagerService æ­¤æ—¶ä¼šæ”¶åˆ°æ¥è‡ª Native å±‚çš„è°ƒç”¨ï¼š</p><pre><code class="cpp">void NativeInputManager::onPointerDownOutsideFocus(const sp&lt;IBinder&gt;&amp; touchedToken) &#123;    ATRACE_CALL();    JNIEnv* env = jniEnv();    ScopedLocalFrame localFrame(env);    jobject touchedTokenObj = javaObjectForIBinder(env, touchedToken);    env-&gt;CallVoidMethod(mServiceObj, gServiceClassInfo.onPointerDownOutsideFocus, touchedTokenObj);    checkAndClearExceptionFromCallback(env, &quot;onPointerDownOutsideFocus&quot;);&#125;</code></pre><p>è°ƒç”¨äº†å®ƒçš„<code>onPointerDownOutsideFocus()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// Native callback. private void onPointerDownOutsideFocus(IBinder touchedToken) &#123;    /**     * Notifies window manager that a &#123;@link android.view.MotionEvent#ACTION_DOWN&#125; pointer event     * occurred on a window that did not have focus.     *     * @param touchedToken The token for the window that received the input event.     */    mWindowManagerCallbacks.onPointerDownOutsideFocus(touchedToken);&#125;</code></pre><p>æ­¤å¤„çš„<code>mWindowManagerCallback</code>æ˜¯ system_server åœ¨<code>startOtherServices()</code>æ–¹æ³•ä¸­èµ‹å€¼çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="java">// com.android.server.SystemServer.javaprivate void startOtherServices() &#123;    ...    inputManager = new InputManagerService(context);    ...    wm = WindowManagerService.main(context, inputManager, !mFirstBoot, mOnlyCore,                    new PhoneWindowManager(), mActivityManagerService.mActivityTaskManager);    ...    inputManager.setWindowManagerCallbacks(wm.getInputManagerCallback());&#125;</code></pre><p>æ‰€ä»¥æ­¤å¤„çš„<code>onPointerDownOutsideFocus()</code>æ–¹æ³•å°†ç”± InputManagerCallback æ¥å®ç°ï¼š</p><pre><code class="java">// com.android.server.wm.InputManagerCallback.java@Overridepublic void onPointerDownOutsideFocus(IBinder touchedToken) &#123;    // mService ä¹Ÿå³ WindowManagerService çš„å®ä¾‹ï¼Œå®ƒçš„ mH æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ Handler å®ä¾‹    mService.mH.obtainMessage(ON_POINTER_DOWN_OUTSIDE_FOCUS, touchedToken).sendToTarget();&#125;</code></pre><pre><code class="java">// com.android.server.wm.WindowManagerService.javaclass H extends Handler &#123;    @Override    public void handleMessage(Message msg) &#123;        switch(msg.what) &#123;            ...            case ON_POINTER_DOWN_OUTSIDE_FOCUS: &#123;                synchronized (mGlobalLock) &#123;                    final IBinder touchedToken = (IBinder) msg.obj;                    onPointerDownOutsideFocusLocked(touchedToken);                &#125;                break;            &#125;            ...        &#125;    &#125;&#125;private void onPointerDownOutsideFocusLocked(IBinder touchedToken) &#123;    ...    handleDisplayFocusChange(touchedWindow);&#125;private void handleDisplayFocusChange(WindowState window) &#123;    final DisplayContent displayContent = window.getDisplayContent();    ...    // For compatibility, only the topmost activity is allowed to be resumed for pre-Q    // app. Ensure the topmost activities are resumed whenever a display is moved to top.    // TODO(b/123761773): Investigate whether we can move this into    // RootActivityContainer#updateTopResumedActivityIfNeeded(). Currently, it is risky    // to do so because it seems possible to resume activities as part of a larger    // transaction and it&#39;s too early to resume based on current order when performing    // updateTopResumedActivityIfNeeded().    displayContent.mAcitvityDisplay.ensureActivitiesVisible(null /* starting */,            0 /* configChanges */, !PRESERVE_WINDOWS, true /* notifyClients */);&#125;</code></pre><p>DisplayContent.mAcitvityDisplay æ˜¯ä¸€ä¸ª ActivityDisplay ç±»å‹çš„å˜é‡ã€‚ä¸€ä¸ª ActivityDisplay è¡¨ç¤ºä¸€å—å±å¹•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒActivityDisplay åœ¨ Android ç³»ç»Ÿä¸­ï¼Œéƒ½åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ä¸‹é¢æ˜¯ ActivityDisplay çš„ç®€ä»‹ï¼Œå¯ä»¥å›å¤´å†çœ‹ã€‚</p><p>::: tip</p><p><strong>å…³äº ActivityDisplay</strong></p><p>ActivityDisplay ç»´æŠ¤äº†ä¸€ä¸ª ActivityStack çš„æ ˆï¼Œå¹¶ä¸”æœ‰æ·»åŠ å’Œç§»é™¤çš„æ–¹æ³•</p><pre><code class="java">/** * Exactly one of these classes per Display in the system. Capable of holding zero or more * attached &#123;@link ActivityStack&#125;s. */class ActivityDisplay &#123;    ...    /**     * All of the stacks on this display. Order matters, topmost stack is in front of all other     * stacks, bottommost behind. Accessed directly by ActivityManager package classes. Any calls     * changing the list should also call &#123;@link #onStackOrderChanged()&#125;.     */    final ArrayList&lt;ActivityStack&gt; mStacks = new ArrayList&lt;ActivityStack&gt;();    ...    void addChild(ActivityStack stack, int position) &#123;        if (position == POSITION_BOTTOM) &#123;            position = 0;        &#125; else if (position == POSITION_TOP) &#123;            position = mStacks.size();        &#125;        addStackReferenceIfNeeded(stack);        positionChildAt(stack, position);    &#125;    void removeChild(ActivityStack stack) &#123;        mStacks.remove(stack);        ...        onStackOrderChanged(stack);    &#125;    private void positionChildAt(ActivityStack stack, int position, boolean includingParents,            String updateLastFocusedStackReason) &#123;        ...        final int insertPosition = getTopInsertPosition(stack, position);        mStacks.add(insertPosition, stack);        ...        onStackOrderChanged(stack);    &#125;&#125;</code></pre><p>:::</p><p>æˆ‘ä»¬æ¥çœ‹<code>ActivityDisplay.ensureActivitiesVisible()</code>æ–¹æ³•çš„ä»£ç ï¼š</p><pre><code class="java">void ensureActivitiesVisible(ActivityRecord starting, int configChanges,        boolean preserveWindows, boolean notifyClients) &#123;    for (int stackNdx = getChildCount() - 1; stackNdx &gt;= 0; --stackNdx) &#123;        final ActivityStack stack = getChildAt(stackNdx);        stack.ensureActivitiesVisibleLocked(starting, configChanges, preserveWindows,                notifyClients);    &#125;&#125;</code></pre><p>å¾ªç¯è°ƒç”¨äº†æ ˆå†…çš„ ActivityStack çš„<code>ensureActivitiesVisibleLocked()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// com.android.server.vm.ActivityStack.java/** * Ensure visibility with an option to also update the configuration of visible activities. * @see #ensureActivitiesVisibleLocked(ActivityRecord, int, boolean) * @see RootActivityContainer#ensureActivitiesVisible(ActivityRecord, int, boolean) */// TODO: Should be re-worked based on the fact that each task as a stack in most cases.// ç”±è¿™ä¸ª TODO å¯ä»¥çœ‹å‡ºï¼Œæ—¥å Android å¿…å®šä¼šå˜æˆä¸€ä¸ª task ä¸­åªæœ‰ä¸€ä¸ª stackï¼Œæ¯•ç«Ÿå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯è¿™æ ·çš„final void ensureActivitiesVisibleLocked(ActivityRecord starting, int configChanges,        boolean preserveWindows, boolean notifyClients) &#123;    ...        for (int taskNdx = mTaskHistory.size() - 1; taskNdx &gt;= 0; --taskNdx) &#123;            ...            final TaskRecord task = mTaskHistory.get(taskNdx);            final ArrayList&lt;ActivityRecord&gt; activities = task.mActivities;            for (int activityNdx = activities.size() - 1; activityNdx &gt;= 0; --activityNdx) &#123;                final ActivityRecord r = activities.get(activityNdx);                ...                r.makeClientVisible();                ...            &#125;&#125;</code></pre><p>æ¥åˆ°äº†<code>ActivityRecord.makeClientVisible()</code>ï¼š</p><pre><code class="java">// com.android.server.wm.ActivityRecord.java/** Send visibility change message to the client and pause if needed. */void makeClientVisible() &#123;    ...    makeActiveIfNeeded(null /* activeActivity*/);    ...&#125;/** * Make activity resumed or paused if needed. * @param activeActivity an activity that is resumed or just completed pause action. *                       We won&#39;t change the state of this activity. */boolean makeActiveIfNeeded(ActivityRecord activeActivity) &#123;    if (shouldResumeActivity(activeActivity)) &#123;        return getActivityStack().resumeTopActivityUncheckedLocked(activeActivity /* prev */,                null /* options */);    &#125; else if (shouldPauseActivity(activeActivity)) &#123;        ...    &#125;    return false;&#125;</code></pre><p>åˆè°ƒç”¨äº† ActivityStack çš„<code>resumeTopActivityUncheckedLocked()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// com.android.server.wm.ActivityStack.java/** * Ensure that the top activity in the stack is resumed. * * @param prev The previously resumed activity, for when in the process * of pausing; can be null to call from elsewhere. * @param options Activity options. * * @return Returns true if something is being resumed, or false if * nothing happened. * * NOTE: It is not safe to call this method directly as it can cause an activity in a *       non-focused stack to be resumed. *       Use &#123;@link RootActivityContainer#resumeFocusedStacksTopActivities&#125; to resume the *       right activity for the current system state. */@GuardedBy(&quot;mService&quot;)boolean resumeTopActivityUncheckedLocked(ActivityRecord prev, ActivityOptions options) &#123;    ...    result = resumeTopActivityInnerLocked(prev, options);    ...    return result;&#125;@GuardedBy(&quot;mService&quot;)private boolean resumeTopActivityInnerLocked(ActivityRecord prev, ActivityOptions options) &#123;    ...    pausing |= startPausingLocked(userLeaving, false, next, false);    ...&#125;</code></pre><!--ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬è®²è¿‡ ActivityRecordã€ActivityClientRecordã€Activity çš„å…³ç³»ï¼Œé‚£ä¹ˆAndroidç³»ç»Ÿåˆæ˜¯å¦‚ä½•åˆ©ç”¨è¿™å±‚å¯¹åº”å…³ç³»çš„å‘¢ã€‚æ¯”å¦‚å¯åŠ¨ Activity æ—¶éœ€è¦ä»¤ä¸Šä¸€ä¸ª Activity æ‰§è¡Œ onPause() æ–¹æ³•ã€‚è¿™æ—¶ä¼šç»å†ä»¥ä¸‹æ–¹æ³•è°ƒç”¨é“¾ï¼š ```javaActivityStack.startPausingLocked() IApplicationThread.schudulePauseActivity() ActivityThread.sendMessage() ActivityThread.H.sendMessage(); ActivityThread.H.handleMessage() ActivityThread.handlePauseActivity() ActivityThread.performPauseActivity() Activity.performPause() Activity.onPause() ActivityManagerNative.getDefault().activityPaused(token) ActivityManagerService.activityPaused() ActivityStack.activityPausedLocked() ActivityStack.completePauseLocked()``` --><pre><code class="java">// com.android.server.wm.ActivityStack.javaActivityTaskManagerService mService;final boolean startPausingLocked(boolean userLeaving, boolean uiSleeping,            ActivityRecord resuming, boolean pauseImmediately) &#123;    ...    ActivityRecord prev = mResumedActivity;    ...    if (prev.attachedToProcess()) &#123;        ...        try &#123;            ...            //prev å°±æ˜¯å½“å‰è·å¾—ç„¦ç‚¹çš„ ActivityRecordï¼Œç°åœ¨çš„ç›®çš„æ˜¯ä»¤è¯¥ ActivityRecord å¯¹åº”çš„ Activity è°ƒç”¨ onPause() æ–¹æ³•            ...            mService.getLifecycleManager().scheduleTransaction(prev.app.getThread(),                    prev.appToken, PauseActivityItem.obtain(prev.finishing, userLeaving,                            prev.configChangeFlags, pauseImmediately));        &#125; catch (Exception e) &#123;            ...            mPausingActivity = null;            mLastPausedActivity = null;            mLastNoHistoryActivity = null;        &#125;    &#125; else &#123;        mPausingActivity = null;        mLastPausedActivity = null;        mLastNoHistoryActivity = null;    &#125;    ...&#125;</code></pre><p><code>mService</code>ä¹Ÿå³ ActivityTaskManagerServiceï¼Œå®ƒçš„<code>getLifecycleManager()</code>è·å–äº†ä¸€ä¸ª ClientLifecycleManager çš„å†…éƒ¨å®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ƒçš„<code>schedultTransaction()</code>æ–¹æ³•ã€‚PauseActivityItem æ˜¯ ActivityLifecycleItem çš„æ´¾ç”Ÿç±»ï¼š</p><pre><code class="java">// com.android.server.wm.ActivityStack.javavoid scheduleTransaction(@NonNull IApplicationThread client, @NonNull IBinder activityToken,        @NonNull ActivityLifecycleItem stateRequest) throws RemoteException &#123;    final ClientTransaction clientTransaction = transactionWithState(client, activityToken,            stateRequest);    scheduleTransaction(clientTransaction);&#125;void scheduleTransaction(ClientTransaction transaction) throws RemoteException &#123;    final IApplicationThread client = transaction.getClient();    transaction.schedule();    if (!(client instanceof Binder)) &#123;        // If client is not an instance of Binder - it&#39;s a remote call and at this point it is        // safe to recycle the object. All objects used for local calls will be recycled after        // the transaction is executed on client in ActivityThread.        transaction.recycle();    &#125;&#125;</code></pre><p>ClientTransaction ç±»æ˜¯ä¸€ä¸ª Parcelableï¼Œçœ‹å‘½åæ–¹å¼ï¼Œå°±çŸ¥é“è¿™åˆæ¶‰åŠåˆ° Binder é€šè®¯äº†ï¼š</p><pre><code class="java">// android.app.servertransaction.ClientTransactionpublic class ClientTransaction implements Parcelable, ObjectPoolItem &#123;    ...    private IApplicationThread mClient;    ...    // è¿™é‡Œçš„å¤„ç†åˆ†ä¸º3æ­¥ï¼š    // 1. client ç«¯è°ƒç”¨ preExecute(ClientTransactionHandler)ï¼Œå°†ä¼šè§¦å‘ä¸€ç³»åˆ—çš„å‡†å¤‡å·¥ä½œï¼ŒåŒ…æ‹¬è®¾ç½®å›è°ƒï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰ç­‰    // 2. å‡†å¤‡ä¼ é€’çš„æ¶ˆæ¯    // 3. client ç«¯è°ƒç”¨ TransactionExecutor.execute(ClientTransaction)ï¼Œå°†ä¼šæ‰§è¡Œæ‰€æœ‰çš„å›è°ƒå’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•    public void schedule() throws RemoteException &#123;        mClient.scheduleTransaction(this);    &#125;&#125;</code></pre><p>ä¹Ÿå³å°† pauseActivity çš„å·¥ä½œäº¤ç»™äº†äº¤ç»™äº†åº”ç”¨è¿›ç¨‹çš„ ActivityThreadï¼š</p><pre><code class="java">@Overridepublic void scheduleTransaction(ClientTransaction transaction) throws RemoteException &#123;    ActivityThread.this.scheduleTransaction(transaction);&#125;</code></pre><p>ä½†æ˜¯ ActivityThread å¹¶æ²¡æœ‰ç›´æ¥å¤„ç†è¿™ä¸ª transactionï¼Œè€Œæ˜¯åˆè°ƒç”¨äº†<code>scheduleTransaction()</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥è‡ªäºå®ƒçš„<strong>æŠ½è±¡çˆ¶ç±»</strong>ClientTransactionHandlerï¼š</p><pre><code class="java">/** * Defines operations that a &#123;@link android.app.servertransaction.ClientTransaction&#125; or its items * can perform on client. * @hide */public abstract class ClientTransactionHandler &#123;    // Schedule phase related logic and handlers.    /** Prepare and schedule transaction for execution. */    void scheduleTransaction(ClientTransaction transaction) &#123;        transaction.preExecute(this);        // H extends Handlerï¼Œ å®ƒå®šä¹‰äº† ActivityThread æ‰€éœ€è¦å¤„ç†çš„æ‰€æœ‰äº‹ä»¶çš„ code        // EXECUTE_TRANSACTION å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œä»£è¡¨è¦è½¬æ¢ Activity çš„çŠ¶æ€äº†        // è€Œ sendMessage æ–¹æ³•ç”± ActivityThread æ–¹æ³•å®ç°ï¼Œæœ€ç»ˆå°†æ¶ˆæ¯å‘é€åˆ° ActivityThread çš„æˆå‘˜å˜é‡ mH ä¸­ï¼ˆHç±»çš„å®ä¾‹ï¼‰        sendMessage(ActivityThread.H.EXECUTE_TRANSACTION, transaction);    &#125;&#125;</code></pre><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª H åšäº†ä»€ä¹ˆï¼š</p><pre><code class="java">switch(msg.what) &#123;    ...    case EXECUTE_TRANSACTION:        final ClientTransaction transaction = (ClientTransaction) msg.obj;        mTransactionExecutor.execute(transaction);        if (isSystem()) &#123;            // Client transactions inside system process are recycled on the client side            // instead of ClientLifecycleManager to avoid being cleared before this            // message is handled.            transaction.recycle();        &#125;        // TODO(lifecycler): Recycle locally scheduled transactions.        break;    ...&#125;</code></pre><p>å•Šã€‚ã€‚ç»•å¾—è¿˜çœŸè¿œï¼Œåˆå‡ºç°äº†ä¸€ä¸ª TransactionExecutor ç±»ã€‚è¿™ä¸ªç±»çš„ä½œç”¨æ˜¯<strong>ä¿è¯ä¸€ä¸ª transaction è½¬æ¢è¿‡ç¨‹èƒ½å¤ŸæŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œ</strong>ã€‚</p><p>ç»è¿‡ä¸€ç³»åˆ—è°ƒç”¨ï¼Œæœ€ç»ˆä¼šè¿è¡Œåˆ°å®ƒçš„è¿™ä¸€å¥ï¼š</p><pre><code class="java">performLifecycleSequence(r, path, transaction);</code></pre><p>è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class="java">private void performLifecycleSequence(ActivityClientRecord r, IntArray path,                                                  ClientTransaction transaction) &#123;    final int size = path.size();        for (int i = 0, state; i &lt; size; i++) &#123;               state = path.get(i);            switch (state) &#123;                  ...                case ON_PAUSE:                    mTransactionHandler.handlePauseActivity(r.token, false /* finished */,                            false /* userLeaving */, 0 /* configChanges */, mPendingActions,                            &quot;LIFECYCLER_PAUSE_ACTIVITY&quot;);                    break;                ...            &#125;                                               </code></pre><p>ç»•å•Šç»•å•Šç»•ï¼Œæœ€ç»ˆè¿˜æ˜¯ç»•å›äº†<code>ActivityThread.handlePauseActivity()</code>æ–¹æ³•ï¼š</p><pre><code class="java">@Overridepublic void handlePauseActivity(IBinder token, boolean finished, boolean userLeaving,        int configChanges, PendingTransactionActions pendingActions, String reason) &#123;    ActivityClientRecord r = mActivities.get(token);    if (r != null) &#123;        if (userLeaving) &#123;            performUserLeavingActivity(r);        &#125;        r.activity.mConfigChangeFlags |= configChanges;        performPauseActivity(r, finished, reason, pendingActions);        // Make sure any pending writes are now committed.        if (r.isPreHoneycomb()) &#123;            QueuedWork.waitToFinish();        &#125;        mSomeActivitiesChanged = true;    &#125;&#125;final Bundle performPauseActivity(ActivityClientRecord r, boolean finished, String reason,            PendingTransactionActions pendingActions) &#123;    ...    // ä¹‹å‰å¯åŠ¨Activityæ—¶ä¼šè°ƒç”¨ performLaunchActivity()ï¼Œå¹¶åœ¨æœ€åä»¥ token ä¸º Keyï¼ŒActivityClientRecord ä¸º value ä¿å­˜ ActivityClientRecordã€‚    // ç„¶ååˆ°äº† performPauseActivity() ä¸­åˆä¼šæ ¹æ® token å–å‡ºå¯¹åº” ActivityClientRecordã€‚    // å†è°ƒç”¨ ActivityClientRecord ä¸­ä¿å­˜çš„ activity çš„ onPause() æ–¹æ³•    performPauseActivityIfNeeded(r, reason);    ...&#125;private void performPauseActivityIfNeeded(ActivityClientRecord r, String reason) &#123;    ...    mInstrumentation.callActivityOnPause(r.activity);    ...&#125;public class Instrumentation &#123;    public void callActivityOnPause(Activity activity) &#123;        activity.performPause();    &#125;&#125;</code></pre><p>è‡³æ­¤ï¼Œæ‰å®Œæˆäº† Activity çš„ pause è¿‡ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Framework </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android é¢è¯•é¢˜åˆé›†</title>
      <link href="/2020-04-02/job-interview/"/>
      <url>/2020-04-02/job-interview/</url>
      
        <content type="html"><![CDATA[<p>å…”å­è‡ªå·±æ€»ç»“çš„ä¸€äº›é¢è¯•é¢˜ã€‚é¢˜ç›®ä¼šæ…¢æ…¢å˜å¤šï¼Œç­”æ¡ˆä¹Ÿå…¨éƒ¨æ˜¯è‡ªå·±å†™çš„ï¼Œå¹¶éç½‘ä¸Šæ‰¾çš„ç­”æ¡ˆã€‚</p><p>è¿˜æœ‰ä¸€ç¯‡<a href="/awesome-android-job-interview/">Awesome Android Job Interview</a></p><span id="more"></span><h2 id="Java-éƒ¨åˆ†"><a href="#Java-éƒ¨åˆ†" class="headerlink" title="Java éƒ¨åˆ†"></a>Java éƒ¨åˆ†</h2><h3 id="Stringã€StringBufferã€StringBuilder-åŒºåˆ«"><a href="#Stringã€StringBufferã€StringBuilder-åŒºåˆ«" class="headerlink" title="Stringã€StringBufferã€StringBuilder åŒºåˆ«"></a>Stringã€StringBufferã€StringBuilder åŒºåˆ«</h3><p>String çš„å€¼æ˜¯<strong>ä¸å¯å˜</strong>çš„ï¼Œå¯¹ String çš„<strong>æ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„å¯¹è±¡</strong>ã€‚è¿™ä¼šå¯¼è‡´æ•ˆç‡ä½ï¼Œæœ‰å¯èƒ½ä¼šé¢‘ç¹è§¦å‘ GC æœºåˆ¶ã€‚</p><p>StringBuffer æ˜¯<strong>çº¿ç¨‹å®‰å…¨çš„ï¼Œé€Ÿåº¦è¾ƒæ…¢</strong>ã€‚å®ƒä½¿ç”¨çš„æ–¹æ³•æ˜¯åœ¨å„ç§æ“ä½œæ–¹æ³•ä¸ŠåŠ ä¸Šäº†<code>synchronized</code>å…³é”®å­—ã€‚</p><p>StringBuilder æ˜¯<strong>çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œé€Ÿåº¦è¾ƒå¿«</strong>ã€‚</p><p>StringBuffer ç”¨åœ¨æœ‰å¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ä½¿ç”¨ã€‚</p><p>StringBuilder ç”¨åœ¨æŸä¸€ä¸ªçº¿ç¨‹å†…éƒ¨æ¯”è¾ƒåˆé€‚ã€‚</p><h3 id="String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼Ÿ"><a href="#String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼Ÿ" class="headerlink" title="String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼Ÿ"></a>String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼Ÿ</h3><p>æˆ‘ä»¬çœ‹çœ‹ String çš„éƒ¨åˆ†ä»£ç å°±çŸ¥é“äº†ï¼š</p><pre><code class="java">public final class String    implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;    /** The value is used for character storage. */    private final char value[];    ... &#125;</code></pre><p>value ä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œå®ƒçš„æŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­çš„åœ°å€å°±ä¸èƒ½å†æ”¹å˜äº†ã€‚è™½ç„¶ value æ•°ç»„æœ¬èº«æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯ String ç±»å¹¶æ²¡æœ‰æä¾›ä»»ä½•æ–¹æ³•æ¥æ”¹å˜è¿™ä¸ªç§æœ‰çš„æˆå‘˜å˜é‡ã€‚æ‰€ä»¥æœ‰æ—¶<code>substring()</code>çœ‹èµ·æ¥ä¼¼ä¹æ˜¯æ”¹å˜äº† String çš„å€¼ï¼Œä½†å…¶å®æ˜¯ä¸€ç€ã€å·æ¢æ¢æŸ±ã€ï¼Œå·²ç»äº§ç”Ÿäº†æ–°çš„å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬æ¥åšä¸ªå®éªŒï¼š</p><pre><code class="java">String a = &quot;123&quot;;String a = a.substring(1);</code></pre><p>æˆ‘ä»¬ debug ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„å¯¹è±¡æ˜¯å¦äº§ç”Ÿäº†å˜åŒ–ã€‚</p><p>å½“æ–­ç‚¹å¡åœ¨ç¬¬ä¸€è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œa å¯¹è±¡æ˜¯ 515ï¼Œå¦‚ä¸‹å›¾ï¼š</p><div class="center-img"><p><img src="/img/interview-1588327190.png"></p></div><p>å½“æ‰§è¡Œå®Œ<code>substring()</code>æ–¹æ³•åï¼š</p><div class="center-img"><p><img src="/img/interview-1588327213.png"></p></div><p>å¯è§å¯¹è±¡å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œæ˜¯ 518 äº†ã€‚</p><p>è¿™åªæ˜¯ä»ä»£ç å±‚é¢è§£é‡Šäº†ä¸ºä»€ä¹ˆ String ä¸å¯å˜ã€‚é‚£ Java è¿™æ ·è®¾è®¡çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><ol><li><strong>å®‰å…¨å±‚é¢</strong>ã€‚åœ¨ JDK ä¸­ï¼ŒJava çš„ç±»è£…è½½æœºåˆ¶é€šè¿‡ä¼ é€’çš„å‚æ•°ï¼ˆé€šå¸¸æ˜¯ç±»åï¼‰åŠ è½½ç±»ï¼Œè¿™äº›ç±»ååœ¨ç±»è·¯å¾„ä¸‹ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå‡è®¾ String æ˜¯å¯å˜çš„ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰ç±»è£…è½½æœºåˆ¶åˆ†åˆ†é’Ÿé»‘æ‰åº”ç”¨ã€‚å¦‚æœæ²¡æœ‰äº†å®‰å…¨ï¼ŒJavaä¸ä¼šèµ°åˆ°ä»Šå¤©ã€‚</li><li><strong>æ€§èƒ½å±‚é¢</strong>ã€‚String ä¸å¯å˜çš„è®¾è®¡å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå½“ç„¶èƒŒåçš„åŸç†æ˜¯ String Poolï¼Œå½“ç„¶ String Pool ä¸å¯èƒ½ä½¿ String ç±»ä¸å¯å˜ï¼Œä¸å¯å˜çš„ String èƒ½æ›´å¥½çš„æé«˜æ€§èƒ½ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ç»å¯¹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ol><h3 id="String-Pool-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#String-Pool-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="String Pool æ˜¯ä»€ä¹ˆï¼Ÿ"></a>String Pool æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>JVMä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œ<strong>é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»º</strong>ï¼Œå…¶ç»´æŠ¤äº†ä¸€å—ç‰¹æ®Šçš„å†…å­˜ç©ºé—´ï¼Œå³å­—ç¬¦ä¸²æ± ï¼ˆString Poolï¼‰ã€‚å­—ç¬¦ä¸²æ± ç”±Stringç±»ç§æœ‰çš„ç»´æŠ¤ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Javaä¸­æœ‰ä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹å¼ï¼š</p><ol><li>é‡‡ç”¨å­—é¢å€¼çš„æ–¹å¼èµ‹å€¼</li><li>é‡‡ç”¨<code>new</code>å…³é”®å­—æ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</li></ol><p>è¿™ä¸¤ç§æ–¹å¼åœ¨æ€§èƒ½å’Œå†…å­˜å ç”¨æ–¹é¢å­˜åœ¨ç€å·®åˆ«ã€‚</p><p>æ–¹å¼ä¸€ï¼šå­—é¢æ–¹å¼èµ‹å€¼ã€‚</p><p>å½“æˆ‘ä»¬é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼èµ‹å€¼çš„æ—¶å€™ï¼š</p><pre><code class="java">String str = &quot;hello&quot;;String str2 = &quot;hello&quot;;</code></pre><p>JVMé¦–å…ˆä¼šå»å­—ç¬¦ä¸²æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨<code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœ<strong>ä¸å­˜åœ¨</strong>ï¼Œåˆ™åœ¨å­—ç¬¦ä¸²æ± ä¸­<strong>åˆ›å»º</strong><code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡ï¼Œç„¶åå°†æ± ä¸­<code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨åœ°å€è¿”å›ç»™å­—ç¬¦ä¸²å¸¸é‡<code>str</code>ï¼Œè¿™æ ·<code>str</code>ä¼šæŒ‡å‘æ± ä¸­<code>&quot;hello&quot;</code>è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼›å¦‚æœ<strong>å­˜åœ¨</strong>ï¼Œåˆ™<strong>ä¸åˆ›å»º</strong>ä»»ä½•å¯¹è±¡ï¼Œç›´æ¥å°†æ± ä¸­<code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡çš„åœ°å€è¿”å›ï¼Œèµ‹ç»™å­—ç¬¦ä¸²å¸¸é‡ã€‚</p><p>å¦‚æœæˆ‘ç°åœ¨è°ƒç”¨<code>str == str2</code>ä¼šå¾—åˆ°<code>true</code>ã€‚å› ä¸ºåˆ›å»ºå­—ç¬¦ä¸²<code>str2</code>æ—¶ï¼Œåœ¨å­—ç¬¦ä¸²æ± ä¸­å·²ç»æœ‰äº†<code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡ï¼Œå°±ç›´æ¥æŠŠå¯¹è±¡<code>&quot;hello&quot;</code>çš„å¼•ç”¨åœ°å€è¿”å›ç»™<code>str2</code>ï¼Œè¿™æ ·<code>str2</code>æŒ‡å‘äº†æ± ä¸­<code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´<code>str</code>å’Œ<code>str2</code>æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œ<code>str == str2</code>è‡ªç„¶å°±æ˜¯<code>true</code>ã€‚</p><p>æ–¹å¼äºŒï¼šç”¨<code>new</code>å…³é”®å­—åˆ›å»ºã€‚</p><pre><code class="java">String str3 = new String(&quot;hello&quot;);String str4 = new String(&quot;hello&quot;);</code></pre><p>é‡‡ç”¨<code>new</code>å…³é”®å­—æ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJVM é¦–å…ˆåœ¨å­—ç¬¦ä¸²æ± ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰<code>&quot;hello&quot;</code>è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚æœ<strong>æœ‰</strong>ï¼Œåˆ™<strong>ä¸åœ¨æ± ä¸­å†å»åˆ›å»º</strong><code>&quot;hello&quot;</code>è¿™ä¸ªå¯¹è±¡äº†ï¼Œç›´æ¥åœ¨<strong>å †ä¸­åˆ›å»º</strong>ä¸€ä¸ª<code>&quot;hello&quot;</code>å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†å †ä¸­çš„è¿™ä¸ª<code>&quot;hello&quot;</code>å¯¹è±¡çš„åœ°å€è¿”å›èµ‹ç»™å¼•ç”¨<code>str3</code>ï¼Œè¿™æ ·ï¼Œ<code>str3</code>å°±æŒ‡å‘äº†å †ä¸­åˆ›å»ºçš„è¿™ä¸ª<code>&quot;hello&quot;</code>å­—ç¬¦ä¸²å¯¹è±¡ï¼›å¦‚æœ<strong>æ²¡æœ‰</strong>ï¼Œåˆ™é¦–å…ˆåœ¨<strong>å­—ç¬¦ä¸²æ± ä¸­åˆ›å»ºä¸€ä¸ª</strong><code>&quot;hello&quot;</code>å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†åœ¨<strong>å †ä¸­åˆ›å»ºä¸€ä¸ª</strong><code>&quot;hello&quot;</code>å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†å †ä¸­è¿™ä¸ª<code>&quot;hello&quot;</code>å­—ç¬¦ä¸²å¯¹è±¡çš„åœ°å€è¿”å›èµ‹ç»™<code>str3</code>å¼•ç”¨ï¼Œè¿™æ ·ï¼Œ<code>str3</code>æŒ‡å‘äº†å †ä¸­åˆ›å»ºçš„è¿™ä¸ª<code>&quot;hello&quot;</code>å­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><p>ç„¶é¹…ï¼Œè¿™ä¸¤ä¸ªæ˜¯ç”¨<code>new</code>åˆ›å»ºçš„å¯¹è±¡ï¼Œ<code>str3</code>å’Œ<code>str4</code>æŒ‡å‘çš„å¿…ç„¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå †ä¸­åˆ›å»ºçš„ä¸¤ä¸ª<code>&quot;hello&quot;</code>å¹¶ä¸æ˜¯åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œæ‰€ä»¥è°ƒç”¨<code>str3 == str4</code>çš„è¯ï¼Œè¿”å›çš„æ˜¯<code>false</code>ã€‚</p><p>è¯šç„¶ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ± å¾—æœ‰ä¸ªå‰ææ¡ä»¶ï¼šString å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚å› ä¸ºè¿™æ ·å¯ä»¥<strong>ä¿è¯å¤šä¸ªå¼•ç”¨å¯ä»¥åŒæ—¶æŒ‡å‘å­—ç¬¦ä¸²æ± ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</strong>ã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆä¸€ä¸ªå¼•ç”¨æ“ä½œæ”¹å˜äº†å¯¹è±¡çš„å€¼ï¼Œå¯¹å…¶ä»–å¼•ç”¨ä¼šæœ‰å½±å“ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šé¿å…äº†ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²çš„åˆ›å»ºï¼ŒèŠ‚çœäº†å†…å­˜ï¼Œçœå»äº†åˆ›å»ºç›¸åŒå­—ç¬¦ä¸²çš„æ—¶é—´ï¼ŒåŒæ—¶æå‡äº†æ€§èƒ½ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šç‰ºç‰²äº† JVM åœ¨å¸¸é‡æ± ä¸­éå†å¯¹è±¡æ‰€éœ€è¦çš„æ—¶é—´ï¼Œä¸è¿‡å…¶æ—¶é—´æˆæœ¬ç›¸æ¯”è€Œè¨€æ¯”è¾ƒä½ã€‚</p><p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼Œå­—ç¬¦ä¸²æ± ä¸­ç»´æŠ¤äº†å…±äº«çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè¿™äº›å­—ç¬¦ä¸²<strong>ä¸ä¼šè¢« GC å›æ”¶</strong>ã€‚</p><h3 id="é™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#é™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>é™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>é™æ€ä»£ç†é€šå¸¸åªèƒ½ä»£ç†ä¸€ä¸ªç±»ï¼Œæ¯ä»£ç†ä¸€ä¸ªç±»ï¼Œå°±éœ€è¦å¤šå†™ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¼šè¢«ç¼–è¯‘è¿› .class æ–‡ä»¶ä¸­ã€‚<br>åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œè·å–è¢«ä»£ç†ç±»çš„ class å¯¹è±¡ï¼Œé€šè¿‡ Java æä¾›çš„ Proxy ç±»æ¥è·å–ä»£ç†å¯¹è±¡ã€‚å®ƒçš„æœ¬è´¨æ˜¯ç”¨ Class æ¥åˆ¶é€  Classã€‚</p><h3 id="çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ"><a href="#çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ" class="headerlink" title="çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ"></a>çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ</h3><p>ä¸èƒ½ã€‚é‡å†™æŒ‡çš„æ˜¯<strong>æ ¹æ®è¿è¡Œæ—¶å¯¹è±¡çš„ç±»å‹æ¥å†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯æ ¹æ®ç¼–è¯‘æ—¶çš„ç±»å‹</strong>ã€‚å¯¹äºé™æ€æ–¹æ³•å’Œé™æ€å˜é‡æ¥è¯´ï¼Œè™½ç„¶åœ¨ä»£ç ä¸­ä½¿ç”¨å­ç±»å¯¹è±¡æ¥è¿›è¡Œè°ƒç”¨ï¼Œä½†æ˜¯åº•å±‚ä¸Šè¿˜æ˜¯ä½¿ç”¨çˆ¶ç±»æ¥è°ƒç”¨çš„ï¼Œé™æ€å˜é‡å’Œé™æ€æ–¹æ³•åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å°†å…¶ä¸ç±»ç»‘å®šåœ¨ä¸€èµ·ã€‚æ—¢ç„¶å®ƒä»¬åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å†³å®šäº†è°ƒç”¨çš„æ–¹æ³•ã€å˜é‡ï¼Œé‚£å°±å’Œé‡å†™æ²¡æœ‰å…³ç³»äº†ã€‚</p><h3 id="å•ä¾‹æ¨¡å¼çš„åˆ†ç±»ï¼Ÿ"><a href="#å•ä¾‹æ¨¡å¼çš„åˆ†ç±»ï¼Ÿ" class="headerlink" title="å•ä¾‹æ¨¡å¼çš„åˆ†ç±»ï¼Ÿ"></a>å•ä¾‹æ¨¡å¼çš„åˆ†ç±»ï¼Ÿ</h3><p><strong>é¥¿æ±‰å¼</strong>ï¼šåœ¨ç±»åŠ è½½æ—¶å°±æ„å»ºå®ä¾‹ï¼Œç«‹å³åˆå§‹åŒ–ï¼š</p><pre><code class="java">/*** é¥¿æ±‰å¼ï¼ˆæ¨èï¼‰**/public class Test &#123;        private Test() &#123;&#125;        private static Test instance = new Test();        public Test getInstance() &#123;                return instance;        &#125;&#125;</code></pre><p><strong>ä¼˜ç‚¹</strong>ï¼šå› ä¸ºç±»åœ¨åŠ è½½æ—¶å°±æ„å»ºï¼Œæ‰€ä»¥æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼›åœ¨ç±»åŠ è½½çš„åŒæ—¶å·²ç»åˆ›å»ºå¥½ä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œ<strong>è°ƒç”¨æ—¶ååº”é€Ÿåº¦å¿«</strong>ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼š<code>getInstance()</code>å¯èƒ½æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°ï¼Œä½†æ‰§è¡Œè¯¥ç±»çš„å…¶ä»–é™æ€æ–¹æ³•æˆ–è€…åŠ è½½äº†è¯¥ç±»ï¼ˆclass.forName)ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ä¾‹ä»ç„¶ä¼šåˆå§‹åŒ–ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚</p><p><strong>æ‡’æ±‰å¼</strong>ï¼šåœ¨åˆæ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œå»¶è¿ŸåŠ è½½ï¼š</p><pre><code class="java">class Test &#123;        private Test() &#123;        &#125;        private static Test instance = null;        public static Test getInstance() &#123;                if (instance == null) &#123;                        instance = new Singleton2();                &#125;                return instance;        &#125;&#125;</code></pre><p><strong>ä¼˜ç‚¹</strong>ï¼šé¿å…äº†é¥¿æ±‰å¼çš„é‚£ç§åœ¨æ²¡æœ‰ç”¨åˆ°çš„æƒ…å†µä¸‹åˆ›å»ºäº‹ä¾‹ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œ<strong>ä¸æ‰§è¡Œ<code>getInstance()</code>å°±ä¸ä¼šåˆ›å»ºå®ä¾‹</strong>ï¼Œå¯ä»¥æ‰§è¡Œè¯¥ç±»çš„å…¶ä»–é™æ€æ–¹æ³•ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šçº¿ç¨‹ä¸å®‰å…¨ã€‚æ‡’æ±‰å¼åœ¨å•ä¸ªçº¿ç¨‹ä¸­æ²¡æœ‰é—®é¢˜ï¼Œä½†å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®çš„æ—¶å€™å°±å¯èƒ½åŒæ—¶åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œè€Œä¸”è¿™å¤šä¸ªå®ä¾‹ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè™½ç„¶åé¢åˆ›å»ºçš„å®ä¾‹ä¼šè¦†ç›–å…ˆåˆ›å»ºçš„å®ä¾‹ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå­˜åœ¨æ‹¿åˆ°ä¸åŒå¯¹è±¡çš„æƒ…å†µã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯åŠ é”<code>synchonized</code>ï¼Œç¬¬ä¸€æ¬¡åŠ è½½æ—¶ä¸å¤Ÿå¿«ï¼Œå¤šçº¿ç¨‹ä½¿ç”¨ä¸å¿…è¦çš„åŒæ­¥å¼€é”€å¤§ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•æ„å»º<strong>çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹</strong>å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ç§æ€è€ƒï¼Œåœ¨<code>getInstance()</code>ä¸ŠåŠ ä¸Šä¸ªåŒæ­¥é”ï¼š</p><pre><code class="java">class Test &#123;    private Test() &#123;    &#125;    private static Test instance = null;    public synchonized static Test getInstance() &#123;        if (instance == null) &#123;                instance = new Singleton2();        &#125;        return instance;    &#125;&#125;</code></pre><p>é—®é¢˜å¯ä»¥å¾—åˆ°è§£å†³ï¼Œä½†æ˜¯å› ä¸º<code>synchronized</code>å…³é”®å­—æ˜¯é‡é‡çº§é”ï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç çš„æ•ˆç‡ä¼šæ¯”è¾ƒä½ã€‚æœ‰æ²¡æœ‰æ”¹å–„æ–¹æ¡ˆï¼Ÿ</p><p>æœ‰ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¼•å…¥<strong>åŒæ£€æŸ¥é”æœºåˆ¶</strong>ï¼Œåœ¨çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œåˆèƒ½è¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼š</p><pre><code class="java">public class Test &#123;      private Test() &#123;    &#125;      volatile private static Test instance = null; // ä½¿ç”¨ volatile å…³é”®å­—ä¿è¯å†…å­˜å¯è§æ€§    public static Test getInstance() &#123;        if(instance != null)&#123; //æ‡’æ±‰å¼                return instance;        &#125; else &#123;            synchronized (Test.class) &#123;                if (instance == null)&#123; // äºŒæ¬¡æ£€æŸ¥                    instance = new Test();                &#125;            &#125;        &#125;        return instance;    &#125;&#125;</code></pre><p>è¿™é‡Œåœ¨å£°æ˜å˜é‡æ—¶ä½¿ç”¨äº†<code>volatile</code>å…³é”®å­—æ¥ä¿è¯å…¶çº¿ç¨‹é—´çš„å¯è§æ€§ï¼›åœ¨åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨<strong>äºŒæ¬¡æ£€æŸ¥</strong>ï¼Œä»¥ä¿è¯å…¶ä¸è¢«é‡å¤å®ä¾‹åŒ–ã€‚é›†åˆå…¶äºŒè€…ï¼Œè¿™ç§å®ç°æ–¹å¼æ—¢ä¿è¯äº†å…¶é«˜æ•ˆæ€§ï¼Œä¹Ÿä¿è¯äº†å…¶çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹æ³¨è§£"><a href="#ä»‹ç»ä¸€ä¸‹æ³¨è§£" class="headerlink" title="ä»‹ç»ä¸€ä¸‹æ³¨è§£"></a>ä»‹ç»ä¸€ä¸‹æ³¨è§£</h3><p>æ³¨è§£æ˜¯ä¸€ç§ç±»ä¼¼æ³¨é‡Šçš„æœºåˆ¶ï¼Œå‘Šè¯‰ç±»å¦‚ä½•è¿è¡Œã€‚å®ƒå¯ä»¥åº”ç”¨äºåŒ…ã€ç±»å‹ã€æ„é€ æ–¹æ³•ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ã€å‚æ•°ä¸Šã€‚</p><p>Java ä¸­çš„æ³¨è§£åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>æ ‡å‡†æ³¨è§£</strong>å’Œ<strong>å…ƒæ³¨è§£</strong>ã€‚</p><p>æ ‡å‡†æ³¨è§£åŒ…æ‹¬ï¼š</p><ul><li><code>Override</code>ï¼šé™å®šé‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œè¯¥æ³¨è§£åªèƒ½ç”¨äºæ–¹æ³•ï¼›</li><li><code>Deprecated</code>ï¼šè¡¨ç¤ºè¯¥ç¨‹åºå…ƒç´ å·²è¿‡æ—¶ï¼›</li><li><code>SupressWarnings</code>ï¼šæŠµåˆ¶ç¼–è¯‘å™¨çš„è­¦å‘Šã€‚</li></ul><p>å…ƒæ³¨è§£åŒ…æ‹¬ï¼š</p><ul><li><code>Rention</code>ï¼šæ ‡è®°åœ¨ä»€ä¹ˆçº§åˆ«ä¿å­˜è¯¥æ³¨è§£ä¿¡æ¯ï¼Œä¹Ÿå³æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ RentionPolicy.CLASSã€RentionPolicy.RUNTIME ç­‰ï¼›</li><li><code>Documented</code>ï¼šæ ‡è¯†æ˜¯å¦ä¼šè¢«åŒ…å«åœ¨ Javadoc ä¸­ï¼›</li><li><code>Target</code>ï¼šæ ‡è¯†æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ï¼Œå¦‚ ElementType.PARAMSã€ElementType.FIELD ç­‰ï¼›</li><li><code>Inherited</code>ï¼šæ ‡è¯†è¯¥æ³¨è§£å¯ä»¥è¢«å­ç±»ç»§æ‰¿ï¼›</li><li><code>Repeatable</code>ï¼šæ ‡è¯†è¯¥æ³¨è§£å¯ä»¥è¢«æŸä¸ªå…ƒç´ é‡å¤ä½¿ç”¨ã€‚</li></ul><p>æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨æ¥å®ç°è‡ªå·±çš„æ³¨è§£å¤„ç†æ–¹å¼ã€‚é€šå¸¸æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª AbstractProcessorï¼Œç„¶åè¦†å†™<code>init()</code>å’Œ<code>process()</code>æ–¹æ³•ï¼Œç„¶ååœ¨ Jar åŒ…çš„ META-INF/services æ–‡ä»¶å¤¹ä¸­ï¼Œæ”¾å…¥ä¸€ä¸ªåä¸º<code>javax.annotation.processing.Processor</code>çš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­å†™ä¸‹è‡ªå®šä¹‰ç±»çš„åŒ…åã€‚æˆ–è€…ä½¿ç”¨ Google æä¾›çš„æ³¨å†Œå¤„ç†å™¨çš„åº“<code>auto-service</code>ã€‚</p><h3 id="Collection-ç±»æœ‰å“ªäº›å­ç±»ï¼Ÿ"><a href="#Collection-ç±»æœ‰å“ªäº›å­ç±»ï¼Ÿ" class="headerlink" title="Collection ç±»æœ‰å“ªäº›å­ç±»ï¼Ÿ"></a>Collection ç±»æœ‰å“ªäº›å­ç±»ï¼Ÿ</h3><p>æœ‰ List å’Œ Setã€‚Map ä¸­ä¹Ÿä½¿ç”¨åˆ°äº† Collectionã€‚</p><h3 id="Listã€Setã€Mapçš„åŒºåˆ«"><a href="#Listã€Setã€Mapçš„åŒºåˆ«" class="headerlink" title="Listã€Setã€Mapçš„åŒºåˆ«"></a>Listã€Setã€Mapçš„åŒºåˆ«</h3><p>List å’Œ Set æ˜¯ Collection ç±»çš„å­æ¥å£ã€‚Map æ˜¯ä¸€ä¸ªå•ç‹¬æ¥å£ã€‚</p><p>Listï¼š</p><ol><li>å…è®¸æœ‰é‡å¤çš„å¯¹è±¡ã€‚</li><li>å¯ä»¥æ’å…¥å¤šä¸ª null å…ƒç´ ã€‚</li><li>æ˜¯æœ‰åºå®¹å™¨ï¼Œä¿æŒäº†å…ƒç´ çš„æ’å…¥é¡ºåºã€‚</li><li>å¸¸ç”¨å®ç°ç±»æœ‰ ArrayListï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€LinkedListï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ å’Œ Vectorï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ã€‚</li></ol><p>Setï¼š</p><ol><li>ä¸å…è®¸æœ‰é‡å¤çš„å¯¹è±¡ã€‚</li><li>åªå…è®¸ä¸€ä¸ª null å…ƒç´ ã€‚</li><li>æ˜¯æ— åºå®¹å™¨ï¼Œæ— æ³•ä¿æŒå–å‡ºæ—¶çš„é¡ºåºæ˜¯æ’å…¥æ—¶çš„é¡ºåºã€‚</li><li>å¸¸ç”¨å®ç°ç±»æœ‰ HashSetï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€LinkedHashSetï¼ˆé“¾è¡¨å’Œå“ˆå¸Œè¡¨ï¼‰ å’Œ TreeSetï¼ˆçº¢é»‘æ ‘ï¼‰ã€‚æœ€æµè¡Œçš„æ˜¯åŸºäº HashMap å®ç°çš„ HashSetï¼›TreeSet è¿˜å®ç°äº† SortedSet æ¥å£ï¼Œå› æ­¤ TreeSet æ˜¯ä¸€ä¸ªæ ¹æ®å…¶ compare() å’Œ compareTo() çš„å®šä¹‰è¿›è¡Œæ’åºçš„æœ‰åºå®¹å™¨ã€‚</li></ol><p>Mapï¼š</p><ol><li>Map ä¸æ˜¯ Collection çš„å­æ¥å£æˆ–è€…å®ç°ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¥å£ã€‚</li><li>Map æ¯ä¸ªèŠ‚ç‚¹éƒ½æŒæœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œkey å’Œ valueã€‚</li><li>Map key å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œvalue ä¸æ˜¯ã€‚</li><li>Map å…è®¸ null value ä½†åªèƒ½æœ‰ä¸€ä¸ª null keyã€‚</li><li>Map æ¥å£æœ€æµè¡Œçš„å‡ ä¸ªå®ç°ç±»æ˜¯ HashMapã€LinkedHashMapã€Hashtable å’Œ TreeMapã€‚ï¼ˆHashMapã€TreeMapæœ€å¸¸ç”¨ï¼‰</li></ol><p>ä½¿ç”¨åœºæ™¯çš„åŒºåˆ«ï¼š</p><ol><li>å¦‚æœä½ ç»å¸¸ä¼šä½¿ç”¨ index æ¥å¯¹å®¹å™¨ä¸­çš„å…ƒç´ è¿›è¡Œè®¿é—®ï¼Œé‚£åº”è¯¥é€‰æ‹© Listã€‚å¦‚æœä½ å·²ç»çŸ¥é“ç´¢å¼•äº†çš„è¯ï¼Œé‚£ä¹ˆ List çš„å®ç°ç±»æ¯”å¦‚ ArrayList å¯ä»¥æä¾›æ›´å¿«é€Ÿçš„è®¿é—®ï¼›å¦‚æœç»å¸¸æ·»åŠ åˆ é™¤å…ƒç´ çš„ï¼Œé‚£ä¹ˆè‚¯å®šè¦é€‰æ‹© LinkedListã€‚</li><li>å¦‚æœä½ æƒ³å®¹å™¨ä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ç…§å®ƒä»¬æ’å…¥çš„æ¬¡åºè¿›è¡Œ<strong>æœ‰åºå­˜å‚¨</strong>ï¼Œé‚£ä¹ˆè¿˜æ˜¯ Listï¼Œå› ä¸º List æ˜¯ä¸€ä¸ªæœ‰åºå®¹å™¨ï¼Œå®ƒæŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡Œå­˜å‚¨ã€‚</li><li>å¦‚æœä½ æƒ³ä¿è¯æ’å…¥å…ƒç´ çš„<strong>å”¯ä¸€æ€§</strong>ï¼Œä¹Ÿå°±æ˜¯ä½ ä¸æƒ³æœ‰é‡å¤å€¼çš„å‡ºç°ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä¸€ä¸ª Set çš„å®ç°ç±»ï¼Œæ¯”å¦‚ HashSetã€LinkedHashSet æˆ–è€… TreeSetã€‚æ‰€æœ‰ Set çš„å®ç°ç±»éƒ½éµå¾ªäº†ç»Ÿä¸€çº¦æŸæ¯”å¦‚å”¯ä¸€æ€§ï¼Œè€Œä¸”è¿˜æä¾›äº†é¢å¤–çš„ç‰¹æ€§æ¯”å¦‚ TreeSet è¿˜æ˜¯ä¸€ä¸ª SortedSetï¼Œæ‰€æœ‰å­˜å‚¨äº TreeSet ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ Java é‡Œçš„ Comparator æˆ–è€… Comparable è¿›è¡Œæ’åºã€‚LinkedHashSet ä¹ŸæŒ‰ç…§å…ƒç´ çš„æ’å…¥é¡ºåºå¯¹å®ƒä»¬è¿›è¡Œå­˜å‚¨ã€‚</li><li>å¦‚æœä½ ä»¥ key-value çš„å½¢å¼è¿›è¡Œæ•°æ®å­˜å‚¨é‚£ä¹ˆ Map æ˜¯ä½ æ­£ç¡®çš„é€‰æ‹©ã€‚ä½ å¯ä»¥æ ¹æ®ä½ çš„åç»­éœ€è¦ä» Hashtableã€HashMapã€TreeMap ä¸­è¿›è¡Œé€‰æ‹©ã€‚</li></ol><p>Collection å®¶æ—çš„å…³ç³»è¡¨å¦‚ä¸‹ï¼ˆå¹¶ä¸å…¨ï¼‰ï¼š</p><div class="center-img"><p><img src="/img/interview-1588741365.png"></p></div><h3 id="HashMap-çš„åŸç†ï¼Ÿ"><a href="#HashMap-çš„åŸç†ï¼Ÿ" class="headerlink" title="HashMap çš„åŸç†ï¼Ÿ"></a>HashMap çš„åŸç†ï¼Ÿ</h3><p>HashMap æ˜¯å¸¸è§çš„ç”¨ key-value å­˜å‚¨çš„å·¥å…·ç±»ï¼Œå®ƒçš„æ•°æ®ç»“æ„æ˜¯<strong>æ•°ç»„+é“¾è¡¨</strong>ã€‚æ¯æ¬¡æ’å…¥æ–°æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªç®—æ³•å»è®¡ç®—å®ƒåº”è¯¥æ’å…¥çš„ indexï¼ˆ<code>key.hashCode &amp; (size - 1)</code>ï¼‰ï¼Œå¦‚æœå½“å‰ä½ç½®æ²¡æœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥æ’å…¥ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç”¨é“¾è¡¨çš„å½¢å¼æ’å…¥è¯¥ä½ç½®ã€‚JDK1.7å’ŒJDK1.8æœ‰åŒºåˆ«ï¼Œåœ¨1.7ä¸­ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œä¹Ÿå°±æ˜¯æ–°æ’å…¥çš„æ•°æ®ä¼šæ›¿æ¢åŸæ¥çš„æ•°æ®ï¼›1.8ä¹‹åä½¿ç”¨çš„æ˜¯å°¾æ’æ³•ï¼Œä¹Ÿå°±æ˜¯æ–°æ’å…¥çš„æ•°æ®ä¼šè·Ÿåœ¨åŸæ¥æ•°æ®çš„åé¢ã€‚1.7çš„è¿™ç§æ’æ³•ï¼Œå› ä¸ºæ”¹å˜äº†æ•°æ®çš„é¡ºåºï¼Œæœ‰å¯èƒ½åœ¨å¤šä¸ªçº¿ç¨‹æ’å…¥æ—¶é€ æˆæ­»å¾ªç¯ï¼Œè€Œ1.8çš„è¿™ç§æ–¹æ³•å°±ä¸ä¼šé€ æˆæ­»å¾ªç¯äº†ã€‚ä½†å¹¶ä¸ä»£è¡¨å®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœæƒ³è¦çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ Hashtable æˆ–è€… ConcurrentHashMapã€‚æ¯ä¸ª HashMap é»˜è®¤å¤§å°æ˜¯16ï¼Œå¦‚æœè¶…è¿‡äº†å®ƒçš„è´Ÿè½½å› å­ï¼ˆé»˜è®¤æ˜¯0.75ï¼‰çš„è¯ï¼Œå°±ä¼š<strong>æ‰©å®¹</strong>ã€‚</p><h3 id="HashMap-æ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#HashMap-æ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="HashMap æ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ"></a>HashMap æ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</h3><p>æ•°ç»„çš„å¤§å°æ”¹ä¸ºåŸæ¥çš„2å€ï¼Œæ‰€æœ‰çš„æ•°æ®ä¼šé‡æ–°è®¡ç®— index å¹¶é‡æ–°æ’å…¥ã€‚</p><h3 id="é‚£å¯¹æ¯”ä¸€ä¸‹-Hashtable-å’Œ-ConcurrentHashMapï¼Ÿ"><a href="#é‚£å¯¹æ¯”ä¸€ä¸‹-Hashtable-å’Œ-ConcurrentHashMapï¼Ÿ" class="headerlink" title="é‚£å¯¹æ¯”ä¸€ä¸‹ Hashtable å’Œ ConcurrentHashMapï¼Ÿ"></a>é‚£å¯¹æ¯”ä¸€ä¸‹ Hashtable å’Œ ConcurrentHashMapï¼Ÿ</h3><p>Hashtable åªæ˜¯åœ¨<code>put/get</code>æ–¹æ³•ä¸ŠåŠ ä¸Šäº†<code>synchronized</code>å…³é”®å­—ï¼Œ<strong>å¹¶å‘åº¦æ¯”è¾ƒä½</strong>ã€‚è€Œ ConcurrentHashMap åœ¨ JDK1.7 ä¸­é‡‡ç”¨äº†<strong>åˆ†æ®µé”</strong>æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äº ReentrantLockã€‚ æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚æ¯ä¸€ä¸ª HashEntry ç”¨<code>volatile</code>æ¥ä¿®é¥°äº†å®ƒçš„<code>value</code>å’Œ<code>next</code>èŠ‚ç‚¹ï¼Œä»¥ä¿è¯å†…å­˜å¯è§æ€§ã€‚åœ¨ JDK1.8 ä¸­æŠ›å¼ƒäº† Segment æœºåˆ¶ï¼Œä½¿ç”¨äº† CAS å’Œ synchronized æœºåˆ¶ï¼Œå°† HashEntry æ›¿æ¢ä¸º Nodeï¼Œå¹¶æŠŠå®ƒçš„<code>value</code>å’Œ<code>next</code>ä¹Ÿç”¨<code>volatile</code>æ¥ä¿®é¥°ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯æµ…æ‹·è´å’Œæ·±æ‹·è´"><a href="#ä»€ä¹ˆæ˜¯æµ…æ‹·è´å’Œæ·±æ‹·è´" class="headerlink" title="ä»€ä¹ˆæ˜¯æµ…æ‹·è´å’Œæ·±æ‹·è´"></a>ä»€ä¹ˆæ˜¯æµ…æ‹·è´å’Œæ·±æ‹·è´</h3><p><strong>æµ…æ‹·è´ï¼š</strong></p><p>å¯¹äº<strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>çš„æˆå‘˜å¯¹è±¡ï¼Œå› ä¸ºåŸºç¡€æ•°æ®ç±»å‹æ˜¯<strong>å€¼ä¼ é€’</strong>çš„ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥å°†å±æ€§å€¼èµ‹å€¼ç»™æ–°çš„å¯¹è±¡ã€‚åŸºç¡€ç±»å‹çš„æ‹·è´ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡ä¿®æ”¹è¯¥å€¼ï¼Œä¸ä¼šå½±å“å¦å¤–ä¸€ä¸ªã€‚è€Œå¯¹äº<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œæ¯”å¦‚æ•°ç»„æˆ–è€…ç±»å¯¹è±¡ï¼Œå› ä¸ºå¼•ç”¨ç±»å‹æ˜¯<strong>å¼•ç”¨ä¼ é€’</strong>ï¼Œæ‰€ä»¥æµ…æ‹·è´åªæ˜¯<strong>æŠŠå†…å­˜åœ°å€èµ‹å€¼ç»™äº†æˆå‘˜å˜é‡</strong>ï¼Œå®ƒä»¬æŒ‡å‘äº†åŒä¸€å†…å­˜ç©ºé—´ã€‚æ”¹å˜å…¶ä¸­ä¸€ä¸ªï¼Œä¼šå¯¹å¦å¤–ä¸€ä¸ªä¹Ÿäº§ç”Ÿå½±å“ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åªå¤åˆ¶æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼Œè€Œä¸å¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œæ–°æ—§å¯¹è±¡è¿˜æ˜¯å…±äº«åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œä¿®æ”¹æ–°å¯¹è±¡æ—¶ï¼ŒåŸå¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚</p><p>è¦å®ç°æµ…æ‹·è´ï¼Œéœ€è¦å®ç° Cloneable æ¥å£ï¼Œå¹¶å¤å†™<code>clone()</code>æ–¹æ³•ã€‚</p><p>æµ…æ‹·è´ä¼šå¸¦æ¥ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œå› ä¸ºæ–°æ—§å¯¹è±¡æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å†…å­˜åœ°å€ã€‚</p><p><strong>æ·±æ‹·è´ï¼š</strong></p><p>å¯¹äº<strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>çš„æˆå‘˜å¯¹è±¡ï¼Œå› ä¸ºåŸºç¡€æ•°æ®ç±»å‹æ˜¯<strong>å€¼ä¼ é€’</strong>çš„ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥å°†å±æ€§å€¼èµ‹å€¼ç»™æ–°çš„å¯¹è±¡ã€‚åŸºç¡€ç±»å‹çš„æ‹·è´ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡ä¿®æ”¹è¯¥å€¼ï¼Œä¸ä¼šå½±å“å¦å¤–ä¸€ä¸ªï¼ˆè¿™ä¸€ç‚¹å’Œæµ…æ‹·è´ä¸€æ ·ï¼‰ã€‚è€Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚æ•°ç»„æˆ–è€…ç±»å¯¹è±¡ï¼Œæ·±æ‹·è´ä¼š<strong>æ–°å»ºä¸€ä¸ªå¯¹è±¡ç©ºé—´</strong>ï¼Œç„¶åæ‹·è´é‡Œé¢çš„å†…å®¹ï¼Œæ‰€ä»¥å®ƒä»¬<strong>æŒ‡å‘äº†ä¸åŒçš„å†…å­˜ç©ºé—´</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¼šåˆ›å»ºå¦å¤–ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å¯¹è±¡ï¼Œæ–°æ—§å¯¹è±¡ä¸å…±äº«å†…å­˜ï¼Œä¿®æ”¹æ–°å¯¹è±¡ä¸ä¼šæ›´æ”¹åˆ°åŸå¯¹è±¡ã€‚</p><p>æ·±æ‹·è´æ¯”æµ…æ‹·è´çš„é€Ÿåº¦è¦æ…¢å¹¶ä¸”å¼€é”€è¾ƒå¤§ã€‚</p><p>è¦å®ç°æ·±æ‹·è´ï¼Œéœ€è¦å®ç° Cloneable æ¥å£ï¼Œå¹¶å¤å†™<code>clone()</code>æ–¹æ³•ã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹-GC"><a href="#ä»‹ç»ä¸€ä¸‹-GC" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ GC"></a>ä»‹ç»ä¸€ä¸‹ GC</h3><p>GC æ˜¯ Java çš„å†…å­˜å›æ”¶æœºåˆ¶ã€‚å½“å †ä¸­æœ‰é•¿æ—¶é—´ä¸ä½¿ç”¨çš„å†…å­˜å—ï¼ŒGC å°±ä¼šå¼€å§‹å·¥ä½œå›æ”¶æ­¤éƒ¨åˆ†å†…å­˜ï¼Œä»¥ä¾›ç¨‹åºåˆ›å»ºæ–°çš„å¯¹è±¡ä½¿ç”¨ã€‚</p><p>GC åˆ†ä¸º Minor GC å’Œ Major GCï¼ˆFull GCï¼‰ï¼Œå®ƒä»¬ä½œç”¨çš„å†…å­˜åŒºåŸŸä¸åŒï¼šMinor GC ä¸»è¦ä½œç”¨äºæ–°ç”Ÿä»£ï¼Œä¸€ä¸ªåŒ…å« Eden åŒºã€S0 åŒºå’Œ S1 åŒºçš„å†…å­˜åŒºåŸŸã€‚åœ¨è¿›è¡Œ Minor GC æ—¶ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šæš‚åœã€‚Major GC ä¸»è¦ä½œç”¨äºè€å¹´ä»£ï¼Œä½†æ˜¯ä¹Ÿä¼šå›æ”¶æ–°ç”Ÿä»£çš„å†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ã€‚</p><p>åˆ¤å®šéœ€è¦å›æ”¶çš„å¯¹è±¡çš„æ–¹æ³•æ˜¯ä½¿ç”¨<strong>å¯è¾¾æ€§åˆ†ææ³•</strong>ã€‚ä¸ºä»€ä¹ˆä¸ç”¨å¼•ç”¨è®¡æ•°æ³•å‘¢ï¼Ÿå› ä¸ºå¼•ç”¨è®¡æ•°æ³•<strong>ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶</strong>ã€‚</p><p>å¯è¾¾æ€§åˆ†ææ˜¯æŒ‡çš„ï¼Œé€šè¿‡ä¸€ç³»åˆ—è¢«ç§°ä¸º GC Roots çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å‘ä¸‹æœç´¢ï¼Œèµ°è¿‡çš„è·¯å¾„ç§°ä¸º<strong>å¼•ç”¨é“¾</strong>ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼ˆä¸å¯è¾¾ï¼‰ï¼Œåˆ™è¯æ˜è¯¥å¯¹è±¡ä¸å¯ç”¨ï¼Œå¯ä»¥è¿›è¡Œå›æ”¶ã€‚GC Roots æœ‰ä¸ªç‰¹ç‚¹ï¼Œä¸å¯è¢«å¯¹è±¡å›¾é‡Œçš„å¯¹è±¡æ‰€å¼•ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><p>Minor GC å’Œ Major GC è§¦å‘çš„æ—¶æœºä¸ç›¸åŒï¼š</p><ul><li>Minor GC æ˜¯å½“ Eden åŒºæ»¡æ—¶è§¦å‘</li><li>Major GC æœ‰ä»¥ä¸‹å‡ ç§ï¼š<ul><li>è°ƒç”¨<code>System.gc()</code>æ–¹æ³•</li><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li><li>é€šè¿‡ Minor GC åè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li><li>ç”± Eden åŒºã€S0 åŒºå‘ S1 åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äº S1 å¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è¯¥å¯¹è±¡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li></ul></li></ul><p>GC å›æ”¶çš„å¸¸ç”¨ç®—æ³•æœ‰å››ç§ï¼š</p><ul><li><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼šç¬¬ä¸€é˜¶æ®µæ ‡è®°ä¸å¯ç”¨å¯¹è±¡ï¼Œç¬¬äºŒé˜¶æ®µæ¸…é™¤è¿™äº›å¯¹è±¡ã€‚ä¸ä¼šæ”¹å˜åŸæœ‰æ•°æ®çš„ä½ç½®ã€‚ä¼šé€ æˆå†…å­˜ç¢ç‰‡ç©ºé—´ã€‚</li><li><strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼šæ˜¯<strong>æ ‡è®°-æ¸…é™¤</strong>çš„æ”¹è¿›ç‰ˆã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µï¼Œä¼šå°†æ‰€å­˜æ´»çš„å¯¹è±¡æ•´ç†åˆ°å¦ä¸€ä¸ªç©ºé—´ï¼Œç„¶åæŠŠå‰©ä¸‹çš„å¯¹è±¡å…¨éƒ¨æ¸…é™¤ã€‚ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œä½†å› ä¸ºæœ‰å¤§é‡å¤åˆ¶ï¼Œç®—æ³•æ•ˆç‡è¾ƒä½ã€‚</li><li><strong>å¤åˆ¶ç®—æ³•</strong>ï¼šå°†å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºç›¸ç­‰å¤§å°çš„ä¸¤éƒ¨åˆ†ï¼Œåªä½¿ç”¨ä¸€åŠç©ºé—´ï¼Œå½“éœ€è¦ GC æ—¶ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€åŠï¼Œå¹¶å°†ä¹‹å‰çš„ç©ºé—´æ¸…é™¤ã€‚ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä½†æ°¸è¿œåªèƒ½ä½¿ç”¨ä¸€åŠçš„å†…å­˜ã€‚</li><li><strong>åˆ†ä»£æ”¶é›†ç®—æ³•</strong>ï¼šä¸»æµç®—æ³•ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸï¼Œå°†å †ç©ºé—´åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚<strong>æ–°ç”Ÿä»£</strong>ä¸­ï¼Œæ¯æ¬¡å›æ”¶éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œæ­¤æ—¶ä½¿ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ï¼›è€Œ<strong>è€å¹´ä»£</strong>å­˜æ´»ç‡è¾ƒé«˜ï¼Œä½¿ç”¨<strong>æ ‡è®°-æ¸…é™¤</strong>æˆ–è€…<strong>æ ‡è®°-æ•´ç†</strong>ã€‚</li></ul><p>GC çš„å…·ä½“å®ç°æ˜¯åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>å¸¸ç”¨çš„æœ‰ Serialï¼ˆå¤åˆ¶ç®—æ³•ï¼Œä¸²è¡Œï¼‰ã€CMSï¼ˆæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå¹¶å‘ï¼‰ã€G1ï¼ˆæ ‡è®°-æ•´ç†+å¤åˆ¶ç®—æ³•ï¼Œå¹¶å‘ï¼‰ç­‰ã€‚</p><h3 id="å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼ŸåŒºåˆ«æ˜¯ï¼Ÿ"><a href="#å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼ŸåŒºåˆ«æ˜¯ï¼Ÿ" class="headerlink" title="å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼ŸåŒºåˆ«æ˜¯ï¼Ÿ"></a>å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼ŸåŒºåˆ«æ˜¯ï¼Ÿ</h3><p>Java çš„å¼•ç”¨ä»å¼ºåˆ°å¼±åˆ†åˆ«æ˜¯å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨ã€‚</p><p><strong>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ï¼š</strong></p><p>å¼ºå¼•ç”¨æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£åƒåœ¾å›æ”¶å™¨<strong>ç»ä¸ä¼šå›æ”¶å®ƒ</strong>ã€‚å³ä¾¿å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJVM å®æ„¿æŠ›å‡º OutOfMemoryï¼Œä¹Ÿä¸ä¼šéšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœå¼ºå¼•ç”¨å¯¹è±¡ä¸ä½¿ç”¨æ—¶ï¼Œéœ€è¦å°†å…¶ã€å¼±åŒ–ã€ä»è€Œä½¿ GC èƒ½å›æ”¶ï¼Œæ¯”å¦‚ç½®ä¸º nullã€‚</p><p><strong>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ï¼š</strong></p><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œåˆ™<strong>å†…å­˜ç©ºé—´å……è¶³æ—¶</strong>ï¼Œåƒåœ¾å›æ”¶å™¨å°±<strong>ä¸ä¼šå›æ”¶</strong>å®ƒï¼›å¦‚æœ<strong>å†…å­˜ç©ºé—´ä¸è¶³</strong>äº†ï¼Œ<strong>å°±ä¼šå›æ”¶</strong>è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚<strong>è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</strong></p><p><strong>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ï¼š</strong></p><p>å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼š<strong>åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p><strong>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ï¼š</strong></p><p>è™šå¼•ç”¨é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ã€‚ä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œ<strong>åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶</strong>ã€‚</p><p>è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼Œè™šå¼•ç”¨<strong>å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨</strong>ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p>ä¸€å¼ è¡¨æ ¼æ¥å±•ç¤ºä¸€ä¸‹å››ç§å¼•ç”¨ï¼š</p><table><thead><tr><th>å¼•ç”¨ç±»å‹</th><th>è¢«åƒåœ¾å›æ”¶æ—¶é—´</th><th>ç”¨é€”</th><th>ç”Ÿå­˜æ—¶é—´</th></tr></thead><tbody><tr><td>å¼ºå¼•ç”¨</td><td>ä»æ¥ä¸ä¼š</td><td>å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€</td><td>JVMåœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢</td></tr><tr><td>è½¯å¼•ç”¨</td><td>å½“å†…å­˜ä¸è¶³æ—¶</td><td>å¯¹è±¡ç¼“å­˜</td><td>å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢</td></tr><tr><td>å¼±å¼•ç”¨</td><td>æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</td><td>å¯¹è±¡ç¼“å­˜</td><td>åƒåœ¾å›æ”¶åç»ˆæ­¢</td></tr><tr><td>è™šå¼•ç”¨</td><td>æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</td><td>è·Ÿè¸ªå¯¹è±¡çš„åƒåœ¾å›æ”¶</td><td>åƒåœ¾å›æ”¶åç»ˆæ­¢</td></tr></tbody></table><h3 id="å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3><p>çº¿ç¨‹å®‰å…¨ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š</p><ol><li><p><strong>åŸå­æ€§</strong>ï¼šåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼›</p><p>è¦ä¿è¯åŸå­æ€§ï¼Œå¯ä»¥ä½¿ç”¨ Java æä¾›çš„ Atomic ç±»ï¼Œæ¯”å¦‚ AtomicIntegerã€AtomicLong ç­‰ã€‚å®ƒä»¬çš„åŸç†æ˜¯åŸºäº CASï¼ˆCompare and Setï¼‰ï¼Œä¸€ç§ä¹è§‚é”ã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>synchronized</code>å…³é”®å­—ã€‚<code>synchronized</code>æ˜¯ä¸€ç§åŒæ­¥é”ï¼Œä¾èµ– JVM å®ç°é”æœºåˆ¶ï¼Œæ˜¯ä¸€ç§ä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥ä¿®é¥°å››ç§å¯¹è±¡ï¼š</p><ul><li>ä»£ç å—ï¼šé”ä½æ‹¬å·å†…çš„å¯¹è±¡ï¼›</li><li>éé™æ€æ–¹æ³•ï¼šé”ä½å½“å‰å®ä¾‹ï¼›</li><li>é™æ€æ–¹æ³•ï¼šé”ä½çš„æ˜¯è¯¥ç±»çš„ Class å¯¹è±¡ï¼›</li><li>ç±»ï¼šé”ä½çš„æ˜¯è¯¥ç±»ï¼›</li></ul></li><li><p><strong>å¯è§æ€§</strong>ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹ä¸»å†…å­˜çš„ä¿®æ”¹å¯ä»¥åŠæ—¶åœ°è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼›</p><p>ä¿å­˜å¯è§æ€§ï¼Œå¯ä»¥ä½¿ç”¨<code>volatile</code>å…³é”®å­—ä¿®é¥°å˜é‡ã€‚ä½†å®ƒä¸æ˜¯åŸå­æ€§çš„ï¼Œæ¯”å¦‚åƒ<code>x++</code>è¿™ç§æ“ä½œå°±æ— æ³•ä¿å­˜å…¶çº¿ç¨‹å®‰å…¨ã€‚</p></li><li><p><strong>æœ‰åºæ€§</strong>ï¼šç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</p><p>è¦ä¿å­˜æœ‰åºæ€§ï¼Œä½¿ç”¨<code>synchronized</code>å’Œ<code>volatile</code>å’Œ Lock éƒ½å¯ä»¥ã€‚</p></li></ol><h3 id="synchronized-å’Œ-volatile-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#synchronized-å’Œ-volatile-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="synchronized å’Œ volatile æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>synchronized å’Œ volatile æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ol><li><code>synchronized</code> ä¿è¯å†…å­˜å¯è§æ€§å’Œæ“ä½œåŸå­æ€§ï¼Œ<code>volatile</code> ä¿è¯å†…å­˜å¯è§æ€§å’Œæœ‰åºæ€§ï¼›</li><li><code>volatile</code> ä¸éœ€è¦åŠ é”ï¼Œæ¯” <code>synchronized</code> æ›´è½»é‡çº§ï¼›</li><li><code>volatile</code> ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›<code>synchronized</code> å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›</li><li><code>volatile</code> æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œè€Œè¢« <code>synchronized</code> æ ‡è®°çš„éƒ¨åˆ†å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆå¦‚æŒ‡ä»¤é‡æ’ï¼‰ï¼›</li><li><code>volatile</code> æ˜¯å˜é‡ä¿®é¥°ç¬¦ï¼Œä»…èƒ½ç”¨äºå˜é‡ï¼Œè€Œ <code>synchronized</code> æ˜¯ä¸€ä¸ªæ–¹æ³•æˆ–å—çš„ä¿®é¥°ç¬¦ã€‚</li></ol><h3 id="æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Ÿå¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Ÿå¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Ÿå¦‚ä½•å¤„ç†ï¼Ÿ"></a>æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Ÿå¦‚ä½•å¤„ç†ï¼Ÿ</h3><p>æ­»é”æ˜¯æŒ‡<strong>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§åƒµå±€</strong>ï¼ˆDeadly-Embraceï¼‰ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œè¿™äº›è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰éƒ½å°†æ— æ³•å‘å‰æ¨è¿›ã€‚</p><p>å®ƒäº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶æ˜¯ï¼š</p><ol><li><strong>äº’æ–¥æ¡ä»¶</strong>ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºä»…ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ã€‚æ­¤æ—¶è‹¥æœ‰å…¶ä»–è¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼Œåˆ™è¯·æ±‚è¿›ç¨‹åªèƒ½ç­‰å¾…ï¼›</li><li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶</strong>ï¼šè¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†å¯¹è‡ªå·±å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ï¼›</li><li><strong>ä¸å¯å‰¥å¤ºæ¡ä»¶</strong>ï¼šè¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•ä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œå³åªèƒ½ç”±è·å¾—è¯¥èµ„æºçš„è¿›ç¨‹è‡ªå·±æ¥é‡Šæ”¾ï¼ˆåªèƒ½æ˜¯ä¸»åŠ¨é‡Šæ”¾)ï¼›</li><li><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶</strong>: è‹¥å¹²è¿›ç¨‹é—´å½¢æˆé¦–å°¾ç›¸æ¥å¾ªç¯ç­‰å¾…èµ„æºçš„å…³ç³»ã€‚</li></ol><p>é¿å…æ­»é”çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šç³»ç»Ÿå¯¹è¿›ç¨‹å‘å‡ºçš„æ¯ä¸€ä¸ªç³»ç»Ÿèƒ½å¤Ÿæ»¡è¶³çš„èµ„æºç”³è¯·è¿›è¡Œ<strong>åŠ¨æ€æ£€æŸ¥</strong>ï¼Œå¹¶æ ¹æ®æ£€æŸ¥ç»“æœå†³å®šæ˜¯å¦åˆ†é…èµ„æºï¼Œå¦‚æœåˆ†é…åç³»ç»Ÿå¯èƒ½å‘ç”Ÿæ­»é”ï¼Œåˆ™ä¸äºˆåˆ†é…ï¼Œå¦åˆ™äºˆä»¥åˆ†é…ï¼Œè¿™æ˜¯ä¸€ç§ä¿è¯ç³»ç»Ÿä¸è¿›å…¥æ­»é”çŠ¶æ€çš„åŠ¨æ€ç­–ç•¥ã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹çº¿ç¨‹æ± "><a href="#ä»‹ç»ä¸€ä¸‹çº¿ç¨‹æ± " class="headerlink" title="ä»‹ç»ä¸€ä¸‹çº¿ç¨‹æ± "></a>ä»‹ç»ä¸€ä¸‹çº¿ç¨‹æ± </h3><p>çº¿ç¨‹æ± ä¸€èˆ¬ç”¨æ¥é™åˆ¶ç¨‹åºä¸­åŒä¸€æ—¶åˆ»è¿è¡Œçš„çº¿ç¨‹æ•°ã€‚åˆç†åˆ©ç”¨çº¿ç¨‹æ± æœ‰ä¸‰ä¸ªå¥½å¤„ï¼š</p><ol><li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹<strong>é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—</strong>ï¼›</li><li>é«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½<strong>ç«‹å³æ‰§è¡Œ</strong>ï¼›</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„<strong>åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§</strong>ã€‚</li></ol><p>JDK ä¸­æä¾›äº†ThreadPoolExecutorç±»ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç§ï¼š<strong>æ ¸å¿ƒçº¿ç¨‹</strong>å’Œ<strong>éæ ¸å¿ƒçº¿ç¨‹</strong>ã€‚æ ¸å¿ƒçº¿ç¨‹<strong>æ°¸è¿œä¸ä¼šè¢«å›æ”¶</strong>ï¼Œè€Œ<strong>éæ ¸å¿ƒçº¿ç¨‹åœ¨ç©ºé—²è¾¾åˆ°ä¸€å®šæ—¶é—´åï¼Œå°±ä¼šè¢«å›æ”¶</strong>ï¼Œè¿™ä¸ªæ—¶é—´ç”±æ„é€ æ–¹æ³•ä¸­çš„<code>keepAliveTime</code>å‚æ•°æ¥æŒ‡å®šã€‚</p><p>æ–°å»ºçº¿ç¨‹æ± æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€çº¿ç¨‹æœ€å¤§æ•°é‡ã€ç©ºé—²è¶…æ—¶æ—¶é•¿ã€é˜»å¡é˜Ÿåˆ—ç±»å‹ã€å›æ”¶ç­–ç•¥ç­‰ã€‚</p><p>æ ¹æ®åˆå§‹åŒ–æ—¶æ ¸å¿ƒçº¿ç¨‹æ•° + éæ ¸å¿ƒçº¿ç¨‹æ•° + ç©ºé—´è¶…æ—¶æ—¶é•¿ï¼Œè¡ç”Ÿå‡ºäº†åº”å¯¹ä¸åŒéœ€æ±‚çš„çº¿ç¨‹æ± æ´¾ç”Ÿç±»ï¼Œå¦‚ï¼š</p><ul><li>CachedThreadPoolï¼šæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œ60ç§’ç©ºé—²è¶…æ—¶ï¼Œæ¯”è¾ƒ<strong>é€‚åˆæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥çš„å°ç¨‹åºæˆ–è€…è´Ÿè½½è¾ƒè½»çš„æœåŠ¡å™¨</strong>ã€‚</li><li>FixedThreadPoolï¼šå…¨éƒ¨æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œéå¸¸<strong>é€‚åˆæ‰§è¡Œé•¿æœŸä»»åŠ¡</strong>ã€‚å› ä¸ºæ‰€æœ‰çº¿ç¨‹éƒ½ä¸ä¼šå›æ”¶ï¼Œæ‰€ä»¥èƒ½æ›´å¿«åœ°å“åº”æ‰§è¡Œä»»åŠ¡çš„è¯·æ±‚ã€‚</li><li>SingleThreadExecutorï¼šåªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œ<strong>é€‚åˆä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œçš„åœºæ™¯</strong>ã€‚</li></ul><p>å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š<code>execute(Runnable)</code>å’Œ<code>submit(Callable)</code>ã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯<code>execute()</code>æ–¹æ³•æ‰§è¡Œå®Œåï¼Œæ— æ³•å¾—çŸ¥ä»»åŠ¡æ˜¯å¦å·²è¢«æ‰§è¡Œï¼Œè€Œ<code>submit()</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Future ç”¨æ¥è·å–æ‰§è¡Œç»“æœã€‚</p><p>çº¿ç¨‹æ± çš„ç»ˆæ­¢æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š<code>shutdown()</code>å’Œ<code>shutdownNow()</code>ã€‚å®ƒä»¬éƒ½ä¼šå…³é—­çº¿ç¨‹æ± ï¼ŒåŒºåˆ«æ˜¯<code>shutdown()</code>è®©çº¿ç¨‹æ± ä¸å†æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†å·²ç»æ·»åŠ çš„ä»»åŠ¡ä¸å—å½±å“ï¼›<code>shutdownNow()</code>ä¼šå°è¯•åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœæ­¢å¤„ç†æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¹¶è¿”å›æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡çš„åˆ—è¡¨ã€‚</p><h3 id="æŠ½è±¡ç±»å’Œæ¥å£çš„å¼‚åŒæ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"><a href="#æŠ½è±¡ç±»å’Œæ¥å£çš„å¼‚åŒæ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ" class="headerlink" title="æŠ½è±¡ç±»å’Œæ¥å£çš„å¼‚åŒæ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"></a>æŠ½è±¡ç±»å’Œæ¥å£çš„å¼‚åŒæ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</h3><p><strong>åŒï¼š</strong> </p><ul><li>å®ƒä»¬éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚</li><li>æ¥å£çš„å®ç°ç±»å’ŒæŠ½è±¡ç±»çš„å­ç±»åªæœ‰<strong>å…¨éƒ¨å®ç°äº†æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å</strong>æ‰å¯ä»¥è¢«å®ä¾‹åŒ–ã€‚</li></ul><p><strong>å¼‚ï¼š</strong> </p><ul><li>jdk1.7 åŠä»¥å‰ï¼Œæ¥å£åªèƒ½å®šä¹‰æŠ½è±¡æ–¹æ³•ä¸èƒ½å®ç°æ–¹æ³•ï¼ŒæŠ½è±¡ç±»æ—¢å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®ç°æ–¹æ³•ï¼›ä½†æ˜¯ï¼Œåœ¨ jdk1.8 ä¹‹åï¼Œæ¥å£ä¸­ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„å®ç°æ–¹æ³•äº†ï¼Œç”¨ default å…³é”®å­—ä¿®é¥°ï¼›</li><li>ç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼›</li><li>æ¥å£å¼ºè°ƒçš„æ˜¯<strong>åŠŸèƒ½</strong>ï¼ŒæŠ½è±¡ç±»å¼ºè°ƒçš„æ˜¯<strong>æ‰€å±å…³ç³»</strong>ï¼›</li><li>æ¥å£ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡ä¸º public static finalï¼Œé™æ€ä¸å¯ä¿®æ”¹ï¼Œå½“ç„¶<strong>å¿…é¡»åˆå§‹åŒ–</strong>ã€‚æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ public abstract å…¬å¼€æŠ½è±¡çš„ï¼Œè€Œä¸”ä¸èƒ½æœ‰æ„é€ æ–¹æ³•ã€‚æŠ½è±¡ç±»å°±æ¯”è¾ƒè‡ªç”±äº†ï¼Œå’Œæ™®é€šçš„ç±»å·®ä¸å¤šï¼Œå¯ä»¥æœ‰æŠ½è±¡æ–¹æ³•ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå¯ä»¥æœ‰æ­£å¸¸çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼›</li><li>æ¥å£è¡¨ç¤ºçš„æ˜¯<strong>like a</strong>å…³ç³»ï¼ŒæŠ½è±¡ç±»è¡¨ç¤ºçš„æ˜¯<strong>is a</strong>å…³ç³»ã€‚</li></ul><p>ä¸Šå›¾ï¼š</p><div class="center-img"><p><img src="/img/interview-1588743862.png"></p></div><h4 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ</h4><p>å› ä¸º Java åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥ä½œä¸ºç»§æ‰¿å…³ç³»çš„è¡¥å……ï¼Œå¯ä»¥ä½¿ç”¨æ¥å£ã€‚åŒæ—¶ï¼ŒæŠŠç¨‹åºæ¨¡å—è¿›è¡Œå›ºåŒ–çš„å¥‘çº¦ï¼Œé™ä½è€¦åˆã€‚æŠŠè‹¥å¹²åŠŸèƒ½æ‹†åˆ†å‡ºæ¥ï¼ŒæŒ‰ç…§å¥‘çº¦æ¥è¿›è¡Œå®ç°å’Œä¾èµ–ï¼Œä¹Ÿå³<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ã€‚å®šä¹‰æ¥å£æœ‰åˆ©äºä»£ç çš„è§„èŒƒï¼Œè¿™æ˜¯<strong>æ¥å£åˆ†ç¦»åŸåˆ™</strong>ã€‚</p><h4 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŠ½è±¡ç±»ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŠ½è±¡ç±»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŠ½è±¡ç±»ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŠ½è±¡ç±»ï¼Ÿ</h4><ol><li>éœ€è¦å¯¹ç±»å‹è¿›è¡Œéšè—æ—¶ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºä¸€ä¸ªå›ºå®šçš„ä¸€ç»„è¡Œä¸ºçš„æŠ½è±¡æè¿°ï¼Œä¸€ä¸ªè¡Œä¸ºå¯ä»¥æœ‰ä»»æ„ä¸ªå¯èƒ½çš„å…·ä½“å®ç°æ–¹å¼ã€‚è¿™ä¸ªæŠ½è±¡çš„æè¿°å°±æ˜¯æŠ½è±¡ç±»ã€‚</li><li>éœ€è¦å¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œæ‹“å±•æ—¶ã€‚è¿™ä¸€ç»„ä»»æ„ä¸ªå¯èƒ½çš„å…·ä½“å®ç°è¡¨ç°ä¸ºæ‰€æœ‰å¯èƒ½çš„å­ç±»ï¼Œæ¨¡å—å¯ä»¥æ“ä½œä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”±äºæ¨¡å—ä¾èµ–äºä¸€ä¸ªå›ºå®šçš„æŠ½è±¡ç±»ï¼Œé‚£ä¹ˆä»–æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ã€‚åŒæ—¶é€šè¿‡è¿™ä¸ªæŠ½è±¡ç±»è¿›è¡Œæ´¾ç”Ÿï¼Œæ‹“å±•æ­¤æ¨¡å—çš„è¡Œä¸ºåŠŸèƒ½ã€‚</li></ol><h2 id="Android-éƒ¨åˆ†"><a href="#Android-éƒ¨åˆ†" class="headerlink" title="Android éƒ¨åˆ†"></a>Android éƒ¨åˆ†</h2><h3 id="ä»‹ç»ä¸€ä¸‹-Android-çš„å››å¤§ç»„ä»¶"><a href="#ä»‹ç»ä¸€ä¸‹-Android-çš„å››å¤§ç»„ä»¶" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ Android çš„å››å¤§ç»„ä»¶"></a>ä»‹ç»ä¸€ä¸‹ Android çš„å››å¤§ç»„ä»¶</h3><h4 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h4><p>Activity æ˜¯ç”¨æˆ·æ“ä½œçš„å¯è§†åŒ–ç•Œé¢ï¼›è´Ÿè´£ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’å¹¶å¤„ç†äº‹ä»¶ã€‚è¦ä½¿ç”¨å®ƒï¼Œå¿…é¡»è¦åœ¨ AndroidManifest.xml ä¸­è¿›è¡Œæ³¨å†Œã€‚å®ƒæœ‰å››ç§å¯åŠ¨æ¨¡å¼ï¼šstandardã€singleTopã€singleTask å’Œ singleInstanceã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ onCreate - onStart - onResume - onPause - onStop - onDestroyã€‚</p><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><p>Service é€šå¸¸ç”¨äºåœ¨åå°å¤„ç†è€—æ—¶çš„é€»è¾‘ã€‚è¦ä½¿ç”¨å®ƒï¼Œä¹Ÿå¿…é¡»è¦åœ¨ AndroidManifest.xml ä¸­è¿›è¡Œæ³¨å†Œã€‚å¯åŠ¨æœåŠ¡å¹¶ä¸ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå®ƒè¿˜æ˜¯ä¼šé»˜è®¤è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªå­ç±»æ˜¯ IntentServiceï¼Œå®ƒåŒ…å«æœ‰ä¸€ä¸ª HandlerThreadï¼Œæ‰€ä»¥å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­åšè€—æ—¶æ“ä½œï¼Œè€Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p><p>å¯åŠ¨ Service çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š</p><ul><li><code>startService()</code>ï¼šè¿™ç§æ–¹æ³•å¯åŠ¨çš„ Serviceï¼Œå¯åŠ¨ä¹‹åå°±ä¸å¯åŠ¨è€…æ— å…³äº†ï¼Œå“ªæ€•å¯åŠ¨è€…é€€å‡ºäº†ï¼ŒService è¿˜ä¼šç»§ç»­è¿è¡Œã€‚</li><li><code>bindService()</code>ï¼šè¿™ç§æ–¹æ³•å¯åŠ¨çš„ Serviceï¼Œä¸å¯åŠ¨è€…çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå¦‚æœå¯åŠ¨è€…é€€å‡ºï¼ŒService ä¹Ÿä¼šæŒ‚æ‰ã€‚</li></ul><h4 id="BroadcastReceiver"><a href="#BroadcastReceiver" class="headerlink" title="BroadcastReceiver"></a>BroadcastReceiver</h4><p>å¹¿æ’­æ˜¯ä¸€ç§å¹¿æ³›è¿ç”¨çš„åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“ä¿¡æ¯çš„æœºåˆ¶ã€‚è¦ä½¿ç”¨å®ƒï¼Œå¯ä»¥åœ¨ AndroidManifest.xml ä¸­è¿›è¡Œé™æ€æ³¨å†Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>Context.registerReceiver()</code>æ–¹æ³•æ¥åŠ¨æ€æ³¨å†Œã€‚</p><p>ä¸¤ç§æ³¨å†Œæ–¹å¼æ˜¯æœ‰åŒºåˆ«çš„ï¼š<strong>åŠ¨æ€æ³¨å†Œå¹¿æ’­ä¸æ˜¯å¸¸é©»å‹å¹¿æ’­</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¿æ’­è·Ÿéš Activity çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>é™æ€æ³¨å†Œæ˜¯å¸¸é©»å‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å½“åº”ç”¨ç¨‹åºå…³é—­åï¼Œå¦‚æœæœ‰ä¿¡æ¯å¹¿æ’­æ¥ï¼Œç¨‹åºä¹Ÿä¼šè¢«ç³»ç»Ÿè°ƒç”¨è‡ªåŠ¨è¿è¡Œã€‚</p><p>å¹¿æ’­ä¼ é€’æ•°æ®ä½¿ç”¨çš„æ˜¯ Intentã€‚</p><p>Broadcast æœ‰ä¸‰ç§åˆ†ç±»ï¼šæ™®é€šå¹¿æ’­ã€æœ‰åºå¹¿æ’­å’Œç²˜æ€§å¹¿æ’­ã€‚</p><ul><li>æ™®é€šå¹¿æ’­ï¼šè¿™ç§å¹¿æ’­å¯ä»¥ä¾æ¬¡ä¼ é€’ç»™å„ä¸ªå¤„ç†å™¨å»å¤„ç†ï¼›</li><li>æœ‰åºå¹¿æ’­ï¼šè¿™ç§å¹¿æ’­åœ¨å¤„ç†å™¨ç«¯çš„å¤„ç†é¡ºåºæ˜¯æŒ‰ç…§å¤„ç†å™¨çš„ä¸åŒä¼˜å…ˆçº§æ¥åŒºåˆ†çš„ï¼Œé«˜ä¼˜å…ˆçº§çš„å¤„ç†å™¨ä¼šä¼˜å…ˆæˆªè·è¿™ä¸ªæ¶ˆæ¯ï¼Œå¹¶ä¸”å¯ä»¥å°†è¿™ä¸ªæ¶ˆæ¯åˆ é™¤</li><li><del>ç²˜æ€§å¹¿æ’­</del>ï¼šç²˜æ€§æ¶ˆæ¯åœ¨å‘é€åå°±ä¸€ç›´å­˜åœ¨äºç³»ç»Ÿçš„æ¶ˆæ¯å®¹å™¨é‡Œé¢ï¼Œç­‰å¾…å¯¹åº”çš„å¤„ç†å™¨å»å¤„ç†ï¼Œå¦‚æœæš‚æ—¶æ²¡æœ‰å¤„ç†å™¨å¤„ç†è¿™ä¸ªæ¶ˆæ¯åˆ™ä¸€ç›´åœ¨æ¶ˆæ¯å®¹å™¨é‡Œé¢å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç²˜æ€§å¹¿æ’­çš„Receiverå¦‚æœè¢«é”€æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡é‡å»ºæ—¶ä¼šè‡ªåŠ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ•°æ®ã€‚å‘é€ç²˜æ€§å¹¿æ’­éœ€è¦æ·»åŠ æƒé™ï¼š<code>android.permission.BROADCAST_STICKY</code> </li></ul><article class="message message-immersive is-danger">  <div class="message-body">  <i class="fas fa-lightbulb mr-2"></i>    ç²˜æ€§å¹¿æ’­åœ¨ API 21 ä¸­å°±è¢«ç§»é™¤äº†ï¼Œå› ä¸ºè¿™ç§å¹¿æ’­ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼š<strong>ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹å®ƒ</strong>ã€‚  </div></article><p>é‚£ä¹ˆï¼Œç°åœ¨å‘é€å¹¿æ’­å¯ä»¥è°ƒç”¨ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li><code>sendOrderedBroadcast()</code>: è¯¥æ–¹æ³•å‘å‡ºçš„å¹¿æ’­åªèƒ½è¢«ä¸€ä¸ª receiver æ¥æ”¶åˆ°ï¼Œå®ƒå¤„ç†å®Œæˆåï¼Œä¼šå‘ä¸‹ä¸€ä¸ª receiver ä¼ æ’­ä¸€ä¸ª resultã€‚å®ƒä¹Ÿå¯ä»¥ç›´æ¥å°†å¹¿æ’­æ‹¦æˆªï¼Œè®©å…¶ä»–çš„ receiver æ— æ³•æ¥æ”¶åˆ°è¿™ä¸ªå¹¿æ’­ã€‚receiver å¯ä»¥é€šè¿‡è°ƒæ•´ä¼˜å…ˆçº§ï¼ˆ<code>android:priority</code>å±æ€§ï¼‰æ¥ä¼˜å…ˆæ¥æ”¶è¯¥å¹¿æ’­ã€‚å¦‚æœå‡ ä¸ª receiver ä¼˜å…ˆçº§ç›¸åŒï¼Œé‚£å®ƒä»¬ä¼šæŒ‰ç…§éšæœºé¡ºåºè·å¾—å¹¿æ’­ã€‚</li><li><code>sendBroadcast()</code>: è¯¥æ–¹æ³•å‘å‡ºçš„å¹¿æ’­èƒ½å¤Ÿè¢«æ‰€æœ‰ receiver æ¥æ”¶åˆ°ã€‚ä½†æ˜¯æ— æ³•ä¿è¯å‘å‡ºå’Œæ¥æ”¶çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚</li><li><code>LocalBroadcastManager.sendBroadcast()</code>: è¯¥æ–¹æ³•å‘å‡ºçš„å¹¿æ’­åªèƒ½è¢«å½“å‰ APP å†…çš„ receiver æ¥æ”¶ã€‚å¦‚æœä½ çš„å¹¿æ’­ä¸éœ€è¦è·¨è¿›ç¨‹ï¼Œé‚£å°±ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒçš„æ•ˆç‡æ¯”è¾ƒé«˜ï¼ˆå› ä¸ºä¸éœ€è¦è€ƒè™‘ IPCï¼‰ï¼Œå¹¶ä¸”å®‰å…¨æ€§ä¹Ÿèƒ½å¾—åˆ°ä¿éšœã€‚</li></ul><h4 id="Content-Provider"><a href="#Content-Provider" class="headerlink" title="Content Provider"></a>Content Provider</h4><p>ContentProvider æ˜¯åº”ç”¨ç¨‹åºé—´éå¸¸é€šç”¨çš„å…±äº«æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯Androidå®˜æ–¹æ¨èçš„æ–¹å¼ã€‚å®ƒé€šè¿‡ uri æ¥æ ‡è¯†å…¶å®ƒåº”ç”¨è¦è®¿é—®çš„æ•°æ®ï¼Œé€šè¿‡ContentResolver çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ–¹æ³•å®ç°å¯¹å…±äº«æ•°æ®çš„æ“ä½œã€‚è¿˜å¯ä»¥é€šè¿‡æ³¨å†Œ ContentObserver æ¥ç›‘å¬æ•°æ®æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–æ¥å¯¹åº”çš„åˆ·æ–°é¡µé¢ã€‚</p><p>å®ƒæœ‰å‡ ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š</p><ul><li><code>query()</code>ï¼šæŸ¥è¯¢æŒ‡å®šçš„æ•°æ®å¹¶è¿”å› Cursor</li><li><code>insert()</code>ï¼šæ·»åŠ æ•°æ®</li><li><code>delete()</code>ï¼šåˆ é™¤æ•°æ®</li><li><code>update()</code>ï¼šæ›´æ–°æ•°æ®</li></ul><p>æ•°æ®è®¿é—®çš„æ–¹æ³•<code>insert</code>ï¼Œ<code>delete</code>å’Œ<code>update</code>å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ï¼Œæ­¤æ—¶å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h3 id="Activity-çš„å››ç§å¯åŠ¨æ¨¡å¼"><a href="#Activity-çš„å››ç§å¯åŠ¨æ¨¡å¼" class="headerlink" title="Activity çš„å››ç§å¯åŠ¨æ¨¡å¼"></a>Activity çš„å››ç§å¯åŠ¨æ¨¡å¼</h3><p>åˆ†ä¸ºä¸¤ç±»ï¼šstandard å’Œ singleTop ä¸ºä¸€ç±»ï¼ŒsingleTask å’Œ singleInstance ä¸ºä¸€ç±»ã€‚</p><p>standard å’Œ singleTop å¯åŠ¨çš„ Activity <strong>å¯å¤šæ¬¡å®ä¾‹åŒ–</strong>ã€‚å®ƒä»¬çš„å®ä¾‹å¯ä»¥å¤„äº ActivityStack ä¸­çš„<strong>ä»»ä½•ä½ç½®</strong>ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒsingleTask å’Œ singleInstance åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡ã€‚</p><p><strong>standard</strong>ï¼šå¯ä»¥è¢«æ— é™åˆ¶åœ°åˆ›å»ºï¼Œæ¯æ¬¡é€šè¿‡ Intent å»å¯åŠ¨è¿™ä¸ª Activityï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¹¶æ”¾å…¥ ActivityStack çš„æ ˆé¡¶ã€‚åœ¨ Android 5.0 ä¹‹å‰ï¼Œæ— è®ºè¦å¯åŠ¨çš„ Activity æ˜¯å¦è·Ÿå½“å‰ Activity å±äºåŒä¸€ä¸ªåº”ç”¨ï¼Œ<strong>éƒ½ä¼šæŠŠç›®æ ‡ Activity æ”¾åœ¨å½“å‰ Activity çš„æ ˆä¸­</strong>ã€‚è€Œ5.0ä¹‹åï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªåº”ç”¨ï¼Œåˆ™æ”¾åœ¨å½“å‰æ ˆï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ªï¼Œåˆ™ä¼šæ–°å»ºä¸€ä¸ªæ ˆï¼Œå°†ç›®æ ‡ Activity æ”¾å…¥ã€‚</p><p><strong>singleTop</strong>ï¼šæ ˆé¡¶å¤ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ ActivityStack çš„é¡¶éƒ¨å·²ç»æœ‰äº†è¯¥ Activity çš„å®ä¾‹ï¼Œå°±ä¼šè°ƒç”¨å®ƒçš„<code>onNewIntent</code>æ–¹æ³•ï¼Œè€Œä¸æ˜¯å†åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚å¦‚æœåœ¨æ ˆå†…æœ‰è¯¥ Activity çš„å®ä¾‹ï¼Œä¹Ÿä¼šå†åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¹¶æ”¾å…¥æ ˆé¡¶ã€‚</p><p><strong>singleTask</strong>ï¼šå¦‚æœå½“å‰ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨äº†è¯¥ç§å¯åŠ¨æ¨¡å¼çš„ Activityï¼Œåˆ™å°†å­˜åœ¨è¯¥ Activity çš„æ ˆç½®äºå‰å°ï¼ˆç”¨æˆ·å¯è§ï¼‰ï¼ŒåŒæ—¶è°ƒç”¨å®ƒçš„<code>onNewIntent</code>æ–¹æ³•ã€‚</p><ul><li>å¦‚æœæº Activity çš„ç›®æ ‡ Activity å±äºåŒä¸€ä¸ªåº”ç”¨ï¼Œç›®æ ‡ Activity ç›®å‰è¿˜æ²¡æœ‰å®ä¾‹ï¼Œé‚£å°±ç›´æ¥åœ¨æ ˆé¡¶åˆ›å»ºè¯¥ Activity çš„å®ä¾‹ï¼›å¦‚æœå·²ç»æœ‰å®ä¾‹ï¼Œé‚£ä¹ˆå°†ä¼šæ¸…ç©ºè¯¥ Activity å®ä¾‹ä¸Šæ–¹çš„æ‰€æœ‰å…¶ä»– Activityï¼Œè®©ç›®æ ‡ Activity å¤„äºæ ˆé¡¶ä½ç½®ã€‚</li><li>å¦‚æœæº Activity å’Œç›®æ ‡ Activity ä¸å±äºåŒä¸€ä¸ªåº”ç”¨ï¼Œå¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰ç›®æ ‡ Activity çš„å®ä¾‹ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒçš„ä»»åŠ¡æ ˆï¼Œå¹¶åˆ›å»ºç›®æ ‡Activityçš„å®ä¾‹ï¼›å¦‚æœå·²ç»æœ‰å®ä¾‹ï¼Œåˆ™å°†å­˜åœ¨è¯¥ Activity çš„æ ˆç½®äºå‰å°ï¼ˆç”¨æˆ·å¯è§ï¼‰ï¼Œå¹¶ä¸”æ¸…ç©ºè¯¥ Activity å®ä¾‹ä¸Šæ–¹çš„æ‰€æœ‰å…¶ä»– Activityï¼Œè®©ç›®æ ‡ Activity å¤„äºæ ˆé¡¶ä½ç½®ã€‚</li></ul><p><strong>singleInstance</strong>ï¼šå®ƒå‡ ä¹å’Œ singleTask ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼ŒæŒæœ‰ç›®æ ‡ Activity çš„ä»»åŠ¡æ ˆä¸­åªèƒ½æœ‰ç›®æ ‡ Activity ä¸€ä¸ª Actvitiy å®ä¾‹ï¼Œä¸èƒ½å†æœ‰åˆ«çš„Activity å®ä¾‹ã€‚</p><h3 id="ActivityçŠ¶æ€ä¿å­˜ä¸æ¢å¤"><a href="#ActivityçŠ¶æ€ä¿å­˜ä¸æ¢å¤" class="headerlink" title="ActivityçŠ¶æ€ä¿å­˜ä¸æ¢å¤"></a>ActivityçŠ¶æ€ä¿å­˜ä¸æ¢å¤</h3><p>æ¯”å¦‚ Activity A å¯åŠ¨äº† Activity Bï¼ŒA ç”±äºæŸç§åŸå› è¢«æ€æ­»å›æ”¶èµ„æºäº†ï¼Œåœ¨ Activity è¢«æ€æ­»ä¹‹å‰å¯ä»¥ä½¿ç”¨<code>Activity.onSaveInstanceState()</code>æ–¹æ³•ä¸­è·å–ä¸€ä¸ª Bundleï¼Œè¿™ä¸ª Bundle å¯ä»¥åœ¨ A åˆé‡æ–°å¯åŠ¨æ—¶åœ¨<code>onCreate()</code>æˆ–è€…<code>onRestoreInstanceState()</code>æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œç”¨æ¥æ¢å¤æ•°æ®å’Œ UIã€‚</p><p>æœ‰äº›æ—¶å€™ï¼Œ<code>onSaveInstanceState()</code>æ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ï¼Œå®ƒå’Œ<code>onStop()</code>ã€<code>onPause()</code>ç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸èƒ½æ··æ·†ã€‚æ¯”å¦‚å½“ç”¨æˆ·ä» B è¿”å› A çš„æ—¶å€™ï¼ŒB ä¸­å°±ä¸ä¼šå†è°ƒç”¨<code>onSaveInstanceState()</code>ï¼Œå› ä¸ºå®ƒçš„å®ä¾‹å·²ç»è¢«é”€æ¯ï¼Œæ°¸è¿œä¸ä¼šæ¢å¤ã€‚</p><p><code>onRestoreInstanceState()</code>ä¼šåœ¨<code>onStart()</code>æ–¹æ³•åè¢«è°ƒç”¨ã€‚è™½ç„¶è°ƒç”¨<code>onCreate(Bundle)</code>ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒç›®çš„ï¼Œä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥åœ¨ä¸€äº›åˆå§‹åŒ–å·¥ä½œå®Œæˆåï¼Œå†æ¥æ¢å¤æ•°æ®ã€‚</p><h3 id="Activity-A-å¯åŠ¨å¦ä¸€ä¸ªActivity-B-ä¼šè°ƒç”¨å“ªäº›æ–¹æ³•ï¼Ÿå¦‚æœBæ˜¯é€æ˜ä¸»é¢˜çš„åˆæˆ–åˆ™æ˜¯ä¸ªDialogActivityå‘¢-ï¼Ÿ"><a href="#Activity-A-å¯åŠ¨å¦ä¸€ä¸ªActivity-B-ä¼šè°ƒç”¨å“ªäº›æ–¹æ³•ï¼Ÿå¦‚æœBæ˜¯é€æ˜ä¸»é¢˜çš„åˆæˆ–åˆ™æ˜¯ä¸ªDialogActivityå‘¢-ï¼Ÿ" class="headerlink" title="Activity A å¯åŠ¨å¦ä¸€ä¸ªActivity B ä¼šè°ƒç”¨å“ªäº›æ–¹æ³•ï¼Ÿå¦‚æœBæ˜¯é€æ˜ä¸»é¢˜çš„åˆæˆ–åˆ™æ˜¯ä¸ªDialogActivityå‘¢ ï¼Ÿ"></a>Activity A å¯åŠ¨å¦ä¸€ä¸ªActivity B ä¼šè°ƒç”¨å“ªäº›æ–¹æ³•ï¼Ÿå¦‚æœBæ˜¯é€æ˜ä¸»é¢˜çš„åˆæˆ–åˆ™æ˜¯ä¸ªDialogActivityå‘¢ ï¼Ÿ</h3><p>æˆ‘ä»¬ä¸å¤šè¯´ï¼Œç›´æ¥åšä¸ªå®éªŒï¼š</p><p>æˆ‘ä»¬åœ¨ Activity A å’Œ B ä¸­ï¼Œè¿œç”¨å¦‚ä¸‹æ ¼å¼æ˜¾ç¤ºç”Ÿå‘½å‘¨æœŸï¼š</p><pre><code class="kotlin">override fun onStart() &#123;    super.onStart()    Log.d(&quot;CodingRabbit&quot;, &quot;Activity A: onStart&quot;)&#125;</code></pre><p>ç„¶åçœ‹ä¸€ä¸‹è·³è½¬æ—¶çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼š</p><pre><code>D/CodingRabbit: Activity A: onPauseD/CodingRabbit: Activity B: onCreateD/CodingRabbit: Activity B: onStartD/CodingRabbit: Activity B: onResumeD/CodingRabbit: Activity A: onStop</code></pre><p>å¯è§å¹¶ä¸æ˜¯ Activity A çš„ <code>onPause()</code> åç«‹å³èµ° <code>onStop()</code>ï¼Œè€Œæ˜¯ç­‰å¾… Activity B çš„ <code>onResume()</code> èµ°å®Œåæ‰èµ°ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠ Activity B æ¢æˆé€æ˜çš„è¯•è¯•ã€‚</p><pre><code class="xml">&lt;style name=&quot;Theme.Custom.Transparent&quot; parent=&quot;Theme.AppCompat.NoActionBar&quot;&gt;    &lt;item name=&quot;android:background&quot;&gt;#33000000&lt;/item&gt;     &lt;item name=&quot;android:windowNoTitle&quot;&gt;true&lt;/item&gt;    &lt;item name=&quot;android:windowBackground&quot;&gt;@android:color/transparent&lt;/item&gt;    &lt;item name=&quot;android:colorBackgroundCacheHint&quot;&gt;@null&lt;/item&gt;    &lt;item name=&quot;android:windowIsTranslucent&quot;&gt;true&lt;/item&gt;&lt;/style&gt;&lt;activity android:name=&quot;.ActivityB&quot;            android:theme=&quot;@style/Theme.Custom.Transparent&quot;&gt;</code></pre><p>ç„¶åçœ‹ä¸€ä¸‹è·³è½¬æ—¶çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><pre><code>D/CodingRabbit: Activity A: onPauseD/CodingRabbit: Activity B: onCreateD/CodingRabbit: Activity B: onStartD/CodingRabbit: Activity B: onResume</code></pre><p>ä¸ä¸Šé¢çš„åŒºåˆ«æ˜¯ï¼ŒActivity A å¹¶æ²¡æœ‰èµ° <code>onStop()</code> æ–¹æ³•ã€‚</p><p>æŒ‰ä¸‹è¿”å›é”®åï¼š</p><pre><code>D/CodingRabbit: Activity B: onPauseD/CodingRabbit: Activity A: onResumeD/CodingRabbit: Activity B: onStopD/CodingRabbit: Activity B: onDestroy</code></pre><h3 id="è¯´è¯´-Apk-çš„æ‰“åŒ…è¿‡ç¨‹ï¼Ÿ"><a href="#è¯´è¯´-Apk-çš„æ‰“åŒ…è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="è¯´è¯´ Apk çš„æ‰“åŒ…è¿‡ç¨‹ï¼Ÿ"></a>è¯´è¯´ Apk çš„æ‰“åŒ…è¿‡ç¨‹ï¼Ÿ</h3><p>å…ˆä¸Šä¸ªå›¾ï¼š</p><p><img src="/img/682616-20191129131701331-804618503.png"></p><p>æµç¨‹åŸºæœ¬åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>æ‰“åŒ…èµ„æºæ–‡ä»¶ï¼Œç”ŸæˆR.javaæ–‡ä»¶ï¼Œä½¿ç”¨çš„æ˜¯ aapt</li><li>å¤„ç†aidlæ–‡ä»¶ï¼Œç”Ÿæˆç›¸åº”çš„Javaæ–‡ä»¶</li><li>ç¼–è¯‘é¡¹ç›®æºä»£ç ï¼Œç”Ÿæˆclassæ–‡ä»¶ï¼Œä½¿ç”¨çš„æ˜¯ javac</li><li>è½¬æ¢æ‰€æœ‰çš„classæ–‡ä»¶ï¼Œç”Ÿæˆclasses.dexæ–‡ä»¶ï¼Œä½¿ç”¨çš„æ˜¯ dex å·¥å…·</li><li>æ‰“åŒ…ç”ŸæˆAPKæ–‡ä»¶ï¼Œä½¿ç”¨çš„æ˜¯ apkbuilder</li><li>å¯¹APKæ–‡ä»¶è¿›è¡Œç­¾åï¼Œä½¿ç”¨çš„æ˜¯ jarsigner</li><li>å¯¹ç­¾ååçš„APKæ–‡ä»¶è¿›è¡Œå¯¹é½å¤„ç†ï¼Œä½¿ç”¨çš„æ˜¯ zipalign</li></ol><h3 id="è¯´è¯´-Service-ä¸-Activity-çš„å‡ ç§é€šä¿¡æ–¹å¼"><a href="#è¯´è¯´-Service-ä¸-Activity-çš„å‡ ç§é€šä¿¡æ–¹å¼" class="headerlink" title="è¯´è¯´ Service ä¸ Activity çš„å‡ ç§é€šä¿¡æ–¹å¼"></a>è¯´è¯´ Service ä¸ Activity çš„å‡ ç§é€šä¿¡æ–¹å¼</h3><p>å¦‚æœæ˜¯åå°ã€å‰å° Serviceï¼Œå¯ä»¥é€šè¿‡å¹¿æ’­çš„æ–¹å¼é€šä¿¡ï¼›å¦‚æœæ˜¯ç»‘å®š Serviceï¼Œéœ€è¦é€šè¿‡ Binder æ–¹å¼é€šä¿¡ï¼›å¦‚æœæ˜¯ IntentServiceï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ startService å‘ IntentService å‘é€è¯·æ±‚ã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹-IntentService"><a href="#ä»‹ç»ä¸€ä¸‹-IntentService" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ IntentService"></a>ä»‹ç»ä¸€ä¸‹ IntentService</h3><p>Service æœ‰ä¸€ä¸ªæ´¾ç”Ÿç±»æ˜¯ IntentServiceï¼ŒIntentService æ¯”çˆ¶ç±» Service è€Œè¨€ï¼Œæœ€å¤§ç‰¹ç‚¹æ˜¯å…¶å›è°ƒå‡½æ•°<code>onHandleIntent</code>ä¸­å¯ä»¥<strong>ç›´æ¥è¿›è¡Œè€—æ—¶æ“ä½œï¼Œä¸å¿…å†å¼€çº¿ç¨‹</strong>ã€‚å…¶åŸç†æ˜¯ IntentService åˆ©ç”¨äº† HandlerThreadï¼Œå®ƒ<strong>åœ¨åˆå§‹åŒ–æ—¶å·²å±äºå·¥ä½œçº¿ç¨‹</strong>ï¼Œæ‰€ä»¥ä¹‹åçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨å·¥ä½œçº¿ç¨‹ä¸­ã€‚IntentService è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å¤šæ¬¡è°ƒç”¨ onHandleIntent å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æœ‰å¤šä¸ªè€—æ—¶ä»»åŠ¡è¦æ‰§è¡Œï¼‰ï¼Œå¤šä¸ªè€—æ—¶ä»»åŠ¡ä¼šæŒ‰<strong>é¡ºåºä¾æ¬¡æ‰§è¡Œ</strong>ã€‚åŸç†æ˜¯å…¶å†…ç½®çš„ Handler <strong>å…³è”äº†ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼ŒHandler é€šè¿‡ Looper å–ä»»åŠ¡æ‰§è¡Œæ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚è¿™ä¸ªç‰¹ç‚¹å°±èƒ½è§£å†³å¤šä¸ªè€—æ—¶ä»»åŠ¡éœ€è¦é¡ºåºä¾æ¬¡æ‰§è¡Œçš„é—®é¢˜ã€‚è€Œå¦‚æœä»…ç”¨ Serviceï¼Œå¼€å¤šä¸ªçº¿ç¨‹å»æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå°±å¾ˆéš¾ç®¡ç†ã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹-JobScheduler"><a href="#ä»‹ç»ä¸€ä¸‹-JobScheduler" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ JobScheduler"></a>ä»‹ç»ä¸€ä¸‹ JobScheduler</h3><p>JobScheduler æ˜¯åŸºäºæ¡ä»¶æ‰§è¡Œä»»åŠ¡çš„ç³»ç»Ÿæœºåˆ¶ï¼Œåœ¨ Android 5.0 ä¸­å¼•å…¥ã€‚å®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ Android å¯¹åå°ä»»åŠ¡çš„é™åˆ¶ã€‚å®ƒä¼šåœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹æ‰§è¡Œï¼Œå¯ä»¥ä¿è¯æ‰§è¡Œï¼Œä½†æ— æ³•ä¿è¯æ‰§è¡Œçš„æ—¶é—´ã€‚</p><p>å¯ä»¥é€šè¿‡æ–°å»º JobInfo å¹¶æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ª JobService çš„ç±»ï¼Œé‡å†™<code>onStartJob()</code>å’Œ<code>onStopJob()</code>ï¼Œç„¶åä½¿ç”¨ JobScheduler.schedule() çš„æ–¹å¼å‘ç³»ç»Ÿæäº¤ä»»åŠ¡ã€‚JobScheduler æ˜¯ç³»ç»ŸæœåŠ¡ï¼Œå…¶å®ä¾‹éœ€è¦é€šè¿‡ <code>Context.getSystemService(Context.JOB_SCHEDULER_SERVICE)</code> æ¥è·å–ã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹-Context-å’Œ-ContextWrapper-å’Œ-ContextImpl"><a href="#ä»‹ç»ä¸€ä¸‹-Context-å’Œ-ContextWrapper-å’Œ-ContextImpl" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ Context å’Œ ContextWrapper å’Œ ContextImpl"></a>ä»‹ç»ä¸€ä¸‹ Context å’Œ ContextWrapper å’Œ ContextImpl</h3><p>ContextWrapper ä½¿ç”¨äº†è£…é¥°å™¨æ¨¡å¼ï¼Œå®ƒåŒ…è£…äº†ä¸€ä¸ª Contextï¼Œè¿™ä¸ª Context å®ä¾‹ä¼šé€šè¿‡<code>ContextWrapper.attachBaseContext()</code>æ–¹æ³•æ¥èµ‹å€¼ã€‚ContextImpl æ˜¯ Context çš„å…·ä½“å®ç°ï¼Œåƒè°ƒç”¨<code>startActivity()</code>ä¹‹ç±»çš„æ–¹æ³•éƒ½æ˜¯ç”±å®ƒæ¥å…·ä½“å®ç°çš„ã€‚</p><h3 id="Application-Context-å’Œ-Activity-Context-çš„åŒºåˆ«ï¼Ÿ"><a href="#Application-Context-å’Œ-Activity-Context-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Application Context å’Œ Activity Context çš„åŒºåˆ«ï¼Ÿ"></a>Application Context å’Œ Activity Context çš„åŒºåˆ«ï¼Ÿ</h3><p>Application Context åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæ— è®ºåœ¨ä½•å¤„è·å–ï¼Œè·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼›è€Œ Activity Context è·å–çš„æ˜¯å½“å‰ Activtiy çš„ Context å®ä¾‹ã€‚</p><p>Application Context å¦‚æœè¦ç”¨æ¥å¯åŠ¨ Activityï¼Œéœ€è¦æ·»åŠ  FLAG_ACTIVITY_NEW_TASK æ ‡è¯†ï¼Œä»¥å¯åŠ¨ä¸€ä¸ªæ–°çš„ä»»åŠ¡æ ˆã€‚Activity Context å¯ä»¥ç›´æ¥å¯åŠ¨ Activity</p><h3 id="ä»‹ç»ä¸€ä¸‹-AsyncTask"><a href="#ä»‹ç»ä¸€ä¸‹-AsyncTask" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ AsyncTask"></a>ä»‹ç»ä¸€ä¸‹ AsyncTask</h3><p>AsyncTask æ˜¯ä¸€ä¸ªé€‚åˆæ‰§è¡ŒçŸ­æ—¶ä»»åŠ¡çš„å·¥å…·ç±»ï¼Œå®ƒå¸®æˆ‘ä»¬å¤„ç†äº† Thread å’Œ Handler ä¹‹é—´çš„åä½œï¼Œä»è€Œè®©æˆ‘ä»¬ä¸ç”¨ç›´æ¥å¯¹è¿™ä¸¤ç§ç±»è¿›è¡Œæ“ä½œã€‚å®ƒæ¯”è¾ƒé€‚åˆæ‰§è¡ŒçŸ­æœŸä»»åŠ¡ï¼Œå¦‚æœè¦æ‰§è¡Œé•¿æ—¶é—´çš„ä»»åŠ¡ï¼Œé‚£è¿˜æ˜¯ä½¿ç”¨ Executorã€ThreadPoolExecutor æˆ–è€… FutureTaskã€‚</p><p>ä½¿ç”¨å®ƒéœ€è¦ç»§æ‰¿ AsyncTask ç±»å¹¶é‡å†™å››ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>onPreExecute()</code>ï¼šä»»åŠ¡å¼€å§‹æ‰§è¡Œå‰çš„å›è°ƒï¼Œæ­¤æ—¶åœ¨ä¸»çº¿ç¨‹</li><li><code>doInBackground()</code>ï¼šä»»åŠ¡å¼€å§‹æ‰§è¡Œçš„å›è°ƒï¼Œæ­¤æ—¶åœ¨å­çº¿ç¨‹</li><li><code>onProgressUpdate()</code>ï¼šä»»åŠ¡æœ‰è¿›å±•æ—¶çš„å›è°ƒï¼Œåœ¨ä¸»çº¿ç¨‹</li><li><code>onPostExecute()</code>ï¼šä»»åŠ¡å®Œæˆæ—¶çš„å›è°ƒï¼Œåœ¨ä¸»çº¿ç¨‹</li></ul><p>AsyncTask ç±»æœ‰ä¸‰ä¸ªæ³›å‹ç±»ï¼š</p><ul><li>Paramsï¼šå‚æ•°çš„ç±»å‹</li><li>Progressï¼šè¿›åº¦å€¼çš„å•ä½</li><li>Resultï¼šä»»åŠ¡ç»“æŸåè¿”å›ç»“æœçš„ç±»å‹</li></ul><p>å®ƒå¿…é¡»è¦åœ¨ä¸»çº¿ç¨‹æ–°å»ºå®ä¾‹ï¼Œå®ƒçš„ä»»åŠ¡åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>å®ƒçš„å†…éƒ¨å®ç°æ˜¯é‡‡ç”¨äº†çº¿ç¨‹æ± æœºåˆ¶ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚</p><p>å®ƒçš„çº¿ç¨‹æ± æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯<strong>å·¥ä½œçº¿ç¨‹æ± </strong>å’Œ<strong>å¤‡ç”¨çº¿ç¨‹æ± </strong>ã€‚å½“å·¥ä½œçº¿ç¨‹æ— æ³•æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä»»åŠ¡ä¼šè¢«æ”¾åˆ°å¤‡ç”¨çº¿ç¨‹æ± ä¸­ã€‚æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨<code>ThreadPoolExecutor.setRejectedExecutionHandler()</code>æŒ‡å®šä¸€ä¸ª Handler æ¥å¤„ç†æ— æ³•æ‰§è¡Œçš„é—®é¢˜ã€‚</p><p>å·¥ä½œçº¿ç¨‹æ± ï¼šè¯¥çº¿ç¨‹æ± æœ‰<strong>1ä¸ªæ ¸å¿ƒçº¿ç¨‹</strong>ï¼Œ<strong>æœ€å¤§çº¿ç¨‹æ•°é‡ä¸º50</strong>ï¼Œç©ºé—²æ—¶é—´ä¸º3ç§’ï¼Œä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯ LinkedBlockingQueueã€‚</p><p>å¤‡ç”¨çº¿ç¨‹æ± ï¼š5ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨çš„ä¹Ÿæ˜¯ LinkedBlockingQueueã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>å¤‡ç”¨çº¿ç¨‹æ± ä¸å¯ç”¨</strong>ã€‚</p><h3 id="AsyncTask-æœ‰ä»€ä¹ˆä¸è¶³ï¼Ÿ"><a href="#AsyncTask-æœ‰ä»€ä¹ˆä¸è¶³ï¼Ÿ" class="headerlink" title="AsyncTask æœ‰ä»€ä¹ˆä¸è¶³ï¼Ÿ"></a>AsyncTask æœ‰ä»€ä¹ˆä¸è¶³ï¼Ÿ</h3><p>å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸ Activity ä¸æ˜¯ç»‘å®šçš„ï¼Œå¯¼è‡´ Activity é”€æ¯åï¼ŒAsyncTask è¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°<code>onPostExecute()</code>ï¼Œè¿™éœ€è¦è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚è¿˜æœ‰ï¼Œå¦‚æœåœ¨æ‰§è¡Œä»»åŠ¡æœŸé—´ï¼ŒActivity ç”±äºæŸç§åŸå› é‡æ–°åˆ›å»ºäº†ï¼ˆæ¯”å¦‚å±å¹•æ—‹è½¬æˆ–é”€æ¯åˆæ¢å¤ï¼‰ï¼ŒAsyncTask æ‰§è¡Œç»“æŸä¹Ÿä¸ä¼šæ›´æ–° UI äº†ï¼Œç”šè‡³è¿˜æœ‰å¯èƒ½å¼•èµ·<code>NullPointerException</code>ã€‚<br>å¦å¤–ï¼ŒAsyncTask çš„çº¿ç¨‹æ± æ•°é‡æ˜¯ 50ï¼Œåæ¥è¢«ä¿®æ”¹ä¸º 20ï¼Œæ‰€ä»¥æ‰§è¡Œèƒ½åŠ›æœ‰é™ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹æ›´æ–°-UIï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹æ›´æ–°-UIï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹æ›´æ–° UIï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹æ›´æ–° UIï¼Ÿ</h3><p>åŸåˆ™ä¸Šæ¥è¯´ï¼Œæ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ã€‚</p><p>å› ä¸º Android åœ¨è®¿é—® UI æ—¶æ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œå¦‚æœèƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸‹è®¿é—® UIï¼Œåˆ™æœ‰å¯èƒ½ä¼šå¯¼è‡´ UI å¤„äºä¸å¯é¢„æœŸçš„çŠ¶æ€ã€‚å¦‚æœè¦ç»™ UI åŠ é”ï¼Œä¼šè®© UI æ§ä»¶å˜å¾—å¤æ‚å’Œä½æ•ˆï¼ŒåŒæ—¶ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•èµ·å…¶ä»–çº¿ç¨‹çš„é˜»å¡ã€‚æ‰€ä»¥åœ¨ Android ä¸­ï¼Œæ¯å½“æ›´æ–° UI çš„æ—¶å€™ï¼Œä¼šæœ‰ layout è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨åˆ°<code>ViewRootImpl.checkThread()</code>æ£€æŸ¥å½“å‰çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ä¸»çº¿ç¨‹ï¼Œå°±ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>é‚£ä¹ˆï¼Œå­çº¿ç¨‹æœ‰èƒ½åŠ›æ›´æ–° UI å—ï¼Ÿæœ‰ã€‚åœ¨<code>onCreate()</code>æ–¹æ³•ä¸­å»æ›´æ–° UIï¼Œæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ ViewRootImpl å°šæœªåˆ›å»ºï¼Œè¿˜æ²¡æœ‰åˆ° layout é˜¶æ®µï¼Œæ‰€ä»¥æ­¤æ—¶æ˜¯å¯ä»¥ä¿®æ”¹ UI çš„ã€‚</p><h3 id="ANR-å®šä½å’Œä¿®æ­£"><a href="#ANR-å®šä½å’Œä¿®æ­£" class="headerlink" title="ANR å®šä½å’Œä¿®æ­£?"></a>ANR å®šä½å’Œä¿®æ­£?</h3><p>ANR çš„å‡ºç°æ˜¯ç”±äºä¸»çº¿ç¨‹çš„ Looper æ— æ³•åœ¨è§„å®šæ—¶é—´å†…å–å‡ºä¸‹ä¸€æ¡æ¶ˆæ¯å¯¼è‡´çš„ã€‚æ¯å½“å‘ç”Ÿ ANRï¼Œå¯ä»¥åœ¨ <code>/data/anr/traces.txt</code> æ–‡ä»¶ä¸­æ‰¾åˆ° ANR äº§ç”Ÿçš„ä»£ç ä½ç½®ï¼Œç„¶åå°±å¯ä»¥æ ¹æ®å®ƒä¿®æ­£ã€‚</p><p>åŒæ—¶ï¼Œå°½é‡é¿å…åœ¨ BroadcastReceiver ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼Œå¦‚æœè¶…è¿‡10ç§’ï¼Œåˆ™ä¼šå¼•èµ· ANRã€‚ä¸»çº¿ç¨‹ä¸Šçš„é˜ˆå€¼æ˜¯ 5 ç§’ã€‚Service ä¸­åå°ã€å‰å°ã€ç»‘å®š Service åˆ†åˆ«æ˜¯ 20ç§’ã€5ç§’å’Œ200ç§’ã€‚</p><h3 id="æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å…-OOM"><a href="#æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å…-OOM" class="headerlink" title="æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å… OOM ?"></a>æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å… OOM ?</h3><p>å¯ä»¥ä»å››ä¸ªæ–¹é¢ç€æ‰‹ã€‚</p><p>é¦–å…ˆæ˜¯å‡å°å¯¹è±¡çš„å†…å­˜å ç”¨ï¼Œå…¶æ¬¡æ˜¯å†…å­˜å¯¹è±¡çš„é‡å¤åˆ©ç”¨ï¼Œç„¶åæ˜¯é¿å…å¯¹è±¡çš„å†…å­˜æ³„éœ²ï¼Œæœ€åæ˜¯å†…å­˜ä½¿ç”¨ç­–ç•¥ä¼˜åŒ–ã€‚</p><p>1ï¼‰ä½¿ç”¨æ›´åŠ è½»é‡çš„æ•°æ®ç»“æ„</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ArrayMap/SparseArrayè€Œä¸æ˜¯HashMapç­‰ä¼ ç»Ÿæ•°æ®ç»“æ„ï¼Œä¸‹å›¾æ¼”ç¤ºäº†HashMapçš„ç®€è¦å·¥ä½œåŸç†ï¼Œç›¸æ¯”èµ·Androidç³»ç»Ÿä¸“é—¨ä¸ºç§»åŠ¨æ“ä½œç³»ç»Ÿç¼–å†™çš„ArrayMapå®¹å™¨ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½æ˜¾ç¤ºæ•ˆç‡ä½ä¸‹ï¼Œæ›´å å†…å­˜ã€‚é€šå¸¸çš„HashMapçš„å®ç°æ–¹å¼æ›´åŠ æ¶ˆè€—å†…å­˜ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€ä¸ªé¢å¤–çš„å®ä¾‹å¯¹è±¡æ¥è®°å½•Mappingæ“ä½œã€‚å¦å¤–ï¼ŒSparseArrayæ›´åŠ é«˜æ•ˆåœ¨äºä»–ä»¬é¿å…äº†å¯¹keyä¸valueçš„autoboxè‡ªåŠ¨è£…ç®±ï¼Œå¹¶ä¸”é¿å…äº†è£…ç®±åçš„è§£ç®±ã€‚</p><p>2ï¼‰é¿å…åœ¨Androidé‡Œé¢ä½¿ç”¨Enum</p><p>3ï¼‰å‡å°Bitmapå¯¹è±¡çš„å†…å­˜å ç”¨</p><p>Bitmapæ˜¯ä¸€ä¸ªæå®¹æ˜“æ¶ˆè€—å†…å­˜çš„å¤§èƒ–å­ï¼Œå‡å°åˆ›å»ºå‡ºæ¥çš„Bitmapçš„å†…å­˜å ç”¨æ˜¯å¾ˆé‡è¦çš„ï¼Œé€šå¸¸æ¥è¯´æœ‰ä¸‹é¢2ä¸ªæªæ–½ï¼š</p><p>inSampleSizeï¼šç¼©æ”¾æ¯”ä¾‹ï¼Œåœ¨æŠŠå›¾ç‰‡è½½å…¥å†…å­˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¡ç®—å‡ºä¸€ä¸ªåˆé€‚çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œé¿å…ä¸å¿…è¦çš„å¤§å›¾è½½å…¥ã€‚</p><p>decode formatï¼šè§£ç æ ¼å¼ï¼Œé€‰æ‹©ARGB_8888/RBG_565/ARGB_4444/ALPHA_8ï¼Œå­˜åœ¨å¾ˆå¤§å·®å¼‚ã€‚</p><p>4ï¼‰ä½¿ç”¨æ›´å°çš„å›¾ç‰‡</p><p>åœ¨è®¾è®¡ç»™åˆ°èµ„æºå›¾ç‰‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«ç•™æ„è¿™å¼ å›¾ç‰‡æ˜¯å¦å­˜åœ¨å¯ä»¥å‹ç¼©çš„ç©ºé—´ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨ä¸€å¼ æ›´å°çš„å›¾ç‰‡ã€‚å°½é‡ä½¿ç”¨æ›´å°çš„å›¾ç‰‡ä¸ä»…ä»…å¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œè¿˜å¯ä»¥é¿å…å‡ºç°å¤§é‡çš„InflationExceptionã€‚å‡è®¾æœ‰ä¸€å¼ å¾ˆå¤§çš„å›¾ç‰‡è¢«XMLæ–‡ä»¶ç›´æ¥å¼•ç”¨ï¼Œå¾ˆæœ‰å¯èƒ½åœ¨åˆå§‹åŒ–è§†å›¾çš„æ—¶å€™å°±ä¼šå› ä¸ºå†…å­˜ä¸è¶³è€Œå‘ç”ŸInflationExceptionï¼Œè¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› å…¶å®æ˜¯å‘ç”Ÿäº†OOMã€‚</p><p>åœ¨Androidä¸Šé¢æœ€å¸¸ç”¨çš„ä¸€ä¸ªç¼“å­˜ç®—æ³•æ˜¯LRU(Least Recently Use)</p><p>5ï¼‰å¤ç”¨ç³»ç»Ÿè‡ªå¸¦çš„èµ„æº</p><p>Androidç³»ç»Ÿæœ¬èº«å†…ç½®äº†å¾ˆå¤šçš„èµ„æºï¼Œä¾‹å¦‚å­—ç¬¦ä¸²/é¢œè‰²/å›¾ç‰‡/åŠ¨ç”»/æ ·å¼ä»¥åŠç®€å•å¸ƒå±€ç­‰ç­‰ï¼Œè¿™äº›èµ„æºéƒ½å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥å¼•ç”¨ã€‚è¿™æ ·åšä¸ä»…ä»…å¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºçš„è‡ªèº«è´Ÿé‡ï¼Œå‡å°APKçš„å¤§å°ï¼Œå¦å¤–è¿˜å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å†…å­˜çš„å¼€é”€ï¼Œå¤ç”¨æ€§æ›´å¥½ã€‚ä½†æ˜¯ä¹Ÿæœ‰å¿…è¦ç•™æ„Androidç³»ç»Ÿçš„ç‰ˆæœ¬å·®å¼‚æ€§ï¼Œå¯¹é‚£äº›ä¸åŒç³»ç»Ÿç‰ˆæœ¬ä¸Šè¡¨ç°å­˜åœ¨å¾ˆå¤§å·®å¼‚ï¼Œä¸ç¬¦åˆéœ€æ±‚çš„æƒ…å†µï¼Œè¿˜æ˜¯éœ€è¦åº”ç”¨ç¨‹åºè‡ªèº«å†…ç½®è¿›å»ã€‚</p><p>6ï¼‰æ³¨æ„åœ¨ListView/GridViewç­‰å‡ºç°å¤§é‡é‡å¤å­ç»„ä»¶çš„è§†å›¾é‡Œé¢å¯¹ConvertViewçš„å¤ç”¨</p><p>7ï¼‰Bitmapå¯¹è±¡çš„å¤ç”¨</p><p>åœ¨ListViewä¸GridViewç­‰æ˜¾ç¤ºå¤§é‡å›¾ç‰‡çš„æ§ä»¶é‡Œé¢éœ€è¦ä½¿ç”¨LRUçš„æœºåˆ¶æ¥ç¼“å­˜å¤„ç†å¥½çš„Bitmapã€‚</p><p>åˆ©ç”¨inBitmapçš„é«˜çº§ç‰¹æ€§æé«˜Androidç³»ç»Ÿåœ¨Bitmapåˆ†é…ä¸é‡Šæ”¾æ‰§è¡Œæ•ˆç‡ä¸Šçš„æå‡(3.0ä»¥åŠ4.4ä»¥åå­˜åœ¨ä¸€äº›ä½¿ç”¨é™åˆ¶ä¸Šçš„å·®å¼‚)ã€‚ä½¿ç”¨inBitmapå±æ€§å¯ä»¥å‘ŠçŸ¥Bitmapè§£ç å™¨å»å°è¯•ä½¿ç”¨å·²ç»å­˜åœ¨çš„å†…å­˜åŒºåŸŸï¼Œæ–°è§£ç çš„bitmapä¼šå°è¯•å»ä½¿ç”¨ä¹‹å‰é‚£å¼ bitmapåœ¨heapä¸­æ‰€å æ®çš„pixel dataå†…å­˜åŒºåŸŸï¼Œè€Œä¸æ˜¯å»é—®å†…å­˜é‡æ–°ç”³è¯·ä¸€å—åŒºåŸŸæ¥å­˜æ”¾bitmapã€‚åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œå³ä½¿æ˜¯ä¸Šåƒå¼ çš„å›¾ç‰‡ï¼Œä¹Ÿåªä¼šä»…ä»…åªéœ€è¦å ç”¨å±å¹•æ‰€èƒ½å¤Ÿæ˜¾ç¤ºçš„å›¾ç‰‡æ•°é‡çš„å†…å­˜å¤§å°ã€‚</p><p>8ï¼‰é¿å…åœ¨onDrawæ–¹æ³•é‡Œé¢æ‰§è¡Œå¯¹è±¡çš„åˆ›å»º</p><p>ç±»ä¼¼onDrawç­‰é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ï¼Œä¸€å®šéœ€è¦æ³¨æ„é¿å…åœ¨è¿™é‡Œåšåˆ›å»ºå¯¹è±¡çš„æ“ä½œï¼Œå› ä¸ºä»–ä¼šè¿…é€Ÿå¢åŠ å†…å­˜çš„ä½¿ç”¨ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¼•èµ·é¢‘ç¹çš„gcï¼Œç”šè‡³æ˜¯å†…å­˜æŠ–åŠ¨ã€‚</p><p>9ï¼‰StringBuilder</p><p>åœ¨æœ‰äº›æ—¶å€™ï¼Œä»£ç ä¸­ä¼šéœ€è¦ä½¿ç”¨åˆ°å¤§é‡çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ“ä½œï¼Œè¿™ç§æ—¶å€™æœ‰å¿…è¦è€ƒè™‘ä½¿ç”¨StringBuilderæ¥æ›¿ä»£é¢‘ç¹çš„â€œ+â€ã€‚</p><p>é¿å…å¯¹è±¡çš„å†…å­˜æ³„éœ²</p><p>å†…å­˜å¯¹è±¡çš„æ³„æ¼ï¼Œä¼šå¯¼è‡´ä¸€äº›ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ— æ³•åŠæ—¶é‡Šæ”¾ï¼Œè¿™æ ·ä¸€æ–¹é¢å ç”¨äº†å®è´µçš„å†…å­˜ç©ºé—´ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´åç»­éœ€è¦åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œç©ºé—²ç©ºé—´ä¸è¶³è€Œå‡ºç°OOMã€‚æ˜¾ç„¶ï¼Œè¿™è¿˜ä½¿å¾—æ¯çº§Generationçš„å†…å­˜åŒºåŸŸå¯ç”¨ç©ºé—´å˜å°ï¼Œgcå°±ä¼šæ›´å®¹æ˜“è¢«è§¦å‘ï¼Œå®¹æ˜“å‡ºç°å†…å­˜æŠ–åŠ¨ï¼Œä»è€Œå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚</p><p>10ï¼‰æ³¨æ„Activityçš„æ³„æ¼</p><p>é€šå¸¸æ¥è¯´ï¼ŒActivityçš„æ³„æ¼æ˜¯å†…å­˜æ³„æ¼é‡Œé¢æœ€ä¸¥é‡çš„é—®é¢˜ï¼Œå®ƒå ç”¨çš„å†…å­˜å¤šï¼Œå½±å“é¢å¹¿ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹ä¸¤ç§æƒ…å†µå¯¼è‡´çš„Activityæ³„æ¼ï¼š</p><p>å†…éƒ¨ç±»å¼•ç”¨å¯¼è‡´Activityçš„æ³„æ¼</p><p>æœ€å…¸å‹çš„åœºæ™¯æ˜¯Handlerå¯¼è‡´çš„Activityæ³„æ¼ï¼Œå¦‚æœHandlerä¸­æœ‰å»¶è¿Ÿçš„ä»»åŠ¡æˆ–è€…æ˜¯ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—è¿‡é•¿ï¼Œéƒ½æœ‰å¯èƒ½å› ä¸ºHandlerç»§ç»­æ‰§è¡Œè€Œå¯¼è‡´Activityå‘ç”Ÿæ³„æ¼ã€‚æ­¤æ—¶çš„å¼•ç”¨å…³ç³»é“¾æ˜¯Looper -&gt; MessageQueue -&gt; Message -&gt; Handler -&gt; Activityã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨UIé€€å‡ºä¹‹å‰ï¼Œæ‰§è¡Œremove Handleræ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸runnableå¯¹è±¡ã€‚æˆ–è€…æ˜¯ä½¿ç”¨Static + WeakReferenceçš„æ–¹å¼æ¥è¾¾åˆ°æ–­å¼€Handlerä¸Activityä¹‹é—´å­˜åœ¨å¼•ç”¨å…³ç³»çš„ç›®çš„ã€‚</p><p>Activity Contextè¢«ä¼ é€’åˆ°å…¶ä»–å®ä¾‹ä¸­ï¼Œè¿™å¯èƒ½å¯¼è‡´è‡ªèº«è¢«å¼•ç”¨è€Œå‘ç”Ÿæ³„æ¼ã€‚</p><p>å†…éƒ¨ç±»å¼•èµ·çš„æ³„æ¼ä¸ä»…ä»…ä¼šå‘ç”Ÿåœ¨Activityä¸Šï¼Œå…¶ä»–ä»»ä½•å†…éƒ¨ç±»å‡ºç°çš„åœ°æ–¹ï¼Œéƒ½éœ€è¦ç‰¹åˆ«ç•™æ„ï¼æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°½é‡ä½¿ç”¨staticç±»å‹çš„å†…éƒ¨ç±»ï¼ŒåŒæ—¶ä½¿ç”¨WeakReferenceçš„æœºåˆ¶æ¥é¿å…å› ä¸ºäº’ç›¸å¼•ç”¨è€Œå‡ºç°çš„æ³„éœ²ã€‚</p><p>11ï¼‰è€ƒè™‘ä½¿ç”¨Application Contextè€Œä¸æ˜¯Activity Context</p><p>å¯¹äºå¤§éƒ¨åˆ†éå¿…é¡»ä½¿ç”¨Activity Contextçš„æƒ…å†µï¼ˆDialogçš„Contextå°±å¿…é¡»æ˜¯Activity Contextï¼‰ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨Application Contextè€Œä¸æ˜¯Activityçš„Contextï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸ç»æ„çš„Activityæ³„éœ²ã€‚</p><p>12ï¼‰æ³¨æ„ä¸´æ—¶Bitmapå¯¹è±¡çš„åŠæ—¶å›æ”¶</p><p>è™½ç„¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå¯¹Bitmapå¢åŠ ç¼“å­˜æœºåˆ¶ï¼Œä½†æ˜¯åœ¨æŸäº›æ—¶å€™ï¼Œéƒ¨åˆ†Bitmapæ˜¯éœ€è¦åŠæ—¶å›æ”¶çš„ã€‚ä¾‹å¦‚ä¸´æ—¶åˆ›å»ºçš„æŸä¸ªç›¸å¯¹æ¯”è¾ƒå¤§çš„bitmapå¯¹è±¡ï¼Œåœ¨ç»è¿‡å˜æ¢å¾—åˆ°æ–°çš„bitmapå¯¹è±¡ä¹‹åï¼Œåº”è¯¥å°½å¿«å›æ”¶åŸå§‹çš„bitmapï¼Œè¿™æ ·èƒ½å¤Ÿæ›´å¿«é‡Šæ”¾åŸå§‹bitmapæ‰€å ç”¨çš„ç©ºé—´ã€‚</p><p>éœ€è¦ç‰¹åˆ«ç•™æ„çš„æ˜¯Bitmapç±»é‡Œé¢æä¾›çš„createBitmap()æ–¹æ³•ï¼š</p><p>è¿™ä¸ªå‡½æ•°è¿”å›çš„bitmapæœ‰å¯èƒ½å’Œsource bitmapæ˜¯åŒä¸€ä¸ªï¼Œåœ¨å›æ”¶çš„æ—¶å€™ï¼Œéœ€è¦ç‰¹åˆ«æ£€æŸ¥source bitmapä¸return bitmapçš„å¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œåªæœ‰åœ¨ä¸ç­‰çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½å¤Ÿæ‰§è¡Œsource bitmapçš„recycleæ–¹æ³•ã€‚</p><p>13ï¼‰æ³¨æ„WebViewçš„æ³„æ¼</p><p>Androidä¸­çš„WebViewå­˜åœ¨å¾ˆå¤§çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä¸ä»…ä»…æ˜¯Androidç³»ç»Ÿç‰ˆæœ¬çš„ä¸åŒå¯¹WebViewäº§ç”Ÿå¾ˆå¤§çš„å·®å¼‚ï¼Œå¦å¤–ä¸åŒçš„å‚å•†å‡ºè´§çš„ROMé‡Œé¢WebViewä¹Ÿå­˜åœ¨ç€å¾ˆå¤§çš„å·®å¼‚ã€‚æ›´ä¸¥é‡çš„æ˜¯æ ‡å‡†çš„WebViewå­˜åœ¨å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œçœ‹è¿™é‡ŒWebView causes memory leak - leaks the parent Activityã€‚æ‰€ä»¥é€šå¸¸æ ¹æ²»è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯ä¸ºWebViewå¼€å¯å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡AIDLä¸ä¸»è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼ŒWebViewæ‰€åœ¨çš„è¿›ç¨‹å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€è¦é€‰æ‹©åˆé€‚çš„æ—¶æœºè¿›è¡Œé”€æ¯ï¼Œä»è€Œè¾¾åˆ°å†…å­˜çš„å®Œæ•´é‡Šæ”¾ã€‚</p><p>14ï¼‰èµ„æºæ–‡ä»¶éœ€è¦é€‰æ‹©åˆé€‚çš„æ–‡ä»¶å¤¹è¿›è¡Œå­˜æ”¾</p><p>æˆ‘ä»¬çŸ¥é“hdpi/xhdpi/xxhdpiç­‰ç­‰ä¸åŒdpiçš„æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šä¼šç»è¿‡scaleçš„å¤„ç†ã€‚ä¾‹å¦‚æˆ‘ä»¬åªåœ¨hdpiçš„ç›®å½•ä¸‹æ”¾ç½®äº†ä¸€å¼ 100100çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆæ ¹æ®æ¢ç®—å…³ç³»ï¼Œxxhdpiçš„æ‰‹æœºå»å¼•ç”¨é‚£å¼ å›¾ç‰‡å°±ä¼šè¢«æ‹‰ä¼¸åˆ°200200ã€‚éœ€è¦æ³¨æ„åˆ°åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…å­˜å ç”¨æ˜¯ä¼šæ˜¾è‘—æé«˜çš„ã€‚å¯¹äºä¸å¸Œæœ›è¢«æ‹‰ä¼¸çš„å›¾ç‰‡ï¼Œéœ€è¦æ”¾åˆ°assetsæˆ–è€…nodpiçš„ç›®å½•ä¸‹ã€‚</p><p>15ï¼‰è°¨æ…ä½¿ç”¨staticå¯¹è±¡</p><p>å› ä¸ºstaticçš„ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ï¼Œå’Œåº”ç”¨çš„è¿›ç¨‹ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨ä¸å½“å¾ˆå¯èƒ½å¯¼è‡´å¯¹è±¡æ³„æ¼ï¼Œåœ¨Androidä¸­åº”è¯¥è°¨æ…ä½¿ç”¨staticå¯¹è±¡ã€‚</p><p>16ï¼‰ç‰¹åˆ«ç•™æ„å•ä¾‹å¯¹è±¡ä¸­ä¸åˆç†çš„æŒæœ‰</p><p>è™½ç„¶å•ä¾‹æ¨¡å¼ç®€å•å®ç”¨ï¼Œæä¾›äº†å¾ˆå¤šä¾¿åˆ©æ€§ï¼Œä½†æ˜¯å› ä¸ºå•ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨ä¸åˆç†å¾ˆå®¹æ˜“å‡ºç°æŒæœ‰å¯¹è±¡çš„æ³„æ¼ã€‚</p><p>17ï¼‰çæƒœServicesèµ„æº</p><p>18ï¼‰ä¼˜åŒ–å¸ƒå±€å±‚æ¬¡ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—</p><p>è¶Šæ‰å¹³åŒ–çš„è§†å›¾å¸ƒå±€ï¼Œå ç”¨çš„å†…å­˜å°±è¶Šå°‘ï¼Œæ•ˆç‡è¶Šé«˜ã€‚æˆ‘ä»¬éœ€è¦å°½é‡ä¿è¯å¸ƒå±€è¶³å¤Ÿæ‰å¹³åŒ–ï¼Œå½“ä½¿ç”¨ç³»ç»Ÿæä¾›çš„Viewæ— æ³•å®ç°è¶³å¤Ÿæ‰å¹³çš„æ—¶å€™è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰Viewæ¥è¾¾åˆ°ç›®çš„ã€‚</p><p>19ï¼‰è°¨æ…ä½¿ç”¨â€œæŠ½è±¡â€ç¼–ç¨‹</p><p>å¾ˆå¤šæ—¶å€™ï¼Œå¼€å‘è€…ä¼šä½¿ç”¨æŠ½è±¡ç±»ä½œä¸ºâ€å¥½çš„ç¼–ç¨‹å®è·µâ€ï¼Œå› ä¸ºæŠ½è±¡èƒ½å¤Ÿæå‡ä»£ç çš„çµæ´»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚ç„¶è€Œï¼ŒæŠ½è±¡ä¼šå¯¼è‡´ä¸€ä¸ªæ˜¾è‘—çš„é¢å¤–å†…å­˜å¼€é”€ï¼šä»–ä»¬éœ€è¦åŒç­‰é‡çš„ä»£ç ç”¨äºå¯æ‰§è¡Œï¼Œé‚£äº›ä»£ç ä¼šè¢«mappingåˆ°å†…å­˜ä¸­ï¼Œå› æ­¤å¦‚æœä½ çš„æŠ½è±¡æ²¡æœ‰æ˜¾è‘—çš„æå‡æ•ˆç‡ï¼Œåº”è¯¥å°½é‡é¿å…ä»–ä»¬ã€‚</p><p>20ï¼‰è°¨æ…ä½¿ç”¨å¤šè¿›ç¨‹</p><p>ä½¿ç”¨å¤šè¿›ç¨‹å¯ä»¥æŠŠåº”ç”¨ä¸­çš„éƒ¨åˆ†ç»„ä»¶è¿è¡Œåœ¨å•ç‹¬çš„è¿›ç¨‹å½“ä¸­ï¼Œè¿™æ ·å¯ä»¥æ‰©å¤§åº”ç”¨çš„å†…å­˜å ç”¨èŒƒå›´ï¼Œä½†æ˜¯è¿™ä¸ªæŠ€æœ¯å¿…é¡»è°¨æ…ä½¿ç”¨ï¼Œç»å¤§å¤šæ•°åº”ç”¨éƒ½ä¸åº”è¯¥è´¸ç„¶ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºä½¿ç”¨å¤šè¿›ç¨‹ä¼šä½¿å¾—ä»£ç é€»è¾‘æ›´åŠ å¤æ‚ï¼Œå¦å¤–å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒå¯èƒ½åè€Œä¼šå¯¼è‡´æ˜¾è‘—å¢åŠ å†…å­˜ã€‚å½“ä½ çš„åº”ç”¨éœ€è¦è¿è¡Œä¸€ä¸ªå¸¸é©»åå°çš„ä»»åŠ¡ï¼Œè€Œä¸”è¿™ä¸ªä»»åŠ¡å¹¶ä¸è½»é‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åˆ›å»ºä¸€ä¸ªå¯ä»¥é•¿æ—¶é—´åå°æ’­æ”¾çš„Music Playerã€‚å¦‚æœæ•´ä¸ªåº”ç”¨éƒ½è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå½“åå°æ’­æ”¾çš„æ—¶å€™ï¼Œå‰å°çš„é‚£äº›UIèµ„æºä¹Ÿæ²¡æœ‰åŠæ³•å¾—åˆ°é‡Šæ”¾ã€‚ç±»ä¼¼è¿™æ ·çš„åº”ç”¨å¯ä»¥åˆ‡åˆ†æˆ2ä¸ªè¿›ç¨‹ï¼šä¸€ä¸ªç”¨æ¥æ“ä½œUIï¼Œå¦å¤–ä¸€ä¸ªç»™åå°çš„Serviceã€‚</p><h3 id="ä»€ä¹ˆæƒ…å†µå¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µå¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µå¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µå¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿ</h3><p>éé™æ€å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å®ä¾‹å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p>Activity å®ä¾‹è¢«é™æ€å®ä¾‹æŒæœ‰ï¼Œå¯¼è‡´ Activity æ— æ³•è¢«é‡Šæ”¾ã€‚</p><p>Cursor æœªå…³é—­ã€‚</p><p>è‡ªå®šä¹‰çš„ç›‘å¬å™¨æœªæ¸…ç©ºã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹-LruCache"><a href="#ä»‹ç»ä¸€ä¸‹-LruCache" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ LruCache"></a>ä»‹ç»ä¸€ä¸‹ LruCache</h3><h3 id="Android-çº¿ç¨‹æœ‰æ²¡æœ‰ä¸Šé™ï¼Ÿ"><a href="#Android-çº¿ç¨‹æœ‰æ²¡æœ‰ä¸Šé™ï¼Ÿ" class="headerlink" title="Android çº¿ç¨‹æœ‰æ²¡æœ‰ä¸Šé™ï¼Ÿ"></a>Android çº¿ç¨‹æœ‰æ²¡æœ‰ä¸Šé™ï¼Ÿ</h3><p>å½“ç„¶æœ‰ä¸Šé™ã€‚ä½†è¿™ä¸ªå€¼å¹¶ä¸å›ºå®šçš„ï¼Œåˆ†é…ç»™åº”ç”¨ç¨‹åºçš„å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå½“åˆ›å»ºçº¿ç¨‹æ¶ˆè€—çš„èµ„æºå¤§äºåˆ†é…çš„å†…å­˜æ—¶ï¼Œå°±ä¼šå¯¼è‡´ Out of Memoryã€‚</p><h3 id="ListView-é‡ç”¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ListView-é‡ç”¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ListView é‡ç”¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ListView é‡ç”¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ConvertView æ˜¯ä» AbsListView çš„ RecyclerBin ä¸­æ‹¿å‡ºæ¥çš„ ScrapViewã€‚è¯¥ View åœ¨é¦–æ¬¡ layout è¿‡ç¨‹æ—¶ä¼šé€šè¿‡ LayoutInflator åˆ›å»ºï¼Œåœ¨ä¹‹åå±•ç¤ºåœ¨å±å¹•ä¸Šæ—¶ä¼šä¼ å…¥<code>Adapter.getView()</code>ä¸­ï¼Œå¯ä»¥å¯¹å®ƒè¿›è¡Œå¤ç”¨ï¼Œé¿å…å†æ¬¡æ¸²æŸ“ã€‚</p><h3 id="å±å¹•é€‚é…çš„å¤„ç†æŠ€å·§éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#å±å¹•é€‚é…çš„å¤„ç†æŠ€å·§éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="å±å¹•é€‚é…çš„å¤„ç†æŠ€å·§éƒ½æœ‰å“ªäº›ï¼Ÿ"></a>å±å¹•é€‚é…çš„å¤„ç†æŠ€å·§éƒ½æœ‰å“ªäº›ï¼Ÿ</h3><ol><li>åŸºäºè‡ªé€‚åº”å°ºå¯¸çš„ wrap_contentã€match_parentï¼Œweight é¿å…å›ºå®šçš„å°ºå¯¸å•ä½ã€‚</li><li>ä½¿ç”¨åŸºäºæ§ä»¶ç›¸å¯¹ä½ç½®çš„ RelativeLayoutï¼Œç°åœ¨æ›´åŠ æ¨èä½¿ç”¨çº¦æŸå¸ƒå±€ ConstraintLayoutï¼Œå¯¹äºå¸ƒå±€æ€§èƒ½ä»¥åŠæ‰å¹³åŒ–æ›´å…·æœ‰ä¼˜åŠ¿ã€‚</li><li>è€ƒè™‘ä½¿ç”¨è‡ªåŠ¨æ‹‰ä¼¸çš„ .9 å›¾æˆ–è€…ä½¿ç”¨çŸ¢é‡å›¾ï¼ŒçŸ¢é‡å›¾å¯ä»¥ä¿è¯å›¾ç‰‡ä¸å—æ‹‰ä¼¸å½±å“è€Œå¯¼è‡´å¤±çœŸã€‚</li><li>å¸ƒå±€ä½¿ç”¨é™å®šç¬¦ã€‚</li></ol><h3 id="å¦‚ä½•å®ç°-ViewPager-Fragment-çš„æ‡’åŠ è½½ï¼Ÿ"><a href="#å¦‚ä½•å®ç°-ViewPager-Fragment-çš„æ‡’åŠ è½½ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç° ViewPager + Fragment çš„æ‡’åŠ è½½ï¼Ÿ"></a>å¦‚ä½•å®ç° ViewPager + Fragment çš„æ‡’åŠ è½½ï¼Ÿ</h3><p>æ‡’åŠ è½½ä¸»è¦æ˜¯å¤„ç† Fragment ç¬¬ä¸€æ¬¡å¯¹ç”¨æˆ·å¯è§ã€æ¯æ¬¡å¯¹ç”¨æˆ·å¯è§ã€æ¯æ¬¡å¯¹ç”¨æˆ·ä¸å¯è§ã€‚åœ¨è¿™äº›æ—¶é—´ç‚¹äº¤ç»™å®ç°ç±»æ¥åšåƒç½‘ç»œè¯·æ±‚ã€ä¸­æ–­ã€æ•°æ®å¤„ç†ç­‰ã€‚</p><p>Fragment çš„ç”Ÿå‘½å‘¨æœŸæ˜¯è¿™æ ·çš„ï¼š<code>onAttach()</code>â†’<code>onCreate()</code>â†’<code>onCreatedView()</code>â†’<code>onActivityCreated()</code>â†’<code>onStart()</code>â†’<code>onResume()</code>â†’<code>onPause()</code>â†’<code>onStop()</code>â†’<code>onDestroyView()</code>â†’<code>onDestroy()</code>â†’<code>onDetach()</code>ã€‚</p><p>åœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯è¿™å‡ ä¸ªæ–¹æ³•ï¼š<code>onCreatedView()</code> + <code>onActivityCreated()</code> + <code>onResume</code> + <code>onPause</code> + <code>onDestroyView</code>ã€‚è¿˜æœ‰ä¸¤ä¸ªéç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š<code>setUserVisibleHint()</code> å’Œ <code>onHiddenChanged()</code>ã€‚</p><p>åœ¨ ViewPager + Fragment çš„é…åˆæ—¶ï¼Œæˆ‘ä»¬åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ FragmentPagerAdapter æˆ–è€… FragmentPagerStateAdapterï¼Œå‰è€…åœ¨ Fragment ä¸è§çš„æ—¶å€™ä¸ä¼šèµ°<code>onDetach()</code>æ–¹æ³•ï¼Œè€Œåè€…ä¼šã€‚</p><p>å¯¹äº Fragment çš„å¯è§çŠ¶å†µï¼Œæˆ‘ä»¬éœ€è¦<strong>ä¸¤ä¸ªæ ‡å¿—ä½</strong>ï¼š**Fragment åˆ›å»ºå®Œæˆçš„æ ‡å¿—ä½<code>isViewCreated</code><strong>å’Œ</strong>ç¬¬ä¸€æ¬¡å¯è§çš„æ ‡å¿—ä½<code>isFirstVisible</code><strong>ã€‚å¯¹äºå®ƒä¸å¯è§çš„çŠ¶æ€ï¼Œå’Œå†æ¬¡å›åˆ°å¯è§çŠ¶æ€çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†åŠ ä¸€ä¸ªæ ‡å¿—ä½ï¼š</strong><code>currentVisibleState</code>**ã€‚</p><h3 id="Recycleview-å’Œ-ListView-çš„åŒºåˆ«"><a href="#Recycleview-å’Œ-ListView-çš„åŒºåˆ«" class="headerlink" title="Recycleview å’Œ ListView çš„åŒºåˆ«"></a>Recycleview å’Œ ListView çš„åŒºåˆ«</h3><p>ç¼“å­˜æœºåˆ¶ä¸åŒã€‚ListView ä¸­æ˜¯ RecyclerBin ç±»ï¼Œæœ‰ ActiveViews å’Œ ScrapViews ä¸¤ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜æ”¾æ­£æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ View å’Œæš‚æ—¶çœ‹ä¸è§çš„ Viewã€‚<strong>å®ƒç¼“å­˜çš„æ˜¯ View</strong>ã€‚è€Œ RecyclerView ä¸­æ˜¯ Recycler ç±»ï¼Œæ¯” ListView è¦å¤šä¸¤çº§ç¼“å­˜ï¼Œæœ‰ AttachedScrapViewã€CacheViewsã€æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„ ViewCacheExtension å’Œ RecyclerPoolã€‚<strong>å®ƒç¼“å­˜çš„æ˜¯ ViewHolderã€‚</strong></p><p>RecyclerView æ”¯æŒå±€éƒ¨åˆ·æ–°ï¼ŒListView ä¸æ”¯æŒã€‚</p><h3 id="è‡ªå®šä¹‰-View-çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è‡ªå®šä¹‰-View-çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è‡ªå®šä¹‰ View çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>è‡ªå®šä¹‰ View çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>è‡ªå®šä¹‰ View åˆ†ä¸ºä¸¤å¤§å—ï¼š<strong>è‡ªå®šä¹‰æ§ä»¶</strong>å’Œ<strong>è‡ªå®šä¹‰å®¹å™¨</strong>ã€‚</p><p>è‡ªå®šä¹‰Viewå¿…é¡»é‡å†™ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š</p><ul><li>åªæœ‰ Context å‚æ•°çš„ ï¼Œç”¨äºåœ¨javaä»£ç ä¸­newå¯¹è±¡ä½¿ç”¨Â </li><li>Context + AttributSetã€‚ ä¸»è¦ç”¨äºè§£æåœ¨ xml ä¸­çš„è‡ªå®šä¹‰å±æ€§</li></ul><p>é‡å†™ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>onMesure</code>ï¼šè®¡ç®—å‡ºæ§ä»¶çš„å¤§å°</li><li><code>onLayout</code>ï¼šè®¡ç®—å‡ºæ§ä»¶çš„ä½ç½®Â </li><li><code>onDraw</code>ï¼šè¿›è¡Œç»˜åˆ¶ Â </li></ul><p>å¸ƒå±€è¿‡ç¨‹ï¼š</p><ol><li>measureè¿‡ç¨‹ï¼šè°ƒç”¨äº†<code>measureChildren</code>æ–¹æ³•ï¼Œæ‰§è¡Œäº†æ‰€æœ‰å­æ§ä»¶çš„<code>measure</code>æ–¹æ³•æµ‹ç»˜å‡ºæ‰€æœ‰çš„å­æ§ä»¶çš„å¤§å°ã€‚<br>è°ƒç”¨<code>setMeasureDimension</code>æ–¹æ³•è®¾ç½®æµ‹ç»˜åçš„å¤§å°ã€‚</li><li>layoutè¿‡ç¨‹ï¼šè°ƒç”¨<code>requestLayout</code>æ–¹æ³•ï¼Œ<code>layout</code>æ–¹æ³•ã€‚åœ¨è°ƒç”¨<code>getChildCount</code>æ–¹æ³•åè·å–åˆ°å­æ¡ç›®æ•°é‡ï¼Œç”¨å¾ªç¯éå†å‡ºæ¯ä¸€ä¸ªå­æ¡ç›®çš„å¯¹è±¡ã€‚ é€šè¿‡å­æ§ä»¶çš„<code>layout</code>æ–¹æ³• ç»™å­æ§ä»¶è®¾ç½®æ‘†æ”¾ä½ç½®ã€‚</li><li>drawè¿‡ç¨‹ï¼šé¦–å…ˆè°ƒç”¨ViewGroupçš„<code>dispatchDraw()</code>æ–¹æ³•ç»˜åˆ¶ViewGroupã€‚ç„¶åè°ƒç”¨Viewä¸­çš„<code>draw</code>æ–¹è¿›è¡Œç»˜åˆ¶ã€‚Â </li></ol><h3 id="View-çš„äº‹ä»¶ä¼ é€’æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#View-çš„äº‹ä»¶ä¼ é€’æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="View çš„äº‹ä»¶ä¼ é€’æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ"></a>View çš„äº‹ä»¶ä¼ é€’æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ</h3><p>ç”±ç”µä¿¡å·è½¬æ¢ä¸ºè¾“å…¥äº‹ä»¶ï¼Œç„¶åäº¤ç»™äº† InputManagerServiceï¼Œå†äº¤ç»™ WindowInputEventReceiverï¼Œæœ€åç»è¿‡ä¼ é€’äº¤ç»™äº† ViewRootImpl çš„<code>processPointEvent</code>æ–¹æ³•ï¼Œå…¶ä¸­åˆè°ƒç”¨äº† DecorView çš„<code>dispatchPointerEvent</code>æ–¹æ³•ï¼Œåˆè°ƒç”¨äº†<code>dispatchTouchEvent</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ View ä¸­ã€‚åŒæ—¶ï¼ŒDecorView ä¹Ÿé‡å†™äº†<code>dispatchTouchEvent</code>æ–¹æ³•ï¼Œå®ƒå°†äº‹ä»¶äº¤ç»™äº† Activityï¼Œ<em>ï¼ˆä½ é—®æˆ‘å¦‚ä½•äº¤çš„ï¼Ÿåœ¨ Activity çš„ <code>onAttach()</code>æ–¹æ³•ä¸­ï¼Œå°±è®¾ç½®äº†ä¸€ä¸ª Callback ç»™ DecorViewã€‚ï¼‰</em> Activity é‡å†™äº†<code>dispatchTouchEvent</code>æ–¹æ³•ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº† PhoneWindow çš„<code>superDispatchTouchEvent</code>æ–¹æ³•ï¼ŒPhoneWindow æ¥ç€è°ƒç”¨äº† DecorView çš„<code>superDispatchTouchEvent</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œåˆè°ƒç”¨äº†<code>super.dispatchTouchEvent()</code>ï¼Œè€Œ DecorView çš„ super å…¶å®å°±æ˜¯ ViewGroupï¼Œä¹Ÿå°±æ˜¯å…œå…œè½¬è½¬äº¤ç»™äº† DecorViewï¼Œå†æŒ‰ç…§åˆ†å‘æœºåˆ¶ä» ViewGroup ä¸‹å‘åˆ°æ‰€æœ‰çš„å­ Viewã€‚</p><p><code>ViewGroup.dispatchTouchEvent()</code>ä¼šå…ˆåˆ¤æ–­æ˜¯å¦è¦æ‹¦æˆªäº‹ä»¶ï¼Œé€šè¿‡<code>onInterceptTouchEvent</code>æ–¹æ³•ï¼Œå¦‚æœä¸æ‹¦æˆªï¼Œå°±å¼€å§‹ç»™åˆé€‚çš„å­ View è¿›è¡Œäº‹ä»¶çš„æ´¾å‘ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨å­ View çš„<code>dispatchTouchEvent</code>ã€‚å¦‚æœæœ‰ä»»æ„ä¸€ä¸ªå­ View æ¶ˆè€—æ­¤æ¬¡äº‹ä»¶ï¼Œä¹Ÿå³<code>dispatchTouchEvent</code>è¿”å›äº†<code>true</code>ï¼Œé‚£ä¹ˆæ´¾å‘å°±ä¸­æ­¢ï¼Œè¡¨ç¤ºäº‹ä»¶å·²ç»è¢«æ¶ˆè€—ï¼›å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå­ View æ¶ˆè€—æ­¤æ¬¡äº‹ä»¶ï¼Œä¹Ÿå³æ‰€æœ‰çš„å­ View çš„<code>dispatchTouchEvent</code>éƒ½è¿”å›äº†<code>false</code>ï¼Œé‚£ä¹ˆ ViewGroup å°±è‡ªå·±æ¶ˆè€—æ­¤æ¬¡äº‹ä»¶ã€‚å¦‚æœ ViewGroup ä¹Ÿæ²¡æœ‰æ¶ˆè€—ï¼Œé‚£å°±ä¼šå†å‘ä¸Šè¿”å›ï¼Œç›´åˆ° Activity çš„<code>onTouchEvent</code>æ–¹æ³•ã€‚</p><p><code>View.onTouchEvent()</code>æ–¹æ³•æ˜¯åœ¨<code>View.dispatchTouchEvent()</code>ä¸­è¢«è°ƒç”¨çš„ï¼Œè¿”å›<code>true</code>è¡¨ç¤ºæ¶ˆè€—æ­¤æ¬¡äº‹ä»¶ï¼Œè¿”å›<code>false</code>è¡¨ç¤ºä¸æ¶ˆè€—ã€‚å¦‚æœä¸æ¶ˆè€—ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­ï¼Œå°±ä¸å†æ¥æ”¶åˆ°äº‹ä»¶äº†ã€‚</p><p><code>ViewGroup.onInterceptTouchEvent()</code>æ–¹æ³•æ˜¯åœ¨<code>ViewGroup.dispatchTouchEvent()</code>ä¸­è¢«è°ƒç”¨çš„ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦è¦æ‹¦æˆªæŸä¸ªäº‹ä»¶ã€‚å¦‚æœå½“å‰ ViewGroup æ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—å½“ä¸­ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªå½“å‰äº‹ä»¶ã€‚è¿™ä¸ªæ–¹æ³•åªæœ‰ ViewGroup ä¸­æœ‰ï¼ŒView ä¸­æ²¡æœ‰ã€‚å®ƒèµ·åˆ°çš„ä½œç”¨æ˜¯<strong>åˆ†æµ</strong>ï¼Œè¿”å›<code>false</code>æˆ–è€…è¿”å›<code>super.xxx</code>æ˜¯å‘ä¸‹çº§ View æˆ–è€… ViewGroup ä¼ é€’ï¼Œè¿”å›<code>true</code>æ˜¯æŠŠäº‹ä»¶äº¤ç»™è‡ªå·±çš„<code>onTouchEvent</code>å¤„ç†ã€‚</p><p><strong>ViewGroupé»˜è®¤ä¸æ‹¦æˆªä»»ä½•äº‹ä»¶ã€‚</strong></p><h3 id="onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§"><a href="#onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§" class="headerlink" title="onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§"></a>onTouchListenerã€onTouchEventã€onClickListenerçš„ä¼˜å…ˆçº§</h3><p><code>onTouchListener</code> &gt;&gt; <code>onTouchEvent</code> &gt;&gt; <code>onClickListener</code> &gt;&gt; <code>onClick</code></p><h3 id="Handlerã€Looperã€MessageQueueã€Message-çš„å…³ç³»"><a href="#Handlerã€Looperã€MessageQueueã€Message-çš„å…³ç³»" class="headerlink" title="Handlerã€Looperã€MessageQueueã€Message çš„å…³ç³»"></a>Handlerã€Looperã€MessageQueueã€Message çš„å…³ç³»</h3><p><strong>Message</strong>ï¼šè´Ÿè´£æ‰¿è½½è¦ä¼ é€’çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ¶ˆæ¯çš„ codeï¼Œè¦ä¼ é€’çš„å‚æ•°ç­‰ç­‰ã€‚Message ä¸­æœ‰ä¸ªã€<strong>æ± </strong>ã€çš„æ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé™æ€å˜é‡<code>sPool</code>ï¼Œå®ƒæœ¬èº«åŒ…å«ä¸‹ä¸€æ¡æ¶ˆæ¯çš„å¼•ç”¨ï¼ŒMessage æ¯æ¬¡ä½¿ç”¨<code>obtain()</code>æ–¹æ³•æ‹¿å–çš„æ—¶å€™ï¼Œæ˜¯æ‹¿å–çš„é˜Ÿåˆ—çš„å¤´ï¼Œç„¶åå°†<code>sPool</code>ç½®ä¸ºé˜Ÿåˆ—çš„ç¬¬äºŒä¸ªå€¼ã€‚è¿™ä¸ªæ•°æ®ç»“æ„æ˜¯ä¸ªé“¾è¡¨ã€‚</p><p><strong>MessageQueue</strong>ï¼šè´Ÿè´£ç»´æŠ¤ Message çš„ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›<code>enqueueMessage()</code>å’Œ<code>next()</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨æ¥åšã€è¿›ã€ã€å‡ºã€çš„æ“ä½œã€‚Message å¦‚æœä¸ç”¨äº†ï¼Œé‚£ä¹ˆå°±æŠŠå®ƒå›æ”¶ï¼Œä¹Ÿå°±æ˜¯æ¸…ç©ºå®ƒçš„å†…éƒ¨æ•°æ®ï¼Œä½†æ˜¯ä¸é”€æ¯è¿™ä¸ªå®ä¾‹ï¼Œè¿™æ ·ä¸‹æ¬¡æœ‰æ–°æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±ç›´æ¥èµ‹å€¼ï¼Œè€Œä¸ç”¨å»ºç«‹æ–°çš„ Message å®ä¾‹ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚åœ¨ã€å‡ºã€æ“ä½œçš„æ—¶å€™ï¼Œè¿˜ä¼šå»åˆ¤æ–­ Message çš„å‘é€æ—¶é—´æ˜¯ä¸æ˜¯åˆ°äº†ï¼Œå¦‚æœè¿˜æ²¡åˆ°ï¼Œå°±ç­‰å¾…ç›¸åº”çš„æ—¶é—´ï¼Œç­‰åˆ°æ—¶é—´åˆ°äº†ï¼Œå–å‡ºå¹¶è¿”å›ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç”¨ä¸€ä¸ªæ­»å¾ªç¯æ¥å®ç°çš„ã€‚åŒæ—¶ä¼šæœ‰<code>nativePollOnce()</code>æ–¹æ³•æ¥å®ç°é˜»å¡ï¼Œè€Œä¸æ˜¯è®©æ­»å¾ªç¯ä¸€ç›´è¿è¡Œã€‚</p><p><strong>Looper</strong>ï¼šä¸€ä¸ªæ­»å¾ªç¯ï¼Œä½¿ç”¨ ThreadLocal æœºåˆ¶å»è·å–å½“å‰è°ƒç”¨å®ƒçš„çº¿ç¨‹ä¸‹çš„ Looper å®ä¾‹ã€‚prepare çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ª MessageQueueã€‚loop è¿‡ç¨‹ä¸­ï¼Œä¼šå°è¯•è°ƒç”¨<code>MessageQueue.next()</code>æ–¹æ³•ï¼Œæ¥è·å– Messageï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ç»™å–å‡ºçš„ Message ä¸­çš„ handler å‘é€æ¶ˆæ¯ï¼Œè®©è¯¥ handler æ¥å¤„ç†è¿™ä¸ª Messageã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œåœ¨<code>next()</code>æ–¹æ³•ä¸­ä¼šä¸€ç›´è¢«é˜»å¡ã€‚</p><p><strong>Handler</strong>ï¼šè´Ÿè´£å¤„ç† Messageã€‚åœ¨åˆå§‹åŒ–æ—¶å¯ä»¥ä¼ å…¥ Looperï¼Œé‚£å®ƒå°±ä¼šåœ¨å¯¹åº”çš„çº¿ç¨‹ä¸‹å¤„ç† Messageã€‚åœ¨è°ƒç”¨<code>Handler.post()</code>æ–¹æ³•çš„æ—¶å€™ï¼Œ<strong>æ–°å»ºçš„ Message ä¼šè¢« Handler äº¤ç»™ Looper ä¸­çš„ MessageQueue</strong>ï¼Œå¹¶ä½¿ç”¨å®ƒçš„<code>enqueueMessage()</code>æ·»åŠ åˆ°<code>Message.next</code>ä¸­ã€‚</p><h3 id="ä¸»çº¿ç¨‹çš„-Looper-æ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´-ANRï¼Ÿ"><a href="#ä¸»çº¿ç¨‹çš„-Looper-æ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´-ANRï¼Ÿ" class="headerlink" title="ä¸»çº¿ç¨‹çš„ Looper æ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´ ANRï¼Ÿ"></a>ä¸»çº¿ç¨‹çš„ Looper æ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´ ANRï¼Ÿ</h3><p>è¿™ä¸ªé—®é¢˜å…¶å®ç®—æ˜¯å·æ¢æ¦‚å¿µã€‚</p><p>é¦–å…ˆï¼Œæ­»å¾ªç¯ä¸æ˜¯é€ æˆ ANR çš„å¿…ç„¶åŸå› ï¼ŒANR æ˜¯å› ä¸º<strong>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ²¡æœ‰å¾—åˆ°åŠæ—¶å¤„ç†æ‰é€ æˆçš„</strong>ï¼Œæ¯”å¦‚ BroadcastReceiver çš„<code>onReceive()</code>æ–¹æ³•ä¸­å¤„ç†äº‹åŠ¡è¶…è¿‡äº†10ç§’ï¼Œæ¯”å¦‚<code>onTouch()</code>äº‹ä»¶è¶…è¿‡äº†5ç§’ï¼Œæ‰ä¼šå¯¼è‡´ ANRã€‚</p><p>ç¬¬äºŒï¼Œä¸»çº¿ç¨‹çš„ Looper æ­»å¾ªç¯ï¼Œæœ€å¤šä¹Ÿå°±ä¼šå¯¼è‡´ä¸ª OOMï¼Œä½†æ˜¯<strong>ä¸»çº¿ç¨‹åœ¨æ²¡æœ‰æ¶ˆæ¯æ—¶ä¹Ÿä¼šä¼‘çœ ã€è¿›å…¥é˜»å¡çŠ¶æ€</strong>ï¼Œå½“æœ‰æ–°æ¶ˆæ¯æ¥ä¸´æ—¶ï¼Œå†è¢«å”¤é†’ï¼Œåˆ†å‘æ¶ˆæ¯ï¼Œå®é™…ä¸Š<strong>å¯¹äºå†…å­˜çš„æ¶ˆè€—éå¸¸å°</strong>ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¦‚æœä¸»çº¿ç¨‹çš„ Looper ä¸å¾ªç¯äº†ï¼Œé‚£<code>main()</code>æ–¹æ³•å°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ç»“æŸäº†ï¼Œå°±æ•´ä¸ªåº”ç”¨å°±é€€å‡ºäº†ã€‚</p><h3 id="Looper-å¤šæ¬¡-prepare-ä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ"><a href="#Looper-å¤šæ¬¡-prepare-ä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ" class="headerlink" title="Looper å¤šæ¬¡ prepare ä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ"></a>Looper å¤šæ¬¡ prepare ä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ</h3><p>ä¼šã€‚ä¼šæŠ›å‡º RuntimeExceptionï¼šOnly one Looper may be created per threadã€‚</p><h3 id="App-ç‚¹å‡»åˆ°-Activity-å‡ºç°çš„æµç¨‹ï¼Ÿ"><a href="#App-ç‚¹å‡»åˆ°-Activity-å‡ºç°çš„æµç¨‹ï¼Ÿ" class="headerlink" title="App ç‚¹å‡»åˆ° Activity å‡ºç°çš„æµç¨‹ï¼Ÿ"></a>App ç‚¹å‡»åˆ° Activity å‡ºç°çš„æµç¨‹ï¼Ÿ</h3><ol><li>æºè¿›ç¨‹è°ƒç”¨<code>startActivity()</code>ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>Instrumentation.execStartActivity()</code>æ–¹æ³•ï¼›</li><li>é€šè¿‡ Binder è°ƒç”¨ ActivityTaskManagerService çš„<code>startActivity()</code>æ–¹æ³•ï¼›</li><li>ATMS ä¼šä½¿ç”¨ ActivityStack ç±»å’Œ ActivityStackSupervisor ç±»æ¥å¤„ç† Task ä¸ Activity çš„å…¥æ ˆæ“ä½œï¼›</li><li>æ¥ç€åœ¨<code>ActivityStackSupervisor.realStartActivityLocked()</code>æ–¹æ³•ä¸­ï¼Œä½¿ç”¨æäº¤äº‹åŠ¡çš„æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªå¯åŠ¨ Activity çš„äº‹åŠ¡ï¼Œå¹¶æäº¤ç»™ ClientLifecycleManagerï¼›</li><li>ClientLifecycleManager ä¼šé€šè¿‡ Binder è°ƒç”¨ ActivityThread çš„<code>scheduleTransaction()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå‘ ActivityThread ä¸­çš„ Handler å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼›</li><li>Handler æ¥æ”¶æ¶ˆæ¯åï¼Œåˆ©ç”¨ TransactionExecutor æŒ‰é¡ºåºæ‰§è¡Œäº‹åŠ¡ï¼›</li><li>åœ¨è¿™ä¸ªã€å¯åŠ¨ Activityã€çš„äº‹åŠ¡å›è°ƒä¸­ï¼Œåˆè°ƒç”¨äº† ActivityThread çš„<code>handleLaunchActivity()</code>æ–¹æ³•ï¼Œè¿›è€Œåˆè°ƒç”¨äº†<code>performLaunchActivity()</code>æ–¹æ³•ï¼›</li><li>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œåˆ©ç”¨åå°„åˆ›å»ºäº† Activity çš„å®ä¾‹ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œè¿˜åˆ©ç”¨åå°„åˆ›å»ºäº† Application çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨<code>Activity.attach()</code>æ–¹æ³•ï¼Œåˆ›å»º PhoneWindowã€ç»‘å®š Contextï¼›</li><li>æœ€åè°ƒç”¨äº†<code>Instrumentation.callActivityOnCreate()</code>æ–¹æ³•ï¼Œæ‰§è¡Œäº† Activity çš„<code>onCreate()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼›</li><li>æ¥ç€ TransactionExecutor åˆå¼€å§‹æ‰§è¡Œç”Ÿå‘½å‘¨æœŸäº‹åŠ¡ï¼Œæœ€åä¾æ¬¡è°ƒç”¨åˆ°<code>onStart()</code>ã€<code>onResume()</code>ã€‚</li></ol><p><a href="https://www.jianshu.com/p/a72c5ccbd150">ä¸€ä¸ªAPPä»å¯åŠ¨åˆ°ä¸»é¡µé¢æ˜¾ç¤ºç»å†äº†å“ªäº›è¿‡ç¨‹ï¼Ÿ</a></p><h3 id="ä»‹ç»ä¸€ä¸‹-Binder"><a href="#ä»‹ç»ä¸€ä¸‹-Binder" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ Binder"></a>ä»‹ç»ä¸€ä¸‹ Binder</h3><h3 id="ä»‹ç»ä¸€ä¸‹ä¼˜åŒ–ç›¸å…³çš„"><a href="#ä»‹ç»ä¸€ä¸‹ä¼˜åŒ–ç›¸å…³çš„" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ä¼˜åŒ–ç›¸å…³çš„"></a>ä»‹ç»ä¸€ä¸‹ä¼˜åŒ–ç›¸å…³çš„</h3><p>å¯åŠ¨ä¼˜åŒ–ã€å†…å­˜ä¼˜åŒ–ã€åŸ‹ç‚¹ä¼˜åŒ–ç­‰ç­‰ã€‚</p><h3 id="Serializable-å’Œ-Parcelable-æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#Serializable-å’Œ-Parcelable-æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="Serializable å’Œ Parcelable æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>Serializable å’Œ Parcelable æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3><p>Serializable å’Œ Parcelable éƒ½æ˜¯ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œæ–¹ä¾¿å°†å¯¹è±¡åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“æˆ–æœ¬åœ°ä¿å­˜ã€‚</p><p>Serializable æ˜¯ Java æä¾›çš„ç±»ï¼Œåœ¨ä½¿ç”¨æ—¶åªéœ€è¦ implement Serializableï¼Œç„¶åå£°æ˜ä¸€ä¸ª serialVersionUID å°±å¯ä»¥äº†ã€‚</p><p>Parcelable æ˜¯ Android æä¾›çš„ç±»ï¼Œåœ¨ä½¿ç”¨æ—¶ç›¸å¯¹å¤æ‚ã€‚</p><ul><li>ç±»æœ¬èº«è¦å®ç° Parcelable æ¥å£</li><li>æœ‰ä¸€ä¸ªéç©ºçš„é™æ€æˆå‘˜å˜é‡å«<code>CREATOR</code>ï¼Œå¹¶ä¸”å®ƒè¦å®ç°<code>Parcelable.Creator</code>æ¥å£<ul><li>è¦†å†™<code>createFromParcel(Parcel in)</code>æ–¹æ³•</li><li>è¦†å†™<code>newArray(int size)</code>æ–¹æ³•</li></ul></li><li>è¦†å†™<code>describeContents()</code>æ–¹æ³•</li><li>è¦†å†™<code>writeToParcel(Parcel dest, int flags)</code>æ–¹æ³•</li></ul><p>ä¸¤ç§ç±»çš„å¯¹æ¯”å¦‚ä¸‹ï¼š</p><ol><li>Serializable ä»£ç é‡å°‘ï¼ŒParcelable ä»£ç é‡å¤šã€‚</li><li>åœ¨å†…å­˜é—´ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼ŒParcelable æ¯” Serializable æ€§èƒ½é«˜ã€å†…å­˜å¼€é”€æ–¹é¢è¾ƒå°ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ Parcelableï¼›è€Œåœ¨éœ€è¦ä¿å­˜æ•°æ®åˆ°æœ¬åœ°æˆ–è€…è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œä½¿ç”¨ Serializableã€‚</li><li>Serializable åœ¨åºåˆ—åŒ–æ—¶ä½¿ç”¨çš„æ˜¯<strong>åå°„</strong>çš„æŠ€æœ¯ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶å˜é‡ï¼Œä»è€Œå¼•èµ·é¢‘ç¹çš„ GCã€‚è€Œ Parcelable æ–¹å¼çš„å®ç°åŸç†æ˜¯å°†ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡è¿›è¡Œ<strong>å­—èŠ‚åŒ–</strong>ï¼Œè€Œ<strong>å­—èŠ‚åŒ–</strong>ä¹‹åçš„æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ Intent æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·ä¹Ÿå°±å®ç°ä¼ é€’å¯¹è±¡çš„åŠŸèƒ½äº†ã€‚</li></ol><h3 id="Jetpack-ä»‹ç»ä¸€ä¸‹"><a href="#Jetpack-ä»‹ç»ä¸€ä¸‹" class="headerlink" title="Jetpack ä»‹ç»ä¸€ä¸‹"></a>Jetpack ä»‹ç»ä¸€ä¸‹</h3><p>Jetpack æ˜¯ä¸€å¥—åº“ï¼Œå®ƒé‡Œé¢æœ‰éå¸¸å¤šçš„ç”± Google æä¾›çš„æ ‡å‡†åº“ï¼Œæ¯”å¦‚ Data Bindingã€Lifecycleã€LiveDataã€Navigationã€Roomã€ViewModelã€WorkManager ç­‰ã€‚æ„å›¾å°†å¼€å‘ä¸­ç”¨åˆ°çš„æ–¹æ–¹é¢é¢çš„ç¬¬ä¸‰æ–¹åº“éƒ½è¿›è¡Œã€æ¶ˆç­ã€ã€‚</p><h3 id="æ’æŸ¥å†…å­˜æ³„æ¼"><a href="#æ’æŸ¥å†…å­˜æ³„æ¼" class="headerlink" title="æ’æŸ¥å†…å­˜æ³„æ¼"></a>æ’æŸ¥å†…å­˜æ³„æ¼</h3><h3 id="å¸¸è§çš„ç®—æ³•"><a href="#å¸¸è§çš„ç®—æ³•" class="headerlink" title="å¸¸è§çš„ç®—æ³•"></a>å¸¸è§çš„ç®—æ³•</h3><h3 id="100-MBçš„å¤§å›¾å¦‚ä½•æ˜¾ç¤º-ï¼Ÿ"><a href="#100-MBçš„å¤§å›¾å¦‚ä½•æ˜¾ç¤º-ï¼Ÿ" class="headerlink" title="100 MBçš„å¤§å›¾å¦‚ä½•æ˜¾ç¤º ï¼Ÿ"></a>100 MBçš„å¤§å›¾å¦‚ä½•æ˜¾ç¤º ï¼Ÿ</h3><p>åˆ©ç”¨ BitmapRegionDecoder â€”â€” åŒºåŸŸè§£ç å™¨ï¼Œæœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸€å—çŸ©å½¢çš„åŒºåŸŸï¼Œç„¶åæ ¹æ®æ‰‹åŠ¿æ¥ç§»åŠ¨çŸ©å½¢åŒºåŸŸçš„ä½ç½®å°±èƒ½æ…¢æ…¢çœ‹åˆ°æ•´å¼ å›¾ç‰‡äº†ã€‚</p><h2 id="Flutter-éƒ¨åˆ†"><a href="#Flutter-éƒ¨åˆ†" class="headerlink" title="Flutter éƒ¨åˆ†"></a>Flutter éƒ¨åˆ†</h2>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> èŒåœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Glide çš„ä¸€åˆ‡</title>
      <link href="/2020-03-28/glide/"/>
      <url>/2020-03-28/glide/</url>
      
        <content type="html"><![CDATA[<p>Glide æ˜¯æ¯”è¾ƒè‘—åçš„å›¾ç‰‡åŠ è½½åº“ä¹‹ä¸€ï¼Œç±»ä¼¼çš„åº“è¿˜æœ‰ Picassoã€‚è¿™ç¯‡æ–‡ç« æ¥è®²è®² Glide æ˜¯å¦‚ä½•åŠ è½½å›¾ç‰‡åˆ°æ˜¾ç¤ºçš„ï¼Œå¹¶ä¸”è®²ä¸€è®²å®ƒæœ‰å“ªäº›è®¾è®¡ç²¾å¦™çš„åœ°æ–¹ã€‚</p><p>è¯¥æ–‡ç« ä½¿ç”¨çš„æ˜¯ Glide ç›®å‰çš„æœ€æ–°ç‰ˆæœ¬<a href="https://search.maven.org/artifact/com.github.bumptech.glide/glide/4.11.0/jar">4.11.0</a>ã€‚</p><span id="more"></span><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ Glide åœ¨4.0+ç‰ˆæœ¬çš„åŸºæœ¬ç”¨æ³•ã€‚</p><pre><code class="java">// å•ä¸€ imageviewImageView imageView = (ImageView) findViewById(R.id.my_image_view);Glide.with(this).load(&quot;http://image.url&quot;).into(imageView);// list ä¸­çš„ imageview@Override public View getView(int position, View recycled, ViewGroup container) &#123;  final ImageView myImageView;  if (recycled == null) &#123;    myImageView = (ImageView) inflater.inflate(R.layout.my_image_view, container, false);  &#125; else &#123;    myImageView = (ImageView) recycled;  &#125;  String url = myUrls.get(position);  Glide    .with(myFragment)    .load(url)    .centerCrop()    .placeholder(R.drawable.loading_spinner)    .into(myImageView);  return myImageView;&#125;</code></pre><p>é€šè¿‡ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒGlide ç”¨äº†éå¸¸ç»å…¸çš„ Builder è®¾è®¡æ¨¡å¼ï¼Œå°†å„ç§å‚æ•°æ”¶é›†ã€å¤„ç†ï¼Œæœ€åè°ƒç”¨<code>into()</code>æ–¹æ³•ï¼Œå°†å›¾ç‰‡äº¤ç»™ ImageViewã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†æã€‚</p><h2 id="with"><a href="#with" class="headerlink" title="with()"></a><code>with()</code></h2><p>é¦–å…ˆçœ‹<code>Glide.with()</code>æ–¹æ³•çš„æºç ï¼Œè¯¥æ–¹æ³•æœ‰5ä¸ªé‡è½½ï¼Œå¤§ä½“ç›¸åŒï¼Œä½†ä¹Ÿæœ‰ä¸åŒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢ä¼šè§£é‡Šï¼š</p><pre><code class="java">@NonNullpublic static RequestManager with(@NonNull Context context) &#123;    return getRetriever(context).get(context);&#125;@NonNullpublic static RequestManager with(@NonNull Activity activity) &#123;    return getRetriever(activity).get(activity);&#125;@NonNullpublic static RequestManager with(@NonNull FragmentActivity activity) &#123;    return getRetriever(activity).get(activity);&#125;@NonNullpublic static RequestManager with(@NonNull Fragment fragment) &#123;    return getRetriever(fragment.getContext()).get(fragment);&#125;@SuppressWarnings(&quot;deprecation&quot;)@Deprecated@NonNullpublic static RequestManager with(@NonNull android.app.Fragment fragment) &#123;    return getRetriever(fragment.getActivity()).get(fragment);&#125;@NonNullpublic static RequestManager with(@NonNull View view) &#123;    return getRetriever(view.getContext()).get(view);&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>with(android.app.Fragment)</code>æ–¹æ³•å·²ç»è¢«å¼ƒç”¨äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>with(androidx.fragment.app.Fragment)</code>ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¸å†è®¨è®ºè¢«å¼ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™5ä¸ªæ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œä»å®ƒä»¬çš„ä¼ å…¥å‚æ•°å¯ä»¥çœ‹å‡ºï¼Œå®ƒä»¬åˆ†åˆ«ç”¨åœ¨ Application çº§åˆ«ã€Activity çº§åˆ«ã€FragmentActivity çº§åˆ«ã€Fragment çº§åˆ«å’Œ View çº§åˆ«ã€‚</p><p>Application çº§åˆ«æ„å‘³ç€å®ƒå¯ä»¥ç”¨åœ¨ Service é‡Œï¼Œç”šè‡³ Notification çš„ Thumbnail é‡Œã€‚è€Œå…¶ä»–çš„å‡ ä¸ªï¼Œåªèƒ½ç”¨åœ¨ä¸»çº¿ç¨‹çš„ Activity çš„ View æ ‘ä¸­ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**<code>with(View)</code>æ–¹æ³•åœ¨ View æ²¡æœ‰è¢«<code>attach</code>ä¹‹å‰æ— æ•ˆ**ã€‚å¹¶ä¸”è¯¥æ–¹æ³•æ•ˆç‡è¾ƒä½ï¼Œä¸æ¨èä½¿ç”¨ã€‚</p><p>æ¥ç€çœ‹çœ‹è¿™äº”ä¸ªé‡è½½æ–¹æ³•éƒ½è°ƒç”¨çš„<code>getRetriever()</code>æ–¹æ³•çš„ä»£ç ï¼š</p><pre><code class="java">@NonNullprivate static RequestManagerRetriever getRetriever(@Nullable Context context) &#123;    // context å¯èƒ½ä¸º nullï¼ˆæ¯”å¦‚ç”¨æˆ·å°±ä¼ äº†ä¸ª nullï¼‰ï¼Œ    // ä½†å®é™…ä¸Šå®ƒåªä¼šå‡ºç°åœ¨ Fragment çš„ç”Ÿå‘½å‘¨æœŸå‡ºç°é”™è¯¯æ—¶    Preconditions.checkNotNull(        context,        &quot;You cannot start a load on a not yet attached View or a Fragment where getActivity() &quot;            + &quot;returns null (which usually occurs when getActivity() is called before the Fragment &quot;            + &quot;is attached or after the Fragment is destroyed).&quot;);    return Glide.get(context).getRequestManagerRetriever();&#125;@NonNullpublic RequestManagerRetriever getRequestManagerRetriever() &#123;    return requestManagerRetriever;&#125;</code></pre><p>å¯è§<code>getRetriever()</code>æ–¹æ³•å®é™…ä¸Šæ˜¯åœ¨è·å–ä¸€ä¸ª <strong>RequestManger çš„ç”Ÿæˆå™¨</strong>ã€‚æˆ‘ä»¬å…ˆæŠŠç”Ÿæˆå™¨æ”¾ä¸€è¾¹ï¼Œå…ˆçœ‹çœ‹ Glide æ˜¯å¦‚ä½•å®ä¾‹åŒ–å’Œåˆå§‹åŒ–çš„ï¼š</p><pre><code class="java">// è·å– Glide çš„å•ä¾‹@NonNullpublic static Glide get(@NonNull Context context) &#123;    if (glide == null) &#123;        // è§£ææ³¨è§£é…ç½®ç”Ÿæˆçš„ç±» com.bumptech.glide.GeneratedAppGlideModuleImpl        GeneratedAppGlideModule annotationGeneratedModule =            getAnnotationGeneratedGlideModules(context.getApplicationContext());        synchronized (Glide.class) &#123;            if (glide == null) &#123;                checkAndInitializeGlide(context, annotationGeneratedModule);            &#125;        &#125;    &#125;    return glide;&#125;// åªæœ‰æ‹¿åˆ°äº† Glide.class è¿™ä¸ªå¼•ç”¨çš„é”æ‰å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•@GuardedBy(&quot;Glide.class&quot;)private static void checkAndInitializeGlide(    @NonNull Context context, @Nullable GeneratedAppGlideModule generatedAppGlideModule) &#123;    if (isInitializing) &#123;        throw new IllegalStateException(            &quot;You cannot call Glide.get() in registerComponents(),&quot;                + &quot; use the provided Glide instance instead&quot;);    &#125;    isInitializing = true;    initializeGlide(context, generatedAppGlideModule);    isInitializing = false;&#125;@GuardedBy(&quot;Glide.class&quot;)private static void initializeGlide(    @NonNull Context context, @Nullable GeneratedAppGlideModule generatedAppGlideModule) &#123;    initializeGlide(context, new GlideBuilder(), generatedAppGlideModule);&#125;@GuardedBy(&quot;Glide.class&quot;)@SuppressWarnings(&quot;deprecation&quot;)private static void initializeGlide(    @NonNull Context context,    @NonNull GlideBuilder builder,    @Nullable GeneratedAppGlideModule annotationGeneratedModule) &#123;    // è§£æ GlideModule é…ç½®    Context applicationContext = context.getApplicationContext();    List&lt;com.bumptech.glide.module.GlideModule&gt; manifestModules = Collections.emptyList();    if (annotationGeneratedModule == null || annotationGeneratedModule.isManifestParsingEnabled()) &#123;        manifestModules = new ManifestParser(applicationContext).parse();    &#125;    if (annotationGeneratedModule != null        &amp;&amp; !annotationGeneratedModule.getExcludedModuleClasses().isEmpty()) &#123;        Set&lt;Class&lt;?&gt;&gt; excludedModuleClasses = annotationGeneratedModule.getExcludedModuleClasses();        Iterator&lt;com.bumptech.glide.module.GlideModule&gt; iterator = manifestModules.iterator();        while (iterator.hasNext()) &#123;            com.bumptech.glide.module.GlideModule current = iterator.next();            if (!excludedModuleClasses.contains(current.getClass())) &#123;                continue;            &#125;            if (Log.isLoggable(TAG, Log.DEBUG)) &#123;                Log.d(TAG, &quot;AppGlideModule excludes manifest GlideModule: &quot; + current);            &#125;            iterator.remove();        &#125;    &#125;    ...    RequestManagerRetriever.RequestManagerFactory factory =        annotationGeneratedModule != null            ? annotationGeneratedModule.getRequestManagerFactory()            : null;    builder.setRequestManagerFactory(factory);    for (com.bumptech.glide.module.GlideModule module : manifestModules) &#123;        module.applyOptions(applicationContext, builder);    &#125;    if (annotationGeneratedModule != null) &#123;        annotationGeneratedModule.applyOptions(applicationContext, builder);    &#125;    // åˆ›å»º Glide å®ä¾‹    Glide glide = builder.build(applicationContext);    for (com.bumptech.glide.module.GlideModule module : manifestModules) &#123;        try &#123;        module.registerComponents(applicationContext, glide, glide.registry);        &#125; catch (AbstractMethodError e) &#123;        throw new IllegalStateException(            &quot;Attempting to register a Glide v3 module. If you see this, you or one of your&quot;                + &quot; dependencies may be including Glide v3 even though you&#39;re using Glide v4.&quot;                + &quot; You&#39;ll need to find and remove (or update) the offending dependency.&quot;                + &quot; The v3 module name is: &quot;                + module.getClass().getName(),            e);        &#125;    &#125;    if (annotationGeneratedModule != null) &#123;        annotationGeneratedModule.registerComponents(applicationContext, glide, glide.registry);    &#125;    applicationContext.registerComponentCallbacks(glide);        // glide å˜é‡çš„å£°æ˜æ–¹å¼æ˜¯ private static volatile Glide glide; ä½¿ç”¨äº† volatile å…³é”®å­—ä¿è¯äº†å¯è§æ€§    Glide.glide = glide;&#125;</code></pre><p>åœ¨åˆå§‹åŒ–å·¥ä½œä¸­ï¼Œä¸»è¦æ˜¯è§£æäº† GlideModuleï¼Œä¹Ÿå³é…ç½®ã€‚åœ¨ Glide 4.0 ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸ 3.0 ä¸ä¸€æ ·çš„åœ°æ–¹å°±åœ¨è¿™é‡Œäº†ï¼š<strong>Glide çš„ Module é…ç½®ä¸å†æ˜¯åœ¨ Manifest ä¸­æ³¨å†Œï¼Œè€Œæ˜¯é€šè¿‡åœ¨é…ç½®ç±»ä¸Šæ³¨è§£ï¼ˆ@GlideModuleï¼‰çš„æ–¹å¼æ¥å£°æ˜ä¸€ä¸ªé…ç½®ç±»</strong>ã€‚</p><p>å®ƒçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class="java">@GlideModulepublic class GlideModuleExample extends AppGlideModule &#123;&#125;</code></pre><p>å½“æˆ‘ä»¬ç¼–è¯‘æ—¶ï¼Œå› ä¸ºå¦‚æœè¦ä½¿ç”¨ Glide 4.0ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ app/build.gradle ä¸­è¿™æ ·é…ç½®ï¼š</p><pre><code class="groovy">implementation &#39;com.github.bumptech.glide:glide:4.11.0&#39;annotationProcessor &#39;com.github.bumptech.glide:compiler:4.11.0&#39;</code></pre><p>ä¹Ÿå³ glide æœ‰è‡ªå·±çš„æ³¨è§£å¤„ç†ç³»ç»Ÿï¼Œå½“æˆ‘ä»¬ç¼–è¯‘å®Œæˆåï¼Œä¼šç”Ÿæˆä¸‹é¢å‡ ä¸ªç±»ï¼š</p><p><img src="/img/68.png"></p><p>å…¶ä¸­å°±æœ‰æˆ‘ä»¬ä¸Šé¢æåˆ°çš„<code>com.bumptech.glide.GeneratedAppGlideModuleImpl</code>ç±»ã€‚</p><p>é…ç½®è§£æå®Œæˆåï¼Œå°±é€šè¿‡<code>GlideBuilder.build()</code>æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹äº†ã€‚åˆ›å»ºå®Œæˆåï¼Œå°†è¯¥å®ä¾‹èµ‹ç»™ä¸€ä¸ªé™æ€çš„ volatile çš„å˜é‡ã€‚æ¥çœ‹çœ‹<code>build()</code>æ–¹æ³•åšäº†äº›ä»€ä¹ˆï¼š</p><pre><code class="java">@NonNullGlide build(@NonNull Context context) &#123;    // æ–°å»ºä¸€ä¸ªæºçº¿ç¨‹çš„çº¿ç¨‹æ±     if (sourceExecutor == null) &#123;        sourceExecutor = GlideExecutor.newSourceExecutor();    &#125;    // æ–°å»ºä¸€ä¸ªç¼“å­˜ç”¨çš„çº¿ç¨‹æ±     if (diskCacheExecutor == null) &#123;        diskCacheExecutor = GlideExecutor.newDiskCacheExecutor();    &#125;    // æ–°å»ºä¸€ä¸ªåŠ¨ç”»ç”¨çš„çº¿ç¨‹æ±     if (animationExecutor == null) &#123;        animationExecutor = GlideExecutor.newAnimationExecutor();    &#125;    // åŸºäºè®¾å¤‡çš„ä¸€äº›ä¿¡æ¯è®¾å®šç¼“å­˜åŒºåŸŸçš„å¤§å°    if (memorySizeCalculator == null) &#123;        memorySizeCalculator = new MemorySizeCalculator.Builder(context).build();    &#125;    // ç›‘å¬ç½‘ç»œçŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ android.permission.ACCESS_NETWORK_STATE æƒé™çš„è¯ï¼Œå°±ä¸ç›‘æµ‹    if (connectivityMonitorFactory == null) &#123;        connectivityMonitorFactory = new DefaultConnectivityMonitorFactory();    &#125;    // æ ¹æ®ä¹‹å‰è·å–çš„ç¼“å­˜åŒºåŸŸçš„å¤§å°ï¼Œå†³å®šè¦ç”¨å“ªç§ bitmapPool    if (bitmapPool == null) &#123;        int size = memorySizeCalculator.getBitmapPoolSize();        if (size &gt; 0) &#123;            // ä½¿ç”¨ LRU ç®—æ³•çš„ Bitmap æ±             bitmapPool = new LruBitmapPool(size);        &#125; else &#123;            // ä½¿ç”¨ç©º Bitmap æ±             bitmapPool = new BitmapPoolAdapter();        &#125;    &#125;    if (arrayPool == null) &#123;        arrayPool = new LruArrayPool(memorySizeCalculator.getArrayPoolSizeInBytes());    &#125;    if (memoryCache == null) &#123;        memoryCache = new LruResourceCache(memorySizeCalculator.getMemoryCacheSize());    &#125;    if (diskCacheFactory == null) &#123;        diskCacheFactory = new InternalCacheDiskCacheFactory(context);    &#125;    // Engine ç”¨æ¥ç®¡ç†ä¸Šæ–¹åˆå§‹åŒ–çš„å„ç§çº¿ç¨‹æ± å’Œç¼“å­˜     if (engine == null) &#123;        engine =            new Engine(                memoryCache,                diskCacheFactory,                diskCacheExecutor,                sourceExecutor,                GlideExecutor.newUnlimitedSourceExecutor(),                animationExecutor,                isActiveResourceRetentionAllowed);    &#125;    if (defaultRequestListeners == null) &#123;        defaultRequestListeners = Collections.emptyList();    &#125; else &#123;        defaultRequestListeners = Collections.unmodifiableList(defaultRequestListeners);    &#125;    RequestManagerRetriever requestManagerRetriever =        new RequestManagerRetriever(requestManagerFactory);    return new Glide(        context,        engine,        memoryCache,        bitmapPool,        arrayPool,        requestManagerRetriever,        connectivityMonitorFactory,        logLevel,        defaultRequestOptionsFactory,        defaultTransitionOptions,        defaultRequestListeners,        isLoggingRequestOriginsEnabled,        isImageDecoderEnabledForBitmaps);&#125;</code></pre><p>å¯è§ Glide åœ¨åˆå§‹åŒ–ä¸­åšäº†å¾ˆå¤šçš„å·¥ä½œã€‚</p><ol><li>é¦–å…ˆåˆå§‹åŒ–äº†3ä¸ªçº¿ç¨‹æ± ï¼Œåˆ†åˆ«ç”¨æ¥å¤„ç†çº¿ç¨‹ã€LRUç¼“å­˜ã€åŠ¨ç”»</li><li>æ ¹æ®è®¾å¤‡çš„å…·ä½“ä¿¡æ¯ï¼Œåˆå§‹åŒ–ç¼“å­˜åŒºåŸŸ</li><li>åˆå§‹åŒ–äº†ä¸€ä¸ª Engine çš„å®ä¾‹ç”¨æ¥ç®¡ç†ä¸Šé¢å®ä¾‹åŒ–çš„ä¸œè¥¿</li><li>ç”Ÿæˆä¸€ä¸ª RequestManagerRetriver çš„å®ä¾‹ï¼Œåé¢ä¼šç”¨æ¥è·å– RequestManager</li><li>ç”Ÿæˆ Glide å®ä¾‹</li></ol><h2 id="load"><a href="#load" class="headerlink" title="load()"></a><code>load()</code></h2><p>åœ¨è°ƒç”¨withæ–¹æ³•è·å–åˆ°RequestManagerå¯¹è±¡çš„å‰æä¸‹ï¼Œè°ƒç”¨loadæ–¹æ³•ï¼Œå¹¶ä¼ é€’æˆ‘ä»¬çš„urlå‚æ•°ï¼Œæ¥çœ‹ä¸‹å®ƒçš„æºç ï¼š</p><p><a href="https://www.cnblogs.com/guanmanman/p/7008259.html">ç»§ç»­çœ‹è¿™é‡Œ</a></p><h2 id="into"><a href="#into" class="headerlink" title="into()"></a><code>into()</code></h2><p><a href="https://www.cnblogs.com/guanmanman/p/7040942.html">ç»§ç»­çœ‹è¿™é‡Œ</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Glide </tag>
            
            <tag> ä¸‰æ–¹åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Context å’Œå®ƒçš„æœ‹å‹ä»¬</title>
      <link href="/2020-03-24/context-and-its-friends/"/>
      <url>/2020-03-24/context-and-its-friends/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Android å¼€å‘ä¸­ï¼Œæœ€å¸¸æ‰“äº¤é“çš„å°±æ˜¯ Context äº†ï¼Œæˆ‘ä»¬åˆ›å»º View/ViewGroup è¦ä½¿ç”¨ Contextï¼›å¯åŠ¨ Activity éœ€è¦ Contextï¼›æ–°å»º Service éœ€è¦ Contextï¼›å“ªæ€•æ˜¯æ’ä»¶åŒ–ã€ç»„ä»¶åŒ–å¼€å‘ä¸­ï¼Œæœ€éº»çƒ¦çš„éƒ¨åˆ†ä¹Ÿæ˜¯ä½¿ç”¨ Contextã€‚</p><p>é‚£ä¹ˆï¼Œæ—¢ç„¶è¿™ä¸ªä¸œè¥¿è¿™ä¹ˆé‡è¦ï¼Œæˆ‘ä»¬è¿™ç¯‡æ–‡ç« å°±æ¥è¯´è¯´ Context ä¸å®ƒçš„æœ‹å‹ä»¬ã€‚</p><span id="more"></span><h2 id="Context-ä»‹ç»"><a href="#Context-ä»‹ç»" class="headerlink" title="Context ä»‹ç»"></a>Context ä»‹ç»</h2><p>Context åœ¨è‹±æ–‡ä¸­çš„æ„æ€æ˜¯ã€ä¸Šä¸‹æ–‡ã€ï¼Œä½†åœ¨ Android ç³»ç»Ÿä¸­ï¼Œæˆ‘æ›´æ„¿æ„å°†å…¶ç§°ä¹‹ä¸ºã€æ‰§è¡Œç¯å¢ƒã€ã€‚æ¯”å¦‚åˆ›å»º View/ViewGroupï¼Œæˆ‘ä¼ å…¥ Contextï¼Œæ„åœ¨å‘Šè¯‰ View/ViewGroupï¼Œä½ å½“å‰æ˜¯åœ¨ä»€ä¹ˆç¯å¢ƒä¸‹è¢«åˆ›å»ºçš„ï¼ŒåŒ…æ‹¬ä½ åœ¨å“ªä¸ªè¿›ç¨‹é‡Œï¼ŒåŒ…åæ˜¯å•¥ï¼Œpid æ˜¯å•¥ï¼Œçº¿ç¨‹ tid æ˜¯å•¥ï¼Œç­‰ç­‰ç­‰ç­‰ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ª Contextï¼Œè¢«åˆ›å»ºçš„ View/ViewGroup ä¹Ÿä¼šå‘å‡ºçµé­‚ä¸‰é—®ï¼šæˆ‘æ˜¯è°ï¼Ÿæˆ‘åœ¨å“ªå„¿ï¼Ÿæˆ‘è¦å¹²ä»€ä¹ˆï¼Ÿ<img src="http://img.doutula.com/production/uploads/image/2016/05/22/20160522875204_LXZYPF.jpg" style="width: 120px"></img></p><p>å¤§åé¼é¼çš„ Activityã€Service éƒ½æ˜¯ Context çš„æ´¾ç”Ÿç±»ã€‚å¦‚æœæœ‰äººæœ‰ä¸€å¤©é—®ä½ ï¼šActivity ä¸ºå•¥ä¸æ˜¯ç›´æ¥ç»§æ‰¿è‡ª Context çš„ï¼ŸContextWrapper æ˜¯ä¸ªå•¥ï¼ŸContextImpl åˆæ˜¯ä¸ªå•¥ï¼ŸActivity çš„ Context å’Œ Application çš„ Context æœ‰å•¥åŒºåˆ«ï¼Ÿåˆæœ‰å•¥ç›¸åŒçš„åœ°æ–¹ï¼Ÿæˆ‘å¸Œæœ›ä½ èƒ½è‡ªä¿¡åœ°ç”¨è¿™ç¯‡æ–‡ç« ç ¸åˆ°ä»–è„¸ä¸Šï¼Œç„¶åè¯´ï¼šè‡ªå·±çœ‹ï¼ï¼ï¼</p><h2 id="Context-ç±»ä¸ç›¸å…³ç±»"><a href="#Context-ç±»ä¸ç›¸å…³ç±»" class="headerlink" title="Context ç±»ä¸ç›¸å…³ç±»"></a>Context ç±»ä¸ç›¸å…³ç±»</h2><p>æœ¬äººå€¾æƒ…æ‰‹ç»˜ï¼Œå±•ç¤ºäº† Context ç›¸å…³çš„ç±»å›¾ï¼Œè¯·ä¸Šçœ¼ï¼š</p><p><img src="/img/context-1589184230.png"></p><p>ï¼Ÿï¼Ÿï¼Ÿä¸å¥½æ„æ€ï¼Œæ”¾é”™å›¾äº†ï¼Œæ˜¯è¿™ä¸ªï¼š</p><p><img src="/img/context-1589184470.png"></p><p>æˆ‘ä»¬ç”±ä¸Šè‡ªä¸‹æ¥è®²è®²è¿™äº›ç±»ã€‚</p><h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Android æºç ä¸­å¯¹äº Context çš„å®šä¹‰ï¼š</p><blockquote><p>Interface to global information about an application environment.  This is an abstract class whose implementation is provided by the Android system.  It allows access to application-specific resources and classes, as well as up-calls for application-level operations such as launching activities, broadcasting and receiving intents, etc.</p></blockquote><p>å¤§æ„æ˜¯ Context æ˜¯ä¸€ä¸ªä¸º App è¿è¡Œ<strong>æä¾›å…¨å±€ä¿¡æ¯çš„æ¥å£</strong>ï¼ˆæ˜¯å¹¿ä¹‰ä¸Šçš„æ¥å£ï¼Œä¸æ˜¯ interfaceï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶å…·ä½“å®ä¾‹ç”± Android ç³»ç»Ÿæä¾›ã€‚å®ƒå…è®¸ä½ è®¿é—®ä¸€äº› App æŒ‡å®šçš„èµ„æºå’Œç±»ï¼Œè¿˜æœ‰æ‰§è¡Œä¸€äº›åº”ç”¨çº§åˆ«çš„æ“ä½œæ¯”å¦‚å¯åŠ¨ Activity å•¦ï¼Œå¹¿æ’­å•¦ï¼Œè·å– intent å•¦ï¼Œç­‰ç­‰ã€‚</p><p>å®ƒæä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æœ‰<code>getApplicationContext()</code>ï¼Œ<code>getAssets()</code>ï¼Œ<code>getString(int)</code>ï¼Œ<code>startActivity()</code>ï¼Œ<code>startService()</code>ï¼Œ<code>sendBroadcast()</code>ç­‰ç­‰ç­‰ç­‰ã€‚</p><p>é‚£ä¹ˆç”±ä¸Šé¢çš„å®šä¹‰æˆ‘ä»¬çŸ¥é“ï¼ŒContext æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¿™äº›æ–¹æ³•å…·ä½“æ˜¯ç”±è°æ¥å®ç°çš„ï¼Ÿåˆæ˜¯ä½•æ—¶åˆå§‹åŒ–çš„ï¼Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦ä»‹ç»ä¸‹ä¸€ä¸ªç±»â€”â€” ContextWrapperã€‚</p><h3 id="ContextWrapper"><a href="#ContextWrapper" class="headerlink" title="ContextWrapper"></a>ContextWrapper</h3><p>å¦‚æœæ²¡å¬è¿‡ã€è£…é¥°å™¨æ¨¡å¼ã€çš„è¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸€å°æ®µï¼Œå¦‚æœä½ å·²ç»ç†ŸçŸ¥ã€è£…é¥°å™¨æ¨¡å¼ã€ï¼Œåˆ™å¯ä»¥æ¸©æ•…è€ŒçŸ¥æ–°ã€‚</p><p>æ‰€è°“ã€è£…é¥°å™¨æ¨¡å¼ã€ï¼Œå³ç»™ç°æœ‰çš„å¯¹è±¡æä¾›æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚è¿™ç§è®¾è®¡æ¨¡å¼å±æ€§ç»“æ„å‹è®¾è®¡ï¼Œç›¸å½“äºå¯¹ç°æœ‰ç±»çš„ä¸€ä¸ªåŒ…è£…ã€‚</p><p>å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒä»£ç†ï¼Ÿå¯¹ï¼ä¸ä»£ç†ååˆ†ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨åŸæœ‰ç±»çš„åŸºç¡€ä¸Šå¯¹å…¶è¿›è¡Œæ‹“å±•ï¼Œä»¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚</p><p>ä¹Ÿæœ‰äººé—®äº†ï¼Œæˆ‘ç»§æ‰¿ä¸å°±å®Œäº†ï¼Œå¹²å˜›è¿˜è¦ä½¿ç”¨ä»€ä¹ˆè£…é¥°å™¨æ¨¡å¼ï¼Ÿæˆ‘ä»¬è¦çŸ¥é“ï¼ŒJava æ˜¯å•ç»§æ‰¿ï¼Œå¦‚æœä½ å¤šçº§åŒ…è£…ï¼Œå­ç±»ä¼šè¶Šæ¥è¶Šå¤šï¼Œå±‚çº§è¶Šæ¥è¶Šæ·±ï¼Œè€Œåˆ©ç”¨è£…é¥°å™¨æ¨¡å¼åˆ™å¯ä»¥ä¼˜é›…è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒ<strong>åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£</strong>ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°å™¨æ¨¡å¼ç›¸æ¯”ç»§æ‰¿<strong>æ›´ä¸ºçµæ´»</strong>ã€‚</p><p>ContexWrapper æ˜¯åœ¨ä½•å¤„ä½¿ç”¨çš„è£…é¥°å™¨æ¨¡å¼å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹æºç ï¼š</p><pre><code class="java">public class ContextWrapper extends Context &#123;    Context mBase;    public ContextWrapper(Context base) &#123;        mBase = base;    &#125;</code></pre><p>çœ‹åˆ°æ²¡æœ‰ï¼ŒContextWrapper ä¸­åŒ…å«äº†ä¸€ä¸ª Context çš„å®ä¾‹ï¼Œåœ¨åç»­çš„æ–¹æ³•è°ƒç”¨ä¸­ï¼Œå…¨éƒ¨éƒ½ä¼šè°ƒç”¨<code>mBase.xxx()</code>æ–¹æ³•æ¥å®Œæˆä»»åŠ¡ï¼š</p><pre><code class="java">@Overridepublic String getPackageName() &#123;    return mBase.getPackageName();&#125;@Overridepublic SharedPreferences getSharedPreferences(String name, int mode) &#123;    return mBase.getSharedPreferences(name, mode);&#125;@Overridepublic Resources getResources() &#123;    return mBase.getResources();    &#125;</code></pre><p>è€Œ Activityã€Applicationã€Service ç­‰ï¼Œåˆ™æ˜¯ ContexWrapper çš„å…·ä½“è£…é¥°è€…ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ¯ä¸ªäººçš„ç‰¹ç‚¹ã€‚</p><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼ŒContextWrapper ä¸­æœ‰ Context ç±»å‹çš„å¯¹è±¡<code>mBase</code>ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯åœ¨ä½•æ—¶è¢«ä¼ è¿›æ¥çš„å‘¢ï¼Ÿ</p><h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>æˆ‘ä»¬ä»¥ Application ä¸ºä¾‹ï¼ŒæŸ¥çœ‹å®ƒè°ƒç”¨<code>attachBaseContext()</code>çš„ä½ç½®ï¼š</p><pre><code class="java">// android.app.Application.java@UnsupportedAppUsagefinal void attach(Context context) &#123;    attachBaseContext(context);    mLoadedApk = ContextImpl.getImpl(context).mPackageInfo;&#125;</code></pre><p>æˆ‘ä»¬ç»§ç»­å‘ä¸Šæ‰¾ï¼Œçœ‹è°è°ƒç”¨äº†<code>Application.attach()</code>ï¼š</p><pre><code class="java">// android.app.Instrumentation.javastatic public Application newApplication(Class&lt;?&gt; clazz, Context context)        throws InstantiationException, IllegalAccessException,         ClassNotFoundException &#123;    Application app = (Application)clazz.newInstance();    app.attach(context);    return app;&#125;</code></pre><p>è¿™é‡Œæ˜¯ä½¿ç”¨åå°„æœºåˆ¶è·å–äº† Application çš„ classï¼Œå¹¶æ–°å»ºäº†å®ä¾‹ã€‚é‚£ä¹ˆï¼Œç»§ç»­å‘ä¸Šèµ°ï¼š</p><pre><code class="java">// android.app.LoadedApk.javapublic Application makeApplication(boolean forceDefaultAppClass,        Instrumentation instrumentation) &#123;    if (mApplication != null) &#123;        return mApplication;    &#125;    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;makeApplication&quot;);    Application app = null;    String appClass = mApplicationInfo.className;    if (forceDefaultAppClass || (appClass == null)) &#123;        appClass = &quot;android.app.Application&quot;;    &#125;    try &#123;        java.lang.ClassLoader cl = getClassLoader();        if (!mPackageName.equals(&quot;android&quot;)) &#123;            Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,                    &quot;initializeJavaContextClassLoader&quot;);            initializeJavaContextClassLoader();            Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);        &#125;        ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this); // 1        app = mActivityThread.mInstrumentation.newApplication(                 cl, appClass, appContext);   // 2        appContext.setOuterContext(app);    &#125; catch (Exception e) &#123;        if (!mActivityThread.mInstrumentation.onException(app, e)) &#123;            Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);            throw new RuntimeException(                &quot;Unable to instantiate application &quot; + appClass                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;    mActivityThread.mAllApplications.add(app);    mApplication = app;    if (instrumentation != null) &#123;        try &#123;            instrumentation.callApplicationOnCreate(app);  // 3        &#125; catch (Exception e) &#123;            if (!instrumentation.onException(app, e)) &#123;                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);                throw new RuntimeException(                    &quot;Unable to create application &quot; + app.getClass().getName()                    + &quot;: &quot; + e.toString(), e);            &#125;        &#125;    &#125;    // Rewrite the R &#39;constants&#39; for all library apks.    SparseArray&lt;String&gt; packageIdentifiers = getAssets().getAssignedPackageIdentifiers();    final int N = packageIdentifiers.size();    for (int i = 0; i &lt; N; i++) &#123;        final int id = packageIdentifiers.keyAt(i);        if (id == 0x01 || id == 0x7f) &#123;            continue;        &#125;        rewriteRValues(getClassLoader(), packageIdentifiers.valueAt(i), id);    &#125;    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);    return app;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š</p><ol><li>ä½¿ç”¨<code>ContextImpl.createAppContext()</code>åˆ›å»ºäº† ContextImpl çš„å®ä¾‹</li><li>å°† ContextImpl çš„å®ä¾‹å¡ç»™äº† Application </li><li>è°ƒç”¨äº†<code>Application.onCreate()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</li></ol><p>é‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼ŒApplication ä¸­çš„<code>mBase</code>ï¼Œå®é™…ä¸Šæ˜¯ ContextImpl çš„å®ä¾‹ã€‚è¿™ä¸ä¸Šé¢çš„è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸å†²çªçš„ã€‚</p><h3 id="ContextThemeWrapper"><a href="#ContextThemeWrapper" class="headerlink" title="ContextThemeWrapper"></a>ContextThemeWrapper</h3><p>Activity ç›´æ¥ç»§æ‰¿è‡ª ContextThemeWrapperï¼Œå®ƒæ˜¯ ContextWrapper çš„ä¸€ä¸ªæ‹“å±•ç±»ï¼Œé‡Œé¢åŒ…å«äº†<strong>ä¸»é¢˜ç›¸å…³çš„å˜é‡</strong>ï¼š</p><pre><code class="java">public class ContextThemeWrapper extends ContextWrapper &#123;    private int mThemeResource;    private Resources.Theme mTheme;    private LayoutInflater mInflater;    private Configuration mOverrideConfiguration;    private Resources mResources;&#125;</code></pre><p>Application å’Œ Service éƒ½æ˜¯ç»§æ‰¿è‡ª ContextWrapperï¼Œé‡Œé¢æ²¡æœ‰åŒ…å«ä¸»é¢˜ç›¸å…³çš„å˜é‡ï¼Œæ‰€ä»¥ï¼Œ<strong>åªæœ‰ Activity èƒ½å¤Ÿä½¿ç”¨ä¸»é¢˜èµ„æº</strong>ã€‚</p><h3 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h3><p>å¯¹äº Activityï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åˆ†æä¸€ä¸‹ï¼š</p><p>Activity ä¸­çš„<code>attachBaseContext()</code>å¦‚ä¸‹ï¼š</p><pre><code class="java">@Overrideprotected void attachBaseContext(Context newBase) &#123;    super.attachBaseContext(newBase);    if (newBase != null) &#123;        newBase.setAutofillClient(this);        newBase.setContentCaptureOptions(getContentCaptureOptions());    &#125;&#125;</code></pre><p>è€Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Activity åˆ›å»ºè¿‡ç¨‹ä¸­çš„é‡è¦æ–¹æ³•<code>attach()</code>ä¸­è°ƒç”¨çš„ï¼š</p><pre><code class="java">final void attach(Context context, ActivityThread aThread,            Instrumentation instr, IBinder token, int ident,            Application application, Intent intent, ActivityInfo info,            CharSequence title, Activity parent, String id,            NonConfigurationInstances lastNonConfigurationInstances,            Configuration config, String referrer, IVoiceInteractor voiceInteractor,            Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) &#123;        attachBaseContext(context);        ...&#125;</code></pre><p>è¿™ä¸ªæ–¹æ³•åˆæ˜¯åœ¨ ActivityThread ä¸­è¢«è°ƒç”¨ï¼š</p><pre><code class="java">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;    ...    ContextImpl appContext = createBaseContextForActivity(r);  // 1    Activity activity = null;    try &#123;        java.lang.ClassLoader cl = appContext.getClassLoader();        activity = mInstrumentation.newActivity(                cl, component.getClassName(), r.intent);  // 2        StrictMode.incrementExpectedActivityCount(activity.getClass());        r.intent.setExtrasClassLoader(cl);        r.intent.prepareToEnterProcess();        if (r.state != null) &#123;            r.state.setClassLoader(cl);        &#125;    &#125; catch (Exception e) &#123;        if (!mInstrumentation.onException(activity, e)) &#123;            throw new RuntimeException(                &quot;Unable to instantiate activity &quot; + component                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;    ...    activity.attach(appContext, this, getInstrumentation(), r.token,                    r.ident, app, r.intent, r.activityInfo, title, r.parent,                    r.embeddedID, r.lastNonConfigurationInstances, config,                    r.referrer, r.voiceInteractor, window, r.configCallback,                    r.assistToken);  // 3    ...    if (r.isPersistable()) &#123;        mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState); // 4    &#125; else &#123;        mInstrumentation.callActivityOnCreate(activity, r.state); // 4    &#125;    ...&#125;</code></pre><p>è¿™æ®µä»£ç å¤§ä½“åˆ†ä¸º4æ­¥ï¼š</p><ol><li>ä½¿ç”¨<code>createBaseContextForActivity()</code>æ–¹æ³•åˆ›å»º ContextImpl å®ä¾‹</li><li>åˆ›å»º Activity å®ä¾‹</li><li>è°ƒç”¨<code>Activity.attach()</code>å°† ContextImpl å®ä¾‹èµ‹å€¼åˆ° Activity çš„<code>mBase</code>æˆå‘˜å˜é‡ä¸­</li><li>è°ƒç”¨<code>Activity.onCreate()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</li></ol><h3 id="ContextImpl"><a href="#ContextImpl" class="headerlink" title="ContextImpl"></a>ContextImpl</h3><p>æˆ‘ä»¬åœ¨ä¸Šé¢çŸ¥é“äº† ContextWrapper ä¸­åŒ…è£…çš„è¿™ä¸ª Context å¯¹è±¡ï¼Œéƒ½æ˜¯ ContextImpl çš„å®ä¾‹ï¼Œé‚£è¿™ä¸ªç±»åˆ°åº•ä¸ºä»€ä¹ˆå¦‚æ­¤æ‰‹çœ¼é€šå¤©ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ã€‚</p><p>è¿™ä¸ªç±»å…¶å®å°±æ˜¯ Context æŠ½è±¡ç±»çš„<strong>å…·ä½“å®ç°</strong>ï¼Œä¸èµ„æºã€ç³»ç»ŸæœåŠ¡çš„é€šä¿¡ï¼Œå…¨éƒ¨é è¿™ä¸ªç±»ã€‚è¯´è¿™ä¸ªç±»å¯¹äºå¼€å‘è€…æ¥è¯´æ˜¯æœ€é‡è¦çš„ç±»ï¼Œä¹Ÿä¸å¹¶ä¸è¿‡åˆ†ã€‚å®ƒå°†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„è¯¸å¦‚<code>startActivity()</code>ã€<code>getAssets()</code>ã€<code>getResources()</code>ä¹‹ç±»çš„æ–¹æ³•éƒ½å®ç°äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„éƒ¨åˆ†ä»£ç ï¼š</p><pre><code class="java">// android.app.ContextImpl.javaclass ContextImpl extends Context &#123;    ...    // æˆ‘ä»¬è·å–çš„ SharedPreferenceï¼Œæ¥è‡ªäºè¿™å„¿ï¼Œå…·ä½“å®ç°çœ‹æ¥æ˜¯ SharedPreferencesImpl ç±»ï¼Œè¿™é‡Œä¸å¤šåˆ†æ    private static ArrayMap&lt;String, ArrayMap&lt;File, SharedPreferencesImpl&gt;&gt; sSharedPrefsCache;    ...    final @NonNull ActivityThread mMainThread;  // ä¸»çº¿ç¨‹    final @NonNull LoadedApk mPackageInfo;  // Apk ä¿¡æ¯ï¼ŒåŒ…å«åŒ…åã€ç‰ˆæœ¬å·ç­‰ä¿¡æ¯    private @Nullable ClassLoader mClassLoader;  // åŠ è½½ ContextImpl ç±»æ—¶ä½¿ç”¨çš„ ClassLoader    ...    private @NonNull Resources mResources;  // getResources() æ‹¿åˆ°çš„å¯¹è±¡    ...    private Context mOuterContext;   // æŒæœ‰ç€å¤–éƒ¨ Context çš„å¼•ç”¨ï¼Œä¹Ÿå³ ContextWrapper çš„å®ä¾‹    ...    private PackageManager mPackageManager;    ...    private final Object mSync = new Object();    ...    // å‡ ä¸ªå¸¸ç”¨çš„è·¯å¾„    @GuardedBy(&quot;mSync&quot;)    private File mDatabasesDir;    @GuardedBy(&quot;mSync&quot;)    @UnsupportedAppUsage    private File mPreferencesDir;    @GuardedBy(&quot;mSync&quot;)    private File mFilesDir;    @GuardedBy(&quot;mSync&quot;)    private File mNoBackupFilesDir;    @GuardedBy(&quot;mSync&quot;)    private File mCacheDir;    @GuardedBy(&quot;mSync&quot;)    private File mCodeCacheDir;    ...    @Override    public Context getApplicationContext() &#123;        return (mPackageInfo != null) ?                mPackageInfo.getApplication() : mMainThread.getApplication();    &#125;    ...    @Override    public String getPackageName() &#123;        if (mPackageInfo != null) &#123;            return mPackageInfo.getPackageName();        &#125;        // No mPackageInfo means this is a Context for the system itself,        // and this here is its name.        return &quot;android&quot;;    &#125;    ...    @Override    public void startActivity(Intent intent, Bundle options) &#123;        warnIfCallingFromSystemProcess();        // Calling start activity from outside an activity without FLAG_ACTIVITY_NEW_TASK is        // generally not allowed, except if the caller specifies the task id the activity should        // be launched in. A bug was existed between N and O-MR1 which allowed this to work. We        // maintain this for backwards compatibility.        final int targetSdkVersion = getApplicationInfo().targetSdkVersion;        if ((intent.getFlags() &amp; Intent.FLAG_ACTIVITY_NEW_TASK) == 0                &amp;&amp; (targetSdkVersion &lt; Build.VERSION_CODES.N                        || targetSdkVersion &gt;= Build.VERSION_CODES.P)                &amp;&amp; (options == null                        || ActivityOptions.fromBundle(options).getLaunchTaskId() == -1)) &#123;            throw new AndroidRuntimeException(                    &quot;Calling startActivity() from outside of an Activity &quot;                            + &quot; context requires the FLAG_ACTIVITY_NEW_TASK flag.&quot;                            + &quot; Is this really what you want?&quot;);        &#125;        mMainThread.getInstrumentation().execStartActivity(                getOuterContext(), mMainThread.getApplicationThread(), null,                (Activity) null, intent, -1, options);    &#125;    ...    @Override    public void sendBroadcast(Intent intent) &#123;        warnIfCallingFromSystemProcess();        String resolvedType = intent.resolveTypeIfNeeded(getContentResolver());        try &#123;            intent.prepareToLeaveProcess(this);            ActivityManager.getService().broadcastIntent(                    mMainThread.getApplicationThread(), intent, resolvedType, null,                    Activity.RESULT_OK, null, null, null, AppOpsManager.OP_NONE, null, false, false,                    getUserId());        &#125; catch (RemoteException e) &#123;            throw e.rethrowFromSystemServer();        &#125;    &#125;    ...&#125;</code></pre><p>è¿˜æœ‰å¾ˆå¤šï¼Œå°±ä¸ä¸€ä¸€è´´å‡ºäº†ã€‚</p><p>ç”±è¿™äº›ä»£ç æˆ‘ä»¬ç°åœ¨èƒ½çŸ¥é“ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ Context ä¸­çš„æ–¹æ³•æ—¶ï¼ŒçœŸæ­£çš„å®ç°å…¨éƒ¨éƒ½åœ¨è¿™é‡Œã€‚å½“ç„¶ï¼Œå†å…·ä½“çš„å·¥ä½œæ¯”å¦‚åˆ›å»ºæ–°çš„ Activity å®ä¾‹ï¼Œè¿˜å¾—äº¤ç”± ActivityThread å»åšï¼Œæš‚ä¸”ä¸è¡¨ã€‚</p><h2 id="getContext-å’Œ-getApplicationContext"><a href="#getContext-å’Œ-getApplicationContext" class="headerlink" title="getContext() å’Œ getApplicationContext()"></a>getContext() å’Œ getApplicationContext()</h2><p>è¿™ä¸¤ä¸ªæ–¹æ³•ä¼¼ä¹åœ¨ Activity å’Œ Application ä¸­éƒ½èƒ½è°ƒç”¨ã€‚é‚£ä»–ä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡å—ï¼Ÿæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p>ç”±ä¸Šé¢ <a href="#application">Application</a> å’Œ <a href="#activity">Activity</a> éƒ¨åˆ†æˆ‘ä»¬çŸ¥é“ï¼Œå¡ç»™ Application å’Œ Activity çš„ï¼Œæ˜¯<code>new</code>äº†ä¸¤æ¬¡çš„ ContextImpl å®ä¾‹ï¼Œå®ƒä»¬æ˜¾ç„¶<strong>ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong>ã€‚</p><p>é‚£ä»–ä»¬çš„åŒºåˆ«åœ¨å“ªï¼Ÿå…ˆä»é«˜ä¸€ç‚¹çš„å±‚é¢æ¥è¯´ï¼ŒApplication Context æ˜¾ç„¶æ— è®ºä½ åœ¨å“ªå„¿è°ƒç”¨ï¼Œ<strong>è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ª ContextImpl å®ä¾‹</strong>ï¼›ä½† Activity Context è·å–çš„åªèƒ½æ˜¯<strong>å½“å‰ Activity çš„ ContextImpl å®ä¾‹</strong>ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸‹å­å°±èƒ½åŒºåˆ†ä¸¤ç§ Context çš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>å¦‚æœä»åº•å±‚çš„è§’åº¦å‘¢ï¼Œæˆ‘ä»¬å°±è¦åˆ†åˆ«çœ‹çœ‹è¿™ä¸¤ä¸ª ContextImpl åˆ›å»ºçš„è¿‡ç¨‹ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘å…ˆä¸Šä¸€æ®µ ContextImpl çš„æ„é€ å‡½æ•°ï¼Œæ–¹ä¾¿ä¸‹é¢è¿›è¡Œå¯¹æ¯”ï¼š</p><pre><code class="java">private ContextImpl(@Nullable ContextImpl container, @NonNull ActivityThread mainThread,        @NonNull LoadedApk packageInfo, @Nullable String splitName,        @Nullable IBinder activityToken, @Nullable UserHandle user, int flags,        @Nullable ClassLoader classLoader, @Nullable String overrideOpPackageName) &#123;    ...&#125;</code></pre><h3 id="Application-ä¸­-ContextImpl-çš„åˆ›å»ºè¿‡ç¨‹"><a href="#Application-ä¸­-ContextImpl-çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Application ä¸­ ContextImpl çš„åˆ›å»ºè¿‡ç¨‹"></a>Application ä¸­ ContextImpl çš„åˆ›å»ºè¿‡ç¨‹</h3><pre><code class="java">static ContextImpl createAppContext(ActivityThread mainThread, LoadedApk packageInfo,        String opPackageName) &#123;    if (packageInfo == null) throw new IllegalArgumentException(&quot;packageInfo&quot;);    ContextImpl context = new ContextImpl(null, mainThread, packageInfo, null, null, null, 0,            null, opPackageName);    context.setResources(packageInfo.getResources());    return context;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¹³æ·¡æ— å¥‡åœ°è°ƒç”¨äº† ContextImpl çš„æ„é€ å‡½æ•°ï¼Œå¹³æ·¡æ— å¥‡åœ°ç»™å®ƒå¡äº†ä¸ª resourceï¼Œå°±å¹³æ·¡æ— å¥‡åœ°è¿”å›äº†ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œä½¿ç”¨ Application Context å¯ä»¥è·å–ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ PackageNameã€Resources ç­‰ã€‚</p><h3 id="Activity-ä¸­-ContextImpl-çš„åˆ›å»ºè¿‡ç¨‹"><a href="#Activity-ä¸­-ContextImpl-çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Activity ä¸­ ContextImpl çš„åˆ›å»ºè¿‡ç¨‹"></a>Activity ä¸­ ContextImpl çš„åˆ›å»ºè¿‡ç¨‹</h3><pre><code class="java">    static ContextImpl createActivityContext(ActivityThread mainThread,            LoadedApk packageInfo, ActivityInfo activityInfo, IBinder activityToken, int displayId,            Configuration overrideConfiguration) &#123;        if (packageInfo == null) throw new IllegalArgumentException(&quot;packageInfo&quot;);        String[] splitDirs = packageInfo.getSplitResDirs();        ClassLoader classLoader = packageInfo.getClassLoader();        if (packageInfo.getApplicationInfo().requestsIsolatedSplitLoading()) &#123;            Trace.traceBegin(Trace.TRACE_TAG_RESOURCES, &quot;SplitDependencies&quot;);            try &#123;                classLoader = packageInfo.getSplitClassLoader(activityInfo.splitName);                splitDirs = packageInfo.getSplitPaths(activityInfo.splitName);            &#125; catch (NameNotFoundException e) &#123;                // Nothing above us can handle a NameNotFoundException, better crash.                throw new RuntimeException(e);            &#125; finally &#123;                Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);            &#125;        &#125;        ContextImpl context = new ContextImpl(null, mainThread, packageInfo, activityInfo.splitName,                activityToken, null, 0, classLoader, null);        // Clamp display ID to DEFAULT_DISPLAY if it is INVALID_DISPLAY.        displayId = (displayId != Display.INVALID_DISPLAY) ? displayId : Display.DEFAULT_DISPLAY;        final CompatibilityInfo compatInfo = (displayId == Display.DEFAULT_DISPLAY)                ? packageInfo.getCompatibilityInfo()                : CompatibilityInfo.DEFAULT_COMPATIBILITY_INFO;        final ResourcesManager resourcesManager = ResourcesManager.getInstance();        // Create the base resources for which all configuration contexts for this Activity        // will be rebased upon.        context.setResources(resourcesManager.createBaseActivityResources(activityToken,                packageInfo.getResDir(),                splitDirs,                packageInfo.getOverlayDirs(),                packageInfo.getApplicationInfo().sharedLibraryFiles,                displayId,                overrideConfiguration,                compatInfo,                classLoader));        context.mDisplay = resourcesManager.getAdjustedDisplay(displayId,                context.getResources());        return context;    &#125;</code></pre><p>å—¯ã€‚ã€‚æ˜æ˜¾ä¸ä¸€æ ·ã€‚ä¸€çœ¼å°±èƒ½çœ‹å‡ºï¼ŒActivity çš„ Context æ˜æ˜¾æ˜¯ç”¨å¿ƒçš„äº†å¥½å—ï¼ï¼å®ƒé‡Œé¢ä¼šæœ‰ä¸€äº›ä¸ Display ç›¸å…³çš„ä¿¡æ¯ï¼Œè€Œ Application çš„ Context åˆ™æ²¡æœ‰ã€‚</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ol><li><p>ä¼¼ä¹è¿˜æœ‰ä¸ª<code>getApplication()</code>æ–¹æ³•å•Šï¼Ÿè¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿå®ƒè·Ÿ<code>getApplicationContext()</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•è·å–çš„æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼š</p><pre><code class="java">Context a = getApplication();Context b = getApplicationContext();System.out.println(a);System.out.println(b);</code></pre><p> è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>I/System.out: android.app.Application@206b17eI/System.out: android.app.Application@206b17e</code></pre><p> çœ‹æ¥ä»–ä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚é‚£ä¹ˆ Android ä¸ºä½•è¦è®¾è®¡è¿™ä¸¤ç§æ–¹æ³•ï¼Œæ¥è·å–åŒä¸€ä¸ªå¯¹è±¡å‘¢ï¼Ÿæˆ‘åæ­£æ˜¯æ²¡æƒ³æ˜ç™½ã€‚æˆ‘è§‰å¾—è¿™å¾ˆæœ‰å¯èƒ½æ˜¯æœ‰ä»€ä¹ˆå†å²åŸå› é€ æˆçš„ã€‚è™½ç„¶ç›®å‰çœ‹æ¥ä»–ä»¬è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿä¸æ•¢ä¿è¯å°†æ¥ä¹Ÿä¼šæ˜¯è¿™æ ·ã€‚</p><p> å¦‚æœä½ æƒ³è¦è·å–åœ¨ Mainfest ä¸­æ³¨å†Œçš„é‚£ä¸ª Applicationï¼Œä½ ç»å¯¹ä¸è¦è°ƒç”¨ getApplicationContext() ç„¶åå¼ºè½¬æˆä½ çš„ Applicationï¼Œå®ƒä¿©å¹¶ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ä¸€ä»¶äº‹ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ BroadcastReceiver æ—¶ï¼Œè™½ç„¶å®ƒä¸æ˜¯ä¸€ä¸ª Context å¯¹è±¡ï¼Œä½†åœ¨å®ƒçš„<code>onReceive()</code>æ–¹æ³•ä¸­ä½ èƒ½æ‹¿åˆ° Contextï¼Œä½ ä¹Ÿåªèƒ½è°ƒç”¨<code>getApplicationContext()</code>æ–¹æ³•ã€‚</p><p> è‹¥æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä¸¤ä¸ªæ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œçœ‹<a href="https://www.jianshu.com/p/5328b73bb5e1">è¿™ç¯‡æ–‡ç« </a>ã€‚</p></li><li><p>æˆ‘ä»¬çŸ¥é“ï¼Œå››å¤§ç»„ä»¶ä¸­ä¹Ÿä¼šæœ‰ Context å‡ºç°ï¼ˆè™½ç„¶ BroadcastReceiverã€Serviceã€ContentProvider çš„ Context æ˜¯æ‰‹åŠ¨å¡è¿›å»çš„ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½èƒ½åšäº›ä»€ä¹ˆï¼Ÿ</p><p> æ¥å¼ è¡¨ä½ å°±çŸ¥é“äº†ï¼ˆåšæˆäº†å›¾ç‰‡ï¼Œè¡¨ä¼šæº¢å‡ºï¼Œæ¯”è¾ƒéš¾çœ‹ï¼‰ï¼š</p><p> <img src="/img/context-1589205829.png"></p><p> <strong>æ ‡æ³¨1</strong>ï¼šè¿™å‡ ç§æƒ…å†µä¸‹å…¶å®ä¹Ÿèƒ½å¯åŠ¨ Activityï¼Œä½†æ˜¯å¿…é¡»è¦åŠ ä¸Š<code>FLAG_ACTIVITY_NEW_TASK</code>æ ‡è¯†ä½ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æƒ…å†µä¸‹å¯åŠ¨ Activity ä¼šè®©åº”ç”¨çœ‹èµ·æ¥ã€ä¸é‚£ä¹ˆæ­£å¸¸ã€ï¼Œæ‰€ä»¥å°½é‡è¿˜æ˜¯é¿å…ä½¿ç”¨ã€‚<br> <strong>æ ‡æ³¨2</strong>ï¼šè¿™å‡ ç§æƒ…å†µä¸‹èƒ½æ­£å¸¸æ¸²æŸ“ Layoutï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯ Android çš„é»˜è®¤ä¸»é¢˜ï¼Œä¸ç³»ç»Ÿå®šä¹‰çš„ä¸»é¢˜æ— å…³äº†ã€‚<br> <strong>æ ‡æ³¨3</strong>ï¼šå¦‚æœ receiver æ˜¯ null æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œç”¨äºåœ¨ Android 4.2 åŠä»¥ä¸Šæ—¶è·å– Sticky Broadcast çš„ valueã€‚</p></li><li><p><code>getBaseContext()</code>æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ª Context ä¸­è®¿é—®å¦ä¸€ä¸ª Context æ—¶ä½¿ç”¨ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Context </tag>
            
            <tag> Android Framework] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºBinderçš„ä¸€åˆ‡</title>
      <link href="/2020-03-18/binder/"/>
      <url>/2020-03-18/binder/</url>
      
        <content type="html"><![CDATA[<h1 id="å…³äºBinderçš„ä¸€åˆ‡"><a href="#å…³äºBinderçš„ä¸€åˆ‡" class="headerlink" title="å…³äºBinderçš„ä¸€åˆ‡"></a>å…³äºBinderçš„ä¸€åˆ‡</h1><p>æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼ŒBinder æ˜¯ Android ç³»ç»Ÿä¸­æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚</p><p>æ­£å¦‚å…¶åã€ç²˜åˆå‰‚ã€æ‰€å–»ï¼Œå®ƒæ˜¯ç³»ç»Ÿé—´å„ä¸ªç»„ä»¶çš„æ¡¥æ¢ï¼ŒAndroid ç³»ç»Ÿçš„å¼€æ”¾å¼è®¾è®¡ä¹Ÿå¾ˆå¤§ç¨‹åº¦ä¸Šå¾—ç›Šäºè¿™ç§åŠå…¶æ–¹ä¾¿çš„è·¨è¿›ç¨‹é€šä¿¡æœºåˆ¶ã€‚</p><p>ç†è§£ Binder å¯¹äºç†è§£æ•´ä¸ª Android ç³»ç»Ÿæœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼ŒAndroid ç³»ç»Ÿçš„å››å¤§ç»„ä»¶ï¼ŒActivityManagerServerï¼ŒPackageManagerService ç­‰ç³»ç»ŸæœåŠ¡æ— ä¸€ä¸ä¸ Binder æŒ‚é’©ï¼›å¦‚æœå¯¹ Binder ä¸ç”šäº†è§£ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾äº†è§£è¿™äº›ç³»ç»Ÿæœºåˆ¶ï¼Œä»è€Œä»…ä»…æµ®æ¸¸ä¸è¡¨é¢ï¼Œä¸æ‡‚ Binder ä½ éƒ½ä¸å¥½æ„æ€è¯´è‡ªå·±ä¼š Android å¼€å‘ï¼›è¦æ·±å…¥ Androidï¼ŒBinder æ˜¯å¿…é¡»è¿ˆå‡ºçš„ä¸€æ­¥ã€‚</p><p>è¿™ç¯‡æ–‡ç« å°†ç”±æµ…å…¥æ·±ææ‡‚ Binder ï¼š</p><span id="more"></span><ol><li><a href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%E7%9A%84%E5%8E%9F%E7%90%86">å¤šè¿›ç¨‹é€šä¿¡çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#binder%E4%BB%8B%E7%BB%8D">ä½•ä¸º Binderï¼Ÿ</a></li><li><a href="#binder%E5%AF%B9%E6%AF%94%E5%85%B6%E4%BB%96%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E6%B3%95%E7%9A%84%E4%BC%98%E5%8A%BF">ä¸ºä½•ç”¨ Binder è€Œä¸ç”¨å…¶ä»–çš„æ–¹æ³•ï¼Ÿ</a></li><li><a href="#binder%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6">Binder çš„é€šä¿¡æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</a></li></ol><p>å¦å¤–ï¼Œæ¨èä¸¤ç¯‡æ–‡ç« ã€‚</p><p><a href="https://blog.csdn.net/universus/article/details/6211589">Binderè®¾è®¡ä¸å®ç°</a></p><p><a href="https://blog.csdn.net/luoshengyang/article/details/6618363">Androidè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æœºåˆ¶Binderç®€è¦ä»‹ç»å’Œå­¦ä¹ è®¡åˆ’</a></p><p>å…ˆçœ‹è¿™é‡Œï¼Œå†çœ‹è¿™ä¸¤ç¯‡æ–‡ç« ï¼Œåº”è¯¥å°±å·®ä¸å¤šäº†ã€‚</p><h2 id="å¤šè¿›ç¨‹é€šä¿¡çš„åŸç†"><a href="#å¤šè¿›ç¨‹é€šä¿¡çš„åŸç†" class="headerlink" title="å¤šè¿›ç¨‹é€šä¿¡çš„åŸç†"></a>å¤šè¿›ç¨‹é€šä¿¡çš„åŸç†</h2><p>å› ä¸º Android åŸºäº Linux ï¼Œæ‰€ä»¥è¦è°ˆå¤šè¿›è¡Œé€šä¿¡ï¼Œå°±å¿…é¡»è¦è°ˆåˆ° Linux ä¸‹çš„å¤šè¿›ç¨‹ã€‚</p><h3 id="è¿›ç¨‹éš”ç¦»"><a href="#è¿›ç¨‹éš”ç¦»" class="headerlink" title="è¿›ç¨‹éš”ç¦»"></a>è¿›ç¨‹éš”ç¦»</h3><blockquote><p>è¿›ç¨‹éš”ç¦»æ˜¯ä¸º<strong>ä¿æŠ¤æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹äº’ä¸å¹²æ‰°</strong>è€Œè®¾è®¡çš„ä¸€ç»„ä¸åŒç¡¬ä»¶å’Œè½¯ä»¶çš„æŠ€æœ¯ã€‚è¿™ä¸ªæŠ€æœ¯æ˜¯ä¸ºäº†é¿å…è¿›ç¨‹Aå†™å…¥è¿›ç¨‹Bçš„æƒ…å†µå‘ç”Ÿã€‚ è¿›ç¨‹çš„éš”ç¦»å®ç°ï¼Œä½¿ç”¨äº†<strong>è™šæ‹Ÿåœ°å€ç©ºé—´</strong>ã€‚è¿›ç¨‹Açš„è™šæ‹Ÿåœ°å€å’Œè¿›ç¨‹Bçš„è™šæ‹Ÿåœ°å€ä¸åŒï¼Œè¿™æ ·å°±é˜²æ­¢è¿›ç¨‹Aå°†æ•°æ®ä¿¡æ¯å†™å…¥è¿›ç¨‹Bã€‚</p></blockquote><p>ä»¥ä¸Šæ¥è‡ªç»´åŸºç™¾ç§‘ï¼›æ“ä½œç³»ç»Ÿçš„ä¸åŒè¿›ç¨‹ä¹‹é—´ï¼Œæ•°æ®ä¸å…±äº«ï¼›å¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è¯´ï¼Œå®ƒéƒ½å¤©çœŸåœ°ä»¥ä¸ºè‡ªå·±ç‹¬äº«äº†æ•´ä¸ªç³»ç»Ÿï¼Œå®Œå…¨ä¸çŸ¥é“å…¶ä»–è¿›ç¨‹çš„å­˜åœ¨ã€‚å› æ­¤ä¸€ä¸ªè¿›ç¨‹éœ€è¦ä¸å¦å¤–ä¸€ä¸ªè¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦æŸç§ç³»ç»Ÿæœºåˆ¶æ‰èƒ½å®Œæˆã€‚</p><h3 id="ç”¨æˆ·ç©ºé—´-å†…æ ¸ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´-å†…æ ¸ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´/å†…æ ¸ç©ºé—´"></a>ç”¨æˆ·ç©ºé—´/å†…æ ¸ç©ºé—´</h3><p>è¯¦ç»†è§£é‡Šå¯ä»¥å‚è€ƒ<a href="http://www.linfo.org/kernel_space.html">Kernel Space Definition</a>ï¼›ç®€å•ç†è§£å¦‚ä¸‹ï¼š</p><p>Linux Kernel æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œ<strong>å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´</strong>ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚</p><p>å¯¹äº Kernel è¿™ä¹ˆä¸€ä¸ªé«˜å®‰å…¨çº§åˆ«çš„ä¸œè¥¿ï¼Œæ˜¾ç„¶æ˜¯ä¸å®¹è®¸å…¶å®ƒçš„åº”ç”¨ç¨‹åºéšä¾¿è°ƒç”¨æˆ–è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å¯¹ Kernel æä¾›ä¸€å®šçš„ä¿æŠ¤æœºåˆ¶ï¼Œè¿™ä¸ªä¿æŠ¤æœºåˆ¶ç”¨æ¥å‘Šè¯‰é‚£äº›åº”ç”¨ç¨‹åºï¼Œä½ åªå¯ä»¥è®¿é—®æŸäº›è®¸å¯çš„èµ„æºï¼Œä¸è®¸å¯çš„èµ„æºæ˜¯æ‹’ç»è¢«è®¿é—®çš„ï¼Œäºæ˜¯å°±æŠŠKernelå’Œä¸Šå±‚çš„åº”ç”¨ç¨‹åºæŠ½è±¡åœ°éš”ç¦»å¼€ï¼Œåˆ†åˆ«ç§°ä¹‹ä¸º<strong>Kernel Spaceï¼ˆå†…æ ¸ç©ºé—´ï¼‰</strong> å’Œ <strong>User Spaceï¼ˆç”¨æˆ·ç©ºé—´ï¼‰</strong>ã€‚</p><h3 id="ç³»ç»Ÿè°ƒç”¨-å†…æ ¸æ€-ç”¨æˆ·æ€"><a href="#ç³»ç»Ÿè°ƒç”¨-å†…æ ¸æ€-ç”¨æˆ·æ€" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨/å†…æ ¸æ€/ç”¨æˆ·æ€"></a>ç³»ç»Ÿè°ƒç”¨/å†…æ ¸æ€/ç”¨æˆ·æ€</h3><p>è™½ç„¶ä»é€»è¾‘ä¸ŠæŠ½ç¦»å‡ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼›ä½†æ˜¯ä¸å¯é¿å…çš„çš„æ˜¯ï¼Œæ€»æœ‰é‚£ä¹ˆä¸€äº›ç”¨æˆ·ç©ºé—´éœ€è¦è®¿é—®å†…æ ¸çš„èµ„æºï¼›æ¯”å¦‚åº”ç”¨ç¨‹åºè®¿é—®æ–‡ä»¶ï¼Œç½‘ç»œæ˜¯å¾ˆå¸¸è§çš„äº‹æƒ…ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><blockquote><p>Kernel space can be accessed by user processes only through the use of system calls.</p></blockquote><p>ç”¨æˆ·ç©ºé—´è®¿é—®å†…æ ¸ç©ºé—´çš„å”¯ä¸€æ–¹å¼å°±æ˜¯<strong>ç³»ç»Ÿè°ƒç”¨</strong>ï¼›é€šè¿‡è¿™ä¸ªç»Ÿä¸€å…¥å£æ¥å£ï¼Œæ‰€æœ‰çš„èµ„æºè®¿é—®éƒ½æ˜¯åœ¨å†…æ ¸çš„æ§åˆ¶ä¸‹æ‰§è¡Œï¼Œä»¥å…å¯¼è‡´å¯¹ç”¨æˆ·ç¨‹åºå¯¹ç³»ç»Ÿèµ„æºçš„è¶Šæƒè®¿é—®ï¼Œä»è€Œä¿éšœäº†ç³»ç»Ÿçš„å®‰å…¨å’Œç¨³å®šã€‚ç”¨æˆ·è½¯ä»¶è‰¯è ä¸é½ï¼Œè¦æ˜¯å®ƒä»¬ä¹±ææŠŠç³»ç»Ÿç©åäº†æ€ä¹ˆåŠï¼Ÿå› æ­¤å¯¹äºæŸäº›ç‰¹æƒæ“ä½œå¿…é¡»äº¤ç»™å®‰å…¨å¯é çš„å†…æ ¸æ¥æ‰§è¡Œã€‚</p><p>å½“ä¸€ä¸ªä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰æ‰§è¡Œç³»ç»Ÿè°ƒç”¨è€Œé™·å…¥å†…æ ¸ä»£ç ä¸­æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¿›ç¨‹å¤„äº<strong>å†…æ ¸è¿è¡Œæ€</strong>ï¼ˆæˆ–ç®€ç§°ä¸º<strong>å†…æ ¸æ€</strong>ï¼‰æ­¤æ—¶å¤„ç†å™¨å¤„äºç‰¹æƒçº§æœ€é«˜çš„ï¼ˆ0çº§ï¼‰å†…æ ¸ä»£ç ä¸­æ‰§è¡Œã€‚å½“è¿›ç¨‹åœ¨æ‰§è¡Œç”¨æˆ·è‡ªå·±çš„ä»£ç æ—¶ï¼Œåˆ™ç§°å…¶å¤„äº<strong>ç”¨æˆ·è¿è¡Œæ€</strong>ï¼ˆç”¨æˆ·æ€ï¼‰ã€‚å³æ­¤æ—¶å¤„ç†å™¨åœ¨ç‰¹æƒçº§æœ€ä½çš„ï¼ˆ3çº§ï¼‰ç”¨æˆ·ä»£ç ä¸­è¿è¡Œã€‚å¤„ç†å™¨åœ¨ç‰¹æƒç­‰çº§é«˜çš„æ—¶å€™æ‰èƒ½æ‰§è¡Œé‚£äº›ç‰¹æƒCPUæŒ‡ä»¤ã€‚</p><h3 id="å†…æ ¸æ¨¡å—-é©±åŠ¨"><a href="#å†…æ ¸æ¨¡å—-é©±åŠ¨" class="headerlink" title="å†…æ ¸æ¨¡å—/é©±åŠ¨"></a>å†…æ ¸æ¨¡å—/é©±åŠ¨</h3><p>é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥è®¿é—®å†…æ ¸ç©ºé—´ï¼Œé‚£ä¹ˆå¦‚æœä¸€ä¸ªç”¨æˆ·ç©ºé—´æƒ³ä¸å¦å¤–ä¸€ä¸ªç”¨æˆ·ç©ºé—´è¿›è¡Œé€šä¿¡æ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆè‡ªç„¶æƒ³åˆ°çš„æ˜¯è®©æ“ä½œç³»ç»Ÿå†…æ ¸æ·»åŠ æ”¯æŒï¼›ä¼ ç»Ÿçš„ Linux é€šä¿¡æœºåˆ¶ï¼Œæ¯”å¦‚ Socket ï¼Œç®¡é“ç­‰éƒ½æ˜¯å†…æ ¸æ”¯æŒçš„ï¼›ä½†æ˜¯ Binder å¹¶ä¸æ˜¯ Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯æ€ä¹ˆåšåˆ°è®¿é—®å†…æ ¸ç©ºé—´çš„å‘¢ï¼ŸLinux çš„åŠ¨æ€å¯åŠ è½½å†…æ ¸æ¨¡å—ï¼ˆLoadable Kernel Moduleï¼ŒLKMï¼‰æœºåˆ¶è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>æ¨¡å—</strong>æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºï¼Œå®ƒå¯ä»¥è¢«å•ç‹¬ç¼–è¯‘ï¼Œä½†ä¸èƒ½ç‹¬ç«‹è¿è¡Œã€‚å®ƒåœ¨è¿è¡Œæ—¶è¢«é“¾æ¥åˆ°å†…æ ¸ä½œä¸ºå†…æ ¸çš„ä¸€éƒ¨åˆ†åœ¨å†…æ ¸ç©ºé—´è¿è¡Œã€‚è¿™æ ·ï¼ŒAndroidç³»ç»Ÿå¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªå†…æ ¸æ¨¡å—è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œç”¨æˆ·è¿›ç¨‹ä¹‹é—´çš„é€šè¿‡è¿™ä¸ªæ¨¡å—ä½œä¸ºæ¡¥æ¢ï¼Œå°±å¯ä»¥å®Œæˆé€šä¿¡äº†ã€‚</p><p>åœ¨ Android ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªè¿è¡Œåœ¨å†…æ ¸ç©ºé—´çš„ï¼Œè´Ÿè´£å„ä¸ªç”¨æˆ·è¿›ç¨‹é€šè¿‡ Binder é€šä¿¡çš„å†…æ ¸æ¨¡å—å«åš <strong>Binderé©±åŠ¨</strong>;</p><p>é©±åŠ¨ç¨‹åºä¸€èˆ¬æŒ‡çš„æ˜¯è®¾å¤‡é©±åŠ¨ç¨‹åºï¼ˆDevice Driverï¼‰ï¼Œæ˜¯ä¸€ç§å¯ä»¥ä½¿è®¡ç®—æœºå’Œè®¾å¤‡é€šä¿¡çš„ç‰¹æ®Šç¨‹åºã€‚ç›¸å½“äºç¡¬ä»¶çš„æ¥å£ï¼Œæ“ä½œç³»ç»Ÿåªæœ‰é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæ‰èƒ½æ§åˆ¶ç¡¬ä»¶è®¾å¤‡çš„å·¥ä½œã€‚</p><p>é©±åŠ¨å°±æ˜¯æ“ä½œç¡¬ä»¶çš„æ¥å£ï¼Œä¸ºäº†æ”¯æŒ Binder é€šä¿¡è¿‡ç¨‹ï¼ŒBinder ä½¿ç”¨äº†ä¸€ç§ã€ç¡¬ä»¶ã€ï¼Œå› æ­¤è¿™ä¸ªæ¨¡å—è¢«ç§°ä¹‹ä¸º Binder é©±åŠ¨ã€‚</p><h2 id="Binderä»‹ç»"><a href="#Binderä»‹ç»" class="headerlink" title="Binderä»‹ç»"></a>Binderä»‹ç»</h2><p>Binder çš„è®¾è®¡é‡‡ç”¨äº†é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚</p><p>Binder çš„é€šä¿¡æ¨¡å‹æœ‰ 4 ä¸ªè§’è‰²ï¼š<strong>Client</strong>ã€<strong>Server</strong>ã€<strong>Binder Driverï¼ˆBinder é©±åŠ¨ï¼‰</strong>ã€<strong>ServiceManager</strong>ã€‚</p><p>æƒ³è±¡ä¸€ä¸ªæƒ…æ™¯ï¼šç°åœ¨æˆ‘è¦ç»™æˆ‘çš„ä¸€ä¸ªåŒå­¦å¯„ä¸€å°ä¿¡ï¼Œä¿¡ä¸Šè¦æ ‡æ˜æ”¶ä¿¡åœ°å€ã€‚é‚£æˆ‘æ€ä¹ˆæ‹¿åˆ°è¿™ä¸ªåœ°å€å‘¢ï¼Ÿå»ç¿»ä¸€ä¸‹æˆ‘çš„æ¯•ä¸šç›¸å†Œã€‚è€Œè¿™ä¸ªè®°å½•ç€åŒå­¦ä»¬é€šä¿¡åœ°å€çš„æ¯•ä¸šç›¸å†Œï¼Œå°±ç›¸å½“äºä¸€ä¸ªé€šè®¯å½•ã€‚å®ƒåœ¨ Binder çš„é€šä¿¡æ¨¡å‹ä¸­æ‰®æ¼”çš„æ˜¯ ServiceManager çš„è§’è‰²ã€‚</p><p>å½“æœ‰äº†æ”¶ä¿¡åœ°å€ä¹‹åï¼Œæ‰¾åˆ°é‚®å±€å¯„å‡ºå»å°±å¥½äº†ã€‚è¿‡å‡ å¤©åŒå­¦å°±æ”¶åˆ°äº†æ˜ä¿¡ç‰‡ã€‚é‚£ä¹ˆè¿™ä¸ªé‚®å±€åœ¨ Binder é€šä¿¡æ¨¡å‹ä¸­æ‰®æ¼”çš„æ˜¯ Binder Driver çš„è§’è‰²ï¼Œè€Œä½œä¸ºå¯„ä¿¡äººçš„æˆ‘å°±æ˜¯ Clientï¼Œæ”¶ä¿¡äººåŒå­¦å°±æ˜¯ Serverã€‚</p><p>ä¸Šé¢çš„ä¾‹å­å¯ä»¥å˜æˆä¸‹é¢è¿™ä¸ªæ¨¡å‹å›¾ï¼š</p><div class="center-img"><p><img src="/img/7.png" alt="Binderé€šä¿¡æ¨¡å‹å›¾"></p></div><p>åœ¨ Binder é€šä¿¡æ¨¡å‹çš„å››ä¸ªè§’è‰²é‡Œé¢ï¼Œä»–ä»¬çš„ä»£è¡¨éƒ½æ˜¯ã€Binderã€ï¼Œè¿™æ ·ï¼Œå¯¹äº Binder é€šä¿¡çš„ä½¿ç”¨è€…è€Œè¨€ï¼ŒServer é‡Œé¢çš„ Binder å’Œ Client é‡Œé¢çš„ Binder æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä¸€ä¸ª Binder å¯¹è±¡å°±ä»£è¡¨äº†æ‰€æœ‰ï¼Œå®ƒä¸ç”¨å…³å¿ƒå®ç°çš„ç»†èŠ‚ï¼Œç”šè‡³ä¸ç”¨å…³å¿ƒé©±åŠ¨ä»¥åŠ ServiceManager çš„å­˜åœ¨ï¼šè¿™å°±æ˜¯æŠ½è±¡ã€‚</p><ul><li>é€šå¸¸æ„ä¹‰ä¸‹ï¼Œ Binder æŒ‡çš„æ˜¯ä¸€ç§é€šä¿¡æœºåˆ¶ï¼›æˆ‘ä»¬è¯´ AIDL ä½¿ç”¨ Binder è¿›è¡Œé€šä¿¡ï¼ŒæŒ‡çš„å°±æ˜¯ Binder è¿™ç§è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚</li><li>å¯¹äº Server è¿›ç¨‹æ¥è¯´ï¼Œ Binder æŒ‡çš„æ˜¯ Binder æœ¬åœ°å¯¹è±¡ã€‚</li><li>å¯¹äº Client æ¥è¯´ï¼Œ Binder æŒ‡çš„æ˜¯ Binder ä»£ç†å¯¹è±¡ï¼Œå®ƒåªæ˜¯ Binder æœ¬åœ°å¯¹è±¡çš„ä¸€ä¸ªè¿œç¨‹ä»£ç†ï¼›å¯¹è¿™ä¸ª Binder ä»£ç†å¯¹è±¡çš„æ“ä½œï¼Œä¼šé€šè¿‡é©±åŠ¨æœ€ç»ˆè½¬å‘åˆ° Binder æœ¬åœ°å¯¹è±¡ä¸Šå»å®Œæˆï¼›å¯¹äºä¸€ä¸ªæ‹¥æœ‰ Binder å¯¹è±¡çš„ä½¿ç”¨è€…è€Œè¨€ï¼Œå®ƒæ— é¡»å…³å¿ƒè¿™æ˜¯ä¸€ä¸ª Binder ä»£ç†å¯¹è±¡è¿˜æ˜¯ Binder æœ¬åœ°å¯¹è±¡ï¼›å¯¹äºä»£ç†å¯¹è±¡çš„æ“ä½œå’Œå¯¹æœ¬åœ°å¯¹è±¡çš„æ“ä½œå¯¹å®ƒæ¥è¯´æ²¡æœ‰åŒºåˆ«ã€‚</li><li>å¯¹äºä¼ è¾“è¿‡ç¨‹è€Œè¨€ï¼Œ Binder æ˜¯å¯ä»¥è¿›è¡Œè·¨è¿›ç¨‹ä¼ é€’çš„å¯¹è±¡ï¼› Binder é©±åŠ¨ä¼šå¯¹å…·æœ‰è·¨è¿›ç¨‹ä¼ é€’èƒ½åŠ›çš„å¯¹è±¡åšç‰¹æ®Šå¤„ç†ï¼šè‡ªåŠ¨å®Œæˆä»£ç†å¯¹è±¡å’Œæœ¬åœ°å¯¹è±¡çš„è½¬æ¢ã€‚</li></ul><blockquote><p>é¢å‘å¯¹è±¡æ€æƒ³çš„å¼•å…¥å°†è¿›ç¨‹é—´é€šä¿¡è½¬åŒ–ä¸ºé€šè¿‡å¯¹æŸä¸ª Binder å¯¹è±¡çš„å¼•ç”¨è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œå…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äº Binder å¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥è·¨è¿›ç¨‹å¼•ç”¨çš„å¯¹è±¡ï¼Œå®ƒçš„å®ä½“ï¼ˆæœ¬åœ°å¯¹è±¡ï¼‰ä½äºä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œå®ƒçš„å¼•ç”¨ï¼ˆä»£ç†å¯¹è±¡ï¼‰å´éå¸ƒäºç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ä¹‹ä¸­ã€‚æœ€è¯±äººçš„æ˜¯ï¼Œè¿™ä¸ªå¼•ç”¨å’Œ java é‡Œå¼•ç”¨ä¸€æ ·æ—¢å¯ä»¥æ˜¯<strong>å¼ºç±»å‹</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯<strong>å¼±ç±»å‹</strong>ï¼Œè€Œä¸”å¯ä»¥ä»ä¸€ä¸ªè¿›ç¨‹ä¼ ç»™å…¶å®ƒè¿›ç¨‹ï¼Œè®©å¤§å®¶éƒ½èƒ½è®¿é—®åŒä¸€ Server ï¼Œå°±è±¡å°†ä¸€ä¸ªå¯¹è±¡æˆ–å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå¼•ç”¨ä¸€æ ·ã€‚ Binder æ¨¡ç³Šäº†è¿›ç¨‹è¾¹ç•Œï¼Œæ·¡åŒ–äº†è¿›ç¨‹é—´é€šä¿¡è¿‡ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä»¿ä½›è¿è¡ŒäºåŒä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºä¹‹ä¸­ã€‚å½¢å½¢è‰²è‰²çš„ Binder å¯¹è±¡ä»¥åŠæ˜Ÿç½—æ£‹å¸ƒçš„å¼•ç”¨ä»¿ä½›ç²˜æ¥å„ä¸ªåº”ç”¨ç¨‹åºçš„èƒ¶æ°´ï¼Œè¿™ä¹Ÿæ˜¯ Binder åœ¨è‹±æ–‡é‡Œçš„åŸæ„ã€‚</p></blockquote><h2 id="Binderå¯¹æ¯”å…¶ä»–è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•çš„ä¼˜åŠ¿"><a href="#Binderå¯¹æ¯”å…¶ä»–è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•çš„ä¼˜åŠ¿" class="headerlink" title="Binderå¯¹æ¯”å…¶ä»–è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•çš„ä¼˜åŠ¿"></a>Binderå¯¹æ¯”å…¶ä»–è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•çš„ä¼˜åŠ¿</h2><p>è®©æˆ‘ä»¬å¸¦ç€é—®é¢˜å»çœ‹è¿™ä¸€æ®µã€‚</p><blockquote><p>Linuxä¸‹æœ‰é‚£ä¹ˆå¤šè¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œä¸ºä»€ä¹ˆ Android ååé€‰æ‹©äº†ç”¨ Binderï¼Ÿ</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Linuxä¸‹éƒ½æœ‰å“ªäº›è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</p><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="1-Pipelineï¼ˆç®¡é“ï¼‰"><a href="#1-Pipelineï¼ˆç®¡é“ï¼‰" class="headerlink" title="1. Pipelineï¼ˆç®¡é“ï¼‰"></a>1. Pipelineï¼ˆç®¡é“ï¼‰</h4><p>ç®¡é“ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œç”±æ¥å·²ä¹…ã€‚ä¹ŸåŸºæœ¬ä¸Šæ˜¯Linuxä¸­ä½¿ç”¨å¾—æœ€å¤šçš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</p><pre><code class="bash">$history | grep &#39;gradlew&#39;</code></pre><p>ä¸Šé¢çš„ä»£ç å°±å®Œæˆäº†ä¸€æ¬¡æœ€ç®€å•çš„ç®¡é“é€šä¿¡æ–¹å¼ã€‚<code>history</code>è¿›ç¨‹å°†è‡ªå·±çš„è¾“å‡ºç»“æœæ”¾å…¥ç®¡é“ï¼Œ<code>grep</code>è¿›ç¨‹ä»ä¸­å–å‡ºç»“æœï¼Œå¹¶è¿›è¡Œç­›é€‰ï¼Œå¾—å‡ºæˆ‘ä»¬æœ€åæƒ³è¦çš„ç»“æœã€‚</p><p>è¿™ä¸ªæ˜¯<strong>åŒ¿åç®¡é“</strong>æœ€ç®€å•çš„ä¾‹å­ï¼Œç®¡é“åˆåˆ†ä¸º<a href="https://en.wikipedia.org/wiki/Named_pipe"><strong>æœ‰åç®¡é“</strong></a>å’Œ<a href="https://en.wikipedia.org/wiki/Anonymous_pipe"><strong>åŒ¿åç®¡é“</strong></a>ï¼Œå°±ä¸åœ¨è¿™é‡Œè¯¦ç»†å±•å¼€äº†ã€‚</p><p>ç®¡é“çš„é€šä¿¡æ¨¡å‹å¦‚ä¸‹å›¾ï¼š</p><div class="center-img"><p><img src="/img/8.png" alt="ç®¡ç†é€šä¿¡æ¨¡å‹"></p></div><p>ç®¡é“å¯ç”¨äºè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œç®¡é“æ˜¯ç”±å†…æ ¸ç®¡ç†çš„ä¸€ä¸ªç¼“å­˜åŒºï¼Œ ç›¸å½“äºæˆ‘ä»¬æ”¾å…¥å†…å­˜ä¸­çš„ä¸€ä¸ª<strong>çº¸æ¡</strong>ã€‚ç®¡é“çš„ä¸€ç«¯è¿æ¥ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šå‘ç®¡é“ä¸­æ”¾å…¥ä¿¡æ¯ã€‚å¦ä¸€ç«¯è¿æ¥ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œè¿™ä¸ªè¿›ç¨‹å–å‡ºè¢«æ”¾å…¥ç®¡é“çš„ä¿¡æ¯ã€‚</p><p>è¿™ä¸ªç¼“å­˜åŒºä¸éœ€è¦å¾ˆå¤§ï¼Œåœ¨ Linux ä¸­ï¼Œé»˜è®¤çš„ç®¡é“ç©ºé—´å¤§å°æ˜¯ <a href="https://en.wikipedia.org/w/index.php?title=Pipeline_(Unix)#Implementation">64KB</a>ã€‚å½“ç®¡é“ä¸­æ²¡æœ‰ä¿¡æ¯çš„è¯ï¼Œä»ç®¡é“ä¸­è¯»å–çš„è¿›ç¨‹ä¼šç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ç«¯çš„è¿›ç¨‹æ”¾å…¥ä¿¡æ¯ã€‚å½“ç®¡é“è¢«æ”¾æ»¡ä¿¡æ¯çš„æ—¶å€™ï¼Œå°è¯•æ”¾å…¥ä¿¡æ¯çš„è¿›ç¨‹ä¼šç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ç«¯çš„è¿›ç¨‹å–å‡ºä¿¡æ¯ã€‚å½“ä¸¤ä¸ªè¿›ç¨‹éƒ½ç»ˆç»“çš„æ—¶å€™ï¼Œç®¡é“ä¹Ÿè‡ªåŠ¨æ¶ˆå¤±ã€‚</p><p><strong>ç¼ºç‚¹</strong>: åœ¨åˆ›å»ºæ—¶åˆ†é…ä¸€ä¸ªç®¡é“æ—¶ï¼Œç¼“å­˜åŒºå¤§å°æ¯”è¾ƒæœ‰é™ï¼›å¹¶ä¸é€‚åˆ Android å¤§é‡çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</p><h4 id="2-Message-Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰"><a href="#2-Message-Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰" class="headerlink" title="2. Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰"></a>2. Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</h4><p>æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†ä¸€ç§ä»ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªæ•°æ®å—çš„æ–¹æ³•ã€‚æ¯ä¸ªæ•°æ®å—éƒ½è¢«è®¤ä¸ºå«æœ‰ä¸€ä¸ªç±»å‹ï¼Œæ¥æ”¶è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°æ¥æ”¶å«æœ‰ä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€æ¶ˆæ¯æ¥é¿å…å‘½åç®¡é“çš„åŒæ­¥å’Œé˜»å¡é—®é¢˜ã€‚ä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸å‘½åç®¡é“ä¸€æ ·ï¼Œæ¯ä¸ªæ•°æ®å—éƒ½æœ‰ä¸€ä¸ªæœ€å¤§é•¿åº¦çš„é™åˆ¶ã€‚</p><p><span style="color: green">#TODO æ—¥åè¯¦ç»†å±•å¼€</span></p><p><strong>ç¼ºç‚¹</strong>: ä¿¡æ¯å¤åˆ¶ä¸¤æ¬¡ï¼Œé¢å¤–çš„ CPU æ¶ˆè€—ï¼›ä¸åˆé€‚é¢‘ç¹æˆ–ä¿¡æ¯é‡å¤§çš„é€šä¿¡ã€‚</p><h4 id="3-Shared-Memoryï¼ˆå…±äº«å†…å­˜ï¼‰"><a href="#3-Shared-Memoryï¼ˆå…±äº«å†…å­˜ï¼‰" class="headerlink" title="3. Shared Memoryï¼ˆå…±äº«å†…å­˜ï¼‰"></a>3. Shared Memoryï¼ˆå…±äº«å†…å­˜ï¼‰</h4><p>é¡¾åæ€ä¹‰ï¼Œå…±äº«å†…å­˜å°±æ˜¯å…è®¸ä¸¤ä¸ªä¸ç›¸å…³çš„è¿›ç¨‹è®¿é—®åŒä¸€ä¸ªé€»è¾‘å†…å­˜ã€‚å…±äº«å†…å­˜æ˜¯åœ¨ä¸¤ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¹‹é—´å…±äº«å’Œä¼ é€’æ•°æ®çš„ä¸€ç§éå¸¸æœ‰æ•ˆçš„æ–¹å¼ã€‚ä¸åŒè¿›ç¨‹ä¹‹é—´å…±äº«çš„å†…å­˜é€šå¸¸å®‰æ’ä¸ºåŒä¸€æ®µç‰©ç†å†…å­˜ã€‚è¿›ç¨‹å¯ä»¥å°†åŒä¸€æ®µå…±äº«å†…å­˜è¿æ¥åˆ°å®ƒä»¬è‡ªå·±çš„åœ°å€ç©ºé—´ä¸­ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½å¯ä»¥è®¿é—®å…±äº«å†…å­˜ä¸­çš„åœ°å€ã€‚</p><p><span style="color: green">#TODO æ—¥åè¯¦ç»†å±•å¼€</span></p><p><strong>ä¼˜ç‚¹</strong>ï¼š<strong>æ— é¡»å¤åˆ¶</strong>ï¼Œå…±äº«ç¼“å†²åŒºç›´æ¥ä»˜é™„åŠ åˆ°è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé€Ÿåº¦å¿«ï¼›<br><strong>ç¼ºç‚¹</strong>ï¼šè¿›ç¨‹é—´çš„åŒæ­¥é—®é¢˜æ“ä½œç³»ç»Ÿæ— æ³•å®ç°ï¼Œå¿…é¡»å„è¿›ç¨‹åˆ©ç”¨åŒæ­¥å·¥å…·è§£å†³ã€‚åŒæ—¶ï¼Œå®‰å…¨é—®é¢˜ä¹Ÿæ¯”è¾ƒçªå‡ºï¼Œå¦‚æœ Android é‡‡ç”¨å…±äº«å†…å­˜æ— å¼‚äºå°†æ¯ä¸ª App æ”¾åœ¨ä¸€ä¸ªå†…å­˜ä¸­ï¼Œè¿™æ ·æ˜¯éå¸¸ä¸å®‰å…¨çš„ã€‚</p><h4 id="4-Socketï¼ˆå¥—æ¥å­—ï¼‰"><a href="#4-Socketï¼ˆå¥—æ¥å­—ï¼‰" class="headerlink" title="4. Socketï¼ˆå¥—æ¥å­—ï¼‰"></a>4. Socketï¼ˆå¥—æ¥å­—ï¼‰</h4><p>é€šå¸¸ä½œä¸ºæ›´é€šç”¨çš„æ¥å£ï¼Œä¼ è¾“æ•ˆç‡ä½ï¼Œä¸»è¦ç”¨äºä¸åŒæœºå™¨æˆ–è·¨ç½‘ç»œçš„é€šä¿¡ã€‚</p><p><span style="color: green">#TODO æ—¥åè¯¦ç»†å±•å¼€</span></p><h4 id="5-Semaphoreï¼ˆä¿¡å·é‡ï¼‰"><a href="#5-Semaphoreï¼ˆä¿¡å·é‡ï¼‰" class="headerlink" title="5. Semaphoreï¼ˆä¿¡å·é‡ï¼‰"></a>5. Semaphoreï¼ˆä¿¡å·é‡ï¼‰</h4><p>å¸¸ä½œä¸ºä¸€ç§é”æœºåˆ¶ï¼Œé˜²æ­¢æŸè¿›ç¨‹æ­£åœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿè®¿é—®è¯¥èµ„æºã€‚å› æ­¤ï¼Œä¸»è¦ä½œä¸ºè¿›ç¨‹é—´ä»¥åŠåŒä¸€è¿›ç¨‹å†…ä¸åŒçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ‰‹æ®µï¼Œå¹¶ä¸å¤ªé€‚åˆ Android çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</p><h4 id="6-Signalï¼ˆä¿¡å·ï¼‰"><a href="#6-Signalï¼ˆä¿¡å·ï¼‰" class="headerlink" title="6. Signalï¼ˆä¿¡å·ï¼‰"></a>6. Signalï¼ˆä¿¡å·ï¼‰</h4><p>é€‚ç”¨äº<strong>è¿›ç¨‹ä¸­æ–­æ§åˆ¶</strong>ï¼Œæ¯”å¦‚éæ³•å†…å­˜è®¿é—®ï¼Œæ€æ­»æŸä¸ªè¿›ç¨‹ç­‰ï¼›</p><p><strong>ç¼ºç‚¹</strong>ï¼šä¸é€‚ç”¨äºä¿¡æ¯äº¤æ¢ã€‚</p><h3 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h3><ul><li><p>ä»æ€§èƒ½çš„è§’åº¦</p><p>  æ•°æ®æ‹·è´æ¬¡æ•°ï¼šBinderæ•°æ®æ‹·è´<strong>åªéœ€è¦ä¸€æ¬¡</strong>ï¼Œè€Œç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Socket éƒ½éœ€è¦2æ¬¡ï¼Œä½†å…±äº«å†…å­˜æ–¹å¼ä¸€æ¬¡å†…å­˜æ‹·è´éƒ½ä¸éœ€è¦ï¼›ä»æ€§èƒ½è§’åº¦çœ‹ï¼ŒBinder æ€§èƒ½ä»…æ¬¡äºå…±äº«å†…å­˜ã€‚</p></li><li><p>ä»ç¨³å®šæ€§çš„è§’åº¦</p><p>  Binder æ˜¯<strong>åŸºäº C/S æ¶æ„</strong>çš„ã€‚ç®€å•è§£é‡Šä¸‹ C/S æ¶æ„ï¼Œæ˜¯æŒ‡å®¢æˆ·ç«¯ï¼ˆClientï¼‰å’ŒæœåŠ¡ç«¯ï¼ˆServerï¼‰ç»„æˆçš„æ¶æ„ï¼ŒClient ç«¯æœ‰ä»€ä¹ˆéœ€æ±‚ï¼Œç›´æ¥å‘é€ç»™ Server ç«¯å»å®Œæˆï¼Œæ¶æ„æ¸…æ™°æ˜æœ—ï¼ŒServer ç«¯ä¸ Client ç«¯ç›¸å¯¹ç‹¬ç«‹ï¼Œç¨³å®šæ€§è¾ƒå¥½ï¼›è€Œå…±äº«å†…å­˜å®ç°æ–¹å¼å¤æ‚ï¼Œæ²¡æœ‰å®¢æˆ·ä¸æœåŠ¡ç«¯ä¹‹åˆ«ï¼Œéœ€è¦å……åˆ†è€ƒè™‘åˆ°è®¿é—®ä¸´ç•Œèµ„æºçš„å¹¶å‘åŒæ­¥é—®é¢˜ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ­»é”ç­‰é—®é¢˜ï¼›ä»è¿™ç¨³å®šæ€§è§’åº¦çœ‹ï¼ŒBinder æ¶æ„ä¼˜è¶Šäºå…±äº«å†…å­˜ã€‚</p></li></ul><p>ä»…ä»…ä»ä»¥ä¸Šä¸¤ç‚¹ï¼Œå„æœ‰ä¼˜åŠ£ï¼Œè¿˜ä¸è¶³ä»¥æ”¯æ’‘ Google å»é‡‡ç”¨ Binder ä½œä¸º IPC æœºåˆ¶ï¼Œé‚£ä¹ˆæ›´é‡è¦çš„åŸå› æ˜¯â€”â€”</p><ul><li><p>ä»å®‰å…¨çš„è§’åº¦</p><p>  ä¼ ç»Ÿ Linux IPC çš„æ¥æ”¶æ–¹æ— æ³•è·å¾—å¯¹æ–¹è¿›ç¨‹å¯é çš„ UID/PIDï¼Œä»è€Œæ— æ³•é‰´åˆ«å¯¹æ–¹èº«ä»½ï¼›è€Œ Android ä½œä¸ºä¸€ä¸ªå¼€æ”¾çš„å¼€æºä½“ç³»ï¼Œæ‹¥æœ‰éå¸¸å¤šçš„å¼€å‘å¹³å°ï¼ŒApp æ¥æºç”šå¹¿ï¼Œå› æ­¤æ‰‹æœºçš„å®‰å…¨æ˜¾å¾—é¢å¤–é‡è¦ï¼›å¯¹äºæ™®é€šç”¨æˆ·ï¼Œç»ä¸å¸Œæœ›ä» App å•†åº—ä¸‹è½½å·çª¥éšç§æ•°æ®ã€åå°é€ æˆæ‰‹æœºè€—ç”µç­‰ç­‰é—®é¢˜ï¼Œä¼ ç»Ÿ Linux IPC æ— ä»»ä½•ä¿æŠ¤æªæ–½ï¼Œå®Œå…¨ç”±ä¸Šå±‚åè®®æ¥ç¡®ä¿ã€‚Android <strong>ä¸ºæ¯ä¸ªå®‰è£…å¥½çš„åº”ç”¨ç¨‹åºåˆ†é…äº†è‡ªå·±çš„ UID</strong>ï¼Œæ•…è¿›ç¨‹çš„ UID æ˜¯é‰´åˆ«è¿›ç¨‹èº«ä»½çš„é‡è¦æ ‡å¿—ï¼Œå‰é¢æåˆ° C/S æ¶æ„ï¼ŒAndroid ç³»ç»Ÿä¸­å¯¹å¤–åªæš´éœ² Client ç«¯ï¼ŒClient ç«¯å°†ä»»åŠ¡å‘é€ç»™ Server ç«¯ï¼ŒServer ç«¯ä¼šæ ¹æ®æƒé™æ§åˆ¶ç­–ç•¥ï¼Œåˆ¤æ–­ UID/PID æ˜¯å¦æ»¡è¶³è®¿é—®æƒé™ï¼Œç›®å‰æƒé™æ§åˆ¶å¾ˆå¤šæ—¶å€™æ˜¯é€šè¿‡å¼¹å‡ºæƒé™è¯¢é—®å¯¹è¯æ¡†ï¼Œè®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦è¿è¡Œã€‚</p></li><li><p>ä»è¯­è¨€å±‚é¢çš„è§’åº¦</p><p>  å¤§å®¶å¤šçŸ¥é“ Linux æ˜¯åŸºäº C è¯­è¨€ï¼ˆé¢å‘è¿‡ç¨‹çš„è¯­è¨€ï¼‰ï¼Œè€Œ Android æ˜¯åŸºäº Java è¯­è¨€ï¼ˆé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼‰ï¼Œè€Œå¯¹äº Binder æ°æ°ä¹Ÿç¬¦åˆé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œå°†è¿›ç¨‹é—´é€šä¿¡è½¬åŒ–ä¸ºé€šè¿‡å¯¹æŸä¸ª Binder å¯¹è±¡çš„å¼•ç”¨è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œå…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äº Binder å¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥<strong>è·¨è¿›ç¨‹å¼•ç”¨</strong>çš„å¯¹è±¡ï¼Œå®ƒçš„å®ä½“ä½äºä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œå®ƒçš„å¼•ç”¨å´éå¸ƒäºç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ä¹‹ä¸­ã€‚å¯ä»¥ä»ä¸€ä¸ªè¿›ç¨‹ä¼ ç»™å…¶å®ƒè¿›ç¨‹ï¼Œè®©å¤§å®¶éƒ½èƒ½è®¿é—®åŒä¸€ Serverï¼Œå°±åƒå°†ä¸€ä¸ªå¯¹è±¡æˆ–å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå¼•ç”¨ä¸€æ ·ã€‚</p><p>  Binder æ¨¡ç³Šäº†è¿›ç¨‹è¾¹ç•Œï¼Œæ·¡åŒ–äº†è¿›ç¨‹é—´é€šä¿¡è¿‡ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä»¿ä½›è¿è¡ŒäºåŒä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºä¹‹ä¸­ã€‚ä»è¯­è¨€å±‚é¢ï¼ŒBinder æ›´é€‚åˆåŸºäºé¢å‘å¯¹è±¡è¯­è¨€çš„ Android ç³»ç»Ÿï¼Œå¯¹äºLinuxç³»ç»Ÿå¯èƒ½ä¼šæœ‰ç‚¹ã€æ°´åœŸä¸æœã€ã€‚å¦å¤–ï¼ŒBinder æ˜¯ä¸º Android è¿™ç±»ç³»ç»Ÿè€Œç”Ÿï¼Œè€Œå¹¶é Linux ç¤¾åŒºæ²¡æœ‰æƒ³åˆ° Binder IPC æœºåˆ¶çš„å­˜åœ¨ï¼Œä¹Ÿå¹¶é Linux ç°æœ‰çš„ IPC æœºåˆ¶ä¸å¤Ÿå¥½ï¼Œç›¸ååœ°ï¼Œç»è¿‡è¿™ä¹ˆå¤šä¼˜ç§€å·¥ç¨‹å¸ˆçš„ä¸æ–­æ‰“ç£¨ï¼Œä¾ç„¶éå¸¸ä¼˜ç§€ï¼Œæ¯ç§ Linux çš„ IPC æœºåˆ¶éƒ½æœ‰å…¶å­˜åœ¨çš„ä»·å€¼ï¼ŒåŒæ—¶åœ¨ Android ç³»ç»Ÿä¸­ä¹Ÿä¾ç„¶é‡‡ç”¨äº†å¤§é‡ Linux ç°æœ‰çš„ IPC æœºåˆ¶ï¼Œæ ¹æ®æ¯ç±» IPC çš„åŸç†ç‰¹æ€§ï¼Œå› åœ°åˆ¶å®œï¼Œä¸åŒåœºæ™¯ç‰¹æ€§å¾€å¾€ä¼šé‡‡ç”¨å…¶ä¸‹æœ€é€‚å®œçš„ã€‚æ¯”å¦‚åœ¨ Android ä¸­çš„ Zygote è¿›ç¨‹çš„ IPC é‡‡ç”¨çš„æ˜¯ Socket æœºåˆ¶ï¼ŒAndroid ä¸­çš„ Kill Process é‡‡ç”¨çš„ Signal æœºåˆ¶ç­‰ç­‰ã€‚è€Œ Binder æ›´å¤šåˆ™ç”¨åœ¨ system_server è¿›ç¨‹ä¸ä¸Šå±‚ App å±‚çš„ IPC äº¤äº’ã€‚</p></li><li><p>ä»å…¬å¸æˆ˜ç•¥çš„è§’åº¦</p><p>  ä¼—æ‰€å‘¨çŸ¥ï¼ŒLinux å†…æ ¸æ˜¯å¼€æºçš„ç³»ç»Ÿï¼Œæ‰€å¼€æ”¾æºä»£ç è®¸å¯åè®®ç”± GPL ä¿æŠ¤ï¼Œè¯¥åè®®å…·æœ‰ã€ç—…æ¯’å¼æ„ŸæŸ“ã€çš„èƒ½åŠ›ã€‚</p><p>  æ€ä¹ˆç†è§£è¿™å¥è¯å‘¢ï¼Ÿå— GPL ä¿æŠ¤çš„ Linux Kernel æ˜¯è¿è¡Œåœ¨<strong>å†…æ ¸ç©ºé—´</strong>ï¼Œå¯¹äºä¸Šå±‚çš„ä»»ä½•ç±»åº“ã€æœåŠ¡ã€åº”ç”¨ç­‰è¿è¡Œåœ¨<strong>ç”¨æˆ·ç©ºé—´</strong>ï¼Œä¸€æ—¦è¿›è¡Œ System Callï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œè°ƒç”¨åˆ°åº•å±‚ Kernelï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»éµå¾ª GPL åè®®ã€‚ è€Œ Android ä¹‹çˆ¶ Andy Rubin å¯¹äº GPL æ˜¾ç„¶æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œä¸ºæ­¤ï¼ŒGoogle å·§å¦™åœ°å°† GPL åè®®æ§åˆ¶åœ¨å†…æ ¸ç©ºé—´ï¼Œå°†ç”¨æˆ·ç©ºé—´çš„åè®®é‡‡ç”¨ Apache-2.0 åè®®ï¼ˆå…è®¸åŸºäº Android çš„å¼€å‘å•†ä¸å‘ç¤¾åŒºåé¦ˆæºç ï¼‰ï¼ŒåŒæ—¶åœ¨ GPL åè®®ä¸ Apache-2.0 ä¹‹é—´çš„ Lib åº“ä¸­é‡‡ç”¨ BSD è¯æˆæƒæ–¹æ³•ï¼Œæœ‰æ•ˆéš”æ–­äº† GPL çš„ä¼ æŸ“æ€§ã€‚æ­¤ä¸¾è™½æœ‰è¾ƒå¤§äº‰è®®ï¼Œä½†è‡³å°‘ç›®å‰èƒ½å¤Ÿè§£å†³ Android ã€è¢«ä¼ æŸ“ã€ï¼Œè®© GPL æ­¢æ­¥äºå†…æ ¸ç©ºé—´ï¼Œè¿™æ˜¯ Google åœ¨ GPL Linux ä¸‹å¼€æºä¸å•†ä¸šåŒ–å…±å­˜çš„ä¸€ä¸ªæˆåŠŸå…¸èŒƒã€‚</p></li></ul><p>ç»¼åˆä¸Šè¿° 5 ç‚¹ï¼Œå¯çŸ¥ Binder æ˜¯ Android ç³»ç»Ÿä¸Šå±‚è¿›ç¨‹é—´é€šä¿¡çš„ä¸äºŒé€‰æ‹©ã€‚</p><h2 id="Binderé€šä¿¡æœºåˆ¶"><a href="#Binderé€šä¿¡æœºåˆ¶" class="headerlink" title="Binderé€šä¿¡æœºåˆ¶"></a>Binderé€šä¿¡æœºåˆ¶</h2><p>å…ˆä¸Šä¸€å¼ Binderçš„å·¥ä½œæµç¨‹å›¾:<br><img src="/img/6.png" alt="Binderå·¥ä½œæµç¨‹å›¾"></p><p>ç„¶åæˆ‘ä»¬è¿˜æ˜¯ç”¨åˆšæ‰é‚£ä¸ªä¾‹å­æ¥è§£é‡Šä¸Šé¢çš„æµç¨‹å›¾ã€‚</p><p>é¦–å…ˆæ˜¯æœ‰ä¸€ä¸ª ServiceManagerï¼Œåˆšå¼€å§‹è¿™ä¸ªé€šè®¯å½•æ˜¯ç©ºç™½çš„ï¼Œç„¶å Server è¿›ç¨‹å‘ ServiceManager æ³¨å†Œä¸€ä¸ªæ˜ å°„å…³ç³»è¡¨ï¼Œæ¯”å¦‚åŒå­¦æŠŠè‡ªå·±çš„åœ°å€<code>åŒ—äº¬å¸‚ xx åŒº xx è¡—é“</code>å†™è¿›é€šè®¯å½•ï¼Œé‚£ä¹ˆå°±å½¢æˆäº†ä¸€å¼ è¡¨ï¼ˆæˆ–è€…æ˜¯ Mapï¼‰ï¼š</p><pre><code>å¾åŒå­¦ â€”&gt; åŒ—äº¬å¸‚ xx åŒº xx è¡—é“</code></pre><p>ä¹‹å Client è¿›ç¨‹æƒ³è¦å’Œ Server è¿›ç¨‹é€šä¿¡ï¼Œé¦–å…ˆå‘ ServiceManager æŸ¥è¯¢åœ°å€ï¼ŒServiceManager æ”¶åˆ°æŸ¥è¯¢çš„è¯·æ±‚ä¹‹åï¼Œè¿”å›æŸ¥è¯¢ç»“æœç»™ Clientã€‚æ³¨æ„åˆ°è¿™é‡Œä¸ç®¡æ˜¯ Server è¿›ç¨‹æ³¨å†Œï¼Œè¿˜æ˜¯ Client æŸ¥è¯¢ï¼Œéƒ½æ˜¯ç»è¿‡ Binder é©±åŠ¨çš„ï¼Œè¿™ä¹Ÿæ­£æ˜¯ Binder é©±åŠ¨çš„ä½œç”¨æ‰€åœ¨ï¼Œå…ˆä¸æ€¥ï¼Œä¸‹é¢çš„åŸç†ä¼šåˆ†æåˆ°ã€‚</p><p>è¿™æ—¶å€™æˆ‘å°±æ‹¿ç€åœ°å€å°±å¼€å§‹å¯„ä¿¡ã€‚å½“æˆ‘æŠŠä¿¡ä»¶æ”¾æ‰”è¿›é‚®ç­’ï¼Œä¹‹åçš„å·¥ä½œå°±æ˜¯ç”±é‚®å±€å»å®Œæˆäº†ã€‚é‚®é€’å‘˜ä»é‚®ç­’å–å‡ºæ˜ä¿¡ç‰‡ï¼Œç„¶åè·¨è¶Šåƒå±±ä¸‡æ°´å°†æ˜ä¿¡ç‰‡é€<br>è¾¾ï¼Œä¹Ÿå°±æ˜¯ Binder é©±åŠ¨å»å®Œæˆé€šä¿¡çš„è½¬å‘ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹å®ƒçš„é€šä¿¡åŸç†ã€‚</p><h3 id="Binder-è·¨è¿›ç¨‹é€šä¿¡åŸç†"><a href="#Binder-è·¨è¿›ç¨‹é€šä¿¡åŸç†" class="headerlink" title="Binder è·¨è¿›ç¨‹é€šä¿¡åŸç†"></a>Binder è·¨è¿›ç¨‹é€šä¿¡åŸç†</h3><p>ä¸Šæ–‡ç»™å‡ºäº† Binder çš„é€šä¿¡æ¨¡å‹ï¼ŒæŒ‡å‡ºäº†é€šä¿¡è¿‡ç¨‹çš„å››ä¸ªè§’è‰²: <strong>Client</strong>, <strong>Server</strong>, <strong>ServiceManager</strong>, <strong>Binder Driver</strong>ã€‚ä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä¸æ¸…æ¥š Client åˆ°åº•æ˜¯å¦‚ä½•ä¸ Server å®Œæˆé€šä¿¡çš„ã€‚</p><p>è·¨è¿›ç¨‹é€šä¿¡æ˜¯éœ€è¦å†…æ ¸ç©ºé—´åšæ”¯æŒçš„ã€‚ä¼ ç»Ÿçš„ IPC æœºåˆ¶å¦‚ç®¡é“ã€Socket éƒ½æ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤é€šè¿‡å†…æ ¸æ”¯æŒæ¥å®ç°è¿›ç¨‹é—´é€šä¿¡è‡ªç„¶æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ Binder å¹¶ä¸æ˜¯ Linux ç³»ç»Ÿå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±å¾—ç›ŠäºLinux çš„<strong>åŠ¨æ€å†…æ ¸å¯åŠ è½½æ¨¡å—</strong>ï¼ˆLoadable Kernel Moduleï¼ŒLKMï¼‰çš„æœºåˆ¶ã€‚</p><blockquote><p>æ¨¡å—æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºï¼Œå®ƒå¯ä»¥è¢«å•ç‹¬ç¼–è¯‘ï¼Œä½†æ˜¯ä¸èƒ½ç‹¬ç«‹è¿è¡Œã€‚å®ƒåœ¨è¿è¡Œæ—¶è¢«é“¾æ¥åˆ°å†…æ ¸ä½œä¸ºå†…æ ¸çš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚</p></blockquote><p>è¿™æ ·ï¼ŒAndroid ç³»ç»Ÿå°±å¯ä»¥é€šè¿‡<strong>åŠ¨æ€æ·»åŠ ä¸€ä¸ªå†…æ ¸æ¨¡å—è¿è¡Œåœ¨å†…æ ¸ç©ºé—´</strong>ï¼Œç”¨æˆ·è¿›ç¨‹ä¹‹é—´é€šè¿‡è¿™ä¸ªå†…æ ¸æ¨¡å—ä½œä¸ºæ¡¥æ¢æ¥å®ç°é€šä¿¡ã€‚</p><p>äºæ˜¯ï¼Œåœ¨ Android ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªè¿è¡Œåœ¨å†…æ ¸ç©ºé—´çš„å¯åŠ è½½æ¨¡å—å°±å« Binder Driverã€‚</p><p>ä¼ ç»Ÿçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œé‡‡ç”¨çš„æ˜¯ä¸Šé¢è¯´è¿‡çš„6ç§æ–¹æ¡ˆï¼Œå®ƒä»¬çš„æœºåˆ¶ï¼Œæ— ééƒ½æ˜¯å…ˆå°†æ•°æ®ä»å‘é€æ–¹è¿›ç¨‹æ‹·è´åˆ°å†…æ ¸ç¼“å­˜åŒºï¼Œç„¶åå†å°†æ•°æ®ä»å†…æ ¸ç¼“å­˜åŒºæ‹·è´åˆ°æ¥æ”¶æ–¹è¿›ç¨‹ï¼Œé€šè¿‡ä¸¤æ¬¡æ‹·è´æ¥å®ç°çš„æ•°æ®äº¤æ¢ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/9.jpg" alt="ä¼ ç»ŸIPCæœºåˆ¶"></p><p>è€Œ Binder åˆ«å‡ºå¿ƒè£çš„åœ°æ–¹å°±åœ¨äºï¼Œå®ƒåªéœ€è¦æ‹·è´ä¸€æ¬¡æ•°æ®ï¼Œå°±å¯ä»¥å®Œæˆæ•°æ®äº¤æ¢ï¼Œè¿™å¾—ç›Šäºä¸€ç§å«<strong>å†…å­˜æ˜ å°„</strong>ï¼ˆ<code>mmap()</code>ï¼‰çš„æ¦‚å¿µã€‚</p><blockquote><p><code>mmap()</code>æ˜¯æ“ä½œç³»ç»Ÿä¸­ä¸€ç§å†…å­˜æ˜ å°„çš„æ–¹æ³•ã€‚</p><p>ç®€å•åœ°è®²å°±æ˜¯å°†ç”¨æˆ·ç©ºé—´çš„ä¸€å—å†…å­˜åŒºåŸŸæ˜ å°„åˆ°å†…æ ¸ç©ºé—´ã€‚</p><p>æ˜ å°„å…³ç³»å»ºç«‹åï¼Œç”¨æˆ·å¯¹è¿™å—å†…å­˜åŒºåŸŸçš„ä¿®æ”¹å¯ä»¥ç›´æ¥ååº”åˆ°å†…æ ¸ç©ºé—´ï¼›åä¹‹å†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿèƒ½ç›´æ¥ååº”åˆ°ç”¨æˆ·ç©ºé—´ã€‚å†…å­˜æ˜ å°„èƒ½å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå®ç°ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„é«˜æ•ˆäº’åŠ¨ã€‚ä¸¤ä¸ªç©ºé—´å„è‡ªçš„ä¿®æ”¹èƒ½ç›´æ¥åæ˜ åœ¨æ˜ å°„çš„å†…å­˜åŒºåŸŸï¼Œä»è€Œè¢«å¯¹æ–¹ç©ºé—´åŠæ—¶æ„ŸçŸ¥ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œå†…å­˜æ˜ å°„èƒ½å¤Ÿæä¾›å¯¹è¿›ç¨‹é—´é€šä¿¡çš„æ”¯æŒã€‚</p></blockquote><p>Binderæ­£æ˜¯åŸºäº<code>mmap()</code>æ¥å®ç°çš„ã€‚ä½†æ˜¯<code>mmap()</code>é€šå¸¸æ˜¯ç”¨åœ¨<strong>æœ‰ç‰©ç†ä»‹è´¨çš„æ–‡ä»¶ç³»ç»Ÿä¸Š</strong>çš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè¿›ç¨‹ä¸­çš„ç”¨æˆ·åŒºåŸŸæ˜¯ä¸èƒ½ç›´æ¥å’Œç‰©ç†è®¾å¤‡æ‰“äº¤é“çš„ï¼Œå¦‚æœæƒ³è¦æŠŠç£ç›˜ä¸Šçš„æ•°æ®è¯»å–åˆ°è¿›ç¨‹çš„ç”¨æˆ·åŒºåŸŸï¼Œéœ€è¦ä¸¤æ¬¡æ‹·è´ï¼ˆç£ç›˜ â€“&gt; å†…æ ¸ç©ºé—´ â€“&gt; ç”¨æˆ·ç©ºé—´ï¼‰ï¼›é€šå¸¸åœ¨è¿™ç§åœºæ™¯ä¸‹<code>mmap()</code>å°±èƒ½å‘æŒ¥ä½œç”¨ï¼Œé€šè¿‡åœ¨ç‰©ç†ä»‹è´¨å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´å»ºç«‹æ˜ å°„ï¼Œå‡å°‘æ•°æ®çš„æ‹·è´æ¬¡æ•°ï¼Œç”¨å†…å­˜è¯»å†™å–ä»£ I/O è¯»å†™ï¼Œæé«˜æ–‡ä»¶è¯»å–æ•ˆç‡ã€‚</p><p>è€Œ Binder å¹¶ä¸å­˜åœ¨ç‰©ç†ä»‹è´¨ï¼Œå› æ­¤ Binder é©±åŠ¨ä½¿ç”¨ <code>mmap()</code> å¹¶ä¸æ˜¯ä¸ºäº†åœ¨ç‰©ç†ä»‹è´¨å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´å»ºç«‹æ˜ å°„ï¼Œè€Œæ˜¯ç”¨æ¥åœ¨å†…æ ¸ç©ºé—´<strong>åˆ›å»ºç”¨äºæ¥æ”¶æ•°æ®çš„ç¼“å­˜ç©ºé—´</strong>ã€‚</p><p>ä¸€æ¬¡å®Œæ•´çš„ Binder IPC é€šä¿¡è¿‡ç¨‹é€šå¸¸æ˜¯è¿™æ ·ï¼š</p><ol><li>é¦–å…ˆ Binder é©±åŠ¨åœ¨å†…æ ¸ç©ºé—´åˆ›å»ºä¸€ä¸ª<strong>æ•°æ®æ¥æ”¶ç¼“å­˜åŒº</strong>ï¼› </li><li>æ¥ç€åœ¨å†…æ ¸ç©ºé—´å¼€è¾Ÿä¸€å—<strong>å†…æ ¸ç¼“å­˜åŒº</strong>ï¼Œå»ºç«‹å†…æ ¸ç¼“å­˜åŒºå’Œå†…æ ¸ä¸­æ•°æ®æ¥æ”¶ç¼“å­˜åŒºä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä»¥åŠå†…æ ¸ä¸­æ•°æ®æ¥æ”¶ç¼“å­˜åŒºå’Œæ¥æ”¶è¿›ç¨‹ç”¨æˆ·ç©ºé—´åœ°å€çš„æ˜ å°„å…³ç³»ï¼›</li><li>å‘é€æ–¹è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ <code>copy_from_user()</code> å°†æ•°æ® copy åˆ°å†…æ ¸ä¸­çš„å†…æ ¸ç¼“å­˜åŒºï¼Œç”±äºå†…æ ¸ç¼“å­˜åŒºå’Œæ¥æ”¶è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´å­˜åœ¨å†…å­˜æ˜ å°„ï¼Œå› æ­¤ä¹Ÿå°±ç›¸å½“äºæŠŠæ•°æ®å‘é€åˆ°äº†æ¥æ”¶è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™æ ·ä¾¿å®Œæˆäº†ä¸€æ¬¡è¿›ç¨‹é—´çš„é€šä¿¡ã€‚</li></ol><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div class="center-img"><p><img src="/img/10.png" alt="Binderå†…å­˜æ˜ å°„æœºåˆ¶"></p></div><p><a href="https://blog.csdn.net/universus/article/details/6211589">Android Binder è®¾è®¡ä¸å®ç°</a>ä¸€æ–‡ä¸­å¯¹ Clientã€Serverã€ServiceManagerã€Binder é©±åŠ¨æœ‰å¾ˆè¯¦ç»†çš„æè¿°ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æ‘˜å½•ï¼š</p><blockquote><h4 id="Binder-é©±åŠ¨"><a href="#Binder-é©±åŠ¨" class="headerlink" title="Binder é©±åŠ¨"></a><strong>Binder é©±åŠ¨</strong></h4><p>Binder é©±åŠ¨å°±å¦‚åŒè·¯ç”±å™¨ä¸€æ ·ï¼Œæ˜¯æ•´ä¸ªé€šä¿¡çš„æ ¸å¿ƒï¼›é©±åŠ¨è´Ÿè´£è¿›ç¨‹ä¹‹é—´ Binder é€šä¿¡çš„å»ºç«‹ï¼ŒBinder åœ¨è¿›ç¨‹ä¹‹é—´çš„ä¼ é€’ï¼ŒBinder å¼•ç”¨è®¡æ•°ç®¡ç†ï¼Œæ•°æ®åŒ…åœ¨è¿›ç¨‹ä¹‹é—´çš„ä¼ é€’å’Œäº¤äº’ç­‰ä¸€ç³»åˆ—åº•å±‚æ”¯æŒã€‚</p><h4 id="ServiceManager-ä¸å®å-Binder"><a href="#ServiceManager-ä¸å®å-Binder" class="headerlink" title="ServiceManager ä¸å®å Binder"></a><strong>ServiceManager ä¸å®å Binder</strong></h4><p>ServiceManager å’Œ DNS ç±»ä¼¼ï¼Œä½œç”¨æ˜¯å°†å­—ç¬¦å½¢å¼çš„ Binder åå­—è½¬åŒ–æˆ Client ä¸­å¯¹è¯¥ Binder çš„å¼•ç”¨ï¼Œä½¿å¾— Client èƒ½å¤Ÿé€šè¿‡ Binder çš„åå­—è·å¾—å¯¹ Binder å®ä½“çš„å¼•ç”¨ã€‚æ³¨å†Œäº†åå­—çš„ Binder å«å®å Binderï¼Œå°±åƒç½‘ç«™ä¸€æ ·é™¤äº†é™¤äº†æœ‰ IP åœ°å€æ„å¤–è¿˜æœ‰è‡ªå·±çš„ç½‘å€ã€‚Server åˆ›å»ºäº† Binderï¼Œå¹¶ä¸ºå®ƒèµ·ä¸€ä¸ªå­—ç¬¦å½¢å¼ï¼Œå¯è¯»æ˜“è®°å¾—åå­—ï¼Œå°†è¿™ä¸ª Binder å®ä½“è¿åŒåå­—ä¸€èµ·ä»¥æ•°æ®åŒ…çš„å½¢å¼é€šè¿‡ Binder é©±åŠ¨å‘é€ç»™ ServiceManager ï¼Œé€šçŸ¥ ServiceManager æ³¨å†Œä¸€ä¸ªåä¸ºâ€œå¼ ä¸‰â€çš„ Binderï¼Œå®ƒä½äºæŸä¸ª Server ä¸­ã€‚é©±åŠ¨ä¸ºè¿™ä¸ªç©¿è¶Šè¿›ç¨‹è¾¹ç•Œçš„ Binder åˆ›å»ºä½äºå†…æ ¸ä¸­çš„å®ä½“èŠ‚ç‚¹ä»¥åŠ ServiceManager å¯¹å®ä½“çš„å¼•ç”¨ï¼Œå°†åå­—ä»¥åŠæ–°å»ºçš„å¼•ç”¨æ‰“åŒ…ä¼ ç»™ ServiceManagerã€‚ServiceManger æ”¶åˆ°æ•°æ®åä»ä¸­å–å‡ºåå­—å’Œå¼•ç”¨å¡«å…¥æŸ¥æ‰¾è¡¨ã€‚</p><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°ï¼ŒServierManager æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ŒServer æ˜¯å¦ä¸€ä¸ªè¿›ç¨‹ï¼ŒServer å‘ ServiceManager ä¸­æ³¨å†Œ Binder å¿…ç„¶æ¶‰åŠåˆ°è¿›ç¨‹é—´é€šä¿¡ã€‚å½“å‰å®ç°è¿›ç¨‹é—´é€šä¿¡åˆè¦ç”¨åˆ°è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿™å°±å¥½åƒè›‹å¯ä»¥å­µå‡ºé¸¡çš„å‰æå´æ˜¯è¦å…ˆæ‰¾åªé¸¡ä¸‹è›‹ï¼Binder çš„å®ç°æ¯”è¾ƒå·§å¦™ï¼Œå°±æ˜¯é¢„å…ˆåˆ›é€ ä¸€åªé¸¡æ¥ä¸‹è›‹ã€‚ServiceManager å’Œå…¶ä»–è¿›ç¨‹åŒæ ·é‡‡ç”¨ Binder é€šä¿¡ï¼ŒServiceManager æ˜¯ Server ç«¯ï¼Œæœ‰è‡ªå·±çš„ Binder å®ä½“ï¼Œå…¶ä»–è¿›ç¨‹éƒ½æ˜¯ Clientï¼Œéœ€è¦é€šè¿‡è¿™ä¸ª Binder çš„å¼•ç”¨æ¥å®ç° Binder çš„æ³¨å†Œï¼ŒæŸ¥è¯¢å’Œè·å–ã€‚ServiceManager æä¾›çš„ Binder æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ²¡æœ‰åå­—ä¹Ÿä¸éœ€è¦æ³¨å†Œã€‚å½“ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ BINDER SETCONTEXT_MGR å‘½ä»¤å°†è‡ªå·±æ³¨å†Œæˆ ServiceManager æ—¶ Binder é©±åŠ¨ä¼šè‡ªåŠ¨ä¸ºå®ƒåˆ›å»º Binder å®ä½“ï¼ˆè¿™å°±æ˜¯é‚£åªé¢„å…ˆé€ å¥½çš„é‚£åªé¸¡ï¼‰ã€‚å…¶æ¬¡è¿™ä¸ª Binder å®ä½“çš„å¼•ç”¨åœ¨æ‰€æœ‰ Client ä¸­éƒ½å›ºå®šä¸º 0 è€Œæ— éœ€é€šè¿‡å…¶å®ƒæ‰‹æ®µè·å¾—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª Server æƒ³è¦å‘ ServiceManager æ³¨å†Œè‡ªå·±çš„ Binder å°±å¿…é¡»é€šè¿‡è¿™ä¸ª 0 å·å¼•ç”¨å’Œ ServiceManager çš„ Binder é€šä¿¡ã€‚ç±»æ¯”äº’è”ç½‘ï¼Œ0 å·å¼•ç”¨å°±å¥½æ¯”æ˜¯åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å¿…é¡»é¢„å…ˆåŠ¨æ€æˆ–è€…æ‰‹å·¥é…ç½®å¥½ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¯´çš„ Client æ˜¯ç›¸å¯¹äº ServiceManager è€Œè¨€çš„ï¼Œä¸€ä¸ªè¿›ç¨‹æˆ–è€…åº”ç”¨ç¨‹åºå¯èƒ½æ˜¯æä¾›æœåŠ¡çš„ Serverï¼Œä½†å¯¹äº ServiceManager æ¥è¯´å®ƒä»ç„¶æ˜¯ä¸ª Clientã€‚</p><h4 id="Client-è·å¾—å®å-Binder-çš„å¼•ç”¨"><a href="#Client-è·å¾—å®å-Binder-çš„å¼•ç”¨" class="headerlink" title="Client è·å¾—å®å Binder çš„å¼•ç”¨"></a><strong>Client è·å¾—å®å Binder çš„å¼•ç”¨</strong></h4><p>Server å‘ ServiceManager ä¸­æ³¨å†Œäº† Binder ä»¥åï¼Œ Client å°±èƒ½é€šè¿‡åå­—è·å¾— Binder çš„å¼•ç”¨äº†ã€‚Client ä¹Ÿåˆ©ç”¨ä¿ç•™çš„ 0 å·å¼•ç”¨å‘ ServiceManager è¯·æ±‚è®¿é—®æŸä¸ª Binder: æˆ‘ç”³è¯·è®¿é—®åå­—å«å¼ ä¸‰çš„ Binder å¼•ç”¨ã€‚ServiceManager æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åä»è¯·æ±‚æ•°æ®åŒ…ä¸­å–å‡º Binder åç§°ï¼Œåœ¨æŸ¥æ‰¾è¡¨é‡Œæ‰¾åˆ°å¯¹åº”çš„æ¡ç›®ï¼Œå–å‡ºå¯¹åº”çš„ Binder å¼•ç”¨ä½œä¸ºå›å¤å‘é€ç»™å‘èµ·è¯·æ±‚çš„ Clientã€‚ä»é¢å‘å¯¹è±¡çš„è§’åº¦çœ‹ï¼ŒServer ä¸­çš„ Binder å®ä½“ç°åœ¨æœ‰ä¸¤ä¸ªå¼•ç”¨ï¼šä¸€ä¸ªä½äº ServiceManager ä¸­ï¼Œä¸€ä¸ªä½äºå‘èµ·è¯·æ±‚çš„ Client ä¸­ã€‚å¦‚æœæ¥ä¸‹æ¥æœ‰æ›´å¤šçš„ Client è¯·æ±‚è¯¥ Binderï¼Œç³»ç»Ÿä¸­å°±ä¼šæœ‰æ›´å¤šçš„å¼•ç”¨æŒ‡å‘è¯¥ Binder ï¼Œå°±åƒ Java ä¸­ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå¼•ç”¨ä¸€æ ·ã€‚</p></blockquote><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´èƒ½æ€»ç»“å‡º Binder é€šä¿¡è¿‡ç¨‹ï¼š</p><ol><li>é¦–å…ˆï¼Œä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤é€šè¿‡ Binder é©±åŠ¨å°†è‡ªå·±<strong>æ³¨å†Œ</strong>æˆä¸º ServiceManagerï¼›</li><li>æ¥ç€ï¼ŒServer è¿›ç¨‹é€šè¿‡é©±åŠ¨å‘ ServiceManager ä¸­æ³¨å†Œ Binderï¼ˆServer ä¸­çš„ Binder å®ä½“ï¼‰ï¼Œè¡¨æ˜å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚é©±åŠ¨ä¸ºè¿™ä¸ª Binder åˆ›å»ºä½äºå†…æ ¸ä¸­çš„<strong>å®ä½“èŠ‚ç‚¹</strong>ä»¥åŠ ServiceManager å¯¹å®ä½“çš„<strong>å¼•ç”¨</strong>ï¼Œå°†<strong>åå­—ä»¥åŠæ–°å»ºçš„å¼•ç”¨æ‰“åŒ…ä¼ ç»™ ServiceManager</strong>ï¼ŒServiceManger å°†å…¶å¡«å…¥æŸ¥æ‰¾è¡¨ã€‚</li><li>æœ€åï¼ŒClient é€šè¿‡åå­—ï¼Œåœ¨ Binder é©±åŠ¨çš„å¸®åŠ©ä¸‹ä» ServiceManager ä¸­è·å–åˆ°å¯¹ Binder å®ä½“çš„å¼•ç”¨ï¼Œé€šè¿‡è¿™ä¸ªå¼•ç”¨å°±èƒ½å®ç°å’Œ Server è¿›ç¨‹çš„é€šä¿¡ã€‚</li></ol><p>æˆ‘ä»¬çœ‹åˆ°æ•´ä¸ªé€šä¿¡è¿‡ç¨‹éƒ½éœ€è¦ Binder é©±åŠ¨çš„æ¥å…¥ã€‚ä¸‹å›¾èƒ½æ›´åŠ ç›´è§‚çš„å±•ç°æ•´ä¸ªé€šä¿¡è¿‡ç¨‹ï¼ˆä¸ºäº†è¿›ä¸€æ­¥æŠ½è±¡é€šä¿¡è¿‡ç¨‹ä»¥åŠå‘ˆç°ä¸Šçš„æ–¹ä¾¿ï¼Œä¸‹å›¾æˆ‘ä»¬å¿½ç•¥äº† Binderå®ä½“åŠå…¶å¼•ç”¨çš„æ¦‚å¿µï¼‰ï¼š</p><div class="center-img"><p><img src="/img/11.jpg" alt="Binderé€šä¿¡è¿‡ç¨‹"></p></div><h3 id="Binder-é€šä¿¡ä¸­çš„ä»£ç†æ¨¡å¼"><a href="#Binder-é€šä¿¡ä¸­çš„ä»£ç†æ¨¡å¼" class="headerlink" title="Binder é€šä¿¡ä¸­çš„ä»£ç†æ¨¡å¼"></a>Binder é€šä¿¡ä¸­çš„ä»£ç†æ¨¡å¼</h3><p>æˆ‘ä»¬å·²ç»è§£é‡Šæ¸…æ¥š Clientã€Server å€ŸåŠ© Binder é©±åŠ¨å®Œæˆè·¨è¿›ç¨‹é€šä¿¡çš„å®ç°æœºåˆ¶äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜ä¼šè®©æˆ‘ä»¬å›°æƒ‘ã€‚A è¿›ç¨‹æƒ³è¦ B è¿›ç¨‹ä¸­æŸä¸ªå¯¹è±¡ï¼ˆobjectï¼‰æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæ¯•ç«Ÿå®ƒä»¬åˆ†å±ä¸åŒçš„è¿›ç¨‹ï¼ŒA è¿›ç¨‹æ²¡æ³•ç›´æ¥ä½¿ç”¨ B è¿›ç¨‹ä¸­çš„å¯¹è±¡å®ä¾‹ã€‚</p><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡è·¨è¿›ç¨‹é€šä¿¡çš„è¿‡ç¨‹éƒ½æœ‰ Binder é©±åŠ¨çš„å‚ä¸ï¼Œå› æ­¤åœ¨æ•°æ®æµç» Binder é©±åŠ¨çš„æ—¶å€™é©±åŠ¨ä¼šå¯¹æ•°æ®åšä¸€å±‚è½¬æ¢ã€‚å½“ A è¿›ç¨‹æƒ³è¦è·å– B è¿›ç¨‹ä¸­çš„ object æ—¶ï¼Œé©±åŠ¨å¹¶ä¸ä¼šçœŸçš„æŠŠ object è¿”å›ç»™ Aï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ªè·Ÿ object çœ‹èµ·æ¥ä¸€æ¨¡ä¸€æ ·çš„ä»£ç†å¯¹è±¡ objectProxyï¼Œè¿™ä¸ª objectProxy å…·æœ‰å’Œ object ä¸€æ¨¡ä¸€æ ·çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•å¹¶æ²¡æœ‰ B è¿›ç¨‹ä¸­ object å¯¹è±¡é‚£äº›æ–¹æ³•çš„èƒ½åŠ›ï¼Œè¿™äº›æ–¹æ³•åªéœ€è¦æŠŠæŠŠè¯·æ±‚å‚æ•°äº¤ç»™é©±åŠ¨å³å¯ã€‚å¯¹äº A è¿›ç¨‹æ¥è¯´å’Œç›´æ¥è°ƒç”¨ object ä¸­çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚</p><p>å½“ Binder é©±åŠ¨æ¥æ”¶åˆ° A è¿›ç¨‹çš„æ¶ˆæ¯åï¼Œå‘ç°è¿™æ˜¯ä¸ª objectProxy å°±å»æŸ¥è¯¢è‡ªå·±ç»´æŠ¤çš„è¡¨å•ï¼Œä¸€æŸ¥å‘ç°è¿™æ˜¯ B è¿›ç¨‹ object çš„ä»£ç†å¯¹è±¡ã€‚äºæ˜¯å°±ä¼šå»é€šçŸ¥ B è¿›ç¨‹è°ƒç”¨ object çš„æ–¹æ³•ï¼Œå¹¶è¦æ±‚ B è¿›ç¨‹æŠŠè¿”å›ç»“æœå‘ç»™è‡ªå·±ã€‚å½“é©±åŠ¨æ‹¿åˆ° B è¿›ç¨‹çš„è¿”å›ç»“æœåå°±ä¼šè½¬å‘ç»™ A è¿›ç¨‹ï¼Œä¸€æ¬¡é€šä¿¡å°±å®Œæˆäº†ã€‚</p><p>ä¸Šé¢çš„ä»£ç†æ¨¡å¼å¯ä»¥å½’ç»“ä¸ºä¸‹å›¾ï¼š<br><img src="/img/12.png" alt="Binderçš„ä»£ç†æ¨¡å¼"></p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹ Binder åšä¸ªæ›´åŠ å…¨é¢çš„å®šä¹‰äº†ï¼š</p><ul><li>ä»è¿›ç¨‹é—´é€šä¿¡çš„è§’åº¦çœ‹ï¼ŒBinder æ˜¯ä¸€ç§<strong>è¿›ç¨‹é—´é€šä¿¡çš„æœºåˆ¶</strong>ï¼›</li><li>ä» Server è¿›ç¨‹çš„è§’åº¦çœ‹ï¼Œ Binder æŒ‡çš„æ˜¯ <strong>Server ä¸­çš„ Binder å®ä½“å¯¹è±¡</strong>ï¼› </li><li>ä» Client è¿›ç¨‹çš„è§’åº¦çœ‹ï¼ŒBinder æŒ‡çš„æ˜¯å¯¹ <strong>Binder ä»£ç†å¯¹è±¡</strong>ï¼Œæ˜¯ Binder å®ä½“å¯¹è±¡çš„ä¸€ä¸ªè¿œç¨‹ä»£ç†ï¼›</li><li>ä»ä¼ è¾“è¿‡ç¨‹çš„è§’åº¦çœ‹ï¼ŒBinder æ˜¯ä¸€ä¸ª<strong>å¯ä»¥è·¨è¿›ç¨‹ä¼ è¾“çš„å¯¹è±¡</strong>ï¼›Binder é©±åŠ¨ä¼šå¯¹è¿™ä¸ªè·¨è¶Šè¿›ç¨‹è¾¹ç•Œçš„å¯¹è±¡å¯¹ä¸€ç‚¹ç‚¹ç‰¹æ®Šå¤„ç†ï¼Œè‡ªåŠ¨å®Œæˆä»£ç†å¯¹è±¡å’Œæœ¬åœ°å¯¹è±¡ä¹‹é—´çš„è½¬æ¢ã€‚</li></ul><h2 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h2><p>åœ¨å†™ä¾‹å­ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹æ¥ä¸‹æ¥è¦å‡ºåœºçš„å‡ ä½è§’è‰²ï¼š</p><p><strong>1. IInterface</strong></p><p>IInterface æ˜¯ Binder æ¥å£çš„åŸºç±»ï¼Œæ¯å½“æœ‰ä¸€ä¸ª Binder ç±»çš„æ¥å£ï¼Œéƒ½è¦ç»§æ‰¿äºè¯¥æ¥å£ã€‚å®ƒçš„å®šä¹‰å¾ˆç®€å•ï¼š</p><pre><code class="JAVA">// android.os.IInterfacepackage android.os;public interface IInterface&#123;    // åœ¨è¿”å›å®ä¾‹æ—¶ä¸è¦è¿›è¡Œæ˜¾å¼å¼ºè½¬ï¼Œè€Œæ˜¯å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥è½¬æ¢æˆ IBinderã€‚    public IBinder asBinder();&#125;</code></pre><p>åªæœ‰ä¸€ä¸ªæ–¹æ³•<code>asBinder()</code>ï¼Œç”¨æ¥è¿”å›å¯¹åº”çš„ Binder å¯¹è±¡ã€‚</p><p><strong>2. IBinder</strong></p><p>IBinder æ˜¯ä¸€ä¸ªæ¥å£ï¼Œçº¦å®šäº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚ transaction code çš„èŒƒå›´å€¼ã€æœ€å¤§çš„ IPC æ•°é‡ç­‰ç­‰ã€‚</p><div class="center-img"><p><img src="/img/binder-1588152047.png"></p></div><p>IBinder ä»£è¡¨äº†ä¸€ç§<strong>è·¨è¿›ç¨‹ä¼ è¾“çš„èƒ½åŠ›</strong>ï¼Œå®ç°è¿™ä¸ªæ¥å£å°±æ„å‘³ç€è¿™ä¸ªå¯¹è±¡èƒ½è¿›è¡Œè·¨è¿›ç¨‹ä¼ é€’ã€‚</p><p>å®ƒæœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯<code>transact()</code>ã€‚è€Œ Binder å®ç°äº† IBinder æ¥å£ï¼Œæˆ‘ä»¬ä¸€ä¼šçœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆã€‚</p><p><strong>3. Binder</strong></p><p>Binder å®ç°äº† IBinder å®šä¹‰çš„æ“ä½œï¼Œå®ƒæ˜¯ Android IPC çš„åŸºç¡€ï¼Œå¹³å¸¸æ¥è§¦åˆ°çš„å„ç§ Managerï¼ˆActivityManager, ServiceManager ç­‰ï¼‰ï¼Œä»¥åŠç»‘å®š Service æ—¶éƒ½åœ¨ä½¿ç”¨å®ƒè¿›è¡Œè·¨è¿›ç¨‹æ“ä½œã€‚</p><p>Android å®˜æ–¹å»ºè®®çš„æ˜¯ï¼šæ—¥å¸¸å¼€å‘ä¸­ä¸€èˆ¬ä¸éœ€è¦æˆ‘ä»¬å†å®ç° IBinderï¼Œç›´æ¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ Binder å³å¯ã€‚</p><p>å®ƒçš„å­˜åœ¨ä¸ä¼šå½±å“ä¸€ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œåªè¦åˆ›å»ºå®ƒçš„è¿›ç¨‹åœ¨è¿è¡Œå®ƒå°±ä¸€ç›´å¯ç”¨ã€‚</p><p>é€šå¸¸æˆ‘ä»¬éœ€è¦åœ¨é¡¶çº§çš„ç»„ä»¶ï¼ˆService, Activity, ContentProviderï¼‰ä¸­ä½¿ç”¨å®ƒï¼Œè¿™æ ·ç³»ç»Ÿæ‰çŸ¥é“ä½ çš„è¿›ç¨‹åº”è¯¥ä¸€ç›´è¢«ä¿ç•™ã€‚</p><p>å®ƒçš„ä¸¤ä¸ªå…³é”®æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªæ˜¯å®ç°äº† IBinder çš„<code>transact()</code>ï¼š</p><pre><code class="java">public final boolean transact(int code, @NonNull Parcel data, @Nullable Parcel reply,        int flags) throws RemoteException &#123;    if (false) Log.v(&quot;Binder&quot;, &quot;Transact: &quot; + code + &quot; to &quot; + this);    if (data != null) &#123;        data.setDataPosition(0);    &#125;    boolean r = onTransact(code, data, reply, flags);    if (reply != null) &#123;        reply.setDataPosition(0);    &#125;    return r;&#125;</code></pre><p>å®ƒçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†å®ƒçš„<code>onTransact</code>æ–¹æ³•ï¼Œç„¶åå°†æ‰§è¡ŒæˆåŠŸä¸å¦è¿”å›ã€‚ç»§ç»­çœ‹çœ‹<code>onTransact</code>ï¼š</p><pre><code class="java">protected boolean onTransact(int code, @NonNull Parcel data, @Nullable Parcel reply,        int flags) throws RemoteException &#123;    if (code == INTERFACE_TRANSACTION) &#123;  // è·å–æè¿°ç¬¦        ...        return true;    &#125; else if (code == DUMP_TRANSACTION) &#123;  // è½¬å­˜ Binder ä¿¡æ¯        ...        return true;    &#125; else if (code == SHELL_COMMAND_TRANSACTION) &#123;   // æ‰§è¡Œ SHELL å‘½ä»¤        ...        return true;    &#125;    return false;&#125;</code></pre><p>æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œåªæ˜¯å¤„ç†äº†ä¸‰ç§æƒ…å†µã€‚è€Œæˆ‘ä»¬è‡ªå®šä¹‰ Binderï¼Œæˆ–è€…ä½¿ç”¨ç³»ç»Ÿç”Ÿæˆçš„ Binder æ—¶ï¼Œå¾€å¾€éƒ½ä¼šè‡ªå·±å®ç°<code>onTransact</code>æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œä¸ç”¨ç‰¹åˆ«å…³æ³¨ã€‚</p><p>å¥½ï¼Œä»‹ç»å®Œè§’è‰²ä»¬ï¼Œæ¥ä¸‹æ¥è¦è®²è®²å‰§æœ¬äº†ã€‚</p><p>å¹³æ—¶åœ¨å¼€å‘ä¸­ï¼Œå®ç° IPC æœºåˆ¶æ—¶ï¼Œæœ€å¤šä½¿ç”¨çš„æ˜¯ <a href="https://developer.android.com/guide/components/aidl.html">AIDLï¼ˆAndroid Interface Definition Languageï¼‰</a>ã€‚å½“æˆ‘ä»¬å®šä¹‰å¥½ AIDL æ–‡ä»¶ï¼Œåœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬ç”Ÿæˆä»£ç å®ç° IPC é€šä¿¡ã€‚</p><p>Android åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä»£ç çš„å¯è¯»æ€§å¹¶ä¸é«˜ã€‚æ¯”å¦‚ä¸€ä¸ª MyClass.aidl çš„æ–‡ä»¶åœ¨ç»è¿‡ç¼–è¯‘æ—¶ç”Ÿæˆçš„ MyClass.java ä¸­ï¼Œä¼šåŒ…å«ä¸€ä¸ª MyClass æ¥å£ã€ä¸€ä¸ª Stub é™æ€æŠ½è±¡ç±»å’Œä¸€ä¸ª Proxy é™æ€ç±»ã€‚Proxy æ˜¯ Stub çš„é™æ€å†…éƒ¨ç±»ï¼ŒStub åˆæ˜¯ BookManager çš„é™æ€å†…éƒ¨ç±»ï¼Œè¿™å°±é€ æˆäº†å¯è¯»æ€§å’Œå¯ç†è§£æ€§çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ Android è¿™æ ·è®¾è®¡æ˜¯æœ‰å®ƒçš„é“ç†çš„ã€‚å¦‚æœæœ‰å¤šä¸ª AIDL æ–‡ä»¶æ—¶ï¼Œè¿™äº›ç±»åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå¯ä»¥æœ‰æ•ˆé¿å… Stub å’Œ Proxy çš„é‡åé—®é¢˜ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥å†™ä¸€ä¸ªç®€å•çš„ AIDL æ–‡ä»¶ï¼š</p><pre><code class="java">// IPerson.aidlpackage com.debuglife.aidl.test;// Declare any non-default types here with import statementsinterface IPerson &#123;    void setName(String aString);    String getName();&#125;</code></pre><p>å¯ä»¥è§åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜ä¸€ä¸ªæ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰æ–¹æ³•å³å¯ã€‚ç¼–è¯‘ä¸€æ¬¡åï¼Œå°±ä¼šåœ¨<code>app/build/generated/aidl_source_output_dir/debug/out</code>ä¸­æ‰¾åˆ°å¯¹åº”çš„ç”Ÿæˆç±»ï¼ˆä¸ AIDL æ–‡ä»¶åŒåï¼Œä½†æ‰©å±•åä¼šæ¢ä¸º .javaï¼‰ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç”Ÿæˆåçš„ä»£ç ï¼Œæ³¨é‡Šä¸­ä¼šè§£é‡Šæ¯ä¸€éƒ¨åˆ†çš„ç”¨é€”ï¼š</p><pre><code class="java">// IPerson.javapackage com.debuglife.aidl.test;public interface IPerson extends android.os.IInterface &#123;    // æœ¬åœ° IPC å®ç°çš„ã€å­˜æ ¹ã€ç±»    public static abstract class Stub extends android.os.Binder implements com.debuglife.aidl.test.IPerson &#123;        // ä¸€ä¸ªå”¯ä¸€æ ‡è¯†è¯¥ Binder ç±»çš„å­—ç¬¦ä¸²        private static final java.lang.String DESCRIPTOR = &quot;com.debuglife.aidl.test.IPerson&quot;;        // æ„é€ å‡½æ•°é‡Œè°ƒç”¨ attachInterface æ–¹æ³•ï¼Œç„¶åå°†è‡ªèº«çš„é™æ€å®ä¾‹å’Œæ ‡è¯†ç¬¦ä¼ å…¥çˆ¶ç±» Binder ç±»ä¸­        public Stub() &#123;            this.attachInterface(this, DESCRIPTOR);        &#125;        // å°† IBinder å¯¹è±¡è½¬æ¢æˆ com.debuglife.aidl.test.IPerson æ¥å£        // å¦‚æœéœ€è¦çš„è¯ï¼Œä¼šç”Ÿæˆä¸€ä¸ª Proxy        // å¦‚æœéœ€è¦é€šä¿¡çš„ Client å’Œ Server åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œé‚£æ„å‘³ç€å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å¯¹è±¡çš„å®ä¾‹ï¼Œå°±ä¸ç”¨         public static com.debuglife.aidl.test.IPerson asInterface(android.os.IBinder obj) &#123;            if ((obj == null)) &#123;                return null;            &#125;            // é€šè¿‡åˆšæ‰è®¾å®šçš„ DESCRIPTOR æ¥ç¡®å®šå¯¹åº”çš„æ¥å£æ˜¯å¦æ­£ç¡®            android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);            // åˆ¤æ–­ Client å’Œ Server æ˜¯å¦åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…            if (((iin != null) &amp;&amp; (iin instanceof com.debuglife.aidl.test.IPerson))) &#123;                // å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›å®ä¾‹                return ((com.debuglife.aidl.test.IPerson) iin);            &#125;            // å¦‚æœä¸æ˜¯ï¼Œåˆ™è¦æ–°å»º Proxy å¹¶è¿”å› Proxy çš„å®ä¾‹            return new com.debuglife.aidl.test.IPerson.Stub.Proxy(obj);        &#125;        // å¤å†™ IInterface çš„ asBinder æ–¹æ³•ï¼Œç”¨æ¥è¿”å›ä¸ IPerson ç›¸å¯¹åº”çš„ Binder å¯¹è±¡        @Override        public android.os.IBinder asBinder() &#123;            return this;        &#125;        // è¯¥æ–¹æ³•æ˜¯æ¯æ¬¡é€šä¿¡æ—¶ä¼šè¢«è°ƒç”¨        // å‚æ•°ï¼šint code æ ‡è¯†ç ï¼Œç±»ä¼¼ Handler ä¸­çš„ msg.what        // Parcel data å‘é€çš„æ•°æ®        // Parcel reply è¿”å›çš„æ•°æ®        // int flags é™„åŠ çš„æ ‡è¯†ä½ï¼Œ0è¡¨ç¤ºæ­£å¸¸é€šä¿¡ï¼ŒFLAG_ONEWAY è¡¨ç¤ºå•å‘é€šä¿¡        @Override        public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123;            java.lang.String descriptor = DESCRIPTOR;            switch (code) &#123;                // è¯¢é—®æ¥æ”¶æ–¹ï¼ˆè¢«è°ƒç”¨æ–¹ï¼‰æ¥å£æè¿°ç¬¦                case INTERFACE_TRANSACTION: &#123;                    reply.writeString(descriptor);                    return true;                &#125;                case TRANSACTION_setName: &#123;                    data.enforceInterface(descriptor);                    java.lang.String _arg0;                    _arg0 = data.readString();                    // æ­¤å¤„çš„ setName è°ƒç”¨çš„æ˜¯ IPerson ä¸­çš„ setName æ–¹æ³•ã€‚                    // å¦‚æœ Client å’Œ Server åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆå®ç° setName æ–¹æ³•çš„ï¼Œæ˜¯è¯¥ Binder å¯¹è±¡                    // å¦‚æœ Client å’Œ Server ä¸åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆå®ç° setName æ–¹æ³•çš„ï¼Œæ˜¯ Proxy å¯¹è±¡                    this.setName(_arg0);                    reply.writeNoException();                    return true;                &#125;                case TRANSACTION_getName: &#123;                    data.enforceInterface(descriptor);                    // åŒä¸Š                    java.lang.String _result = this.getName();                    reply.writeNoException();                    reply.writeString(_result);                    return true;                &#125;                default: &#123;                    return super.onTransact(code, data, reply, flags);                &#125;            &#125;        &#125;        // Proxy æ˜¯å½“ Client å’Œ Server ä¸æ˜¯åŒä¸€ä¸ªè¿›ç¨‹æ—¶ä½¿ç”¨çš„        private static class Proxy implements com.debuglife.aidl.test.IPerson &#123;            private android.os.IBinder mRemote;            Proxy(android.os.IBinder remote) &#123;                mRemote = remote;            &#125;            @Override            public android.os.IBinder asBinder() &#123;                return mRemote;            &#125;            public java.lang.String getInterfaceDescriptor() &#123;                return DESCRIPTOR;            &#125;            @Override            public void setName(java.lang.String aString) throws android.os.RemoteException &#123;                android.os.Parcel _data = android.os.Parcel.obtain();                android.os.Parcel _reply = android.os.Parcel.obtain();                try &#123;                    _data.writeInterfaceToken(DESCRIPTOR);                    _data.writeString(aString);                    // è¢«ä»£ç†çš„ Binder.Stub çš„ transact æ–¹æ³•ï¼Œç„¶åè¿™é‡Œé¢ä¼šæ¥ç€è°ƒç”¨ onTransact æ–¹æ³•                    mRemote.transact(Stub.TRANSACTION_setName, _data, _reply, 0);                    _reply.readException();                &#125; finally &#123;                    _reply.recycle();                    _data.recycle();                &#125;            &#125;            @Override            public java.lang.String getName() throws android.os.RemoteException &#123;                android.os.Parcel _data = android.os.Parcel.obtain();                android.os.Parcel _reply = android.os.Parcel.obtain();                java.lang.String _result;                try &#123;                    _data.writeInterfaceToken(DESCRIPTOR);                    // åŒä¸Š                    mRemote.transact(Stub.TRANSACTION_getName, _data, _reply, 0);                    _reply.readException();                    _result = _reply.readString();                &#125; finally &#123;                    _reply.recycle();                    _data.recycle();                &#125;                return _result;            &#125;        &#125;        // è¿™ä¸¤ä¸ªé™æ€å¸¸é‡æ˜¯ç”¨æ¥åœ¨ Binder é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¬¡ä¼ è¾“çš„ã€‚ç±»ä¼¼`startActivityForResult()`ä¸­çš„ codeã€‚        // Binder é€šä¿¡æ—¶ï¼ŒClient å‘ Server å‘èµ·è¯·æ±‚ï¼ŒServer å‘ Client è¿”å›è¯·æ±‚ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªã€é¸¡æ¯›ä¿¡ã€æ¥ç¡®å®šè¿™æ¬¡æ²Ÿé€šæ‰¾å¯¹äº†äººã€‚// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä»¬çš„å€¼åˆ†åˆ«æ˜¯ IBinder.FIRST_CALL_TRANSACTION + 0 å’Œ IBinder.FIRST_CALL_TRANSACTION + 1ï¼Œä¹Ÿå°±æ˜¯ 1 å’Œ 2ã€‚        // å¦‚æœæœ‰å¤šä¸ªæ–¹æ³•ï¼Œé‚£å°±ä¼šæœ‰å¤šä¸ªå¸¸é‡ï¼Œå€¼ä¹Ÿä¼šç»§ç»­é€’å¢ã€‚        static final int TRANSACTION_setName = (android.os.IBinder.FIRST_CALL_TRANSACTION + 0);        static final int TRANSACTION_getName = (android.os.IBinder.FIRST_CALL_TRANSACTION + 1);    &#125;    // AIDL æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œè¢«ç…§æ¬è¿‡æ¥ï¼ŒåŒæ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œæ–¹ä¾¿æ•è·    public void setName(java.lang.String aString) throws android.os.RemoteException;    public java.lang.String getName() throws android.os.RemoteException;&#125;</code></pre><p>Android Studio ä¼šæé†’æˆ‘ä»¬<strong>ä¸è¦ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶</strong>ã€‚å…¶å®ç¼–è¾‘äº†ä¹Ÿä¼šè¢«é‡æ–°è¦†ç›–æ‰ã€‚å› ä¸º AIDL ç”Ÿæˆçš„æ–‡ä»¶æ˜¯æŒ‰ç…§ä¸¥æ ¼çš„é€šä¿¡æ ¼å¼æ¥ç”Ÿæˆçš„ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œå¦åˆ™åœ¨ Binder é€šä¿¡è¿‡ç¨‹ä¸­å°±ä¼šå‡ºç°é”™è¯¯ã€‚</p><p>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ IPersion.java ä¸­éƒ½æœ‰äº›ä»€ä¹ˆï¼š</p><ul><li>IPerson æ¥å£ï¼Œç»§æ‰¿äº† IInterface æ¥å£ï¼›</li><li>åœ¨ AIDL æ–‡ä»¶ä¸­å£°æ˜çš„ä¸¤ä¸ªæ–¹æ³•<code>setName()</code>å’Œ<code>getName()</code>ã€‚ä¸åŒçš„æ˜¯ï¼Œå®ƒæŠ›å‡ºäº†<code>android.os.RemoteException</code>å¼‚å¸¸ï¼›</li><li>é™æ€æŠ½è±¡ç±»<code>Stub</code>ï¼›</li><li>Stub ç±»ä¸­çš„ç§æœ‰é™æ€ç±»<code>Proxy</code>ã€‚</li></ul><p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬åº”è¯¥å†™ä¸€ä¸ª Serviceï¼Œä½œä¸º Server ç«¯ã€‚Server ç«¯å½“ç„¶è¦æƒ³åŠæ³•å®ç°åˆšæ‰å®šä¹‰çš„<code>setName</code>å’Œ<code>getName</code>ï¼š</p><pre><code class="java">package com.debuglife.aidl.test;import android.app.Service;import android.content.Intent;import android.os.Binder;import android.os.IBinder;import android.os.Parcel;import android.os.RemoteException;import android.util.Log;import androidx.annotation.Nullable;public class AIDLService extends Service &#123;    private String name;    private Binder binder = new IPerson.Stub() &#123;        @Override        public boolean onTransact(int code, Parcel data, Parcel reply, int flags) throws RemoteException &#123;            return super.onTransact(code, data, reply, flags);        &#125;        @Override        public void setName(String s) throws RemoteException &#123;            name = s;        &#125;        @Override        public String getName() throws RemoteException &#123;            return name;        &#125;    &#125;;    @Nullable    @Override    public IBinder onBind(Intent intent) &#123;        // åœ¨æ­¤å¤„è¿”å›äº†ä¸Šé¢å£°æ˜çš„ Binder å®ä¾‹        return binder;    &#125;&#125;</code></pre><p>æ¥ä¸‹æ¥ï¼Œä¾¿éœ€è¦å°†è¿™ä¸ª Service åŠ å…¥ AndroidManifest ä¸­ï¼š</p><pre><code class="xml">&lt;service    android:name=&quot;.AIDLService&quot;    android:enabled=&quot;true&quot;    android:exported=&quot;true&quot; &gt;    &lt;intent-filter&gt;        &lt;action android:name=&quot;com.debuglife.aidl.test.IPersonService&quot; /&gt;    &lt;/intent-filter&gt;&lt;/service&gt;</code></pre><p>æ­¤å¤„çš„ actionï¼Œæ˜¯ç»™è·¨è¿›ç¨‹é€šä¿¡çš„ App ä½¿ç”¨çš„ï¼Œç°åœ¨æš‚æ—¶ç”¨ä¸åˆ°ã€‚</p><p>è‡³æ­¤ï¼ŒServer ç«¯çš„å·¥ä½œå®Œæˆï¼Œæ¥ä¸‹æ¥å°±è¦çœ‹çœ‹å¦‚ä½•å‘è¿™ä¸ª Server ç«¯å‘é€æ¶ˆæ¯äº†ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥ä¸ªã€C/SåŒè¿›ç¨‹ã€çš„ä¾‹å­ï¼Œåœ¨å½“å‰å·¥ç¨‹ä¸‹ï¼Œå†æ¥ä¸ª MainActivityï¼š</p><pre><code class="java">IPerson iPerson;ServiceConnection conn = new ServiceConnection(&#123;    @Override    void onServiceConnected(ComponentName name, IBinder service) &#123;        // å°† service è½¬æ¢ä¸º IPerson         iPerson = IPerson.Stub.asInterface(service);    &#125;    @Override    void onServiceDisconnected(ComponentName name) &#123;    &#125;&#125;);@Overridevoid onCreate(Bundle savedInstanceState) &#123;    super.onCreate(savedInstanceState);    setContentView(R.layout.activity_main);    Intent intent = new Intent(this, AIDLService.class);    bindService(intent, conn, Context.BIND_AUTO_CREATE);    iPerson.setName(&quot;DebugLife&quot;);    System.out.println(iPerson.getName());&#125;@Overridevoid onDestroy() &#123;    unbindService(conn);    super.onDestroy();&#125;</code></pre><p>æ€è·¯å¾ˆæ¸…æ™°ï¼Œä½¿ç”¨<code>bindService</code>æ–¹æ³•ï¼Œå°†ç›®æ ‡ Service ç»‘å®šï¼Œç„¶ååœ¨ ServiceConnection çš„å›è°ƒä¸­ï¼Œå°† iPerson èµ‹å€¼ä¸º Binder å®ä¾‹ï¼Œè¿™æ ·ï¼Œåœ¨æ¥ä¸‹æ¥å°±å¯ä»¥è°ƒç”¨ IPerson å®šä¹‰çš„æ–¹æ³•äº†ã€‚</p><p>é‚£ä¹ˆã€C/S ä¸åŒè¿›ç¨‹ã€çš„ï¼Œæ˜¯ä»€ä¹ˆæ­¥éª¤å‘¢ï¼Ÿ</p><ol><li>æˆ‘ä»¬éœ€è¦å°† Server ç«¯çš„ AIDL æ–‡ä»¶ï¼ŒæŒ‰åŸè·¯å¾„æ‹·è´åˆ° Client ç«¯å·¥ç¨‹ä¸­ï¼Œå¹¶ä¸”ç¼–è¯‘ä¸€éï¼Œç”Ÿæˆå¯¹åº”çš„ java æ–‡ä»¶ã€‚</li><li>åœ¨<code>bindService</code>æ—¶ï¼Œè¦ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</li></ol><pre><code class="java">Intent intent = new Intent();intent.action = &quot;com.debuglife.aidl.test.IPersonService&quot;;  // è¿™æ˜¯åˆšæ‰æˆ‘ä»¬åœ¨ Server ç«¯çš„ manifest ä¸­å®šä¹‰çš„ actionintent.setPackage(&quot;com.cy198706.review&quot;);  // åœ¨ Android 5.0 ä¹‹åï¼ŒIPC é€šä¿¡éœ€è¦ä½¿ç”¨æ˜¾å¼ Intentï¼Œä¹Ÿå³æŒ‡å®šæ¥æ”¶è€…bindService(intent, conn, Context.BIND_AUTO_CREATE);</code></pre><p>è¿™æ ·ï¼Œå°±èƒ½è¾¾åˆ° IPC çš„ç›®çš„äº†ã€‚</p><p>æœ‰çš„åŒå­¦è¦é—®äº†ï¼Œä½ è¿™å…‰ä¼ ä¸ª String å•Šï¼Œæˆ‘è¦ä¼ å¯¹è±¡æ€ä¹ˆåŠï¼Ÿ</p><p>åœ¨<a href="2020-04-14-serializable-and-parcelable.md">Serializableå’ŒParcelable</a>ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†ï¼ŒIPC ä¸­ï¼Œæ˜¯å¯ä»¥ä¼ é€’ Parcelable çš„ï¼Œé‚£ä¹ˆï¼Œåœ¨æ­¤å¤„ï¼Œåªéœ€è¦å°†å¯¹è±¡è½¬æ¢ä¸º Parcelableï¼Œå°±å¯ä»¥åšåˆ°äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Framework </tag>
            
            <tag> Binder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºçº¿ç¨‹å®‰å…¨çš„ä¸€åˆ‡</title>
      <link href="/2020-03-16/thread-safety/"/>
      <url>/2020-03-16/thread-safety/</url>
      
        <content type="html"><![CDATA[<p>è‡ªä»å¤šçº¿ç¨‹è¿™ä¸ªæ¦‚å¿µè¢«å‘æ˜ä¹‹åï¼Œåœ¨å¼€å‘ä¸­å°±æ— æ—¶æ— åˆ»ä¸å¾—æ“å¿ƒçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨äº†è§£çº¿ç¨‹å®‰å…¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Java çš„å†…å­˜æ¨¡å‹ï¼Œææ˜ç™½çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><span id="more"></span><h2 id="Java-çš„å†…å­˜æ¨¡å‹-â€”â€”-JMM"><a href="#Java-çš„å†…å­˜æ¨¡å‹-â€”â€”-JMM" class="headerlink" title="Java çš„å†…å­˜æ¨¡å‹ â€”â€” JMM"></a>Java çš„å†…å­˜æ¨¡å‹ â€”â€” JMM</h2><p>JMM(Java Memory Model),æ˜¯ä¸€ç§åŸºäºè®¡ç®—æœºå†…å­˜æ¨¡å‹ï¼ˆå®šä¹‰äº†å…±äº«å†…å­˜ç³»ç»Ÿä¸­å¤šçº¿ç¨‹ç¨‹åºè¯»å†™æ“ä½œè¡Œä¸ºçš„è§„èŒƒï¼‰ï¼Œå±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è®¿é—®å·®å¼‚çš„ï¼Œä¿è¯äº†Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹å¯¹å†…å­˜çš„è®¿é—®éƒ½èƒ½ä¿è¯æ•ˆæœä¸€è‡´çš„æœºåˆ¶åŠè§„èŒƒã€‚ä¿è¯å…±äº«å†…å­˜çš„<strong>åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§</strong>ã€‚</p><p>ç”¨ä¸€å¼ å›¾æ¥å±•ç¤ºä¸€ä¸ªå¤šçº¿ç¨‹çš„æ‰§è¡Œåœºæ™¯ï¼š</p><p><img src="/img/49.png"></p><p>çº¿ç¨‹ A å’Œçº¿ç¨‹ B åˆ†åˆ«å¯¹ä¸»å†…å­˜çš„å˜é‡è¿›è¡Œè¯»å†™æ“ä½œã€‚å…¶ä¸­ä¸»å†…å­˜ä¸­çš„å˜é‡ä¸º<strong>å…±äº«å˜é‡</strong>,ä¹Ÿå°±æ˜¯è¯´æ­¤å˜é‡åªæ­¤ä¸€ä»½ï¼Œå¤šä¸ªçº¿ç¨‹é—´å…±äº«ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜çš„å…±äº«å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹éœ€è¦è¯»å†™ä¸»å†…å­˜çš„å…±äº«å˜é‡æ—¶éœ€è¦å…ˆå°†è¯¥å˜é‡æ‹·è´ä¸€ä»½å‰¯æœ¬åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œç„¶ååœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­å¯¹è¯¥å˜é‡è¿›è¡Œæ‰€æœ‰æ“ä½œï¼Œçº¿ç¨‹å·¥ä½œå†…å­˜å¯¹å˜é‡å‰¯æœ¬å®Œæˆæ“ä½œä¹‹åéœ€è¦å°†ç»“æœåŒæ­¥è‡³ä¸»å†…å­˜ã€‚</p><p>:::tip<br>çº¿ç¨‹çš„å·¥ä½œå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰å†…å­˜ï¼Œçº¿ç¨‹é—´æ— æ³•äº’ç›¸è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜ã€‚<br>:::</p><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œç”¨å›¾æ¥æè¿°ä¸€ä¸‹çº¿ç¨‹å¯¹å˜é‡èµ‹å€¼çš„æµç¨‹ã€‚</p><p><img src="/img/50.png"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œçº¿ç¨‹å·¥ä½œå†…å­˜æ€ä¹ˆçŸ¥é“ä»€ä¹ˆæ—¶å€™åˆæ˜¯æ€æ ·å°†æ•°æ®åŒæ­¥åˆ°ä¸»å†…å­˜å‘¢ï¼Ÿ è¿™é‡Œå°±è½®åˆ° JMM å‡ºåœºäº†ã€‚ JMM è§„å®šäº†ä½•æ—¶ä»¥åŠå¦‚ä½•åšçº¿ç¨‹å·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚ç°åœ¨å¯ä»¥ä»‹ç»åˆšæ‰æåˆ°çš„ä¸‰ä¸ªç‰¹æ€§äº†ï¼š</p><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><blockquote><p>å¯¹å…±äº«å†…å­˜çš„ä¸€æ¬¡æ“ä½œï¼ˆæœ‰å¯èƒ½åŒ…å«æœ‰å¤šä¸ªå­æ“ä½œï¼‰è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼ˆç”Ÿæ•ˆï¼‰ï¼Œä¸”ä¸­é—´è¿‡ç¨‹ä¸èƒ½è¢«ä»»ä½•å¤–éƒ¨å› ç´ æ‰“æ–­ï¼›è¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œï¼ˆéƒ½ä¸ç”Ÿæ•ˆï¼‰ã€‚</p></blockquote><p>ä¸¾ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œé“¶è¡Œè½¬è´¦é—®é¢˜ï¼šæ¯”å¦‚ A å’Œ B åŒæ—¶å‘ C è½¬è´¦10ä¸‡å…ƒã€‚å¦‚æœè½¬è´¦æ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼ŒA åœ¨å‘ C è½¬è´¦æ—¶ï¼Œè¯»å–äº† C çš„ä½™é¢ä¸º20ä¸‡ï¼Œç„¶ååŠ ä¸Šè½¬è´¦çš„10ä¸‡ï¼Œè®¡ç®—å‡ºæ­¤æ—¶åº”è¯¥æœ‰30ä¸‡ï¼Œä½†è¿˜æœªæ¥åŠå°†30ä¸‡å†™å› C çš„è´¦æˆ·ï¼Œæ­¤æ—¶ B çš„è½¬è´¦è¯·æ±‚è¿‡æ¥äº†ï¼ŒB å‘ç° C çš„ä½™é¢ä¸º20ä¸‡ï¼Œç„¶åå°†å…¶åŠ 10ä¸‡å¹¶å†™å›ã€‚ç„¶å A çš„è½¬è´¦æ“ä½œç»§ç»­â€”â€”å°†30ä¸‡å†™å› C çš„ä½™é¢ã€‚è¿™ç§æƒ…å†µä¸‹ C çš„æœ€ç»ˆä½™é¢ä¸º30ä¸‡ï¼Œè€Œéé¢„æœŸçš„40ä¸‡ã€‚</p><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><blockquote><p>å¯è§æ€§æ˜¯æŒ‡ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«å˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹åˆ°ã€‚</p></blockquote><p>CPU ä»ä¸»å†…å­˜ä¸­è¯»æ•°æ®çš„æ•ˆç‡ç›¸å¯¹æ¥è¯´ä¸é«˜ï¼Œç°åœ¨ä¸»æµçš„è®¡ç®—æœºä¸­ï¼Œéƒ½æœ‰å‡ çº§ç¼“å­˜ã€‚æ¯ä¸ªçº¿ç¨‹è¯»å–å…±äº«å˜é‡æ—¶ï¼Œéƒ½ä¼šå°†è¯¥å˜é‡åŠ è½½è¿›å…¶å¯¹åº” CPU çš„é«˜é€Ÿç¼“å­˜é‡Œï¼Œä¿®æ”¹è¯¥å˜é‡åï¼ŒCPU ä¼šç«‹å³æ›´æ–°è¯¥ç¼“å­˜ï¼Œä½†å¹¶ä¸ä¸€å®šä¼šç«‹å³å°†å…¶å†™å›ä¸»å†…å­˜ï¼ˆå®é™…ä¸Šå†™å›ä¸»å†…å­˜çš„æ—¶é—´ä¸å¯é¢„æœŸï¼‰ã€‚æ­¤æ—¶å…¶å®ƒçº¿ç¨‹ï¼ˆå°¤å…¶æ˜¯ä¸åœ¨åŒä¸€ä¸ª CPU ä¸Šæ‰§è¡Œçš„çº¿ç¨‹ï¼‰è®¿é—®è¯¥å˜é‡æ—¶ï¼Œä»ä¸»å†…å­˜ä¸­è¯»åˆ°çš„å°±æ˜¯æ—§çš„æ•°æ®ï¼Œè€Œéç¬¬ä¸€ä¸ªçº¿ç¨‹æ›´æ–°åçš„æ•°æ®ã€‚</p><p>è¿™ä¸€ç‚¹æ˜¯æ“ä½œç³»ç»Ÿæˆ–è€…è¯´æ˜¯ç¡¬ä»¶å±‚é¢çš„æœºåˆ¶ï¼Œæ‰€ä»¥å¾ˆå¤šåº”ç”¨å¼€å‘äººå‘˜ç»å¸¸ä¼šå¿½ç•¥ã€‚</p><h3 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h3><blockquote><p>æœ‰åºæ€§æŒ‡çš„æ˜¯ï¼Œç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç¨‹åºçš„æ‰§è¡Œéƒ½æ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒJMM ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ï¼Œç¨‹åºçš„æ‰§è¡Œä¼šå˜æˆæ— åºã€‚</p></blockquote><p>ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹</p><pre><code class="java">boolean started = false; // è¯­å¥1long counter = 0L; // è¯­å¥2counter = 1; // è¯­å¥3started = true; // è¯­å¥4</code></pre><p>ä»ä»£ç é¡ºåºä¸Šçœ‹ï¼Œä¸Šé¢å››æ¡è¯­å¥åº”è¯¥ä¾æ¬¡æ‰§è¡Œï¼Œä½†å®é™…ä¸Š JVM çœŸæ­£åœ¨æ‰§è¡Œè¿™æ®µä»£ç æ—¶ï¼Œå¹¶ä¸ä¿è¯å®ƒä»¬ä¸€å®šå®Œå…¨æŒ‰ç…§æ­¤é¡ºåºæ‰§è¡Œã€‚</p><p>å¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºæ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå…¶ä¸­çš„ä¸€é¡¹ä¼˜åŒ–æ–¹å¼å°±æ˜¯è°ƒæ•´ä»£ç é¡ºåºï¼ŒæŒ‰ç…§æ›´é«˜æ•ˆçš„é¡ºåºæ‰§è¡Œä»£ç ã€‚</p><p>è®²åˆ°è¿™é‡Œï¼Œæœ‰äººè¦ç€æ€¥äº†â€”â€”ä»€ä¹ˆï¼ŒCPU ä¸æŒ‰ç…§æˆ‘çš„ä»£ç é¡ºåºæ‰§è¡Œä»£ç ï¼Œé‚£æ€ä¹ˆä¿è¯å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœå‘¢ï¼Ÿå®é™…ä¸Šï¼Œå¤§å®¶å¤§å¯æ”¾å¿ƒï¼ŒCPU è™½ç„¶å¹¶ä¸ä¿è¯å®Œå…¨æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œä½†å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆçš„æ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œæ—¶çš„ç»“æœä¸€è‡´ã€‚</p><h2 id="çº¿ç¨‹å®‰å…¨çš„æœ¬è´¨"><a href="#çº¿ç¨‹å®‰å…¨çš„æœ¬è´¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨çš„æœ¬è´¨"></a>çº¿ç¨‹å®‰å…¨çš„æœ¬è´¨</h2><p>å…¶å®ç¬¬ä¸€å¼ å›¾çš„ä¾‹å­æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸»å†…å­˜ä¸­çš„å˜é‡æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®è¯»å†™ï¼Œè€Œçº¿ç¨‹å·¥ä½œå†…å­˜åˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œçº¿ç¨‹é—´ä¸å¯äº’ç›¸è®¿é—®ã€‚é‚£åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå›¾ä¸Šçš„çº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶æ¥æ“ä½œå…±äº«å†…å­˜é‡Œçš„åŒä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆä¸»å†…å­˜å†…çš„æ­¤å˜é‡æ•°æ®å°±ä¼šè¢«ç ´åã€‚ä¹Ÿå°±æ˜¯è¯´ä¸»å†…å­˜å†…çš„æ­¤å˜é‡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br>æˆ‘ä»¬æ¥çœ‹ä¸ªä»£ç å°ä¾‹å­å¸®åŠ©ç†è§£ã€‚</p><pre><code class="java">public class ThreadDemo &#123;    private int x = 0;    private void count() &#123;        x++;    &#125;    public void runTest() &#123;        new Thread(() -&gt; &#123;            for(int i = 0; i &lt; 1000000; i++) &#123;                count();            &#125;            System.out.println(&quot;final x from 1: &quot; + num);        &#125;).start();        new Thread(() -&gt; &#123;            for(int i = 0; i &lt; 1000000; i++) &#123;                count();            &#125;            System.out.println(&quot;final x from 2: &quot; + num);        &#125;).start();    &#125;    public static void main(String[] args) &#123;        new ThreadDemo().runTest();    &#125;&#125;</code></pre><p>ç¤ºä¾‹ä»£ç ä¸­<code>runTest()</code>æ–¹æ³•2ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ 10000000 æ¬¡<code>count()</code>æ–¹æ³•,<br><code>count()</code>æ–¹æ³•ä¸­åªæ‰§è¡Œç®€å•çš„<code>x++</code>æ“ä½œ,ç†è®ºä¸Šæ¯æ¬¡æ‰§è¡Œ<code>runTest()</code>æ–¹æ³•åº”è¯¥æœ‰ä¸€ä¸ªçº¿ç¨‹è¾“å‡ºçš„<code>x</code>ç»“æœåº”è¯¥æ˜¯<code>2000000</code>ã€‚ä½†å®é™…çš„è¿è¡Œç»“æœå¹¶éæˆ‘ä»¬æ‰€æƒ³ï¼š</p><pre><code>final x from 1: 1010599final x from 2: 1909131</code></pre><p>å‡ºç°è¿™æ ·çš„ç»“æœçš„åŸå› ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸»å†…å­˜çš„<code>x</code>å˜é‡çš„æ•°æ®è¢«ç ´åäº†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“å®Œæˆä¸€æ¬¡<code>i++</code>ç›¸å½“äºæ‰§è¡Œäº†ä¸¤å¥ä»£ç ï¼š</p><pre><code class="java">int tmp = x + 1;x = tmp;</code></pre><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼šåœ¨æ‰§è¡Œå®Œ<code>int tmp = x + 1;</code>è¿™è¡Œä»£ç æ—¶å°±<strong>å‘ç”Ÿäº†çº¿ç¨‹åˆ‡æ¢</strong>ï¼Œå½“çº¿ç¨‹å†æ¬¡åˆ‡å›æ¥çš„æ—¶å€™ï¼Œ<code>x</code>å°±ä¼šè¢«<strong>é‡å¤èµ‹å€¼</strong>ï¼Œå¯¼è‡´å‡ºç°ä¸Šé¢çš„è¿è¡Œç»“æœï¼Œ2ä¸ªçº¿ç¨‹éƒ½æ— æ³•è¾“å‡º<code>2000000</code>ã€‚</p><p>ä¸‹å›¾æè¿°äº†ç¤ºä¾‹ä»£ç çš„æ‰§è¡Œæ—¶åºï¼š</p><p><img src="/img/51.png"></p><p>é‚£ä¹ˆ Java æ˜¯å¦‚ä½•æ¥è§£å†³ä¸Šè¿°é—®é¢˜æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¿è¯å…±äº«å†…å­˜çš„åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„å‘¢ï¼Ÿ</p><h2 id="Java-ä¸­å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#Java-ä¸­å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="Java ä¸­å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>Java ä¸­å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><p>Java ä¸­æä¾›äº†å‡ ç§æ–¹æ³•ï¼Œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h3 id="synchronizedå…³é”®å­—"><a href="#synchronizedå…³é”®å­—" class="headerlink" title="synchronizedå…³é”®å­—"></a><code>synchronized</code>å…³é”®å­—</h3><h4 id="ä¿è¯åŸå­æ€§"><a href="#ä¿è¯åŸå­æ€§" class="headerlink" title="ä¿è¯åŸå­æ€§"></a>ä¿è¯åŸå­æ€§</h4><p><code>synchronized</code>é€šè¿‡<a href="https://www.hollischuang.com/archives/2030">Monitorï¼ˆç›‘è§†é”ï¼‰</a>æ¥ä¿è¯â½…æ³•å†…éƒ¨æˆ–ä»£ç å—å†…éƒ¨èµ„æºï¼ˆæ•°æ®ï¼‰çš„äº’æ–¥è®¿é—®ï¼Œä»è€Œå®é™…ç›®æ ‡ä»£ç æ®µåŒä¸€æ—¶é—´åªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œè¿›è€Œä¿è¯äº†ç›®æ ‡ä»£ç æ®µçš„åŸå­æ€§ã€‚è¿™æ˜¯ä¸€ç§ä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„æ–¹æ³•ã€‚</p><p>::: tip<br>å…³äº Monitor å’Œ synchronized å®ç°åŸç†äº†è§£å¯ä»¥çœ‹ä¸‹è¿™2ç¯‡æ–‡ç« ï¼š<a href="http://www.hollischuang.com/archives/1883">Synchronized çš„å®ç°åŸç†</a>ã€ <a href="https://www.hollischuang.com/archives/2030">Moniter çš„å®ç°åŸç†</a><br>:::</p><p>å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„åŠ¨å›¾ï¼Œçœ‹çœ‹ Monitor æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><p><img src="/img/52.gif"></p><p>è¢«<code>synchronized</code>å…³é”®å­—æè¿°çš„æ–¹æ³•æˆ–ä»£ç å—åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹<strong>åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè®¿é—®</strong>ï¼Œåœ¨æŒæœ‰å½“å‰ Monitor çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹æƒ³è¦è°ƒç”¨ç›¸å…³æ–¹æ³•å°±å¿…é¡»è¿›è¡Œæ’é˜Ÿï¼Œç›´åˆ°æŒæœ‰å½“å‰ Monitor çš„çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œé‡Šæ”¾ Monitor ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰å¯è·å– Monitor æ‰§è¡Œã€‚<br>å¦‚æœå­˜åœ¨å¤šä¸ª Monitor çš„æƒ…å†µæ—¶ï¼Œå¤šä¸ª Monitor ä¹‹é—´æ˜¯<strong>ä¸äº’æ–¥</strong>çš„ã€‚</p><blockquote><p>å¤šä¸ª Monitor çš„æƒ…å†µå‡ºç°åœ¨è‡ªå®šä¹‰å¤šä¸ªé”åˆ†åˆ«æ¥æè¿°ä¸åŒçš„æ–¹æ³•æˆ–ä»£ç å—ï¼Œ<code>synchronized</code>åœ¨æè¿°ä»£ç å—æ—¶å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰ Monitor ï¼Œé»˜è®¤ä¸º <code>this</code>å³å½“å‰ç±»ã€‚</p></blockquote><p><img src="/img/53.gif"></p><h4 id="ä¿è¯å¯è§æ€§"><a href="#ä¿è¯å¯è§æ€§" class="headerlink" title="ä¿è¯å¯è§æ€§"></a>ä¿è¯å¯è§æ€§</h4><p>ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹ç›‘è§†èµ„æºçš„æ•°æ®åŒæ­¥ã€‚å³ä»»ä½•çº¿ç¨‹åœ¨è·å–åˆ° Monitor åçš„ç¬¬â¼€æ—¶é—´ï¼Œä¼šå…ˆå°†å…±äº«å†…å­˜ä¸­çš„æ•°æ®å¤åˆ¶åˆ°â¾ƒâ¼°çš„ç¼“å­˜ä¸­ï¼›ä»»ä½•çº¿ç¨‹åœ¨é‡Šæ”¾ Monitor çš„ç¬¬â¼€æ—¶é—´ï¼Œä¼šå…ˆå°†ç¼“å­˜ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å…±äº«å†…å­˜ä¸­ã€‚</p><h4 id="ä¿è¯çº¿ç¨‹é—´æ“ä½œçš„æœ‰åºæ€§"><a href="#ä¿è¯çº¿ç¨‹é—´æ“ä½œçš„æœ‰åºæ€§" class="headerlink" title="ä¿è¯çº¿ç¨‹é—´æ“ä½œçš„æœ‰åºæ€§"></a>ä¿è¯çº¿ç¨‹é—´æ“ä½œçš„æœ‰åºæ€§</h4><p><code>synchronized</code>çš„åŸå­æ€§ä¿è¯äº†ç”±å…¶æè¿°çš„æ–¹æ³•æˆ–ä»£ç æ“ä½œå…·æœ‰æœ‰åºæ€§ï¼ŒåŒä¸€æ—¶é—´åªèƒ½ç”±æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œä¸ä¼šè§¦å‘ JMM æŒ‡ä»¤é‡æ’æœºåˆ¶</p><h3 id="volatileå…³é”®å­—"><a href="#volatileå…³é”®å­—" class="headerlink" title="volatileå…³é”®å­—"></a><code>volatile</code>å…³é”®å­—</h3><h4 id="volatileä½œç”¨"><a href="#volatileä½œç”¨" class="headerlink" title="volatileä½œç”¨"></a><code>volatile</code>ä½œç”¨</h4><p>ä¿è¯è¢«<code>volatile</code>å…³é”®å­—æè¿°å˜é‡çš„æ“ä½œå…·æœ‰å¯è§æ€§å’Œæœ‰åºæ€§ï¼ˆç¦æ­¢æŒ‡ä»¤é‡æ’ï¼‰</p><p>::: tip æ³¨æ„</p><ol><li><code>volatile</code>åªå¯¹åŸºæœ¬ç±»å‹ (<code>byte</code>ã€<code>char</code>ã€<code>short</code>ã€<code>int</code>ã€<code>long</code>ã€<code>float</code>ã€<code>double</code>ã€<code>boolean</code>) çš„èµ‹å€¼æ“ä½œå’Œå¯¹è±¡çš„å¼•â½¤èµ‹å€¼æ“ä½œæœ‰æ•ˆã€‚</li><li>å¯¹äº<code>i++</code>æ­¤ç±»å¤åˆæ“ä½œï¼Œ <code>volatile</code>æ— æ³•ä¿è¯å…¶æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚</li><li>ç›¸å¯¹<code>synchronized</code>æ¥è¯´<code>volatile</code>æ›´åŠ è½»é‡ä¸€äº›ã€‚<br>:::</li></ol><h3 id="CASï¼ˆCompare-and-Swapï¼‰"><a href="#CASï¼ˆCompare-and-Swapï¼‰" class="headerlink" title="CASï¼ˆCompare and Swapï¼‰"></a>CASï¼ˆCompare and Swapï¼‰</h3><p><code>java.util.concurrent.atomic</code>åŒ…æä¾›äº†ä¸€ç³»åˆ—çš„<code>AtomicBoolean</code>ã€<code>AtomicInteger</code>ã€<code>AtomicLong</code>ç­‰ç±»ã€‚ä½¿ç”¨è¿™äº›ç±»æ¥å£°æ˜å˜é‡å¯ä»¥ä¿è¯å¯¹å…¶æ“ä½œå…·æœ‰åŸå­æ€§æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><p>å®ç°åŸç†ä¸Šä¸<code>synchronized</code>ä½¿ç”¨ Monitorï¼ˆç›‘è§†é”ï¼‰ä¿è¯èµ„æºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é˜»å¡äº’æ–¥è®¿é—®<strong>ä¸åŒ</strong>ï¼Œ<code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„å„ç§åŸå­ç±»åŸºäº<strong>CAS(CompareAndSwap) æ“ä½œåŸç†å®ç°</strong>ã€‚</p><p>::: tip CAS<br><a href="https://www.jianshu.com/p/ae25eb3cfb5d">CAS</a> åˆç§°æ— é”æ“ä½œï¼Œä¸€ç§ä¹è§‚é”ç­–ç•¥ï¼ŒåŸç†å°±æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å„çº¿ç¨‹è®¿é—®å…±äº«å˜é‡ä¸ä¼šåŠ é”é˜»å¡æ’é˜Ÿï¼Œçº¿ç¨‹ä¸ä¼šè¢«æŒ‚èµ·ã€‚é€šä¿—æ¥è®²å°±æ˜¯ä¸€ç›´å¾ªç¯å¯¹æ¯”ï¼Œå¦‚æœæœ‰è®¿é—®å†²çªåˆ™é‡è¯•ï¼Œç›´åˆ°æ²¡æœ‰å†²çªä¸ºæ­¢ã€‚<br>:::</p><p>åˆšæ‰æåˆ°çš„<code>x++</code>æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨<code>AtomicInteger</code>ç±»æ¥å®Œæˆï¼š</p><pre><code class="java">private AtomicInteger x = new AtomicInteger(0);private void count() &#123;    x.incrementAndGet();&#125;AtomicInteger x = new AtomicInteger();new Thread(() -&gt; &#123;    for(int i = 0; i &lt; 1000000; i++) &#123;        count();    &#125;&#125;).start();</code></pre><p>ç°åœ¨å†æ£€æŸ¥è¾“å‡ºï¼š</p><pre><code>final x from 1: 1941014final x from 2: 2000000</code></pre><h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a><code>Lock</code></h3><p>é”æœºåˆ¶ç”±æ¥å·²ä¹…ï¼Œåœ¨ Linux ä¸­ä¹Ÿé¢‘ç¹ä½¿ç”¨äº†é”æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><p>Java æä¾›äº†ä¸€ç³»åˆ—çš„é”æ“ä½œæ–¹æ³•ã€‚åœ¨<code>java.util.concurrent</code> åŒ…ä¸‹ï¼Œæœ‰ä¸€ä¸ª<code>Lock</code>æ¥å£ã€‚ä¸»è¦æœ‰ <code>ReentrantLock</code>ï¼Œ<code>ReentrantReadWriteLock.ReadLock</code>ï¼Œ<code>ReentrantReadWriteLock.WriteLock</code> å®ç°ç±»ã€‚ä¸ <code>synchronized</code> ä¸åŒæ˜¯ <code>Lock</code> æä¾›äº†è·å–é”å’Œé‡Šæ”¾é”ç­‰ç›¸å…³æ¥å£ï¼Œä½¿å¾—ä½¿ç”¨ä¸Šæ›´åŠ çµæ´»ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åšæ›´åŠ å¤æ‚çš„æ“ä½œã€‚</p><p>ä¹‹å‰çš„ä¾‹å­å¯ä»¥åšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š</p><pre><code class="java">private int num = 0;ReentrantReadWriteLock lock = new ReentrantReadWriteLock();Lock readLock = lock.readLock();Lock writeLock = lock.writeLock();private void count() &#123;    writeLock.lock();    try &#123;        num++;    &#125; finally &#123;        writeLock.unlock();    &#125;&#125;...</code></pre><p>è¾“å…¥ç»“æœï¼š</p><pre><code>final x from 1: 1707334final x from 2: 2000000</code></pre><p>å…³äº Lock å®ç°åŸç†å’Œæ›´è¯¦ç»†çš„ä½¿ç”¨æ¨èä»¥ä¸‹2ç¯‡æ–‡ç« ï¼š<br><a href="https://juejin.im/post/5ab9a5b46fb9a028ce7b9b7e#heading-2">Locké”çš„ä½¿ç”¨</a><br><a href="https://juejin.im/entry/5b4ddf6d6fb9a04f97650336">Locké”æºç åˆ†æ</a></p><h2 id="ä¸€äº›å…¶ä»–çš„é—®é¢˜"><a href="#ä¸€äº›å…¶ä»–çš„é—®é¢˜" class="headerlink" title="ä¸€äº›å…¶ä»–çš„é—®é¢˜"></a>ä¸€äº›å…¶ä»–çš„é—®é¢˜</h2><blockquote><p>Q: æ—¢ç„¶é”å’Œsynchronizedå³å¯ä¿è¯åŸå­æ€§ä¹Ÿå¯ä¿è¯å¯è§æ€§ï¼Œä¸ºä½•è¿˜éœ€è¦volatileï¼Ÿ</p></blockquote><p><code>synchronized</code>å’Œé”éœ€è¦é€šè¿‡æ“ä½œç³»ç»Ÿæ¥ä»²è£è°è·å¾—é”ï¼Œå¼€é”€æ¯”è¾ƒé«˜ï¼Œè€Œ<code>volatile</code>å¼€é”€å°å¾ˆå¤šã€‚å› æ­¤åœ¨åªéœ€è¦ä¿è¯å¯è§æ€§çš„æ¡ä»¶ä¸‹ï¼Œä½¿ç”¨<code>volatile</code>çš„æ€§èƒ½è¦æ¯”ä½¿ç”¨é”å’Œ<code>synchronized</code>é«˜å¾—å¤šã€‚</p><blockquote><p>Q: æ—¢ç„¶é”å’Œsynchronizedå¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦AtomicIntegerè¿™ç§çš„ç±»æ¥ä¿è¯åŸå­æ“ä½œï¼Ÿ</p></blockquote><p>é”å’Œ<code>synchronized</code>éœ€è¦é€šè¿‡æ“ä½œç³»ç»Ÿæ¥ä»²è£è°è·å¾—é”ï¼Œå¼€é”€æ¯”è¾ƒé«˜ï¼Œè€Œ<code>AtomicInteger</code>æ˜¯é€šè¿‡ CPU çº§çš„ CAS æ“ä½œæ¥ä¿è¯åŸå­æ€§ï¼Œå¼€é”€æ¯”è¾ƒå°ã€‚æ‰€ä»¥ä½¿ç”¨<code>AtomicInteger</code>çš„ç›®çš„è¿˜æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚</p><blockquote><p>Q: <code>synchronized</code>æ—¢å¯ä¿®é¥°éé™æ€æ–¹æ³•ï¼Œä¹Ÿå¯ä¿®é¥°é™æ€æ–¹æ³•ï¼Œè¿˜å¯ä¿®é¥°ä»£ç å—ï¼Œä¹Ÿèƒ½ä¿®é¥°ç±»ï¼Œæœ‰ä½•åŒºåˆ«ï¼Ÿ</p></blockquote><ul><li><strong>ä¿®é¥°ä¸€ä¸ªéé™æ€æ–¹æ³•</strong>ï¼šè¢«ä¿®é¥°çš„æ–¹æ³•ç§°ä¸ºåŒæ­¥æ–¹æ³•ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼›</li><li><strong>ä¿®é¥°ä¸€ä¸ªé™æ€çš„æ–¹æ³•</strong>ï¼šå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªé™æ€æ–¹æ³•ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ï¼›</li><li><strong>ä¿®é¥°ä¸€ä¸ªä»£ç å—</strong>ï¼šè¢«ä¿®é¥°çš„ä»£ç å—ç§°ä¸ºåŒæ­¥è¯­å¥å—ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯å¤§æ‹¬å·{}æ‹¬èµ·æ¥çš„ä»£ç ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªä»£ç å—çš„å¯¹è±¡ï¼›</li><li><strong>ä¿®é¥°ä¸€ä¸ªç±»</strong>ï¼šæ˜¯ç»™è¿™ä¸ªç±»åŠ é”ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ã€‚</li></ul><p>synchronized å½“é‡è§å¼‚å¸¸æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼›è€Œ ReentrantLock åœ¨é‡è§å¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥ï¼Œéƒ½ä¼šåœ¨ try-catch çš„ finally å—é‡Œè¿›è¡Œé‡Šæ”¾</p><p>ReentrantLock å¯ä»¥ä¼ å…¥ bool fair ä½¿ç”¨å…¬å¹³é”</p><p>ReentrantReadWriteLock readLock() å’Œ writeLock() </p><p>wait() ä¼šå¼ºåˆ¶å½“å‰çº¿ç¨‹æŒ‚èµ·ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ notify() æˆ–è€… notifyAll()</p><p>synchronized ï¼š<strong>å¯¹è±¡å¤´</strong>å’Œ monitorã€‚nomitor æ˜¯ä¸€ä¸ªä¿å­˜åœ¨å¯¹è±¡å¤´ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚å¯¹è±¡å¤´æ˜¯åœ¨æ–°å»ºå¯¹è±¡æ—¶ï¼Œåœ¨å †ä¸­å»ºç«‹äº†å¯¹è±¡å¤´å’Œå¯¹è±¡æ•°æ®ï¼Œé‡Œé¢åŒ…å«é”ã€hashCode ç­‰æ•°æ®ã€‚monitor ä½¿ç”¨çš„æ˜¯è®¡æ•°å™¨æ–¹å¼æ¥å®ç°åŒæ­¥æœºåˆ¶çš„ã€‚å®ƒçš„åŒæ­¥æœºåˆ¶æ˜¯ JVM å¯¹æ“ä½œç³»ç»Ÿçº§åˆ«çš„ Mutex Lockï¼ˆäº’æ–¥é”ï¼‰çš„ç®¡ç†è¿‡ç¨‹ï¼Œè¿è¡Œæ˜¯å†…æ ¸æ€ã€‚</p><p>é”è‡ªæ—‹ï¼šçº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’éœ€è¦ CPU ä»ç”¨æˆ·æ€è½¬æ¢ä¸ºæ ¸å¿ƒæ€ï¼Œè€Œé¢‘ç¹çš„é˜»å¡å’Œå”¤é†’å¯¹ CPU æ¥è¯´æ˜¯è´Ÿæ‹…å¾ˆé‡çš„å·¥ä½œï¼Œæ‰€ä»¥ Java å¼•å…¥äº†è‡ªæ—‹é”çš„æ“ä½œã€‚é»˜è®¤æ˜¯å¼€å¯çš„ã€‚æ‰€è°“è‡ªæ—‹ï¼Œå°±æ˜¯æ‰§è¡Œä¸€æ®µæ— æ„ä¹‰çš„å¾ªç¯ï¼Œä¸ä¼šè¢«ç«‹å³æŒ‚èµ·ï¼Œç­‰å¾…çœ‹çœ‹å½“å‰æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦è¢«å¾ˆå¿«è¢«é‡Šæ”¾ã€‚ç¼ºé™·ï¼šå®ƒè¦å ç”¨ CPUï¼Œæœ‰å¯èƒ½ç™½ç™½æµªè´¹èµ„æºã€‚</p><p>è½»é‡çº§é”ï¼šå¯¹äºä¸€å—åŒæ­¥ä»£ç ï¼Œè™½ç„¶ä¼šæœ‰å¤šä¸ªä¸åŒçº¿ç¨‹å»æ‰§è¡Œï¼Œä½†è¿™äº›çº¿ç¨‹æ˜¯åœ¨ä¸åŒçš„æ—¶é—´æ®µäº¤æ›¿è¯·æ±‚é”å¯¹è±¡ï¼Œæ‰€ä»¥ä¸å­˜åœ¨é”ç«äº‰æƒ…å†µã€‚å¯ä»¥é¿å…é˜»å¡å’Œå”¤é†’æ“ä½œã€‚é€‚åˆçº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„å¿—åˆã€‚å¦‚æœå­˜åœ¨åŒä¸€æ—¶é—´è®¿é—®åŒä¸€ä¸ªé”çš„åœºåˆï¼Œåˆ™è½»é‡çº§é”ä¼šå˜ä¸ºé‡é‡çº§é”ã€‚</p><p>é‡é‡çº§é”ï¼šsynchronized å°±æ˜¯é‡é‡çº§é”ã€‚</p><p>åå‘é”ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è·å¾—äº†åå‘é”ï¼Œåœ¨æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¸å®ƒæŠ¢å é”ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹ä¸‹æ¬¡å†æ¬¡è¿›å…¥æˆ–é€€å‡ºåŒæ­¥ä»£ç å—ï¼Œå°±ä¸éœ€è¦å†è¿›è¡ŒæŠ¢å é”å’Œé‡Šæ”¾é”çš„æ“ä½œã€‚baisedLockingã€‚ä¸€æ—¦å‡ºç°ç«äº‰ï¼Œåå‘é”ä¼šè¢«æ’¤é”€ï¼Œå¹¶è†¨èƒ€æˆè½»é‡çº§é”ã€‚</p><p>DVM å¯¹ JVM åšäº†å“ªäº›ä¼˜åŒ–ï¼š</p><ol><li>Dalvik æ˜¯ Google å…¬å¸è‡ªå·±è®¾è®¡çš„åŸºäº Java çš„è™šæ‹Ÿæœºã€‚5.0ä¹‹å‰å«DVMï¼Œ5.0ä¹‹åå« ARTï¼ˆAndroid Runtimeï¼‰</li><li>å¤§å¤šæ•°å®ç°ä¸ JVM ç›¸åŒ</li><li>ä½¿ç”¨äº† Dex æ–‡ä»¶ã€‚ä¼ ç»Ÿ Java æ˜¯å°† Java æºä»£ç è½¬æ¢æˆ .class æ–‡ä»¶ï¼Œè€Œ Android ä¸­æ˜¯å°†æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆ classes.dex æ–‡ä»¶ï¼Œå»æ‰äº† class æ–‡ä»¶ä¸­çš„å†—ä½™å­—æ®µï¼ˆæ¯”å¦‚é‡å¤çš„å­—ç¬¦å¸¸é‡ï¼‰ï¼Œç»“æ„ä¹Ÿæ›´åŠ ç´§å‡‘ï¼Œæ‰€ä»¥åœ¨å®ƒçš„è§£æé˜¶æ®µï¼Œæ•ˆç‡ä¼šæ›´é«˜ï¼Œæé«˜äº†ç±»çš„æŸ¥æ‰¾å’ŒåŠ è½½é€Ÿåº¦ã€‚</li><li>DMV çš„æŒ‡ä»¤é›†æ¶æ„åŸºäºå¯„å­˜å™¨ &amp;&amp; æ ˆå †ç»“æ„ï¼Œè€Œ JVM çš„æŒ‡ä»¤é›†æ˜¯åŸºäºæ ˆç»“æ„æ¥æ‰§è¡Œçš„ã€‚æŒ‡ä»¤ä¼šå˜é•¿ï¼Œä½†æ˜¯æŒ‡ä»¤æ¡æ•°ä¼šå˜å°‘ï¼Œæ‰§è¡Œæ›´åŠ å¿«é€Ÿã€‚</li><li>Android ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ª Dalvik è™šæ‹Ÿæœºæ˜¯ç”± Zygote è¿›ç¨‹åˆ›å»ºçš„ï¼Œåº”ç”¨ç¨‹åºæ˜¯ç”± Zygote fork å‡ºæ¥çš„ï¼Œäºæ˜¯ï¼ŒDVM å†…å­˜ä¸­çš„å †è¢«åˆ’åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼šActiveHeap å’Œ Zygote Heapã€‚Zygote è¿›ç¨‹åˆ›å»º Dalvik è™šæ‹Ÿæœºæ—¶ï¼Œåªæœ‰ä¸€ä¸ªå †ï¼Œä½†æ˜¯ Zygote è¿›è¡Œåœ¨ fork ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¿›ç¨‹ä¹‹å‰ ï¼Œä¼šå°†å·²ç»ä½¿ç”¨çš„é‚£éƒ¨åˆ†å †å†…å­˜åˆ’åˆ†ä¸ºä¸€éƒ¨åˆ†ï¼Œå…¶ä½™çš„åˆ’åˆ†ä¸ºå¦ä¸€éƒ¨åˆ†ã€‚å‰è€…å°±æ˜¯ ZygoteHeapï¼Œåè€…å°±æ˜¯ ActiveHeapã€‚ä»¥åï¼Œæ— è®ºæ˜¯ Zygote è¿›ç¨‹è¿˜æ˜¯åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œåªè¦ä½¿ç”¨å †ï¼Œå°±åœ¨ ActiveHeap ä¸Šè¿›è¡Œï¼›è¿™å°±èƒ½ä½¿ç”¨ Zygote å †èƒ½å°½é‡å‡å°‘æ‹·è´æ“ä½œã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Thread </tag>
            
            <tag> Thread-Safe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºçº¿ç¨‹æ± çš„ä¸€åˆ‡</title>
      <link href="/2020-03-14/thread-pool/"/>
      <url>/2020-03-14/thread-pool/</url>
      
        <content type="html"><![CDATA[<p>çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰å¯¹äº<strong>é™åˆ¶åº”ç”¨ç¨‹åºä¸­åŒä¸€æ—¶åˆ»è¿è¡Œçš„çº¿ç¨‹æ•°</strong>å¾ˆæœ‰ç”¨ã€‚å› ä¸ºæ¯å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹éƒ½ä¼šæœ‰ç›¸åº”çš„æ€§èƒ½å¼€é”€ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ç»™æ ˆåˆ†é…ä¸€äº›å†…å­˜ç­‰ç­‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠå¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ä¼ é€’ç»™ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ¥æ›¿ä»£ä¸ºæ¯ä¸ªå¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡éƒ½å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚åªè¦æ± é‡Œ<strong>æœ‰ç©ºé—²çš„çº¿ç¨‹</strong>ï¼Œä»»åŠ¡å°±ä¼šåˆ†é…ç»™ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åœ¨çº¿ç¨‹æ± çš„å†…éƒ¨ï¼Œä»»åŠ¡è¢«æ’å…¥ä¸€ä¸ª<strong>é˜»å¡é˜Ÿåˆ—</strong>ï¼ˆBlocking Queue ï¼‰ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ä¼šå»<strong>å–è¿™ä¸ªé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡</strong>ã€‚å½“ä¸€ä¸ªæ–°ä»»åŠ¡æ’å…¥é˜Ÿåˆ—æ—¶ï¼Œä¸€ä¸ªç©ºé—²çº¿ç¨‹å°±ä¼šæˆåŠŸçš„ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶ä¸”æ‰§è¡Œå®ƒã€‚</p><p>çº¿ç¨‹æ± ç»å¸¸åº”ç”¨åœ¨å¤šçº¿ç¨‹æœåŠ¡å™¨ä¸Šã€‚æ¯ä¸ªé€šè¿‡ç½‘ç»œåˆ°è¾¾æœåŠ¡å™¨çš„è¿æ¥éƒ½è¢«åŒ…è£…æˆä¸€ä¸ªä»»åŠ¡å¹¶ä¸”ä¼ é€’ç»™çº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„çº¿ç¨‹ä¼šå¹¶å‘çš„å¤„ç†è¿æ¥ä¸Šçš„è¯·æ±‚ã€‚</p><p>åˆç†åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„ã€‚</p><ol><li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹<strong>é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—</strong>ã€‚</li><li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½<strong>ç«‹å³æ‰§è¡Œ</strong>ã€‚</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± <strong>å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§</strong>ã€‚ä½†æ˜¯è¦åšåˆ°åˆç†çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶åŸç†äº†å¦‚æŒ‡æŒã€‚</li></ol><span id="more"></span><h2 id="çº¿ç¨‹æ± çš„åˆ›å»º"><a href="#çº¿ç¨‹æ± çš„åˆ›å»º" class="headerlink" title="çº¿ç¨‹æ± çš„åˆ›å»º"></a>çº¿ç¨‹æ± çš„åˆ›å»º</h2><p><code>java.util.concurrent</code>åŒ…ä¸­æä¾›äº†ä¸€ä¸ªå«<code>ThreadPoolExecutor</code>çš„ç±»ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼š</p><pre><code class="java">public ThreadPoolExecutor(int corePoolSize,                              int maximumPoolSize,                              long keepAliveTime,                              TimeUnit unit,                              BlockingQueue&lt;Runnable&gt; workQueue,                              ThreadFactory threadFactory,                              RejectedExecutionHandler handler) &#123;    ...&#125;</code></pre><p>å®ƒåœ¨åˆ›å»ºæ—¶æœ€å¤šå¯ä»¥ä¼ å…¥7ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><p><strong><code>corePoolSize</code><strong>ï¼šçº¿ç¨‹æ± çš„</strong>æ ¸å¿ƒçº¿ç¨‹</strong>æ•°é‡ã€‚å½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿å…¶ä»–ç©ºé—²çš„åŸºæœ¬çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºçº¿ç¨‹ï¼Œç­‰åˆ°<strong>éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°å¤§äºçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°é‡æ—¶å°±ä¸å†åˆ›å»º</strong>ã€‚å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„<code>prestartAllCoreThreads</code>æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰åŸºæœ¬çº¿ç¨‹ã€‚æ ¸å¿ƒçº¿ç¨‹ä¸ä¼šè‡ªåŠ¨å›æ”¶ï¼Œä½†å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„<code>allowCoreThreadTimeOut()</code>æ–¹æ³•ï¼Œæ ¸å¿ƒçº¿ç¨‹ç©ºé—²æ—¶é—´è¾¾åˆ°<code>keepAliveTime</code>ä¹‹åï¼Œå°±ä¼šè¢«å›æ”¶ã€‚</p><p><strong><code>maximumPoolSize</code><strong>ï¼šçº¿ç¨‹æ± çš„</strong>æœ€å¤§</strong>å¤§å°ã€‚ä¹Ÿå³çº¿ç¨‹æ± å†…èƒ½å®¹çº³çš„<strong>æœ€å¤§çš„çº¿ç¨‹æ•°é‡</strong>ã€‚<code>çº¿ç¨‹æ± æœ€å¤§æ•°é‡ - æ ¸å¿ƒçº¿ç¨‹æ•° = éæ ¸å¿ƒçº¿ç¨‹æ•°</code>ã€‚éæ ¸å¿ƒçº¿ç¨‹åœ¨ç©ºé—´æ—¶é—´è¾¾åˆ°<code>keepAliveTime</code>ä¹‹åï¼Œå°±ä¼šè¢«å›æ”¶ã€‚</p><p>**<code>keepAliveTime</code>å’Œ<code>unit</code>**ï¼šå½“çº¿ç¨‹çš„æ•°é‡å¤§äº<code>corePoolSize</code>çš„æ—¶å€™ï¼Œçº¿ç¨‹çš„å­˜æ´»æ—¶é—´ã€‚<code>keepAliveTime</code>å’Œ<code>unit</code>ä¸¤ä¸ªå‚æ•°è¦é…åˆä½¿ç”¨ã€‚<code>unit</code>çš„å¯é€‰å€¼æœ‰<code>DAYS</code>|<code>HOURS</code>|<code>MINUTES</code>|<code>SECONDS</code>|<code>MILLISECONDS</code>|<code>MICROSECONDS</code>|<code>NANOSECONDS</code>ï¼Œè¶…æ—¶åå°±ä¼šå›æ”¶ã€‚æ— è®ºé€‰ç”¨å“ªç§<code>unit</code>ï¼Œåœ¨ä¼ å…¥åéƒ½ä¼šè¢«è½¬æˆ NanoSecondsã€‚</p><p><strong><code>workQueue</code><strong>ï¼šæŒæœ‰ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œä¹Ÿå³æˆ‘ä»¬å¸¸è¯´çš„</strong>é˜»å¡é˜Ÿåˆ—</strong>ã€‚è¿™ä¸ªé˜Ÿåˆ—åªä¼šæŒæœ‰é€šè¿‡è°ƒç”¨<code>execute()</code>æ–¹æ³•æäº¤çš„ Runnable ä»»åŠ¡ã€‚BlockingQueue å®ä¾‹å¯é€‰çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>ArrayBlockingQueueï¼šæ˜¯ä¸€ä¸ªåŸºäº<strong>æ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</strong>ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li>LinkedBlockingQueueï¼šä¸€ä¸ªåŸºäº<strong>é“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—</strong>ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueã€‚é™æ€å·¥å‚æ–¹æ³•<code>Executors.newFixedThreadPool()</code>ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li>SynchronousQueueï¼šä¸€ä¸ª<strong>ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—</strong>ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼Œé™æ€å·¥å‚æ–¹æ³•<code>Executors.newCachedThreadPool</code>ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li>PriorityBlockingQueueï¼šä¸€ä¸ª<strong>å…·æœ‰ä¼˜å…ˆçº§æœ‰æ— é™é˜»å¡é˜Ÿåˆ—</strong>ã€‚</li><li>DelayedWorkQueue: ä¸€ä¸ª<strong>å…·æœ‰å»¶è¿Ÿæ‰§è¡ŒåŠŸèƒ½çš„é˜Ÿåˆ—</strong></li></ul><p>**<code>threadFactory</code>**ï¼šæ‰§è¡Œå™¨åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ—¶ä¼šç”¨åˆ°çš„å·¥å‚ã€‚å¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ï¼ŒDebug å’Œå®šä½é—®é¢˜æ—¶éå¸¸åˆå¸®åŠ©ã€‚</p><p>**<code>handler</code>**ï¼šé¥±å’Œç­–ç•¥ã€‚å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚è¿™ä¸ªç­–ç•¥é»˜è®¤æƒ…å†µä¸‹æ˜¯AbortPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ä»¥ä¸‹æ˜¯ JDK1.5 æä¾›çš„å››ç§ç­–ç•¥ã€‚</p><ul><li>AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸</li><li>CallerRunsPolicyï¼š<strong>åªç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹</strong>æ¥è¿è¡Œä»»åŠ¡ã€‚</li><li>DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œ<strong>æœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡</strong>ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚</li><li>DiscardPolicyï¼šä¸å¤„ç†ï¼Œä¸¢å¼ƒæ‰ã€‚</li></ul><p>å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯éœ€è¦æ¥å®ç° RejectedExecutionHandler æ¥å£è‡ªå®šä¹‰ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</p><blockquote><p>åœ¨ Android çš„ AsyncTask ä¸­å°±ä½¿ç”¨äº† RejectedExecutionHandler æ¥å®ç°äº†å¤‡ç”¨çº¿ç¨‹æ± ã€‚</p></blockquote><h2 id="å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡"><a href="#å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡" class="headerlink" title="å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡"></a>å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡</h2><p>å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š<code>execute()</code>å’Œ<code>submit()</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ä¸ªæ–¹æ³•çš„æºç ï¼Œæ¯”è¾ƒä¸‹æœ‰ä»€ä¹ˆä¸åŒï¼š</p><p>**<code>execute()</code>**ï¼š</p><pre><code class="java"> /** * åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ã€‚è¯¥ä»»åŠ¡æœ‰å¯èƒ½åœ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹æˆ–è€…æ˜¯å·²å­˜åœ¨çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ * * å¦‚æœä»»åŠ¡æ— æ³•è¢«æ·»åŠ ï¼Œè¦ä¹ˆå°±æ˜¯å› ä¸ºå®ƒçš„æ‰§è¡Œå™¨è¢«å›æ”¶äº†ï¼Œè¦ä¹ˆå°±æ˜¯è¾¾åˆ°äº†çº¿ç¨‹æ± çš„æœ€å¤§å®¹é‡ï¼Œè¯¥ä»»åŠ¡å°±ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚ */public void execute(Runnable command) &#123;    if (command == null)        throw new NullPointerException();    // è·å¾—å½“å‰çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¯¹åº”çš„äºŒè¿›åˆ¶çŠ¶æ€ç         int c = ctl.get();    // åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°é‡æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œå¦‚æœå°äºå°±ç›´æ¥åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œåˆ›å»ºæˆåŠŸç›´æ¥è·³å‡ºï¼Œå¤±è´¥åˆ™æ¥ç€å¾€ä¸‹èµ°.    if (workerCountOf(c) &lt; corePoolSize) &#123;        if (addWorker(command, true))            return;        c = ctl.get();    &#125;    // åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦ä¸ºRUNNINGçŠ¶æ€ï¼Œå¹¶ä¸”å°†ä»»åŠ¡æ·»åŠ è‡³é˜Ÿåˆ—ä¸­    if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;        int recheck = ctl.get();        // å®¡æ ¸çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯RUNNINGçŠ¶æ€ï¼Œç›´æ¥ç§»å‡ºé˜Ÿåˆ—ä¸­        if (!isRunning(recheck) &amp;&amp; remove(command))            reject(command);        // å¦‚æœå½“å‰çº¿ç¨‹æ•°é‡ä¸º0ï¼Œåˆ™å•ç‹¬åˆ›å»ºçº¿ç¨‹ï¼Œè€Œä¸æŒ‡å®šä»»åŠ¡.        else if (workerCountOf(recheck) == 0)            addWorker(null, false);    &#125;    // å¦‚æœä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœåˆ›å»ºå¤±è´¥ï¼Œè°ƒç”¨ reject() æ–¹æ³•.    else if (!addWorker(command, false))        reject(command);&#125;</code></pre><p><code>addWorker()</code>æ–¹æ³•æ˜¯åˆ›å»ºçº¿ç¨‹ä¸»è¦çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸‹ï¼š</p><pre><code class="java">private boolean addWorker(Runnable firstTask, boolean core) &#123;    retry:    for (;;) &#123;        // è·å¾—å½“å‰çº¿ç¨‹çš„çŠ¶æ€        int c = ctl.get();        int rs = runStateOf(c);        // åªåœ¨å¿…è¦çš„æƒ…å†µä¸‹æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º        if (rs &gt;= SHUTDOWN &amp;&amp;            ! (rs == SHUTDOWN &amp;&amp;                firstTask == null &amp;&amp;                ! workQueue.isEmpty()))            return false;        for (;;) &#123;            // è·å–æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹æ•°é‡            int wc = workerCountOf(c);            if (wc &gt;= CAPACITY ||                wc &gt;= (core ? corePoolSize : maximumPoolSize))                return false;            if (compareAndIncrementWorkerCount(c))                break retry;            c = ctl.get();  // Re-read ctl            if (runStateOf(c) != rs)                continue retry;            // else CAS failed due to workerCount change; retry inner loop        &#125;    &#125;    boolean workerStarted = false;    boolean workerAdded = false;    Worker w = null;    try &#123;        // æ–°å»ºä¸€ä¸ª Worker        w = new Worker(firstTask);        final Thread t = w.thread;        if (t != null) &#123;            // ä½¿ç”¨ Lock æœºåˆ¶å‘æ± ä¸­æ·»åŠ å·¥ä½œçº¿ç¨‹            final ReentrantLock mainLock = this.mainLock;            mainLock.lock();            try &#123;                // Recheck while holding lock.                // Back out on ThreadFactory failure or if                // shut down before lock acquired.                int rs = runStateOf(ctl.get());                if (rs &lt; SHUTDOWN ||                    (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123;                    if (t.isAlive()) // precheck that t is startable                        throw new IllegalThreadStateException();                    workers.add(w);                    int s = workers.size();                    if (s &gt; largestPoolSize)                        largestPoolSize = s;                    workerAdded = true;                &#125;            &#125; finally &#123;                mainLock.unlock();            &#125;            if (workerAdded) &#123;                t.start();                workerStarted = true;            &#125;        &#125;    &#125; finally &#123;        if (! workerStarted)            addWorkerFailed(w);    &#125;    return workerStarted;&#125;</code></pre><p>**<code>submit()</code>**ï¼š</p><pre><code class="java">public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &#123;    if (task == null) throw new NullPointerException();    RunnableFuture&lt;T&gt; ftask = newTaskFor(task);    execute(ftask);    return ftask;&#125;protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) &#123;    return new FutureTask&lt;T&gt;(callable);&#125;public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; &#123;    ...&#125;public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; &#123;    void run();&#125;</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>submit()</code>æœ€ç»ˆè¿˜æ˜¯ä¼šå»è°ƒç”¨<code>execute()</code>æ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œ<code>submit()</code>ä¼šè¿”å›ä¸€ä¸ªåŒ…è£…å¥½çš„ä»»åŠ¡ï¼Œæ˜¯ä¸€ä¸ª Future å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨<strong>ä¸éœ€è¦çº¿ç¨‹æ‰§è¡Œè¿”å›ç»“æœå€¼æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>execute()</code>æ–¹æ³•</strong>ã€‚ è€Œå½“æˆ‘ä»¬<strong>éœ€è¦è¿”å›å€¼æ—¶ï¼Œåˆ™ä½¿ç”¨<code>submit()</code>æ–¹æ³•</strong>ï¼Œä»–ä¼šè¿”å›ä¸€ä¸ª Future å¯¹è±¡ã€‚Future ä¸ä»…ä»…å¯ä»¥è·å¾—ä¸€ä¸ªç»“æœï¼Œä»–è¿˜å¯ä»¥è¢«å–æ¶ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨<code>Future.cancel()</code>æ–¹æ³•ï¼Œå–æ¶ˆä¸€ä¸ªFuture çš„æ‰§è¡Œã€‚</p><h2 id="çº¿ç¨‹æ± çš„ç»ˆæ­¢"><a href="#çº¿ç¨‹æ± çš„ç»ˆæ­¢" class="headerlink" title="çº¿ç¨‹æ± çš„ç»ˆæ­¢"></a>çº¿ç¨‹æ± çš„ç»ˆæ­¢</h2><p>çº¿ç¨‹ run æ–¹æ³•è·‘å®Œä¹‹åï¼Œå°±æ­£å¸¸ç»“æŸäº†ï¼Œä½†æ˜¯çº¿ç¨‹æ± ä¹Ÿæ˜¯æœ‰å…³é—­çš„åŠæ³•çš„ã€‚</p><ol><li><code>shutdown()</code>ï¼šå…³é—­çº¿ç¨‹æ± ï¼Œä¸å†æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œä½†å·²ç»æ·»åŠ çš„ä»»åŠ¡ä¸å—å½±å“ã€‚</li><li><code>shutdownNow()</code>ï¼šå°è¯•åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœæ­¢å¤„ç†æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªæ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚</li></ol><h2 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h2><p>ä¸¾ä¸ªä¾‹å­æ¥çœ‹çœ‹çº¿ç¨‹æ± çš„ç”¨æ³•ï¼š</p><pre><code class="java">import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;public class ThreadPoolTest &#123;    private final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(            3, 5, 1,            TimeUnit.MINUTES,            new ArrayBlockingQueue&lt;Runnable&gt;(50));    public void test() &#123;        for (int i = 0; i &lt; 10; i++) &#123;            final int j = i;            threadPoolExecutor.execute(() -&gt; &#123;                try &#123;                    Thread.sleep(3000);                    String info = String.format(&quot;ç¬¬%dæ¬¡ - å½“å‰çº¿ç¨‹%s&quot;, j, Thread.currentThread().getName());                    System.out.println(info);                &#125; catch (InterruptedException e) &#123;                    e.printStackTrace();                &#125;            &#125;);        &#125;        ((Runnable) () -&gt; &#123;            try &#123;                Thread.sleep(5000);                threadPoolExecutor.shutdown();            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;        &#125;).run();    &#125;    public static void main(String[] args) &#123;        new ThreadPoolTest().test();    &#125;&#125;</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code>ç¬¬0æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-1ç¬¬1æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-2ç¬¬2æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-3ç¬¬3æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-1ç¬¬5æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-2ç¬¬4æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-3ç¬¬8æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-3ç¬¬6æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-1ç¬¬7æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-2ç¬¬9æ¬¡ - å½“å‰çº¿ç¨‹pool-1-thread-3</code></pre><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æ˜¯æŒ‰ç…§ç»“æœæ‰§è¡Œäº†10æ¬¡ä»»åŠ¡ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„é¡ºåºæ‰§è¡Œçš„ã€‚</p><h2 id="çº¿ç¨‹æ± çš„åˆ†ç±»"><a href="#çº¿ç¨‹æ± çš„åˆ†ç±»" class="headerlink" title="çº¿ç¨‹æ± çš„åˆ†ç±»"></a>çº¿ç¨‹æ± çš„åˆ†ç±»</h2><p>é»˜è®¤çš„çº¿ç¨‹æ± æ˜¯ThreadPoolExecutorï¼Œé‚£ä¹ˆç³»ç»Ÿæ˜¯ä¸æ˜¯æä¾›äº†ä¸€äº›ä¸ªæ€§åŒ–çš„çº¿ç¨‹æ± ä¾›æˆ‘ä»¬åœ¨å„ç§æƒ…å†µä¸‹ä½¿ç”¨å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ã€‚æˆ‘ä»¬çœ‹çœ‹ä¸‹å›¾ï¼Œæœ‰6ç§çº¿ç¨‹æ± å¯ä¾›é€‰æ‹©ï¼š</p><p><img src="/img/54.png"></p><p>æˆ‘ä»¬åˆ†åˆ«æ¥ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p><h3 id="1-CachedThreadPool"><a href="#1-CachedThreadPool" class="headerlink" title="1. CachedThreadPool"></a>1. CachedThreadPool</h3><p>å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">public static ExecutorService newCachedThreadPool() &#123;    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,                                    60L, TimeUnit.SECONDS,                                    new SynchronousQueue&lt;Runnable&gt;());&#125;</code></pre><p>æ ¹æ®å®ƒçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒçš„ç‰¹æ€§ï¼š</p><ul><li>æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚</li><li>60 ç§’ timeoutã€‚</li><li>é‡‡ç”¨ SynchronousQueue é˜Ÿåˆ—</li></ul><p>å¦‚æœçº¿ç¨‹å¤„ç†ä»»åŠ¡é€Ÿåº¦å°äºæäº¤ä»»åŠ¡çš„é€Ÿåº¦ï¼Œåˆ™ä¼šä¸æ–­åœ°åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè¿™æ—¶éœ€è¦æ³¨æ„ä¸è¦è¿‡åº¦åˆ›å»ºï¼Œåº”é‡‡å–æªæ–½è°ƒæ•´åŒæ–¹é€Ÿåº¦ï¼Œä¸ç„¶çº¿ç¨‹åˆ›å»ºå¤ªå¤šä¼šå½±å“æ€§èƒ½ã€‚ä»å…¶ç‰¹ç‚¹å¯ä»¥çœ‹å‡ºï¼ŒCachedThreadPoolé€‚ç”¨äºæœ‰å¤§é‡éœ€è¦ç«‹å³æ‰§è¡Œçš„è€—æ—¶å°‘çš„ä»»åŠ¡çš„æƒ…å†µã€‚æ¯”è¾ƒé€‚åˆ<strong>æ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥çš„å°ç¨‹åºæˆ–è€…è´Ÿè½½è¾ƒè½»çš„æœåŠ¡å™¨</strong>ã€‚</p><h3 id="2-FixedThreadPool"><a href="#2-FixedThreadPool" class="headerlink" title="2. FixedThreadPool"></a>2. FixedThreadPool</h3><p>å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">public static ExecutorService newFixedThreadPool(int nThreads) &#123;    return new ThreadPoolExecutor(nThreads, nThreads,                                    0L, TimeUnit.MILLISECONDS,                                    new LinkedBlockingQueue&lt;Runnable&gt;());&#125;</code></pre><p>æ ¹æ®å®ƒçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒçš„ç‰¹æ€§ï¼š</p><ul><li>æ— è®ºçº¿ç¨‹æ± å¤šå¤§ï¼Œå…¨éƒ¨æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ã€‚</li><li>å› ä¸ºå…¨éƒ¨æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸ä¼šå›æ”¶ã€‚</li><li>é‡‡ç”¨ LinkedBlockingQueue é˜Ÿåˆ—ã€‚</li></ul><p>è¿™ä¸ªéå¸¸é€‚åˆ<strong>æ‰§è¡Œé•¿æœŸä»»åŠ¡</strong>ï¼Œå› ä¸ºçº¿ç¨‹ä¸ä¼šå›æ”¶ï¼Œèƒ½æ›´å¿«åœ°å“åº”æ‰§è¡Œä»»åŠ¡çš„è¯·æ±‚ï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒå¥½ã€‚</p><h3 id="3-ScheduledThreadPool"><a href="#3-ScheduledThreadPool" class="headerlink" title="3. ScheduledThreadPool"></a>3. ScheduledThreadPool</h3><p>å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123;        return new ScheduledThreadPoolExecutor(corePoolSize);&#125;public class ScheduledThreadPoolExecutor        extends ThreadPoolExecutor &#123;    public ScheduledThreadPoolExecutor(int corePoolSize) &#123;        super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,            new DelayedWorkQueue());    &#125;&#125;</code></pre><p>æ ¹æ®å®ƒçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒçš„ç‰¹æ€§ï¼š</p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°é‡å›ºå®šï¼Œéæ ¸å¿ƒçº¿ç¨‹æ•°é‡æ— ä¸Šé™</li><li>éæ ¸å¿ƒçº¿ç¨‹åœ¨å·¥ä½œå®Œæˆåä¼šç«‹åˆ»è¢«å›æ”¶ã€‚</li><li>é‡‡ç”¨ DelayedWorkQueue é˜Ÿåˆ—ã€‚</li></ul><p>ScheduledThreadPool é€‚åˆ<strong>æ‰§è¡Œå»¶æ—¶ä»»åŠ¡ä»¥åŠæœ‰å›ºå®šå‘¨æœŸçš„é‡å¤ä»»åŠ¡</strong>ã€‚</p><h3 id="4-SingleThreadExecutor"><a href="#4-SingleThreadExecutor" class="headerlink" title="4. SingleThreadExecutor"></a>4. SingleThreadExecutor</h3><p>å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">public static ExecutorService newSingleThreadExecutor() &#123;        return new FinalizableDelegatedExecutorService            (new ThreadPoolExecutor(1, 1,                                    0L, TimeUnit.MILLISECONDS,                                    new LinkedBlockingQueue&lt;Runnable&gt;()));&#125;static class FinalizableDelegatedExecutorService    extends DelegatedExecutorService &#123;    FinalizableDelegatedExecutorService(ExecutorService executor) &#123;        super(executor);    &#125;    protected void finalize() &#123;        super.shutdown();    &#125;&#125;</code></pre><p>æ ¹æ®å®ƒçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒçš„ç‰¹æ€§ï¼š</p><ul><li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸”ä¸ºæ ¸å¿ƒçº¿ç¨‹ã€‚</li><li>çº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ã€‚</li><li>é‡‡ç”¨ LinkedBlockingQueue é˜Ÿåˆ—ã€‚</li><li>åœ¨è°ƒç”¨ finalize() æ–¹æ³•è§¦å‘ GC æ—¶ï¼Œä¼šå…³æ‰çº¿ç¨‹æ± ã€‚</li></ul><p>é€‚åˆ<strong>ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡æŒ‰æ‰§è¡Œçš„åœºæ™¯</strong>ã€‚</p><h3 id="5-SingleThreadScheduledExecutor"><a href="#5-SingleThreadScheduledExecutor" class="headerlink" title="5. SingleThreadScheduledExecutor"></a>5. SingleThreadScheduledExecutor</h3><p>å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">public static ScheduledExecutorService newSingleThreadScheduledExecutor() &#123;        return new DelegatedScheduledExecutorService            (new ScheduledThreadPoolExecutor(1));&#125;</code></pre><p>å®ƒæœ€ç»ˆè¿˜æ˜¯åˆ›å»ºäº†ä¸€ä¸ª ScheduledThreadPoolExecutorï¼Œåªä¸è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º1ï¼Œå®ƒçš„ç‰¹æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p><ul><li>åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹æ•°é‡æ— ä¸Šé™</li><li>éæ ¸å¿ƒçº¿ç¨‹åœ¨å·¥ä½œå®Œæˆåä¼šç«‹åˆ»è¢«å›æ”¶ã€‚</li><li>é‡‡ç”¨ DelayedWorkQueue é˜Ÿåˆ—ã€‚</li><li>å¯ä»¥å»¶æœŸæ‰§è¡Œä»»åŠ¡</li></ul><p>å®ƒç»¼åˆäº† SingleThreadExecutor å’Œ ScheduledThreadPoolï¼Œé€‚åˆ<strong>æ‰§è¡Œä¸€ä¸ªæ¥ä¸€ä¸ªçš„å»¶æœŸä»»åŠ¡</strong>ã€‚</p><h3 id="6-WorkStealingPoolï¼ˆJDK-1-8ä¹‹åï¼‰"><a href="#6-WorkStealingPoolï¼ˆJDK-1-8ä¹‹åï¼‰" class="headerlink" title="6. WorkStealingPoolï¼ˆJDK 1.8ä¹‹åï¼‰"></a>6. WorkStealingPoolï¼ˆJDK 1.8ä¹‹åï¼‰</h3><p>å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">public static ExecutorService newWorkStealingPool(int parallelism) &#123;    return new ForkJoinPool        (parallelism,            ForkJoinPool.defaultForkJoinWorkerThreadFactory,            null, true);&#125;</code></pre><p>ä½œä¸º JDK 1.8 ä¹‹ååŠ å…¥çš„ã€åèµ·ä¹‹ç§€ã€ï¼Œè¿™ä¸ªçº¿ç¨‹æ± å¿…ç„¶æœ‰ä¸€äº›è¿‡äººä¹‹å¤„ã€‚æ–‡æ¡£ä¸Šä»‹ç»çš„æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>åˆ›å»ºä¸€ä¸ªå«æœ‰è¶³å¤Ÿå¤šçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ¥ç»´æŒç›¸åº”çš„<strong>å¹¶è¡Œçº§åˆ«</strong>ï¼Œå®ƒä¼šé€šè¿‡å·¥ä½œçªƒå–çš„æ–¹å¼ï¼Œä½¿å¾—å¤šæ ¸çš„ CPU ä¸ä¼šé—²ç½®ï¼Œæ€»ä¼šæœ‰æ´»ç€çš„çº¿ç¨‹è®© CPU å»è¿è¡Œã€‚</p><p>å®é™…çš„çº¿ç¨‹æ•°é‡å¯èƒ½ä¼šåŠ¨æ€åœ°å¢åŠ æˆ–å‡å°‘ã€‚</p><p>å·¥ä½œçªƒå–çº¿ç¨‹æ± æ— æ³•ä¿è¯ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºä¸æ·»åŠ é¡ºåºä¸€è‡´ã€‚</p></blockquote><p>å·¥ä½œçªƒå–ä¸æ˜¯ä»€ä¹ˆ Java ç‹¬æœ‰çš„ä¸œè¥¿ï¼Œ.NET çš„ TPL åº“æ—©å°±å­˜åœ¨å¥½å‡ å¹´äº†ã€‚æ‰€è°“å·¥ä½œçªƒå–ï¼ŒæŒ‡çš„æ˜¯é—²ç½®çš„çº¿ç¨‹å»å¤„ç†æœ¬ä¸å±äºå®ƒçš„ä»»åŠ¡ã€‚</p><p>æ¯ä¸ªå¤„ç†å™¨æ ¸ï¼Œéƒ½æœ‰ä¸€ä¸ªé˜Ÿåˆ—å­˜å‚¨ç€éœ€è¦å®Œæˆçš„ä»»åŠ¡ã€‚å¯¹äºå¤šæ ¸çš„æœºå™¨æ¥è¯´ï¼Œå½“ä¸€ä¸ªæ ¸å¯¹åº”çš„ä»»åŠ¡å¤„ç†å®Œæ¯•åï¼Œå°±å¯ä»¥å»å¸®åŠ©å…¶ä»–çš„æ ¸å¤„ç†ä»»åŠ¡ã€‚</p><p>å®ƒçš„æœ¬è´¨æ˜¯ ForkJoinPoolï¼Œåœ¨ JDK 1.7 ç‰ˆæœ¬ä¸­åŠ å…¥çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ çœŸçš„äº†è§£ Activity å—ï¼Ÿ</title>
      <link href="/2020-02-28/activity/"/>
      <url>/2020-02-28/activity/</url>
      
        <content type="html"><![CDATA[<p>Activity å‡ ä¹æ˜¯æ‰€æœ‰ Android å¼€å‘è€…æœ€ç†Ÿæ‚‰çš„é™Œç”Ÿäººäº†ã€‚</p><p>è¯´å®ƒç†Ÿæ‚‰ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªå¼€å‘è€…åœ¨è¿›è¡Œå¼€å‘æ—¶ï¼Œç¬¬ä¸€ä¸ªè¦é¢å¯¹çš„å¯¹è±¡å°±æ˜¯ Activityï¼Œåº”ç”¨ç•Œé¢çš„è·³è½¬ã€UIçš„æ˜¾ç¤ºå…¨éƒ¨éƒ½è¦ä¾æ‰˜Activityã€‚</p><p>è¯´å®ƒé™Œç”Ÿï¼Œæ˜¯å› ä¸ºå‡ ä¹å¾ˆå°‘æœ‰å¼€å‘è€…èƒ½æŠŠ Activityã€Windowã€Viewã€DecorViewã€WindowManagerã€ViewRootImpl é”™ç»¼å¤æ‚çš„å…³ç³»ç†æ¸…ã€‚</p><p>å½“æˆ‘ä»¬æ‰“å¼€ Android Studioï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„åº”ç”¨ï¼Œç¼–è¯‘å¯åŠ¨é¡¹ç›®ï¼Œæ‰‹æœºä¸Šå‡ºç°äº†ã€Hello World!ã€ï¼Œæœ‰æ²¡æœ‰æƒ³è¿‡è¿™äº›é—®é¢˜ï¼š</p><blockquote><p>Activity æ˜¯ç”±è°æ¥å®ä¾‹åŒ–çš„ï¼Ÿ</p><p>Window æ˜¯ä¸ªå•¥ï¼Ÿ</p><p>ç»å¸¸å¬è¯´ DecorViewï¼Œå®ƒæ˜¯ä¸ªæ™®é€šçš„ View å—ï¼Ÿå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>WindowManager èµ·äº†ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><p>Activity æ˜¯å¦‚ä½•å°†å†…å®¹æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„ï¼Ÿ</p><p>å®‹æ…§ä¹”ä¸å®‹ä»²åŸºä¸ºä»€ä¹ˆè¦ç¦»å©šï¼Ÿ</p></blockquote><p>å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¥æ­å¼€å®ƒçš„é¢çº±ï¼Œä¸€èµ·èµ°è¿‘ç§‘å­¦ï¼Œçœ‹çœ‹ã€Hello World!ã€èƒŒåçš„æ•…äº‹ã€‚</p><span id="more"></span><h2 id="ä¸‡ç‰©ä¹‹æº-Activity"><a href="#ä¸‡ç‰©ä¹‹æº-Activity" class="headerlink" title="ä¸‡ç‰©ä¹‹æº - Activity"></a>ä¸‡ç‰©ä¹‹æº - Activity</h2><p>åœ¨æ¯ä¸€ä¸ª Application ä¹‹ä¸‹ï¼Œå°±æ˜¯å„ç§å„æ ·çš„ Activity äº†ï¼Œè¦å‘ˆç°ä»»ä½•å†…å®¹ï¼Œéƒ½è¦ç»è¿‡ Activity ä¹‹æ‰‹ã€‚é‚£ä¹ˆ Activity æ˜¯ä»¥ä»€ä¹ˆå½¢å¼æ˜¾ç¤ºçš„å‘¢ï¼Ÿ</p><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šï¼Œæ˜¯è¿™æ ·å®šä¹‰ Activity çš„ã€‚</p><blockquote><p>An activity is a single, focused thing that the user can do. Almost all activities interact with the user, so the Activity class takes care of creating a window for you in which you can place your UI with setContentView(View). While activities are often presented to the user as full-screen windows, they can also be used in other ways: as floating windows (via a theme with R.attr.windowIsFloating set), Multi-Window mode or embedded into other windows.</p><p>æœºç¿»ï¼š<br>Activity æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ï¼Œèƒ½ä¸ç”¨æˆ·äº¤äº’çš„ä¸œè¥¿ã€‚å‡ ä¹æ‰€æœ‰çš„Activityéƒ½ä¼šä¸ç”¨æˆ·äº§ç”Ÿäº¤äº’ï¼Œæ‰€ä»¥Activityç±»ä¼šå¸®ä½ åˆ›å»ºä¸€ä¸ªWindowï¼Œæ¥è®©ä½ é€šè¿‡<code>setContentView(View)</code>çš„æ–¹å¼ï¼ŒæŠŠUIå±•ç¤ºå‡ºæ¥ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ç”¨æˆ·äº¤äº’çš„éƒ½æ˜¯å…¨å±Windowï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æœ‰æ‚¬æµ®çª—ï¼ˆé€šè¿‡åœ¨ä¸»é¢˜ä¸­è®¾ç½®<code>R.attr.windowIsFloating</code>æ¥å¯ç”¨ï¼‰ã€å¤šçª—å£ï¼Œæˆ–è€…é›†æˆåˆ°å…¶ä»–çš„Windowä¸­ã€‚</p></blockquote><p>æˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸‹Activityä¹‹ä¸‹çš„å†…å®¹çš„å±‚çº§å…³ç³»ï¼š</p><div style="text-align:center; width: 100%"><img src="/img/23.png"></img></div><p>å¯ä»¥çœ‹å‡ºï¼ŒActivity ä¸­ä¼šæœ‰ WindowManger æ¥ç®¡ç† Windowï¼Œè€Œ Window ä¹‹ä¸‹å°±æ˜¯å„ç§ ViewGroup å’Œ View äº†ã€‚æˆ‘ä»¬æ˜¯æ€ä¹ˆçš„æ¨å¯¼å‡ºè¿™ä¸ªå±‚çº§å…³ç³»çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆä» Activity çš„åˆ›å»ºå¼€å§‹ã€‚</p><p>Activityçš„å®ä¾‹æ˜¯ç”± ActivityThread åˆ›å»ºçš„ï¼Œåœ¨å…¶ä¸­æœ‰ä¸ªåä¸º<code>performLaunchActivity()</code>çš„æ–¹æ³•ï¼Œåœ¨è¿™é‡Œé¢åˆ›å»ºäº†Activityçš„å®ä¾‹ã€‚</p><pre><code class="java">// ActivityThread.java/**  Core implementation of activity launch. */private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;    ...    ComponentName component = r.intent.getComponent();    ...    ContextImpl appContext = createBaseContextForActivity(r);    Activity activity = null;    try &#123;        java.lang.ClassLoader cl = appContext.getClassLoader();        activity = mInstrumentation.newActivity(                cl, component.getClassName(), r.intent);        StrictMode.incrementExpectedActivityCount(activity.getClass());        r.intent.setExtrasClassLoader(cl);        r.intent.prepareToEnterProcess();        if (r.state != null) &#123;            r.state.setClassLoader(cl);        &#125;    &#125; catch (Exception e) &#123;        if (!mInstrumentation.onException(activity, e)) &#123;            throw new RuntimeException(                &quot;Unable to instantiate activity &quot; + component                + &quot;: &quot; + e.toString(), e);        &#125;    &#125;    ...    Window window = null;    if (r.mPendingRemoveWindow != null &amp;&amp; r.mPreserveWindow) &#123;        window = r.mPendingRemoveWindow;        r.mPendingRemoveWindow = null;        r.mPendingRemoveWindowManager = null;    &#125;    appContext.setOuterContext(activity);    activity.attach(appContext, this, getInstrumentation(), r.token,            r.ident, app, r.intent, r.activityInfo, title, r.parent,            r.embeddedID, r.lastNonConfigurationInstances, config,            r.referrer, r.voiceInteractor, window, r.configCallback,            r.assistToken);&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒActivityçš„å®ä¾‹æ˜¯ç”±Instrumentationæ¥åˆ›å»ºçš„ï¼Œè€Œä¸”å°†ClassLoaderä¼ å…¥ï¼Œçœ‹æ¥æ˜¯åˆ©ç”¨äº†åå°„åŸç†åˆ›å»ºçš„ã€‚å…·ä½“çš„æˆ‘ä»¬ä¹‹åå†åˆ†æã€‚#FLAG</p><p>æ¥ä»<code>Activity.attach()</code>å¼€å§‹çœ‹çœ‹æºç å§ã€‚</p><pre><code class="java">// Activity.javafinal void attach(Context context, ActivityThread aThread,        Instrumentation instr, IBinder token, int ident,        Application application, Intent intent, ActivityInfo info,        CharSequence title, Activity parent, String id,        NonConfigurationInstances lastNonConfigurationInstances,        Configuration config, String referrer, IVoiceInteractor voiceInteractor,        Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) &#123;    ...    mWindow = new PhoneWindow(this, window, activityConfigCallback);    ...    mWindow.setWindowManager(        (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),        mToken, mComponent.flattenToString(),        (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0);    ...    mWindowManager = mWindow.getWindowManager();&#125;</code></pre><p>ç”±ä¸Šé¢çš„ä»£ç æˆ‘ä»¬èƒ½å¤ŸçŸ¥é“ï¼ŒActivityä¸­çš„Windowå®ä¾‹æ˜¯ä¸€ä¸ªå«PhoneWindowçš„ä¸œè¥¿ã€‚Activityåœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„PhoneWindowï¼Œå¹¶ç»™å®ƒè®¾ç½®ä¸€ä¸ªWindowManagerã€‚</p><p>åœ¨çœ‹PhoneWindowä¹‹å‰ï¼Œå…ˆçœ‹çœ‹Windowçš„å®šä¹‰ï¼š</p><pre><code class="java">// Window.java/** * ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œtop-levelçš„çª—å£ï¼Œç”¨æ¥å‘ˆç°æ ·å¼ï¼ŒæŒç®¡è¡Œä¸ºã€‚ * è¯¥ç±»çš„å®ä¾‹åº”è¯¥è¢«ç”¨åšæœ€é¡¶å±‚çš„è§†å›¾ï¼Œå¹¶ä¸”éœ€è¦è¢«æ·»åŠ åˆ° window managerã€‚ * å®ƒæä¾›äº†æ ‡å‡†çš„ UI ç­–ç•¥åŒ…æ‹¬ä½†ä¸é™äºèƒŒæ™¯ã€æ ‡é¢˜åŒºåŸŸã€é»˜è®¤çš„æŒ‰é”®å¤„ç†ç­‰ç­‰ã€‚ * * ç›®å‰è¯¥ç±»å”¯ä¸€çš„å®ç°ç±»å°±æ˜¯ android.view.PhoneWindowï¼Œå½“ä½ éœ€è¦ä¸€ä¸ªWindowçš„æ—¶å€™ï¼Œå°±å¾—å®ä¾‹åŒ–è¿™ä¸ªç±»ã€‚ */public abstract class Window &#123;    ...&#125;</code></pre><p>åšä¸ºAndroidä¸­Windowç±»çš„å”¯ä¸€å®ç°ç±»ï¼Œæˆ‘ä»¬å†çœ‹çœ‹PhoneWindowçš„å®šä¹‰ï¼š</p><pre><code class="java">// PhoneWindow.javapublic class PhoneWindow extends Window implements MenuBuilder.Callback &#123;    ...    // PhoneWindowä¸­çš„é¡¶çº§Viewâ€”â€”DecorView    private DecorView mDecor;    ...    boolean mIsFloating;  // æ˜¯å¦ä¸ºæ‚¬æµ®çª—    ...    private LayoutInflater mLayoutInflater;  // LayoutInflater    private TextView mTitleView;  // çª—å£æ ‡é¢˜    ...    private AudioManager mAudioManager;    private KeyguardManager mKeyguardManager;    private MediaSessionManager mMediaSessionManager; // å¦‚Windowä¸­æ‰€è¯´çš„ï¼ŒåŒ…å«ä¸€äº›äº‹ä»¶çš„å¤„ç†    ...</code></pre><p>åœ¨PhoneWindowçš„æˆå‘˜å˜é‡é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†DecorViewã€‚å¯è§Windowçš„é¡¶çº§Viewå°±æ˜¯DecorViewäº†ã€‚è€ŒDecorViewåˆæ˜¯ä¸€ä¸ªViewGroupï¼Œå®ƒå¯ä»¥æ‹¥æœ‰æ— æ•°çš„å­Viewï¼Œæ‰€ä»¥åˆšæ‰å›¾é‡Œçš„å±‚çº§å…³ç³»å¾—åˆ°äº†ä½è¯ã€‚</p><h2 id="ä¸€äººä¹‹ä¸‹ï¼Œä¸‡äººä¹‹ä¸Š-Window"><a href="#ä¸€äººä¹‹ä¸‹ï¼Œä¸‡äººä¹‹ä¸Š-Window" class="headerlink" title="ä¸€äººä¹‹ä¸‹ï¼Œä¸‡äººä¹‹ä¸Š - Window"></a>ä¸€äººä¹‹ä¸‹ï¼Œä¸‡äººä¹‹ä¸Š - Window</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¾®è½¯ WindowsÂ® æ“ä½œç³»ç»Ÿä¸­æœ‰çª—å£ï¼ˆWindowï¼‰çš„æ¦‚å¿µï¼Œé‚£ä¹ˆåœ¨ Android ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ã€‚Activity æ˜¯é™„åŠ åœ¨ Window ä¸Šå±•ç¤ºçš„ï¼Œè¿˜æœ‰ä¾‹å¦‚ Dialogã€Toast ä¹Ÿæ˜¯ä¼šå•ç‹¬å±•ç¤ºåœ¨ä¸€ä¸ª Window ä¸Šã€‚</p><p>åˆšæ‰æˆ‘ä»¬è¯´è¿‡äº†ï¼ŒAcitivtyä¸­ï¼Œç”¨äºæ˜¾ç¤ºå†…å®¹çš„ï¼Œå°±æ˜¯Windowäº†ã€‚é‚£ä¹ˆWindowçš„å†…å®¹æ¥è‡ªäºå“ªå„¿å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä»ä¸Šé¢<code>ActivityThread.performLaunchActivity()</code>æ–¹æ³•ç»§ç»­å‘ä¸‹èµ°ï¼š</p><pre><code class="java">// ActivityThread.jaa    ...    activity.attach(appContext, this, getInstrumentation(), r.token,            r.ident, app, r.intent, r.activityInfo, title, r.parent,            r.embeddedID, r.lastNonConfigurationInstances, config,            r.referrer, r.voiceInteractor, window, r.configCallback,            r.assistToken);    ...    activity.mCalled = false;    if (r.isPersistable()) &#123;        mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);    &#125; else &#123;        mInstrumentation.callActivityOnCreate(activity, r.state);    &#125;</code></pre><p>çœ‹åˆ°è¿™é‡Œäº†å§ï¼Œè°ƒç”¨äº†Activityçš„<code>onCreate()</code>æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Activityçš„<code>onCreate()</code>æ–¹æ³•ä¸­ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨<code>setContentView(R.layout.layout_main)</code>æ¥æ˜¾ç¤ºå†…å®¹ï¼Œå¦‚æœè¿™å¥ä»£ç è¢«æ³¨é‡Šæ‰ï¼Œé‚£Activityä¸­å°±æ˜¯ä¸€ç‰‡ç©ºç™½ã€‚å¥½ï¼Œæˆ‘ä»¬å°±ç”±æ­¤ä¸ºå…¥å£ï¼Œçœ‹çœ‹<code>R.layout.layout_main</code>ç©¶ç«Ÿæ˜¯æ€æ ·è¢«æ·»åŠ åˆ°Windowé‡Œçš„ã€‚</p><p><code>setContentView()</code>çš„æºç å¦‚ä¸‹ï¼Œéå¸¸ç®€å•ï¼š</p><pre><code class="java">// Activity.java/**    * Set the activity content from a layout resource.  The resource will be    * inflated, adding all top-level views to the activity.    *    * @param layoutResID Resource ID to be inflated.    */public void setContentView(@LayoutRes int layoutResID) &#123;    getWindow().setContentView(layoutResID);     // è®¾ç½®actionBar    initWindowDecorActionBar(); &#125;</code></pre><p>é«˜å°”åŸºå…ˆç”Ÿæ•™å¯¼æˆ‘ä»¬ï¼šäº‹å‡ºåå¸¸å¿…æœ‰å¦–ã€‚è¶Šæ˜¯ç®€å•çš„ä¸œè¥¿ï¼ŒèƒŒåçš„ä¸œè¥¿è‚¯å®šè¶Šå¤æ‚ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code>getWindow().setContentView(layoutResID)</code>è¿™å¥ä»£ç éƒ½ç»å†äº†äº›ä»€ä¹ˆã€‚</p><p> <code>Activity.getWindow()</code>è·å–çš„æ˜¯å…¶æˆå‘˜å˜é‡PhoneWindowï¼Œæ‰€ä»¥è¿™å¥ä»£ç å…¶å®æ˜¯è°ƒç”¨äº†<code>PhoneWindow.setContentView()</code>ï¼š</p><pre><code class="java">// PhoneWindow.java@Overridepublic void setContentView(int layoutResID) &#123;    // Note: FEATURE_CONTENT_TRANSITIONS may be set in the process of installing the window    // decor, when theme attributes and the like are crystalized. Do not check the feature    // before this happens.    // åˆå§‹åŒ–DecorViewå’ŒmContentParent    if (mContentParent == null) &#123;        installDecor();    &#125; else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) &#123;        mContentParent.removeAllViews();    &#125;    if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) &#123;        final Scene newScene = Scene.getSceneForLayout(mContentParent, layoutResID,                getContext());        transitionTo(newScene);    &#125; else &#123;        // æ¸²æŸ“å¸ƒå±€        mLayoutInflater.inflate(layoutResID, mContentParent);    &#125;    mContentParent.requestApplyInsets();    // é€šçŸ¥Activityæˆ‘åˆå§‹åŒ–å®Œå•¦ï¼    final Callback cb = getCallback();    if (cb != null &amp;&amp; !isDestroyed()) &#123;        cb.onContentChanged();    &#125;    mContentParentExplicitlySet = true;&#125;</code></pre><p>è¿™é‡Œé¢æˆ‘ä»¬æå–ä¸¤ä¸ªç‚¹ï¼š<code>mContentParent</code>å’Œ<code>installDecor()</code>ã€‚</p><p><code>mContentParent</code>çš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">// This is the view in which the window contents are placed. It is either// mDecor itself, or a child of mDecor where the contents go.ViewGroup mContentParent;</code></pre><p>æ„æ€æ˜¯è¿™ä¸ªViewGroupæ”¾çš„æ˜¯Windowé‡Œçš„å†…å®¹ã€‚å®ƒè¦ä¹ˆæ˜¯<code>mDecor</code>ï¼ˆä¹Ÿå°±æ˜¯DecorViewï¼‰ï¼Œè¦ä¹ˆæ˜¯<code>mDecor</code>çš„ä¸€ä¸ªå­Viewã€‚<br>åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>mContentParent</code>æ˜¾ç„¶æ˜¯<code>null</code>ï¼Œé‚£å…¶åˆå§‹åŒ–å¿…ç„¶å°±åœ¨<code>installDecor()</code>ä¸­äº†ã€‚</p><pre><code class="java">// PhoneWindow.javaprivate void installDecor() &#123;    mForceDecorInstall = false;    if (mDecor == null) &#123;        mDecor = generateDecor(-1);        ...    &#125; else &#123;        mDecor.setWindow(this);    &#125;    if (mContentParent == null) &#123;        mContentParent = generateLayout(mDecor);        // å„ç§å¯¹mContentParentå’ŒmDecorçš„åˆå§‹åŒ–ï¼Œå¦‚Titleã€Iconç­‰        ...    &#125;&#125;</code></pre><p>å½“åˆæ¬¡è¿›å…¥æ­¤æ–¹æ³•æ—¶ï¼Œ<code>mDecor</code>ä¸º<code>null</code>ï¼Œä¾¿ä¼šè°ƒç”¨<code>generateDecor()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// PhoneWindow.javaprotected DecorView generateDecor(int featureId) &#123;    // ç³»ç»Ÿè¿›ç¨‹æ²¡æœ‰ application contextï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥ä½¿ç”¨æˆ‘ä»¬ç°æœ‰çš„ contextã€‚    // å…¶ä»–çš„æƒ…å†µä¸‹æˆ‘ä»¬ç›´æ¥ç”¨ application contextï¼Œè¿™æ ·å°±ä¸ç”¨å¤ªä¾é™„äº activityã€‚    Context context;    if (mUseDecorContext) &#123;        Context applicationContext = getContext().getApplicationContext();        if (applicationContext == null) &#123;            context = getContext();        &#125; else &#123;            context = new DecorContext(applicationContext, getContext());            if (mTheme != -1) &#123;                context.setTheme(mTheme);            &#125;        &#125;    &#125; else &#123;        context = getContext();    &#125;    return new DecorView(context, featureId, this, getAttributes());&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œåˆ›å»ºäº†DecorViewçš„å®ä¾‹ï¼ŒWindowçš„æ ¹Viewå‡ºç°äº†ã€‚</p><p>å¹¶ä¸”åœ¨<code>installDecor()</code>æ—¶ï¼Œä¹Ÿè¦åˆå§‹åŒ–mContentParentï¼Œé€šè¿‡è°ƒç”¨<code>generateLayout(DecorView)</code>å®ç°ï¼š</p><pre><code class="java">protected ViewGroup generateLayout(DecorView decor) &#123;    // å„ç§åˆå§‹åŒ–ä¸æ¡ä»¶åˆ¤æ–­    ...    // Inflate the window decor.    int layoutResource;    // åˆ¤æ–­å½“å‰æ˜¯ä»€ä¹ˆç±»å‹çš„Windowï¼Œä»è€Œç»™layoutResourceèµ‹å€¼ç‰¹å®šçš„idå€¼ã€‚    // å¦‚ R.layout.screen_swipe_dismissã€R.layout.screen_title_iconsç­‰    // è¿™é‡Œä¹Ÿæœ‰å¤§é‡çš„ requestFeature() çš„è°ƒç”¨ï¼Œ    // ä¹Ÿé—´æ¥è§£é‡Šäº†ä¸ºä»€ä¹ˆ requestFeature() æ–¹æ³•ä¸€å®šè¦åœ¨ setContentView() ä¹‹å‰è°ƒç”¨    ...    mDecor.startChanging();  // 1    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);  // 2    ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);  // 3    ...    mDecor.setWindowFrame(frame);    mDecor.setElevation(mElevation);    mDecor.setClipToOutline(mClipToOutline);    ...    mDecor.finishChanging(); // 4    return contentParent;  // 5&#125;</code></pre><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†åˆšåˆšåˆ›å»ºçš„DecorViewã€‚</p><ol><li><code>startChanging()</code>æ–¹æ³•ä¼šå°†DecorViewä¸­çš„ä¸€ä¸ª<code>mChanging</code>çš„Flagç½®ä¸º<code>true</code>ï¼›è¯¥Flagä¸»è¦ç›®çš„æ˜¯é˜²æ­¢DecorViewæ”¶åˆ°<code>drawableChanged()</code>äº‹ä»¶æ—¶ï¼Œå‡ºç°å†²çªã€‚</li><li><code>onResourcesLoaded()</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨<code>addView()</code>æ–¹æ³•å°†<code>layoutResource</code>æ¸²æŸ“è¿‡åçš„viewæ·»åŠ ä¸ºè‡ªèº«çš„å­Viewã€‚æ— è®º<code>layoutResource</code>æœ€åè¢«èµ‹äºˆä»€ä¹ˆå€¼ï¼Œå®ƒä¸€å®šä¼šåŒ…å«<code>Window.ID_ANROID_CONTENT</code>ã€‚</li><li><code>Window.ID_ANDROID_CONTENT</code>çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</li></ol><pre><code class="java">// Window.java/*** ä¸» layout çš„ xml æ–‡ä»¶ä¸­å¿…é¡»å«æœ‰çš„ ID å€¼*/public static final int ID_ANDROID_CONTENT = com.android.internal.R.id.content;</code></pre><p>è€Œè¿™ä¸ª<code>findViewById()</code>æ˜¯PhoneWindowçš„çˆ¶ç±»Windowä¸­çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="java">// Window.java/*** Finds a view that was identified by the &#123;@code android:id&#125; XML attribute* that was processed in &#123;@link android.app.Activity#onCreate&#125;.* &lt;p&gt;* This will implicitly call &#123;@link #getDecorView&#125; with all of the associated side-effects.* &lt;p&gt;* &lt;strong&gt;Note:&lt;/strong&gt; In most cases -- depending on compiler support --* the resulting view is automatically cast to the target class type. If* the target class type is unconstrained, an explicit cast may be* necessary.** @param id the ID to search for* @return a view with given ID if found, or &#123;@code null&#125; otherwise* @see View#findViewById(int)* @see Window#requireViewById(int)*/@Nullablepublic &lt;T extends View&gt; T findViewById(@IdRes int id) &#123;    return getDecorView().findViewById(id);&#125;</code></pre><p><code>getDecorView()</code>æ˜¯Windowä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå½“ç„¶ç”±PhoneWindowæ¥å®ç°ï¼š</p><pre><code class="java">@Overridepublic final @NonNull View getDecorView() &#123;    if (mDecor == null || mForceDecorInstall) &#123;        installDecor();    &#125;    return mDecor;&#125;</code></pre><p>è¯´ç™½äº†ï¼Œå°±æ˜¯æ‹¿åˆ°äº†åˆšåˆšåˆå§‹åŒ–å®Œçš„mDecorï¼DecorViewæ˜¯ä¸€ä¸ªViewGroupï¼Œè°ƒç”¨å®ƒçš„<code>findViewById()</code>æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>View.findViewById()</code>ï¼Œå…·ä½“çš„ä»£ç å°±ä¸è´´äº†ï¼Œæ— éå°±æ˜¯é€’å½’æŸ¥æ‰¾ã€‚</p><p>è¿™ä¸€å¥çš„ç›®çš„æ˜¯ï¼Œæ‰¾åˆ°DecorViewä¸­IDå€¼ä¸º<code>ID_ANDROID_CONTENT</code>çš„Viewï¼Œèµ‹å€¼ç»™<code>contentParent</code>ã€‚</p><ol start="4"><li><code>finishChanging()</code>æ–¹æ³•å°†DecorViewä¸­çš„<code>mChanging</code>Flagç½®ä¸º<code>false</code>ï¼ŒåŒæ—¶è°ƒç”¨ä¸€ä¸‹å®ƒçš„<code>drawableChanged()</code>æ–¹æ³•ã€‚</li><li>è¿”å›<code>contentParent</code>ï¼Œè¿™æ ·<code>mContentParent</code>åˆå§‹åŒ–å®Œæ¯•ã€‚</li></ol><p>å¥½ï¼Œç°åœ¨mDecoræœ‰äº†ï¼ŒmContentParentæœ‰äº†ï¼Œå°±è°ƒç”¨</p><pre><code class="java">mLayoutInflater.inflate(layoutResID, mContentParent);</code></pre><p>æ¥å°†xmlå¸ƒå±€æ–‡ä»¶ç”»åˆ°è¿™ä¸Šé¢ã€‚</p><p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œç°åœ¨DecorViewå·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œå¯æ˜¯è¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°Windowä¸Šå‘¢ï¼Ÿ</p><p>ä»€ä¹ˆæ—¶å€™æ·»åŠ ä¸Šå»çš„å‘¢ï¼Ÿè¿™é‡Œå¿…é¡»è¦ä»‹ç»Activityçš„åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸäº†ã€‚</p><h3 id="Activityçš„åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#Activityçš„åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activityçš„åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ"></a>Activityçš„åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨ä¸Šé¢<code>Activity.attach()</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¼ å…¥äº†ä¸€ä¸ªActivityThreadçš„å®ä¾‹ï¼Œè¿™ä¸ªActivityThreadæ˜¯ä¸ªå•¥ï¼Ÿ</p><pre><code class="java">// ActivityThread.java/** * ç®¡ç†ä¸€ä¸ªåº”ç”¨è¿›ç¨‹çš„ä¸»çº¿ç¨‹ä¸Šçš„æ‰€æœ‰æ‰§è¡Œä»»åŠ¡ï¼Œè®¡åˆ’å’Œæ‰§è¡Œæ´»åŠ¨ã€å¹¿æ’­å’Œå…¶ä»–çš„æ“ä½œï¼Œè€ŒActivity Manageråªç®¡å‘é€è¯·æ±‚å°±å¥½å•¦ * * &#123;@hide&#125; */public final class ActivityThread extends ClientTransactionHandler &#123;&#125;</code></pre><p>åœ¨æ–‡ç« çš„å¼€å¤´è®²è¿‡ï¼Œ<code>Activity.attach()</code>æ˜¯ç”±ActivityThreadæ¥è°ƒç”¨çš„ï¼Œå› ä¸ºActivityçš„å®ä¾‹å°±æ˜¯ç”±ActivityThreadæ¥åˆ›å»ºçš„ï¼</p><p>é‚£ä¹ˆï¼Œå®ƒå¿…ç„¶ä¹Ÿä¼šç›‘å¬Activityç”Ÿå‘½å‘¨æœŸå†…çš„æ‰€æœ‰äº‹ä»¶ã€‚</p><p>ä¸Šä¸€å¼ è€æ‰ç‰™çš„å›¾ï¼Œæ¥çœ‹çœ‹Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p><img src="/img/22.png"></p><p>é€šè¿‡æŸ¥çœ‹ActivityThreadçš„ä»£ç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨<code>handleResumeActivity()</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šè°ƒç”¨ Activity çš„<code>onResume()</code>æ–¹æ³•ï¼Œæ¥ç€ä¼šè°ƒç”¨ Activity çš„<code>makeVisible()</code>æ–¹æ³•ï¼Œæ­£æ˜¯åœ¨<code>makeVisible()</code>æ–¹æ³•ä¸­ï¼ŒDecorViewæ‰çœŸæ­£çš„å®Œæˆäº†æ˜¾ç¤ºè¿‡ç¨‹ï¼Œåˆ°è¿™é‡Œ Activity çš„è§†å›¾æ‰èƒ½è¢«ç”¨æˆ·çœ‹åˆ°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="java">// ActivityThread.java@Overridepublic void handleResumeActivity(IBinder token, boolean finalStateRequest, boolean isForward,        String reason) &#123;    // è¿™é‡Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°Activityçš„ onResume() æ–¹æ³•    final ActivityClientRecord r = performResumeActivity(token, finalStateRequest, reason);    ...    final Activity a = r.activity;    ...    // The window is now visible if it has been added, we are not    // simply finishing, and we are not starting another activity.    if (!r.activity.mFinished &amp;&amp; willBeVisible &amp;&amp; r.activity.mDecor != null &amp;&amp; !r.hideForNow) &#123;        if (r.activity.mVisibleFromClient) &#123;            r.activity.makeVisible();        &#125;    &#125;&#125;</code></pre><pre><code class="java">// Activity.javavoid makeVisible() &#123;    if (!mWindowAdded) &#123;        ViewManager wm = getWindowManager();        wm.addView(mDecor, getWindow().getAttributes());  // å°†DecorViewæ·»åŠ åˆ°Windowä¸Š        mWindowAdded = true;    &#125;    mDecor.setVisibility(View.VISIBLE);&#125;// getWindowManager()è·å–çš„æ˜¯Activityä¸­çš„æˆå‘˜å˜é‡`mWindowManager`/** Retrieve the window manager for showing custom windows. */public WindowManager getWindowManager() &#123;    return mWindowManager;&#125;</code></pre><p>è¿˜è®°å¾—è¿™ä¸ª<code>mWindowManager</code>æ˜¯æ¥è‡ªäºå“ªå„¿å—ï¼Ÿæ˜¯äº†ï¼Œè¿™æ˜¯<code>Activity.attach()</code>çš„æ—¶å€™ï¼Œè·å–çš„mWindowä¸­çš„WindowManagerã€‚å¯ä»¥å»ç¿»ç¿»ä¸Šé¢<code>attach()</code>çš„ä»£ç ç§ç§ã€‚</p><p>å¥½ï¼Œäº‹æƒ…ä¼¼ä¹å·²ç»æ¥åˆ°äº†æœ€åä¸€æ­¥ï¼Œå°±æ˜¯<code>WindowManager.addView()</code>äº†ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬çœ‹çœ‹WindowManageræ˜¯å¦‚ä½•å°†DecorViewæ·»åŠ åˆ°Windowä¸Šçš„ã€‚</p><h2 id="æƒå€¾æœé‡-WindowManager"><a href="#æƒå€¾æœé‡-WindowManager" class="headerlink" title="æƒå€¾æœé‡ - WindowManager"></a>æƒå€¾æœé‡ - WindowManager</h2><p>WindowManagerï¼Œå¬èµ·æ¥å°±å¾ˆé«˜å¤§ä¸Šï¼ŒWindowä¸­æ‰€æœ‰å†…å®¹çš„ç”Ÿæ­»å¤§æƒï¼Œéƒ½æŒæ¡åœ¨å®ƒçš„æ‰‹é‡Œã€‚</p><p>è€Œå®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç±»ã€‚ç»§æ‰¿è‡ªViewManagerã€‚</p><pre><code class="java">// WindowManager.java/** * ä¸€ä¸ªæ¥å£ï¼Œapp ä»¬ç”¨æ¥ä¸window manageré€šè®¯çš„ã€‚ * * æ¯ä¸€ä¸ªwindow managerçš„å®ä¾‹éƒ½ä¸ä¸€ä¸ªç‰¹å®šçš„ Display ç»‘å®šã€‚è¦è·å–ä¸åŒçš„ Display çš„ WindowManagerï¼Œ * è°ƒç”¨ Context.createDisplayContext() æ¥è·å–é‚£ä¸ª Display çš„ Contextï¼Œç„¶åç”¨  * Context.getSystemService(Context.WINDOW_SERVICE) æ¥è·å–å®ƒçš„ WindowManagerã€‚ *  * æœ€ç®€å•çš„åœ¨å…¶ä»– Display ä¸Šæ˜¾ç¤º window çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª Presentationï¼ŒPresentation ä¼šè‡ªåŠ¨åœ°ä¸º * è¿™ä¸ª Display è·å– WindowManager å’Œ Contextã€‚ * * è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨ï¼Œæ˜¯ä¸WindowManagerServiceæ‰“äº¤é“ï¼Œå°†Appä¸WindowManagerServiceè¿æ¥åœ¨ä¸€èµ·ã€‚ * */@SystemService(Context.WINDOW_SERVICE)public interface WindowManager extends ViewManager &#123;&#125;</code></pre><p>ç„¶åæ˜¯ViewManagerç±»ï¼Œå¾ˆç®€å•ï¼š</p><pre><code class="java">// ViewManager.java/**   * è¿™ä¸ªæ¥å£èƒ½è®©ä½ ä¸ºActivityæ·»åŠ å’Œåˆ é™¤å­viewã€‚è¦è·å–è¯¥ç±»çš„å®ä¾‹ï¼Œè°ƒç”¨Context.getSystemService()ã€‚  */public interface ViewManager&#123;    public void addView(View view, ViewGroup.LayoutParams params);    public void updateViewLayout(View view, ViewGroup.LayoutParams params);    public void removeView(View view);&#125;</code></pre><p>ä¸ºäº†æ–¹ä¾¿è§£é‡Šä¸‹é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å†è´´ä¸€æ¬¡<code>Activity.attach()</code>çš„éƒ¨åˆ†ä»£ç ï¼š</p><pre><code class="java">// Activity.javafinal void attach(Context context, ActivityThread aThread,        Instrumentation instr, IBinder token, int ident,        Application application, Intent intent, ActivityInfo info,        CharSequence title, Activity parent, String id,        NonConfigurationInstances lastNonConfigurationInstances,        Configuration config, String referrer, IVoiceInteractor voiceInteractor,        Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) &#123;    ...     mWindow.setWindowManager(            (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),            mToken, mComponent.flattenToString(),            (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0);    if (mParent != null) &#123;        mWindow.setContainer(mParent.getWindow());    &#125;    mWindowManager = mWindow.getWindowManager();    ...</code></pre><p>å…¶å®ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæˆ‘æœ‰ç‚¹ç–‘æƒ‘ï¼Œä¸ºå•¥ä¸ç›´æ¥é€šè¿‡è¿™ç§æ–¹å¼æ¥è®¾ç½®<code>mWindow</code>çš„WindowManagerå‘¢ï¼Ÿ</p><pre><code class="java">mWindowManager = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);mWindow.setWindowManager(mWindowManager, mToken, mComponent.flattenToString(),            (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0);</code></pre><p>è¿™æ ·å°±ä¸å¿…å†æä¸ª<code>mWindowManager = mWindow.getWindowManager()</code>å‡ºæ¥äº†å•Šï¼Ÿ</p><p>äº‹å®è¯æ˜ï¼Œæˆ‘è¿˜æ˜¯Too young, sometimes to naiveã€‚æˆ‘ä»¬æ¥çœ‹çœ‹<code>mWindow.setWindowManager()</code>å¹²äº†äº›å•¥ï¼Œå°±çŸ¥é“ä¸ºå•¥æˆ‘çš„æ–¹æ³•è¡Œä¸é€šäº†ï¼š</p><pre><code class="java">// Window.java/**    * Set the window manager for use by this Window to, for example,    * display panels.  This is &lt;em&gt;not&lt;/em&gt; used for displaying the    * Window itself -- that must be done by the client.    *    * @param wm The window manager for adding new windows.    */public void setWindowManager(WindowManager wm, IBinder appToken, String appName,        boolean hardwareAccelerated) &#123;    mAppToken = appToken;    mAppName = appName;    mHardwareAccelerated = hardwareAccelerated;    // è¿™é‡Œè¿˜æ¥äº†ä¸ªåŒé‡ä¿é™©    if (wm == null) &#123;        wm = (WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);     &#125;    mWindowManager = ((WindowManagerImpl)wm).createLocalWindowManager(this);&#125;</code></pre><p>è¿™ä¸€ç€ç‹¸çŒ«æ¢å¤ªå­çœŸæ˜¯æœ‰å¤Ÿå¦™ï¼è¿™å“ªé‡Œæ˜¯ä¸ªç®€å•çš„ setter æ–¹æ³•å•Šï¼</p><p>åŸæ¥è¿™ä¸ªWindowManagerå¹¶ä¸æ˜¯é€šè¿‡ç³»ç»Ÿæä¾›çš„<code>getSystemService()</code>æ–¹æ³•æå‡ºæ¥çš„å®ä¾‹ï¼Œè€Œæ˜¯åˆè‡ªå·±æƒ³åŠæ³•æäº†ä¸ªæ–°çš„ç©æ„å‡ºæ¥ï¼</p><p>å…ˆå°†WindowManagerå¼ºè½¬æˆå®ƒçš„ä¸€ä¸ªå®ç°ç±»WindowManagerImplï¼Œç„¶åè°ƒç”¨äº†å®ƒçš„<code>createLocalWindowManager(Window)</code>æ–¹æ³•ï¼Œå°†WindowManagerç›´æ¥å®ä¾‹åŒ–æˆäº†WindowManagerImplã€‚</p><p>è€Œ<code>createLocalWindowManager()</code>æ–¹æ³•é‡Œåˆ™æ˜¯ç®€å•åˆ°ä¸èƒ½å†ç®€å•çš„ä¸€å¥ä»£ç ï¼š</p><pre><code class="java">public WindowManagerImpl createLocalWindowManager(Window parentWindow) &#123;    return new WindowManagerImpl(mContext, parentWindow);&#125;</code></pre><p>è¯´ç™½äº†ï¼Œè¿™ä¸ª<code>mWindowManager</code>ä¸<code>(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE)</code>å‹æ ¹å°±ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå®ƒæ˜¯æ–°<code>new</code>å‡ºæ¥çš„ä¸€ä¸ªWindowManagerImplå®ä¾‹ã€‚</p><p>è¿™ä¸‹å¥½äº†ï¼Œå†¤æœ‰å¤´å€ºæœ‰ä¸»ï¼Œè¿™ä¸‹æˆ‘ä»¬å¯çŸ¥é“<code>addView()</code>æœ€ç»ˆæ˜¯ç”±è°æ¥å®ç°äº†ï¼Œå°±æ˜¯è¿™ä¸ªWindowManagerImplç±»ã€‚æ¥çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// WindowManagerImpl.javapublic final class WindowManagerImpl implements WindowManager &#123;    ...    private final WindowManagerGlobal mGlobal = WindowManagerGlobal.getInstance();    ...    @Override    public void addView(@NonNull View view, @NonNull ViewGroup.LayoutParams params) &#123;        applyDefaultToken(params);        mGlobal.addView(view, params, mContext.getDisplay(), mParentWindow);    &#125;&#125;</code></pre><p>WindowManagerGlobalæ˜¯å•ä¾‹æ¨¡å¼ï¼Œçœ‹æ¥æ˜¯è¦ä¸å¾ˆå¤šWindowManagerImplçš„å®ä¾‹è¿›è¡Œæ²Ÿé€šã€‚è€Œä¸”åœ¨è°ƒç”¨<code>addView()</code>æ—¶ï¼Œæ‰€ä»¥çš„è¦ç´ å…¨æœ‰äº†ï¼š</p><ol><li>è¦æ·»åŠ çš„View</li><li>è¯¥Viewçš„LayoutParams</li><li>Displayï¼ˆä¹Ÿå³è¦æ˜¾ç¤ºçš„å±å¹•ï¼‰</li><li>è¦æ·»åŠ åˆ°çš„Windowï¼ˆä¹Ÿå³PhoneWindowå®ä¾‹ï¼‰</li></ol><p>ä¸‡äº‹ä¿±å¤‡åªæ¬ ä¸œé£ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code>WindowManagerGlobal.addView()</code>æœ€åæ˜¯å¦‚ä½•æŠŠViewæ·»åŠ åˆ°Windowä¸Šçš„å§ï¼</p><pre><code class="java">// WindowManagerGlobal.javapublic void addView(View view, ViewGroup.LayoutParams params,        Display display, Window parentWindow) &#123;    // å„ç§nullæ£€æŸ¥    ...    final WindowManager.LayoutParams wparams = (WindowManager.LayoutParams) params;    if (parentWindow != null) &#123;        // å¦‚æœå½“å‰çª—å£éœ€è¦è¢«æ·»åŠ ä¸ºå¦ä¸€ä¸ªçª—å£çš„é™„å±çª—å£(å­çª—å£)ï¼Œåˆ™éœ€è¦çˆ¶çª—å£è§†è‡ªå·±çš„æƒ…å†µå¯¹å½“å‰çª—å£çš„å¸ƒå±€å‚æ•°è¿›è¡Œè°ƒæ•´        parentWindow.adjustLayoutParamsForSubWindow(wparams);    &#125;    // åˆæ˜¯ä¸€ä¸ªç›¸å½“é‡è¦çš„ç±»ï¼Œåé¢ä¼šè¯¦ç»†è®²    ViewRootImpl root;    View panelParentView = null;    // å› ä¸ºæ˜¯å•ä¾‹çš„Globalç±»ï¼Œæ‰€ä»¥çº¿ç¨‹åŒæ­¥éå¸¸é‡è¦    synchronized (mLock) &#123;        ...        // If this is a panel window, then find the window it is being        // attached to for future reference.        if (wparams.type &gt;= WindowManager.LayoutParams.FIRST_SUB_WINDOW &amp;&amp;                wparams.type &lt;= WindowManager.LayoutParams.LAST_SUB_WINDOW) &#123;            final int count = mViews.size();            for (int i = 0; i &lt; count; i++) &#123;                if (mRoots.get(i).mWindow.asBinder() == wparams.token) &#123;                    panelParentView = mViews.get(i);                &#125;            &#125;        &#125;        root = new ViewRootImpl(view.getContext(), display);  // 1        view.setLayoutParams(wparams);        mViews.add(view);        mRoots.add(root);        mParams.add(wparams);        // do this last because it fires off messages to start doing things        try &#123;            // å°†ä½œä¸ºçª—å£çš„æ§ä»¶è®¾ç½®ç»™ViewRootImpl.è¿™ä¸ªåŠ¨ä½œå°†å¯¼è‡´ViewRootImplå‘WMSæ·»åŠ æ–°çš„çª—å£ã€            // ç”³è¯·Surfaceä»¥åŠæ‰˜ç®¡æ§ä»¶åœ¨Surfaceä¸Šçš„é‡ç»˜å·¥ä½œï¼Œ            // è¿™æ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šå®Œæˆäº†çª—å£çš„æ·»åŠ å·¥ä½œã€‚            root.setView(view, wparams, panelParentView);  // 2        &#125; catch (RuntimeException e) &#123;            // BadTokenException or InvalidDisplayException, clean up.            if (index &gt;= 0) &#123;                removeViewLocked(index, true);            &#125;            throw e;        &#125;    &#125;    public void updateViewLayout(View view, ViewGroup.LayoutParams params) &#123;        if (view == null) &#123;            throw new IllegalArgumentException(&quot;view must not be null&quot;);        &#125;        if (!(params instanceof WindowManager.LayoutParams)) &#123;            throw new IllegalArgumentException(&quot;Params must be WindowManager.LayoutParams&quot;);        &#125;        final WindowManager.LayoutParams wparams = (WindowManager.LayoutParams)params;        view.setLayoutParams(wparams);        synchronized (mLock) &#123;            int index = findViewLocked(view, true);            ViewRootImpl root = mRoots.get(index);            mParams.remove(index);            mParams.add(index, wparams);            root.setLayoutParams(wparams, false);        &#125;    &#125;    @UnsupportedAppUsage    public void removeView(View view, boolean immediate) &#123;        if (view == null) &#123;            throw new IllegalArgumentException(&quot;view must not be null&quot;);        &#125;        synchronized (mLock) &#123;            int index = findViewLocked(view, true);            View curView = mRoots.get(index).getView();            removeViewLocked(index, immediate);            if (curView == view) &#123;                return;            &#125;            throw new IllegalStateException(&quot;Calling with view &quot; + view                    + &quot; but the ViewAncestor is attached to &quot; + curView);        &#125;    &#125;&#125;</code></pre><p>æˆ‘ä»¬èƒ½çœ‹å‡ºï¼ŒWindowManagerGlobalçš„èŒè´£å¦‚ä¸‹ï¼š</p><ol><li>ç»Ÿä¸€ç®¡ç†æ•´ä¸ªè¿›ç¨‹ä¸­æ‰€æœ‰çª—å£çš„ä¿¡æ¯ã€‚åŒ…æ‹¬æ§ä»¶ã€å¸ƒå±€å‚æ•°ä»¥åŠViewRootImplè¿™ä¸‰ä¸ªå…ƒç´ ã€‚</li><li>WindowManagerGlobalå°†çª—å£çš„åˆ›å»ºã€é”€æ¯ã€å¸ƒå±€æ›´æ–°ç­‰ä»»åŠ¡äº¤ç»™äº†ViewRootImplå®Œæˆã€‚</li></ol><p>æ ¹æ®çš„1å’Œ2ä¸¤å¥ä»£ç ï¼Œåˆå¼•å‡ºäº†ä¸€ä¸ªéå¸¸é‡è¦çš„ç±»â€”â€”ViewRootImplã€‚å…³äºå®ƒï¼Œæˆ‘ä»¬å¾—å•å¼€ä¸€ç¯‡æ–‡ç« æ¥è®²è®²ã€‚è¿™é‡Œåªç®€å•å¸¦è¿‡ä¸€ä¸‹ï¼š</p><pre><code class="java">// ViewRootImpl.java/** * View å±‚çº§çš„æœ€é¡¶ç«¯ï¼Œåœ¨Viewå’ŒWindowManagerå®ç°äº†ä¸€äº›å¿…è¦çš„åè®®ã€‚è¿™ä¸ªç±»æ˜¯WindowManagerGlobal * çš„å¤§éƒ¨åˆ†å†…éƒ¨è¯¦ç»†å®ç°ã€‚ */@SuppressWarnings(&#123;&quot;EmptyCatchBlock&quot;, &quot;PointlessBooleanExpression&quot;&#125;)public final class ViewRootImpl implements ViewParent,        View.AttachInfo.Callbacks, ThreadedRenderer.DrawCallbacks &#123;    ...    // è¿™ä¸ªç±»æ˜¯å»ºç«‹ç¡¬ä»¶è¾“å…¥è®¾å¤‡ä¸è½¯ä»¶å…³è”çš„ä¸€ä¸ªç±»ï¼Œ    // ä¹Ÿæ˜¯çª—å£æ¥æ”¶æ¥è‡ª InputDispatcher çš„è¾“å…¥äº‹ä»¶çš„ç®¡é“    InputChannel mInputChannel;    // WindowInputEventReceiver ç”¨äºæ¥æ”¶è¾“å…¥è®¾å¤‡çš„è¾“å…¥äº‹ä»¶ï¼Œé‡è¦çš„äº‹ä»¶å›è°ƒåœ¨å…¶ onInputEvent(InputEvent) æ–¹æ³•ä¸­    WindowInputEventReceiver mInputEventReceiver;    IWindowSession mWindowSession;    public ViewRootImpl(Context context, Display display) &#123;        ...        // ä» WindowManagerGlobal ä¸­è·å–ä¸€ä¸ªIWindowSessionçš„å®ä¾‹ã€‚        // å®ƒæ˜¯ViewRootImplå’Œ WindowManagerServiceï¼ˆä»¥ä¸‹ç®€ç§°WMSï¼‰è¿›è¡Œé€šä¿¡çš„ä»£ç†        mWindowSession = WindowManagerGlobal.getWindowSession();        ...    &#125;    // FallbackEventHandleræ˜¯ä¸€ä¸ªå¤„ç†æœªç»ä»»ä½•äººæ¶ˆè´¹çš„è¾“å…¥äº‹ä»¶çš„åœºæ‰€.    mFallbackEventHandler = new PhoneFallbackEventHandler(context);    ...     /**     * We have one child     */    public void setView(View view, WindowManager.LayoutParams attrs, View panelParentView) &#123;        synchronized (this) &#123;            if (mView == null) &#123;                mView = view;  // å°†ä¼ å…¥çš„ DecorView ä¿å­˜åˆ° mView                ...                mFallbackEventHandler.setView(view);                ...                int res; /* = WindowManagerImpl.ADD_OKAY; */                /**                 * åœ¨æ·»åŠ çª—å£ä¹‹å‰ï¼Œå…ˆé€šè¿‡requestLayoutæ–¹æ³•åœ¨ä¸»çº¿ç¨‹ä¸Šå®‰æ’ä¸€æ¬¡ã€éå†ã€ã€‚                 * æ‰€è°“ã€éå†ã€æ˜¯æŒ‡ViewRootImplä¸­çš„æ ¸å¿ƒæ–¹æ³•performTraversal()ã€‚                 * è¿™ä¸ªæ–¹æ³•å®ç°å¯¹æ§ä»¶æ ‘è¿›è¡Œmeasureã€layoutã€å‘WMSç”³è¯·ä¿®æ”¹çª—å£å±æ€§ä»¥åŠé‡ç»˜çš„æ‰€æœ‰å·¥ä½œã€‚                 */                requestLayout();                                // æ­¤å¤„æ–°å»ºäº† InputChannel çš„å®ä¾‹ï¼Œä½†å¹¶æœªè¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ˜¯ç›´æ¥å°†ç»™äº† WindowSession å»è¿›è¡Œåˆå§‹åŒ–ã€‚                // è¿™ä¹Ÿæ ‡å¿—ç€åœ¨å½“å‰ Window å’Œ InputManagerService ä¸­é—´ï¼Œæ­£å¼å»ºç«‹äº†æ¥å—è®¾å¤‡äº‹ä»¶çš„é€šé“ã€‚                if ((mWindowAttributes.inputFeatures                        &amp; WindowManager.LayoutParams.INPUT_FEATURE_NO_INPUT_CHANNEL) == 0) &#123;                         mInputChannel = new InputChannel();                &#125;                ...                try &#123;                    ...                    /**                     *ä¸Šæ–‡åˆšè®²è¿‡ mWindowSession æ˜¯ä¸ª Binder ç±»ï¼Œå®ƒçš„å®ç°ç±»æ˜¯ Sessionï¼Œ                     * å°†é€šè¿‡ IPC è¿œç¨‹è°ƒç”¨ï¼ˆå³è°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ï¼‰Session çš„ addToDisplay æ–¹æ³•æŠŠçª—å£æ·»åŠ è¿›WMSä¸­ã€‚                     * å®Œæˆè¿™ä¸ªæ“ä½œåï¼ŒmWindow å·²ç»è¢«æ·»åŠ åˆ°æŒ‡å®šå¯¹è±¡ä¸­è€Œä¸” mInputChannelï¼ˆå¦‚æœä¸ä¸ºç©ºï¼‰å·²ç»å‡†å¤‡å¥½æ¥æ”¶äº‹ä»¶                     * åªæ˜¯ç”±äºè¿™ä¸ªçª—å£æ²¡æœ‰è¿›è¡Œè¿‡relayout()ï¼Œå› æ­¤å®ƒè¿˜æ²¡æœ‰æœ‰æ•ˆçš„Surfaceå¯ä»¥è¿›è¡Œç»˜åˆ¶                      */                    res = mWindowSession.addToDisplay(mWindow, mSeq, mWindowAttributes,                            getHostVisibility(), mDisplay.getDisplayId(), mTmpFrame,                            mAttachInfo.mContentInsets, mAttachInfo.mStableInsets,                            mAttachInfo.mOutsets, mAttachInfo.mDisplayCutout, mInputChannel,                            mTempInsets);                &#125; catch (RemoteException e) &#123;                    ...                &#125; finally &#123;                    ...                &#125;                ...                // å¦‚æœmInputChannelä¸ä¸ºç©ºï¼Œåˆ™åˆ›å»ºmInputEventReceiverï¼Œç”¨äºæ¥å—è¾“å…¥äº‹ä»¶ã€‚                // æ³¨æ„ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ˜¯Looper.myLooper()ï¼Œå³ mInputEventReceiver å°†åœ¨ä¸»çº¿ç¨‹ä¸Š                // è§¦å‘è¾“å…¥äº‹ä»¶çš„è¯»å–ä¸ onInputEvent()ã€‚è¿™æ˜¯åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ onTouch() ç­‰äº‹ä»¶å“åº”ä¸­                // ç›´æ¥è¿›è¡ŒUIæ“ä½œç­‰æ ¹æœ¬åŸå› ã€‚                if (mInputChannel != null) &#123;                    ...                    mInputEventReceiver = new WindowInputEventReceiver(mInputChannel,                            Looper.myLooper());                &#125;                ...                view.assignParent(this);                ...            &#125;        &#125;    &#125;&#125;</code></pre><p>æ¥ç€åˆ†æä»£ç å¯ä»¥çœ‹åˆ°mWindowSessionçš„ç±»å‹æ˜¯ï¼šIWindowSessionï¼Œå¹¶ä¸”æ˜¯é€šè¿‡WindowManagerGlobal.getWindowSession()åˆå§‹åŒ–çš„:</p><pre><code class="java">public static IWindowSession getWindowSession() &#123;    synchronized (WindowManagerGlobal.class) &#123;        if (sWindowSession == null) &#123;            try &#123;                InputMethodManager imm = InputMethodManager.getInstance();                IWindowManager windowManager = getWindowManagerService();                sWindowSession = windowManager.openSession(                        new IWindowSessionCallback.Stub() &#123;                            @Override                            public void onAnimatorScaleChanged(float scale) &#123;                                ValueAnimator.setDurationScale(scale);                            &#125;                        &#125;,                        imm.getClient(), imm.getInputContext());            &#125; catch (RemoteException e) &#123;                throw e.rethrowFromSystemServer();            &#125;        &#125;        return sWindowSession;    &#125;&#125;</code></pre><p>è€ŒgetWindowSessionæ–¹æ³•é‡Œï¼Œåˆ™æ˜¯è·¨è¿›ç¨‹è°ƒç”¨openSessionæ–¹æ³•è·å–ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹WindowManagerServiceé‡Œçš„openSessionæ–¹æ³•ï¼š</p><pre><code class="java">public class WindowManagerService extends IWindowManager.Stub implements Watchdog.Monitor, WindowManagerPolicy.WindowManagerFuncs &#123;    @Override    public IWindowSession openSession(IWindowSessionCallback callback, IInputMethodClient client,            IInputContext inputContext) &#123;        if (client == null) throw new IllegalArgumentException(&quot;null client&quot;);        if (inputContext == null) throw new IllegalArgumentException(&quot;null inputContext&quot;);        Session session = new Session(this, callback, client, inputContext);        return session;    &#125;&#125;</code></pre><p>äºæ˜¯è¿™é‡Œçš„windowè¢«äº¤ç»™äº†IWindowSession.aidlçš„å®ç°ç±»Sessionä¸­ï¼š</p><pre><code class="java">// Session.java/** * è¿™ä¸ªç±»ä»£è¡¨äº†ä¸€ä¸ª * This class represents an active client session.  There is generally one * Session object per process that is interacting with the window manager. */class Session extends IWindowSession.Stub implements IBinder.DeathRecipient &#123;    @Override    public int addToDisplay(IWindow window, int seq, WindowManager.LayoutParams attrs,            int viewVisibility, int displayId, Rect outFrame, Rect outContentInsets,            Rect outStableInsets, Rect outOutsets,            DisplayCutout.ParcelableWrapper outDisplayCutout, InputChannel outInputChannel,            InsetsState outInsetsState) &#123;        return mService.addWindow(this, window, seq, attrs, viewVisibility, displayId, outFrame,                outContentInsets, outStableInsets, outOutsets, outDisplayCutout, outInputChannel,                outInsetsState);    &#125;&#125;</code></pre><p>æ­¤å¤„çš„<code>mService</code>è‡ªç„¶å°±æ˜¯WindowManagerServiceå–½ï¼Œä¹Ÿå°±æ˜¯ç»•å®Œä¸€åœˆï¼Œè¿˜æ˜¯æŠŠ<code>addWindow()</code>çš„å·¥ä½œäº¤ç»™äº†WindowManagerServiceã€‚æˆ‘ä»¬æ¥çœ‹çœ‹WindowManagerServiceé‡Œæ˜¯æ€æ ·æ·»åŠ Windowçš„ï¼š</p><pre><code class="java">final WindowHashMap mWindowMap = new WIndowHashMap();public int addWindow(Session session, IWindow client, int seq,            LayoutParams attrs, int viewVisibility, int displayId, Rect outFrame,            Rect outContentInsets, Rect outStableInsets, Rect outOutsets,            DisplayCutout.ParcelableWrapper outDisplayCutout, InputChannel outInputChannel,            InsetsState outInsetsState) &#123;    ...    WindowState parentWindow = null;    ...    synchronized (mGlobalLock) &#123;        ...        final WindowState win = new WindowState(this, session, client, token, parentWindow,                    appOp[0], seq, attrs, viewVisibility, session.mUid,                    session.mCanAddInternalSystemWindow);        ...        // From now on, no exceptions or errors allowed!        ...        win.attach();        mWindowMap.put(client.asBinder(), win);        win.initAppOpsState();    &#125;&#125;</code></pre><p>åˆšæ‰ä»ViewRootImplå¼€å§‹ï¼Œç›´åˆ°è¿™é‡Œæ·»åŠ Windowç»“æŸï¼Œæ•´ä¸ªæµç¨‹å¯ä»¥å½’ç»“ä¸ºä¸‹é¢äºŒå›¾ï¼š</p><p><img src="/img/24.png"><br><img src="/img/25.png"></p><p>å¦‚æ­¤ä¸€æ¥ï¼ŒWindowçš„æ·»åŠ è¯·æ±‚å°±äº¤ç»™WMSå»å¤„ç†äº†ï¼Œåœ¨WMSå†…éƒ¨ä¼šä¸ºæ¯ä¸€ä¸ªåº”ç”¨ä¿ç•™ä¸€ä¸ªå•ç‹¬çš„Sessionã€‚åœ¨ WMS ç«¯ä¼šåˆ›å»ºä¸€ä¸ªWindowStateå¯¹è±¡ç”¨æ¥è¡¨ç¤ºå½“å‰æ·»åŠ çš„çª—å£ã€‚ WMSè´Ÿè´£ç®¡ç†è¿™é‡Œäº› WindowState å¯¹è±¡ã€‚è‡³æ­¤ï¼ŒWindowçš„æ·»åŠ è¿‡ç¨‹å°±ç»“æŸäº†ã€‚</p><p>è‡³äºWindowçš„åˆ é™¤å’Œæ›´æ–°è¿‡ç¨‹ï¼Œä¸¾ä¸€åä¸‰ï¼Œä¹Ÿæ˜¯ä½¿ç”¨WindowManagerGlobalå¯¹ViewRootImplçš„æ“ä½œï¼Œæœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡Sessionçš„IPCè·¨è¿›ç¨‹é€šä¿¡é€šçŸ¥åˆ°WMSã€‚æ•´ä¸ªè¿‡ç¨‹çš„æœ¬è´¨éƒ½æ˜¯åŒå‡ºä¸€è¾™çš„ã€‚</p><p>è‡³æ­¤ï¼Œä»Activityçš„åˆ›å»ºï¼Œåˆ°å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå·²ç»åŸºæœ¬å®Œæˆï¼ŒèƒŒåçš„å·¥ä½œè¿˜éœ€è¦äº¤ç»™WindowServiceManagerä»¥åŠç¡¬ä»¶å±‚é¢çš„ä¸€æ­¤å·¥ä½œï¼Œä¹Ÿå°±ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´é‡Œäº†ã€‚</p><p>æœ€åå†æ¥ä¸€å¼ æ•´ä½“çš„æµç¨‹å›¾ï¼Œæˆ‘ä»¬å†æ¢³ç†ä¸€ä¸‹ï¼š</p><p><img src="/img/26.png"></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Activity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Butter Knife</title>
      <link href="/2020-02-13//"/>
      <url>/2020-02-13//</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« è®²ä¸€ä¸‹ Butterknifeï¼Œä½†æ˜¯åé¢ä¼šå¼•ç”³åˆ° Android Jetpack ä¸­çš„ DataBindingã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> butterknife </tag>
            
            <tag> æºç è§£æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºæ³¨è§£</title>
      <link href="/2020-02-03/annotation/"/>
      <url>/2020-02-03/annotation/</url>
      
        <content type="html"><![CDATA[<p>Annotation æ˜¯ JDK1.5 ä¹‹ååŠ å…¥åˆ° Java ä¸­çš„ï¼Œå®ƒå…¶å®å°±æ˜¯ä»£ç é‡Œçš„ç‰¹æ®Šæ ‡è®°, ç”¨äºæ›¿ä»£é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ ç»Ÿæ–¹å¼é€šè¿‡é…ç½®æ–‡ä»¶å‘Šè¯‰ç±»å¦‚ä½•è¿è¡Œï¼Œæœ‰äº†æ³¨è§£æŠ€æœ¯åï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ³¨è§£<strong>å‘Šè¯‰ç±»å¦‚ä½•è¿è¡Œ</strong>ã€‚å®ƒæä¾›äº†ä¸€ç§å®‰å…¨çš„<strong>ç±»ä¼¼æ³¨é‡Šçš„æœºåˆ¶</strong>ï¼Œç”¨æ¥å°†ä¿¡æ¯æˆ–å…ƒæ•°æ®ï¼ˆmetadataï¼‰ä¸ç¨‹åºå…ƒç´ ï¼ˆç±»ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ç­‰ï¼‰è¿›è¡Œå…³è”ã€‚å®ƒåƒä¸€ç§ä¿®é¥°ç¬¦ä¸€æ ·ï¼Œåº”ç”¨äºåŒ…ã€ç±»å‹ã€æ„é€ æ–¹æ³•ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ã€å‚æ•°åŠæœ¬åœ°å˜é‡çš„å£°æ˜è¯­å¥ä¸­ã€‚</p><span id="more"></span><p>æ³¨è§£æ˜¯ä»¥<code>@æ³¨è§£å</code>åœ¨ä»£ç ä¸­å­˜åœ¨çš„ï¼Œæ ¹æ®æ³¨è§£å‚æ•°çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ³¨è§£åˆ†ä¸ºï¼š</p><ul><li>æ ‡è®°æ³¨è§£</li><li>å•å€¼æ³¨è§£</li><li>å®Œæ•´æ³¨è§£ </li></ul><p>å®ƒä»¬éƒ½ä¸ä¼šç›´æ¥å½±å“åˆ°ç¨‹åºçš„è¯­ä¹‰ï¼Œåªæ˜¯ä½œä¸ºæ³¨è§£ï¼ˆæ ‡è¯†ï¼‰å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æœºåˆ¶ç¼–ç¨‹å®ç°å¯¹è¿™äº›å…ƒæ•°æ®ï¼ˆç”¨æ¥æè¿°æ•°æ®çš„æ•°æ®ï¼‰çš„è®¿é—®ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº† Java ä¸­å¸¸è§çš„æ³¨è§£çš„åˆ†ç±»ï¼š</p><div class="center-img"><p><img src="/img/annotation-1588558927.png"></p></div><h2 id="æ ‡å‡†æ³¨è§£"><a href="#æ ‡å‡†æ³¨è§£" class="headerlink" title="æ ‡å‡†æ³¨è§£"></a>æ ‡å‡†æ³¨è§£</h2><p>Javaä¸­æœ‰ä¸‰ä¸ªæœ€åŸºæœ¬çš„æ ‡å‡†æ³¨è§£ï¼š</p><ul><li><code>@Override</code>: é™å®šé‡å†™çˆ¶ç±»æ–¹æ³•, è¯¥æ³¨è§£åªèƒ½ç”¨äºæ–¹æ³•ã€‚</li><li><code>@Deprecated</code>: ç”¨äºè¡¨ç¤ºæŸä¸ªç¨‹åºå…ƒç´ ï¼ˆç±», æ–¹æ³•ç­‰ï¼‰å·²è¿‡æ—¶ã€‚</li><li><code>@SuppressWarnings</code>: æŠ‘åˆ¶ç¼–è¯‘å™¨è­¦å‘Šã€‚</li></ul><p>æ³¨è§£å±æ€§çš„ç±»å‹åªèƒ½æ˜¯å¦‚ä¸‹ç±»å‹ï¼šString ç±»å‹ã€8å¤§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆint, float, boolean, byte, double, char, long, shortï¼‰ã€Classç±»å‹ã€æšä¸¾ç±»å‹ã€æ³¨è§£ç±»å‹ä»¥åŠä»¥ä¸Šç±»å‹çš„ä¸€ç»´æ•°ç»„ã€‚å¦‚æœä¸€ä¸ªæ³¨è§£åªæœ‰ä¸€ä¸ªå±æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§çš„åç§°ä¸º<code>value</code>çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨æ³¨è§£æ—¶<strong>å¯ä»¥çœç•¥</strong><code>value=</code>éƒ¨åˆ†ï¼Œå¦‚å°†<code>@MyAnnotation(value=&quot;XXX&quot;)</code>æ›¿æ¢ä¸º<code>@MyAnnotation(&quot;xxx&quot;)</code>ã€‚</p><h2 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h2><p>æåˆ°æ³¨è§£ï¼Œä¹Ÿä¸å¾—ä¸æä¸€ä¸‹ã€<strong>å…ƒæ³¨è§£</strong>ã€ã€‚å…ƒæ³¨è§£å³ã€<strong>æ³¨è§£çš„æ³¨è§£</strong>ã€ï¼Œä¸“é—¨è´Ÿè´£æ³¨è§£å…¶ä»–çš„æ³¨è§£ã€‚åœ¨Javaä¸­æœ‰å‡ ç§å¸¸ç”¨çš„å…ƒæ³¨è§£ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><code>@Retention</code>ï¼šæ ‡è¯†ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¯¥æ³¨è§£ã€‚</li><li><code>@Documented</code>ï¼šæ³¨è§£æ˜¯å¦å°†åŒ…å«åœ¨Javadocä¸­ã€‚</li><li><code>@Target</code>ï¼šæ³¨è§£å°†ç”¨äºä»€ä¹ˆåœ°æ–¹ã€‚</li><li><code>@Inherited</code>ï¼šæ˜¯å¦å…è®¸å­ç±»ç»§æ‰¿è¯¥æ³¨è§£ã€‚</li><li><code>@Repeatable</code>ï¼šå…è®¸å¯¹æŸä¸ªå…ƒç´ å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ã€‚</li></ul><p>å…¶ä¸­ï¼ŒRepeatable æ˜¯åœ¨ jdk1.8 ä¸­å¼•è¿›çš„ã€‚æˆ‘ä»¬ç®€å•åœ°è§£é‡Šä¸€ä¸‹è¿™å‡ ç§å…ƒæ³¨è§£ã€‚</p><h3 id="1-Retention"><a href="#1-Retention" class="headerlink" title="1. Retention"></a>1. <strong>Retention</strong></h3><p>Retention å…ƒæ³¨è§£ï¼Œè¡¨ç¤ºéœ€è¦<strong>åœ¨ä»€ä¹ˆçº§åˆ«ä¿å­˜è¯¥æ³¨è§£ä¿¡æ¯</strong>ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ã€‚å¦‚æœæ³¨è§£ç±»å‹å£°æ˜ä¸­ä¸å­˜åœ¨ Retention æ³¨è§£ï¼Œåˆ™ä¿ç•™ç­–ç•¥é»˜è®¤ä¸º <code>RetentionPolicy.CLASS</code>ã€‚å¯é€‰çš„Â RetentionPoicy å‚æ•°åŒ…æ‹¬ï¼š</p><table><thead><tr><th>æšä¸¾å¸¸é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>RetentionPolicy.SOURCE</code></td><td>åœç•™åœ¨ java æºæ–‡ä»¶ï¼Œä¼šè¢«ç¼–è¯‘å™¨ä¸¢å¼ƒ</td></tr><tr><td><code>RetentionPolicy.CLASS</code></td><td>åœç•™åœ¨ class æ–‡ä»¶ä¸­ï¼Œä½†ä¼šè¢«VMä¸¢å¼ƒï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><code>RetentionPolicy.RUNTIME</code></td><td>å†…å­˜ä¸­çš„å­—èŠ‚ç ï¼ŒVM å°†åœ¨è¿è¡Œæ—¶ä¹Ÿä¿ç•™æ³¨è§£ï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¯»å–æ³¨è§£çš„ä¿¡æ¯</td></tr></tbody></table><h3 id="2-Documented"><a href="#2-Documented" class="headerlink" title="2. Documented"></a>2. <strong>Documented</strong></h3><p>Documented å°†æ³¨è§£åŒ…å«åœ¨ Javadoc ä¸­ã€‚</p><p>ä½¿ç”¨è¯¥æ³¨è§£ï¼Œè¡¨ç¤ºæŸä¸€ä¸ªç±»å‹çš„æ³¨é‡Šå°†é€šè¿‡ Javadoc æˆ–è€…ç±»ä¼¼çš„å·¥å…·è¿›è¡Œæ–‡æ¡£åŒ–ï¼Œåº”ä½¿ç”¨æ­¤ç±»å‹æ¥æ³¨é‡Šè¿™äº›ç±»å‹çš„å£°æ˜ï¼Œå…¶æ³¨é‡Šä¼šå½±å“ç”±å…¶å®¢æˆ·ç«¯æ³¨é‡Šçš„å…ƒç´ çš„ä½¿ç”¨ã€‚å¦‚æœç±»å‹å£°æ˜æ˜¯ç”¨ Documented æ¥æ³¨é‡Šçš„ï¼Œåˆ™å…¶æ³¨é‡Šå°†æˆä¸ºæ³¨é‡Šå…ƒç´ çš„å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="3-Target"><a href="#3-Target" class="headerlink" title="3. Target"></a>3. <strong>Target</strong></h3><p>Target è¯´æ˜äº†æ³¨è§£<strong>æ‰€ä¿®é¥°çš„å¯¹è±¡èŒƒå›´</strong>ï¼šAnnotation å¯è¢«ç”¨äº packagesã€typesï¼ˆç±»ã€æ¥å£ã€æšä¸¾ã€Annotation ç±»å‹ï¼‰ã€ç±»å‹æˆå‘˜ï¼ˆæ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆå‘˜å˜é‡ã€æšä¸¾å€¼ï¼‰ã€æ–¹æ³•å‚æ•°å’Œæœ¬åœ°å˜é‡ï¼ˆå¦‚å¾ªç¯å˜é‡ã€catchå‚æ•°ï¼‰ã€‚åœ¨ Annotation ç±»å‹çš„å£°æ˜ä¸­ä½¿ç”¨äº† Target å¯æ›´åŠ æ˜æ™°å…¶ä¿®é¥°çš„ç›®æ ‡ã€‚åªæœ‰å…ƒæ³¨è§£ç±»å‹ç›´æ¥ç”¨äºæ³¨è§£æ—¶ï¼ŒTarget å…ƒæ³¨é‡Šæ‰æœ‰æ•ˆã€‚å¦‚æœå…ƒæ³¨è§£ç±»å‹ç”¨ä½œå¦ä¸€ç§æ³¨è§£ç±»å‹çš„æˆå‘˜ï¼Œåˆ™æ— æ•ˆã€‚å¦‚æœæ³¨é‡Šç±»å‹å£°æ˜ä¸­ä¸å­˜åœ¨ Target å…ƒæ³¨é‡Šï¼Œåˆ™å£°æ˜çš„ç±»å‹å¯ä»¥ç”¨åœ¨ä»»ä¸€ç¨‹åºå…ƒç´ ä¸Šã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„å…ƒæ³¨é‡Šï¼Œåˆ™ç¼–è¯‘å™¨å¼ºåˆ¶å®æ–½æŒ‡å®šçš„ä½¿ç”¨é™åˆ¶ã€‚</p><table><thead><tr><th>æšä¸¾å¸¸é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ElementType.CONSTRUCTOR</code></td><td>æ„é€ å™¨å£°æ˜</td></tr><tr><td><code>ElementType.FIELD</code></td><td>æˆå‘˜å˜é‡ã€å¯¹è±¡ã€å±æ€§ï¼ˆåŒ…æ‹¬enumå®ä¾‹ï¼‰</td></tr><tr><td><code>ElementType.LOCAL_VARIABLE</code></td><td>å±€éƒ¨å˜é‡å£°æ˜</td></tr><tr><td><code>ElementType.METHOD</code></td><td>æ–¹æ³•å£°æ˜</td></tr><tr><td><code>ElementType.PACKAGE</code></td><td>åŒ…å£°æ˜</td></tr><tr><td><code>ElementType.PARAMETER</code></td><td>å‚æ•°å£°æ˜</td></tr><tr><td><code>ElementType.TYPE</code></td><td>ç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹)æˆ–enumå£°æ˜</td></tr></tbody></table><p>ä¸¾ä¸ªä¾‹å­ï¼ŒRetrofit2ä¸­æœ‰ä¸ª<code>@Field</code>æ³¨è§£ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒçš„æºç ï¼š</p><pre><code class="java">// Field.javaimport java.lang.annotation.Annotation;import java.lang.annotation.Documented;import java.lang.annotation.Retention;import java.lang.annotation.Target;@Documented@Target(PARAMETER)@Retention(RUNTIME)public @interface Field &#123;  String value();  /** Specifies whether the &#123;@linkplain #value() name&#125; and value are already URL encoded. */  boolean encoded() default false;&#125;</code></pre><p>å…¶ Target æ³¨è§£çš„å¸¸é‡ç±»å‹ä¸º<code>PARAMETER</code>ï¼Œè¡¨ç¤º<code>Field</code>è¿™ä¸ªæ³¨è§£é€‚ç”¨äº<strong>å‚æ•°</strong>ï¼Œå¦‚æœè¿™ä¸ªæ³¨è§£ç”¨åœ¨äº†æ–¹æ³•ä¸Šï¼Œé‚£å°±ä¸èµ·ä»»ä½•ä½œç”¨ã€‚</p><h3 id="4-Inherited"><a href="#4-Inherited" class="headerlink" title="4. Inherited"></a>4. <strong>Inherited</strong></h3><p>Inherited å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ³¨è§£ï¼Œæ³¨é‡Šç±»å‹è¢«è‡ªåŠ¨ç»§æ‰¿ã€‚</p><p>å¦‚æœåœ¨æ³¨é‡Šç±»å‹å£°æ˜ä¸­å­˜åœ¨ Inherited å…ƒæ³¨é‡Šï¼Œå¹¶ä¸”ç”¨æˆ·åœ¨æŸä¸€ç±»å£°æ˜ä¸­æŸ¥è¯¢è¯¥æ³¨é‡Šç±»å‹ï¼ŒåŒæ—¶è¯¥ç±»å£°æ˜ä¸­æ²¡æœ‰æ­¤ç±»å‹çš„æ³¨é‡Šï¼Œåˆ™å°†åœ¨è¯¥ç±»çš„è¶…ç±»ä¸­è‡ªåŠ¨æŸ¥è¯¢è¯¥æ³¨é‡Šç±»å‹ã€‚æ­¤è¿‡ç¨‹ä¼šé‡å¤è¿›è¡Œï¼Œç›´åˆ°æ‰¾åˆ°æ­¤ç±»å‹çš„æ³¨é‡Šæˆ–åˆ°è¾¾äº†è¯¥ç±»å±‚æ¬¡ç»“æ„çš„é¡¶å±‚ (Object) ä¸ºæ­¢ã€‚å¦‚æœæ²¡æœ‰è¶…ç±»å…·æœ‰è¯¥ç±»å‹çš„æ³¨é‡Šï¼Œåˆ™æŸ¥è¯¢å°†æŒ‡ç¤ºå½“å‰ç±»æ²¡æœ‰è¿™æ ·çš„æ³¨é‡Šã€‚å¦‚æœä½¿ç”¨æ³¨é‡Šç±»å‹æ³¨é‡Šç±»ä»¥å¤–çš„ä»»ä½•äº‹ç‰©ï¼Œæ­¤å…ƒæ³¨é‡Šç±»å‹éƒ½æ˜¯æ— æ•ˆçš„ã€‚æ­¤å…ƒæ³¨é‡Šä»…ä¿ƒæˆä»è¶…ç±»ç»§æ‰¿æ³¨é‡Šï¼Œå¯¹å·²å®ç°æ¥å£çš„æ³¨é‡Šæ— æ•ˆã€‚</p><h3 id="5-Repeatable"><a href="#5-Repeatable" class="headerlink" title="5. Repeatable"></a>5. <strong>Repeatable</strong></h3><p>Repeatable è¡¨ç¤ºè¢«æ ‡è®°çš„æ³¨è§£å¯ä»¥<strong>å¤šæ¬¡åº”ç”¨äºç›¸åŒçš„å£°æ˜æˆ–ç±»å‹</strong>ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><p>å…ˆå£°æ˜ä¸€ä¸ªé‡å¤æ³¨è§£ç±»ï¼š</p><pre><code class="java">@Repeatable(Tip.class)public @interface Tip &#123;    String dayOfMonth() default &quot;1&quot;;    String dayOfWeek() default &quot;Monday&quot;;    int hour() default 12;&#125;</code></pre><p>å†å£°æ˜ä¸€ä¸ªå®¹å™¨æ³¨è§£ç±»ï¼š</p><pre><code class="java">@Retention(RetentionPolicy.RUNTIME)public @interface Tips &#123;    Tip[] value();&#125;</code></pre><p>ç„¶åæ˜¯ä½¿ç”¨ï¼š</p><pre><code class="java">@Tip(dayOfMonth = &quot;10&quot;)@Tip(dayOfWeek = &quot;Tuesday&quot;, hour = 15)public class RepetableAnnotation&#123;    @Tip(dayOfMonth = &quot;20&quot;)    @Tip(dayOfWeek = &quot;Friday&quot;, hour = 23)    public void doPeriodicTip()&#123;&#125;    public static void main(String[] args) throws NoSuchMethodException &#123;        Method doPeriodicTip = RepetableAnnotation.class.getMethod(&quot;doPeriodicTip&quot;);        Tips tips = doPeriodicTip.getAnnotation(Tips.class);        System.out.println(&quot;è·å–æ ‡è®°æ–¹æ³•ä¸Šçš„é‡å¤æ³¨è§£ï¼š&quot;);        for (Tip tip: tips.value())&#123;            System.out.println(tip);        &#125;        System.out.println(&quot;è·å–æ ‡è®°ç±»ä¸Šçš„é‡å¤æ³¨è§£ï¼š&quot;);        if (RepetableAnnotation.class.isAnnotationPresent(Tips.class))&#123;            Tips = RepetableAnnotation.class.getAnnotation(Tips.class);            for (Tip Tip: Tips.value())&#123;                System.out.println(Tip);            &#125;        &#125;    &#125;&#125;</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code>è·å–æ ‡è®°æ–¹æ³•ä¸Šçš„é‡å¤æ³¨è§£ï¼šTip(hour=12, dayOfMonth=10, dayOfWeek=Monday)Tip(hour=23, dayOfMonth=1, dayOfWeek=Friday)è·å–æ ‡è®°ç±»ä¸Šçš„é‡å¤æ³¨è§£ï¼šTip(hour=12, dayOfMonth=10, dayOfWeek=Monday)Tip(hour=15, dayOfMonth=1, dayOfWeek=Tuesday)</code></pre><h2 id="æ³¨è§£çš„ç”¨é€”"><a href="#æ³¨è§£çš„ç”¨é€”" class="headerlink" title="æ³¨è§£çš„ç”¨é€”"></a>æ³¨è§£çš„ç”¨é€”</h2><p>æ³¨è§£åœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œå®ƒçš„ç”¨é€”å°±æ˜¯ã€ç®€åŒ–ä»£ç ï¼Œè®©ä½ ä¸“æ³¨åšé‡è¦çš„äº‹æƒ…ã€ã€‚å½“ç„¶ï¼Œä¸åŒçš„æ³¨è§£æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œä¸‹é¢åˆ—å‡ºå››ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼š</p><ol><li><strong>ç”Ÿæˆæ–‡æ¡£</strong>ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®ç”Ÿæˆ Javadoc æ–‡æ¡£ã€‚</li><li><strong>ç¼–è¯‘æ£€æŸ¥</strong>ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è¿›è¡Œæ£€æŸ¥éªŒè¯ã€‚</li><li><strong>ç¼–è¯‘æ—¶åŠ¨æ€å¤„ç†</strong>ï¼Œç¼–è¯‘æ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œä¾‹å¦‚åŠ¨æ€ç”Ÿæˆä»£ç ã€‚</li><li><strong>è¿è¡Œæ—¶åŠ¨æ€å¤„ç†</strong>ï¼Œè¿è¡Œæ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨åå°„æ³¨å…¥å®ä¾‹ã€‚</li></ol><p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªæ —å­ï¼Œæ¥ä»‹ç»ä¸€ä¸‹æ³¨è§£çš„åŸºæœ¬åŸç†ã€‚</p><h2 id="æ³¨è§£çš„å®ç°åŸç†"><a href="#æ³¨è§£çš„å®ç°åŸç†" class="headerlink" title="æ³¨è§£çš„å®ç°åŸç†"></a>æ³¨è§£çš„å®ç°åŸç†</h2><pre><code class="java">// CustomTargetType.java/** * å®šä¹‰ä¸€ä¸ªå¯ä»¥æ³¨è§£åœ¨ class,interface,enum ä¸Šçš„æ³¨è§£ */import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)public @interface CustomTargetType &#123;    String value() default &quot;æˆ‘æ˜¯å®šä¹‰åœ¨ç±»ã€æ¥å£ã€æšä¸¾ç±»ä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼&quot;;&#125;</code></pre><pre><code class="java">// CustomTargetField.java/** * å®šä¹‰ä¸€ä¸ªå¯ä»¥æ³¨è§£åœ¨FIELDä¸Šçš„æ³¨è§£ */import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)public @interface CustomTargetField &#123;    String value() default &quot;æˆ‘æ˜¯å®šä¹‰åœ¨å­—æ®µä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼&quot;;&#125;</code></pre><pre><code class="java">// CustomTargetMethod.java/** * å®šä¹‰ä¸€ä¸ªå¯ä»¥æ³¨è§£åœ¨METHODä¸Šçš„æ³¨è§£ */import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)public @interface CustomTargetMethod &#123;    String value() default &quot;æˆ‘æ˜¯å®šä¹‰åœ¨æ–¹æ³•ä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼&quot;;&#125;</code></pre><pre><code class="java">// CustomTargetParameter.java/** * å®šä¹‰ä¸€ä¸ªå¯ä»¥æ³¨è§£åœ¨PARAMETERä¸Šçš„æ³¨è§£ */import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;@Target(ElementType.PARAMETER)@Retention(RetentionPolicy.RUNTIME)public @interface CustomTargetParameter &#123;    String value() default &quot;æˆ‘æ˜¯å®šä¹‰åœ¨å‚æ•°ä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼&quot;;&#125;</code></pre><p>æ³¨è§£å®šä¹‰å®Œæ¯•åï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•ç±»æ¥å¤„ç†ä¸Šé¢çš„æ³¨è§£ï¼š</p><pre><code class="java">// AnnotationTest.java@CustomTargetTypepublic class AnnotationTest &#123;    @CustomTargetField    private String mField = &quot;æˆ‘æ˜¯å­—æ®µ&quot;;    @CustomTargetMethod(&quot;æµ‹è¯•æ–¹æ³•&quot;)    public void test(@CustomTargetParameter String args) &#123;        System.out.println(&quot;å‚æ•°å€¼ === &quot; + args);    &#125;    public static void main(String[] args) &#123;        // è·å–ç±»ä¸Šçš„æ³¨è§£ CustomTargetType        CustomTargetType t = AnnotationTest.class.getAnnotation(CustomTargetType.class);        System.out.println(&quot;ç±»ä¸Šçš„æ³¨è§£å€¼ === &quot; + t.value());        CustomTargetMethod tm = null;        try &#123;            // æ ¹æ®åå°„è·å– AnnotationTest ç±»ä¸Šçš„ test æ–¹æ³•            Method method = AnnotationTest.class.getDeclaredMethod(&quot;test&quot;,String.class);            // è·å–æ–¹æ³•ä¸Šçš„æ³¨è§£ CustomTargetMethod            tm = method.getAnnotation(CustomTargetMethod.class);            System.out.println(&quot;æ–¹æ³•ä¸Šçš„æ³¨è§£å€¼ === &quot; + tm.value());            // è·å–æ–¹æ³•ä¸Šçš„æ‰€æœ‰å‚æ•°æ³¨è§£ï¼Œå¾ªç¯æ‰€æœ‰æ³¨è§£æ‰¾åˆ° CustomTargetParameter æ³¨è§£            Annotation[][] annotations = method.getParameterAnnotations();            for(Annotation[] tt : annotations)&#123;                for(Annotation t1:tt)&#123;                    if(t1 instanceof CustomTargetParameter)&#123;                        System.out.println(&quot;å‚æ•°ä¸Šçš„æ³¨è§£å€¼ === &quot;+((CustomTargetParameter) t1).value());                    &#125;                &#125;            &#125;            method.invoke(new AnnotationTest(), &quot;æ”¹å˜é»˜è®¤å‚æ•°&quot;);            // è·å– AnnotationTest ç±»ä¸Šå­—æ®µ mField çš„æ³¨è§£ CustomTargetField            CustomTargetField fieldAn = AnnotationTest.class.getDeclaredField(&quot;mField&quot;).getAnnotation(CustomTargetField.class);            System.out.println(&quot;å­—æ®µä¸Šçš„æ³¨è§£å€¼ === &quot; + fieldAn.value());        &#125; catch (Exception e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code class="java">ç±»ä¸Šçš„æ³¨è§£å€¼ === æˆ‘æ˜¯å®šä¹‰åœ¨ç±»ã€æ¥å£ã€æšä¸¾ç±»ä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼å‚æ•°ä¸Šçš„æ³¨è§£å€¼ === æˆ‘æ˜¯å®šä¹‰åœ¨å‚æ•°ä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼å‚æ•°å€¼ === æ”¹å˜é»˜è®¤å‚æ•°æ–¹æ³•ä¸Šçš„æ³¨è§£å€¼ === æµ‹è¯•æ–¹æ³•å­—æ®µä¸Šçš„æ³¨è§£å€¼ === æˆ‘æ˜¯å®šä¹‰åœ¨å­—æ®µä¸Šçš„æ³¨è§£å…ƒç´  value çš„é»˜è®¤å€¼</code></pre><p>å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è§‚å¯Ÿä¸Šæ–¹çš„æ —å­ï¼Œä¸éš¾çœ‹å‡ºï¼Œæ¯ä¸ªæ³¨è§£æœ‰ä¸‰ä¸ªè¦ç´ ï¼š</p><ul><li>æ³¨è§£å£°æ˜</li><li>ä½¿ç”¨æ³¨è§£çš„å…ƒç´ </li><li>æ“ä½œæ³¨è§£ä½¿å…¶ç”Ÿæ•ˆ - ç”±æ³¨è§£å¤„ç†å™¨æ¥å®Œæˆ</li></ul><p>æ³¨è§£å£°æ˜å’Œä½¿ç”¨æ³¨è§£çš„å…ƒç´ ä¸å¿…å¤šè¯´ï¼Œæˆ‘ä»¬è¯¦ç»†è®²è®²æ³¨è§£å¤„ç†å™¨æ˜¯å¦‚ä½•å¤„ç†æ³¨è§£çš„ã€‚</p><h2 id="æ³¨è§£å¤„ç†å™¨"><a href="#æ³¨è§£å¤„ç†å™¨" class="headerlink" title="æ³¨è§£å¤„ç†å™¨"></a>æ³¨è§£å¤„ç†å™¨</h2><p>::: tips ä»€ä¹ˆæ˜¯æ³¨è§£å¤„ç†å™¨ï¼Ÿ<br>æ³¨è§£å¤„ç†å™¨æ˜¯ï¼ˆAnnotation Processorï¼‰æ˜¯ javac çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥åœ¨<strong>ç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£</strong>ã€‚ä½ å¯ä»¥è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨å»å¤„ç†ä¸€äº›äº‹åŠ¡ã€‚ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨å®ƒ<strong>ä»¥ java ä»£ç </strong>æˆ–è€…<strong>ç¼–è¯‘è¿‡çš„å­—èŠ‚ç </strong>ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆæ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ java æ–‡ä»¶ï¼‰ã€‚è¿™äº›ç”Ÿæˆçš„ java æ–‡ä»¶ä¸èƒ½ä¿®æ”¹ï¼Œå¹¶ä¸”ä¼šåŒå…¶æ‰‹åŠ¨ç¼–å†™çš„ java ä»£ç ä¸€æ ·ä¼šè¢« javac ç¼–è¯‘ã€‚è¯´ç™½äº†å°±æ˜¯æŠŠæ ‡è®°äº†æ³¨è§£çš„ç±»ã€å˜é‡ç­‰ä½œä¸ºè¾“å…¥å†…å®¹ï¼Œç»è¿‡æ³¨è§£å¤„ç†å™¨å¤„ç†ï¼Œç”Ÿæˆæƒ³è¦ç”Ÿæˆçš„ java ä»£ç ã€‚<br>:::</p><h3 id="AbstractProcessor"><a href="#AbstractProcessor" class="headerlink" title="AbstractProcessor"></a>AbstractProcessor</h3><p>å¤„ç†å™¨çš„å†™æ³•æœ‰å›ºå®šçš„å¥—è·¯ï¼Œç»§æ‰¿AbstractProcessorã€‚å¦‚ä¸‹ï¼š</p><pre><code class="java">public abstract class AbstractProcessor implements Processor &#123;    // ä½¿ç”¨ processingEvn åˆå§‹åŒ–å¤„ç†å™¨    // å¦‚æœåŒä¸€ä¸ªå¯¹è±¡çš„è¯¥æ–¹æ³•è¢«è°ƒç”¨å¤šæ¬¡ï¼Œå°†ä¼šæŠ›å‡º IllegalStateException å¼‚å¸¸    public synchronized void init(ProcessingEnvironment processingEnv) &#123;        if (initialized)            throw new IllegalStateException(&quot;Cannot call init more than once.&quot;);        Objects.requireNonNull(processingEnv, &quot;Tool provided null ProcessingEnvironment&quot;);        this.processingEnv = processingEnv;        initialized = true;    &#125;    // å¦‚æœæ³¨è§£å¤„ç†å™¨ç±»è¢« @SupportedAnnotationTypes æ³¨è§£è¿‡ï¼Œåˆ™è¿”å›è¯¥æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„æ³¨è§£ç±»çš„åç§° Set    // å¦‚æœæ²¡æœ‰ï¼Œå°±è¿”å›ä¸€ä¸ªç©º Set    public Set&lt;String&gt; getSupportedAnnotationTypes() &#123;            SupportedAnnotationTypes sat = this.getClass().getAnnotation(SupportedAnnotationTypes.class);            if  (sat == null) &#123;                if (isInitialized())                    processingEnv.getMessager().printMessage(Diagnostic.Kind.WARNING,                                                             &quot;No SupportedAnnotationTypes annotation &quot; +                                                             &quot;found on &quot; + this.getClass().getName() +                                                             &quot;, returning an empty set.&quot;);                return Collections.emptySet();            &#125;            else                return arrayToSet(sat.value());        &#125;    // å¦‚æœæ³¨è§£å¤„ç†å™¨ç±»è¢« @SupportedSourceVersion æ³¨è§£è¿‡ï¼Œåˆ™è¿”å›è¯¥æ³¨è§£æ”¯æŒçš„æœ€å° source version    // å¦‚æœæ²¡æœ‰ï¼Œè¿”å› SourceVersion#RELEASE_6    public SourceVersion getSupportedSourceVersion() &#123;        SupportedSourceVersion ssv = this.getClass().getAnnotation(SupportedSourceVersion.class);        SourceVersion sv = null;        if (ssv == null) &#123;            sv = SourceVersion.RELEASE_6;            if (isInitialized())                processingEnv.getMessager().printMessage(Diagnostic.Kind.WARNING,                                                         &quot;No SupportedSourceVersion annotation &quot; +                                                         &quot;found on &quot; + this.getClass().getName() +                                                         &quot;, returning &quot; + sv + &quot;.&quot;);        &#125; else            sv = ssv.value();        return sv;    &#125;    // ä¸»è¦çš„å¤„ç†è¿‡ç¨‹ï¼Œé‡å†™è¿™ä¸ªæ–¹æ³•æ¥æ‰«æå¹¶å¤„ç†ä½ çš„æ³¨è§£ï¼Œç”Ÿæˆ java ä»£ç     public abstract boolean process(Set&lt;? extends TypeElement&gt; annotations,                                    RoundEnvironment roundEnv);&#125;</code></pre><p>æˆ‘ä»¬ä¼šåœ¨<a href="/butterknife/">è¿™ç¯‡æ–‡ç« </a>é‡Œè¯¦ç»†è§£é‡Šå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ã€‚</p><p>::: details åºŸå¼ƒ</p><h2 id="æ³¨è§£å¤„ç†å™¨-1"><a href="#æ³¨è§£å¤„ç†å™¨-1" class="headerlink" title="æ³¨è§£å¤„ç†å™¨"></a>æ³¨è§£å¤„ç†å™¨</h2><p>ä¸åŒçš„ç¨‹åºå…ƒç´ ï¼Œå…¶æ³¨è§£å¤„ç†å™¨çš„å¤„ç†æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å„ä¸ªåˆ†æã€‚</p><h3 id="Class-æ³¨è§£å¤„ç†å™¨"><a href="#Class-æ³¨è§£å¤„ç†å™¨" class="headerlink" title="Class æ³¨è§£å¤„ç†å™¨"></a>Class æ³¨è§£å¤„ç†å™¨</h3><p>æˆ‘ä»¬ä»<code>AnnotationTest.class.getAnnotation()</code>æ–¹æ³•å¼€å§‹å…¥æ‰‹ã€‚<strong>ä¸‹æ–¹ä»£ç åŸºäº jdk1.8</strong>ï¼š</p><pre><code class="java">// Class.java@SuppressWarnings(&quot;unchecked&quot;)public &lt;A extends Annotation&gt; A getAnnotation(Class&lt;A&gt; annotationClass) &#123;    Objects.requireNonNull(annotationClass);    return (A) annotationData().annotations.get(annotationClass);&#125;</code></pre><p>ç§ï¼Œè¿™ä¸ªæ–¹æ³•æœ¬èº«å±…ç„¶è¿˜ä½¿ç”¨äº†<code>@SuppressWarnings</code>æ³¨è§£å‘¢ã€‚</p><p>è¿™ä¸ªæ–¹æ³•æ˜¯å®ç°äº†<code>java.lang.reflect.AnnotatedElement</code>æ¥å£ä¸­çš„<code>getAnnotation()</code>æ–¹æ³•ï¼š</p><pre><code class="java">// java.lang.reflect.AnnotatedElement.java// å¦‚æœå…ƒç´ æœ‰æ³¨è§£çš„è¯ï¼Œè¿”å›å…ƒç´ çš„æ³¨è§£ï¼Œå¦åˆ™è¿”å› nullã€‚&lt;T extends Annotation&gt; T getAnnotation(Class&lt;T&gt; annotationClass);</code></pre><p><code>java.lang.reflect.AnnotatedElement</code>æ¥å£æ˜¯æ‰€æœ‰ç¨‹åºå…ƒç´ ï¼ˆClassã€Method å’Œ Constructorï¼‰çš„çˆ¶æ¥å£ï¼Œæ‰€ä»¥ç¨‹åºé€šè¿‡åå°„è·å–äº†æŸä¸ªç±»çš„ AnnotatedElement å¯¹è±¡ä¹‹åï¼Œç¨‹åºå°±å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„å¦‚ä¸‹ 4 ä¸ªæ–¹æ³•æ¥è®¿é—® Annotation ä¿¡æ¯ï¼š</p><ol><li><code>&lt;T extends Annotation&gt; T getAnnotation(Class&lt;T&gt; annotationClass)</code>: è¿”å›æ”¹ç¨‹åºå…ƒç´ ä¸Š<strong>å­˜åœ¨çš„ã€æŒ‡å®šç±»å‹çš„æ³¨è§£</strong>ï¼Œå¦‚æœè¯¥ç±»å‹æ³¨è§£ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› nullã€‚</li><li><code>Annotation[] getAnnotations()</code>:è¿”å›è¯¥ç¨‹åºå…ƒç´ ä¸Šå­˜åœ¨çš„<strong>æ‰€æœ‰æ³¨è§£</strong>ã€‚</li><li><code>Annotation[] getDeclaredAnnotations()</code>ï¼šè¿”å›ç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šçš„<strong>æ‰€æœ‰æ³¨è§£</strong>ã€‚ä¸ç¬¬2ä¸ªæ–¹æ³•ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œ<strong>è¯¥æ–¹æ³•å°†å¿½ç•¥ç»§æ‰¿çš„æ³¨è§£</strong>ï¼ˆå¦‚æœæ²¡æœ‰æ³¨è§£ç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šï¼Œåˆ™è¿”å›é•¿åº¦ä¸ºé›¶çš„ä¸€ä¸ªæ•°ç»„ï¼‰ã€‚</li><li><code>boolean is AnnotationPresent(Class&lt;?extends Annotation&gt; annotationClass)</code>:åˆ¤æ–­è¯¥ç¨‹åºå…ƒç´ ä¸Š<strong>æ˜¯å¦åŒ…å«æŒ‡å®šç±»å‹çš„æ³¨è§£</strong>ï¼Œå­˜åœ¨åˆ™è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ã€‚</li></ol><p>ç„¶åæ¥ç€åˆ†æä¸Šé¢çš„ä»£ç ï¼š</p><pre><code class="java">// Class.java// Annotations cache@SuppressWarnings(&quot;UnusedDeclaration&quot;)private volatile transient AnnotationData annotationData;private AnnotationData annotationData() &#123;    while (true) &#123; // é‡å¤è·å–ç›´åˆ°æˆåŠŸ        AnnotationData annotationData = this.annotationData;        int classRedefinedCount = this.classRedefinedCount;        // åˆ¤æ–­æ˜¯å¦ä¸ºæ—§æ³¨è§£        // å› ä¸º JVM è°ƒç”¨ RedefineClass() æ–¹æ³•æ—¶ï¼ŒannotationData çš„å€¼å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œ        // æ­¤æ—¶ï¼Œå¿…é¡»è¦åˆ·æ–°ä¸€æ¬¡ annotationData        if (annotationData != null &amp;&amp;            annotationData.redefinedCount == classRedefinedCount) &#123;            return annotationData;        &#125;        // ç©ºæ³¨è§£æˆ–æ—§æ³¨è§£ï¼Œå°±åˆ›å»ºæ–°çš„æ³¨è§£å®ä¾‹        AnnotationData newAnnotationData = createAnnotationData(classRedefinedCount);        // å°†æ–°å»ºçš„ annotationData å…³è”åˆ°è¿™ä¸ªç±»ä¸Š        // æœ€ç»ˆä¼šè°ƒç”¨åˆ° native å±‚çš„ compareAndSwapObject        if (Atomic.casAnnotationData(this, annotationData, newAnnotationData)) &#123;            return newAnnotationData;        &#125;    &#125;&#125;</code></pre><p>è¿™æ®µä»£ç æ—¨åœ¨å°†ç±»çš„æ³¨è§£å–å‡ºï¼Œå¹¶æ”¾åœ¨ä¸€ä¸ªç”¨ transient ä¿®é¥°çš„å˜é‡ä¸­ï¼Œç”¨äºç¼“å­˜ã€‚</p><p>ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼ŒannotationData ä¸º nullï¼Œåˆ™éœ€è¦æ–°å»º annotationData çš„å®ä¾‹ï¼Œå¹¶å…³è”åˆ°ç±»ä¸Šã€‚</p><p>AnnotationData ç±»çš„å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code class="java">// annotation data that might get invalidated when JVM TI RedefineClasses() is calledprivate static class AnnotationData &#123;    // ç”¨ä»¥å­˜å‚¨ annotations çš„ map    final Map&lt;Class&lt;? extends Annotation&gt;, Annotation&gt; annotations;    final Map&lt;Class&lt;? extends Annotation&gt;, Annotation&gt; declaredAnnotations;    // è®°å½•åˆ›å»ºäº†å‡ æ¬¡ annotationDataï¼Œç”¨äºä¸ Class.classRedefinedCount è¿›è¡Œå¯¹æ¯”ï¼Œ    // ä»¥å†³å®šæ˜¯å¦è¦åˆ·æ–° annotationData    final int redefinedCount;    AnnotationData(Map&lt;Class&lt;? extends Annotation&gt;, Annotation&gt; annotations,                    Map&lt;Class&lt;? extends Annotation&gt;, Annotation&gt; declaredAnnotations,                    int redefinedCount) &#123;        this.annotations = annotations;        this.declaredAnnotations = declaredAnnotations;        this.redefinedCount = redefinedCount;    &#125;&#125;</code></pre><p>æœ€åæ¥æ¢³ç†ä¸€ä¸‹æ•´ä¸ªåå°„æ³¨è§£çš„å·¥ä½œåŸç†ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡<strong>é”®å€¼å¯¹</strong>çš„å½¢å¼å¯ä»¥<strong>ä¸ºæ³¨è§£å±æ€§èµ‹å€¼</strong>ï¼Œåƒè¿™æ ·ï¼š@Helloï¼ˆvalue = â€œhelloâ€ï¼‰ã€‚</p><p>æ¥ç€ï¼Œä½ ç”¨æ³¨è§£ä¿®é¥°æŸä¸ªå…ƒç´ ï¼Œç¼–è¯‘å™¨å°†åœ¨ç¼–è¯‘æœŸæ‰«ææ¯ä¸ªç±»æˆ–è€…æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼Œä¼šåšä¸€ä¸ªåŸºæœ¬çš„æ£€æŸ¥ï¼Œä½ çš„è¿™ä¸ªæ³¨è§£æ˜¯å¦å…è®¸ä½œç”¨åœ¨å½“å‰ä½ç½®ï¼Œæœ€åä¼šå°†æ³¨è§£ä¿¡æ¯<strong>å†™å…¥å…ƒç´ çš„å±æ€§è¡¨</strong>ã€‚</p><p>ç„¶åï¼Œå½“ä½ è¿›è¡Œåå°„çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºå°†æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸåœ¨ RUNTIME çš„æ³¨è§£å–å‡ºæ¥æ”¾åˆ°ä¸€ä¸ª map ä¸­ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª AnnotationInvocationHandler å®ä¾‹ï¼ŒæŠŠè¿™ä¸ª map ä¼ é€’ç»™å®ƒã€‚</p><p>æœ€åï¼Œè™šæ‹Ÿæœºå°†é‡‡ç”¨ JDK åŠ¨æ€ä»£ç†æœºåˆ¶ç”Ÿæˆä¸€ä¸ªç›®æ ‡æ³¨è§£çš„ä»£ç†ç±»ï¼Œå¹¶åˆå§‹åŒ–å¥½å¤„ç†å™¨ã€‚<br>:::</p><p>æˆ‘ä¹Ÿå†™äº†ä¸€ç¯‡å•ç‹¬çš„æ–‡ç«  - ã€Š<a href="2020-04-10-about-retrofit">Retrofit å®ç°åŸç†è§£æ</a>ã€‹ï¼Œæ¥ä½œä¸ºæ³¨è§£ä½¿ç”¨çš„æœ€ä½³è§£æã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ³¨è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºå‡ ç§å¸¸è§çš„ç¼“å­˜ç®—æ³•</title>
      <link href="/2020-01-07/cache-algorithms/"/>
      <url>/2020-01-07/cache-algorithms/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰å¸¸è§çš„å‡ ç§ç¼“å­˜ç®—æ³•åŒ…æ‹¬ä½†ä¸é™äº <a href="#fifo-%E7%AE%97%E6%B3%95">FIFO</a>ã€<a href="#lru-%E7%AE%97%E6%B3%95">LRU</a>ã€<a href="#lfu-%E7%AE%97%E6%B3%95">LFU</a>ã€<a href="#mru-%E7%AE%97%E6%B3%95">MRU</a>ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€ä¸€ä»‹ç»å¹¶æ·±å…¥ä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="FIFO-ç®—æ³•"><a href="#FIFO-ç®—æ³•" class="headerlink" title="FIFO ç®—æ³•"></a>FIFO ç®—æ³•</h2><p>FIFOï¼ˆFirst In First Outï¼‰æ˜¯æ¯”è¾ƒå¸¸è§çš„ç®—æ³•äº†ï¼Œé˜Ÿåˆ—ï¼ˆQueueï¼‰å°±æ˜¯å®ç°äº†è¿™ç§ç®—æ³•çš„æœ€å¥½ä¾‹å­ã€‚è¿™æ˜¯æœ€ç®€å•ã€æœ€å…¬å¹³çš„ä¸€ç§ç®—æ³•æ€æƒ³ï¼Œå®ƒè®¤ä¸º<strong>å¦‚æœä¸€ä¸ªæ•°æ®æ˜¯æœ€å…ˆè¿›å…¥çš„ï¼Œé‚£ä¹ˆåœ¨å°†æ¥å®ƒè¢«è®¿é—®çš„å¯èƒ½æ€§æ˜¯æœ€å°çš„ã€‚ç©ºé—´æ»¡çš„æ—¶å€™ï¼Œæœ€å…ˆè¿›å…¥çš„æ•°æ®ä¼šè¢«æ·˜æ±°æ‰</strong>ã€‚</p><p>ä¸‹å›¾å±•ç¤º FIFO ç®—æ³•åœ¨è®¿é—®é¡ºåºæ˜¯ Aã€Bã€Cã€Dã€Eã€Dã€F çš„æƒ…å†µä¸‹ï¼Œç¼“å­˜åˆ—è¡¨çš„æ›´æ–°æƒ…å†µï¼ˆé“¾è¡¨å¤§å°å‡å®šä¸º4ï¼‰ï¼š</p><div class="center-img"><p><img src="/img/cache-1588212789.png"></p><p><em>ç™½è‰²ä»£è¡¨æ— æ•°æ®ï¼Œç°è‰²ä»£è¡¨æœªæ›´æ–°æ•°æ®ï¼Œç»¿è‰²ä»£è¡¨è¢«æ›´æ–°æ•°æ®</em></p></div><p>FIFO çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºå°†å„æ•°æ®é“¾æ¥èµ·æ¥ç»„æˆé˜Ÿåˆ—ï¼Œå¹¶å°†ç½®æ¢æŒ‡é’ˆæŒ‡å‘é˜Ÿåˆ—çš„é˜Ÿé¦–ã€‚å†è¿›è¡Œç½®æ¢æ—¶ï¼Œåªéœ€æŠŠç½®æ¢æŒ‡é’ˆæ‰€æŒ‡çš„æ•°æ®ï¼ˆé¡µé¢ï¼‰é¡ºæ¬¡æ¢å‡ºï¼Œå¹¶æŠŠæ–°åŠ å…¥çš„æ•°æ®æ’åˆ°é˜Ÿå°¾å³å¯ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•</p><p><strong>ç¼ºç‚¹</strong>ï¼šåˆ¤æ–­ä¸€ä¸ªç¼“å­˜ç®—æ³•ä¼˜åŠ£çš„æŒ‡æ ‡å°±æ˜¯å‘½ä¸­ç‡ï¼Œè€Œ FIFO ç®—æ³•çš„ä¸€ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹æ˜¯ï¼Œåœ¨æŸäº›ç‰¹å®šçš„æ—¶åˆ»ï¼Œå‘½ä¸­ç‡åè€Œä¼šéšç€ç¼“å­˜é‡çš„å¢åŠ è€Œå‡å°‘ï¼Œè¿™ç§°ä¸º <strong>Belady ç°è±¡</strong>ã€‚äº§ç”Ÿ Belady ç°è±¡çš„åŸå› æ˜¯ï¼ŒFIFO ç½®æ¢ç®—æ³•<strong>ä¸è¿›ç¨‹è®¿é—®å†…å­˜çš„åŠ¨æ€ç‰¹å¾æ˜¯ä¸ç›¸å®¹çš„</strong>ï¼Œè¢«ç½®æ¢çš„æ•°æ®å¾€å¾€æ˜¯è¢«é¢‘ç¹è®¿é—®çš„ï¼Œæˆ–è€…æ²¡æœ‰ç»™è¿›ç¨‹åˆ†é…è¶³å¤Ÿçš„ç¼“å­˜ç©ºé—´ï¼Œå› æ­¤ FIFO ç®—æ³•ä¼šä½¿ä¸€äº›æ•°æ®<strong>é¢‘ç¹åœ°è¢«æ›¿æ¢å’Œé‡æ–°ç”³è¯·å†…å­˜</strong>ï¼Œä»è€Œå¯¼è‡´å‘½ä¸­ç‡é™ä½ã€‚å› æ­¤ï¼Œç°åœ¨å‡ ä¹ä¸å†ä½¿ç”¨ FIFO ç®—æ³•ã€‚</p><h2 id="LRU-ç®—æ³•"><a href="#LRU-ç®—æ³•" class="headerlink" title="LRU ç®—æ³•"></a>LRU ç®—æ³•</h2><h3 id="LRU"><a href="#LRU" class="headerlink" title="LRU"></a>LRU</h3><p>LRUï¼ˆLeast recently usedï¼‰ç®—æ³•ä¼šæ ¹æ®æ•°æ®çš„<strong>å†å²è®¿é—®è®°å½•</strong>æ¥è¿›è¡Œæ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ã€<strong>å¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜</strong>ã€ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†è®¿é—®é¡ºåºæ˜¯ Aã€Bã€Cã€Dã€Eã€Dã€F æƒ…å†µä¸‹ï¼Œç¼“å­˜åˆ—è¡¨çš„æ›´æ–°æƒ…å†µï¼š</p><div class="center-img"><p><img src="/img/cache-1588220432.png"></p><p><em>ç™½è‰²ä»£è¡¨æ— æ•°æ®ï¼Œç°è‰²ä»£è¡¨æœªæ›´æ–°æ•°æ®ï¼Œç»¿è‰²ä»£è¡¨è¢«æ›´æ–°æ•°æ®</em></p></div><p>ç”±ä¸Šå›¾å¯ä»¥æ€»ç»“ä¸€ä¸‹ LRU ç®—æ³•çš„å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>æ–°æ¥çš„æ•°æ®ä¼šæ’å…¥é“¾è¡¨çš„å¤´éƒ¨</li><li>å¦‚æœé“¾è¡¨å·²æ»¡ï¼ˆè¾¾åˆ°æœ€å¤§é•¿åº¦ï¼‰ï¼Œåˆ™ä¼šä¸¢å¼ƒæ‰é“¾è¡¨å°¾éƒ¨çš„æ•°æ®</li><li>å¦‚æœè®¿é—®æ—¶å‘½ä¸­ï¼Œåˆ™è¦ç§»åŠ¨æ•°æ®çš„ä½ç½®<sup><a href="#%E6%B3%A81">æ³¨1</a></sup></li></ol><p>LRU çš„å®ç°ä¸€èˆ¬æ˜¯ä½¿ç”¨ LinkedHashMapï¼Œå³åŒ…å«äº†ç”¨æ¥è¡¨ç¤ºã€ä½ç½®ã€çš„åŒå‘é“¾è¡¨ï¼Œä¹ŸåŒ…å«ç”¨æ¥ã€å­˜å‚¨å’Œè·å–ã€çš„ HashMapã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°èµ·æ¥ç›¸å¯¹ç®€å•ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šå½“å­˜åœ¨çƒ­ç‚¹æ•°æ®æ—¶ï¼ŒLRU çš„æ•ˆç‡å¾ˆå¥½ï¼›ä½†å¶å‘æ€§çš„ã€å‘¨æœŸæ€§çš„æ‰¹é‡æ“ä½œä¼šå¯¼è‡´ LRU å‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç¼“å­˜æ±¡æŸ“æƒ…å†µæ¯”è¾ƒä¸¥é‡ã€‚</p><p>æˆ‘ä»¬æ¥å†™ä¸ªä»£ç ç®€å•å®ç°ä¸€ä¸‹ LRU ç®—æ³•ï¼š</p><pre><code class="java">import java.util.LinkedHashMap;import java.util.Map;import java.util.logging.Level;import java.util.logging.Logger;public class LruCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; &#123;    private int cacheSize;    public LruCache(int cacheSize) &#123;        // ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šåˆå§‹å¤§å°ã€è´Ÿè½½å› å­ã€æ˜¯å¦å¼€å¯è®¿é—®é¡ºåºï¼ˆaccessOrderï¼‰        // å¼€å¯è®¿é—®é¡ºåºåï¼Œè¢«å‘½ä¸­çš„æ•°æ®ä¼šç§»åŠ¨åˆ°é“¾è¡¨çš„å¤´éƒ¨        super(16, (float) 0.75, true);        this.cacheSize = cacheSize;    &#125;    // å¤å†™è¯¥æ–¹æ³•ï¼Œæ¥å†³å®šæ˜¯å¦è¦ç§»é™¤æœ€æ—§çš„æ•°æ®ï¼Œè¯¥æ–¹æ³•åœ¨ LinkedHashMap ä¸­é»˜è®¤è¿”å› false    protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) &#123;        return size() &gt; cacheSize;    &#125;    public void print()    &#123;        Iterator&lt;K&gt; itr = this.keySet().iterator();        while (itr.hasNext()) &#123;            System.out.print(itr.next() + &quot; &quot;);        &#125;        System.out.println();    &#125;    public static void main(String[] args) &#123;        LruCache&lt;String, Integer&gt; lruCache = new LruCache&lt;String, Integer&gt;(4);        for(int i = 0; i &lt; 10; i++) &#123;            lruCache.put(&quot;K&quot; + i, i);        &#125;        lruCache.print();        lruCache.put(&quot;K10&quot;, 10);        lruCache.print();        lruCache.get(&quot;K7&quot;);        lruCache.print();    &#125;&#125;</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code>K6 K7 K8 K9K7 K8 K9 K10K8 K9 K10 K7</code></pre><p>å¾ˆæ˜æ˜¾è¿™ä¸ªå®ç°ç±»æ˜¯<span style="color: red; font-weight: bold;">çº¿ç¨‹ä¸å®‰å…¨</span>çš„ï¼Œå› ä¸º LinkedHashMap æœ¬èº«å°±æ˜¯<span style="color: red; font-weight: bold;">çº¿ç¨‹ä¸å®‰å…¨</span>çš„ã€‚</p><h3 id="LRU-K"><a href="#LRU-K" class="headerlink" title="LRU-K"></a>LRU-K</h3><p>LRU-K ä¸­çš„ K ä»£è¡¨<strong>æœ€è¿‘ä½¿ç”¨çš„æ¬¡æ•°</strong>ï¼Œæ‰€ä»¥ï¼ŒLRU å¯ä»¥è¢«è®¤ä¸ºæ˜¯ LRU-1ã€‚LRU-K çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³ LRU ç®—æ³•ã€ç¼“å­˜æ±¡æŸ“ã€çš„é—®é¢˜ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†ã€<strong>æœ€è¿‘ä½¿ç”¨è¿‡1æ¬¡</strong>ã€çš„åˆ¤æ–­æ ‡å‡†æ‰©å±•ä¸ºã€<strong>æœ€è¿‘ä½¿ç”¨è¿‡Kæ¬¡</strong>ã€ã€‚</p><p>äºæ˜¯ï¼Œç›¸æ¯” LRUï¼ŒLRU-K éœ€è¦å¤šç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨äºè®°å½•æ‰€æœ‰ç¼“å­˜æ•°æ®è¢«è®¿é—®çš„å†å²ã€‚åªæœ‰å½“æ•°æ®çš„è®¿é—®æ¬¡æ•°è¾¾åˆ° K æ¬¡çš„æ—¶å€™ï¼Œæ‰å°†æ•°æ®æ”¾å…¥ç¼“å­˜ã€‚å½“éœ€è¦æ·˜æ±°æ•°æ®æ—¶ï¼ŒLRU-K ä¼šæ·˜æ±°<strong>ç¬¬ K æ¬¡è®¿é—®æ—¶é—´è·å½“å‰æ—¶é—´æœ€å¤§çš„æ•°æ®</strong>ã€‚</p><h3 id="Android-ä¸­çš„-LruCache"><a href="#Android-ä¸­çš„-LruCache" class="headerlink" title="Android ä¸­çš„ LruCache"></a>Android ä¸­çš„ LruCache</h3><p>Android ä¸­çš„ LruCache å®ç°ä¸ä¸Šé¢ç›´æ¥ä½¿ç”¨ LinkedHashMap çš„ç‰¹æ€§ä¸ä¸€æ ·ï¼Œå®ƒè‡ªå®šä¹‰äº†æ•°æ®æ’å…¥çš„ä½ç½®ã€è·å–çš„ç­–ç•¥å’Œä¸¢å¼ƒçš„ç­–ç•¥ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œåœ¨æ³¨é‡Šä¸­è¿›è¡Œè¯¦è§£ï¼š</p><pre><code class="java">// android.util.LruCache.javapackage android.util;import java.util.LinkedHashMap;import java.util.Map;/** * è¿™æ˜¯ä¸€ä¸ªç¼“å­˜ï¼Œé‡Œé¢çš„æ•°æ®éƒ½æ˜¯å¼ºå¼•ç”¨ï¼ŒåŒ…å«æœ‰é™æ•°é‡çš„æ•°æ®ã€‚ * æ¯æ¬¡å½“æŸä¸ªæ•°æ®è¢«è®¿é—®ï¼Œå®ƒä¼šè¢«ç§»åŠ¨åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚å½“ç¼“å­˜å·²æ»¡ï¼Œæ–°æ•°æ®æ¥ä¸´æ—¶ï¼Œé˜Ÿåˆ—å°¾éƒ¨çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒï¼ŒGC å°±å¯ä»¥å›æ”¶å®ƒäº†ã€‚ *  * å¦‚æœä½ ç¼“å­˜çš„æ•°æ®éœ€è¦è¢«æ˜¾å¼åœ°é‡Šæ”¾æ‰ï¼Œé‚£å°±é‡å†™ entryRemoved æ–¹æ³•ã€‚ * * å¦‚æœç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œéœ€è¦è®¡ç®—å¹¶è·å–å¯¹åº”çš„keyï¼Œé‡å†™ create æ–¹æ³•ã€‚ *  * é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„å¤§å°ä»¥ Entry çš„ä¸ªæ•°ç•Œå†³çš„ï¼Œä½ å¯ä»¥é‡å†™ sizeOf æ–¹æ³•ç”¨ä¸åŒçš„å•ä½æ¥å†³å®šç¼“å­˜ç©ºé—´çš„å¤§å°ã€‚ * æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸ªç¼“å­˜çš„ä¸Šé™æ˜¯ 4MB çš„ bitmapï¼š * * int cacheSize = 4 * 1024 * 1024; // 4MiB * LruCache&lt;String, Bitmap&gt; bitmapCache = new LruCache&lt;String, Bitmap&gt;(cacheSize) &#123; *     protected int sizeOf(String key, Bitmap value) &#123; *         return value.getByteCount(); *     &#125; * &#125; * * è¿™ä¸ª LruCache ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥å®‰å…¨åœ°æ’å…¥å’Œè·å–æ•°æ®ï¼š * * synchronized (cache) &#123; *   if (cache.get(key) == null) &#123; *       cache.put(key, value); *   &#125; * &#125; * * è¯¥ç±»ä¸å…è®¸ null key æˆ–è€… null valueã€‚å½“ getã€putã€remove æ–¹æ³•è¿”å› null æ—¶ï¼Œå®ƒçš„æ„æ€å¾ˆæ˜ç¡®ï¼škey ä¸åœ¨ç¼“å­˜ä¸­ */public class LruCache&lt;K, V&gt; &#123;    private final LinkedHashMap&lt;K, V&gt; map;    private int size;    private int maxSize;    // æ’å…¥æ¬¡æ•°    private int putCount;    // æ–°å»ºæ¬¡æ•°    private int createCount;    // ä¸¢å¼ƒæ¬¡æ•°    private int evictionCount;    // å‘½ä¸­æ¬¡æ•°    private int hitCount;    // æœªå‘½ä¸­æ¬¡æ•°    private int missCount;    // maxSize å°±æ˜¯æ²¡æœ‰é‡å†™ sizeOf æ–¹æ³•çš„ç¼“å­˜å¤§å°ï¼Œä¹Ÿå³ Entry çš„æ¡ç›®æ•°é‡    public LruCache(int maxSize) &#123;        if (maxSize &lt;= 0) &#123;            throw new IllegalArgumentException(&quot;maxSize &lt;= 0&quot;);        &#125;        this.maxSize = maxSize;        this.map = new LinkedHashMap&lt;K, V&gt;(0, 0.75f, true);    &#125;    public void resize(int maxSize) &#123;        if (maxSize &lt;= 0) &#123;            throw new IllegalArgumentException(&quot;maxSize &lt;= 0&quot;);        &#125;        synchronized (this) &#123;            this.maxSize = maxSize;        &#125;        trimToSize(maxSize);    &#125;    public final V get(K key) &#123;        if (key == null) &#123;            throw new NullPointerException(&quot;key == null&quot;);        &#125;        V mapValue;        synchronized (this) &#123;            mapValue = map.get(key);            if (mapValue != null) &#123;                hitCount++;                return mapValue;            &#125;            missCount++;        &#125;        // å°è¯•æ ¹æ® key åˆ›å»ºä¸€ä¸ª valueã€‚        // å› ä¸ºè¿™æ®µä»£ç ä¸æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥åœ¨ create æ–¹æ³•ç»“æŸçš„æ—¶å€™ï¼Œmap çš„å†…å®¹å¯èƒ½å·²ç»å˜åŒ–äº†ã€‚        // å¦‚æœ create æ–¹æ³•è¿”å›çš„å€¼ä¸ map ä¸­çš„å€¼å†²çªï¼Œæˆ‘ä»¬å°±é‡Šæ”¾ create çš„å€¼ï¼Œå¹¶ä¿ç•™ map ä¸­çš„å€¼ã€‚        // ç›®å‰ create æ€»æ˜¯è¿”å› nullã€‚        V createdValue = create(key);        if (createdValue == null) &#123;            return null;        &#125;        synchronized (this) &#123;            createCount++;            mapValue = map.put(key, createdValue);            if (mapValue != null) &#123;                // There was a conflict so undo that last put                map.put(key, mapValue);            &#125; else &#123;                size += safeSizeOf(key, createdValue);            &#125;        &#125;        if (mapValue != null) &#123;            entryRemoved(false, key, createdValue, mapValue);            return mapValue;        &#125; else &#123;            trimToSize(maxSize);            return createdValue;        &#125;    &#125;    // value ä¼šè¢«æ”¾åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨    public final V put(K key, V value) &#123;        if (key == null || value == null) &#123;            throw new NullPointerException(&quot;key == null || value == null&quot;);        &#125;        V previous;        synchronized (this) &#123;            putCount++;            size += safeSizeOf(key, value);            previous = map.put(key, value);            if (previous != null) &#123;                size -= safeSizeOf(key, previous);            &#125;        &#125;        if (previous != null) &#123;            entryRemoved(false, key, previous, value);        &#125;        trimToSize(maxSize);        return previous;    &#125;    private void trimToSize(int maxSize) &#123;        while (true) &#123;            K key;            V value;            synchronized (this) &#123;                if (size &lt; 0 || (map.isEmpty() &amp;&amp; size != 0)) &#123;                    throw new IllegalStateException(getClass().getName()                            + &quot;.sizeOf() is reporting inconsistent results!&quot;);                &#125;                if (size &lt;= maxSize) &#123;                    break;                &#125;                // BEGIN LAYOUTLIB CHANGE                // get the last item in the linked list.                // This is not efficient, the goal here is to minimize the changes                // compared to the platform version.                Map.Entry&lt;K, V&gt; toEvict = null;                for (Map.Entry&lt;K, V&gt; entry : map.entrySet()) &#123;                    toEvict = entry;                &#125;                // END LAYOUTLIB CHANGE                if (toEvict == null) &#123;                    break;                &#125;                key = toEvict.getKey();                value = toEvict.getValue();                map.remove(key);                size -= safeSizeOf(key, value);                evictionCount++;            &#125;            entryRemoved(true, key, value, null);        &#125;    &#125;    public final V remove(K key) &#123;        if (key == null) &#123;            throw new NullPointerException(&quot;key == null&quot;);        &#125;        V previous;        synchronized (this) &#123;            previous = map.remove(key);            if (previous != null) &#123;                size -= safeSizeOf(key, previous);            &#125;        &#125;        if (previous != null) &#123;            entryRemoved(false, key, previous, null);        &#125;        return previous;    &#125;    // è¿™ä¸ªæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„    // å½“æœ‰ Entry è¢«ä¸¢å¼ƒæˆ–åˆ é™¤æ—¶è°ƒç”¨ã€‚    protected void entryRemoved(boolean evicted, K key, V oldValue, V newValue) &#123;&#125;    // è¿™ä¸ªæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„    protected V create(K key) &#123;        return null;    &#125;    ...    private int safeSizeOf(K key, V value) &#123;        int result = sizeOf(key, value);        if (result &lt; 0) &#123;            throw new IllegalStateException(&quot;Negative size: &quot; + key + &quot;=&quot; + value);        &#125;        return result;    &#125;    ...&#125;</code></pre><p>å¯è§ï¼ŒAndroid å¯¹ LruCache æœ‰äº†è‡ªå·±çš„å®ç°ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå®ƒæ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼Œä½†æ˜¯æ•ˆç‡ä¼šç›¸å¯¹ä½ä¸€äº›ï¼Œä¸è¿‡ç¼“å­˜çš„ä½¿ç”¨æ¦‚ç‡æœ¬èº«ç›¸å¯¹è¾ƒä½ï¼Œæ‰€ä»¥ç¨ä½çš„æ•ˆç‡ä¹Ÿæ˜¯å¯ä»¥å¿å—çš„ã€‚</p><h2 id="LFU-ç®—æ³•"><a href="#LFU-ç®—æ³•" class="headerlink" title="LFU ç®—æ³•"></a>LFU ç®—æ³•</h2><p>LFUï¼ˆLeast Frequently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ç¼“å­˜ç®—æ³•ã€‚å®ƒè®¤ä¸º<strong>å¦‚æœä¸€ä¸ªæ•°æ®åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´å¾ˆå°‘è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºåœ¨å°†æ¥å®ƒè¢«è®¿é—®çš„å¯èƒ½æ€§ä¹Ÿå¾ˆå°ã€‚å› æ­¤ï¼Œå½“ç©ºé—´æ»¡æ—¶ï¼Œæœ€å°é¢‘ç‡è®¿é—®çš„æ•°æ®æœ€å…ˆè¢«æ·˜æ±°</strong>ã€‚</p><p>åœ¨å®ç°æ—¶ï¼Œè€ƒè™‘åˆ° LFU ä¼šæ·˜æ±°è®¿é—®é¢‘ç‡æœ€å°çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§åˆé€‚çš„æ–¹æ³•<strong>æŒ‰å¤§å°é¡ºåº</strong>ç»´æŠ¤æ•°æ®è®¿é—®çš„é¢‘ç‡ã€‚LFU ç®—æ³•æœ¬è´¨ä¸Šå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ª top K é—®é¢˜(K = 1)ï¼Œå³é€‰å‡ºé¢‘ç‡æœ€å°çš„å…ƒç´ ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°å¯ä»¥ç”¨<strong>äºŒé¡¹å †</strong>æ¥é€‰æ‹©é¢‘ç‡æœ€å°çš„å…ƒç´ ï¼Œè¿™æ ·çš„å®ç°æ¯”è¾ƒé«˜æ•ˆã€‚æœ€ç»ˆå®ç°ç­–ç•¥ä¸ºå°é¡¶å †+å“ˆå¸Œè¡¨ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šæœ€æ–°åŠ å…¥çš„æ•°æ®å¸¸å¸¸ä¼šè¢«è¸¢é™¤ï¼Œå› ä¸ºå…¶èµ·å§‹æ–¹æ³•æ¬¡æ•°å°‘ã€‚</p><h2 id="MRU-ç®—æ³•"><a href="#MRU-ç®—æ³•" class="headerlink" title="MRU ç®—æ³•"></a>MRU ç®—æ³•</h2><p>MRUï¼ˆMost Recently Usedï¼Œæœ€è¿‘æœ€å¸¸ä½¿ç”¨ï¼‰ç®—æ³•çš„æ€æƒ³ä¸ LRU ç®—æ³•æ­£å¥½ç›¸åï¼Œå®ƒè®¤ä¸º<strong>å¦‚æœä¸€ä¸ªæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå®ƒæ¥ä¸‹æ¥è¢«è®¿é—®çš„æ¦‚ç‡å°±ä¼šæ›´ä½</strong>ã€‚</p><h2 id="é™„æ³¨"><a href="#é™„æ³¨" class="headerlink" title="é™„æ³¨"></a>é™„æ³¨</h2><h3 id="æ³¨1"><a href="#æ³¨1" class="headerlink" title="æ³¨1"></a>æ³¨1</h3><p>åœ¨ç§»åŠ¨æ•°æ®çš„ä½ç½®æ—¶ï¼Œåœ¨ java1.7ï¼ˆå«ï¼‰ä¹‹å‰é‡‡ç”¨çš„æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œæ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°<strong>é“¾è¡¨çš„å¤´éƒ¨</strong>ã€‚è€Œåœ¨ java1.8 ä¹‹åï¼Œé‡‡ç”¨äº†<strong>å°¾æ’æ³•</strong>ï¼Œæ‰€ä»¥ç§»åŠ¨æ•°æ®çš„è¯ï¼Œå°±ä¼šè¢«ç§»åŠ¨åˆ°<strong>é“¾è¡¨çš„å°¾éƒ¨</strong>ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹ä»£ç æ˜¯å¦‚ä½•å†™çš„ï¼š</p><pre><code class="java">// LinkedHashMap java1.7public class LinkedHashMap&lt;K,V&gt;    extends HashMap&lt;K,V&gt;    implements Map&lt;K,V&gt; &#123;        private transient Entry&lt;K,V&gt; header;    ...    public V get(Object key) &#123;        Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key);        if (e == null)            return null;        e.recordAccess(this);        return e.value;    &#125;    ...    private static class Entry&lt;K,V&gt; extends HashMap.Entry&lt;K,V&gt; &#123;        Entry&lt;K,V&gt; before, after;        ...        private void addBefore(Entry&lt;K,V&gt; existingEntry) &#123;            after  = existingEntry;            before = existingEntry.before;            before.after = this;            after.before = this;        &#125;        void recordAccess(HashMap&lt;K,V&gt; m) &#123;            LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m;            if (lm.accessOrder) &#123;                lm.modCount++;                remove();                // è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œå°†è¢«è®¿é—®çš„ Entry é‡æ–°æ”¾ç½®åœ¨äº† header çš„å‰é¢ï¼Œä¹Ÿå³æˆä¸ºäº†æ–°çš„é“¾è¡¨å¤´                addBefore(lm.header);            &#125;        &#125;    &#125;    ...&#125;</code></pre><pre><code class="java">// LinkedHashMap java1.8public class LinkedHashMap&lt;K,V&gt;    extends HashMap&lt;K,V&gt;    implements Map&lt;K,V&gt; &#123;    ...    /**     * The head (eldest) of the doubly linked list.     */    transient LinkedHashMap.Entry&lt;K,V&gt; head;    // è¡¨å¤´ï¼Œæœ€è€çš„æ•°æ®    /**     * The tail (youngest) of the doubly linked list.     */    transient LinkedHashMap.Entry&lt;K,V&gt; tail;    // è¡¨å°¾ï¼Œæœ€æ–°çš„æ•°æ®    ...    public V get(Object key) &#123;        Node&lt;K,V&gt; e;        if ((e = getNode(hash(key), key)) == null)            return null;        if (accessOrder)            afterNodeAccess(e);        return e.value;    &#125;    void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last        LinkedHashMap.Entry&lt;K,V&gt; last;        if (accessOrder &amp;&amp; (last = tail) != e) &#123;            LinkedHashMap.Entry&lt;K,V&gt; p =                (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;            p.after = null;            if (b == null)                head = a;            else                b.after = a;            if (a != null)                a.before = b;            else                last = b;            if (last == null)                head = p;            else &#123;                p.before = last;                last.after = p;            &#125;            tail = p;            ++modCount;        &#125;    &#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> ç”Ÿæ´»æŠ€èƒ½ </tag>
            
            <tag> ç¼“å­˜ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMap è§£æ</title>
      <link href="/2020-01-05/hashmap/"/>
      <url>/2020-01-05/hashmap/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Java å’Œ Android çš„å¼€å‘ä¸­ï¼Œæˆ‘ç›¸ä¿¡æ²¡æœ‰äººæ²¡ç”¨è¿‡ HashMap äº†å§ã€‚è¿™å‡ ä¹æ˜¯ Java ä¸­æœ€é‡è¦çš„ç±»ä¹‹ä¸€ï¼Œä½œä¸º Key-Value å­˜å‚¨ç±»å‹çš„å…¸èŒƒï¼Œæˆ‘ä»¬åœ¨å­¦ä¼šä½¿ç”¨çš„åŒæ—¶ï¼Œä¹Ÿå¿…é¡»è¦æ˜ç™½ HashMap å†…éƒ¨çš„å®ç°åŸç†ï¼ŒåŒæ—¶ä¹Ÿå¿…é¡»çŸ¥é“å®ƒçš„ä¸€äº›è¡ç”Ÿç±»ï¼Œä»¥åŠå®ƒä»¬çš„ç”¨æ³•ã€‚</p><span id="more"></span><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>è¯ä¸å¤šè¯´ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹ HashMap åœ¨å®˜æ–¹æ–‡æ¡£é‡Œçš„å®šä¹‰ï¼š</p><blockquote><p>HashMap æ˜¯ Map æ¥å£åŸºäºå“ˆå¸Œè¡¨çš„å®ç°ã€‚è¿™ä¸ªå®ç°æä¾›äº†æ‰€æœ‰å¯ç”¨çš„å¯¹ map çš„æ“ä½œï¼Œè€Œä¸”è¿˜å…è®¸æ’å…¥ null å€¼å’Œ null é”®ã€‚</p><p>HashMap ä¸ Hashtable ç±»å·®ä¸å¤šï¼Œä½† HashMap æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”å…è®¸ null å€¼/é”®ã€‚è¿™ä¸ªç±»æ— æ³•ä¿è¯ map å†…å…ƒç´ çš„é¡ºåºï¼›æ›´ç‰¹åˆ«çš„æ˜¯ï¼Œå®ƒä¹Ÿæ— æ³•ä¿è¯èƒ½ä¸€ç›´æŒ‰ç…§æŸä¸ªé¡ºåºæ’åˆ—ã€‚</p></blockquote><p>Map æ¥å£æœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„å…·ä½“å®ç°ç±»ï¼š<strong>HashMap</strong>ã€<strong>WeakHashMap</strong> å’Œ <strong>TreeMap</strong>ã€‚HashMap è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å­ç±» <strong>LinkedHashMap</strong>ï¼Œå®ƒä»¬å‡ ä¸ªéƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ç±»ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€å¼ å›¾ç®€å•äº†è§£ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š</p><div align="center"><p><img src="/img/56.png"></p></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆšæ‰å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°çš„ Hashtableï¼Œä¹Ÿæ˜¯ Map çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒçš„å®˜æ–¹æè¿°ä¸­æœ‰è¿™ä¹ˆä¸€æ®µï¼š</p><blockquote><p>ä¸åƒ collection çš„å®ç°é‚£æ ·ï¼ŒHashtable æ˜¯åŒæ­¥çš„ã€‚å¦‚æœä¸è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œé‚£ä½ å¯ä»¥ä½¿ç”¨ HashMap æ¥æ›¿ä»£ Hashtableï¼›å¦‚æœä½ å¯¹çº¿ç¨‹å®‰å…¨è¦æ±‚éå¸¸é«˜ï¼Œé‚£æ¨èä½ ä½¿ç”¨ java.util.concurrent.ConcurrentHashMap æ¥æ›¿ä»£ Hashtableã€‚</p></blockquote><p>åé¢æˆ‘ä»¬ä¼šè®¨è®º <a href="#hashtable">Hashtable</a> å’Œ <a href="#concurrenthashmap">ConcurrentHashMap</a>ã€‚</p><h2 id="HashMap-çš„æ•°æ®ç»“æ„"><a href="#HashMap-çš„æ•°æ®ç»“æ„" class="headerlink" title="HashMap çš„æ•°æ®ç»“æ„"></a>HashMap çš„æ•°æ®ç»“æ„</h2><p>HashMap çš„æ•°æ®ç»“æ„æ˜¯æˆ‘ä»¬éå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç”±<strong>æ•°ç»„å’Œé“¾è¡¨ç»„åˆæ„æˆ</strong>çš„æ•°æ®ç»“æ„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div align="center"><p><img src="/img/57.png"></p></div><p>æ•°ç»„çš„æ¯ä¸ªä½ç½®éƒ½å­˜å‚¨äº†ä¸€ä¸ªkey-valueè¿™æ ·çš„å®ä¾‹ï¼Œåœ¨ Java 7 ä¸­å«Entryï¼Œåœ¨ Java 8 ä¸­å«Nodeã€‚è¿™ä¸ªæ•°ç»„æ¯ä¸ªå…ƒç´ åŸæœ¬éƒ½æ˜¯ nullï¼Œåœ¨ put æ’å…¥æ•°æ®çš„æ—¶å€™ä¼šæ ¹æ® key å€¼çš„ hash å»è®¡ç®—ä¸€ä¸ª index å€¼ã€‚</p><p>æ¯”å¦‚æˆ‘è°ƒç”¨<code>put(&quot;debugLife&quot;, 42)</code>ï¼Œè¿™ä¸ªæ—¶å€™ä¼šé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºæ’å…¥çš„ä½ç½®ï¼Œæ¯”å¦‚è¯´ index ä¸º2å§ï¼Œé‚£ç»“æœå°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div align="center"><p><img src="/img/58.png"></p></div><p>é‚£ä¹ˆï¼Œåªç”¨ä¸€ä¸ªæ•°ç»„å°±å¥½äº†å‘€ï¼Œä¸ºå•¥è¿˜è¦ç”¨åˆ°é“¾è¡¨ï¼Ÿ</p><p>åŸå› å¾ˆç®€å•ï¼Œæ•°ç»„é•¿åº¦æœ‰é™ï¼Œåœ¨æœ‰é™çš„é•¿åº¦é‡Œä½¿ç”¨å“ˆå¸Œï¼Œä¼šæœ‰å¾ˆå¤§æ¦‚ç‡å‡ºç°ä¸åŒçš„ key çš„è®¡ç®—å‡ºçš„ index ç»“æœç›¸åŒã€‚æ¯”å¦‚æˆ‘è°ƒç”¨<code>put(&quot;lifeDebug, 24)</code>è®¡ç®—å‡ºçš„ index ä¹Ÿä¸º2ï¼Œå°±ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼š</p><div align="center"><p><img src="/img/59.png"></p></div><p>ä¸Šé¢ index ä¸º2çš„ä¸¤å¯¹key-valueå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ã€‚è¿™ç‚¹æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ Node çš„ä»£ç æ¥ä½è¯ï¼š</p><pre><code class="java">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;    final int hash;    final K key;    V value;    Node&lt;K,V&gt; next;    ...&#125;</code></pre><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœä¸¤æ¬¡è®¡ç®—çš„ index ç›¸åŒï¼Œé‚£æ–°çš„ Node åœ¨æ’å…¥çš„æ—¶å€™ï¼Œæ˜¯æ€ä¹ˆæ’å…¥çš„ï¼Ÿ</p><p>åœ¨ Java 8 ä¹‹å‰æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œä¹Ÿå³æ–°æ¥çš„ Node ä¼šå–ä»£åŸæ¥çš„ Nodeï¼ŒåŸæœ‰å€¼å°±è¢«æ¨åˆ°é“¾è¡¨ä¸­å»ï¼Œåƒä¸Šé¢çš„å›¾ä¸€æ ·ã€‚</p><p>ä½†æ˜¯ä» Java 8 ä¹‹åï¼Œå°±é‡‡ç”¨<strong>å°¾éƒ¨æ’å…¥</strong>äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªè¦å…ˆä» HashMap çš„<strong>æ‰©å®¹æœºåˆ¶</strong>è¯´èµ·ã€‚</p><h3 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h3><p>åˆšæ‰ä¸Šé¢æåˆ°äº†ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯æœ‰é™çš„ï¼Œå½“æ•°æ®å¤šæ¬¡æ’å…¥ï¼Œè¾¾åˆ°ä¸€å®šçš„æ•°é‡ä¹‹åï¼Œå°±ä¼šè¿›è¡Œ<strong>æ‰©å®¹ï¼ˆresizeï¼‰</strong>ã€‚æ‰©å®¹çš„å› ç´ æœ‰ä¸¤ä¸ªï¼š</p><ul><li>Capacityï¼šHashMap å½“å‰çš„å®¹é‡</li><li>LoadFactorï¼šè´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼æ˜¯<code>0.75f</code></li></ul><pre><code class="java">/** * The load factor used when none specified in constructor. */static final float DEFAULT_LOAD_FACTOR = 0.75f;</code></pre><p>è´Ÿè½½å› å­å¯ä»¥ç†è§£ä¸ºï¼Œå¦‚æœå½“å‰å®¹é‡æ˜¯100ï¼Œå­˜75ä¸ªè¿˜æ²¡äº‹ï¼Œä½†å­˜ç¬¬76ä¸ªçš„æ—¶å€™ï¼Œå°±è¦è¿›è¡Œæ‰©å®¹ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ï¼š</p><pre><code class="java">public V put(K key, V value) &#123;    return putVal(hash(key), key, value, false, true);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent,                boolean evict) &#123;    ...    if (++size &gt; threshold)        resize();&#125;// æ‰©å®¹çš„é˜ˆå€¼ï¼ˆå®¹é‡ * è´Ÿè½½å› å­)int threshold;// é»˜è®¤çš„å®¹é‡ï¼Œå¿…é¡»æ˜¯2çš„å¹‚static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16// å¦‚æœæ„é€ å‡½æ•°æœªæŒ‡å®šçš„è¯ï¼Œè´Ÿè½½å› å­å°±æ˜¯0.75fstatic final float DEFAULT_LOAD_FACTOR = 0.75f;</code></pre><p>è€Œæ‰©å®¹ä¹Ÿå¹¶ä¸æ˜¯ç®€å•åœ°æ‰©å¤§ç‚¹å®¹é‡å°±å®Œäº‹äº†ï¼Œæˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸‹<code>resize()</code>çš„ä»£ç ï¼š</p><pre><code class="java">// åˆå§‹åŒ–æˆ–è€…æ‰©å®¹ä¸ºåŸæ¥çš„2å€ã€‚// å¦‚æœå†…å®¹ä¸º nullï¼Œåˆ†é…é»˜è®¤å®¹é‡å¤§å°çš„åŒºåŸŸã€‚// å¦‚æœä¸æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†ã€2æ¬¡å¹‚æ‰©å±•ã€ï¼Œæ‰€æœ‰çš„å…ƒç´ è¦ä¹ˆå¾…åœ¨åŸæ¥çš„ indexï¼Œè¦ä¹ˆå°±åœ¨æ–° table é‡Œåç§»ã€2æ¬¡å¹‚ã€ä¸ªä½ç½®ã€‚final Node&lt;K,V&gt;[] resize() &#123;    Node&lt;K,V&gt;[] oldTab = table;    int oldCap = (oldTab == null) ? 0 : oldTab.length;    int oldThr = threshold;    int newCap, newThr = 0;    if (oldCap &gt; 0) &#123;        // æ•°æ®é‡å·²ç»åˆ°æœ€å¤§å€¼ 1 &lt;&lt; 30äº†ï¼Œå°±å°†é˜ˆå€¼è®¾ç½®ä¸º Integer.MAX_VALUE å§ï¼Œä¹Ÿä¸ç”¨æ‰©å®¹äº†ï¼Œè¿˜æ‰©å•¥æ‰©        if (oldCap &gt;= MAXIMUM_CAPACITY) &#123;            threshold = Integer.MAX_VALUE;            return oldTab;        &#125;        // æ–°çš„å®¹é‡æ˜¯æ—§å®¹é‡ * 2ï¼Œæ–°çš„é˜ˆå€¼ä¹Ÿæ˜¯æ—§çš„é˜ˆå€¼ * 2        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;                oldCap &gt;= DEFAULT_INITIAL_CAPACITY)            newThr = oldThr &lt;&lt; 1;    &#125;    // æ•°æ®é‡ä¸º0ï¼Œä½†æ˜¯æ—§é˜ˆå€¼å¤§äº0ï¼Œæ–°çš„å®¹é‡å°±æ˜¯æ—§çš„é˜ˆå€¼    else if (oldThr &gt; 0)        newCap = oldThr;    // æ•°æ®é‡ä¸º0ï¼Œæ—§é˜ˆå€¼ç­‰äº0ï¼Œæ–°çš„å®¹é‡å°±æ˜¯é»˜è®¤å®¹é‡ï¼Œæ–°çš„é˜ˆå€¼å°±æ˜¯é»˜è®¤å®¹é‡ * é»˜è®¤è´Ÿè½½å› å­    else &#123;        newCap = DEFAULT_INITIAL_CAPACITY;        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);    &#125;    // ç»è¿‡ä¸Šé¢çš„å¤„ç†ï¼Œæ–°çš„é˜ˆå€¼è¿˜æ˜¯0çš„è¯ï¼Œå°±è¿›è¡Œå¯¹æ¯”ï¼š    // å¦‚æœï¼šæ–°çš„å®¹é‡å°äºæœ€å¤§å®¹é‡ ä¸” ç”¨æˆ·è®¾ç½®çš„é˜ˆå€¼å°äºæœ€å¤§å®¹é‡çš„è¯ï¼Œæ–°çš„é˜ˆå€¼å°±æ˜¯ç”¨æˆ·è®¾ç½®çš„é˜ˆå€¼    // å¦åˆ™ï¼šæ–°çš„é˜ˆå€¼å°±æ˜¯ Integer.MAX_VALUE    if (newThr == 0) &#123;        float ft = (float)newCap * loadFactor;        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?                (int)ft : Integer.MAX_VALUE);    &#125;    // è®¾ç½®æ–°çš„é˜ˆå€¼    threshold = newThr;    @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)    // å…ˆç”³è¯·ä¸€ä¸ªé•¿åº¦ä¸ºä¹‹å‰2å€çš„æ–°æ•°ç»„    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];    // æ¸…ç©ºåŸæœ‰æ•°ç»„    table = newTab;    if (oldTab != null) &#123;        // å¼€å§‹å¾ªç¯å¤„ç†æ—§æ•°ç»„        for (int j = 0; j &lt; oldCap; ++j) &#123;            Node&lt;K,V&gt; e;            // å¦‚æœæ—§æ•°ç»„[j]å…ƒç´ ä¸ä¸º null            if ((e = oldTab[j]) != null) &#123;                // æŠŠæ—§æ•°ç»„[j]ç½®ä¸º null                oldTab[j] = null;                // å¦‚æœæ—§æ•°ç»„[j]çš„nextæ— Nodeï¼Œä¹Ÿå³è¯¥indexä¸Šåªæœ‰å®ƒè‡ªå·±                if (e.next == null)                    // e.hash &amp; (newCap - 1) æ˜¯åœ¨è®¡ç®—è¯¥å…ƒç´ çš„ index                    newTab[e.hash &amp; (newCap - 1)] = e;                // å¦‚æœæ—§æ•°ç»„[j]æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå°±è°ƒç”¨å®ƒçš„splitæ–¹æ³•ï¼Œå°†å…¶å­èŠ‚ç‚¹å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­                else if (e instanceof TreeNode)                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);                // ä¿ç•™ä¹‹å‰æ•°æ®çš„é¡ºåº                else &#123;                    Node&lt;K,V&gt; loHead = null, loTail = null;                    Node&lt;K,V&gt; hiHead = null, hiTail = null;                    Node&lt;K,V&gt; next;                    do &#123;                        // è·å–è¯¥èŠ‚ç‚¹çš„ next                        next = e.next;                        if ((e.hash &amp; oldCap) == 0) &#123;                            if (loTail == null)                                loHead = e;                            else                                loTail.next = e;                            loTail = e;                        &#125;                        else &#123;                            if (hiTail == null)                                hiHead = e;                            else                                hiTail.next = e;                            hiTail = e;                        &#125;                    &#125; while ((e = next) != null);                    if (loTail != null) &#123;                        loTail.next = null;                        newTab[j] = loHead;                    &#125;                    if (hiTail != null) &#123;                        hiTail.next = null;                        newTab[j + oldCap] = hiHead;                    &#125;                &#125;            &#125;        &#125;    &#125;    return newTab;&#125;</code></pre><p>å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œæ‰©å®¹åŸºæœ¬ä¸Šåˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>å°†æ•°ç»„çš„å®¹é‡æ‰©å±•ä¸ºåŸæ¥çš„2å€</li><li>é‡æ–°è®¡ç®—æ‰€æœ‰ Node çš„ hash å€¼ï¼Œä¹Ÿå³ rehashï¼Œå¹¶æ’å…¥åˆ°æ–°æ•°ç»„ä¸­</li></ol><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ rehashï¼Ÿç›´æ¥æ‰©å®¹ä¸å°±å®Œäº‹äº†ï¼Ÿ</p><p>è¿™æ ·åšæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ•°ç»„çš„å®¹é‡æ‰©å¤§åï¼Œ<strong>è®¡ç®— index çš„è§„åˆ™ä¹Ÿå‘ç”Ÿäº†å˜åŒ–</strong>ã€‚</p><p>index çš„è®¡ç®—è§„åˆ™æ˜¯<code>index = key.hash &amp; (capacity - 1)</code>ï¼Œä¹‹å‰ capacity 16ï¼Œå˜æˆäº† 32 çš„è¯ï¼Œå€¼æ˜æ˜¾å°±ä¸ä¸€æ ·äº†å“‡ã€‚</p><p>å¥½ï¼Œå›åˆ°åˆšæ‰æåˆ°çš„å¤´æ’å°¾æ’ã€‚</p><p>æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç°åœ¨æˆ‘ä»¬é‡‡ç”¨å¤´æ’æ³•ï¼ŒHashMap çš„å®¹é‡æ˜¯2ï¼Œè´Ÿè½½å› å­æ˜¯0.75ï¼Œé‚£ä¹ˆåœ¨æ’å…¥ç¬¬äºŒä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå°±è¦å‡†å¤‡æ‰©å®¹äº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¾€è¿™ä¸ªå®¹é‡æ˜¯2çš„æ•°ç»„é‡Œç”¨<strong>ä¸åŒçº¿ç¨‹</strong>æ’å…¥ Cã€Bã€A ä¸‰ä¸ª Entryï¼ˆå¤´æ’æ³•æ˜¯ Java8 ä¹‹å‰çš„å“¦ï¼Œè¦å« Entry çš„å“¦ï¼‰ï¼Œé‚£ä¹ˆï¼Œåœ¨æ•°æ®æ’å…¥ä¹‹åï¼Œæ‰©å®¹ä¹‹å‰ï¼Œæ•°æ®ç»“æ„å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><div align="center"><p><img src="/img/60.png"></p></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é“¾è¡¨çš„æŒ‡å‘æ˜¯ A-&gt;B-&gt;Cï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼ŒåŒä¸€ index æ—¶ï¼Œ<strong>æ–°å…ƒç´ æ€»æ˜¯ä¼šè¢«æ”¾åœ¨é“¾è¡¨å¤´çš„ä½ç½®</strong>ã€‚</p><p>resize()ä¹‹åï¼Œæ—§æ•°ç»„ä¸­åŒä¸€ä¸ª index ä¸Šçš„é“¾è¡¨ï¼Œå…¶ Entry å¯èƒ½ä¼šè¢«åˆ†é…åˆ°å…¶ä»–çš„ index ä¸Šï¼Œä¹Ÿå³å‡ºç°ä¸‹é¢çš„æƒ…å†µï¼š</p><div align="center"><p><img src="/img/61.png"></p></div><p>é‚£ä¹ˆå¾…3ä¸ªçº¿ç¨‹éƒ½è°ƒæ•´å®Œæ¯•åï¼Œå°±æœ‰å¯èƒ½å‡ºç°ä¸‹é¢çš„æƒ…å†µï¼š</p><div align="center"><p><img src="/img/62.png"></p></div><p>å‡ºç°äº†ï¼æ— é™å¾ªç¯ï¼ å› ä¸º HashMap æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„å•Šï¼</p><div align="center"><p><img src="/img/loop.jpg"></p></div><p>è€Œå°¾æ’æ³•å°±ä¸ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚ä½¿ç”¨å¤´æ’æ—¶ä¼šæ”¹å˜é“¾è¡¨ä¸Šçš„é¡ºåºï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨å°¾æ’ï¼Œåœ¨æ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨å…ƒç´ åŸæœ¬çš„é¡ºåºï¼Œå°±ä¸ä¼šå‡ºç°é“¾è¡¨æˆç¯çš„é—®é¢˜äº†ã€‚ä¹Ÿå°±æ˜¯è¯´åŸæœ¬æ˜¯A-&gt;Bï¼Œåœ¨æ‰©å®¹åé‚£ä¸ªé“¾è¡¨è¿˜æ˜¯A-&gt;Bï¼š</p><div align="center"><p><img src="/img/63.png"></p></div><p>æ€»ç»“èµ·æ¥å°±æ˜¯ï¼š</p><ol><li>Java 7 åœ¨å¤šçº¿ç¨‹æ“ä½œ HashMap æ—¶å¯èƒ½å¼•èµ·æ­»å¾ªç¯ï¼ŒåŸå› æ˜¯æ‰©å®¹è½¬ç§»åå‰åé“¾è¡¨é¡ºåºå€’ç½®ï¼Œåœ¨è½¬ç§»è¿‡ç¨‹ä¸­ä¿®æ”¹äº†åŸæ¥é“¾è¡¨ä¸­èŠ‚ç‚¹çš„å¼•ç”¨å…³ç³»ã€‚</li><li>Java 8 åœ¨åŒæ ·çš„å‰æä¸‹å¹¶ä¸ä¼šå¼•èµ·æ­»å¾ªç¯ï¼ŒåŸå› æ˜¯æ‰©å®¹è½¬ç§»åå‰åé“¾è¡¨é¡ºåºä¸å˜ï¼Œä¿æŒä¹‹å‰èŠ‚ç‚¹çš„å¼•ç”¨å…³ç³»ã€‚</li></ol><p>ä½†è¿™å¹¶ä¸æ„å‘³ç€åœ¨ Java 8 ä¸­å¯ä»¥æŠŠ HashMap ç”¨äºå¤šçº¿ç¨‹ã€‚ä»æºç çš„<code>put/get</code>æ–¹æ³•ä¸­ï¼Œæ²¡æœ‰ä»»ä½•åŒæ­¥æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— æ³•ä¿è¯ä½ æŸä¸ªçº¿ç¨‹<code>put</code>è¿›å»çš„å€¼ï¼Œå†<code>get</code>çš„æ—¶å€™è¿˜æ˜¯åŸå€¼ï¼Œæ‰€ä»¥ï¼Œè¿˜æ˜¯æ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¦‚æœè¦çº¿ç¨‹å®‰å…¨ï¼Œè¯·ä½¿ç”¨ <a href="#hashtable">Hashtable</a> æˆ–è€… <a href="#concurrenthashmap">ConcurrentHashMap</a>ã€‚ </p><h2 id="å‡åŒ€åˆ†å¸ƒ"><a href="#å‡åŒ€åˆ†å¸ƒ" class="headerlink" title="å‡åŒ€åˆ†å¸ƒ"></a>å‡åŒ€åˆ†å¸ƒ</h2><p>ä»ä¸Šé¢çš„ä»£ç é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ï¼ŒHashMap é»˜è®¤åˆå§‹åŒ–é•¿åº¦æ˜¯<code>1 &lt;&lt; 4</code>ï¼Œä¹Ÿå°±æ˜¯16ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯16å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚</p><p>HashMap ä½¿ç”¨äº†ä½è¿ç®—æ¥å¾—åˆ°ã€16ã€è¿™ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä½è¿ç®—æ¯”ç®—æ•°è¿ç®—çš„æ•ˆç‡è¦é«˜å¾ˆå¤šï¼Œä¹‹æ‰€ä»¥é€‰æ‹©16è¿™ä¸ªæ•°å­—ï¼Œæ˜¯ä¸ºäº†æœåŠ¡å°† key æ˜ å°„åˆ°index çš„è¿™ä¸ªç®—æ³•ï¼ˆå‰é¢æåˆ°è¿‡ï¼‰ï¼š</p><pre><code class="java">index = key.hash &amp; (capacity - 1)</code></pre><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸ª key ä¸º<code>wtf</code>ï¼Œå®ƒçš„ hashCode å€¼æ˜¯<code>118057</code>ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯<code>11100110100101001</code>ï¼Œä½¿ç”¨capacityçš„é»˜è®¤å€¼16ï¼Œcapacity - 1 æ˜¯15ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯<code>1111</code>ï¼Œé‚£ä¹ˆå¥—å…¥ index è®¡ç®—å…¬å¼çš„è¯ï¼Œå°±æ˜¯ï¼š</p><pre><code class="java">index = 0b11100110100101001 &amp; 0b1111index = 9</code></pre><p>è‡³äºä¸ºä»€ä¹ˆè¦ä½¿ç”¨16ï¼Œè€Œä¸æ˜¯14ã€19ã€25ï¼Œæ˜¯å› ä¸ºä½¿ç”¨2æ¬¡å¹‚æ•°å­—çš„æ—¶å€™ï¼Œå‡å»1ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶å…¨ä¸º1ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>&amp;</code>å‡ºæ¥çš„ç»“æœç­‰åŒäº hashCode åå‡ ä½çš„å€¼ã€‚è¿™ç§ä½è¿ç®—çš„é€Ÿåº¦å¯æ¯”å–ä½™çš„æ–¹æ³•æ€§èƒ½é«˜å¤šäº†ã€‚åŒæ—¶ï¼Œåªè¦ hashcode æœ¬èº«åˆ†å¸ƒå‡åŒ€ï¼Œindex çš„åˆ†å¸ƒå°±æ˜¯å‡åŒ€çš„ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ8å’Œ32ä¹Ÿæ˜¯2æ¬¡å¹‚ï¼Œååé€‰æ‹©äº†16ï¼Ÿå…¶å®8å’Œ32ä¹Ÿéƒ½å¯ä»¥ï¼Œå¯èƒ½åªæ˜¯ä½œè€…è®¤ä¸ºè¿™ä¸ªæ•°å­—æ¯”è¾ƒç¬¦åˆå¸¸ç”¨å§ã€‚</p><p>å¦å¤–ï¼Œè¿˜æœ‰ä¸ªå°çŸ¥è¯†ç‚¹ï¼šHashmapä¸­çš„é“¾è¡¨å¤§å°è¶…è¿‡8ä¸ªæ—¶ä¼š<strong>è‡ªåŠ¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘</strong>ï¼Œå½“åˆ é™¤å°äº6æ—¶<strong>é‡æ–°å˜ä¸ºé“¾è¡¨</strong>ã€‚è¿™æ˜¯å› ä¸ºæ ¹æ®**<a href="https://zh.wikipedia.org/zh-hans/%E6%B3%8A%E6%9D%BE%E5%88%86%E4%BD%88">æ³Šæ¾åˆ†å¸ƒ</a><strong>ï¼Œåœ¨è´Ÿè½½å› å­é»˜è®¤ä¸º0.75çš„æ—¶å€™ï¼Œå•ä¸ª hash æ§½å†…å…ƒç´ ä¸ªæ•°ä¸º8çš„</strong>æ¦‚ç‡å°äºç™¾ä¸‡åˆ†ä¹‹ä¸€**ï¼Œæ‰€ä»¥å°†7ä½œä¸ºä¸€ä¸ªåˆ†æ°´å²­ï¼Œç­‰äº7çš„æ—¶å€™ä¸è½¬æ¢ï¼Œå¤§äºç­‰äº8çš„æ—¶å€™æ‰è¿›è¡Œè½¬æ¢ï¼Œå°äºç­‰äº6çš„æ—¶å€™å°±åŒ–ä¸ºé“¾è¡¨ã€‚</p><h2 id="equals-æ–¹æ³•å’Œ-hashCode-æ–¹æ³•"><a href="#equals-æ–¹æ³•å’Œ-hashCode-æ–¹æ³•" class="headerlink" title="equals æ–¹æ³•å’Œ hashCode æ–¹æ³•"></a>equals æ–¹æ³•å’Œ hashCode æ–¹æ³•</h2><p>æˆ‘ä»¬æœ‰æ—¶ä¸ºäº†å¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œä¼šé‡å†™<code>equals()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦é‡å†™<code>hashCode()</code>æ–¹æ³•å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œå¦‚æœä½ çš„å¯¹è±¡è¦æ”¾åœ¨ HashMap ä¸­çš„è¯ï¼Œéœ€è¦ã€‚</p><p>åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª Object ç±»ï¼ŒObejct ç±»ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•<code>equals()</code>å’Œ<code>hashCode()</code>ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚å½“æˆ‘ä»¬**æœªé‡å†™<code>equals()</code>**æ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œå¦‚æœæ˜¯<code>new</code>äº†ä¸¤ä¸ªå¯¹è±¡çš„è¯ï¼Œé‚£è‚¯å®šä¸åŒã€‚</p><p>åˆšæ‰æˆ‘ä»¬æåˆ°è¿‡ï¼ŒHashMap æ˜¯é€šè¿‡ hashCode æ¥è®¡ç®— index çš„ï¼Œå½“æˆ‘ä»¬å»<code>get</code>çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½ä¼šæ‹¿åˆ°ä¸€ä¸ªåœ¨é“¾è¡¨ä¸Šçš„å€¼ï¼Œé‚£ä¹ˆå¦‚ä½•ç¡®å®šæ˜¯é“¾è¡¨ä¸Šçš„å“ªä¸ªå€¼å‘¢ï¼Ÿæ˜¯äº†ï¼Œé€šè¿‡<code>equals()</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä»£ç éƒ¨åˆ†ï¼š</p><pre><code class="java">public V get(Object key) &#123;    Node&lt;K,V&gt; e;    return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123;    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;        (first = tab[(n - 1) &amp; hash]) != null) &#123;        if (first.hash == hash &amp;&amp; // always check first node            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))            return first;        if ((e = first.next) != null) &#123;            if (first instanceof TreeNode)                return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);            do &#123;                // å°±æ˜¯è¿™é‡Œå•¦ï¼Œå¯¹æ¯” hash å’Œ equals                if (e.hash == hash &amp;&amp;                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                    return e;            &#125; while ((e = e.next) != null);        &#125;    &#125;    return null;&#125;</code></pre><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å¯¹<code>equals()</code>æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œé‚£æœ€å¥½ä¹Ÿå¯¹<code>hashCode()</code>æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œä»¥ä¿è¯ç›¸åŒçš„å¯¹è±¡è¿”å›ç›¸åŒçš„ hash å€¼ï¼Œä¸åŒçš„å¯¹è±¡è¿”å›ä¸åŒçš„ hash å€¼ã€‚</p><h2 id="Hashtable"><a href="#Hashtable" class="headerlink" title="Hashtable"></a>Hashtable</h2><p>è¿™ä¸ª Map çš„æ´¾ç”Ÿç±»æ˜¯ä¸ºäº†åœ¨<code>put/get</code>è¾¾åˆ°ä¸€å®šçš„çº¿ç¨‹å®‰å…¨ï¼Œæ‰å‡ºç°çš„ã€‚å®ƒçš„è§£å†³æ–¹æ¡ˆæ¯”è¾ƒç²—æš´ï¼Œç›´æ¥åœ¨<code>put/get</code>æ–¹æ³•ä¸ŠåŠ  synchronized å…³é”®å­—ï¼Œé”ä½æ–¹æ³•ã€‚ç”±æ­¤å¯è§ï¼Œå¹¶å‘åº¦ä¼šæ¯”è¾ƒä½ï¼š</p><pre><code class="java">public synchronized V get(Object key) &#123;    Entry&lt;?,?&gt; tab[] = table;    int hash = key.hashCode();    int index = (hash &amp; 0x7FFFFFFF) % tab.length;    for (Entry&lt;?,?&gt; e = tab[index] ; e != null ; e = e.next) &#123;        if ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;            return (V)e.value;        &#125;    &#125;    return null;&#125;</code></pre><p>æ‰€ä»¥ï¼Œè¿™ä¸ªç±»å¿…å®šä¼šæ¸æ¸åœ°é€€å‡ºèˆå°ï¼Œåœ¨èŒ«èŒ«å†å²é•¿æ²³ä¸­è¢«æ…¢æ…¢æ·¹æ²¡ã€‚</p><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p>è¿™ä¸ªå¿…é¡»è¦å•ç‹¬æ¥ä¸€ç¯‡<a href="/concurrent-hashmap/">ConcurrentHashMapçš„æ–‡ç« </a>äº†ã€‚å› ä¸º ConcurrentHashMap å†…éƒ¨çš„åŸç†æ¯” HashMap è¦å¤æ‚å¾—å¤šï¼Œå¦‚æœèµ‹åœ¨è¿™ä¸‹é¢ï¼Œè¿™ç¯‡å°±å¤ªé•¿äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œé¢è¯•é¢˜</title>
      <link href="/2020-01-03/job-interview-network/"/>
      <url>/2020-01-03/job-interview-network/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›ç½‘ç»œæ–¹é¢çš„é¢è¯•é¢˜</p><span id="more"></span><h2 id="ä¸€ã€HTTP-HTTPS-ï¼ˆâ­â­â­ï¼‰"><a href="#ä¸€ã€HTTP-HTTPS-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="ä¸€ã€HTTP/HTTPS ï¼ˆâ­â­â­ï¼‰"></a>ä¸€ã€HTTP/HTTPS ï¼ˆâ­â­â­ï¼‰</h2><h3 id="1ã€HTTPä¸HTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1ã€HTTPä¸HTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1ã€HTTPä¸HTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1ã€HTTPä¸HTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>HTTPS æ˜¯ä¸€ç§é€šè¿‡è®¡ç®—æœºç½‘ç»œè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ã€‚HTTPS ç»ç”± HTTP è¿›è¡Œé€šä¿¡ï¼Œä½†åˆ©ç”¨ SSL/TLS æ¥åŠ å¯†æ•°æ®åŒ…ã€‚HTTPS å¼€å‘çš„ä¸»è¦ç›®çš„æ˜¯<strong>æä¾›å¯¹ç½‘ç«™æœåŠ¡å™¨çš„èº«ä»½è®¤è¯</strong>ï¼Œä¿æŠ¤äº¤æ¢æ•°æ®çš„éšç§ä¸å®Œæ•´æ€§ã€‚</p><p>HTTPS å’Œ HTTP çš„æ¦‚å¿µï¼š</p><p>HTTPSï¼ˆå…¨ç§°ï¼šHypertext Transfer Protocol over Secure Socket Layerï¼‰ï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„ HTTP é€šé“ï¼Œç®€å•è®²<strong>æ˜¯ HTTP çš„å®‰å…¨ç‰ˆ</strong>ã€‚å³ HTTP ä¸‹åŠ å…¥ SSL å±‚ï¼ŒHTTPS çš„å®‰å…¨åŸºç¡€æ˜¯ SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦ SSLã€‚ å®ƒæ˜¯ä¸€ä¸ª URI schemeï¼ˆæŠ½è±¡æ ‡è¯†ç¬¦ä½“ç³»ï¼‰ï¼Œå¥æ³•ç±»åŒ<code>http:</code>ä½“ç³»ã€‚ç”¨äºå®‰å…¨çš„ HTTP æ•°æ®ä¼ è¾“ã€‚<code>https:</code>URL è¡¨æ˜å®ƒä½¿ç”¨äº† HTTPï¼Œä½† HTTPS å­˜åœ¨ä¸åŒäº HTTP çš„é»˜è®¤ç«¯å£åŠä¸€ä¸ªåŠ å¯†/èº«ä»½éªŒè¯å±‚ï¼ˆåœ¨ HTTP ä¸ TCP ä¹‹é—´ï¼‰ã€‚è¿™ä¸ªç³»ç»Ÿçš„æœ€åˆç ”å‘ç”±ç½‘æ™¯å…¬å¸è¿›è¡Œï¼Œæä¾›äº†èº«ä»½éªŒè¯ä¸åŠ å¯†é€šè®¯æ–¹æ³•ï¼Œç°åœ¨å®ƒè¢«å¹¿æ³›ç”¨äºä¸‡ç»´ç½‘ä¸Šå®‰å…¨æ•æ„Ÿçš„é€šè®¯ï¼Œä¾‹å¦‚äº¤æ˜“æ”¯ä»˜æ–¹é¢ã€‚</p><p>è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP-Hypertext transfer protocol) æ˜¯ä¸€ç§è¯¦ç»†è§„å®šäº†æµè§ˆå™¨å’Œä¸‡ç»´ç½‘æœåŠ¡å™¨ä¹‹é—´äº’ç›¸é€šä¿¡çš„è§„åˆ™ï¼Œé€šè¿‡å› ç‰¹ç½‘ä¼ é€ä¸‡ç»´ç½‘æ–‡æ¡£çš„æ•°æ®ä¼ é€åè®®ã€‚</p><p>HTTPS åè®®éœ€è¦åˆ° CAï¼ˆCertificate Agent è¯ä¹¦æœºæ„ï¼‰ç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦å¾ˆå°‘ï¼Œéœ€è¦äº¤è´¹ã€‚</p><p>HTTP å’Œ HTTPS ç”¨çš„ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯<code>80</code>ï¼Œåè€…æ˜¯<code>443</code>ã€‚HTTP çš„è¿æ¥å¾ˆç®€å•ï¼Œæ˜¯æ— çŠ¶æ€çš„ï¼Œ HTTPS åè®®æ˜¯ç”± SSL + HTTP åè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œè¦æ¯” HTTP åè®®å®‰å…¨ã€‚</p><p>HTTPS è§£å†³çš„é—®é¢˜ï¼š</p><ol><li>ä¿¡ä»»ä¸»æœºçš„é—®é¢˜ã€‚é‡‡ç”¨ HTTPS çš„ SERVER å¿…é¡»ä» CA ç”³è¯·ä¸€ä¸ªç”¨äºè¯æ˜æœåŠ¡å™¨ç”¨é€”ç±»å‹çš„è¯ä¹¦ã€‚æ”¹è¯ä¹¦åªæœ‰ç”¨äºå¯¹åº”çš„ SERVER çš„æ—¶å€™ï¼Œå®¢æˆ·åº¦æ‰ä¿¡ä»»æ¬¡ä¸»æœºã€‚</li><li>é˜²æ­¢é€šè®¯è¿‡ç¨‹ä¸­çš„æ•°æ®çš„æ³„å¯†å’Œè¢«ç¯¡æ”¹ã€‚</li></ol><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºä¸¤ä¸ªçš„åŒºåˆ«ï¼š</p><p><img src="http://blog.cigis-cloud.com/aaji-1591191396.png" alt="HTTP &amp; HTTPS"></p><p><em>æ³¨ï¼šTLSæ˜¯SSLçš„å‡çº§æ›¿ä»£ç‰ˆï¼Œå…·ä½“å‘å±•å†å²å¯ä»¥å‚è€ƒä¼ è¾“å±‚å®‰å…¨æ€§åè®®ã€‚</em></p><p>HTTP ä¸ HTTPS åœ¨å†™æ³•ä¸Šçš„åŒºåˆ«ä¹Ÿæ˜¯å‰ç¼€çš„ä¸åŒï¼Œå®¢æˆ·ç«¯å¤„ç†çš„æ–¹å¼ä¹Ÿä¸åŒï¼Œå…·ä½“è¯´æ¥ï¼š</p><ul><li>å¦‚æœ URLçš„åè®®æ˜¯HTTPï¼Œåˆ™å®¢æˆ·ç«¯ä¼šæ‰“å¼€ä¸€æ¡åˆ°æœåŠ¡ç«¯ç«¯å£<code>80</code>ï¼ˆé»˜è®¤ï¼‰çš„è¿æ¥ï¼Œå¹¶å‘å…¶å‘é€è€çš„HTTPè¯·æ±‚ã€‚</li><li>å¦‚æœ URLçš„åè®®æ˜¯HTTPSï¼Œåˆ™å®¢æˆ·ç«¯ä¼šæ‰“å¼€ä¸€æ¡åˆ°æœåŠ¡ç«¯ç«¯å£<code>443</code>ï¼ˆé»˜è®¤ï¼‰çš„è¿æ¥ï¼Œç„¶åä¸æœåŠ¡å™¨æ¡æ‰‹ï¼Œä»¥äºŒè¿›åˆ¶æ ¼å¼ä¸æœåŠ¡å™¨äº¤æ¢ä¸€äº›SSLçš„å®‰å…¨å‚æ•°ï¼Œé™„ä¸ŠåŠ å¯†çš„ HTTPè¯·æ±‚ã€‚</li></ul><p>æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼ŒHTTPSæ¯”HTTPå¤šäº†ä¸€å±‚ä¸SSLçš„è¿æ¥ï¼Œè¿™ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯SSLæ¡æ‰‹çš„è¿‡ç¨‹ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸»è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>äº¤æ¢åè®®ç‰ˆæœ¬å·</li><li>é€‰æ‹©ä¸€ä¸ªä¸¤ç«¯éƒ½äº†è§£çš„å¯†ç </li><li>å¯¹ä¸¤ç«¯çš„èº«ä»½è¿›è¡Œè®¤è¯</li><li>ç”Ÿæˆä¸´æ—¶çš„ä¼šè¯å¯†é’¥ï¼Œä»¥ä¾¿åŠ å¯†ä¿¡é“</li></ul><p>SSLæ¡æ‰‹æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œæ›´å¤šå…³äºSSLæ¡æ‰‹çš„è¿‡ç¨‹ç»†èŠ‚å¯ä»¥å‚è€ƒTLS/SSLæ¡æ‰‹è¿‡ç¨‹</p><p>SSL/TSLçš„å¸¸è§å¼€æºå®ç°æ˜¯OpenSSLï¼ŒOpenSSLæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶åº“åŒ…ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…æ¥è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œé¿å…çªƒå¬ï¼ŒåŒæ—¶ç¡®è®¤å¦ä¸€ç«¯è¿æ¥è€…çš„èº«ä»½ã€‚è¿™ä¸ªåŒ…å¹¿æ³›è¢«åº”ç”¨åœ¨äº’è”ç½‘çš„ç½‘é¡µæœåŠ¡å™¨ä¸Šã€‚æ›´å¤šæºäºOpenSSLçš„æŠ€æœ¯ç»†èŠ‚å¯ä»¥å‚è€ƒOpenSSLã€‚</p><h3 id="2ã€HTTP1-1å’ŒHTTP1-0åŠ2-0çš„åŒºåˆ«ï¼Ÿ"><a href="#2ã€HTTP1-1å’ŒHTTP1-0åŠ2-0çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2ã€HTTP1.1å’ŒHTTP1.0åŠ2.0çš„åŒºåˆ«ï¼Ÿ"></a>2ã€HTTP1.1å’ŒHTTP1.0åŠ2.0çš„åŒºåˆ«ï¼Ÿ</h3><h4 id="HTTP1-0å’ŒHTTP1-1çš„ä¸€äº›åŒºåˆ«"><a href="#HTTP1-0å’ŒHTTP1-1çš„ä¸€äº›åŒºåˆ«" class="headerlink" title="HTTP1.0å’ŒHTTP1.1çš„ä¸€äº›åŒºåˆ«"></a>HTTP1.0å’ŒHTTP1.1çš„ä¸€äº›åŒºåˆ«</h4><p>HTTP1.0æœ€æ—©åœ¨ç½‘é¡µä¸­ä½¿ç”¨æ˜¯åœ¨1996å¹´ï¼Œé‚£ä¸ªæ—¶å€™åªæ˜¯ä½¿ç”¨ä¸€äº›è¾ƒä¸ºç®€å•çš„ç½‘é¡µä¸Šå’Œç½‘ç»œè¯·æ±‚ä¸Šï¼Œè€ŒHTTP1.1åˆ™åœ¨1999å¹´æ‰å¼€å§‹å¹¿æ³›åº”ç”¨äºç°åœ¨çš„å„å¤§æµè§ˆå™¨ç½‘ç»œè¯·æ±‚ä¸­ï¼ŒåŒæ—¶HTTP1.1ä¹Ÿæ˜¯å½“å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„HTTPåè®®ã€‚ ä¸»è¦åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ï¼š</p><ol><li><strong>ç¼“å­˜å¤„ç†ã€‚</strong> åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Sinceï¼ŒExpiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Sinceï¼Œ If-Matchï¼Œ If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li><li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨ã€‚</strong> HTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›<strong>æµªè´¹å¸¦å®½</strong>çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”<strong>ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ </strong>åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li><li><strong>é”™è¯¯é€šçŸ¥çš„ç®¡ç†ã€‚</strong> åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</li><li><strong>Hostå¤´å¤„ç†ã€‚</strong> åœ¨HTTP1.0ä¸­è®¤ä¸ºæ¯å°æœåŠ¡å™¨éƒ½ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå› æ­¤ï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­çš„URLå¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚ä½†éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•ï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆMulti-homed Web Serversï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ªIPåœ°å€ã€‚HTTP1.1çš„è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½åº”æ”¯æŒHostå¤´åŸŸï¼Œä¸”è¯·æ±‚æ¶ˆæ¯ä¸­å¦‚æœæ²¡æœ‰Hostå¤´åŸŸä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼ˆ400 Bad Requestï¼‰ã€‚</li><li><strong>é•¿è¿æ¥ã€‚</strong> HTTP 1.1æ”¯æŒé•¿è¿æ¥ï¼ˆPersistentConnectionï¼‰å’Œè¯·æ±‚çš„æµæ°´çº¿ï¼ˆPipeliningï¼‰å¤„ç†ï¼Œåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šå¯ä»¥ä¼ é€å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿï¼Œåœ¨HTTP1.1ä¸­é»˜è®¤å¼€å¯Connectionï¼š keep-aliveï¼Œä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†HTTP1.0æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ›å»ºè¿æ¥çš„ç¼ºç‚¹ã€‚</li></ol><h4 id="SPDY"><a href="#SPDY" class="headerlink" title="SPDY"></a>SPDY</h4><p>åœ¨è®²HTTP1.1å’ŒHTTP2.0çš„åŒºåˆ«ä¹‹å‰ï¼Œè¿˜éœ€è¦è¯´ä¸‹<a href="https://www.chromium.org/spdy">SPDY</a>ï¼Œå®ƒæ˜¯HTTP1.xçš„ä¼˜åŒ–æ–¹æ¡ˆï¼š</p><p>2012å¹´Googleå¦‚ä¸€å£°æƒŠé›·æå‡ºäº†SPDYçš„æ–¹æ¡ˆï¼Œä¼˜åŒ–äº†HTTP1.Xçš„è¯·æ±‚å»¶è¿Ÿï¼Œè§£å†³äº†HTTP1.Xçš„å®‰å…¨æ€§ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ol><li><strong>é™ä½å»¶è¿Ÿã€‚</strong> é’ˆå¯¹HTTPé«˜å»¶è¿Ÿçš„é—®é¢˜ï¼ŒSPDYä¼˜é›…çš„é‡‡å–äº†å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ã€‚å¤šè·¯å¤ç”¨é€šè¿‡å¤šä¸ªè¯·æ±‚streamå…±äº«ä¸€ä¸ª TCP è¿æ¥çš„æ–¹å¼ï¼Œè§£å†³äº†HOL blockingçš„é—®é¢˜ï¼Œé™ä½äº†å»¶è¿ŸåŒæ—¶æé«˜äº†å¸¦å®½çš„åˆ©ç”¨ç‡ã€‚</li><li><strong>è¯·æ±‚ä¼˜å…ˆçº§ï¼ˆrequest prioritizationï¼‰ã€‚</strong> å¤šè·¯å¤ç”¨å¸¦æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜æ˜¯ï¼Œåœ¨è¿æ¥å…±äº«çš„åŸºç¡€ä¹‹ä¸Šæœ‰å¯èƒ½ä¼šå¯¼è‡´å…³é”®è¯·æ±‚è¢«é˜»å¡ã€‚SPDYå…è®¸ç»™æ¯ä¸ªrequestè®¾ç½®ä¼˜å…ˆçº§ï¼Œè¿™æ ·é‡è¦çš„è¯·æ±‚å°±ä¼šä¼˜å…ˆå¾—åˆ°å“åº”ã€‚æ¯”å¦‚æµè§ˆå™¨åŠ è½½é¦–é¡µï¼Œé¦–é¡µçš„ HTML å†…å®¹åº”è¯¥ä¼˜å…ˆå±•ç¤ºï¼Œä¹‹åæ‰æ˜¯å„ç§é™æ€èµ„æºæ–‡ä»¶ï¼Œè„šæœ¬æ–‡ä»¶ç­‰åŠ è½½ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç”¨æˆ·èƒ½ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ç½‘é¡µå†…å®¹ã€‚</li><li><strong>HEADER å‹ç¼©ã€‚</strong> å‰é¢æåˆ° HTTP1.x çš„ HEADER å¾ˆå¤šæ—¶å€™éƒ½æ˜¯é‡å¤å¤šä½™çš„ã€‚é€‰æ‹©åˆé€‚çš„å‹ç¼©ç®—æ³•å¯ä»¥å‡å°åŒ…çš„å¤§å°å’Œæ•°é‡ã€‚</li><li><strong>åŸºäº HTTPS çš„åŠ å¯†åè®®ä¼ è¾“ã€‚</strong> å¤§å¤§æé«˜äº†ä¼ è¾“æ•°æ®çš„å¯é æ€§ã€‚</li><li><strong>æœåŠ¡ç«¯æ¨é€ï¼ˆserver pushï¼‰ã€‚</strong> é‡‡ç”¨äº† SPDY çš„ç½‘é¡µï¼Œä¾‹å¦‚æˆ‘çš„ç½‘é¡µæœ‰ä¸€ä¸ª<code>style.css</code>çš„è¯·æ±‚ï¼Œåœ¨å®¢æˆ·ç«¯æ”¶åˆ°<code>style.css</code>æ•°æ®çš„åŒæ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†<code>style.js</code>çš„æ–‡ä»¶æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯å†æ¬¡å°è¯•è·å–<code>style.js</code>æ—¶å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–åˆ°ï¼Œä¸ç”¨å†å‘è¯·æ±‚äº†ã€‚</li></ol><p>SPDYæ„æˆå›¾ï¼š</p><p><img src="http://blog.cigis-cloud.com/aaji-1591192400.png" alt="SPDYè®¾è®¡æ¨¡å‹"></p><p>SPDYä½äºHTTPä¹‹ä¸‹ï¼ŒTCPå’ŒSSLä¹‹ä¸Šï¼Œè¿™æ ·å¯ä»¥è½»æ¾å…¼å®¹è€ç‰ˆæœ¬çš„HTTPåè®®(å°†HTTP1.xçš„å†…å®¹å°è£…æˆä¸€ç§æ–°çš„frameæ ¼å¼)ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨å·²æœ‰çš„SSLåŠŸèƒ½ã€‚</p><p>ä½†æ˜¯åœ¨ HTTP2.0 æ¨å‡ºä¹‹åï¼ŒSPDY å°±æ¸æ¸åœ°é€€å‡ºå†å²èˆå°äº†ã€‚</p><h4 id="HTTP2-0-å’Œ-HTTP1-X-ç›¸æ¯”çš„æ–°ç‰¹æ€§"><a href="#HTTP2-0-å’Œ-HTTP1-X-ç›¸æ¯”çš„æ–°ç‰¹æ€§" class="headerlink" title="HTTP2.0 å’Œ HTTP1.X ç›¸æ¯”çš„æ–°ç‰¹æ€§"></a>HTTP2.0 å’Œ HTTP1.X ç›¸æ¯”çš„æ–°ç‰¹æ€§</h4><ol><li><strong>æ–°çš„äºŒè¿›åˆ¶æ ¼å¼ï¼ˆBinary Formatï¼‰ã€‚</strong> HTTP1.x çš„è§£ææ˜¯åŸºäºæ–‡æœ¬ã€‚åŸºäºæ–‡æœ¬åè®®çš„æ ¼å¼è§£æå­˜åœ¨å¤©ç„¶ç¼ºé™·ï¼Œæ–‡æœ¬çš„è¡¨ç°å½¢å¼æœ‰å¤šæ ·æ€§ï¼Œè¦åšåˆ°å¥å£®æ€§è€ƒè™‘çš„åœºæ™¯å¿…ç„¶å¾ˆå¤šï¼ŒäºŒè¿›åˆ¶åˆ™ä¸åŒï¼Œåªè®¤<code>0</code>å’Œ<code>1</code>çš„ç»„åˆã€‚åŸºäºè¿™ç§è€ƒè™‘ HTTP2.0 çš„åè®®è§£æå†³å®šé‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œå®ç°æ–¹ä¾¿ä¸”å¥å£®ã€‚</li><li><strong>å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰ã€‚</strong> å³è¿æ¥å…±äº«ï¼Œå³æ¯ä¸€ä¸ª request éƒ½æ˜¯æ˜¯ç”¨ä½œè¿æ¥å…±äº«æœºåˆ¶çš„ã€‚ä¸€ä¸ª request åº”ä¸€ä¸ª idï¼Œè¿™æ ·ä¸€ä¸ªè¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ª requestï¼Œæ¯ä¸ªè¿æ¥çš„ request å¯ä»¥éšæœºçš„æ··æ‚åœ¨ä¸€èµ·ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ® request çš„ id å°† request å†å½’å±åˆ°å„è‡ªä¸åŒçš„æœåŠ¡ç«¯è¯·æ±‚é‡Œé¢ã€‚</li><li><strong>HEADER å‹ç¼©ã€‚</strong> å¦‚ä¸Šæ–‡ä¸­æ‰€è¨€ï¼Œå¯¹å‰é¢æåˆ°è¿‡ HTTP1.x çš„ HEADER å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ï¼ŒHTTP2.0 ä½¿ç”¨ encoder æ¥å‡å°‘éœ€è¦ä¼ è¾“çš„ HEADER å¤§å°ï¼Œé€šè®¯åŒæ–¹å„è‡ªç¼“å­˜ä¸€ä»½ HEADER FIELDS è¡¨ï¼Œæ—¢é¿å…äº†é‡å¤ HEADER çš„ä¼ è¾“ï¼Œåˆå‡å°äº†éœ€è¦ä¼ è¾“çš„å¤§å°ã€‚</li><li><strong>æœåŠ¡ç«¯æ¨é€ï¼ˆserver pushï¼‰ã€‚</strong> åŒ SPDY ä¸€æ ·ï¼ŒHTTP2.0 ä¹Ÿå…·æœ‰ server push åŠŸèƒ½ã€‚</li></ol><p><a href="https://juejin.im/entry/5981c5df518825359a2b9476">éœ€è¦æ›´æ·±çš„ç†è§£è¯·ç‚¹å‡»è¿™é‡Œ</a></p><h3 id="3ã€HTTPS-è¯·æ±‚æ…¢çš„è§£å†³åŠæ³•"><a href="#3ã€HTTPS-è¯·æ±‚æ…¢çš„è§£å†³åŠæ³•" class="headerlink" title="3ã€HTTPS è¯·æ±‚æ…¢çš„è§£å†³åŠæ³•"></a>3ã€HTTPS è¯·æ±‚æ…¢çš„è§£å†³åŠæ³•</h3><h4 id="1ã€ä¸é€šè¿‡DNSè§£æï¼Œç›´æ¥è®¿é—®IP"><a href="#1ã€ä¸é€šè¿‡DNSè§£æï¼Œç›´æ¥è®¿é—®IP" class="headerlink" title="1ã€ä¸é€šè¿‡DNSè§£æï¼Œç›´æ¥è®¿é—®IP"></a>1ã€ä¸é€šè¿‡DNSè§£æï¼Œç›´æ¥è®¿é—®IP</h4><p>ç»è¿‡ DNS çš„è§£æï¼Œå¿…ç„¶ä¼šå¢åŠ ä¸€äº›æ—¶é•¿ï¼Œå¦‚æœå†å‡ºç°è¯¸å¦‚ <strong>DNS æ±¡æŸ“</strong>ç­‰æƒ…å†µï¼Œåˆ™ä¼šç›´æ¥å¯¼è‡´æ— æ³•è®¿é—®åˆ°ç›®æ ‡ä¸»æœºã€‚</p><h4 id="2ã€è§£å†³è¿æ¥æ— æ³•å¤ç”¨"><a href="#2ã€è§£å†³è¿æ¥æ— æ³•å¤ç”¨" class="headerlink" title="2ã€è§£å†³è¿æ¥æ— æ³•å¤ç”¨"></a>2ã€è§£å†³è¿æ¥æ— æ³•å¤ç”¨</h4><p>HTTP1.0 åè®®å¤´é‡Œå¯ä»¥è®¾ç½®<code>Connection:Keep-Alive</code>æˆ–è€…<code>Connection:Close</code>ï¼Œé€‰æ‹©æ˜¯å¦å…è®¸åœ¨ä¸€å®šæ—¶é—´å†…å¤ç”¨è¿æ¥ï¼ˆæ—¶é—´å¯ç”±æœåŠ¡å™¨æ§åˆ¶ï¼‰ã€‚ä½†æ˜¯è¿™å¯¹ App ç«¯çš„è¯·æ±‚æˆæ•ˆä¸å¤§ï¼Œå› ä¸º App ç«¯çš„è¯·æ±‚æ¯”è¾ƒåˆ†æ•£ä¸”æ—¶é—´è·¨åº¦ç›¸å¯¹è¾ƒå¤§ã€‚</p><h5 id="æ–¹æ¡ˆ1-åŸºäºtcpçš„é•¿è¿æ¥-ä¸»è¦ï¼‰"><a href="#æ–¹æ¡ˆ1-åŸºäºtcpçš„é•¿è¿æ¥-ä¸»è¦ï¼‰" class="headerlink" title="æ–¹æ¡ˆ1. åŸºäºtcpçš„é•¿è¿æ¥ (ä¸»è¦ï¼‰"></a>æ–¹æ¡ˆ1. åŸºäºtcpçš„é•¿è¿æ¥ (ä¸»è¦ï¼‰</h5><p>ç§»åŠ¨ç«¯å»ºç«‹ä¸€æ¡è‡ªå·±çš„<strong>é•¿é“¾æ¥é€šé“</strong>ï¼Œé€šé“çš„å®ç°æ˜¯åŸºäº TCP åè®®ã€‚åŸºäº TCP çš„ Socket ç¼–ç¨‹æŠ€æœ¯éš¾åº¦ç›¸å¯¹å¤æ‚å¾ˆå¤šï¼Œè€Œä¸”éœ€è¦è‡ªå·±å®šåˆ¶åè®®ã€‚ä½†ä¿¡æ¯çš„ä¸ŠæŠ¥å’Œæ¨é€å˜å¾—æ›´åŠæ—¶ï¼Œè¯·æ±‚é‡çˆ†å‘çš„æ—¶é—´ç‚¹è¿˜èƒ½å‡è½»æœåŠ¡å™¨å‹åŠ›ï¼ˆé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥ï¼‰ã€‚</p><h5 id="æ–¹æ¡ˆ2-HTTP-LONG-POLLING"><a href="#æ–¹æ¡ˆ2-HTTP-LONG-POLLING" class="headerlink" title="æ–¹æ¡ˆ2. HTTP LONG-POLLING"></a>æ–¹æ¡ˆ2. HTTP LONG-POLLING</h5><p>å®¢æˆ·ç«¯åœ¨åˆå§‹çŠ¶æ€å‘é€ä¸€ä¸ª POLLING è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¹¶ä¸ä¼šé©¬ä¸Šè¿”å›ä¸šåŠ¡æ•°æ®ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰æ–°çš„ä¸šåŠ¡æ•°æ®äº§ç”Ÿçš„æ—¶å€™å†è¿”å›ï¼Œæ‰€ä»¥é“¾æ¥ä¼šä¸€ç›´è¢«ä¿æŒã€‚ä¸€ä½†ç»“æŸå½“å‰è¿æ¥ï¼Œé©¬ä¸Šåˆä¼šå‘é€ä¸€ä¸ªæ–°çš„ POLLING è¯·æ±‚ï¼Œå¦‚æ­¤åå¤ï¼Œä¿è¯ä¸€ä¸ªè¿æ¥è¢«ä¿æŒã€‚</p><p>ä½†è¿™ç§æ–¹æ³•ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ol><li>å¢åŠ äº†æœåŠ¡å™¨çš„å‹åŠ›</li><li>ç½‘ç»œç¯å¢ƒå¤æ‚åœºæ™¯ä¸‹ï¼Œéœ€è¦è€ƒè™‘æ€ä¹ˆé‡å»ºå¥åº·çš„è¿æ¥é€šé“</li><li>POLLING çš„æ–¹å¼ç¨³å®šæ€§ä¸å¥½</li><li>POLLING çš„r esponse å¯èƒ½ä¼šè¢«ä¸­é—´ä»£ç†ç¼“å­˜</li></ol><h5 id="æ–¹æ¡ˆ3-HTTP-Streaming"><a href="#æ–¹æ¡ˆ3-HTTP-Streaming" class="headerlink" title="æ–¹æ¡ˆ3. HTTP Streaming"></a>æ–¹æ¡ˆ3. HTTP Streaming</h5><p>å’Œ LONG-POLLING ä¸åŒçš„æ˜¯ï¼ŒStreaming æ–¹å¼é€šè¿‡åœ¨ server response çš„å¤´éƒ¨å¢åŠ <code>Transfer Encoding:chuncked</code>æ¥å‘Šè¯‰å®¢æˆ·ç«¯åç»­è¿˜æœ‰æ–°çš„æ•°æ®åˆ°æ¥ã€‚</p><p>å®ƒä¹Ÿå­˜åœ¨é—®é¢˜ï¼š</p><ol><li>æœ‰äº›ä»£ç†æœåŠ¡å™¨ä¼šç­‰å¾…æœåŠ¡å™¨çš„ response ç»“æŸä¹‹åæ‰å°†ç»“æœæ¨é€ç»™è¯·æ±‚å®¢æˆ·ç«¯ã€‚Streaming ä¸ä¼šç»“æŸ responseã€‚</li><li>ä¸šåŠ¡æ•°æ®æ— æ³•æŒ‰ç…§è¯·æ±‚åˆ†å‰²</li></ol><h5 id="æ–¹æ¡ˆ4-WebSocket"><a href="#æ–¹æ¡ˆ4-WebSocket" class="headerlink" title="æ–¹æ¡ˆ4. WebSocket"></a>æ–¹æ¡ˆ4. WebSocket</h5><p>å’Œä¼ ç»Ÿçš„ TCPSocketç›¸ä¼¼ï¼ŒåŸºäº TCP åè®®ï¼Œæä¾›åŒå‘çš„æ•°æ®é€šé“ã€‚å®ƒçš„ä¼˜åŠ¿æ˜¯æä¾›äº† message çš„æ¦‚å¿µï¼Œæ¯”åŸºäºå­—èŠ‚æµçš„TCPSocketä½¿ç”¨æ›´ç®€å•ã€‚æŠ€æœ¯è¾ƒæ–°ï¼Œä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æä¾›äº†æ”¯æŒã€‚</p><h4 id="3ã€è§£å†³head-of-line-blocking"><a href="#3ã€è§£å†³head-of-line-blocking" class="headerlink" title="3ã€è§£å†³head of line blocking"></a>3ã€è§£å†³head of line blocking</h4><p>å®ƒçš„åŸå› æ˜¯é˜Ÿåˆ—çš„<strong>ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆé˜Ÿå¤´ï¼‰å—é˜»</strong>è€Œå¯¼è‡´æ•´åˆ—æ•°æ®åŒ…å—é˜»ã€‚</p><p>ä½¿ç”¨<strong>http pipelining</strong>ï¼Œç¡®ä¿å‡ ä¹åœ¨åŒä¸€æ—¶é—´æŠŠ request å‘å‘äº†æœåŠ¡å™¨</p><h3 id="4ã€HTTPçš„requestå’Œresponseçš„åè®®ç»„æˆ"><a href="#4ã€HTTPçš„requestå’Œresponseçš„åè®®ç»„æˆ" class="headerlink" title="4ã€HTTPçš„requestå’Œresponseçš„åè®®ç»„æˆ"></a>4ã€HTTPçš„requestå’Œresponseçš„åè®®ç»„æˆ</h3><h4 id="1ã€Request"><a href="#1ã€Request" class="headerlink" title="1ã€Request"></a>1ã€Request</h4><p>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯æ ¼å¼ï¼š</p><blockquote><p>è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰+ è¯·æ±‚å¤´éƒ¨ï¼ˆrequest header fieldsï¼‰+ ç©ºè¡Œ + è¯·æ±‚æ•°æ®ï¼ˆå¯é€‰ï¼‰ã€‚</p></blockquote><p>å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code>GET /test.jpg HTTP/1.1Host: img.example.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTMLï¼Œ like Gecko) Chrome/51.0.2704.106 Safari/537.36Accept: image/webpï¼Œimage/*ï¼Œ*/*;q=0.8Referer: http://www.example.com/Accept-Encoding: gzipï¼Œ deflateï¼Œ sdchts=1598909872</code></pre><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šè¯·æ±‚è¡Œï¼Œ<strong>ç”¨æ¥è¯´æ˜è¯·æ±‚ç±»å‹</strong>ï¼Œè¦è®¿é—®çš„èµ„æºä»¥åŠæ‰€ä½¿ç”¨çš„HTTPç‰ˆæœ¬ã€‚è¯·æ±‚è¡Œä»¥ä¸€ä¸ªæ–¹æ³•ç¬¦å·å¼€å¤´ï¼Œä»¥ç©ºæ ¼åˆ†å¼€ï¼Œåé¢è·Ÿç€è¯·æ±‚çš„URIå’Œåè®®çš„ç‰ˆæœ¬ã€‚å¸¸è§çš„è¯·æ±‚ç±»å‹æœ‰<code>GET</code>ã€<code>POST</code>ã€<code>PUT</code>ã€<code>DELETE</code>ã€<code>OPTIONS</code>ã€<code>HEAD</code>ã€<code>TRACE</code>ã€<code>CONNECT</code>ã€<code>PATCH</code>ç­‰ã€‚<br>ä¸Šä¾‹ä¸­çš„<code>GET</code>è¯´æ˜è¯·æ±‚ç±»å‹ä¸ºGETï¼Œ<code>/test.jpg</code>ä¸ºè¦è®¿é—®çš„èµ„æºï¼Œè¯¥è¡Œçš„æœ€åä¸€éƒ¨åˆ†è¯´æ˜ä½¿ç”¨çš„æ˜¯ HTTP1.1 ç‰ˆæœ¬ã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼šè¯·æ±‚å¤´éƒ¨ï¼Œç´§æ¥ç€è¯·æ±‚è¡Œä¹‹åçš„éƒ¨åˆ†ï¼Œç”¨æ¥è¯´æ˜æœåŠ¡å™¨è¦ä½¿ç”¨çš„é™„åŠ ä¿¡æ¯ã€‚<br>ä»ç¬¬äºŒè¡Œèµ·ä¸ºè¯·æ±‚å¤´éƒ¨ï¼ŒHOST å°†æŒ‡å‡ºè¯·æ±‚çš„ç›®çš„åœ°ã€‚User-Agentï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è„šæœ¬éƒ½èƒ½è®¿é—®å®ƒï¼Œå®ƒæ˜¯æµè§ˆå™¨ç±»å‹æ£€æµ‹é€»è¾‘çš„é‡è¦åŸºç¡€ã€‚è¯¥ä¿¡æ¯ç”±ä½ çš„æµè§ˆå™¨æ¥å®šä¹‰ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªè¯·æ±‚ä¸­è‡ªåŠ¨å‘é€ã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šç©ºè¡Œï¼Œè¯·æ±‚å¤´éƒ¨åé¢çš„ç©ºè¡Œæ˜¯å¿…é¡»çš„ã€‚ç©ºè¡Œåªèƒ½åŒ…æ‹¬<code>&lt;CR&gt;&lt;LF&gt;</code>ï¼Œå¹¶ä¸”ä¸èƒ½æœ‰ç©ºæ ¼ç¬¦ã€‚<br><strong>å³ä½¿ç¬¬å››éƒ¨åˆ†çš„è¯·æ±‚æ•°æ®ä¸ºç©ºï¼Œä¹Ÿå¿…é¡»æœ‰ç©ºè¡Œã€‚</strong></p><p>ç¬¬å››éƒ¨åˆ†ï¼šè¯·æ±‚æ•°æ®ï¼Œä¹Ÿå«ä¸»ä½“ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„å…¶ä»–æ•°æ®ã€‚</p><h4 id="2ã€Responseç»„æˆ"><a href="#2ã€Responseç»„æˆ" class="headerlink" title="2ã€Responseç»„æˆ"></a>2ã€Responseç»„æˆ</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚åä¼šè¿”å›ä¸€ä¸ªHTTPçš„å“åº”æ¶ˆæ¯ã€‚</p><p>HTTPå“åº”ä¹Ÿç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š</p><blockquote><p>çŠ¶æ€è¡Œï¼ˆstatus line) + æ¶ˆæ¯æŠ¥å¤´ï¼ˆresponse header fieldsï¼‰ + ç©ºè¡Œ + å“åº”æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ã€‚</p></blockquote><p>å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code>HTTP/1.1 200 OKDate: Mon, 23 May 2005 22:38:34 GMTContent-Type: text/html; charset=UTF-8Content-Length: 155Last-Modified: Wed, 08 Jan 2003 23:11:55 GMTServer: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)ETag: &quot;3f80f-1b6-3e1cb03b&quot;Accept-Ranges: bytesConnection: close&lt;html&gt;  &lt;head&gt;    &lt;title&gt;An Example Page&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;p&gt;Hello World, this is a very simple HTML document.&lt;/p&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šçŠ¶æ€è¡Œï¼Œç”± HTTP åè®®ç‰ˆæœ¬å·ï¼ŒçŠ¶æ€ç ï¼ŒçŠ¶æ€æ¶ˆæ¯ä¸‰éƒ¨åˆ†ç»„æˆã€‚<br>ä¸Šä¾‹ä¸­ç¬¬1è¡Œä¸ºçŠ¶æ€è¡Œï¼Œ<code>HTTP/1.1</code>è¡¨æ˜ HTTP ç‰ˆæœ¬ä¸º 1.1 ç‰ˆæœ¬ï¼ŒçŠ¶æ€ç ä¸º<code>200</code>ï¼ŒçŠ¶æ€æ¶ˆæ¯ä¸º<code>OK</code>ã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼šæ¶ˆæ¯æŠ¥å¤´ï¼Œç”¨æ¥è¯´æ˜å®¢æˆ·ç«¯è¦ä½¿ç”¨çš„ä¸€äº›é™„åŠ ä¿¡æ¯ã€‚<br>ä¸Šä¾‹ä¸­ç¬¬2-9è¡Œä¸ºæ¶ˆæ¯æŠ¥å¤´ã€‚å¦‚<code>Content-Type</code>æŒ‡å®šäº† MIME ç±»å‹çš„ HTML<code>text/html</code>ï¼Œç¼–ç ç±»å‹æ˜¯<code>UTF-8</code>ã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šç©ºè¡Œï¼Œæ¶ˆæ¯æŠ¥å¤´åé¢çš„ç©ºè¡Œæ˜¯å¿…é¡»çš„ã€‚ç©ºè¡Œåªèƒ½åŒ…æ‹¬<code>&lt;CR&gt;&lt;LF&gt;</code>ï¼Œå¹¶ä¸”ä¸èƒ½æœ‰ç©ºæ ¼ç¬¦ã€‚</p><p>ç¬¬å››éƒ¨åˆ†ï¼šå“åº”æ­£æ–‡ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„æ–‡æœ¬ä¿¡æ¯ã€‚<br>ä¸Šä¾‹ä¸­ä»ç¬¬11è¡Œå¼€å§‹çš„éƒ¨åˆ†ä¸ºå“åº”æ­£æ–‡ã€‚</p><p><a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">äº†è§£æ›´å¤šä¼ é€é—¨</a></p><h3 id="5ã€è°ˆè°ˆå¯¹-HTTP-ç¼“å­˜çš„äº†è§£"><a href="#5ã€è°ˆè°ˆå¯¹-HTTP-ç¼“å­˜çš„äº†è§£" class="headerlink" title="5ã€è°ˆè°ˆå¯¹ HTTP ç¼“å­˜çš„äº†è§£"></a>5ã€è°ˆè°ˆå¯¹ HTTP ç¼“å­˜çš„äº†è§£</h3><p>HTTP çš„ç¼“å­˜æœºåˆ¶ä¹Ÿæ˜¯ä¾èµ–äº Request/Response Header Fields é‡Œçš„å‚æ•°æ¥å®ç°çš„ï¼Œå®ƒå†³å®šæœ€ç»ˆå“åº”<strong>æ˜¯ä»ç¼“å­˜ä¸­å–</strong>ï¼Œ<strong>è¿˜æ˜¯ä»æœåŠ¡ç«¯é‡æ–°æ‹‰å–</strong>ï¼ŒHTTP çš„ç¼“å­˜æœºåˆ¶çš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://blog.cigis-cloud.com/aaji-1591232610.png" alt="HTTP ç¼“å­˜æœºåˆ¶"></p><p>HTTP çš„ç¼“å­˜å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><strong>å¼ºåˆ¶ç¼“å­˜ï¼š</strong> éœ€è¦æœåŠ¡ç«¯å‚ä¸åˆ¤æ–­æ˜¯å¦ç»§ç»­ä½¿ç”¨ç¼“å­˜ï¼Œå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›äº†ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼ˆExpires ä¸ Cache-Controlï¼‰ï¼Œæ²¡æœ‰è¿‡æœŸå°±å¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜ï¼Œå¦åˆ™åˆ™ä¸é€‚ç”¨ï¼Œæ— éœ€å†å‘æœåŠ¡ç«¯è¯¢é—®ã€‚</li><li><strong>å¯¹æ¯”ç¼“å­˜ï¼š</strong> éœ€è¦æœåŠ¡ç«¯å‚ä¸åˆ¤æ–­æ˜¯å¦ç»§ç»­ä½¿ç”¨ç¼“å­˜ï¼Œå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†ç¼“å­˜æ ‡è¯†ï¼ˆLast-Modified/If-Modified-Since ä¸ Etag/If-None-Matchï¼‰ä¸æ•°æ®ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†ä¸¤è€…éƒ½å¤‡ä»½åˆ°ç¼“å­˜ä¸­ï¼Œå†æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä¸Šæ¬¡å¤‡ä»½çš„ç¼“å­˜æ ‡è¯†å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¹æ®ç¼“å­˜æ ‡è¯†è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¿”å›<code>304</code>ï¼Œåˆ™è¡¨ç¤ºé€šçŸ¥å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜ã€‚<br>å¼ºåˆ¶ç¼“å­˜ä¼˜å…ˆäºå¯¹æ¯”ç¼“å­˜ã€‚</li></ul><p>ä¸Šé¢æåˆ°å¼ºåˆ¶ç¼“å­˜ä½¿ç”¨çš„çš„ä¸¤ä¸ªæ ‡è¯†ï¼š</p><ul><li><strong>Expiresï¼š</strong> Expires å¯ä»¥é€šä¿—åœ°è§£é‡Šä¸º<strong>ç¼“å­˜åˆ°æœŸæ—¶é—´</strong>ã€‚å³å®¢æˆ·ç«¯é¦–æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè®°å½•ä¸‹ Expires å€¼ï¼›å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œå¦‚æœè¯·æ±‚æ—¶é—´å°äºæœåŠ¡ç«¯è¿”å›çš„åˆ°æœŸæ—¶é—´ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œå¦åˆ™ä½¿ç”¨æœåŠ¡ç«¯è¿”å›çš„æ•°æ®ã€‚Expires æ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ï¼Œåœ¨ä½¿ç”¨æ—¶è¦æ³¨æ„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ—¶é—´è¯¯å·®ã€‚</li><li><strong>Cache-Controlï¼š</strong> ç”±äºä¸Šé¢çš„ Expires æœ‰ä¸ªæ—¶é—´æ ¡éªŒçš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ HTTP1.1 ä¸­é‡‡ç”¨äº† Cache-Control æ›¿ä»£ Expiresã€‚å®ƒçš„å–å€¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š<ul><li><code>private</code>: å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜</li><li><code>public</code>: å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ç¼“å­˜</li><li><code>max-age=xxx</code>: ç¼“å­˜çš„å†…å®¹å°†åœ¨ xxx ç§’åå¤±æ•ˆ</li><li><code>no-cache</code>: éœ€è¦ä½¿ç”¨å¯¹æ¯”ç¼“å­˜æ¥éªŒè¯ç¼“å­˜æ•°æ®</li><li><code>no-store</code>: æ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šç¼“å­˜ï¼Œå¼ºåˆ¶ç¼“å­˜ï¼Œå¯¹æ¯”ç¼“å­˜éƒ½ä¸ä¼šè§¦å‘</li></ul></li></ul><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å¯¹æ¯”ç¼“å­˜çš„ä¸¤ä¸ªæ ‡è¯† Last-Modified å’Œ If-Modified-Sinceï¼š</p><p>Last-Modified è¡¨ç¤ºèµ„æºä¸Šæ¬¡ä¿®æ”¹çš„æ—¶é—´ã€‚å½“å®¢æˆ·ç«¯é¦–æ¬¡å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›èµ„æºä¸Šæ¬¡ä¿®æ”¹çš„æ—¶é—´ï¼š</p><pre><code>Last-Modified: Tue, 12 Jan 2016 09:31:27 GMT</code></pre><p>å®¢æˆ·ç«¯å†æ¬¡å‘é€ï¼Œä¼šåœ¨ header fields é‡Œæºå¸¦<code>If-Modified-Since</code>ã€‚å°†ä¸Šæ¬¡æœåŠ¡ç«¯è¿”å›çš„èµ„æºæ—¶é—´ä¸Šä¼ ç»™æœåŠ¡ç«¯ã€‚</p><pre><code>If-Modified-Since: Tue, 12 Jan 2016 09:31:27 GMT</code></pre><p>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„èµ„æºä¿®æ”¹æ—¶é—´ï¼Œä¸è‡ªå·±å½“å‰çš„èµ„æºä¿®æ”¹æ—¶é—´è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœè‡ªå·±çš„èµ„æºä¿®æ”¹æ—¶é—´å¤§äºå®¢æˆ·ç«¯å‘æ¥çš„èµ„æºä¿®æ”¹æ—¶é—´ï¼Œåˆ™è¯´æ˜èµ„æºåšè¿‡ä¿®æ”¹ï¼Œ åˆ™è¿”å›<code>200</code>è¡¨ç¤ºéœ€è¦é‡æ–°è¯·æ±‚èµ„æºï¼Œå¦åˆ™è¿”å›<code>304</code>è¡¨ç¤ºèµ„æºæ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜ã€‚</p><p>ä¸Šé¢æ˜¯ä¸€ç§<strong>æ—¶é—´æˆ³æ ‡è®°èµ„æºæ˜¯å¦ä¿®æ”¹</strong>çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§<strong>èµ„æºæ ‡è¯†ç  ETag</strong> çš„æ–¹å¼æ¥æ ‡è®°æ˜¯å¦ä¿®æ”¹ï¼Œå¦‚æœæ ‡è¯†ç å‘ç”Ÿæ”¹å˜ï¼Œåˆ™è¯´æ˜èµ„æºå·²ç»è¢«ä¿®æ”¹ï¼Œ<strong>ETag ä¼˜å…ˆçº§é«˜äº Last-Modified</strong>ã€‚</p><p>ETag æ˜¯èµ„æºæ–‡ä»¶çš„ä¸€ç§æ ‡è¯†ç ï¼Œå½“å®¢æˆ·ç«¯é¦–æ¬¡å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›å½“å‰èµ„æºçš„æ ‡è¯†ç ï¼š</p><pre><code>ETag: &quot;5694c7ef-24dc&quot;</code></pre><p>å®¢æˆ·ç«¯å†æ¬¡å‘é€ï¼Œä¼šåœ¨ header fields é‡Œæºå¸¦ä¸Šæ¬¡æœåŠ¡ç«¯è¿”å›çš„èµ„æºæ ‡è¯†ç ï¼š</p><pre><code>If-None-Match:&quot;5694c7ef-24dc&quot;</code></pre><p>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„èµ„æºæ ‡è¯†ç ï¼Œåˆ™ä¼šä¸è‡ªå·±å½“å‰çš„èµ„æºç è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸åŒï¼Œåˆ™è¯´æ˜èµ„æºå·²ç»è¢«ä¿®æ”¹ï¼Œåˆ™è¿”å›<code>200</code>ï¼Œå¦‚æœç›¸åŒåˆ™è¯´æ˜èµ„æºæ²¡æœ‰è¢«ä¿®æ”¹ï¼Œè¿”å›<code>304</code>ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜ã€‚</p><h3 id="6ã€HTTPé•¿è¿æ¥ã€‚"><a href="#6ã€HTTPé•¿è¿æ¥ã€‚" class="headerlink" title="6ã€HTTPé•¿è¿æ¥ã€‚"></a>6ã€HTTPé•¿è¿æ¥ã€‚</h3><p>HTTP1.0 æ˜¯çŸ­è¿æ¥ï¼ŒHTTP1.1 é»˜è®¤æ˜¯é•¿è¿æ¥ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤ Connection çš„å€¼å°±æ˜¯<code>keep-alive</code>ã€‚ä½†æ˜¯é•¿è¿æ¥å®è´¨æ˜¯æŒ‡çš„ TCP è¿æ¥ï¼Œè€Œä¸æ˜¯HTTP è¿æ¥ï¼Œæ¯•ç«Ÿ HTTP æ˜¯åº”ç”¨å±‚åè®®ï¼ˆç¬¬7å±‚ï¼‰ï¼ŒTCP æ˜¯ä¼ è¾“å±‚åè®®ï¼ˆç¬¬4å±‚ï¼‰ã€‚TCP è¿æ¥æ˜¯ä¸€ä¸ªåŒå‘çš„é€šé“ï¼Œå®ƒæ˜¯å¯ä»¥ä¿æŒä¸€æ®µæ—¶é—´ä¸å…³é—­çš„ï¼Œå› æ­¤å®é™…ä¸Šæˆ‘ä»¬å¸¸è¯´çš„ã€HTTP é•¿è¿æ¥ã€æŒ‡çš„æ˜¯ã€TCP é•¿è¿æ¥ã€ã€‚</p><h4 id="HTTP1-1-ä¸ºä»€ä¹ˆè¦ç”¨ä½¿ç”¨-TCP-é•¿è¿æ¥ï¼Ÿ"><a href="#HTTP1-1-ä¸ºä»€ä¹ˆè¦ç”¨ä½¿ç”¨-TCP-é•¿è¿æ¥ï¼Ÿ" class="headerlink" title="HTTP1.1 ä¸ºä»€ä¹ˆè¦ç”¨ä½¿ç”¨ TCP é•¿è¿æ¥ï¼Ÿ"></a>HTTP1.1 ä¸ºä»€ä¹ˆè¦ç”¨ä½¿ç”¨ TCP é•¿è¿æ¥ï¼Ÿ</h4><p><strong>TCP é•¿è¿æ¥å¯ä»¥å¤ç”¨</strong>ã€‚å³é•¿è¿æ¥æƒ…å†µä¸‹ï¼Œå¤šä¸ª HTTP è¯·æ±‚å¯ä»¥å¤ç”¨åŒä¸€ä¸ª TCP è¿æ¥ï¼Œè¿™å°±<strong>èŠ‚çœäº†å¾ˆå¤š TCP è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„æ¶ˆè€—ã€‚</strong></p><p>æ­¤å¤–ï¼Œé•¿è¿æ¥å¹¶ä¸æ˜¯æ°¸ä¹…è¿æ¥çš„ã€‚å¦‚æœä¸€æ®µæ—¶é—´å†…ï¼ˆå…·ä½“çš„æ—¶é—´é•¿çŸ­ï¼Œæ˜¯å¯ä»¥åœ¨headerå½“ä¸­è¿›è¡Œè®¾ç½®çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„è¶…æ—¶æ—¶é—´ï¼‰ï¼Œè¿™ä¸ªè¿æ¥æ²¡æœ‰HTTP è¯·æ±‚å‘å‡ºçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé•¿è¿æ¥å°±ä¼šè¢«æ–­æ‰ã€‚</p><p><a href="https://www.jianshu.com/p/3fc3646fad80">éœ€è¦æ›´æ·±çš„ç†è§£è¯·ç‚¹å‡»è¿™é‡Œ</a></p><h3 id="7ã€HTTPS-åŠ å¯†åŸç†ã€‚"><a href="#7ã€HTTPS-åŠ å¯†åŸç†ã€‚" class="headerlink" title="7ã€HTTPS åŠ å¯†åŸç†ã€‚"></a>7ã€HTTPS åŠ å¯†åŸç†ã€‚</h3><p>åŠ å¯†ç®—æ³•çš„ç±»å‹åŸºæœ¬ä¸Šåˆ†ä¸ºäº†ä¸¤ç§ï¼š</p><ul><li><strong>å¯¹ç§°åŠ å¯†</strong>ã€‚åŠ å¯†ç”¨çš„å¯†é’¥å’Œè§£å¯†ç”¨çš„å¯†é’¥æ˜¯åŒä¸€ä¸ªï¼Œæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„å°±æ˜¯ AES åŠ å¯†ç®—æ³•ï¼›å…¶å®ƒå¸¸è§çš„è¿˜æœ‰ DESã€RC4ã€RC5 ç­‰ã€‚</li><li><strong>éå¯¹ç§°åŠ å¯†</strong>ã€‚åŠ å¯†ç”¨çš„å¯†é’¥ç§°ä¸º<strong>å…¬é’¥</strong>ï¼Œè§£å¯†ç”¨çš„å¯†é’¥ç§°ä¸º<strong>ç§é’¥</strong>ï¼Œç»å¸¸ä½¿ç”¨åˆ°çš„ RSA åŠ å¯†ç®—æ³•å°±æ˜¯éå¯¹ç§°åŠ å¯†çš„ã€‚</li></ul><p>æ­¤å¤–ï¼Œè¿˜æœ‰HashåŠ å¯†ç®—æ³•</p><p>HASHç®—æ³•ï¼šMD5ï¼Œ SHA1ï¼Œ SHA256</p><p>ç›¸æ¯”è¾ƒå¯¹ç§°åŠ å¯†è€Œè¨€ï¼Œéå¯¹ç§°åŠ å¯†<strong>å®‰å…¨æ€§æ›´é«˜</strong>ï¼Œä½†æ˜¯<strong>åŠ è§£å¯†è€—è´¹çš„æ—¶é—´æ›´é•¿</strong>ï¼Œé€Ÿåº¦æ…¢ã€‚</p><p><a href="https://juejin.im/post/5b48b0d7e51d4519962ea383#heading-23">æƒ³äº†è§£æ›´å¤šåŠ å¯†ç®—æ³•è¯·ç‚¹å‡»è¿™é‡Œ</a></p><p>HTTPS = HTTP + SSLï¼ŒHTTPS çš„åŠ å¯†å°±æ˜¯åœ¨ SSL å±‚ä¸­å®Œæˆçš„ã€‚</p><p>è¿™å°±è¦ä» CA è¯ä¹¦è®²èµ·äº†ã€‚CA è¯ä¹¦å…¶å®å°±æ˜¯æ•°å­—è¯ä¹¦ï¼Œæ˜¯ç”± CA æœºæ„é¢å‘çš„ã€‚è‡³äº CA æœºæ„çš„æƒå¨æ€§ï¼Œé‚£ä¹ˆæ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œæ‰€æœ‰äººéƒ½æ˜¯ä¿¡ä»»å®ƒçš„ã€‚CA è¯ä¹¦å†…ä¸€èˆ¬ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è¯ä¹¦çš„é¢å‘æœºæ„ã€ç‰ˆæœ¬</li><li>è¯ä¹¦çš„ä½¿ç”¨è€…</li><li>è¯ä¹¦çš„å…¬é’¥</li><li>è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´</li><li>è¯ä¹¦çš„æ•°å­—ç­¾å Hash å€¼å’Œç­¾å Hash ç®—æ³•</li><li>â€¦</li></ul><h4 id="å®¢æˆ·ç«¯å¦‚ä½•æ ¡éªŒ-CA-è¯ä¹¦ï¼Ÿ"><a href="#å®¢æˆ·ç«¯å¦‚ä½•æ ¡éªŒ-CA-è¯ä¹¦ï¼Ÿ" class="headerlink" title="å®¢æˆ·ç«¯å¦‚ä½•æ ¡éªŒ CA è¯ä¹¦ï¼Ÿ"></a>å®¢æˆ·ç«¯å¦‚ä½•æ ¡éªŒ CA è¯ä¹¦ï¼Ÿ</h4><p>CA è¯ä¹¦ä¸­çš„ Hash å€¼ï¼Œå…¶å®æ˜¯ç”¨è¯ä¹¦çš„ç§é’¥è¿›è¡ŒåŠ å¯†åçš„å€¼ï¼ˆè¯ä¹¦çš„ç§é’¥ä¸åœ¨ CA è¯ä¹¦ä¸­ï¼‰ã€‚ç„¶åå®¢æˆ·ç«¯å¾—åˆ°è¯ä¹¦åï¼Œåˆ©ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥å»è§£å¯†è¯¥ Hash å€¼ï¼Œå¾—åˆ° Hash-a ï¼›ç„¶åå†åˆ©ç”¨è¯ä¹¦å†…çš„ç­¾å Hash ç®—æ³•å»ç”Ÿæˆä¸€ä¸ª Hash-b ã€‚æœ€åæ¯”è¾ƒ Hash-a å’Œ Hash-b è¿™ä¸¤ä¸ªçš„å€¼ã€‚å¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆè¯æ˜äº†è¯¥è¯ä¹¦æ˜¯å¯¹çš„ï¼ŒæœåŠ¡ç«¯æ˜¯å¯ä»¥è¢«ä¿¡ä»»çš„ï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¯¥è¯ä¹¦æ˜¯é”™è¯¯çš„ï¼Œå¯èƒ½è¢«ç¯¡æ”¹äº†ï¼Œæµè§ˆå™¨ä¼šç»™å‡ºç›¸å…³æç¤ºï¼Œæ— æ³•å»ºç«‹èµ· HTTPS è¿æ¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šæ ¡éªŒ CA è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´å’ŒåŸŸååŒ¹é…ç­‰ã€‚</p><h4 id="HTTPS-ä¸­çš„-SSL-æ¡æ‰‹å»ºç«‹è¿‡ç¨‹"><a href="#HTTPS-ä¸­çš„-SSL-æ¡æ‰‹å»ºç«‹è¿‡ç¨‹" class="headerlink" title="HTTPS ä¸­çš„ SSL æ¡æ‰‹å»ºç«‹è¿‡ç¨‹"></a>HTTPS ä¸­çš„ SSL æ¡æ‰‹å»ºç«‹è¿‡ç¨‹</h4><p> å‡è®¾ç°åœ¨æœ‰å®¢æˆ·ç«¯ C å’ŒæœåŠ¡å™¨ S ï¼š</p><ol><li>é¦–å…ˆï¼ŒC è®¿é—® S ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªç½‘é¡µ <a href="http://www.baidu.com/">www.baidu.com</a> ï¼Œè¿™æ—¶ï¼Œæµè§ˆå™¨å°±æ˜¯ C ï¼Œç™¾åº¦çš„æœåŠ¡å™¨å°±æ˜¯ S äº†ã€‚è¿™æ—¶å€™ C ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°<code>1</code>ï¼ŒæŠŠ<strong>éšæœºæ•°<code>1</code><strong>ã€è‡ªå·±</strong>æ”¯æŒçš„ SSL ç‰ˆæœ¬å·</strong>ä»¥åŠ<strong>æ”¯æŒçš„åŠ å¯†ç®—æ³•</strong>ç­‰è¿™äº›ä¿¡æ¯å‘Šè¯‰ S ã€‚</li><li>S çŸ¥é“è¿™äº›ä¿¡æ¯åï¼Œå…ˆç¡®è®¤ä¸€ä¸‹åŒæ–¹çš„åŠ å¯†ç®—æ³•ï¼Œå†ç”Ÿæˆä¸€ä¸ªéšæœºæ•°<code>2</code>ï¼Œå¹¶å°†éšæœºæ•°<code>2</code>å’Œ CA é¢å‘ç»™è‡ªå·±çš„è¯ä¹¦ä¸€åŒè¿”å›ç»™ C ã€‚</li><li>C å¾—åˆ° CA è¯ä¹¦åï¼Œä¼šå»æ ¡éªŒè¯¥ CA è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼ˆæ ¡éªŒæ–¹æ³•åœ¨ä¸Šé¢è¯´è¿‡ï¼‰ï¼Œæ ¡éªŒé€šè¿‡åï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°<code>3</code>ï¼Œç„¶åç”¨è¯ä¹¦ä¸­çš„å…¬é’¥åŠ å¯†éšæœºæ•°<code>3</code>å¹¶ä¼ è¾“ç»™ S ã€‚</li><li>S å¾—åˆ°åŠ å¯†åçš„éšæœºæ•°<code>3</code>ï¼Œç„¶ååˆ©ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°çœŸæ­£çš„éšæœºæ•°<code>3</code>ã€‚</li><li>æœ€åï¼ŒC å’Œ S éƒ½æœ‰éšæœºæ•°<code>1</code>ã€éšæœºæ•°<code>2</code>ã€éšæœºæ•°<code>3</code>ï¼Œç„¶ååŒæ–¹åˆ©ç”¨è¿™ä¸‰ä¸ªéšæœºæ•°ç”Ÿæˆä¸€ä¸ª<strong>å¯¹è¯å¯†é’¥</strong>ã€‚ä¹‹åä¼ è¾“å†…å®¹å°±æ˜¯åˆ©ç”¨å¯¹è¯å¯†é’¥æ¥è¿›è¡ŒåŠ è§£å¯†äº†ã€‚è¿™æ—¶å°±æ˜¯åˆ©ç”¨äº†<strong>å¯¹ç§°åŠ å¯†</strong>ï¼Œä¸€èˆ¬ç”¨çš„éƒ½æ˜¯ AES ç®—æ³•ã€‚</li><li>C é€šçŸ¥ Sï¼ŒæŒ‡æ˜åé¢çš„é€šè®¯ç”¨å¯¹è¯å¯†é’¥æ¥å®Œæˆï¼ŒåŒæ—¶é€šçŸ¥ S å’Œ C çš„æ¡æ‰‹è¿‡ç¨‹ç»“æŸã€‚</li><li>S é€šçŸ¥ Cï¼ŒæŒ‡æ˜åé¢çš„é€šè®¯ç”¨å¯¹è¯å¯†é’¥æ¥å®Œæˆï¼ŒåŒæ—¶é€šçŸ¥ C å’Œ S çš„æ¡æ‰‹è¿‡ç¨‹ç»“æŸã€‚</li><li>SSL çš„æ¡æ‰‹éƒ¨åˆ†ç»“æŸï¼ŒSSL å®‰å…¨é€šé“çš„æ•°æ®é€šè®¯å¼€å§‹ï¼ŒC å’Œ S å¼€å§‹ä½¿ç”¨ç›¸åŒçš„å¯¹è¯å¯†é’¥è¿›è¡Œæ•°æ®é€šè®¯ã€‚</li></ol><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://blog.cigis-cloud.com/aaji-1591239714.jpg" alt="SSL æ¡æ‰‹è¿‡ç¨‹"></p><p>ç®€åŒ–å¦‚ä¸‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹ SSL æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯é€šè¿‡ CA è¯ä¹¦æ¥ç¡®è®¤æœåŠ¡ç«¯çš„èº«ä»½ï¼›</li><li>äº’ç›¸ä¼ é€’ä¸‰ä¸ªéšæœºæ•°ï¼Œä¹‹åé€šè¿‡è¿™éšæœºæ•°æ¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼›</li><li>äº’ç›¸ç¡®è®¤å¯†é’¥ï¼Œç„¶åæ¡æ‰‹ç»“æŸï¼›</li><li>æ•°æ®é€šè®¯å¼€å§‹ï¼Œéƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯¹è¯å¯†é’¥æ¥åŠ è§£å¯†ï¼›</li></ol><p>å¯ä»¥å‘ç°ï¼Œåœ¨ HTTPS åŠ å¯†åŸç†çš„è¿‡ç¨‹ä¸­æŠŠå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†éƒ½åˆ©ç”¨äº†èµ·æ¥ã€‚å³åˆ©ç”¨äº†éå¯¹ç§°åŠ å¯†å®‰å…¨æ€§é«˜çš„ç‰¹ç‚¹ï¼Œåˆåˆ©ç”¨äº†å¯¹ç§°åŠ å¯†é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜çš„å¥½å¤„ã€‚</p><p><a href="https://juejin.im/entry/5a9ac15bf265da239e4d8831#comment">éœ€è¦æ›´æ·±çš„ç†è§£è¯·ç‚¹å‡»è¿™é‡Œ</a></p><h3 id="8ã€HTTPS-å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ"><a href="#8ã€HTTPS-å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ" class="headerlink" title="8ã€HTTPS å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ"></a>8ã€HTTPS å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ</h3><h4 id="ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿ</h4><p>å½“æ•°æ®ä¼ è¾“å‘ç”Ÿåœ¨ä¸€ä¸ªè®¾å¤‡ï¼ˆPC/æ‰‹æœºï¼‰å’Œç½‘ç»œæœåŠ¡å™¨ä¹‹é—´æ—¶ï¼Œæ”»å‡»è€…ä½¿ç”¨å…¶æŠ€èƒ½å’Œå·¥å…·å°†è‡ªå·±ç½®äºä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´å¹¶æˆªè·æ•°æ®ï¼›å°½ç®¡äº¤è°ˆçš„ä¸¤æ–¹è®¤ä¸ºä»–ä»¬æ˜¯åœ¨ä¸å¯¹æ–¹äº¤è°ˆï¼Œä½†æ˜¯å®é™…ä¸Šä»–ä»¬æ˜¯åœ¨ä¸å¹²åäº‹çš„äººäº¤æµï¼Œè¿™ä¾¿æ˜¯ä¸­é—´äººæ”»å‡»ã€‚ä¸­é—´äººæ”»å‡»æ˜¯åœ¨è¿è¡Œåœ¨ HTTP åè®®ä¸­çš„ç½‘ç»œä¼ è¾“ä¸­å¸¸è§çš„æ”»å‡»æ‰‹æ®µï¼Œè¿™ç§æ‰‹æ®µåœ¨ HTTP åè®®ä¸­æ— æ³•é˜²å¾¡ï¼Œå› ä¸º C/S åŒæ–¹éƒ½æ— æ³•ç¡®è®¤å¯¹æ–¹çš„èº«ä»½ã€‚</p><h4 id="ä¸­é—´äººæ”»å‡»æœ‰å‡ ç§æ”»å‡»æ–¹å¼ï¼Ÿ"><a href="#ä¸­é—´äººæ”»å‡»æœ‰å‡ ç§æ”»å‡»æ–¹å¼ï¼Ÿ" class="headerlink" title="ä¸­é—´äººæ”»å‡»æœ‰å‡ ç§æ”»å‡»æ–¹å¼ï¼Ÿ"></a>ä¸­é—´äººæ”»å‡»æœ‰å‡ ç§æ”»å‡»æ–¹å¼ï¼Ÿ</h4><ol><li><p><strong>å—…æ¢</strong>ã€‚å—…æ¢æˆ–æ•°æ®åŒ…å—…æ¢æ˜¯ä¸€ç§ç”¨äºæ•è·æµè¿›å’Œæµå‡ºç³»ç»Ÿ/ç½‘ç»œçš„æ•°æ®åŒ…çš„æŠ€æœ¯ã€‚ç½‘ç»œä¸­çš„æ•°æ®åŒ…å—…æ¢å°±å¥½åƒç”µè¯ä¸­çš„ç›‘å¬ã€‚</p></li><li><p><strong>æ•°æ®åŒ…æ³¨å…¥</strong>ã€‚åœ¨è¿™ç§æŠ€æœ¯ä¸­ï¼Œæ”»å‡»è€…ä¼šå°†æ¶æ„æ•°æ®åŒ…æ³¨å…¥å¸¸è§„æ•°æ®ä¸­ã€‚è¿™æ ·ç”¨æˆ·ä¾¿ä¸ä¼šæ³¨æ„åˆ°æ–‡ä»¶/æ¶æ„è½¯ä»¶ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åˆæ³•é€šè®¯æµçš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p><strong>ä¼šè¯åŠ«æŒ</strong>ã€‚åœ¨ä½ ç™»å½•è¿›ä½ çš„é“¶è¡Œè´¦æˆ·å’Œé€€å‡ºç™»å½•è¿™ä¸€æ®µæœŸé—´ä¾¿ç§°ä¸ºä¸€ä¸ªä¼šè¯ã€‚è¿™äº›ä¼šè¯é€šå¸¸éƒ½æ˜¯é»‘å®¢çš„æ”»å‡»ç›®æ ‡ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«æ½œåœ¨çš„é‡è¦ä¿¡æ¯ã€‚åœ¨å¤§å¤šæ•°æ¡ˆä¾‹ä¸­ï¼Œé»‘å®¢ä¼šæ½œä¼åœ¨ä¼šè¯ä¸­ï¼Œå¹¶æœ€ç»ˆæ§åˆ¶å®ƒã€‚</p></li><li><p><strong>SSLå‰¥ç¦»</strong>ã€‚åœ¨ SSL å‰¥ç¦»æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ä½¿ SSL/TLS åè®®å‰¥è½ï¼Œéšä¹‹åè®®ä¾¿ä»å®‰å…¨çš„ HTTPS åè®®å˜æˆäº†ä¸å®‰å…¨çš„ HTTP åè®®ã€‚</p></li></ol><h4 id="HTTPS-å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼š"><a href="#HTTPS-å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼š" class="headerlink" title="HTTPS å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼š"></a>HTTPS å¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼š</h4><p>è¯·è§ HTTPS åŠ å¯†åŸç†ã€‚</p><h3 id="9ã€æœ‰å“ªäº›å“åº”ç ï¼Œåˆ†åˆ«éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#9ã€æœ‰å“ªäº›å“åº”ç ï¼Œåˆ†åˆ«éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="9ã€æœ‰å“ªäº›å“åº”ç ï¼Œåˆ†åˆ«éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>9ã€æœ‰å“ªäº›å“åº”ç ï¼Œåˆ†åˆ«éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><ul><li><code>1**</code> ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ</li><li><code>2**</code> æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</li><li><code>3**</code> é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚</li><li><code>4**</code> å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚</li><li><code>5**</code> æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯</li></ul><h2 id="äºŒã€TCP-UDP-ï¼ˆâ­â­â­ï¼‰"><a href="#äºŒã€TCP-UDP-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="äºŒã€TCP/UDP ï¼ˆâ­â­â­ï¼‰"></a>äºŒã€TCP/UDP ï¼ˆâ­â­â­ï¼‰</h2><h3 id="1ã€ä¸ºä»€ä¹ˆtcpè¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ"><a href="#1ã€ä¸ºä»€ä¹ˆtcpè¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆtcpè¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ"></a>1ã€ä¸ºä»€ä¹ˆtcpè¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3><p>ä¸€æ¬¡å…¸å‹çš„æ— æ•°æ®ä¼ è¾“çš„ TCP è¿æ¥ï¼ˆåŒ…æ‹¬å»ºç«‹è¿æ¥ã€å…³é—­è¿æ¥ï¼‰è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://notes.shichao.io/tcpv1/figure_13-1_600.png" alt="TCP è¿æ¥è¿‡ç¨‹"></p><h4 id="é‡è¦æ ‡å¿—ä½"><a href="#é‡è¦æ ‡å¿—ä½" class="headerlink" title="é‡è¦æ ‡å¿—ä½"></a>é‡è¦æ ‡å¿—ä½</h4><ul><li>**<code>ACKï¼ˆAcknowledgeï¼‰</code>**ï¼šTCPåè®®è§„å®šï¼Œåªæœ‰ ACK=1 æ—¶è¡¨ç¤ºæœ‰æ•ˆï¼Œä¹Ÿè§„å®šè¿æ¥å»ºç«‹åæ‰€æœ‰å‘é€çš„æŠ¥æ–‡çš„ACKå¿…é¡»ä¸º1</li><li><strong><code>SYNï¼ˆSynchronizationï¼‰</code><strong>ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“SYN=1è€ŒACK=0æ—¶ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª</strong>è¿æ¥è¯·æ±‚æŠ¥æ–‡</strong>ã€‚å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™åº”åœ¨å“åº”æŠ¥æ–‡ä¸­ä½¿ SYN=1 å’Œ ACK=1ã€‚å› æ­¤ï¼Œ SYN ç½® 1 å°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æˆ–è¿æ¥æ¥å—æŠ¥æ–‡ã€‚</li><li>**<code>Seqï¼ˆSequence Numberï¼‰</code>**ï¼šåºå·ï¼Œæ ‡è¯†å½“å‰æ¡/æŒ¥æ‰‹å·²ç»è¿›è¡Œåˆ°äº†å“ªä¸€æ­¥ã€‚</li><li><strong><code>FINï¼ˆfinishï¼‰</code><strong>ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ã€‚å½“ FIN=1 æ—¶ï¼Œè¡¨æ˜æ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚</strong>é‡Šæ”¾è¿æ¥</strong>ã€‚</li><li><strong>`ISNï¼ˆInitial Sequence Numberï¼‰</strong>ï¼šåˆå§‹åºå·å€¼ã€‚</li></ul><h4 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h4><p><strong>ç¬¬ä¸€æ¬¡ï¼š</strong> å»ºç«‹è¿æ¥ã€‚å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œå°† SYN ç½®ä¸º<code>1</code>ï¼ŒSeq ä¸º<code>ISN(c)</code>ï¼›ç„¶åï¼Œå®¢æˆ·ç«¯è¿›å…¥ SYN_SEND çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨çš„ç¡®è®¤ï¼›</p><p><strong>ç¬¬äºŒæ¬¡ï¼š</strong> æœåŠ¡å™¨æ”¶åˆ° SYN æŠ¥æ–‡æ®µã€‚æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡æ®µï¼Œéœ€è¦å¯¹è¿™ä¸ª SYN æŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤ï¼Œè®¾ç½® ACK ä¸º<code>ISN(c)+1</code>ï¼›åŒæ—¶ï¼Œè‡ªå·±è‡ªå·±è¿˜è¦å‘é€ SYN è¯·æ±‚ä¿¡æ¯ï¼Œè®¾ç½® SYNä¸º<code>1</code>ï¼ŒSeq è®¾ç½®ä¸º<code>ISN(s)</code>ï¼›æœåŠ¡å™¨ç«¯å°†ä¸Šè¿°æ‰€æœ‰ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆå³ SYN + ACK æŠ¥æ–‡æ®µï¼‰ä¸­ï¼Œä¸€å¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥ SYN_RECV çŠ¶æ€ï¼›</p><p><strong>ç¬¬ä¸‰æ¬¡ï¼š</strong> å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ SYN + ACK æŠ¥æ–‡æ®µï¼Œç„¶åå°† ACK è®¾ç½®ä¸º<code>ISN(s)+1</code>ï¼ŒSeq è®¾ç½®ä¸º<code>ISN(c)+1</code>ï¼Œå‘æœåŠ¡å™¨å‘é€ ACK æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µå‘é€å®Œæ¯•ä»¥åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œå®Œæˆ TCP ä¸‰æ¬¡æ¡æ‰‹ã€‚</p><h4 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h4><p><strong>ç¬¬ä¸€æ¬¡ï¼š</strong> ä¸»æœº1ï¼ˆå¯ä»¥æ˜¯å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥æ˜¯æœåŠ¡å™¨ç«¯ï¼‰ï¼Œè®¾ç½® Seq ä¸º<code>K</code>ï¼Œè®¾ç½® ACK ä¸º<code>L</code>ï¼Œå‘ä¸»æœº2å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡æ®µï¼›æ­¤æ—¶ï¼Œä¸»æœº1è¿›å…¥ FIN_WAIT_1 çŠ¶æ€ï¼›è¿™è¡¨ç¤ºä¸»æœº1æ²¡æœ‰æ•°æ®è¦å‘é€ç»™ä¸»æœº2äº†ï¼›</p><p><strong>ç¬¬äºŒæ¬¡ï¼š</strong> ä¸»æœº2æ”¶åˆ°äº†ä¸»æœº1å‘é€çš„ FIN æŠ¥æ–‡æ®µï¼Œè®¾ç½® Seq ä¸º<code>L</code>ï¼Œè®¾ç½® ACK ä¸º<code>K+1</code>ï¼Œå‘ä¸»æœº1å›ä¸€ä¸ª ACK æŠ¥æ–‡æ®µï¼›ä¸»æœº1è¿›å…¥ FIN_WAIT_2 çŠ¶æ€ï¼›ä¸»æœº2å‘Šè¯‰ä¸»æœº1ï¼Œæˆ‘ã€åŒæ„ã€ä½ çš„å…³é—­è¯·æ±‚ï¼›</p><p><strong>ç¬¬ä¸‰æ¬¡ï¼š</strong> ä¸»æœº2å‘ä¸»æœº1å‘é€ FIN æŠ¥æ–‡æ®µï¼Œè®¾ç½® Seq ä¸º<code>L</code>ï¼Œè®¾ç½® ACK ä¸º<code>K+1</code>ï¼Œè¯·æ±‚å…³é—­è¿æ¥ï¼ŒåŒæ—¶ä¸»æœº2è¿›å…¥ LAST_ACK çŠ¶æ€ï¼›</p><p><strong>ç¬¬å››æ¬¡ï¼š</strong> ä¸»æœº1æ”¶åˆ°ä¸»æœº2å‘é€çš„ FIN æŠ¥æ–‡æ®µï¼Œè®¾ç½® Seq ä¸º<code>K</code>ï¼Œè®¾ç½® ACK ä¸º<code>L+1</code>ï¼Œå‘ä¸»æœº2å‘é€ ACK æŠ¥æ–‡æ®µï¼Œç„¶åä¸»æœº1è¿›å…¥ TIME_WAIT çŠ¶æ€ï¼›ä¸»æœº2æ”¶åˆ°ä¸»æœº1çš„ ACK æŠ¥æ–‡æ®µä»¥åï¼Œå°±å…³é—­è¿æ¥ï¼›æ­¤æ—¶ï¼Œä¸»æœº1ç­‰å¾…2 MSL åä¾ç„¶æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œåˆ™è¯æ˜ Server ç«¯å·²æ­£å¸¸å…³é—­ï¼Œé‚£å¥½ï¼Œä¸»æœº1ä¹Ÿå¯ä»¥å…³é—­è¿æ¥äº†ã€‚</p><p>ã€ä¸‰æ¬¡æ¡æ‰‹ã€çš„ç›®çš„æ˜¯ã€<strong>ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯</strong>ã€ã€‚ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢ Server ç«¯ä¸€ç›´ç­‰å¾…ï¼Œæµªè´¹èµ„æºã€‚æ¢å¥è¯è¯´ï¼Œå³æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ç«¯èƒ½æ”¶æ¥å—åˆ°å®¢æˆ·ç«¯çš„ä¿¡æ¯å¹¶èƒ½åšå‡ºæ­£ç¡®çš„åº”ç­”è€Œè¿›è¡Œå‰ä¸¤æ¬¡ï¼ˆç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ï¼‰æ¡æ‰‹ï¼Œä¸ºäº†ä¿è¯å®¢æˆ·ç«¯èƒ½å¤Ÿæ¥æ”¶åˆ°æœåŠ¡ç«¯çš„ä¿¡æ¯å¹¶èƒ½åšå‡ºæ­£ç¡®çš„åº”ç­”è€Œè¿›è¡Œåä¸¤æ¬¡ï¼ˆç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡ï¼‰æ¡æ‰‹ã€‚</p><p>ã€å››æ¬¡æŒ¥æ‰‹ã€åŸå› æ˜¯å› ä¸º<strong>TCPæ˜¯å…¨åŒå·¥æ¨¡å¼</strong>ï¼Œæ¥æ”¶åˆ° FIN æ—¶æ„å‘³å°†æ²¡æœ‰æ•°æ®å†å‘æ¥ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç»§ç»­å‘é€æ•°æ®ã€‚</p><h3 id="2ã€TCP-å¯é ä¼ è¾“åŸç†å®ç°ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ã€‚"><a href="#2ã€TCP-å¯é ä¼ è¾“åŸç†å®ç°ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ã€‚" class="headerlink" title="2ã€TCP å¯é ä¼ è¾“åŸç†å®ç°ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ã€‚"></a>2ã€TCP å¯é ä¼ è¾“åŸç†å®ç°ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ã€‚</h3><ul><li><strong>ç¡®è®¤å’Œé‡ä¼ ã€‚</strong> æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡åå°±ä¼šè¿›è¡Œç¡®è®¤ï¼Œå‘é€æ–¹ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å°±ä¼šé‡ä¼ ã€‚</li><li><strong>æ•°æ®æ ¡éªŒã€‚</strong></li><li><strong>æ•°æ®åˆç†åˆ†ç‰‡ä¸æ’åºã€‚</strong> TCPä¼šå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œæ¥æ”¶æ–¹ä¼šç¼“å­˜ä¸ºæŒ‰åºåˆ°è¾¾çš„æ•°æ®ï¼Œé‡æ–°æ’åºåå†æäº¤ç»™åº”ç”¨å±‚ã€‚</li><li><strong>æµç¨‹æ§åˆ¶ã€‚</strong> å½“æ¥æ”¶æ–¹æ¥ä¸åŠæ¥æ”¶å‘é€çš„æ•°æ®æ—¶ï¼Œåˆ™ä¼šæç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿåº¦ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚</li><li><strong>æ‹¥å¡æ§åˆ¶ã€‚</strong> å½“ç½‘ç»œå‘ç”Ÿæ‹¥å¡æ—¶ï¼Œå‡å°‘æ•°æ®çš„å‘é€ã€‚</li></ul><p><a href="http://blog.chinaunix.net/uid-26275986-id-4109679.html">å…³äºæ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶å®ç°åŸç†è¯·ç‚¹å‡»è¿™é‡Œ</a></p><h3 id="3ã€TCP-å’Œ-UDP-çš„åŒºåˆ«ï¼Ÿ"><a href="#3ã€TCP-å’Œ-UDP-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3ã€TCP å’Œ UDP çš„åŒºåˆ«ï¼Ÿ"></a>3ã€TCP å’Œ UDP çš„åŒºåˆ«ï¼Ÿ</h3><ol><li><p>TCP åŸºäºè¿æ¥ï¼ŒUDP åŸºäºæ— è¿æ¥ï¼›</p></li><li><p>TCP å¯¹ç³»ç»Ÿèµ„æºçš„è¦æ±‚è¾ƒå¤šï¼ŒUDP è¾ƒå°‘ï¼›</p></li><li><p>UDP ç¨‹åºç»“æ„è¾ƒç®€å•ï¼›</p></li><li><p>TCP æ˜¯æµæ¨¡å¼ï¼ŒUDP æ˜¯æ•°æ®æŠ¥æ¨¡å¼ ï¼›</p></li><li><p>TCP ä¿è¯æ•°æ®å¯é æ€§ï¼ŒUDP å¯èƒ½ä¸¢åŒ…ï¼›</p></li><li><p>TCP ä¿è¯æ•°æ®é¡ºåºï¼ŒUDP ä¸ä¿è¯ã€‚</p></li></ol><h3 id="4ã€å¦‚ä½•è®¾è®¡åœ¨-UDP-ä¸Šå±‚ä¿è¯-UDP-çš„å¯é æ€§ä¼ è¾“ï¼Ÿ"><a href="#4ã€å¦‚ä½•è®¾è®¡åœ¨-UDP-ä¸Šå±‚ä¿è¯-UDP-çš„å¯é æ€§ä¼ è¾“ï¼Ÿ" class="headerlink" title="4ã€å¦‚ä½•è®¾è®¡åœ¨ UDP ä¸Šå±‚ä¿è¯ UDP çš„å¯é æ€§ä¼ è¾“ï¼Ÿ"></a>4ã€å¦‚ä½•è®¾è®¡åœ¨ UDP ä¸Šå±‚ä¿è¯ UDP çš„å¯é æ€§ä¼ è¾“ï¼Ÿ</h3><p>ä¼ è¾“å±‚æ— æ³•ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ï¼Œåªèƒ½é€šè¿‡åº”ç”¨å±‚æ¥å®ç°äº†ã€‚å®ç°çš„æ–¹å¼å¯ä»¥å‚ç…§ TCP å¯é æ€§ä¼ è¾“çš„æ–¹å¼ã€‚å¦‚ä¸è€ƒè™‘æ‹¥å¡å¤„ç†ï¼Œå¯é  UDP çš„ç®€å•è®¾è®¡å¦‚ä¸‹ï¼š</p><ol><li>æ·»åŠ  Seq/ACK æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®å‘é€åˆ°å¯¹ç«¯ï¼›</li><li>æ·»åŠ å‘é€å’Œæ¥æ”¶ç¼“å†²åŒºï¼Œä¸»è¦æ˜¯ç”¨æˆ·è¶…æ—¶é‡ä¼ ï¼›</li><li>æ·»åŠ è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚</li></ol><p>å…·ä½“è¿‡ç¨‹å³æ˜¯ï¼šé€ç«¯å‘é€æ•°æ®æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºseq=xï¼Œç„¶åæ¯ä¸€ç‰‡æŒ‰ç…§æ•°æ®å¤§å°åˆ†é…seqã€‚æ•°æ®åˆ°è¾¾æ¥æ”¶ç«¯åæ¥æ”¶ç«¯æ”¾å…¥ç¼“å­˜ï¼Œå¹¶å‘é€ä¸€ä¸ªack=xçš„åŒ…ï¼Œè¡¨ç¤ºå¯¹æ–¹å·²ç»æ”¶åˆ°äº†æ•°æ®ã€‚å‘é€ç«¯æ”¶åˆ°äº†ackåŒ…åï¼Œåˆ é™¤ç¼“å†²åŒºå¯¹åº”çš„æ•°æ®ã€‚æ—¶é—´åˆ°åï¼Œå®šæ—¶ä»»åŠ¡æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ä¼ æ•°æ®ã€‚</p><p>ç›®å‰æœ‰å¦‚ä¸‹å¼€æºç¨‹åºåˆ©ç”¨udpå®ç°äº†å¯é çš„æ•°æ®ä¼ è¾“ã€‚åˆ†åˆ«ä¸ºRUDPã€RTPã€UDT:</p><p>1ã€RUDPï¼ˆReliable User Datagram Protocolï¼‰</p><p>RUDP æä¾›ä¸€ç»„æ•°æ®æœåŠ¡è´¨é‡å¢å¼ºæœºåˆ¶ï¼Œå¦‚æ‹¥å¡æ§åˆ¶çš„æ”¹è¿›ã€é‡å‘æœºåˆ¶åŠæ·¡åŒ–æœåŠ¡å™¨ç®—æ³•ç­‰ã€‚</p><p>2ã€RTPï¼ˆReal Time Protocolï¼‰</p><p>RTPä¸ºæ•°æ®æä¾›äº†å…·æœ‰å®æ—¶ç‰¹å¾çš„ç«¯å¯¹ç«¯ä¼ é€æœåŠ¡ï¼Œå¦‚åœ¨ç»„æ’­æˆ–å•æ’­ç½‘ç»œæœåŠ¡ä¸‹çš„äº¤äº’å¼è§†é¢‘éŸ³é¢‘æˆ–æ¨¡æ‹Ÿæ•°æ®ã€‚</p><p>3ã€UDTï¼ˆUDP-based Data Transfer Protocolï¼‰</p><p>UDTçš„ä¸»è¦ç›®çš„æ˜¯æ”¯æŒé«˜é€Ÿå¹¿åŸŸç½‘ä¸Šçš„æµ·é‡æ•°æ®ä¼ è¾“ã€‚</p><p><a href="https://www.jianshu.com/p/6c73a4585eba">å…³äºRUDPã€RTPã€UDTçš„æ›´å¤šä»‹ç»è¯·æŸ¥çœ‹æ­¤å¤„</a></p><h2 id="ä¸‰ã€å…¶å®ƒé‡è¦ç½‘ç»œæ¦‚å¿µ-ï¼ˆâ­â­ï¼‰"><a href="#ä¸‰ã€å…¶å®ƒé‡è¦ç½‘ç»œæ¦‚å¿µ-ï¼ˆâ­â­ï¼‰" class="headerlink" title="ä¸‰ã€å…¶å®ƒé‡è¦ç½‘ç»œæ¦‚å¿µ ï¼ˆâ­â­ï¼‰"></a>ä¸‰ã€å…¶å®ƒé‡è¦ç½‘ç»œæ¦‚å¿µ ï¼ˆâ­â­ï¼‰</h2><h3 id="1ã€socketæ–­çº¿é‡è¿æ€ä¹ˆå®ç°ï¼Œå¿ƒè·³æœºåˆ¶åˆæ˜¯æ€æ ·å®ç°ï¼Ÿ"><a href="#1ã€socketæ–­çº¿é‡è¿æ€ä¹ˆå®ç°ï¼Œå¿ƒè·³æœºåˆ¶åˆæ˜¯æ€æ ·å®ç°ï¼Ÿ" class="headerlink" title="1ã€socketæ–­çº¿é‡è¿æ€ä¹ˆå®ç°ï¼Œå¿ƒè·³æœºåˆ¶åˆæ˜¯æ€æ ·å®ç°ï¼Ÿ"></a>1ã€socketæ–­çº¿é‡è¿æ€ä¹ˆå®ç°ï¼Œå¿ƒè·³æœºåˆ¶åˆæ˜¯æ€æ ·å®ç°ï¼Ÿ</h3><h4 id="socketæ¦‚å¿µ"><a href="#socketæ¦‚å¿µ" class="headerlink" title="socketæ¦‚å¿µ"></a>socketæ¦‚å¿µ</h4><p>å¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯é€šä¿¡çš„åŸºçŸ³ï¼Œæ˜¯æ”¯æŒTCP/IPåè®®çš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒã€‚å®ƒæ˜¯ç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­ç«¯ç‚¹çš„æŠ½è±¡è¡¨ç¤ºï¼ŒåŒ…å«è¿›è¡Œç½‘ç»œé€šä¿¡å¿…é¡»çš„äº”ç§ä¿¡æ¯ï¼šè¿æ¥ä½¿ç”¨çš„åè®®ï¼Œæœ¬åœ°ä¸»æœºçš„IPåœ°å€ï¼Œæœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ï¼Œè¿œåœ°ä¸»æœºçš„IPåœ°å€ï¼Œè¿œåœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€‚</p><p>ä¸ºäº†åŒºåˆ«ä¸åŒçš„åº”ç”¨ç¨‹åºè¿›ç¨‹å’Œè¿æ¥ï¼Œè®¸å¤šè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸ºåº”ç”¨ç¨‹åºä¸TCPï¼IPåè®®äº¤äº’æä¾›äº†å¥—æ¥å­—(Socket)æ¥å£ã€‚åº” ç”¨å±‚å¯ä»¥å’Œä¼ è¾“å±‚é€šè¿‡Socketæ¥å£ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒåº”ç”¨ç¨‹åºè¿›ç¨‹æˆ–ç½‘ç»œè¿æ¥çš„é€šä¿¡ï¼Œå®ç°æ•°æ®ä¼ è¾“çš„å¹¶å‘æœåŠ¡ã€‚</p><h4 id="å»ºç«‹socketè¿æ¥"><a href="#å»ºç«‹socketè¿æ¥" class="headerlink" title="å»ºç«‹socketè¿æ¥"></a>å»ºç«‹socketè¿æ¥</h4><p>å»ºç«‹Socketè¿æ¥è‡³å°‘éœ€è¦ä¸€å¯¹å¥—æ¥å­—ï¼Œå…¶ä¸­ä¸€ä¸ªè¿è¡Œäºå®¢æˆ·ç«¯ï¼Œç§°ä¸ºClientSocket ï¼Œå¦ä¸€ä¸ªè¿è¡ŒäºæœåŠ¡å™¨ç«¯ï¼Œç§°ä¸ºServerSocket ã€‚</p><p>å¥—æ¥å­—ä¹‹é—´çš„è¿æ¥è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šæœåŠ¡å™¨ç›‘å¬ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¿æ¥ç¡®è®¤ã€‚</p><ul><li>æœåŠ¡å™¨ç›‘å¬ï¼šæœåŠ¡å™¨ç«¯å¥—æ¥å­—å¹¶ä¸å®šä½å…·ä½“çš„å®¢æˆ·ç«¯å¥—æ¥å­—ï¼Œè€Œæ˜¯å¤„äºç­‰å¾…è¿æ¥çš„çŠ¶æ€ï¼Œå®æ—¶ç›‘æ§ç½‘ç»œçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</li><li>å®¢æˆ·ç«¯è¯·æ±‚ï¼šæŒ‡å®¢æˆ·ç«¯çš„å¥—æ¥å­—æå‡ºè¿æ¥è¯·æ±‚ï¼Œè¦è¿æ¥çš„ç›®æ ‡æ˜¯æœåŠ¡å™¨ç«¯çš„å¥—æ¥å­—ã€‚ä¸ºæ­¤ï¼Œå®¢æˆ·ç«¯çš„å¥—æ¥å­—å¿…é¡»é¦–å…ˆæè¿°å®ƒè¦è¿æ¥çš„æœåŠ¡å™¨çš„å¥—æ¥å­—ï¼ŒæŒ‡å‡ºæœåŠ¡å™¨ç«¯- - å¥—æ¥å­—çš„åœ°å€å’Œç«¯å£å·ï¼Œç„¶åå°±å‘æœåŠ¡å™¨ç«¯å¥—æ¥å­—æå‡ºè¿æ¥è¯·æ±‚ã€‚<br>è¿æ¥ç¡®è®¤ï¼šå½“æœåŠ¡å™¨ç«¯å¥—æ¥å­—ç›‘å¬åˆ°æˆ–è€…è¯´æ¥æ”¶åˆ°å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¿æ¥è¯·æ±‚æ—¶ï¼Œå°±å“åº”å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¯·æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼ŒæŠŠæœåŠ¡å™¨ç«¯å¥—æ¥å­—çš„æè¿°å‘ ç»™å®¢æˆ·ç«¯ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ç¡®è®¤äº†æ­¤æè¿°ï¼ŒåŒæ–¹å°±æ­£å¼å»ºç«‹è¿æ¥ã€‚è€ŒæœåŠ¡å™¨ç«¯å¥—æ¥å­—ç»§ç»­å¤„äºç›‘å¬çŠ¶æ€ï¼Œç»§ç»­æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¿æ¥è¯·æ±‚ã€‚</li></ul><h4 id="SOCKETè¿æ¥ä¸TCPè¿æ¥"><a href="#SOCKETè¿æ¥ä¸TCPè¿æ¥" class="headerlink" title="SOCKETè¿æ¥ä¸TCPè¿æ¥"></a>SOCKETè¿æ¥ä¸TCPè¿æ¥</h4><p>åˆ›å»ºSocketè¿æ¥æ—¶ï¼Œå¯ä»¥æŒ‡å®šä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ï¼ŒSocketå¯ä»¥æ”¯æŒä¸åŒçš„ä¼ è¾“å±‚åè®®ï¼ˆTCPæˆ–UDPï¼‰ï¼Œå½“ä½¿ç”¨TCPåè®®è¿›è¡Œè¿æ¥æ—¶ï¼Œè¯¥Socketè¿æ¥å°±æ˜¯ä¸€ä¸ªTCPè¿æ¥ã€‚</p><h4 id="Socketè¿æ¥ä¸HTTPè¿æ¥"><a href="#Socketè¿æ¥ä¸HTTPè¿æ¥" class="headerlink" title="Socketè¿æ¥ä¸HTTPè¿æ¥"></a>Socketè¿æ¥ä¸HTTPè¿æ¥</h4><p>ç”±äºé€šå¸¸æƒ…å†µä¸‹Socketè¿æ¥å°±æ˜¯TCPè¿æ¥ï¼Œå› æ­¤Socketè¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œé€šä¿¡åŒæ–¹å³å¯å¼€å§‹ç›¸äº’å‘é€æ•°æ®å†…å®¹ï¼Œç›´åˆ°åŒæ–¹è¿æ¥æ–­å¼€ã€‚ä½†åœ¨å®é™…ç½‘ ç»œåº”ç”¨ä¸­ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å¾€å¾€éœ€è¦ç©¿è¶Šå¤šä¸ªä¸­é—´èŠ‚ç‚¹ï¼Œä¾‹å¦‚è·¯ç”±å™¨ã€ç½‘å…³ã€é˜²ç«å¢™ç­‰ï¼Œå¤§éƒ¨åˆ†é˜²ç«å¢™é»˜è®¤ä¼šå…³é—­é•¿æ—¶é—´å¤„äºéæ´»è·ƒçŠ¶æ€çš„è¿æ¥è€Œå¯¼è‡´ Socket è¿æ¥æ–­è¿ï¼Œå› æ­¤éœ€è¦é€šè¿‡è½®è¯¢å‘Šè¯‰ç½‘ç»œï¼Œè¯¥è¿æ¥å¤„äºæ´»è·ƒçŠ¶æ€ã€‚</p><p>è€ŒHTTPè¿æ¥ä½¿ç”¨çš„æ˜¯â€œè¯·æ±‚â€”å“åº”â€çš„æ–¹å¼ï¼Œä¸ä»…åœ¨è¯·æ±‚æ—¶éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè€Œä¸”éœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚åï¼ŒæœåŠ¡å™¨ç«¯æ‰èƒ½å›å¤æ•°æ®ã€‚</p><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéœ€è¦æœåŠ¡å™¨ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œä¿æŒå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ•°æ®çš„å®æ—¶ä¸åŒæ­¥ã€‚æ­¤æ—¶è‹¥åŒæ–¹å»ºç«‹çš„æ˜¯Socketè¿æ¥ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥ç›´æ¥å°†æ•° æ®ä¼ é€ç»™å®¢æˆ·ç«¯ï¼›è‹¥åŒæ–¹å»ºç«‹çš„æ˜¯HTTPè¿æ¥ï¼Œåˆ™æœåŠ¡å™¨éœ€è¦ç­‰åˆ°å®¢æˆ·ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚åæ‰èƒ½å°†æ•°æ®ä¼ å›ç»™å®¢æˆ·ç«¯ï¼Œå› æ­¤ï¼Œå®¢æˆ·ç«¯å®šæ—¶å‘æœåŠ¡å™¨ç«¯å‘é€è¿æ¥è¯·æ±‚ï¼Œ ä¸ä»…å¯ä»¥ä¿æŒåœ¨çº¿ï¼ŒåŒæ—¶ä¹Ÿæ˜¯åœ¨â€œè¯¢é—®â€æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°çš„æ•°æ®ï¼Œå¦‚æœæœ‰å°±å°†æ•°æ®ä¼ ç»™å®¢æˆ·ç«¯ã€‚TCP(Transmission Control Protocol)ã€€ä¼ è¾“æ§åˆ¶åè®®</p><h4 id="socketæ–­çº¿é‡è¿å®ç°"><a href="#socketæ–­çº¿é‡è¿å®ç°" class="headerlink" title="socketæ–­çº¿é‡è¿å®ç°"></a>socketæ–­çº¿é‡è¿å®ç°</h4><p>æ­£å¸¸è¿æ¥æ–­å¼€å®¢æˆ·ç«¯ä¼šç»™æœåŠ¡ç«¯å‘é€ä¸€ä¸ªfinåŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°finåŒ…åæ‰ä¼šçŸ¥é“è¿æ¥æ–­å¼€ã€‚<br>è€Œæ–­ç½‘æ–­ç”µæ—¶å®¢æˆ·ç«¯æ— æ³•å‘é€finåŒ…ç»™æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æœåŠ¡ç«¯æ²¡åŠæ³•æ£€æµ‹åˆ°å®¢æˆ·ç«¯å·²ç»çŸ­çº¿ã€‚<br>ä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼ŒæœåŠ¡ç«¯éœ€è¦æœ‰ä¸ªå¿ƒè·³é€»è¾‘ï¼Œå°±æ˜¯æœåŠ¡ç«¯æ£€æµ‹åˆ°æŸä¸ªå®¢æˆ·ç«¯å¤šä¹…æ²¡å‘é€ä»»ä½•æ•°æ®è¿‡æ¥å°±è®¤ä¸ºå®¢æˆ·ç«¯å·²ç»æ–­å¼€ï¼Œ<br>è¿™éœ€è¦å®¢æˆ·ç«¯å®šæ—¶å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³æ•°æ®ç»´æŒè¿æ¥ã€‚</p><h4 id="å¿ƒè·³æœºåˆ¶å®ç°"><a href="#å¿ƒè·³æœºåˆ¶å®ç°" class="headerlink" title="å¿ƒè·³æœºåˆ¶å®ç°"></a>å¿ƒè·³æœºåˆ¶å®ç°</h4><p>é•¿è¿æ¥çš„å®ç°ï¼šå¿ƒè·³æœºåˆ¶ï¼Œåº”ç”¨å±‚åè®®å¤§å¤šéƒ½æœ‰HeartBeatæœºåˆ¶ï¼Œé€šå¸¸æ˜¯å®¢æˆ·ç«¯æ¯éš”ä¸€å°æ®µæ—¶é—´å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œé€šçŸ¥æœåŠ¡å™¨è‡ªå·±ä»ç„¶åœ¨çº¿ã€‚å¹¶ä¼ è¾“ä¸€äº›å¯èƒ½å¿…è¦çš„æ•°æ®ã€‚ä½¿ç”¨å¿ƒè·³åŒ…çš„å…¸å‹åè®®æ˜¯IMï¼Œæ¯”å¦‚QQ/MSN/é£ä¿¡ç­‰åè®®</p><p>1ã€åœ¨TCPçš„æœºåˆ¶é‡Œé¢ï¼Œæœ¬èº«æ˜¯å­˜åœ¨æœ‰å¿ƒè·³åŒ…çš„æœºåˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯TCPçš„é€‰é¡¹ï¼šSO_KEEPALIVEã€‚<br>ç³»ç»Ÿé»˜è®¤æ˜¯è®¾ç½®çš„2å°æ—¶çš„å¿ƒè·³é¢‘ç‡ã€‚ä½†æ˜¯å®ƒæ£€æŸ¥ä¸åˆ°æœºå™¨æ–­ç”µã€ç½‘çº¿æ‹”å‡ºã€é˜²ç«å¢™è¿™äº›æ–­çº¿ã€‚<br>è€Œä¸”é€»è¾‘å±‚å¤„ç†æ–­çº¿å¯èƒ½ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¥½å¤„ç†ã€‚ä¸€èˆ¬ï¼Œå¦‚æœåªæ˜¯ç”¨äºä¿æ´»è¿˜æ˜¯å¯ä»¥çš„ã€‚é€šè¿‡ä½¿ç”¨TCPçš„KeepAliveæœºåˆ¶ï¼ˆä¿®æ”¹é‚£ä¸ªtimeå‚æ•°ï¼‰ï¼Œå¯ä»¥è®©è¿æ¥æ¯éš”ä¸€å°æ®µæ—¶é—´å°±äº§ç”Ÿä¸€äº›ackåŒ…ï¼Œä»¥é™ä½è¢«è¸¢æ‰çš„é£é™©ï¼Œå½“ç„¶ï¼Œè¿™æ ·çš„ä»£ä»·æ˜¯é¢å¤–çš„ç½‘ç»œå’ŒCPUè´Ÿæ‹…ã€‚</p><p>2ã€åº”ç”¨å±‚å¿ƒè·³æœºåˆ¶å®ç°ã€‚</p><h3 id="2ã€Cookieä¸Sessionçš„ä½œç”¨å’ŒåŸç†ã€‚"><a href="#2ã€Cookieä¸Sessionçš„ä½œç”¨å’ŒåŸç†ã€‚" class="headerlink" title="2ã€Cookieä¸Sessionçš„ä½œç”¨å’ŒåŸç†ã€‚"></a>2ã€Cookieä¸Sessionçš„ä½œç”¨å’ŒåŸç†ã€‚</h3><ul><li>Sessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ã€‚</li><li>Cookieæ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®ç°Sessionçš„ä¸€ç§æ–¹å¼ã€‚</li></ul><h4 id="Sessionï¼š"><a href="#Sessionï¼š" class="headerlink" title="Sessionï¼š"></a>Sessionï¼š</h4><p>ç”±äºHTTPåè®®æ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦è®°å½•ç”¨æˆ·çš„çŠ¶æ€æ—¶ï¼Œå°±éœ€è¦ç”¨æŸç§æœºåˆ¶æ¥è¯†å…·ä½“çš„ç”¨æˆ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯Session.å…¸å‹çš„åœºæ™¯æ¯”å¦‚è´­ç‰©è½¦ï¼Œå½“ä½ ç‚¹å‡»ä¸‹å•æŒ‰é’®æ—¶ï¼Œç”±äºHTTPåè®®æ— çŠ¶æ€ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯è¦ä¸ºç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºäº†ç‰¹å®šçš„Sessionï¼Œç”¨ç”¨äºæ ‡è¯†è¿™ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”è·Ÿè¸ªç”¨æˆ·ï¼Œè¿™æ ·æ‰çŸ¥é“è´­ç‰©è½¦é‡Œé¢æœ‰å‡ æœ¬ä¹¦ã€‚è¿™ä¸ªSessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼Œæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚åœ¨æœåŠ¡ç«¯ä¿å­˜Sessionçš„æ–¹æ³•å¾ˆå¤šï¼Œå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶éƒ½æœ‰ã€‚é›†ç¾¤çš„æ—¶å€™ä¹Ÿè¦è€ƒè™‘Sessionçš„è½¬ç§»ï¼Œåœ¨å¤§å‹çš„ç½‘ç«™ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸“é—¨çš„SessionæœåŠ¡å™¨é›†ç¾¤ï¼Œç”¨æ¥ä¿å­˜ç”¨æˆ·ä¼šè¯ï¼Œè¿™ä¸ªæ—¶å€™ Session ä¿¡æ¯éƒ½æ˜¯æ”¾åœ¨å†…å­˜çš„ã€‚</p><p>å…·ä½“åˆ°Webä¸­çš„SessionæŒ‡çš„å°±æ˜¯ç”¨æˆ·åœ¨æµè§ˆæŸä¸ªç½‘ç«™æ—¶ï¼Œä»è¿›å…¥ç½‘ç«™åˆ°æµè§ˆå™¨å…³é—­æ‰€ç»è¿‡çš„è¿™æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æµè§ˆè¿™ä¸ªç½‘ç«™æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚å› æ­¤ä»ä¸Šè¿°çš„å®šä¹‰ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSessionå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ¦‚å¿µã€‚</p><p>å½“å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨æ ¹æ®éœ€æ±‚è®¾ç½®Sessionï¼Œå°†ä¼šè¯ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼ŒåŒæ—¶å°†æ ‡ç¤ºSessionçš„SessionIdä¼ é€’ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œ</p><p>æµè§ˆå™¨å°†è¿™ä¸ªSessionIdä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ— è¿‡æœŸæ—¶é—´çš„Cookieã€‚æµè§ˆå™¨å…³é—­åï¼Œè¿™ä¸ªCookieå°±ä¼šè¢«æ¸…æ‰ï¼Œå®ƒä¸ä¼šå­˜åœ¨äºç”¨æˆ·çš„Cookieä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ä»¥åæµè§ˆå™¨æ¯æ¬¡è¯·æ±‚éƒ½ä¼šé¢å¤–åŠ ä¸Šè¿™ä¸ªå‚æ•°å€¼ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªSessionIdï¼Œå°±èƒ½å–å¾—å®¢æˆ·ç«¯çš„æ•°æ®ä¿¡æ¯ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯æµè§ˆå™¨æ„å¤–å…³é—­ï¼ŒæœåŠ¡å™¨ä¿å­˜çš„Sessionæ•°æ®ä¸æ˜¯ç«‹å³é‡Šæ”¾ï¼Œæ­¤æ—¶æ•°æ®è¿˜ä¼šå­˜åœ¨ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“é‚£ä¸ªSessionIdï¼Œå°±å¯ä»¥ç»§ç»­é€šè¿‡è¯·æ±‚è·å¾—æ­¤Sessionçš„ä¿¡æ¯ï¼Œå› ä¸ºæ­¤æ—¶åå°çš„Sessionè¿˜å­˜åœ¨ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªSessionè¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦è¶…è¿‡è§„å®šæ—¶é—´æ²¡æœ‰å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šæ¸…é™¤å¯¹åº”SessionIdçš„Sessionä¿¡æ¯ã€‚</p><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>Cookieæ˜¯ç”±æœåŠ¡å™¨ç«¯ç”Ÿæˆï¼Œå‘é€ç»™User-Agentï¼ˆä¸€èˆ¬æ˜¯webæµè§ˆå™¨ï¼‰ï¼Œæµè§ˆå™¨ä¼šå°†Cookieçš„key/valueä¿å­˜åˆ°æŸä¸ªç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶å†…ï¼Œä¸‹æ¬¡è¯·æ±‚åŒä¸€ç½‘ç«™æ—¶å°±å‘é€è¯¥Cookieç»™æœåŠ¡å™¨ï¼ˆå‰ææ˜¯æµè§ˆå™¨è®¾ç½®ä¸ºå¯ç”¨Cookieï¼‰ã€‚Cookieåç§°å’Œå€¼å¯ä»¥ç”±æœåŠ¡å™¨ç«¯å¼€å‘è‡ªå·±å®šä¹‰ï¼Œå¯¹äºJSPè€Œè¨€ä¹Ÿå¯ä»¥ç›´æ¥å†™å…¥Sessionidï¼Œè¿™æ ·æœåŠ¡å™¨å¯ä»¥çŸ¥é“è¯¥ç”¨æˆ·æ˜¯å¦åˆæ³•ç”¨æˆ·ä»¥åŠæ˜¯å¦éœ€è¦é‡æ–°ç™»å½•ç­‰ã€‚</p><h3 id="3ã€IPæŠ¥æ–‡ä¸­çš„å†…å®¹ã€‚"><a href="#3ã€IPæŠ¥æ–‡ä¸­çš„å†…å®¹ã€‚" class="headerlink" title="3ã€IPæŠ¥æ–‡ä¸­çš„å†…å®¹ã€‚"></a>3ã€IPæŠ¥æ–‡ä¸­çš„å†…å®¹ã€‚</h3><p><img src="http://blog.cigis-cloud.com/aaji-1591249793.jpg" alt="IP æŠ¥æ–‡ç»“æ„å›¾"></p><p>ç‰ˆæœ¬ï¼šIPåè®®çš„ç‰ˆæœ¬ï¼Œç›®å‰çš„IPåè®®ç‰ˆæœ¬å·ä¸º4ï¼Œä¸‹ä¸€ä»£IPåè®®ç‰ˆæœ¬å·ä¸º6ã€‚</p><p>é¦–éƒ¨é•¿åº¦ï¼šIPæŠ¥å¤´çš„é•¿åº¦ã€‚å›ºå®šéƒ¨åˆ†çš„é•¿åº¦ï¼ˆ20å­—èŠ‚ï¼‰å’Œå¯å˜éƒ¨åˆ†çš„é•¿åº¦ä¹‹å’Œã€‚å…±å 4ä½ã€‚æœ€å¤§ä¸º1111ï¼Œå³10è¿›åˆ¶çš„15ï¼Œä»£è¡¨IPæŠ¥å¤´çš„æœ€å¤§é•¿åº¦å¯ä»¥ä¸º15ä¸ª32bitsï¼ˆ4å­—èŠ‚ï¼‰ï¼Œä¹Ÿå°±æ˜¯æœ€é•¿å¯ä¸º15*4=60å­—èŠ‚ï¼Œé™¤å»å›ºå®šéƒ¨åˆ†çš„é•¿åº¦20å­—èŠ‚ï¼Œå¯å˜éƒ¨åˆ†çš„é•¿åº¦æœ€å¤§ä¸º40å­—èŠ‚ã€‚</p><p>æœåŠ¡ç±»å‹ï¼šType Of Serviceã€‚</p><p>æ€»é•¿åº¦ï¼šIPæŠ¥æ–‡çš„æ€»é•¿åº¦ã€‚æŠ¥å¤´çš„é•¿åº¦å’Œæ•°æ®éƒ¨åˆ†çš„é•¿åº¦ä¹‹å’Œã€‚</p><p>æ ‡è¯†ï¼šå”¯ä¸€çš„æ ‡è¯†ä¸»æœºå‘é€çš„æ¯ä¸€åˆ†æ•°æ®æŠ¥ã€‚é€šå¸¸æ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡ï¼Œå®ƒçš„å€¼åŠ ä¸€ã€‚å½“IPæŠ¥æ–‡é•¿åº¦è¶…è¿‡ä¼ è¾“ç½‘ç»œçš„MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰æ—¶å¿…é¡»åˆ†ç‰‡ï¼Œè¿™ä¸ªæ ‡è¯†å­—æ®µçš„å€¼è¢«å¤åˆ¶åˆ°æ‰€æœ‰æ•°æ®åˆ†ç‰‡çš„æ ‡è¯†å­—æ®µä¸­ï¼Œä½¿å¾—è¿™äº›åˆ†ç‰‡åœ¨è¾¾åˆ°æœ€ç»ˆç›®çš„åœ°æ—¶å¯ä»¥ä¾ç…§æ ‡è¯†å­—æ®µçš„å†…å®¹é‡æ–°ç»„æˆåŸå…ˆçš„æ•°æ®ã€‚</p><p>æ ‡å¿—ï¼šå…±3ä½ã€‚Rã€DFã€MFä¸‰ä½ã€‚ç›®å‰åªæœ‰åä¸¤ä½æœ‰æ•ˆï¼ŒDFä½ï¼šä¸º1è¡¨ç¤ºä¸åˆ†ç‰‡ï¼Œä¸º0è¡¨ç¤ºåˆ†ç‰‡ã€‚MFï¼šä¸º1è¡¨ç¤ºâ€œæ›´å¤šçš„ç‰‡â€ï¼Œä¸º0è¡¨ç¤ºè¿™æ˜¯æœ€åä¸€ç‰‡ã€‚</p><p>ç‰‡ä½ç§»ï¼šæœ¬åˆ†ç‰‡åœ¨åŸå…ˆæ•°æ®æŠ¥æ–‡ä¸­ç›¸å¯¹é¦–ä½çš„åç§»ä½ã€‚ï¼ˆéœ€è¦å†ä¹˜ä»¥8ï¼‰</p><p>ç”Ÿå­˜æ—¶é—´ï¼šIPæŠ¥æ–‡æ‰€å…è®¸é€šè¿‡çš„è·¯ç”±å™¨çš„æœ€å¤§æ•°é‡ã€‚æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼ŒTTLå‡1ï¼Œå½“ä¸º0æ—¶ï¼Œè·¯ç”±å™¨å°†è¯¥æ•°æ®æŠ¥ä¸¢å¼ƒã€‚TTL å­—æ®µæ˜¯ç”±å‘é€ç«¯åˆå§‹è®¾ç½®ä¸€ä¸ª 8 bitå­—æ®µ.æ¨èçš„åˆå§‹å€¼ç”±åˆ†é…æ•°å­— RFC æŒ‡å®šï¼Œå½“å‰å€¼ä¸º 64ã€‚å‘é€ ICMP å›æ˜¾åº”ç­”æ—¶ç»å¸¸æŠŠ TTL è®¾ä¸ºæœ€å¤§å€¼ 255ã€‚</p><p>åè®®ï¼šæŒ‡å‡ºIPæŠ¥æ–‡æºå¸¦çš„æ•°æ®ä½¿ç”¨çš„æ˜¯é‚£ç§åè®®ï¼Œä»¥ä¾¿ç›®çš„ä¸»æœºçš„IPå±‚èƒ½çŸ¥é“è¦å°†æ•°æ®æŠ¥ä¸Šäº¤åˆ°å“ªä¸ªè¿›ç¨‹ï¼ˆä¸åŒçš„åè®®æœ‰ä¸“é—¨ä¸åŒçš„è¿›ç¨‹å¤„ç†ï¼‰ã€‚å’Œç«¯å£å·ç±»ä¼¼ï¼Œæ­¤å¤„é‡‡ç”¨åè®®å·ï¼ŒTCPçš„åè®®å·ä¸º6ï¼ŒUDPçš„åè®®å·ä¸º17ã€‚ICMPçš„åè®®å·ä¸º1ï¼ŒIGMPçš„åè®®å·ä¸º2.</p><p>é¦–éƒ¨æ ¡éªŒå’Œï¼šè®¡ç®—IPå¤´éƒ¨çš„æ ¡éªŒå’Œï¼Œæ£€æŸ¥IPæŠ¥å¤´çš„å®Œæ•´æ€§ã€‚</p><p>æºIPåœ°å€ï¼šæ ‡è¯†IPæ•°æ®æŠ¥çš„æºç«¯è®¾å¤‡ã€‚</p><p>ç›®çš„IPåœ°å€ï¼šæ ‡è¯†IPæ•°æ®æŠ¥çš„ç›®çš„åœ°å€ã€‚</p><p>æœ€åå°±æ˜¯å¯å˜éƒ¨åˆ†å’Œæ•°æ®éƒ¨åˆ†ã€‚</p><h2 id="å››ã€å¸¸è§ç½‘ç»œæµç¨‹æœºåˆ¶-ï¼ˆâ­â­ï¼‰"><a href="#å››ã€å¸¸è§ç½‘ç»œæµç¨‹æœºåˆ¶-ï¼ˆâ­â­ï¼‰" class="headerlink" title="å››ã€å¸¸è§ç½‘ç»œæµç¨‹æœºåˆ¶ ï¼ˆâ­â­ï¼‰"></a>å››ã€å¸¸è§ç½‘ç»œæµç¨‹æœºåˆ¶ ï¼ˆâ­â­ï¼‰</h2><h3 id="1ã€æµè§ˆå™¨è¾“å…¥åœ°å€åˆ°è¿”å›ç»“æœå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"><a href="#1ã€æµè§ˆå™¨è¾“å…¥åœ°å€åˆ°è¿”å›ç»“æœå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€æµè§ˆå™¨è¾“å…¥åœ°å€åˆ°è¿”å›ç»“æœå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"></a>1ã€<a href="https://segmentfault.com/a/1190000006879700">æµè§ˆå™¨è¾“å…¥åœ°å€åˆ°è¿”å›ç»“æœå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></h3><p>æ€»ä½“æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹:</p><p>1ã€DNSè§£æï¼Œæ­¤å¤–è¿˜æœ‰DNSyä¼˜åŒ–ï¼ˆDNSç¼“å­˜ã€DNSè´Ÿè½½å‡è¡¡ï¼‰</p><p>2ã€TCPè¿æ¥</p><p>3ã€å‘é€HTTPè¯·æ±‚</p><p>4ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</p><p>5ã€æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</p><p>6ã€è¿æ¥ç»“æŸ</p><h4 id="Webå‰ç«¯çš„æœ¬è´¨"><a href="#Webå‰ç«¯çš„æœ¬è´¨" class="headerlink" title="Webå‰ç«¯çš„æœ¬è´¨"></a>Webå‰ç«¯çš„æœ¬è´¨</h4><p>å°†ä¿¡æ¯å¿«é€Ÿå¹¶å‹å¥½çš„å±•ç¤ºç»™ç”¨æˆ·å¹¶èƒ½å¤Ÿä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚</p><h4 id="å¦‚ä½•å°½å¿«çš„åŠ è½½èµ„æºï¼ˆç½‘ç»œä¼˜åŒ–ï¼‰ï¼Ÿ"><a href="#å¦‚ä½•å°½å¿«çš„åŠ è½½èµ„æºï¼ˆç½‘ç»œä¼˜åŒ–ï¼‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•å°½å¿«çš„åŠ è½½èµ„æºï¼ˆç½‘ç»œä¼˜åŒ–ï¼‰ï¼Ÿ"></a>å¦‚ä½•å°½å¿«çš„åŠ è½½èµ„æºï¼ˆç½‘ç»œä¼˜åŒ–ï¼‰ï¼Ÿ</h4><p>ç­”æ¡ˆå°±æ˜¯èƒ½ä¸ä»ç½‘ç»œä¸­åŠ è½½çš„èµ„æºå°±ä¸ä»ç½‘ç»œä¸­åŠ è½½ï¼Œå½“æˆ‘ä»¬åˆç†ä½¿ç”¨ç¼“å­˜ï¼Œå°†èµ„æºæ”¾åœ¨æµè§ˆå™¨ç«¯ï¼Œè¿™æ˜¯æœ€å¿«çš„æ–¹å¼ã€‚å¦‚æœèµ„æºå¿…é¡»ä»ç½‘ç»œä¸­åŠ è½½ï¼Œåˆ™è¦è€ƒè™‘ç¼©çŸ­è¿æ¥æ—¶é—´ï¼Œå³DNSä¼˜åŒ–éƒ¨åˆ†;å‡å°‘å“åº”å†…å®¹å¤§å°ï¼Œå³å¯¹å†…å®¹è¿›è¡Œå‹ç¼©ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœåŠ è½½çš„èµ„æºæ•°æ¯”è¾ƒå°‘çš„è¯ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿçš„å“åº”ç”¨æˆ·ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Handler å’Œå®ƒçš„æœ‹å‹ä»¬</title>
      <link href="/2020-01-02/handler-and-its-friends/"/>
      <url>/2020-01-02/handler-and-its-friends/</url>
      
        <content type="html"><![CDATA[<p>Android ä¸­çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œé‡‡ç”¨ Binder æœºåˆ¶ï¼Œé‚£çº¿ç¨‹é—´é€šä¿¡å‘¢ï¼ŸAndroid ç»™å‡ºäº†ä¸€ä¸ªæœºåˆ¶ â€”â€” Handlerã€‚</p><p>ä¸€æèµ· Handlerï¼Œå°±ä¸å¾—ä¸æåˆ°å®ƒçš„<strong>å…¨å®¶</strong>ï¼š</p><ul><li>Message</li><li>MessageQueue</li><li>Looper</li><li>Handler</li></ul><p>æˆ‘ä»¬æ¥ä¸€ä¸ªä¸ªåœ°è§£é‡Šä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="Message-â€”â€”-ä¿¡ä»¶"><a href="#Message-â€”â€”-ä¿¡ä»¶" class="headerlink" title="Message â€”â€” ä¿¡ä»¶"></a>Message â€”â€” ä¿¡ä»¶</h2><p>Message åœ¨ä½•æ—¶éƒ½ä¼šä»£è¡¨ã€æ¶ˆæ¯ã€çš„æ„æ€ã€‚åœ¨ Android ä¸­æ¶ˆæ¯è¿˜ä¼šé™„å¸¦ä¸€äº›å…¶ä»–çš„æ•°æ®ï¼Œä¾›<strong>æš‚å­˜æ¶ˆæ¯çš„ MessageQueue</strong> å’Œ<strong>åˆ†å‘æ¶ˆæ¯çš„ Looper</strong> ä»¥åŠ<strong>å¤„ç†æ¶ˆæ¯çš„ Handler</strong>ä½¿ç”¨ã€‚</p><p>Message ä¸­åŒ…å«å¯ä¾› Handler ä½¿ç”¨çš„ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯<strong>ä¸¤ä¸ª<code>int</code>å­—æ®µ</strong>å’Œ<strong>ä¸€ä¸ª<code>Object</code>å­—æ®µ</strong>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ Message çš„å®šä¹‰ï¼š</p><pre><code class="java">// android.os.Message// æ³¨æ„ï¼Œè™½ç„¶ Message çš„æ„é€ å‡½æ•°æ˜¯ publicçš„ï¼Œä½†æœ€å¥½çš„è·å– Message çš„æ–¹æ³•è¿˜æ˜¯ä½¿ç”¨ Message.obtain() æˆ–è€…æ˜¯ Handler.obtainMessage() æ–¹æ³•ï¼Œå®ƒä¼šä»å›æ”¶æ± å­ä¸­æ‹¿å‡ºä¸€ä¸ªå¯¹è±¡æ¥public final class Message implements Parcelable &#123;    // æ¶ˆæ¯çš„ codeï¼Œå¯ä»¥è®©æ¥æ”¶è€…è¾¨è®¤è¿™æ˜¯å“ªä¸ªæ¶ˆæ¯    // æ¯ä¸€ä¸ª Handler åº”å¯¹ code æ—¶éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥ä½ ä¸ç”¨æ‹…å¿ƒä¼šä¸å…¶ä»–çš„ Handler æœ‰å†²çª    public int what;    // arg1 å’Œ arg2 ç›¸æ¯”è¾ƒ setData(Bundle) æ¥è¯´æ˜¯æ¶ˆè€—å¾ˆä½ï¼Œå¦‚æœä½ åªéœ€è¦æš‚å­˜å‡ ä¸ª int å€¼çš„è¯ï¼Œå¯ä»¥ç”¨è¿™ä¸¤ä¸ªå‚æ•°    public int arg1;    public int arg2;    // æƒ³å­˜å•¥å°±å­˜å•¥ï¼Œä½†æ˜¯è¦å­˜å‚¨çš„æ•°æ®å¿…é¡»æ˜¯ä¸€ä¸ª Parcelable å¯¹è±¡    // æ³¨æ„åœ¨Android 4.0ä¹‹å‰ä¸æ”¯æŒ Parcelable å¯¹è±¡    public Object obj;    ...    /*package*/ Bundle data;    // å­˜å‚¨ç€è¦å¤„ç†æ¶ˆæ¯çš„ Handler çš„å®ä¾‹    @UnsupportedAppUsage    /*package*/ Handler target;    // è¦å¤„ç†æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥å›è°ƒçš„æ–¹æ³•    @UnsupportedAppUsage    /*package*/ Runnable callback;    // æœ‰æ—¶ä¼šé“¾å¼å­˜å‚¨ä¸‹ä¸€æ¡æ¶ˆæ¯    @UnsupportedAppUsage    /*package*/ Message next;    // æ± å­é”    public static final Object sPoolSync = new Object();    // ä¸€ä¸ªæ± ï¼Œç”¨æ¥æš‚å­˜æ¶ˆæ¯ï¼Œè¿™æ ·å¦‚æœéœ€è¦æ–°æ¶ˆæ¯å®ä¾‹çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨æ± é‡Œçš„ï¼Œè€Œä¸ç”¨å†æ–°å»ºå®ä¾‹äº†    private static Message sPool;    private static int sPoolSize = 0;    private static final int MAX_POOL_SIZE = 50;    // ä»å…¨å±€æ± ä¸­æ‹¿å‡ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥é¿å…ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡    public static Message obtain() &#123;        synchronized (sPoolSync) &#123;            if (sPool != null) &#123;                Message m = sPool;                sPool = m.next;                m.next = null;                m.flags = 0; // clear in-use flag                sPoolSize--;                return m;            &#125;        &#125;        return new Message();    &#125;    // obtain() æ–¹æ³•çš„å„ç§é‡è½½æ–¹æ³•ï¼Œä½†æœ€åéƒ½ä¼šè°ƒç”¨ä¸Šé¢çš„æ–¹æ³•    // æ¯”å¦‚æ¯”è¾ƒå¸¸ç”¨çš„ obtain(Handler)    // ä¸ obtain() ç›¸åŒï¼Œä½†æ˜¯ä¼šæŠŠ target è®¾ç½®ä¸ºä¼ å…¥çš„ Handler    public static Message obtain(Handler h) &#123;        Message m = obtain();        m.target = h;        return m;    &#125;    ...    // å°†ä¸€ä¸ª Message å®ä¾‹æ‰”å›å…¨å±€æ± ä¸­    // åœ¨è°ƒç”¨å®Œè¿™ä¸ªæ–¹æ³•åï¼Œä½ ç»å¯¹ä¸èƒ½å†åŠ¨è¿™ä¸ª Messageï¼Œå› ä¸ºå®ƒå·²ç»è¢«é‡Šæ”¾äº†ã€‚    // å›æ”¶ä¸€ä¸ªæ­£åœ¨é˜Ÿåˆ—ä¸­æˆ–æ­£åœ¨è¢«ä¼ é€’ç»™ Handler çš„æ¶ˆæ¯æ˜¯é”™è¯¯çš„    public void recycle() &#123;        if (isInUse()) &#123;            if (gCheckRecycle) &#123;                throw new IllegalStateException(&quot;This message cannot be recycled because it &quot;                        + &quot;is still in use.&quot;);            &#125;            return;        &#125;        recycleUnchecked();    &#125;    // å›æ”¶ä¸€ä¸ªå¯èƒ½æ­£åœ¨ä½¿ç”¨çš„ Message    // è¯¥æ–¹æ³•ä¼šåœ¨ MessageQueue å†…éƒ¨ä½¿ç”¨ï¼Œä¹Ÿä¼šåœ¨ Looper æŠ›å¼ƒ Message æ—¶ä½¿ç”¨    void recycleUnchecked() &#123;        // æ ‡è®°ä¸º FLAG_IN_USEï¼Œå¹¶æ¸…ç©ºå®ƒå†…éƒ¨çš„ä¸œè¥¿        // Mark the message as in use while it remains in the recycled object pool.        // Clear out all other details.        flags = FLAG_IN_USE;        what = 0;        arg1 = 0;        arg2 = 0;        obj = null;        replyTo = null;        sendingUid = UID_NONE;        workSourceUid = UID_NONE;        when = 0;        target = null;        callback = null;        data = null;        synchronized (sPoolSync) &#123;            if (sPoolSize &lt; MAX_POOL_SIZE) &#123;                next = sPool;                sPool = this;                sPoolSize++;            &#125;        &#125;    &#125;    // å°† Message å‘é€åˆ° Handlerï¼Œä¹Ÿå³ target å˜é‡    public void sendToTarget() &#123;        target.sendMessage(this);    &#125;&#125;</code></pre><p>ä»ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå‡ ä¸ª Message çš„ç‰¹æ€§ï¼š</p><ol><li>æœ‰ä¸€ä¸ªã€å›æ”¶æ± ã€çš„æ¦‚å¿µï¼Œå¦‚æœ Message å®Œæˆä½¿å‘½ä¹‹åè¢«æŠ›å¼ƒï¼Œé‚£è¿™ä¸ª Message å®ä¾‹ä¼šè¢«æ¸…ç©ºæ•°æ®å¹¶æ‰”åˆ°å›æ”¶æ± ä¸­ã€‚å¦‚æœå†éœ€è¦æ–°å»º Message å®ä¾‹çš„æ—¶å€™ï¼Œå°±ç›´æ¥ä»æ± ä¸­æ‹¿ï¼Œé¿å…äº†æ–°å»º Message å®ä¾‹ã€‚</li><li>å¦‚æœè¦æ–°å»º Message å®ä¾‹ï¼Œä½¿ç”¨<code>Message.obtain()</code>æ–¹æ³•ï¼Œè€Œä¸æ˜¯è°ƒç”¨<code>new Message()</code>ã€‚</li><li>Message æœ¬èº«åŒ…å«äº†ä¸€ä¸ª Handler çš„å¼•ç”¨ï¼Œå­˜å‚¨åœ¨ target æˆå‘˜å˜é‡ä¸­ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šè°ƒç”¨<code>target.sendMessage(this)</code>å°†è‡ªèº«ä¼ é€’åˆ° Handler ä¸­ã€‚</li></ol><h2 id="MessageQueue-â€”â€”-é‚®ç­’"><a href="#MessageQueue-â€”â€”-é‚®ç­’" class="headerlink" title="MessageQueue â€”â€” é‚®ç­’"></a>MessageQueue â€”â€” é‚®ç­’</h2><p>åœ¨ MessageQueue çš„ç±»æ³¨é‡Šé‡Œå†™ç€ï¼š</p><blockquote><p> Low-level class holding the list of messages to be dispatched by a Looper.  Messages are not added directly to a MessageQueue, but rather through Handler objects associated with the Looper.<br> å®ƒæ˜¯ä¸€ä¸ªä½ç­‰çº§çš„ç±»ï¼Œæ‹¿ç€ä¸€å † Message ç­‰å¾… Looper æ¥åˆ†å‘ã€‚Message å¹¶ä¸æ˜¯ç›´æ¥å°±æ·»åŠ åˆ° MessageQueue ä¸­ï¼Œè€Œæ˜¯é€šè¿‡ä¸ Looper å…³è”çš„ Handler æ¥æ“ä½œçš„ã€‚</p></blockquote><p>MessageQueue æœ€é‡è¦çš„åŠŸèƒ½å½“ç„¶å°±æ˜¯ç»´æŠ¤æœ¬èº«çš„é˜Ÿåˆ—ï¼Œæä¾›è¿›ã€å‡ºçš„æ–¹æ³•ç»™ Looperï¼Œä»¥åŠæŒç®¡ Message çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹çœ‹è¿™å‡ ç§ç‰¹æ€§æ˜¯å¦‚ä½•å®Œæˆçš„ã€‚</p><pre><code class="java">// android.os.MessageQueue.javapublic final class MessageQueue &#123;    // å¦‚æœæ˜¯ trueï¼Œè¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—èƒ½é€€å‡º    @UnsupportedAppUsage    private final boolean mQuitAllowed;    ...    @UnsupportedAppUsage    Message mMessages;    // æ·»åŠ æ¶ˆæ¯    boolean enqueueMessage(Message msg, long when) &#123;        // å„ç§åˆ¤æ–­        ...        synchronized (this) &#123;            // å¦‚æœæ­£åœ¨é€€å‡ºï¼Œå°±ä¸èƒ½æ·»åŠ äº†            // åŒæ—¶è¿˜å¾—å›æ”¶è¿™ä¸ªæ¶ˆæ¯            if (mQuitting) &#123;                IllegalStateException e = new IllegalStateException(                        msg.target + &quot; sending message to a Handler on a dead thread&quot;);                Log.w(TAG, e.getMessage(), e);                msg.recycle();                return false;            &#125;            msg.markInUse();            msg.when = when;            Message p = mMessages;            boolean needWake;            // å¦‚æœ MessageQueue ä¸­æ²¡æœ‰æ¶ˆæ¯            if (p == null || when == 0 || when &lt; p.when) &#123;                msg.next = p;                mMessages = msg;                needWake = mBlocked;            &#125; else &#123;                // Inserted within the middle of the queue.  Usually we don&#39;t have to wake                // up the event queue unless there is a barrier at the head of the queue                // and the message is the earliest asynchronous message in the queue.                needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous();                Message prev;                // å¾ªç¯æŸ¥çœ‹ Message.nextï¼Œå¦‚æœ‰ï¼Œå°±ç»§ç»­æŸ¥çœ‹ nextï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æŠŠæ¶ˆæ¯æ·»åŠ åˆ°é˜Ÿå°¾ Message.next ä¸­                for (;;) &#123;                    prev = p;                    p = p.next;                    if (p == null || when &lt; p.when) &#123;                        break;                    &#125;                    if (needWake &amp;&amp; p.isAsynchronous()) &#123;                        needWake = false;                    &#125;                &#125;                msg.next = p; // invariant: p == prev.next                prev.next = msg; // ç„¶åæŠŠå½“å‰ Message èµ‹å€¼åˆ°ä¸Šä¸€ä¸ª Message çš„ next ä¸­             &#125;            // We can assume mPtr != 0 because mQuitting is false.            if (needWake) &#123;                nativeWake(mPtr);            &#125;        &#125;        return true;    &#125;    // è·å–é˜Ÿå¤´æ¶ˆæ¯    @UnsupportedAppUsage    Message next() &#123;        // å¦‚æœ Looper å·²ç»å®Œè›‹äº†ï¼Œå°±è¿”å› null äº†        final long ptr = mPtr;        if (ptr == 0) &#123;            return null;        &#125;        int pendingIdleHandlerCount = -1; // -1 only during first iteration        int nextPollTimeoutMillis = 0;        for (;;) &#123;            if (nextPollTimeoutMillis != 0) &#123;                Binder.flushPendingCommands();            &#125;            nativePollOnce(ptr, nextPollTimeoutMillis);            synchronized (this) &#123;                // Try to retrieve the next message.  Return if found.                final long now = SystemClock.uptimeMillis();                Message prevMsg = null;                Message msg = mMessages;                if (msg != null &amp;&amp; msg.target == null) &#123;                    // Stalled by a barrier.  Find the next asynchronous message in the queue.                    do &#123;                        prevMsg = msg;                        msg = msg.next;                    &#125; while (msg != null &amp;&amp; !msg.isAsynchronous());                &#125;                if (msg != null) &#123;                    if (now &lt; msg.when) &#123;                        // è¿˜æ²¡åˆ°å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±è®¾ç½®ä¸€ä¸ªè¶…æ—¶ï¼Œç­‰æ—¶é—´åˆ°äº†å†å”¤é†’å®ƒ                        nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);                    &#125; else &#123;                        // åˆ°å‘é€æ¶ˆæ¯çš„æ—¶å€™äº†ï¼Œè·å–å®ƒ                        mBlocked = false;                        if (prevMsg != null) &#123;                            prevMsg.next = msg.next;                        &#125; else &#123;                            mMessages = msg.next;                        &#125;                        msg.next = null;                        if (DEBUG) Log.v(TAG, &quot;Returning message: &quot; + msg);                        msg.markInUse();                        return msg;                    &#125;                &#125; else &#123;                    // No more messages.                    nextPollTimeoutMillis = -1;                &#125;                ...            &#125;            ...        &#125;    &#125;    ...    // æ ¹æ® Handler å’Œ what ç§»é™¤ Messageï¼ŒåŒæ—¶è¦å›æ”¶è¿™ä¸ª Message    void removeMessages(Handler h, int what, Object object) &#123;        ...        synchronized (this) &#123;            Message p = mMessages;            ...            p.recycleUnchecked();        &#125;        ...    &#125;&#125;</code></pre><p>è¯»å®Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å® MessageQueue å¹¶ä¸æƒ³æˆ‘ä»¬æƒ³è±¡çš„ï¼Œæœ‰ä¸€ä¸ªçœŸå®çš„ã€é˜Ÿåˆ—ã€å­˜åœ¨ï¼Œè€Œæ˜¯ç”¨ Message çš„ nextï¼Œå»ºç«‹äº†ä¸€ä¸ªé“¾è¡¨ï¼Œå½¢æˆäº†æ‰€è°“çš„ã€é˜Ÿåˆ—ã€ã€‚åœ¨ã€è¿›ã€çš„æµç¨‹é‡Œæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å»ºç«‹é“¾è¡¨çš„è¿‡ç¨‹ï¼›è€Œã€å‡ºã€çš„æµç¨‹ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œæ˜¯åˆ©ç”¨äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå› ä¸ºæ¯æ¡ Message éƒ½æœ‰è‡ªå·±ã€è¦è¢«å‘é€ã€çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ—¶é—´æ²¡åˆ°ï¼Œé‚£è¿˜è¦ç­‰å¾…ä¸€ä¸‹ï¼Œå¦‚æœæ—¶é—´å·²åˆ°ï¼Œå°±å–å‡ºï¼Œå¹¶æŠŠå…¶å®ƒçš„ Message å‘é˜Ÿå¤´æä¸€ä½ã€‚</p><p>å¯ä»¥ç”¨ä¸¤ä¸ªæµç¨‹å›¾æ¥å±•ç¤ºã€è¿›ã€ä¸ã€å‡ºã€ï¼š</p><p><img src="/img/30.png"></p><h2 id="Looper-â€”â€”-é©¬è½¦"><a href="#Looper-â€”â€”-é©¬è½¦" class="headerlink" title="Looper â€”â€” é©¬è½¦"></a>Looper â€”â€” é©¬è½¦</h2><p>Looper æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ã€‚å®ƒè´Ÿè´£ä¸åœåœ°è¯»å– MessageQueue ä¸­çš„æ¶ˆæ¯ï¼Œå¦‚æœä¸€æ—¦æœ‰æ¶ˆæ¯ï¼Œå°±æ‹¿å‡ºæ¥ï¼Œæ‰”ç»™ Handlerï¼Œç„¶ååˆè¿›å…¥è‡ªå·±çš„å°åœˆå­é‡Œä¸é—®ä¸–äº‹ã€‚ä¸€æ—¦ MessageQuee é‡Œæ²¡æœ‰æ¶ˆæ¯äº†ï¼Œé‚£å®ƒä¹Ÿå°±ç»“æŸè‡ªå·±çš„å·¥ä½œã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹å®ƒçš„ä»£ç ï¼š</p><pre><code class="java">// android.os.Looper.java/**  * Class used to run a message loop for a thread.  Threads by default do  * not have a message loop associated with them; to create one, call  * &#123;@link #prepare&#125; in the thread that is to run the loop, and then  * &#123;@link #loop&#125; to have it process messages until the loop is stopped.  *  * &lt;p&gt;Most interaction with a message loop is through the  * &#123;@link Handler&#125; class.  *  * &lt;p&gt;This is a typical example of the implementation of a Looper thread,  * using the separation of &#123;@link #prepare&#125; and &#123;@link #loop&#125; to create an  * initial Handler to communicate with the Looper.  *  * &lt;pre&gt;  *  class LooperThread extends Thread &#123;  *      public Handler mHandler;  *  *      public void run() &#123;  *          Looper.prepare();  *  *          mHandler = new Handler() &#123;  *              public void handleMessage(Message msg) &#123;  *                  // process incoming messages here  *              &#125;  *          &#125;;  *  *          Looper.loop();  *      &#125;  *  &#125;&lt;/pre&gt;  */public final class Looper &#123;    ...    @UnsupportedAppUsage    static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();    @UnsupportedAppUsage    private static Looper sMainLooper;  // guarded by Looper.class    private static Observer sObserver;    @UnsupportedAppUsage    final MessageQueue mQueue;    final Thread mThread;    /** å°†å½“å‰çº¿ç¨‹åˆå§‹åŒ–ä¸ºä¸€ä¸ª Looperã€‚      * ä¹‹åï¼Œåœ¨çœŸæ­£å¯åŠ¨è¿™ä¸ª Looper ä¹‹å‰ï¼Œä½ å°±å¯ä»¥ç”¨è¿™ä¸ª Looper å»åˆ›å»º Handleräº†ã€‚      * åœ¨è°ƒç”¨å®Œ prepare() ä¹‹åä¸€å®šè¦è°ƒç”¨ loop() æ–¹æ³•ï¼Œå¦‚æœè¦åœæ­¢ï¼Œåˆ™è°ƒç”¨ quit()      */    public static void prepare() &#123;        prepare(true);    &#125;    private static void prepare(boolean quitAllowed) &#123;        if (sThreadLocal.get() != null) &#123;            throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);        &#125;        sThreadLocal.set(new Looper(quitAllowed));    &#125;    /**     * å°†å½“å‰çº¿ç¨‹åˆå§‹åŒ–ä¸ºä¸€ä¸ª Looperï¼Œå¹¶å°†å…¶å½“åšåº”ç”¨çš„ main looperã€‚     * ä»‹ä¸ªæ–¹æ³•æ˜¯ç”± Android æ¥è°ƒç”¨çš„ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¥è¯´ï¼Œä½ åº”è¯¥å‹æ ¹ç”¨ä¸åˆ°è¿™ä¸ªæ–¹æ³•ã€‚     */    public static void prepareMainLooper() &#123;        prepare(false);        synchronized (Looper.class) &#123;            if (sMainLooper != null) &#123;                throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;);            &#125;            sMainLooper = myLooper();        &#125;    &#125;    /**     * è¿”å›åº”ç”¨çš„ main looperï¼Œåœ¨åº”ç”¨çš„ä¸»çº¿ç¨‹é‡Œå­˜æ´»çš„é‚£ä¸ª     */    public static Looper getMainLooper() &#123;        synchronized (Looper.class) &#123;            return sMainLooper;        &#125;    &#125;    ...    /**     * å¼€å§‹ç›‘å¬ message queueï¼Œä¸€å®šè®°å¾—è¦è°ƒç”¨ quit() æ¥åœæ­¢ Looper     */    public static void loop() &#123;        // æ‹¿åˆ°è°ƒç”¨æ­¤æ–¹æ³•çš„å½“å‰çº¿ç¨‹ä¸‹çš„ Looper å®ä¾‹        final Looper me = myLooper();        if (me == null) &#123;            throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn&#39;t called on this thread.&quot;);        &#125;        final MessageQueue queue = me.mQueue;        ...        // å¼€å¯è‡ªé—­æ¨¡å¼        for (;;) &#123;            Message msg = queue.next(); // å¯èƒ½ä¼š blockï¼Œå› ä¸ºåœ¨ MessageQueue.next() ä¸­ï¼Œ                                        // è°ƒç”¨äº† nativePollOnce æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¼•èµ·é˜»å¡ã€‚                                        // ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼ŒLooper å°±åœ¨è¿™å„¿ã€ç­‰ç€ã€ã€‚            if (msg == null) &#123;                // æœ¨æœ‰ messageï¼Œæ„å‘³ç€ message queue æ­£åœ¨ quit                // ä¸€æ—¦ returnï¼Œè¿™ä¸ª Looper å°±ç»“æŸäº†                return;            &#125;            // å„ç§æ£€æŸ¥            ...                        try &#123;                // å‘é€æ¶ˆæ¯                msg.target.dispatchMessage(msg);                ...            &#125; catch (Exception exception) &#123;                ...            &#125; finally &#123;                ...            &#125;            ...        &#125;    &#125;    /**     * ä» sThreadLocal ä¸­è·å–å½“å‰çº¿ç¨‹ä¸‹çš„ Looper     * æ­¤å¤„åˆ©ç”¨äº† ThreadLocalï¼ŒæŸä¸ªçº¿ç¨‹ä¸‹å­˜å‚¨çš„æ•°æ®ï¼Œåªæœ‰è¿™ä¸ªçº¿ç¨‹èƒ½è¯»å–ï¼Œå…¶ä»–çº¿ç¨‹ä¸å¯ä»¥ï¼Œä»è€Œè¾¾åˆ°     * çº¿ç¨‹ä¸ Looper çš„ã€ç»‘å®šã€æ•ˆæœ     */    public static @Nullable Looper myLooper() &#123;        return sThreadLocal.get();    &#125;    /**     * è¿”å›å½“å‰çº¿ç¨‹ä¸‹ Looper çš„ MessageQueueã€‚     * è¯¥æ–¹æ³•å¿…é¡»ä»ä¸€ä¸ªæ­£åœ¨è·‘ Looper çš„çº¿ç¨‹ä¸‹è°ƒç”¨ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡º NullPointerExceptionã€‚     */    public static @NonNull MessageQueue myQueue() &#123;        return myLooper().mQueue;    &#125;    // åˆå§‹åŒ–    private Looper(boolean quitAllowed) &#123;        mQueue = new MessageQueue(quitAllowed);        mThread = Thread.currentThread();    &#125;    ...    // è¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯ Looper çš„çº¿ç¨‹    public boolean isCurrentThread() &#123;        return Thread.currentThread() == mThread;    &#125;    ...    public interface Observer &#123;        // Message åˆ†å‘ä¹‹å‰è¢«è°ƒç”¨        Object messageDispatchStarting();        // Message è¢« Handler å¤„ç†è¿‡äº†ä¹‹åè°ƒç”¨        void messageDispatched(Object token, Message msg);        // Message å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸æ—¶è°ƒç”¨        void dispatchingThrewException(Object token, Message msg, Exception exception);    &#125;</code></pre><p>Looper ç±»æ¯”è¾ƒæ¸…æ™°ï¼ŒèŒè´£ä¹Ÿç›¸å¯¹å•ä¸€ï¼Œå°±æ˜¯ç”¨æ­»å¾ªç¯çš„æ–¹å¼ï¼Œä¸€ç›´é€šè¿‡<code>MessageQueue.next()</code>æ–¹æ³•è·å– Messageï¼Œç„¶åè°ƒç”¨<code>msg.target.dispatchMessage(msg)</code>æ–¹æ³•ï¼Œå°† Message äº¤ç»™ Handler å¤„ç†ï¼ˆ<code>msg.target</code>æ˜¯ Handler ç±»å‹ï¼‰ã€‚</p><p>ç­‰ä»»åŠ¡å…¨éƒ¨å¤„ç†å®Œæˆåï¼Œ<code>ä½¿ç”¨ MessageQueue.quit()</code> æ¸…ç©ºæ¶ˆæ¯ï¼Œç»“æŸ Looper çš„å¾ªç¯ã€‚</p><p>æœ‰ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ä½†æ˜¯åˆå¾ˆæ— å˜å¤´çš„é—®é¢˜ï¼šä¸»çº¿ç¨‹çš„ Looper æ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´ ANRï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜å…¶å®ç®—æ˜¯å·æ¢æ¦‚å¿µã€‚</p><p>é¦–å…ˆï¼Œæ­»å¾ªç¯ä¸æ˜¯é€ æˆ ANR çš„å¿…ç„¶åŸå› ï¼ŒANR æ˜¯å› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ²¡æœ‰å¾—åˆ°åŠæ—¶å¤„ç†æ‰é€ æˆçš„ï¼Œæ¯”å¦‚ BroadcastReceiver çš„<code>onReceive()</code>æ–¹æ³•ä¸­å¤„ç†äº‹åŠ¡è¶…è¿‡äº†10ç§’ï¼Œæ¯”å¦‚<code>onTouch()</code>äº‹ä»¶è¶…è¿‡äº†5ç§’ï¼Œæ‰ä¼šå¯¼è‡´ ANRã€‚</p><p>ç¬¬äºŒï¼Œä¸»çº¿ç¨‹çš„ Looper æ­»å¾ªç¯ï¼Œæœ€å¤šä¹Ÿå°±ä¼šå¯¼è‡´ä¸ª OOMï¼Œä½†æ˜¯ä¸»çº¿ç¨‹åœ¨æ²¡æœ‰æ¶ˆæ¯æ—¶ä¹Ÿä¼šä¼‘çœ ã€è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå½“æœ‰æ–°æ¶ˆæ¯æ¥ä¸´æ—¶ï¼Œå†è¢«å”¤é†’ï¼Œåˆ†å‘æ¶ˆæ¯ï¼Œå®é™…ä¸Šå¯¹äºå†…å­˜çš„æ¶ˆè€—éå¸¸å°ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¦‚æœä¸»çº¿ç¨‹çš„ Looper ä¸å¾ªç¯äº†ï¼Œé‚£<code>main()</code>æ–¹æ³•å°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ç»“æŸäº†ï¼Œå°±æ•´ä¸ªåº”ç”¨å°±é€€å‡ºäº†ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œ<code>prepare()</code>æ–¹æ³•ä¸­ä½¿ç”¨åˆ°äº† ThreadLocal çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶çš„æè¿°æ˜¯ï¼š<strong>A çº¿ç¨‹ä¸‹ä½¿ç”¨äº† <code>ThreadLocal.set()</code> æ–¹æ³•å­˜å‚¨äº†æŸä¸ªèµ„æºï¼Œé‚£ä¹ˆåªæœ‰åœ¨ A çº¿ç¨‹ä¸‹æ‰èƒ½é€šè¿‡ <code>ThreadLocal.get()</code> æ–¹æ³•æ‹¿åˆ°è¿™ä¸ªèµ„æºï¼Œä»è€Œå®ç°äº†èµ„æºéš”ç¦»</strong>ã€‚å¯¹ ThreadLocal çš„è¯¦è§£ï¼Œåœ¨<a href="/threadlocal/">è¿™ç¯‡æ–‡ç« </a>é‡Œã€‚</p><h2 id="Handler-â€”â€”-é‚®é€’å‘˜"><a href="#Handler-â€”â€”-é‚®é€’å‘˜" class="headerlink" title="Handler â€”â€” é‚®é€’å‘˜"></a>Handler â€”â€” é‚®é€’å‘˜</h2><p>Handler é¡¾åæ€ä¹‰å°±æ˜¯å¤„ç†è€…ã€‚å½“æ¥åˆ° Message çš„æ—¶å€™ï¼Œå°±é©¬ä¸åœè¹„åœ°å¼€å§‹å·¥ä½œã€‚å®ƒçš„å¤´è„‘å¾ˆç®€å•ï¼Œç»™æˆ‘æ´»æˆ‘å°±å¹²ï¼Œæ²¡æ´»æˆ‘å°±ç­‰ç€ã€‚</p><p>æˆ‘ä»¬åœ¨åˆå§‹åŒ– Handler çš„æ—¶å€™ï¼Œæœ‰å‡ ç§æ–¹å¼ï¼š</p><ol><li>ç›´æ¥è°ƒç”¨<code>new Handler()</code>ã€‚</li></ol><p>æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨è¿™ç§æƒ…å†µä¸‹ Handler çš„æ„é€ å‡½æ•°ã€‚</p><pre><code class="java">// android.os.Handler.javapublic Handler() &#123;    this(null, false);&#125;public Handler(@Nullable Callback callback, boolean async) &#123;    // æ£€æŸ¥æŒæœ‰è¯¥å®ä¾‹çš„ç±»æ˜¯å¦ä¼šå¯¼è‡´å†…å­˜æ³„æ¼    if (FIND_POTENTIAL_LEAKS) &#123;        final Class&lt;? extends Handler&gt; klass = getClass();        if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;                (klass.getModifiers() &amp; Modifier.STATIC) == 0) &#123;            Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +                klass.getCanonicalName());        &#125;    &#125;    // è°ƒç”¨äº† Looper.myLooper() æ–¹æ³•ï¼Œæ¥è·å– Looper çš„å®ä¾‹ã€‚    // åˆšæ‰ä¸Šé¢è®²è¿‡äº†ï¼Œåªèƒ½è·å–å½“å‰çº¿ç¨‹ä¸‹çš„ Looperï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ new ä¸€ä¸ª Handler çš„æ—¶å€™ï¼Œéƒ½æ˜¯    // åœ¨ä¸»çº¿ç¨‹ä¸‹ï¼Œé‚£è¿™ä¸ª mLooper å…¶å®å°±æ˜¯ Main Looper    mLooper = Looper.myLooper();    // å¦‚æœä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºäº†ï¼Œä½†æ˜¯å®ƒçš„ Looper æ²¡æœ‰è°ƒç”¨è¿‡ prepare()ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å¯ç”¨ï¼Œé‚£è·å–åˆ°çš„ Looper å°±æ˜¯ç©º    if (mLooper == null) &#123;        throw new RuntimeException(            &quot;Can&#39;t create handler inside thread &quot; + Thread.currentThread()                    + &quot; that has not called Looper.prepare()&quot;);    &#125;    mQueue = mLooper.mQueue;    mCallback = callback;    mAsynchronous = async;&#125;</code></pre><ol start="2"><li>åˆ›å»º Handler å®ä¾‹æ—¶ä¼ å…¥ Looperã€‚</li></ol><p>åŒæ ·åœ°ï¼Œä¹Ÿçœ‹çœ‹è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šè°ƒç”¨å“ªä¸ªæ„é€ å‡½æ•°ï¼š</p><pre><code class="java">// android.os.Handler.javapublic Handler(@NonNull Looper looper) &#123;        this(looper, null, false);&#125;public Handler(@NonNull Looper looper, @Nullable Callback callback, boolean async) &#123;    mLooper = looper;    mQueue = looper.mQueue;    mCallback = callback;    mAsynchronous = async;&#125;</code></pre><p>æœ‰äº† Looper å°±å¯ä»¥ç›´æ¥èµ‹å€¼äº†ï¼ŒHandler ä¹Ÿå¹¶ä¸å…³å¿ƒå½“å‰çš„ Looper æ˜¯åœ¨å“ªä¸ªçº¿ç¨‹ä¸‹ï¼Œå¹²å°±å®Œäº†ã€‚</p><p>æˆ‘ä»¬ä¹Ÿè§‚å¯Ÿåˆ°ï¼ŒHandler çš„å‡ ä¸ªé‡è½½çš„æ„é€ å‡½æ•°é‡Œï¼Œæ€»ä¼šæœ‰ Callback å‚æ•°ï¼Œè¨€ä¸‹ä¹‹æ„ï¼Œæ˜¯ Handler åœ¨æŸä¸ªèŠ‚ç‚¹ï¼Œåº”è¯¥ä¼šè°ƒç”¨è¿™ä¸ª Callbackã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç æ˜¯ä¸æ˜¯è¿™ä¹ˆå†™çš„ï¼Œä» Looper å‘ Handler å‘é€æ¶ˆæ¯å¼€å§‹ï¼š</p><pre><code class="java">// android.os.Handler.javapublic void dispatchMessage(@NonNull Message msg) &#123;    if (msg.callback != null) &#123;        handleCallback(msg);    &#125; else &#123;        if (mCallback != null) &#123;            if (mCallback.handleMessage(msg)) &#123;                return;            &#125;        &#125;        handleMessage(msg);    &#125;&#125;// å­ç±»å¿…é¡»è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œæ‰èƒ½è·å– Message// ä½†å®ƒä¸æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ä¸å®ç°è¯¥æ–¹æ³•public void handleMessage(@NonNull Message msg) &#123;&#125;</code></pre><p>æ˜¯äº†ï¼Œå¦‚æœåœ¨ Message ä¸­æœ‰ Callbackï¼Œé‚£å°±ç›´æ¥å›è°ƒ Message ä¸­çš„ Callbackï¼Œä¸‹é¢çš„å°±ä¸èµ°äº†ã€‚</p><p>å¦‚æœç»™ Handler è®¾ç½®äº† Callbackï¼Œé‚£å°±è°ƒç”¨ï¼Œå¦‚æœè¯¥ Callback çš„å®ç°ç±»é‡Œï¼Œè¿”å›äº†<code>true</code>ï¼Œé‚£å°±ä¸å†è°ƒç”¨ handleMessage æ–¹æ³•ï¼›å¦‚æœè¿”å›äº†<code>false</code>ï¼Œé‚£å°±å†è°ƒç”¨ä¸€æ¬¡ handleMessage æ–¹æ³•ã€‚</p><p>Callback çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="java">// ä½ å¯ä»¥ç”¨ Callback æ¥å£æ¥åˆå§‹åŒ–ä¸€ä¸ª Handlerï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å»ç»§æ‰¿ Handler ç„¶åå»å®ç°ä¸€å †æ–¹æ³•äº†// è¯´ç™½äº†ï¼Œå°±æ˜¯ç®€å•åœ°å®ç°ä¸€ä¸ªå›è°ƒåŠŸèƒ½public interface Callback &#123;    // è¿”å› true çš„è¯ï¼Œå°±ä¸å†ç»§ç»­å¤„ç†    boolean handleMessage(@NonNull Message msg);&#125;</code></pre><p>åˆšæ‰åœ¨ Looper çš„ä»£ç ä¸­çœ‹åˆ°ï¼Œ<code>msg.target.diapatch()</code>æ˜¯åœ¨å‘ Handler å‘é€æ¶ˆæ¯ï¼Œé‚£<code>msg.target</code>æ˜¯ä»€ä¹ˆæ—¶å€™è¢«èµ‹å€¼çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹ Handler ä¸­æœ€è‘—åçš„<code>post()</code>æ–¹æ³•ã€‚</p><pre><code class="java">// android.os.Handler.java// æŠŠä¸€ä¸ª Runnable çš„å®ä¾‹æ·»åŠ åˆ° MessageQueue ä¸­ã€‚// è¿™ä¸ª Runnable å°†ä¼šè¿è¡Œåœ¨ Handler æ‰€åœ¨çš„çº¿ç¨‹ä¸Šã€‚// è¿”å› true çš„è¯ï¼Œå°±æ˜¯æ­£ç¡®åœ°æ”¾å…¥äº† MessageQueueï¼Œå¦åˆ™å°±è¿”å› falseï¼Œé€šå¸¸æ˜¯å› ä¸º MessageQueue æ­£åœ¨é€€å‡ºpublic final boolean post(@NonNull Runnable r) &#123;    return sendMessageDelayed(getPostMessage(r), 0);&#125;// å‘ MessageQueue ä¸­æ·»åŠ ä¸€ä¸ª Messageï¼Œå¦‚æœæœ‰å»¶æ—¶ï¼Œé‚£å°±åœ¨è¿™ä¸ªæ—¶é—´æ®µï¼ˆcurrent time + delayMillisï¼‰å†æ·»åŠ // è¿™ä¸ª Message å›å¤´èƒ½åœ¨ handleMessage é‡Œæ‹¿åˆ°ï¼Œå½“å‰ï¼Œæ‰€åœ¨çš„çº¿ç¨‹ä¹Ÿæ˜¯ Hanlder ç»‘å®šçš„çº¿ç¨‹// æ·»åŠ æˆåŠŸåè¿”å› trueï¼Œæ·»åŠ å¤±è´¥è¿”å› false// æ·»åŠ æˆåŠŸä¸ä»£è¡¨ä¸€å®šèƒ½è¢«å¤„ç†public final boolean sendMessageDelayed(@NonNull Message msg, long delayMillis) &#123;    if (delayMillis &lt; 0) &#123;        delayMillis = 0;    &#125;    return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);&#125;// åœ¨ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰æ—¶ï¼Œå°† Message æ·»åŠ åˆ° MessageQueue ä¸­// è¿™ä¸ªæ—¶é—´æ˜¯åŸºäº android.os.SystemClock#uptimeMillis// è¿™ä¸ª Message å›å¤´èƒ½åœ¨ handleMessage é‡Œæ‹¿åˆ°ï¼Œå½“å‰ï¼Œæ‰€åœ¨çš„çº¿ç¨‹ä¹Ÿæ˜¯ Hanlder ç»‘å®šçš„çº¿ç¨‹// æ·»åŠ æˆåŠŸåè¿”å› trueï¼Œæ·»åŠ å¤±è´¥è¿”å› false// æ·»åŠ æˆåŠŸä¸ä»£è¡¨ä¸€å®šèƒ½è¢«å¤„ç†public boolean sendMessageAtTime(@NonNull Message msg, long uptimeMillis) &#123;    MessageQueue queue = mQueue;    if (queue == null) &#123;        RuntimeException e = new RuntimeException(                this + &quot; sendMessageAtTime() called with no mQueue&quot;);        Log.w(&quot;Looper&quot;, e.getMessage(), e);        return false;    &#125;    return enqueueMessage(queue, msg, uptimeMillis);&#125;private boolean enqueueMessage(@NonNull MessageQueue queue, @NonNull Message msg,        long uptimeMillis) &#123;    // èµ‹å€¼äº†ï¼Œå°† msg.target èµ‹å€¼ä¸ºè‡ªèº«çš„å®ä¾‹    msg.target = this;     msg.workSourceUid = ThreadLocalWorkSource.getUid();    if (mAsynchronous) &#123;        msg.setAsynchronous(true);    &#125;    return queue.enqueueMessage(msg, uptimeMillis);&#125;</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒHandler ä¸å…‰åªæ˜¯å¤„ç†æ¶ˆæ¯ï¼Œä¹Ÿè¦è´Ÿè´£å°†æ¶ˆæ¯æ·»åŠ åˆ° MessageQueue ä¸­ã€‚</p><p>å…³äºè¿™å››å¤§å¤©ç‹çš„å…³ç³»ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå…³ç³»å›¾æ¥å±•ç¤ºä¸€ä¸‹ï¼š</p><p><img src="/img/31.png"></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Handler </tag>
            
            <tag> Android Framwork </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éæŠ€æœ¯é¢è¯•é¢˜</title>
      <link href="/2020-01-02/job-interview-other/"/>
      <url>/2020-01-02/job-interview-other/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›éæŠ€æœ¯å‘çš„é¢è¯•é¢˜ã€‚</p><span id="more"></span><h2 id="éæŠ€æœ¯é¢è¯•é¢˜"><a href="#éæŠ€æœ¯é¢è¯•é¢˜" class="headerlink" title="éæŠ€æœ¯é¢è¯•é¢˜"></a>éæŠ€æœ¯é¢è¯•é¢˜</h2><h3 id="ä¸€ã€é«˜é¢‘é¢˜é›†-ï¼ˆâ­â­â­ï¼‰"><a href="#ä¸€ã€é«˜é¢‘é¢˜é›†-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="ä¸€ã€é«˜é¢‘é¢˜é›† ï¼ˆâ­â­â­ï¼‰"></a>ä¸€ã€é«˜é¢‘é¢˜é›† ï¼ˆâ­â­â­ï¼‰</h3><h4 id="1ã€ä½ è§‰å¾—å®‰å“å¼€å‘æœ€å…³é”®çš„æŠ€æœ¯åœ¨å“ªé‡Œï¼Ÿ"><a href="#1ã€ä½ è§‰å¾—å®‰å“å¼€å‘æœ€å…³é”®çš„æŠ€æœ¯åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="1ã€ä½ è§‰å¾—å®‰å“å¼€å‘æœ€å…³é”®çš„æŠ€æœ¯åœ¨å“ªé‡Œï¼Ÿ"></a>1ã€ä½ è§‰å¾—å®‰å“å¼€å‘æœ€å…³é”®çš„æŠ€æœ¯åœ¨å“ªé‡Œï¼Ÿ</h4><p>æŠ€æœ¯æ˜¯æ²¡æœ‰æ­¢å¢ƒçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šä¸æ–­æœ‰æ¼”è¿›å’Œéš¾ç‚¹ã€‚</p><p>ä¸€. åº•å±‚å’Œæ¡†æ¶å¦‚ä½•æ›´å¥½åœ°è®¾è®¡åŠä¼˜åŒ–ä»¥é€‚åº”ä¸šåŠ¡çš„é«˜é€Ÿå¢é•¿ã€‚è¯´èµ·æ¥å¾ˆç®€å•ï¼Œä½è€¦åˆé«˜æ‰©å±•ï¼Œåšèµ·æ¥æ˜¯éœ€è¦é•¿æœŸç»éªŒç§¯ç´¯ã€‚</p><p>äºŒ. æˆ‘æŠ›å‡ ä¸ªç»†èŠ‚éš¾ç‚¹ï¼š</p><ul><li>æ’ä»¶åŒ–å¦‚ä½•ä½¿æ’ä»¶çš„ Manifest ç”Ÿæ•ˆ</li><li>H5 å®¹å™¨å¦‚ä½•æ›´å¥½åœ°ä¼˜åŒ–å’Œå…¼å®¹</li><li>App ç«¯ä¼˜åŒ–ï¼Œè¿™æ˜¯ä¸ªæ²¡æ­¢å¢ƒçš„è¯é¢˜ï¼Œç½‘ç»œã€å›¾ç‰‡ã€åŠ¨ç”»ã€å†…å­˜ã€ç”µé‡ç­‰ç­‰éšç€ä¼˜åŒ–çš„åŠ æ·±ï¼Œä½ ä¼šå‘ç°ä¸èƒ½å±€é™åœ¨å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿéœ€è¦æ·±å…¥ã€‚</li><li>SPDY çš„ä¼˜ç‚¹å¹¶å…¥ HTTP 2.0 ä½ ä»¬æœ‰åœ¨æµ‹è¯•æˆ–ç”¨å—ï¼Ÿ</li><li>Fresco å‡ºæ¥å‰ä½ æ˜¯ä¸æ˜¯è§‰å¾—å›¾ç‰‡ç¼“å­˜å·²ç»åˆ°å¤´äº†ï¼Ÿ</li><li>Android App ä¸ºä»€ä¹ˆæ•´ä½“æµç•…æ€§æ€»æ˜¯è¢«è¯Ÿç—…ï¼Ÿâ€¦â€¦</li></ul><p>ä¸‰. å¦‚æœä½ è§‰å¾—æ²¡æœ‰éš¾ç‚¹æˆ–è€…éš¾ç‚¹åœ¨å…¼å®¹ã€UI ä¹‹ç±»é—®é¢˜ä¸Šï¼Œé‚£ä¹ˆå¯èƒ½ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>å…¬å¸ä¸šåŠ¡å‘å±•è¿‡æ…¢ï¼Œå¯¹æŠ€æœ¯çš„éœ€æ±‚ä¸å¤Ÿè¿«åˆ‡</li><li>ä¸ªäººé•¿æ—¶é—´åœ¨ä¸šåŠ¡å¼€å‘ä¸Šï¼Œè¿™ä¸ªå¯¹äºèµ°æŠ€æœ¯è·¯çº¿çš„äººæ¥è¯´æŒºéº»çƒ¦çš„ï¼Œä¸ä¸»åŠ¨å»æ¥è§¦å­¦ä¹ çš„è¯ï¼Œn å¹´ä»¥åä¹Ÿè¿˜æ˜¯è¿™ä¸ªæ ·å­ä¸ºäº†æ›´å¥½çš„ä¸ªäººæˆé•¿ï¼Œè¿™ä¸¤ç‚¹éƒ½æ˜¯éœ€è¦æ³¨æ„å’Œè§£å†³çš„é—®é¢˜ã€‚</li></ul><h4 id="2ã€ä½ è¿˜è¦ä»€ä¹ˆäº†è§£å’Œè¦é—®çš„å—ï¼Ÿ"><a href="#2ã€ä½ è¿˜è¦ä»€ä¹ˆäº†è§£å’Œè¦é—®çš„å—ï¼Ÿ" class="headerlink" title="2ã€ä½ è¿˜è¦ä»€ä¹ˆäº†è§£å’Œè¦é—®çš„å—ï¼Ÿ"></a>2ã€ä½ è¿˜è¦ä»€ä¹ˆäº†è§£å’Œè¦é—®çš„å—ï¼Ÿ</h4><p>ä½ åœ¨å…¬å¸çš„ä¸€å¤©æ˜¯å¦‚ä½•åº¦è¿‡çš„ï¼Ÿ</p><p>èƒ½å¦ç»™æˆ‘ç®€å•ä»‹ç»ä¸‹è´µå…¬å¸ä¸šåŠ¡ä¸æˆ˜ç•¥çš„æœªæ¥å‘å±•ï¼Ÿ</p><p>è´µå…¬å¸æœ€è®©ä½ è‡ªè±ªçš„ä¼ä¸šæ–‡åŒ–æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆé€‚åˆå¤§å…¬å¸ï¼‰</p><p>å›¢é˜Ÿã€å…¬å¸ç°åœ¨é¢ä¸´çš„æœ€å¤§æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¯¹äºæœªæ¥åŠ å…¥è¿™ä¸ªå›¢é˜Ÿï¼Œä½ å¯¹æˆ‘çš„æœŸæœ›æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ‚¨è§‰å¾—æˆ‘å“ªæ–¹é¢çŸ¥è¯†éœ€è¦æ·±å…¥å­¦ä¹ æˆ–è€…æˆ‘çš„ä¸è¶³åœ¨é‚£äº›æ–¹é¢ï¼Œä»Šåæˆ‘è¯¥æ³¨æ„ä»€ä¹ˆ*ï¼Ÿ</p><p>ä½ è¿˜å¯ä»¥é—®ä¸‹é¡¹ç›®å›¢é˜Ÿå¤šå°‘äººï¼Œä¸»è¦ä»¥ä»€ä¹ˆæ–¹å‘ä¸ºä¸»ï¼Œä¸€å¹´å†…çš„ç›®æ ‡æ€æ ·ï¼Œå›¢é˜Ÿæ°”æ°›æ€æ ·ï¼Œç­‰å†…å®¹ç€æ‰‹ã€‚</p><h4 id="3ã€ç ”ç©¶æ¯”è¾ƒæ·±å…¥çš„é¢†åŸŸæœ‰å“ªäº›ï¼Ÿ"><a href="#3ã€ç ”ç©¶æ¯”è¾ƒæ·±å…¥çš„é¢†åŸŸæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3ã€ç ”ç©¶æ¯”è¾ƒæ·±å…¥çš„é¢†åŸŸæœ‰å“ªäº›ï¼Ÿ"></a>3ã€ç ”ç©¶æ¯”è¾ƒæ·±å…¥çš„é¢†åŸŸæœ‰å“ªäº›ï¼Ÿ</h4><h4 id="4ã€è‡ªå·±æœ€æ“…é•¿çš„æŠ€æœ¯ç‚¹ï¼Œæœ€æ„Ÿå…´è¶£çš„æŠ€æœ¯é¢†åŸŸå’ŒæŠ€æœ¯ï¼Ÿ"><a href="#4ã€è‡ªå·±æœ€æ“…é•¿çš„æŠ€æœ¯ç‚¹ï¼Œæœ€æ„Ÿå…´è¶£çš„æŠ€æœ¯é¢†åŸŸå’ŒæŠ€æœ¯ï¼Ÿ" class="headerlink" title="4ã€è‡ªå·±æœ€æ“…é•¿çš„æŠ€æœ¯ç‚¹ï¼Œæœ€æ„Ÿå…´è¶£çš„æŠ€æœ¯é¢†åŸŸå’ŒæŠ€æœ¯ï¼Ÿ"></a>4ã€è‡ªå·±æœ€æ“…é•¿çš„æŠ€æœ¯ç‚¹ï¼Œæœ€æ„Ÿå…´è¶£çš„æŠ€æœ¯é¢†åŸŸå’ŒæŠ€æœ¯ï¼Ÿ</h4><h4 id="5ã€é¡¹ç›®ä¸­ç”¨äº†å“ªäº›å¼€æºåº“ï¼Œå¦‚ä½•é¿å…å› ä¸ºå¼•å…¥å¼€æºåº“è€Œå¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§é—®é¢˜ï¼Ÿ"><a href="#5ã€é¡¹ç›®ä¸­ç”¨äº†å“ªäº›å¼€æºåº“ï¼Œå¦‚ä½•é¿å…å› ä¸ºå¼•å…¥å¼€æºåº“è€Œå¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§é—®é¢˜ï¼Ÿ" class="headerlink" title="5ã€é¡¹ç›®ä¸­ç”¨äº†å“ªäº›å¼€æºåº“ï¼Œå¦‚ä½•é¿å…å› ä¸ºå¼•å…¥å¼€æºåº“è€Œå¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§é—®é¢˜ï¼Ÿ"></a>5ã€é¡¹ç›®ä¸­ç”¨äº†å“ªäº›å¼€æºåº“ï¼Œå¦‚ä½•é¿å…å› ä¸ºå¼•å…¥å¼€æºåº“è€Œå¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§é—®é¢˜ï¼Ÿ</h4><h4 id="6ã€è¯´ä¸‹ä½ éƒ½çœ‹è¿‡é‚£äº›æŠ€æœ¯ä¹¦ç±ï¼Œä½ æ˜¯å¦‚ä½•è‡ªå­¦çš„ã€‚ä½ è§‰å¾—è‡ªå·±çš„ä¼˜åŠ¿ä¸å¼±ç‚¹æ˜¯ä»€ä¹ˆã€‚"><a href="#6ã€è¯´ä¸‹ä½ éƒ½çœ‹è¿‡é‚£äº›æŠ€æœ¯ä¹¦ç±ï¼Œä½ æ˜¯å¦‚ä½•è‡ªå­¦çš„ã€‚ä½ è§‰å¾—è‡ªå·±çš„ä¼˜åŠ¿ä¸å¼±ç‚¹æ˜¯ä»€ä¹ˆã€‚" class="headerlink" title="6ã€è¯´ä¸‹ä½ éƒ½çœ‹è¿‡é‚£äº›æŠ€æœ¯ä¹¦ç±ï¼Œä½ æ˜¯å¦‚ä½•è‡ªå­¦çš„ã€‚ä½ è§‰å¾—è‡ªå·±çš„ä¼˜åŠ¿ä¸å¼±ç‚¹æ˜¯ä»€ä¹ˆã€‚"></a>6ã€è¯´ä¸‹ä½ éƒ½çœ‹è¿‡é‚£äº›æŠ€æœ¯ä¹¦ç±ï¼Œä½ æ˜¯å¦‚ä½•è‡ªå­¦çš„ã€‚ä½ è§‰å¾—è‡ªå·±çš„ä¼˜åŠ¿ä¸å¼±ç‚¹æ˜¯ä»€ä¹ˆã€‚</h4><h4 id="7ã€è¯´ä¸‹é¡¹ç›®ä¸­é‡åˆ°çš„æ£˜æ‰‹é—®é¢˜ï¼ŒåŒ…æ‹¬æŠ€æœ¯ï¼Œäº¤é™…å’Œæ²Ÿé€šã€‚"><a href="#7ã€è¯´ä¸‹é¡¹ç›®ä¸­é‡åˆ°çš„æ£˜æ‰‹é—®é¢˜ï¼ŒåŒ…æ‹¬æŠ€æœ¯ï¼Œäº¤é™…å’Œæ²Ÿé€šã€‚" class="headerlink" title="7ã€è¯´ä¸‹é¡¹ç›®ä¸­é‡åˆ°çš„æ£˜æ‰‹é—®é¢˜ï¼ŒåŒ…æ‹¬æŠ€æœ¯ï¼Œäº¤é™…å’Œæ²Ÿé€šã€‚"></a>7ã€è¯´ä¸‹é¡¹ç›®ä¸­é‡åˆ°çš„æ£˜æ‰‹é—®é¢˜ï¼ŒåŒ…æ‹¬æŠ€æœ¯ï¼Œäº¤é™…å’Œæ²Ÿé€šã€‚</h4><h4 id="8ã€è¯´ä¸‹ä½ è¿‘å‡ å¹´çš„è§„åˆ’ï¼Ÿ"><a href="#8ã€è¯´ä¸‹ä½ è¿‘å‡ å¹´çš„è§„åˆ’ï¼Ÿ" class="headerlink" title="8ã€è¯´ä¸‹ä½ è¿‘å‡ å¹´çš„è§„åˆ’ï¼Ÿ"></a>8ã€è¯´ä¸‹ä½ è¿‘å‡ å¹´çš„è§„åˆ’ï¼Ÿ</h4><h4 id="9ã€å¯¹åŠ ç­æ€ä¹ˆçœ‹ï¼ˆä¸è¦å¤ªæµ®å¤¸ï¼Œç°å®ä¸€ç‚¹å“¦ï¼‰ï¼Ÿ"><a href="#9ã€å¯¹åŠ ç­æ€ä¹ˆçœ‹ï¼ˆä¸è¦å¤ªæµ®å¤¸ï¼Œç°å®ä¸€ç‚¹å“¦ï¼‰ï¼Ÿ" class="headerlink" title="9ã€å¯¹åŠ ç­æ€ä¹ˆçœ‹ï¼ˆä¸è¦å¤ªæµ®å¤¸ï¼Œç°å®ä¸€ç‚¹å“¦ï¼‰ï¼Ÿ"></a>9ã€å¯¹åŠ ç­æ€ä¹ˆçœ‹ï¼ˆä¸è¦å¤ªæµ®å¤¸ï¼Œç°å®ä¸€ç‚¹å“¦ï¼‰ï¼Ÿ</h4><h4 id="10ã€ä»‹ç»ä½ åšè¿‡çš„å“ªäº›é¡¹ç›®ã€‚"><a href="#10ã€ä»‹ç»ä½ åšè¿‡çš„å“ªäº›é¡¹ç›®ã€‚" class="headerlink" title="10ã€ä»‹ç»ä½ åšè¿‡çš„å“ªäº›é¡¹ç›®ã€‚"></a>10ã€ä»‹ç»ä½ åšè¿‡çš„å“ªäº›é¡¹ç›®ã€‚</h4><h4 id="11ã€ä½ å¹¶éæ¯•ä¸šäºåç‰Œé™¢æ ¡ï¼Ÿ"><a href="#11ã€ä½ å¹¶éæ¯•ä¸šäºåç‰Œé™¢æ ¡ï¼Ÿ" class="headerlink" title="11ã€ä½ å¹¶éæ¯•ä¸šäºåç‰Œé™¢æ ¡ï¼Ÿ"></a>11ã€ä½ å¹¶éæ¯•ä¸šäºåç‰Œé™¢æ ¡ï¼Ÿ</h4><h4 id="12ã€ä¸ºä»€ä¹ˆè¦ç¦»èŒ"><a href="#12ã€ä¸ºä»€ä¹ˆè¦ç¦»èŒ" class="headerlink" title="12ã€ä¸ºä»€ä¹ˆè¦ç¦»èŒ?"></a>12ã€ä¸ºä»€ä¹ˆè¦ç¦»èŒ?</h4><h4 id="13ã€å½“ä½ çš„å¼€å‘ä»»åŠ¡å¾ˆç´§å¼ ï¼Œä½ æ€ä¹ˆå»åšä»£ç ä¼˜åŒ–çš„ï¼Ÿ"><a href="#13ã€å½“ä½ çš„å¼€å‘ä»»åŠ¡å¾ˆç´§å¼ ï¼Œä½ æ€ä¹ˆå»åšä»£ç ä¼˜åŒ–çš„ï¼Ÿ" class="headerlink" title="13ã€å½“ä½ çš„å¼€å‘ä»»åŠ¡å¾ˆç´§å¼ ï¼Œä½ æ€ä¹ˆå»åšä»£ç ä¼˜åŒ–çš„ï¼Ÿ"></a>13ã€å½“ä½ çš„å¼€å‘ä»»åŠ¡å¾ˆç´§å¼ ï¼Œä½ æ€ä¹ˆå»åšä»£ç ä¼˜åŒ–çš„ï¼Ÿ</h4><h3 id="äºŒã€æ¬¡é«˜é¢‘é¢˜é›†-ï¼ˆâ­â­ï¼‰"><a href="#äºŒã€æ¬¡é«˜é¢‘é¢˜é›†-ï¼ˆâ­â­ï¼‰" class="headerlink" title="äºŒã€æ¬¡é«˜é¢‘é¢˜é›† ï¼ˆâ­â­ï¼‰"></a>äºŒã€æ¬¡é«˜é¢‘é¢˜é›† ï¼ˆâ­â­ï¼‰</h3><h4 id="1ã€å¯¹ä¸šå†…ä¿¡æ¯çš„å…³æ³¨æ¸ é“æœ‰å“ªäº›ï¼Ÿ"><a href="#1ã€å¯¹ä¸šå†…ä¿¡æ¯çš„å…³æ³¨æ¸ é“æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="1ã€å¯¹ä¸šå†…ä¿¡æ¯çš„å…³æ³¨æ¸ é“æœ‰å“ªäº›ï¼Ÿ"></a>1ã€å¯¹ä¸šå†…ä¿¡æ¯çš„å…³æ³¨æ¸ é“æœ‰å“ªäº›ï¼Ÿ</h4><h4 id="2ã€æœ€è¿‘éƒ½è¯»å“ªäº›ä¹¦ï¼Ÿ"><a href="#2ã€æœ€è¿‘éƒ½è¯»å“ªäº›ä¹¦ï¼Ÿ" class="headerlink" title="2ã€æœ€è¿‘éƒ½è¯»å“ªäº›ä¹¦ï¼Ÿ"></a>2ã€æœ€è¿‘éƒ½è¯»å“ªäº›ä¹¦ï¼Ÿ</h4><h4 id="3ã€ç»™ä½ ä¸€ä¸ªé¡¹ç›®ï¼Œä½ æ€ä¹ˆçœ‹å¾…ä»–çš„å¸‚åœºå’ŒæŠ€æœ¯çš„å…³ç³»ï¼Ÿ"><a href="#3ã€ç»™ä½ ä¸€ä¸ªé¡¹ç›®ï¼Œä½ æ€ä¹ˆçœ‹å¾…ä»–çš„å¸‚åœºå’ŒæŠ€æœ¯çš„å…³ç³»ï¼Ÿ" class="headerlink" title="3ã€ç»™ä½ ä¸€ä¸ªé¡¹ç›®ï¼Œä½ æ€ä¹ˆçœ‹å¾…ä»–çš„å¸‚åœºå’ŒæŠ€æœ¯çš„å…³ç³»ï¼Ÿ"></a>3ã€ç»™ä½ ä¸€ä¸ªé¡¹ç›®ï¼Œä½ æ€ä¹ˆçœ‹å¾…ä»–çš„å¸‚åœºå’ŒæŠ€æœ¯çš„å…³ç³»ï¼Ÿ</h4><h4 id="4ã€ä½ ä»¥å¾€çš„é¡¹ç›®ä¸­ï¼Œä»¥ä½ ç°åœ¨çš„çœ¼å…‰å»è¯„ä»·é¡¹ç›®çš„åˆ©å¼Šï¼Ÿ"><a href="#4ã€ä½ ä»¥å¾€çš„é¡¹ç›®ä¸­ï¼Œä»¥ä½ ç°åœ¨çš„çœ¼å…‰å»è¯„ä»·é¡¹ç›®çš„åˆ©å¼Šï¼Ÿ" class="headerlink" title="4ã€ä½ ä»¥å¾€çš„é¡¹ç›®ä¸­ï¼Œä»¥ä½ ç°åœ¨çš„çœ¼å…‰å»è¯„ä»·é¡¹ç›®çš„åˆ©å¼Šï¼Ÿ"></a>4ã€ä½ ä»¥å¾€çš„é¡¹ç›®ä¸­ï¼Œä»¥ä½ ç°åœ¨çš„çœ¼å…‰å»è¯„ä»·é¡¹ç›®çš„åˆ©å¼Šï¼Ÿ</h4><h4 id="5ã€å¯¹äºéç«‹é¡¹ï¼ˆKPIï¼‰é¡¹ç›®ï¼Œæ€ä¹ˆæ¨è¿›ï¼Ÿ"><a href="#5ã€å¯¹äºéç«‹é¡¹ï¼ˆKPIï¼‰é¡¹ç›®ï¼Œæ€ä¹ˆæ¨è¿›ï¼Ÿ" class="headerlink" title="5ã€å¯¹äºéç«‹é¡¹ï¼ˆKPIï¼‰é¡¹ç›®ï¼Œæ€ä¹ˆæ¨è¿›ï¼Ÿ"></a>5ã€å¯¹äºéç«‹é¡¹ï¼ˆKPIï¼‰é¡¹ç›®ï¼Œæ€ä¹ˆæ¨è¿›ï¼Ÿ</h4><h4 id="6ã€éƒ½ä½¿ç”¨è¿‡å“ªäº›è‡ªå®šä¹‰æ§ä»¶ï¼Ÿ"><a href="#6ã€éƒ½ä½¿ç”¨è¿‡å“ªäº›è‡ªå®šä¹‰æ§ä»¶ï¼Ÿ" class="headerlink" title="6ã€éƒ½ä½¿ç”¨è¿‡å“ªäº›è‡ªå®šä¹‰æ§ä»¶ï¼Ÿ"></a>6ã€éƒ½ä½¿ç”¨è¿‡å“ªäº›è‡ªå®šä¹‰æ§ä»¶ï¼Ÿ</h4><h4 id="7ã€é™¤äº†ç®€å†ä¸Šçš„å·¥ä½œç»å†ï¼Œæ‚¨è¿˜ä¼šå»å…³æ³¨å“ªäº›é¢†åŸŸï¼Ÿ"><a href="#7ã€é™¤äº†ç®€å†ä¸Šçš„å·¥ä½œç»å†ï¼Œæ‚¨è¿˜ä¼šå»å…³æ³¨å“ªäº›é¢†åŸŸï¼Ÿ" class="headerlink" title="7ã€é™¤äº†ç®€å†ä¸Šçš„å·¥ä½œç»å†ï¼Œæ‚¨è¿˜ä¼šå»å…³æ³¨å“ªäº›é¢†åŸŸï¼Ÿ"></a>7ã€é™¤äº†ç®€å†ä¸Šçš„å·¥ä½œç»å†ï¼Œæ‚¨è¿˜ä¼šå»å…³æ³¨å“ªäº›é¢†åŸŸï¼Ÿ</h4><h4 id="8ã€è¯„ä»·ä¸‹è‡ªå·±ï¼Œè¯„ä»·ä¸‹è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œä¸ªäººä»£ç é‡å¦‚ä½•ï¼Ÿ"><a href="#8ã€è¯„ä»·ä¸‹è‡ªå·±ï¼Œè¯„ä»·ä¸‹è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œä¸ªäººä»£ç é‡å¦‚ä½•ï¼Ÿ" class="headerlink" title="8ã€è¯„ä»·ä¸‹è‡ªå·±ï¼Œè¯„ä»·ä¸‹è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œä¸ªäººä»£ç é‡å¦‚ä½•ï¼Ÿ"></a>8ã€è¯„ä»·ä¸‹è‡ªå·±ï¼Œè¯„ä»·ä¸‹è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œä¸ªäººä»£ç é‡å¦‚ä½•ï¼Ÿ</h4><h4 id="9ã€ä½ æœ‹å‹å¯¹ä½ çš„è¯„ä»·ï¼Ÿ"><a href="#9ã€ä½ æœ‹å‹å¯¹ä½ çš„è¯„ä»·ï¼Ÿ" class="headerlink" title="9ã€ä½ æœ‹å‹å¯¹ä½ çš„è¯„ä»·ï¼Ÿ"></a>9ã€ä½ æœ‹å‹å¯¹ä½ çš„è¯„ä»·ï¼Ÿ</h4><h4 id="10ã€è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¹¶ä¸¾ä¾‹è¯´æ˜ï¼Ÿ"><a href="#10ã€è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¹¶ä¸¾ä¾‹è¯´æ˜ï¼Ÿ" class="headerlink" title="10ã€è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¹¶ä¸¾ä¾‹è¯´æ˜ï¼Ÿ"></a>10ã€è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¹¶ä¸¾ä¾‹è¯´æ˜ï¼Ÿ</h4><h4 id="11ã€ä½ è§‰å¾—ä½ ä¸ªæ€§ä¸Šæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#11ã€ä½ è§‰å¾—ä½ ä¸ªæ€§ä¸Šæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="11ã€ä½ è§‰å¾—ä½ ä¸ªæ€§ä¸Šæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>11ã€ä½ è§‰å¾—ä½ ä¸ªæ€§ä¸Šæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h4><h4 id="12ã€è¯´è¯´ä½ æœ€å¤§çš„ç¼ºç‚¹ï¼Ÿ"><a href="#12ã€è¯´è¯´ä½ æœ€å¤§çš„ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="12ã€è¯´è¯´ä½ æœ€å¤§çš„ç¼ºç‚¹ï¼Ÿ"></a>12ã€è¯´è¯´ä½ æœ€å¤§çš„ç¼ºç‚¹ï¼Ÿ</h4><h4 id="13ã€æœ€èƒ½æ¦‚æ‹¬ä½ è‡ªå·±çš„ä¸‰ä¸ªè¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#13ã€æœ€èƒ½æ¦‚æ‹¬ä½ è‡ªå·±çš„ä¸‰ä¸ªè¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="13ã€æœ€èƒ½æ¦‚æ‹¬ä½ è‡ªå·±çš„ä¸‰ä¸ªè¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>13ã€æœ€èƒ½æ¦‚æ‹¬ä½ è‡ªå·±çš„ä¸‰ä¸ªè¯æ˜¯ä»€ä¹ˆï¼Ÿ</h4><h4 id="14ã€è¯´è¯´ä½ çš„å®¶åº­ï¼Ÿ"><a href="#14ã€è¯´è¯´ä½ çš„å®¶åº­ï¼Ÿ" class="headerlink" title="14ã€è¯´è¯´ä½ çš„å®¶åº­ï¼Ÿ"></a>14ã€è¯´è¯´ä½ çš„å®¶åº­ï¼Ÿ</h4><h4 id="15ã€é™¤äº†æœ¬å…¬å¸å¤–ï¼Œè¿˜åº”è˜äº†å“ªäº›å…¬å¸ï¼Ÿï¼ˆç±»ä¼¼é—®é¢˜ï¼šå½“å‰çš„offerçŠ¶å†µï¼‰"><a href="#15ã€é™¤äº†æœ¬å…¬å¸å¤–ï¼Œè¿˜åº”è˜äº†å“ªäº›å…¬å¸ï¼Ÿï¼ˆç±»ä¼¼é—®é¢˜ï¼šå½“å‰çš„offerçŠ¶å†µï¼‰" class="headerlink" title="15ã€é™¤äº†æœ¬å…¬å¸å¤–ï¼Œè¿˜åº”è˜äº†å“ªäº›å…¬å¸ï¼Ÿï¼ˆç±»ä¼¼é—®é¢˜ï¼šå½“å‰çš„offerçŠ¶å†µï¼‰"></a>15ã€é™¤äº†æœ¬å…¬å¸å¤–ï¼Œè¿˜åº”è˜äº†å“ªäº›å…¬å¸ï¼Ÿï¼ˆç±»ä¼¼é—®é¢˜ï¼šå½“å‰çš„offerçŠ¶å†µï¼‰</h4><h4 id="16ã€é€šè¿‡å“ªäº›æ¸ é“äº†è§£çš„æ‹›è˜ä¿¡æ¯ï¼Ÿ"><a href="#16ã€é€šè¿‡å“ªäº›æ¸ é“äº†è§£çš„æ‹›è˜ä¿¡æ¯ï¼Ÿ" class="headerlink" title="16ã€é€šè¿‡å“ªäº›æ¸ é“äº†è§£çš„æ‹›è˜ä¿¡æ¯ï¼Ÿ"></a>16ã€é€šè¿‡å“ªäº›æ¸ é“äº†è§£çš„æ‹›è˜ä¿¡æ¯ï¼Ÿ</h4><h4 id="17ã€ä½ çš„ä¸šä½™çˆ±å¥½æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#17ã€ä½ çš„ä¸šä½™çˆ±å¥½æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="17ã€ä½ çš„ä¸šä½™çˆ±å¥½æ˜¯ä»€ä¹ˆï¼Ÿ"></a>17ã€ä½ çš„ä¸šä½™çˆ±å¥½æ˜¯ä»€ä¹ˆï¼Ÿ</h4><h4 id="18ã€ä½ åšè¿‡çš„å“ªä»¶äº‹æœ€ä»¤è‡ªå·±æ„Ÿåˆ°éª„å‚²ï¼Ÿ"><a href="#18ã€ä½ åšè¿‡çš„å“ªä»¶äº‹æœ€ä»¤è‡ªå·±æ„Ÿåˆ°éª„å‚²ï¼Ÿ" class="headerlink" title="18ã€ä½ åšè¿‡çš„å“ªä»¶äº‹æœ€ä»¤è‡ªå·±æ„Ÿåˆ°éª„å‚²ï¼Ÿ"></a>18ã€ä½ åšè¿‡çš„å“ªä»¶äº‹æœ€ä»¤è‡ªå·±æ„Ÿåˆ°éª„å‚²ï¼Ÿ</h4><h4 id="19ã€è°ˆè°ˆä½ å¯¹è·³æ§½çš„çœ‹æ³•ï¼Ÿ"><a href="#19ã€è°ˆè°ˆä½ å¯¹è·³æ§½çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="19ã€è°ˆè°ˆä½ å¯¹è·³æ§½çš„çœ‹æ³•ï¼Ÿ"></a>19ã€è°ˆè°ˆä½ å¯¹è·³æ§½çš„çœ‹æ³•ï¼Ÿ</h4><h4 id="20ã€æ€æ ·çœ‹å¾…å­¦å†å’Œèƒ½åŠ›ï¼Ÿ"><a href="#20ã€æ€æ ·çœ‹å¾…å­¦å†å’Œèƒ½åŠ›ï¼Ÿ" class="headerlink" title="20ã€æ€æ ·çœ‹å¾…å­¦å†å’Œèƒ½åŠ›ï¼Ÿ"></a>20ã€æ€æ ·çœ‹å¾…å­¦å†å’Œèƒ½åŠ›ï¼Ÿ</h4><h4 id="21ã€æ‚¨è·Ÿæ‚¨çš„ä¸»ç®¡æˆ–ç›´æ¥ä¸Šå¸æœ‰æ²¡æœ‰é’ˆå¯¹ä»¥ä¸Šç¦»èŒåŸå› çš„è¿™äº›é—®é¢˜æ²Ÿé€šè¿‡ï¼Ÿå¦‚æœæ²¡æœ‰è¯·è¯´æ˜åŸå› ã€‚å¦‚æœæœ‰è¯·è¯´ä¸€ä¸‹è¿‡ç¨‹å’Œç»“æœï¼Ÿ"><a href="#21ã€æ‚¨è·Ÿæ‚¨çš„ä¸»ç®¡æˆ–ç›´æ¥ä¸Šå¸æœ‰æ²¡æœ‰é’ˆå¯¹ä»¥ä¸Šç¦»èŒåŸå› çš„è¿™äº›é—®é¢˜æ²Ÿé€šè¿‡ï¼Ÿå¦‚æœæ²¡æœ‰è¯·è¯´æ˜åŸå› ã€‚å¦‚æœæœ‰è¯·è¯´ä¸€ä¸‹è¿‡ç¨‹å’Œç»“æœï¼Ÿ" class="headerlink" title="21ã€æ‚¨è·Ÿæ‚¨çš„ä¸»ç®¡æˆ–ç›´æ¥ä¸Šå¸æœ‰æ²¡æœ‰é’ˆå¯¹ä»¥ä¸Šç¦»èŒåŸå› çš„è¿™äº›é—®é¢˜æ²Ÿé€šè¿‡ï¼Ÿå¦‚æœæ²¡æœ‰è¯·è¯´æ˜åŸå› ã€‚å¦‚æœæœ‰è¯·è¯´ä¸€ä¸‹è¿‡ç¨‹å’Œç»“æœï¼Ÿ"></a>21ã€æ‚¨è·Ÿæ‚¨çš„ä¸»ç®¡æˆ–ç›´æ¥ä¸Šå¸æœ‰æ²¡æœ‰é’ˆå¯¹ä»¥ä¸Šç¦»èŒåŸå› çš„è¿™äº›é—®é¢˜æ²Ÿé€šè¿‡ï¼Ÿå¦‚æœæ²¡æœ‰è¯·è¯´æ˜åŸå› ã€‚å¦‚æœæœ‰è¯·è¯´ä¸€ä¸‹è¿‡ç¨‹å’Œç»“æœï¼Ÿ</h4><h4 id="22ã€æ‚¨è§‰å¾—ä½ å…³æ³¨çš„è¿™äº›é¢†åŸŸè·Ÿæ‚¨ç›®å‰ä»äº‹çš„èŒä¸šæœ‰å“ªäº›åˆ©å¼Šå…³ç³»ï¼Ÿå¦‚æœæœ‰è¯·è¯´æ˜åˆ©å¼Šå…³ç³»ï¼Ÿ"><a href="#22ã€æ‚¨è§‰å¾—ä½ å…³æ³¨çš„è¿™äº›é¢†åŸŸè·Ÿæ‚¨ç›®å‰ä»äº‹çš„èŒä¸šæœ‰å“ªäº›åˆ©å¼Šå…³ç³»ï¼Ÿå¦‚æœæœ‰è¯·è¯´æ˜åˆ©å¼Šå…³ç³»ï¼Ÿ" class="headerlink" title="22ã€æ‚¨è§‰å¾—ä½ å…³æ³¨çš„è¿™äº›é¢†åŸŸè·Ÿæ‚¨ç›®å‰ä»äº‹çš„èŒä¸šæœ‰å“ªäº›åˆ©å¼Šå…³ç³»ï¼Ÿå¦‚æœæœ‰è¯·è¯´æ˜åˆ©å¼Šå…³ç³»ï¼Ÿ"></a>22ã€æ‚¨è§‰å¾—ä½ å…³æ³¨çš„è¿™äº›é¢†åŸŸè·Ÿæ‚¨ç›®å‰ä»äº‹çš„èŒä¸šæœ‰å“ªäº›åˆ©å¼Šå…³ç³»ï¼Ÿå¦‚æœæœ‰è¯·è¯´æ˜åˆ©å¼Šå…³ç³»ï¼Ÿ</h4><h4 id="23ã€æ‚¨åœ¨é€‰æ‹©å·¥ä½œä¸­æ›´çœ‹é‡çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¯èƒ½æ˜¯æˆé•¿ç©ºé—´ã€åŸ¹è®­æœºä¼šã€å‘æŒ¥å¹³å°ã€è–ªé…¬ç­‰ç­”æ¡ˆï¼‰"><a href="#23ã€æ‚¨åœ¨é€‰æ‹©å·¥ä½œä¸­æ›´çœ‹é‡çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¯èƒ½æ˜¯æˆé•¿ç©ºé—´ã€åŸ¹è®­æœºä¼šã€å‘æŒ¥å¹³å°ã€è–ªé…¬ç­‰ç­”æ¡ˆï¼‰" class="headerlink" title="23ã€æ‚¨åœ¨é€‰æ‹©å·¥ä½œä¸­æ›´çœ‹é‡çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¯èƒ½æ˜¯æˆé•¿ç©ºé—´ã€åŸ¹è®­æœºä¼šã€å‘æŒ¥å¹³å°ã€è–ªé…¬ç­‰ç­”æ¡ˆï¼‰"></a>23ã€æ‚¨åœ¨é€‰æ‹©å·¥ä½œä¸­æ›´çœ‹é‡çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¯èƒ½æ˜¯æˆé•¿ç©ºé—´ã€åŸ¹è®­æœºä¼šã€å‘æŒ¥å¹³å°ã€è–ªé…¬ç­‰ç­”æ¡ˆï¼‰</h4><h4 id="24ã€æ‚¨å¯ä¸å¯ä»¥è¯´è¯´æ‚¨åœ¨è–ªé…¬æ–¹é¢çš„å¿ƒé‡Œé¢„æœŸï¼Ÿ"><a href="#24ã€æ‚¨å¯ä¸å¯ä»¥è¯´è¯´æ‚¨åœ¨è–ªé…¬æ–¹é¢çš„å¿ƒé‡Œé¢„æœŸï¼Ÿ" class="headerlink" title="24ã€æ‚¨å¯ä¸å¯ä»¥è¯´è¯´æ‚¨åœ¨è–ªé…¬æ–¹é¢çš„å¿ƒé‡Œé¢„æœŸï¼Ÿ"></a>24ã€æ‚¨å¯ä¸å¯ä»¥è¯´è¯´æ‚¨åœ¨è–ªé…¬æ–¹é¢çš„å¿ƒé‡Œé¢„æœŸï¼Ÿ</h4><h4 id="25ã€æœ‰äººè¯´æŒ£æœªæ¥æ¯”æŒ£é’±æ›´ä¸ºé‡è¦ï¼Œæ‚¨æ€ä¹ˆç†è§£ï¼Ÿ"><a href="#25ã€æœ‰äººè¯´æŒ£æœªæ¥æ¯”æŒ£é’±æ›´ä¸ºé‡è¦ï¼Œæ‚¨æ€ä¹ˆç†è§£ï¼Ÿ" class="headerlink" title="25ã€æœ‰äººè¯´æŒ£æœªæ¥æ¯”æŒ£é’±æ›´ä¸ºé‡è¦ï¼Œæ‚¨æ€ä¹ˆç†è§£ï¼Ÿ"></a>25ã€æœ‰äººè¯´æŒ£æœªæ¥æ¯”æŒ£é’±æ›´ä¸ºé‡è¦ï¼Œæ‚¨æ€ä¹ˆç†è§£ï¼Ÿ</h4><h4 id="26ã€å‡è®¾ï¼ŒæŸä¸€å¤©ï¼Œåœ¨å·¥ä½œåŠå…¬å®¤èµ°å»Šï¼Œæ‚¨å’Œä¸€ä½åŒäº‹æ­£åœ¨æŠ±æ€¨ä¸Šçº§é™ˆæŸå¹³æ—¶åšäº‹ç¼ºä¹å…¬å¹³æ€§ï¼Œæ°å·§è¢«é™ˆæŸå¬åˆ°ï¼Œæ‚¨ä¼šæ€ä¹ˆåŠï¼Ÿ"><a href="#26ã€å‡è®¾ï¼ŒæŸä¸€å¤©ï¼Œåœ¨å·¥ä½œåŠå…¬å®¤èµ°å»Šï¼Œæ‚¨å’Œä¸€ä½åŒäº‹æ­£åœ¨æŠ±æ€¨ä¸Šçº§é™ˆæŸå¹³æ—¶åšäº‹ç¼ºä¹å…¬å¹³æ€§ï¼Œæ°å·§è¢«é™ˆæŸå¬åˆ°ï¼Œæ‚¨ä¼šæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="26ã€å‡è®¾ï¼ŒæŸä¸€å¤©ï¼Œåœ¨å·¥ä½œåŠå…¬å®¤èµ°å»Šï¼Œæ‚¨å’Œä¸€ä½åŒäº‹æ­£åœ¨æŠ±æ€¨ä¸Šçº§é™ˆæŸå¹³æ—¶åšäº‹ç¼ºä¹å…¬å¹³æ€§ï¼Œæ°å·§è¢«é™ˆæŸå¬åˆ°ï¼Œæ‚¨ä¼šæ€ä¹ˆåŠï¼Ÿ"></a>26ã€å‡è®¾ï¼ŒæŸä¸€å¤©ï¼Œåœ¨å·¥ä½œåŠå…¬å®¤èµ°å»Šï¼Œæ‚¨å’Œä¸€ä½åŒäº‹æ­£åœ¨æŠ±æ€¨ä¸Šçº§é™ˆæŸå¹³æ—¶åšäº‹ç¼ºä¹å…¬å¹³æ€§ï¼Œæ°å·§è¢«é™ˆæŸå¬åˆ°ï¼Œæ‚¨ä¼šæ€ä¹ˆåŠï¼Ÿ</h4><h4 id="27ã€æ€ä¹ˆæ ·å¤„ç†å·¥ä½œå’Œç”Ÿæ´»çš„å…³ç³»ï¼Ÿæ€ä¹ˆå¤„ç†åœ¨å·¥ä½œä¸­é‡åˆ°å›°éš¾ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜"><a href="#27ã€æ€ä¹ˆæ ·å¤„ç†å·¥ä½œå’Œç”Ÿæ´»çš„å…³ç³»ï¼Ÿæ€ä¹ˆå¤„ç†åœ¨å·¥ä½œä¸­é‡åˆ°å›°éš¾ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="27ã€æ€ä¹ˆæ ·å¤„ç†å·¥ä½œå’Œç”Ÿæ´»çš„å…³ç³»ï¼Ÿæ€ä¹ˆå¤„ç†åœ¨å·¥ä½œä¸­é‡åˆ°å›°éš¾ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜"></a>27ã€æ€ä¹ˆæ ·å¤„ç†å·¥ä½œå’Œç”Ÿæ´»çš„å…³ç³»ï¼Ÿæ€ä¹ˆå¤„ç†åœ¨å·¥ä½œä¸­é‡åˆ°å›°éš¾ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜</h4><h4 id="28ã€åœ¨æ‚¨çš„ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨æœ€ä¸å–œæ¬¢å’Œä»€ä¹ˆæ ·çš„äººå…±äº‹ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸¾ä¾‹è¯´æ˜ã€‚"><a href="#28ã€åœ¨æ‚¨çš„ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨æœ€ä¸å–œæ¬¢å’Œä»€ä¹ˆæ ·çš„äººå…±äº‹ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸¾ä¾‹è¯´æ˜ã€‚" class="headerlink" title="28ã€åœ¨æ‚¨çš„ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨æœ€ä¸å–œæ¬¢å’Œä»€ä¹ˆæ ·çš„äººå…±äº‹ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸¾ä¾‹è¯´æ˜ã€‚"></a>28ã€åœ¨æ‚¨çš„ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨æœ€ä¸å–œæ¬¢å’Œä»€ä¹ˆæ ·çš„äººå…±äº‹ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸¾ä¾‹è¯´æ˜ã€‚</h4><h4 id="29ã€åœ¨æ‚¨è®¤è¯†çš„äººä¸­ï¼Œæœ‰æ²¡æœ‰äººä¸å–œæ¬¢æ‚¨ï¼Ÿä¸ºä»€ä¹ˆä¸å–œæ¬¢æ‚¨ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚"><a href="#29ã€åœ¨æ‚¨è®¤è¯†çš„äººä¸­ï¼Œæœ‰æ²¡æœ‰äººä¸å–œæ¬¢æ‚¨ï¼Ÿä¸ºä»€ä¹ˆä¸å–œæ¬¢æ‚¨ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚" class="headerlink" title="29ã€åœ¨æ‚¨è®¤è¯†çš„äººä¸­ï¼Œæœ‰æ²¡æœ‰äººä¸å–œæ¬¢æ‚¨ï¼Ÿä¸ºä»€ä¹ˆä¸å–œæ¬¢æ‚¨ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚"></a>29ã€åœ¨æ‚¨è®¤è¯†çš„äººä¸­ï¼Œæœ‰æ²¡æœ‰äººä¸å–œæ¬¢æ‚¨ï¼Ÿä¸ºä»€ä¹ˆä¸å–œæ¬¢æ‚¨ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚</h4><h4 id="30ã€å½“è€æ¿-ä¸Šå¸-åŒäº‹-å®¢æˆ·è¯¯ä¼šä½ ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ"><a href="#30ã€å½“è€æ¿-ä¸Šå¸-åŒäº‹-å®¢æˆ·è¯¯ä¼šä½ ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="30ã€å½“è€æ¿/ä¸Šå¸/åŒäº‹/å®¢æˆ·è¯¯ä¼šä½ ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ"></a>30ã€å½“è€æ¿/ä¸Šå¸/åŒäº‹/å®¢æˆ·è¯¯ä¼šä½ ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ</h4><h4 id="31ã€å½“ä½ å‘ç°å…¶ä»–éƒ¨é—¨çš„å·¥ä½œç–æ¼å·²ç»å½±å“åˆ°æ‚¨çš„å·¥ä½œç»©æ•ˆæ—¶ï¼Œæ‚¨æ€ä¹ˆåŠï¼Ÿ"><a href="#31ã€å½“ä½ å‘ç°å…¶ä»–éƒ¨é—¨çš„å·¥ä½œç–æ¼å·²ç»å½±å“åˆ°æ‚¨çš„å·¥ä½œç»©æ•ˆæ—¶ï¼Œæ‚¨æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="31ã€å½“ä½ å‘ç°å…¶ä»–éƒ¨é—¨çš„å·¥ä½œç–æ¼å·²ç»å½±å“åˆ°æ‚¨çš„å·¥ä½œç»©æ•ˆæ—¶ï¼Œæ‚¨æ€ä¹ˆåŠï¼Ÿ"></a>31ã€å½“ä½ å‘ç°å…¶ä»–éƒ¨é—¨çš„å·¥ä½œç–æ¼å·²ç»å½±å“åˆ°æ‚¨çš„å·¥ä½œç»©æ•ˆæ—¶ï¼Œæ‚¨æ€ä¹ˆåŠï¼Ÿ</h4><h4 id="32ã€æ‚¨å¸Œæœ›åœ¨ä»€ä¹ˆæ ·çš„é¢†å¯¼ä¸‹å·¥ä½œï¼Ÿ"><a href="#32ã€æ‚¨å¸Œæœ›åœ¨ä»€ä¹ˆæ ·çš„é¢†å¯¼ä¸‹å·¥ä½œï¼Ÿ" class="headerlink" title="32ã€æ‚¨å¸Œæœ›åœ¨ä»€ä¹ˆæ ·çš„é¢†å¯¼ä¸‹å·¥ä½œï¼Ÿ"></a>32ã€æ‚¨å¸Œæœ›åœ¨ä»€ä¹ˆæ ·çš„é¢†å¯¼ä¸‹å·¥ä½œï¼Ÿ</h4><h4 id="33ã€æˆ‘ä»¬å·¥ä½œä¸ç”Ÿæ´»å†ç¨‹å¹¶ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œè°ˆè°ˆæ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ä¸­å‡ºç°çš„æŒ«æŠ˜æˆ–ä½æ½®æœŸï¼Œæ‚¨å¦‚ä½•å…‹æœï¼Ÿ"><a href="#33ã€æˆ‘ä»¬å·¥ä½œä¸ç”Ÿæ´»å†ç¨‹å¹¶ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œè°ˆè°ˆæ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ä¸­å‡ºç°çš„æŒ«æŠ˜æˆ–ä½æ½®æœŸï¼Œæ‚¨å¦‚ä½•å…‹æœï¼Ÿ" class="headerlink" title="33ã€æˆ‘ä»¬å·¥ä½œä¸ç”Ÿæ´»å†ç¨‹å¹¶ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œè°ˆè°ˆæ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ä¸­å‡ºç°çš„æŒ«æŠ˜æˆ–ä½æ½®æœŸï¼Œæ‚¨å¦‚ä½•å…‹æœï¼Ÿ"></a>33ã€æˆ‘ä»¬å·¥ä½œä¸ç”Ÿæ´»å†ç¨‹å¹¶ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œè°ˆè°ˆæ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ä¸­å‡ºç°çš„æŒ«æŠ˜æˆ–ä½æ½®æœŸï¼Œæ‚¨å¦‚ä½•å…‹æœï¼Ÿ</h4><h4 id="34ã€å‡å¦‚æ‚¨çš„ä¸Šå¸æ˜¯ä¸€ä¸ªéå¸¸ä¸¥å‰ã€é¢†å¯¼æ‰‹è…•å¼ºç¡¬ï¼Œæ—¶å¸¸ç»™æ‚¨å·¨å¤§å‹åŠ›çš„äººï¼Œæ‚¨è§‰å¾—è¿™ç§é¢†å¯¼æ–¹å¼å¯¹æ‚¨æœ‰ä½•åˆ©ã€å¼Šï¼Ÿ"><a href="#34ã€å‡å¦‚æ‚¨çš„ä¸Šå¸æ˜¯ä¸€ä¸ªéå¸¸ä¸¥å‰ã€é¢†å¯¼æ‰‹è…•å¼ºç¡¬ï¼Œæ—¶å¸¸ç»™æ‚¨å·¨å¤§å‹åŠ›çš„äººï¼Œæ‚¨è§‰å¾—è¿™ç§é¢†å¯¼æ–¹å¼å¯¹æ‚¨æœ‰ä½•åˆ©ã€å¼Šï¼Ÿ" class="headerlink" title="34ã€å‡å¦‚æ‚¨çš„ä¸Šå¸æ˜¯ä¸€ä¸ªéå¸¸ä¸¥å‰ã€é¢†å¯¼æ‰‹è…•å¼ºç¡¬ï¼Œæ—¶å¸¸ç»™æ‚¨å·¨å¤§å‹åŠ›çš„äººï¼Œæ‚¨è§‰å¾—è¿™ç§é¢†å¯¼æ–¹å¼å¯¹æ‚¨æœ‰ä½•åˆ©ã€å¼Šï¼Ÿ"></a>34ã€å‡å¦‚æ‚¨çš„ä¸Šå¸æ˜¯ä¸€ä¸ªéå¸¸ä¸¥å‰ã€é¢†å¯¼æ‰‹è…•å¼ºç¡¬ï¼Œæ—¶å¸¸ç»™æ‚¨å·¨å¤§å‹åŠ›çš„äººï¼Œæ‚¨è§‰å¾—è¿™ç§é¢†å¯¼æ–¹å¼å¯¹æ‚¨æœ‰ä½•åˆ©ã€å¼Šï¼Ÿ</h4><h4 id="35ã€æ‚¨çš„é¢†å¯¼ç»™æ‚¨å¸ƒç½®äº†ä¸€é¡¹æ‚¨ä»¥å‰ä»æœªè§¦åŠè¿‡çš„ä»»åŠ¡ï¼Œæ‚¨æ‰“ç®—å¦‚ä½•å»å®Œæˆå®ƒï¼Ÿï¼ˆå¦‚æœæœ‰ç±»ä¼¼çš„ç»å†è¯´è¯´å®Œæˆçš„ç»å†ã€‚"><a href="#35ã€æ‚¨çš„é¢†å¯¼ç»™æ‚¨å¸ƒç½®äº†ä¸€é¡¹æ‚¨ä»¥å‰ä»æœªè§¦åŠè¿‡çš„ä»»åŠ¡ï¼Œæ‚¨æ‰“ç®—å¦‚ä½•å»å®Œæˆå®ƒï¼Ÿï¼ˆå¦‚æœæœ‰ç±»ä¼¼çš„ç»å†è¯´è¯´å®Œæˆçš„ç»å†ã€‚" class="headerlink" title="35ã€æ‚¨çš„é¢†å¯¼ç»™æ‚¨å¸ƒç½®äº†ä¸€é¡¹æ‚¨ä»¥å‰ä»æœªè§¦åŠè¿‡çš„ä»»åŠ¡ï¼Œæ‚¨æ‰“ç®—å¦‚ä½•å»å®Œæˆå®ƒï¼Ÿï¼ˆå¦‚æœæœ‰ç±»ä¼¼çš„ç»å†è¯´è¯´å®Œæˆçš„ç»å†ã€‚)"></a>35ã€æ‚¨çš„é¢†å¯¼ç»™æ‚¨å¸ƒç½®äº†ä¸€é¡¹æ‚¨ä»¥å‰ä»æœªè§¦åŠè¿‡çš„ä»»åŠ¡ï¼Œæ‚¨æ‰“ç®—å¦‚ä½•å»å®Œæˆå®ƒï¼Ÿï¼ˆå¦‚æœæœ‰ç±»ä¼¼çš„ç»å†è¯´è¯´å®Œæˆçš„ç»å†ã€‚)</h4><h4 id="36ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰å‹åŠ›çš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´æ˜¯å¦‚ä½•å…‹æœçš„ã€‚"><a href="#36ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰å‹åŠ›çš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´æ˜¯å¦‚ä½•å…‹æœçš„ã€‚" class="headerlink" title="36ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰å‹åŠ›çš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´æ˜¯å¦‚ä½•å…‹æœçš„ã€‚"></a>36ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰å‹åŠ›çš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´æ˜¯å¦‚ä½•å…‹æœçš„ã€‚</h4><h4 id="37ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­ä»¤æ‚¨æœ‰æˆå°±æ„Ÿçš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´å®ƒç»™æ‚¨çš„å¯ç¤ºã€‚"><a href="#37ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­ä»¤æ‚¨æœ‰æˆå°±æ„Ÿçš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´å®ƒç»™æ‚¨çš„å¯ç¤ºã€‚" class="headerlink" title="37ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­ä»¤æ‚¨æœ‰æˆå°±æ„Ÿçš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´å®ƒç»™æ‚¨çš„å¯ç¤ºã€‚"></a>37ã€è°ˆè°ˆæ‚¨ä»¥å¾€èŒä¸šç”Ÿæ¶¯ä¸­ä»¤æ‚¨æœ‰æˆå°±æ„Ÿçš„ä¸€ã€ä¸¤ä»¶äº‹ï¼Œå¹¶è¯´è¯´å®ƒç»™æ‚¨çš„å¯ç¤ºã€‚</h4><h4 id="38ã€è¯·æ‚¨ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜åœ¨å®Œæˆä¸€é¡¹é‡è¦ä»»åŠ¡æ—¶ï¼Œæ‚¨æ˜¯æ€æ ·å’Œä»–äººè¿›è¡Œæœ‰æ•ˆåˆä½œçš„ã€‚"><a href="#38ã€è¯·æ‚¨ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜åœ¨å®Œæˆä¸€é¡¹é‡è¦ä»»åŠ¡æ—¶ï¼Œæ‚¨æ˜¯æ€æ ·å’Œä»–äººè¿›è¡Œæœ‰æ•ˆåˆä½œçš„ã€‚" class="headerlink" title="38ã€è¯·æ‚¨ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜åœ¨å®Œæˆä¸€é¡¹é‡è¦ä»»åŠ¡æ—¶ï¼Œæ‚¨æ˜¯æ€æ ·å’Œä»–äººè¿›è¡Œæœ‰æ•ˆåˆä½œçš„ã€‚"></a>38ã€è¯·æ‚¨ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜åœ¨å®Œæˆä¸€é¡¹é‡è¦ä»»åŠ¡æ—¶ï¼Œæ‚¨æ˜¯æ€æ ·å’Œä»–äººè¿›è¡Œæœ‰æ•ˆåˆä½œçš„ã€‚</h4><h4 id="39ã€å½“ä½ è¦ç‰ºç‰²è‡ªå·±çš„æŸäº›æ–¹é¢ä¸ä»–äººå…±äº‹æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ"><a href="#39ã€å½“ä½ è¦ç‰ºç‰²è‡ªå·±çš„æŸäº›æ–¹é¢ä¸ä»–äººå…±äº‹æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="39ã€å½“ä½ è¦ç‰ºç‰²è‡ªå·±çš„æŸäº›æ–¹é¢ä¸ä»–äººå…±äº‹æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ"></a>39ã€å½“ä½ è¦ç‰ºç‰²è‡ªå·±çš„æŸäº›æ–¹é¢ä¸ä»–äººå…±äº‹æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿ</h4><h4 id="40ã€æœ‰æ—¶å›¢é˜Ÿæˆå‘˜ä¸èƒ½æœ‰æ•ˆå…±äº‹ï¼Œå½“é‡åˆ°è¿™ç§é—®é¢˜æ—¶ä½ æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿä½ åˆæ˜¯å¦‚ä½•æ”¹å–„è¿™ç±»æƒ…å†µçš„ï¼Ÿ"><a href="#40ã€æœ‰æ—¶å›¢é˜Ÿæˆå‘˜ä¸èƒ½æœ‰æ•ˆå…±äº‹ï¼Œå½“é‡åˆ°è¿™ç§é—®é¢˜æ—¶ä½ æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿä½ åˆæ˜¯å¦‚ä½•æ”¹å–„è¿™ç±»æƒ…å†µçš„ï¼Ÿ" class="headerlink" title="40ã€æœ‰æ—¶å›¢é˜Ÿæˆå‘˜ä¸èƒ½æœ‰æ•ˆå…±äº‹ï¼Œå½“é‡åˆ°è¿™ç§é—®é¢˜æ—¶ä½ æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿä½ åˆæ˜¯å¦‚ä½•æ”¹å–„è¿™ç±»æƒ…å†µçš„ï¼Ÿ"></a>40ã€æœ‰æ—¶å›¢é˜Ÿæˆå‘˜ä¸èƒ½æœ‰æ•ˆå…±äº‹ï¼Œå½“é‡åˆ°è¿™ç§é—®é¢˜æ—¶ä½ æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿä½ åˆæ˜¯å¦‚ä½•æ”¹å–„è¿™ç±»æƒ…å†µçš„ï¼Ÿ</h4><h4 id="41ã€æˆ‘ä»¬æœ‰æ—¶ä¸å¾—ä¸ä¸è‡ªå·±ä¸å–œæ¬¢çš„äººåœ¨ä¸€ä¸ªå›¢é˜Ÿå·¥ä½œï¼Œå¦‚æœé‡åˆ°è¿™æ ·çš„æƒ…å†µä½ ä¼šæ€ä¹ˆåŠï¼Ÿ"><a href="#41ã€æˆ‘ä»¬æœ‰æ—¶ä¸å¾—ä¸ä¸è‡ªå·±ä¸å–œæ¬¢çš„äººåœ¨ä¸€ä¸ªå›¢é˜Ÿå·¥ä½œï¼Œå¦‚æœé‡åˆ°è¿™æ ·çš„æƒ…å†µä½ ä¼šæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="41ã€æˆ‘ä»¬æœ‰æ—¶ä¸å¾—ä¸ä¸è‡ªå·±ä¸å–œæ¬¢çš„äººåœ¨ä¸€ä¸ªå›¢é˜Ÿå·¥ä½œï¼Œå¦‚æœé‡åˆ°è¿™æ ·çš„æƒ…å†µä½ ä¼šæ€ä¹ˆåŠï¼Ÿ"></a>41ã€æˆ‘ä»¬æœ‰æ—¶ä¸å¾—ä¸ä¸è‡ªå·±ä¸å–œæ¬¢çš„äººåœ¨ä¸€ä¸ªå›¢é˜Ÿå·¥ä½œï¼Œå¦‚æœé‡åˆ°è¿™æ ·çš„æƒ…å†µä½ ä¼šæ€ä¹ˆåŠï¼Ÿ</h4><h4 id="42ã€æ‚¨å¯¹å§”ä»»çš„ä»»åŠ¡å®Œæˆä¸äº†æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#42ã€æ‚¨å¯¹å§”ä»»çš„ä»»åŠ¡å®Œæˆä¸äº†æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="42ã€æ‚¨å¯¹å§”ä»»çš„ä»»åŠ¡å®Œæˆä¸äº†æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ"></a>42ã€æ‚¨å¯¹å§”ä»»çš„ä»»åŠ¡å®Œæˆä¸äº†æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ</h4><h4 id="43ã€è¯´è¯´æ‚¨å¯¹ä¸‹å±å¸ƒç½®çš„ä»»åŠ¡åœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚çš„ï¼Ÿ"><a href="#43ã€è¯´è¯´æ‚¨å¯¹ä¸‹å±å¸ƒç½®çš„ä»»åŠ¡åœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚çš„ï¼Ÿ" class="headerlink" title="43ã€è¯´è¯´æ‚¨å¯¹ä¸‹å±å¸ƒç½®çš„ä»»åŠ¡åœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚çš„ï¼Ÿ"></a>43ã€è¯´è¯´æ‚¨å¯¹ä¸‹å±å¸ƒç½®çš„ä»»åŠ¡åœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚çš„ï¼Ÿ</h4><h4 id="44ã€è¯´è¯´æ‚¨åœ¨å®Œæˆä¸Šå¸å¸ƒç½®çš„ä»»åŠ¡æ—¶ï¼Œåœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚è‡ªå·±çš„ï¼Ÿ"><a href="#44ã€è¯´è¯´æ‚¨åœ¨å®Œæˆä¸Šå¸å¸ƒç½®çš„ä»»åŠ¡æ—¶ï¼Œåœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚è‡ªå·±çš„ï¼Ÿ" class="headerlink" title="44ã€è¯´è¯´æ‚¨åœ¨å®Œæˆä¸Šå¸å¸ƒç½®çš„ä»»åŠ¡æ—¶ï¼Œåœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚è‡ªå·±çš„ï¼Ÿ"></a>44ã€è¯´è¯´æ‚¨åœ¨å®Œæˆä¸Šå¸å¸ƒç½®çš„ä»»åŠ¡æ—¶ï¼Œåœ¨æ—¶é—´æ–¹é¢æ˜¯å¦‚ä½•è¦æ±‚è‡ªå·±çš„ï¼Ÿ</h4><h4 id="45ã€æ‚¨ä»¥å¾€åœ¨é¢†å¯¼å²—ä½ä¸­ï¼Œä¸€ä¸ªæœˆå†…åˆ†åˆ«æœ‰å“ªäº›ä¸»è¦çš„å·¥ä½œä»»åŠ¡ï¼Ÿ"><a href="#45ã€æ‚¨ä»¥å¾€åœ¨é¢†å¯¼å²—ä½ä¸­ï¼Œä¸€ä¸ªæœˆå†…åˆ†åˆ«æœ‰å“ªäº›ä¸»è¦çš„å·¥ä½œä»»åŠ¡ï¼Ÿ" class="headerlink" title="45ã€æ‚¨ä»¥å¾€åœ¨é¢†å¯¼å²—ä½ä¸­ï¼Œä¸€ä¸ªæœˆå†…åˆ†åˆ«æœ‰å“ªäº›ä¸»è¦çš„å·¥ä½œä»»åŠ¡ï¼Ÿ"></a>45ã€æ‚¨ä»¥å¾€åœ¨é¢†å¯¼å²—ä½ä¸­ï¼Œä¸€ä¸ªæœˆå†…åˆ†åˆ«æœ‰å“ªäº›ä¸»è¦çš„å·¥ä½œä»»åŠ¡ï¼Ÿ</h4><h4 id="46ã€å½“æ‚¨å‘ç°æ‚¨çš„éƒ¨å±ç›®å‰å£«æ°”è¾ƒä½æ²‰ï¼Œæ‚¨ä¸€èˆ¬ä»å“ªäº›æ–¹é¢å»è°ƒåŠ¨ï¼Ÿ"><a href="#46ã€å½“æ‚¨å‘ç°æ‚¨çš„éƒ¨å±ç›®å‰å£«æ°”è¾ƒä½æ²‰ï¼Œæ‚¨ä¸€èˆ¬ä»å“ªäº›æ–¹é¢å»è°ƒåŠ¨ï¼Ÿ" class="headerlink" title="46ã€å½“æ‚¨å‘ç°æ‚¨çš„éƒ¨å±ç›®å‰å£«æ°”è¾ƒä½æ²‰ï¼Œæ‚¨ä¸€èˆ¬ä»å“ªäº›æ–¹é¢å»è°ƒåŠ¨ï¼Ÿ"></a>46ã€å½“æ‚¨å‘ç°æ‚¨çš„éƒ¨å±ç›®å‰å£«æ°”è¾ƒä½æ²‰ï¼Œæ‚¨ä¸€èˆ¬ä»å“ªäº›æ–¹é¢å»è°ƒåŠ¨ï¼Ÿ</h4><h4 id="47ã€è¯´è¯´æ‚¨åœ¨ä»¥å¾€é¢†å¯¼å²—ä½ä¸­å‡ºç°ç®¡ç†å¤±æ§çš„äº‹ä¾‹åŠäº‹åçš„åŸå› åˆ†æã€‚æ‚¨çš„éƒ¨å±åœ¨ä¸€ä¸ªä¸“ä¸šçš„é—®é¢˜ä¸Šè·Ÿæ‚¨å‘ç”Ÿäº‰è®®ï¼Œæ‚¨å¦‚ä½•å¯¹å¾…è¿™ç§äº‹ä»¶ï¼Ÿ"><a href="#47ã€è¯´è¯´æ‚¨åœ¨ä»¥å¾€é¢†å¯¼å²—ä½ä¸­å‡ºç°ç®¡ç†å¤±æ§çš„äº‹ä¾‹åŠäº‹åçš„åŸå› åˆ†æã€‚æ‚¨çš„éƒ¨å±åœ¨ä¸€ä¸ªä¸“ä¸šçš„é—®é¢˜ä¸Šè·Ÿæ‚¨å‘ç”Ÿäº‰è®®ï¼Œæ‚¨å¦‚ä½•å¯¹å¾…è¿™ç§äº‹ä»¶ï¼Ÿ" class="headerlink" title="47ã€è¯´è¯´æ‚¨åœ¨ä»¥å¾€é¢†å¯¼å²—ä½ä¸­å‡ºç°ç®¡ç†å¤±æ§çš„äº‹ä¾‹åŠäº‹åçš„åŸå› åˆ†æã€‚æ‚¨çš„éƒ¨å±åœ¨ä¸€ä¸ªä¸“ä¸šçš„é—®é¢˜ä¸Šè·Ÿæ‚¨å‘ç”Ÿäº‰è®®ï¼Œæ‚¨å¦‚ä½•å¯¹å¾…è¿™ç§äº‹ä»¶ï¼Ÿ"></a>47ã€è¯´è¯´æ‚¨åœ¨ä»¥å¾€é¢†å¯¼å²—ä½ä¸­å‡ºç°ç®¡ç†å¤±æ§çš„äº‹ä¾‹åŠäº‹åçš„åŸå› åˆ†æã€‚æ‚¨çš„éƒ¨å±åœ¨ä¸€ä¸ªä¸“ä¸šçš„é—®é¢˜ä¸Šè·Ÿæ‚¨å‘ç”Ÿäº‰è®®ï¼Œæ‚¨å¦‚ä½•å¯¹å¾…è¿™ç§äº‹ä»¶ï¼Ÿ</h4><h4 id="48ã€ä½ å¯¹æŸæŸæŸäº’è”ç½‘å‘ç”Ÿäº‹æƒ…çš„çœ‹æ³•ï¼Ÿï¼ˆç›´æ’­ç­”é¢˜ç­‰ç­‰ï¼‰"><a href="#48ã€ä½ å¯¹æŸæŸæŸäº’è”ç½‘å‘ç”Ÿäº‹æƒ…çš„çœ‹æ³•ï¼Ÿï¼ˆç›´æ’­ç­”é¢˜ç­‰ç­‰ï¼‰" class="headerlink" title="48ã€ä½ å¯¹æŸæŸæŸäº’è”ç½‘å‘ç”Ÿäº‹æƒ…çš„çœ‹æ³•ï¼Ÿï¼ˆç›´æ’­ç­”é¢˜ç­‰ç­‰ï¼‰"></a>48ã€ä½ å¯¹æŸæŸæŸäº’è”ç½‘å‘ç”Ÿäº‹æƒ…çš„çœ‹æ³•ï¼Ÿï¼ˆç›´æ’­ç­”é¢˜ç­‰ç­‰ï¼‰</h4><h4 id="49ã€æ€ä¹ˆçœ‹å¾…å‰ç«¯å’Œåç«¯ï¼Ÿ"><a href="#49ã€æ€ä¹ˆçœ‹å¾…å‰ç«¯å’Œåç«¯ï¼Ÿ" class="headerlink" title="49ã€æ€ä¹ˆçœ‹å¾…å‰ç«¯å’Œåç«¯ï¼Ÿ"></a>49ã€æ€ä¹ˆçœ‹å¾…å‰ç«¯å’Œåç«¯ï¼Ÿ</h4>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§çš„10ç§æ’åºç®—æ³•</title>
      <link href="/2019-12-30/sorting-algorithms/"/>
      <url>/2019-12-30/sorting-algorithms/</url>
      
        <content type="html"><![CDATA[<p>ç®—æ³•è™½ç„¶åœ¨å¹³æ—¶ç”¨å¾—å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œä½†æ˜¯ä¸€æ—¦ç”¨åˆ°ï¼Œå°±è¦å‘½ã€‚ç®—æ³•ä¹Ÿå¤„å¤„ä½“ç°äº†è§£å†³é—®é¢˜çš„æ€è·¯ï¼Œåšä¸ºç¨‹åºå‘˜ï¼Œç®—æ³•åº”è¯¥äººäººæŒæ¡ã€‚</p><p>æœ¬ç¯‡æ–‡ç« æ€»ç»“ä¸€äº›ä¸šç•Œæ¯”è¾ƒå¸¸ç”¨çš„<strong>æ’åºç®—æ³•</strong>ã€‚</p><span id="more"></span><p>åœ¨æ’¸ç®—æ³•ä¹‹å‰ï¼Œå…ˆè¯´æ˜å‡ ä¸ªæœ¯è¯­ï¼š</p><ul><li>ç¨³å®šï¼šå¦‚æœaåŸæœ¬åœ¨bå‰é¢ï¼Œè€Œa=bï¼Œæ’åºä¹‹åaä»ç„¶åœ¨bçš„å‰é¢ï¼›</li><li>ä¸ç¨³å®šï¼šå¦‚æœaåŸæœ¬åœ¨bçš„å‰é¢ï¼Œè€Œa=bï¼Œæ’åºä¹‹åaå¯èƒ½ä¼šå‡ºç°åœ¨bçš„åé¢ï¼›</li><li>å†…æ’åºï¼šæ‰€æœ‰æ’åºæ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼›</li><li>å¤–æ’åºï¼šç”±äºæ•°æ®å¤ªå¤§ï¼Œå› æ­¤æŠŠæ•°æ®æ”¾åœ¨ç£ç›˜ä¸­ï¼Œè€Œæ’åºé€šè¿‡ç£ç›˜å’Œå†…å­˜çš„æ•°æ®ä¼ è¾“æ‰èƒ½è¿›è¡Œï¼›</li><li>æ—¶é—´å¤æ‚åº¦ï¼š ä¸€ä¸ªç®—æ³•æ‰§è¡Œæ‰€è€—è´¹çš„æ—¶é—´ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼šè¿è¡Œå®Œä¸€ä¸ªç¨‹åºæ‰€éœ€å†…å­˜çš„å¤§å°ã€‚</li></ul><p><img src="/img/algorithm-1590395511.png"></p><div style="text-align: center;"><p><em>nè¡¨ç¤ºæ•°æ®è§„æ¨¡ï¼Œkè¡¨ç¤ºã€æ¡¶ã€çš„ä¸ªæ•°</em></p></div><h2 id="ç®—æ³•åˆ†ç±»ï¼š"><a href="#ç®—æ³•åˆ†ç±»ï¼š" class="headerlink" title="ç®—æ³•åˆ†ç±»ï¼š"></a>ç®—æ³•åˆ†ç±»ï¼š</h2><p><img src="/img/algorithm-1590395522.png"></p><p>æ¯”è¾ƒå’Œéæ¯”è¾ƒçš„åŒºåˆ«</p><p>å¸¸è§çš„å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€å †æ’åºã€å†’æ³¡æ’åºç­‰å±äºæ¯”è¾ƒæ’åºã€‚åœ¨æ’åºçš„æœ€ç»ˆç»“æœé‡Œï¼Œå…ƒç´ ä¹‹é—´çš„æ¬¡åºä¾èµ–äºå®ƒä»¬ä¹‹é—´çš„æ¯”è¾ƒã€‚æ¯ä¸ªæ•°éƒ½å¿…é¡»å’Œå…¶ä»–æ•°è¿›è¡Œæ¯”è¾ƒï¼Œæ‰èƒ½ç¡®å®šè‡ªå·±çš„ä½ç½®ã€‚<br>åœ¨å†’æ³¡æ’åºä¹‹ç±»çš„æ’åºä¸­ï¼Œé—®é¢˜è§„æ¨¡ä¸ºnï¼Œåˆå› ä¸ºéœ€è¦æ¯”è¾ƒnæ¬¡ï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(nÂ²)ã€‚åœ¨å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºä¹‹ç±»çš„æ’åºä¸­ï¼Œé—®é¢˜è§„æ¨¡é€šè¿‡åˆ†æ²»æ³•æ¶ˆå‡ä¸ºlogNæ¬¡ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å¹³å‡O(nlogn)ã€‚<br>æ¯”è¾ƒæ’åºçš„ä¼˜åŠ¿æ˜¯ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡çš„æ•°æ®ï¼Œä¹Ÿä¸åœ¨ä¹æ•°æ®çš„åˆ†å¸ƒï¼Œéƒ½èƒ½è¿›è¡Œæ’åºã€‚å¯ä»¥è¯´ï¼Œæ¯”è¾ƒæ’åºé€‚ç”¨äºä¸€åˆ‡éœ€è¦æ’åºçš„æƒ…å†µã€‚</p><p>è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€æ¡¶æ’åºåˆ™å±äºéæ¯”è¾ƒæ’åºã€‚éæ¯”è¾ƒæ’åºæ˜¯é€šè¿‡ç¡®å®šæ¯ä¸ªå…ƒç´ ä¹‹å‰ï¼Œåº”è¯¥æœ‰å¤šå°‘ä¸ªå…ƒç´ æ¥æ’åºã€‚é’ˆå¯¹æ•°ç»„arrï¼Œè®¡ç®—arr[i]ä¹‹å‰æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œåˆ™å”¯ä¸€ç¡®å®šäº†arr[i]åœ¨æ’åºåæ•°ç»„ä¸­çš„ä½ç½®ã€‚<br>éæ¯”è¾ƒæ’åºåªè¦ç¡®å®šæ¯ä¸ªå…ƒç´ ä¹‹å‰çš„å·²æœ‰çš„å…ƒç´ ä¸ªæ•°å³å¯ï¼Œæ‰€æœ‰ä¸€æ¬¡éå†å³å¯è§£å†³ã€‚ç®—æ³•æ—¶é—´å¤æ‚åº¦O(n)ã€‚<br>éæ¯”è¾ƒæ’åºæ—¶é—´å¤æ‚åº¦åº•ï¼Œä½†ç”±äºéæ¯”è¾ƒæ’åºéœ€è¦å ç”¨ç©ºé—´æ¥ç¡®å®šå”¯ä¸€ä½ç½®ã€‚æ‰€ä»¥å¯¹æ•°æ®è§„æ¨¡å’Œæ•°æ®åˆ†å¸ƒæœ‰ä¸€å®šçš„è¦æ±‚ã€‚</p><h2 id="1-å†’æ³¡æ’åºï¼ˆBubble-Sortï¼‰"><a href="#1-å†’æ³¡æ’åºï¼ˆBubble-Sortï¼‰" class="headerlink" title="1. å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰"></a>1. å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰</h2><p>å†’æ³¡æ’åºæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚ </p><h3 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼›<br>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼›<br>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼›<br>é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMjMyMzg0NDktMjE0NjE2OTE5Ny5naWY"></p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/** * å†’æ³¡æ’åº * * @param array * @return */public static int[] bubbleSort(int[] array) &#123;    if (array.length == 0)        return array;    for (int i = 0; i &lt; array.length; i++)        for (int j = 0; j &lt; array.length - 1 - i; j++)            if (array[j + 1] &lt; array[j]) &#123;  // äº¤æ¢ä½ç½®                int temp = array[j + 1];                array[j + 1] = array[j];                array[j] = temp;            &#125;    return array;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ"><a href="#ç®—æ³•åˆ†æ" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n2)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n2)</p><h2 id="2-é€‰æ‹©æ’åºï¼ˆSelection-Sortï¼‰"><a href="#2-é€‰æ‹©æ’åºï¼ˆSelection-Sortï¼‰" class="headerlink" title="2. é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰"></a>2. é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰</h2><p>è¡¨ç°æœ€ç¨³å®šçš„æ’åºç®—æ³•ä¹‹ä¸€ï¼Œå› ä¸ºæ— è®ºä»€ä¹ˆæ•°æ®è¿›å»éƒ½æ˜¯O(n2)çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰€ä»¥ç”¨åˆ°å®ƒçš„æ—¶å€™ï¼Œæ•°æ®è§„æ¨¡è¶Šå°è¶Šå¥½ã€‚å”¯ä¸€çš„å¥½å¤„å¯èƒ½å°±æ˜¯<strong>ä¸å ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´äº†å§</strong>ã€‚ç†è®ºä¸Šè®²ï¼Œé€‰æ‹©æ’åºå¯èƒ½ä¹Ÿæ˜¯å¹³æ—¶æ’åºä¸€èˆ¬äººæƒ³åˆ°çš„æœ€å¤šçš„æ’åºæ–¹æ³•äº†å§ã€‚</p><p>é€‰æ‹©æ’åº(Selection-sort)æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚ </p><h3 id="ç®—æ³•æè¿°-1"><a href="#ç®—æ³•æè¿°-1" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>n ä¸ªè®°å½•çš„ç›´æ¥é€‰æ‹©æ’åºå¯ç»è¿‡ n-1 è¶Ÿç›´æ¥é€‰æ‹©æ’åºå¾—åˆ°æœ‰åºç»“æœã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š</p><p>åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸ºR[1..n]ï¼Œæœ‰åºåŒºä¸ºç©ºï¼›<br>ç¬¬iè¶Ÿæ’åº(i=1,2,3â€¦n-1)å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸ºR[1..i-1]å’ŒR(i..nï¼‰ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• R[k]ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿R[1..i]å’ŒR[i+1..n)åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒºï¼›<br>n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†ã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMjQ3MTk1OTAtMTQzMzIxOTgyNC5naWY"></p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/** * é€‰æ‹©æ’åº * @param array * @return */public static int[] selectionSort(int[] array) &#123;    if (array.length == 0)        return array;    for (int i = 0; i &lt; array.length; i++) &#123;        int minIndex = i;        for (int j = i; j &lt; array.length; j++) &#123;            if (array[j] &lt; array[minIndex]) //æ‰¾åˆ°æœ€å°çš„æ•°                minIndex = j; //å°†æœ€å°æ•°çš„ç´¢å¼•ä¿å­˜        &#125;        int temp = array[minIndex];        array[minIndex] = array[i];        array[i] = temp;    &#125;    return array;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-1"><a href="#ç®—æ³•åˆ†æ-1" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n2)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n2)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n2)</p><h2 id="3-æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰"><a href="#3-æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰" class="headerlink" title="3. æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰"></a>3. æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰</h2><p>æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰çš„ç®—æ³•æè¿°æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ’å…¥æ’åºåœ¨å®ç°ä¸Šï¼Œé€šå¸¸é‡‡ç”¨in-placeæ’åºï¼ˆå³åªéœ€ç”¨åˆ°O(1)çš„é¢å¤–ç©ºé—´çš„æ’åºï¼‰ï¼Œå› è€Œåœ¨ä»åå‘å‰æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åå¤æŠŠå·²æ’åºå…ƒç´ é€æ­¥å‘åæŒªä½ï¼Œä¸ºæœ€æ–°å…ƒç´ æä¾›æ’å…¥ç©ºé—´ã€‚</p><h3 id="ç®—æ³•æè¿°-2"><a href="#ç®—æ³•æè¿°-2" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ’å…¥æ’åºéƒ½é‡‡ç”¨in-placeåœ¨æ•°ç»„ä¸Šå®ç°ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š</p><ol><li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼›</li><li>å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼›</li><li>å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼›</li><li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼›</li><li>å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼›</li><li>é‡å¤æ­¥éª¤2~5ã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMjU2NDUyNzctMTE1MTEwMDAwMC5naWY"></p><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** æ’å…¥æ’åº* @param array* @return*/public static int[] insertionSort(int[] array) &#123;    if (array.length == 0)        return array;    int current;    for (int i = 0; i &lt; array.length - 1; i++) &#123;        current = array[i + 1];        int preIndex = i;        while (preIndex &gt;= 0 &amp;&amp; current &lt; array[preIndex]) &#123;            array[preIndex + 1] = array[preIndex];            preIndex--;        &#125;        array[preIndex + 1] = current;    &#125;    return array;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-2"><a href="#ç®—æ³•åˆ†æ-2" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n)<br>æœ€åæƒ…å†µï¼šT(n) = O(n2)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n2)</p><h2 id="4-å¸Œå°”æ’åºï¼ˆShell-Sortï¼‰"><a href="#4-å¸Œå°”æ’åºï¼ˆShell-Sortï¼‰" class="headerlink" title="4. å¸Œå°”æ’åºï¼ˆShell Sortï¼‰"></a>4. å¸Œå°”æ’åºï¼ˆShell Sortï¼‰</h2><p>å¸Œå°”æ’åºæ˜¯å¸Œå°”ï¼ˆDonald Shellï¼‰äº1959å¹´æå‡ºçš„ä¸€ç§æ’åºç®—æ³•ã€‚å¸Œå°”æ’åºä¹Ÿæ˜¯ä¸€ç§æ’å…¥æ’åºï¼Œå®ƒæ˜¯ç®€å•æ’å…¥æ’åºç»è¿‡æ”¹è¿›ä¹‹åçš„ä¸€ä¸ªæ›´é«˜æ•ˆçš„ç‰ˆæœ¬ï¼Œä¹Ÿç§°ä¸ºç¼©å°å¢é‡æ’åºï¼ŒåŒæ—¶è¯¥ç®—æ³•æ˜¯å†²ç ´O(n2ï¼‰çš„ç¬¬ä¸€æ‰¹ç®—æ³•ä¹‹ä¸€ã€‚å®ƒä¸æ’å…¥æ’åºçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šä¼˜å…ˆæ¯”è¾ƒè·ç¦»è¾ƒè¿œçš„å…ƒç´ ã€‚å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºã€‚</p><p>å¸Œå°”æ’åºæ˜¯æŠŠè®°å½•æŒ‰ä¸‹è¡¨çš„ä¸€å®šå¢é‡åˆ†ç»„ï¼Œå¯¹æ¯ç»„ä½¿ç”¨ç›´æ¥æ’å…¥æ’åºç®—æ³•æ’åºï¼›éšç€å¢é‡é€æ¸å‡å°‘ï¼Œæ¯ç»„åŒ…å«çš„å…³é”®è¯è¶Šæ¥è¶Šå¤šï¼Œå½“å¢é‡å‡è‡³1æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶æ°è¢«åˆ†æˆä¸€ç»„ï¼Œç®—æ³•ä¾¿ç»ˆæ­¢ã€‚</p><h3 id="ç®—æ³•æè¿°-3"><a href="#ç®—æ³•æè¿°-3" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å¸Œå°”æ’åºçš„åŸºæœ¬æ­¥éª¤ï¼Œåœ¨æ­¤æˆ‘ä»¬é€‰æ‹©å¢é‡gap=length/2ï¼Œç¼©å°å¢é‡ç»§ç»­ä»¥gap = gap/2çš„æ–¹å¼ï¼Œè¿™ç§å¢é‡é€‰æ‹©æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªåºåˆ—æ¥è¡¨ç¤ºï¼Œ{n/2,(n/2)/2â€¦1}ï¼Œç§°ä¸ºå¢é‡åºåˆ—ã€‚å¸Œå°”æ’åºçš„å¢é‡åºåˆ—çš„é€‰æ‹©ä¸è¯æ˜æ˜¯ä¸ªæ•°å­¦éš¾é¢˜ï¼Œæˆ‘ä»¬é€‰æ‹©çš„è¿™ä¸ªå¢é‡åºåˆ—æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œä¹Ÿæ˜¯å¸Œå°”å»ºè®®çš„å¢é‡ï¼Œç§°ä¸ºå¸Œå°”å¢é‡ï¼Œä½†å…¶å®è¿™ä¸ªå¢é‡åºåˆ—ä¸æ˜¯æœ€ä¼˜çš„ã€‚æ­¤å¤„æˆ‘ä»¬åšç¤ºä¾‹ä½¿ç”¨å¸Œå°”å¢é‡ã€‚</p><p>å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå…·ä½“ç®—æ³•æè¿°ï¼š</p><ol><li>é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti&gt;tjï¼Œtk=1ï¼›</li><li>æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œk è¶Ÿæ’åºï¼›</li><li>æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTE5MjY5OS8yMDE4MDMvMTE5MjY5OS0yMDE4MDMxOTA5NDExNjA0MC0xNjM4NzY2MjcxLnBuZw?x-oss-process=image/format,png"></p><h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** å¸Œå°”æ’åº** @param array* @return*/public static int[] ShellSort(int[] array) &#123;    int len = array.length;    int temp, gap = len / 2;    while (gap &gt; 0) &#123;        for (int i = gap; i &lt; len; i++) &#123;            temp = array[i];            int preIndex = i - gap;            while (preIndex &gt;= 0 &amp;&amp; array[preIndex] &gt; temp) &#123;                array[preIndex + gap] = array[preIndex];                preIndex -= gap;            &#125;            array[preIndex + gap] = temp;        &#125;        gap /= 2;    &#125;    return array;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-3"><a href="#ç®—æ³•åˆ†æ-3" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n log2 n)<br>æœ€åæƒ…å†µï¼šT(n) = O(n log2 n)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n log2 n)</p><h2 id="5-å½’å¹¶æ’åºï¼ˆMerge-Sortï¼‰"><a href="#5-å½’å¹¶æ’åºï¼ˆMerge-Sortï¼‰" class="headerlink" title="5. å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰"></a>5. å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰</h2><p>å’Œé€‰æ‹©æ’åºä¸€æ ·ï¼Œå½’å¹¶æ’åºçš„æ€§èƒ½ä¸å—è¾“å…¥æ•°æ®çš„å½±å“ï¼Œä½†è¡¨ç°æ¯”é€‰æ‹©æ’åºå¥½çš„å¤šï¼Œå› ä¸ºå§‹ç»ˆéƒ½æ˜¯O(n log nï¼‰çš„æ—¶é—´å¤æ‚åº¦ã€‚ä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚</p><p>å½’å¹¶æ’åºæ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚ </p><h3 id="ç®—æ³•æè¿°-4"><a href="#ç®—æ³•æè¿°-4" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><ol><li>æŠŠé•¿åº¦ä¸ºnçš„è¾“å…¥åºåˆ—åˆ†æˆä¸¤ä¸ªé•¿åº¦ä¸ºn/2çš„å­åºåˆ—ï¼›</li><li>å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«é‡‡ç”¨å½’å¹¶æ’åºï¼›</li><li>å°†ä¸¤ä¸ªæ’åºå¥½çš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„æ’åºåºåˆ—ã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMzA1NTcwNDMtMzczNzUwMTAuZ2lm"></p><h3 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** å½’å¹¶æ’åº** @param array* @return*/public static int[] MergeSort(int[] array) &#123;    if (array.length &lt; 2) return array;    int mid = array.length / 2;    int[] left = Arrays.copyOfRange(array, 0, mid);    int[] right = Arrays.copyOfRange(array, mid, array.length);    return merge(MergeSort(left), MergeSort(right));&#125;/*** å½’å¹¶æ’åºâ€”â€”å°†ä¸¤æ®µæ’åºå¥½çš„æ•°ç»„ç»“åˆæˆä¸€ä¸ªæ’åºæ•°ç»„** @param left* @param right* @return*/public static int[] merge(int[] left, int[] right) &#123;    int[] result = new int[left.length + right.length];    for (int index = 0, i = 0, j = 0; index &lt; result.length; index++) &#123;        if (i &gt;= left.length)            result[index] = right[j++];        else if (j &gt;= right.length)            result[index] = left[i++];        else if (left[i] &gt; right[j])            result[index] = right[j++];        else            result[index] = left[i++];    &#125;    return result;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-4"><a href="#ç®—æ³•åˆ†æ-4" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n logn)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n logn)</p><h2 id="6-å¿«é€Ÿæ’åºï¼ˆQuick-Sortï¼‰"><a href="#6-å¿«é€Ÿæ’åºï¼ˆQuick-Sortï¼‰" class="headerlink" title="6. å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰"></a>6. å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰</h2><p>å¿«é€Ÿæ’åºçš„åŸºæœ¬æ€æƒ³ï¼šé€šè¿‡ä¸€è¶Ÿæ’åºå°†å¾…æ’è®°å½•åˆ†éš”æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å‡æ¯”å¦ä¸€éƒ¨åˆ†çš„å…³é”®å­—å°ï¼Œåˆ™å¯åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç»§ç»­è¿›è¡Œæ’åºï¼Œä»¥è¾¾åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚</p><h3 id="ç®—æ³•æè¿°-5"><a href="#ç®—æ³•æè¿°-5" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•æ¥æŠŠä¸€ä¸ªä¸²ï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²ï¼ˆsub-listsï¼‰ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š</p><ol><li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰ï¼›</li><li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›</li><li>é€’å½’åœ°æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMzA5MzYzNzEtMTQxMzUyMzQxMi5naWY"></p><h3 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** å¿«é€Ÿæ’åºæ–¹æ³•* @param array* @param start* @param end* @return*/public static int[] QuickSort(int[] array, int start, int end) &#123;    if (array.length &lt; 1 || start &lt; 0 || end &gt;= array.length || start &gt; end) return null;    int smallIndex = partition(array, start, end);    if (smallIndex &gt; start)        QuickSort(array, start, smallIndex - 1);    if (smallIndex &lt; end)        QuickSort(array, smallIndex + 1, end);    return array;&#125;/*** å¿«é€Ÿæ’åºç®—æ³•â€”â€”partition* @param array* @param start* @param end* @return*/public static int partition(int[] array, int start, int end) &#123;    int pivot = (int) (start + Math.random() * (end - start + 1));    int smallIndex = start - 1;    swap(array, pivot, end);    for (int i = start; i &lt;= end; i++)        if (array[i] &lt;= array[end]) &#123;            smallIndex++;            if (i &gt; smallIndex)                swap(array, i, smallIndex);        &#125;    return smallIndex;&#125;/*** äº¤æ¢æ•°ç»„å†…ä¸¤ä¸ªå…ƒç´ * @param array* @param i* @param j*/public static void swap(int[] array, int i, int j) &#123;    int temp = array[i];    array[i] = array[j];    array[j] = temp;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-5"><a href="#ç®—æ³•åˆ†æ-5" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlogn)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n2)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)ã€€</p><h2 id="7-å †æ’åºï¼ˆHeap-Sortï¼‰"><a href="#7-å †æ’åºï¼ˆHeap-Sortï¼‰" class="headerlink" title="7. å †æ’åºï¼ˆHeap Sortï¼‰"></a>7. å †æ’åºï¼ˆHeap Sortï¼‰</h2><p>å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p><h3 id="ç®—æ³•æè¿°-6"><a href="#ç®—æ³•æè¿°-6" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><ol><li>å°†åˆå§‹å¾…æ’åºå…³é”®å­—åºåˆ—(R1,R2â€¦.Rn)æ„å»ºæˆå¤§é¡¶å †ï¼Œæ­¤å †ä¸ºåˆå§‹çš„æ— åºåŒºï¼›</li><li>å°†å †é¡¶å…ƒç´ R[1]ä¸æœ€åä¸€ä¸ªå…ƒç´ R[n]äº¤æ¢ï¼Œæ­¤æ—¶å¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2,â€¦â€¦Rn-1)å’Œæ–°çš„æœ‰åºåŒº(Rn),ä¸”æ»¡è¶³R[1,2â€¦n-1]&lt;=R[n]ï¼›</li><li>ç”±äºäº¤æ¢åæ–°çš„å †é¡¶R[1]å¯èƒ½è¿åå †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦å¯¹å½“å‰æ— åºåŒº(R1,R2,â€¦â€¦Rn-1)è°ƒæ•´ä¸ºæ–°å †ï¼Œç„¶åå†æ¬¡å°†R[1]ä¸æ— åºåŒºæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2â€¦.Rn-2)å’Œæ–°çš„æœ‰åºåŒº(Rn-1,Rn)ã€‚ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°æœ‰åºåŒºçš„å…ƒç´ ä¸ªæ•°ä¸ºn-1ï¼Œåˆ™æ•´ä¸ªæ’åºè¿‡ç¨‹å®Œæˆã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMzEzMDg2OTktMzU2MTM0MjM3LmdpZg"></p><h3 id="ä»£ç å®ç°-6"><a href="#ä»£ç å®ç°-6" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">//å£°æ˜å…¨å±€å˜é‡ï¼Œç”¨äºè®°å½•æ•°ç»„arrayçš„é•¿åº¦ï¼›static int len;/*** å †æ’åºç®—æ³•** @param array* @return*/public static int[] HeapSort(int[] array) &#123;    len = array.length;    if (len &lt; 1) return array;    //1.æ„å»ºä¸€ä¸ªæœ€å¤§å †    buildMaxHeap(array);    //2.å¾ªç¯å°†å †é¦–ä½ï¼ˆæœ€å¤§å€¼ï¼‰ä¸æœ«ä½äº¤æ¢ï¼Œç„¶ååœ¨é‡æ–°è°ƒæ•´æœ€å¤§å †    while (len &gt; 0) &#123;        swap(array, 0, len - 1);        len--;        adjustHeap(array, 0);    &#125;    return array;&#125;/*** å»ºç«‹æœ€å¤§å †** @param array*/public static void buildMaxHeap(int[] array) &#123;    //ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹å‘ä¸Šæ„é€ æœ€å¤§å †    for (int i = (len/2 - 1); i &gt;= 0; i--) &#123; //æ„Ÿè°¢ @è®©æˆ‘å‘ä¼šå‘† ç½‘å‹çš„æé†’ï¼Œæ­¤å¤„åº”è¯¥ä¸º i = (len/2 - 1)         adjustHeap(array, i);    &#125;&#125;/*** è°ƒæ•´ä½¿ä¹‹æˆä¸ºæœ€å¤§å †** @param array* @param i*/public static void adjustHeap(int[] array, int i) &#123;    int maxIndex = i;    //å¦‚æœæœ‰å·¦å­æ ‘ï¼Œä¸”å·¦å­æ ‘å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œåˆ™å°†æœ€å¤§æŒ‡é’ˆæŒ‡å‘å·¦å­æ ‘    if (i * 2 &lt; len &amp;&amp; array[i * 2] &gt; array[maxIndex])        maxIndex = i * 2;    //å¦‚æœæœ‰å³å­æ ‘ï¼Œä¸”å³å­æ ‘å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œåˆ™å°†æœ€å¤§æŒ‡é’ˆæŒ‡å‘å³å­æ ‘    if (i * 2 + 1 &lt; len &amp;&amp; array[i * 2 + 1] &gt; array[maxIndex])        maxIndex = i * 2 + 1;    //å¦‚æœçˆ¶èŠ‚ç‚¹ä¸æ˜¯æœ€å¤§å€¼ï¼Œåˆ™å°†çˆ¶èŠ‚ç‚¹ä¸æœ€å¤§å€¼äº¤æ¢ï¼Œå¹¶ä¸”é€’å½’è°ƒæ•´ä¸çˆ¶èŠ‚ç‚¹äº¤æ¢çš„ä½ç½®ã€‚    if (maxIndex != i) &#123;        swap(array, maxIndex, i);        adjustHeap(array, maxIndex);    &#125;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-6"><a href="#ç®—æ³•åˆ†æ-6" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlogn)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(nlogn)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)</p><h2 id="8-è®¡æ•°æ’åºï¼ˆCounting-Sortï¼‰"><a href="#8-è®¡æ•°æ’åºï¼ˆCounting-Sortï¼‰" class="headerlink" title="8. è®¡æ•°æ’åºï¼ˆCounting Sortï¼‰"></a>8. è®¡æ•°æ’åºï¼ˆCounting Sortï¼‰</h2><p>è®¡æ•°æ’åºçš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚</p><p>è®¡æ•°æ’åº(Counting sort)æ˜¯ä¸€ç§ç¨³å®šçš„æ’åºç®—æ³•ã€‚è®¡æ•°æ’åºä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ•°ç»„Cï¼Œå…¶ä¸­ç¬¬iä¸ªå…ƒç´ æ˜¯å¾…æ’åºæ•°ç»„Aä¸­å€¼ç­‰äºiçš„å…ƒç´ çš„ä¸ªæ•°ã€‚ç„¶åæ ¹æ®æ•°ç»„Cæ¥å°†Aä¸­çš„å…ƒç´ æ’åˆ°æ­£ç¡®çš„ä½ç½®ã€‚å®ƒåªèƒ½å¯¹æ•´æ•°è¿›è¡Œæ’åºã€‚</p><h3 id="ç®—æ³•æè¿°-7"><a href="#ç®—æ³•æè¿°-7" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><ol><li>æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ ï¼›</li><li>ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹ï¼›</li><li>å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰ï¼›</li><li>åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1ã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMzE3NDA4NDAtNjk2ODE4MS5naWY"></p><h3 id="ä»£ç å®ç°-7"><a href="#ä»£ç å®ç°-7" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** è®¡æ•°æ’åº** @param array* @return*/public static int[] CountingSort(int[] array) &#123;    if (array.length == 0) return array;    int bias, min = array[0], max = array[0];    for (int i = 1; i &lt; array.length; i++) &#123;        if (array[i] &gt; max)            max = array[i];        if (array[i] &lt; min)            min = array[i];    &#125;    bias = 0 - min;    int[] bucket = new int[max - min + 1];    Arrays.fill(bucket, 0);    for (int i = 0; i &lt; array.length; i++) &#123;        bucket[array[i] + bias]++;    &#125;    int index = 0, i = 0;    while (index &lt; array.length) &#123;        if (bucket[i] != 0) &#123;            array[index] = i - bias;            bucket[i]--;            index++;        &#125; else            i++;    &#125;    return array;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-7"><a href="#ç®—æ³•åˆ†æ-7" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>å½“è¾“å…¥çš„å…ƒç´ æ˜¯n ä¸ª0åˆ°kä¹‹é—´çš„æ•´æ•°æ—¶ï¼Œå®ƒçš„è¿è¡Œæ—¶é—´æ˜¯ O(n + k)ã€‚è®¡æ•°æ’åºä¸æ˜¯æ¯”è¾ƒæ’åºï¼Œæ’åºçš„é€Ÿåº¦å¿«äºä»»ä½•æ¯”è¾ƒæ’åºç®—æ³•ã€‚ç”±äºç”¨æ¥è®¡æ•°çš„æ•°ç»„Cçš„é•¿åº¦å–å†³äºå¾…æ’åºæ•°ç»„ä¸­æ•°æ®çš„èŒƒå›´ï¼ˆç­‰äºå¾…æ’åºæ•°ç»„çš„æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®åŠ ä¸Š1ï¼‰ï¼Œè¿™ä½¿å¾—è®¡æ•°æ’åºå¯¹äºæ•°æ®èŒƒå›´å¾ˆå¤§çš„æ•°ç»„ï¼Œéœ€è¦å¤§é‡æ—¶é—´å’Œå†…å­˜ã€‚</p><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n+k)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n+k)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n+k)</p><h2 id="9-æ¡¶æ’åºï¼ˆBucket-Sortï¼‰"><a href="#9-æ¡¶æ’åºï¼ˆBucket-Sortï¼‰" class="headerlink" title="9. æ¡¶æ’åºï¼ˆBucket Sortï¼‰"></a>9. æ¡¶æ’åºï¼ˆBucket Sortï¼‰</h2><p>æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚</p><p>æ¡¶æ’åº (Bucket sort)çš„å·¥ä½œçš„åŸç†ï¼šå‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’</p><h3 id="ç®—æ³•æè¿°-8"><a href="#ç®—æ³•æè¿°-8" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><ol><li>äººä¸ºè®¾ç½®ä¸€ä¸ªBucketSizeï¼Œä½œä¸ºæ¯ä¸ªæ¡¶æ‰€èƒ½æ”¾ç½®å¤šå°‘ä¸ªä¸åŒæ•°å€¼ï¼ˆä¾‹å¦‚å½“BucketSize==5æ—¶ï¼Œè¯¥æ¡¶å¯ä»¥å­˜æ”¾ï½›1,2,3,4,5ï½è¿™å‡ ç§æ•°å­—ï¼Œä½†æ˜¯å®¹é‡ä¸é™ï¼Œå³å¯ä»¥å­˜æ”¾100ä¸ª3ï¼‰ï¼›</li><li>éå†è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å¯¹åº”çš„æ¡¶é‡Œå»ï¼›</li><li>å¯¹æ¯ä¸ªä¸æ˜¯ç©ºçš„æ¡¶è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨å…¶å®ƒæ’åºæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€’å½’ä½¿ç”¨æ¡¶æ’åºï¼›</li><li>ä»ä¸æ˜¯ç©ºçš„æ¡¶é‡ŒæŠŠæ’å¥½åºçš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚ </li></ol><p>æ³¨æ„ï¼Œå¦‚æœé€’å½’ä½¿ç”¨æ¡¶æ’åºä¸ºå„ä¸ªæ¡¶æ’åºï¼Œåˆ™å½“æ¡¶æ•°é‡ä¸º1æ—¶è¦æ‰‹åŠ¨å‡å°BucketSizeå¢åŠ ä¸‹ä¸€å¾ªç¯æ¡¶çš„æ•°é‡ï¼Œå¦åˆ™ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMzIxMDcwOTAtMTkyMDcwMjAxMS5wbmc?x-oss-process=image/format,png"></p><h3 id="ä»£ç å®ç°-8"><a href="#ä»£ç å®ç°-8" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** æ¡¶æ’åº* * @param array* @param bucketSize* @return*/public static ArrayList&lt;Integer&gt; BucketSort(ArrayList&lt;Integer&gt; array, int bucketSize) &#123;    if (array == null || array.size() &lt; 2)        return array;    int max = array.get(0), min = array.get(0);    // æ‰¾åˆ°æœ€å¤§å€¼æœ€å°å€¼    for (int i = 0; i &lt; array.size(); i++) &#123;        if (array.get(i) &gt; max)            max = array.get(i);        if (array.get(i) &lt; min)            min = array.get(i);    &#125;    int bucketCount = (max - min) / bucketSize + 1;    ArrayList&lt;ArrayList&lt;Integer&gt;&gt; bucketArr = new ArrayList&lt;&gt;(bucketCount);    ArrayList&lt;Integer&gt; resultArr = new ArrayList&lt;&gt;();    for (int i = 0; i &lt; bucketCount; i++) &#123;        bucketArr.add(new ArrayList&lt;Integer&gt;());    &#125;    for (int i = 0; i &lt; array.size(); i++) &#123;        bucketArr.get((array.get(i) - min) / bucketSize).add(array.get(i));    &#125;    for (int i = 0; i &lt; bucketCount; i++) &#123;        if (bucketSize == 1) &#123; // å¦‚æœå¸¦æ’åºæ•°ç»„ä¸­æœ‰é‡å¤æ•°å­—æ—¶  æ„Ÿè°¢ @è§é£ä»»ç„¶æ˜¯é£ æœ‹å‹æŒ‡å‡ºé”™è¯¯            for (int j = 0; j &lt; bucketArr.get(i).size(); j++)                resultArr.add(bucketArr.get(i).get(j));        &#125; else &#123;            if (bucketCount == 1)                bucketSize--;            ArrayList&lt;Integer&gt; temp = BucketSort(bucketArr.get(i), bucketSize);            for (int j = 0; j &lt; temp.size(); j++)                resultArr.add(temp.get(j));        &#125;    &#125;    return resultArr;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-8"><a href="#ç®—æ³•åˆ†æ-8" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æ¡¶æ’åºæœ€å¥½æƒ…å†µä¸‹ä½¿ç”¨çº¿æ€§æ—¶é—´O(n)ï¼Œæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå–å†³ä¸å¯¹å„ä¸ªæ¡¶ä¹‹é—´æ•°æ®è¿›è¡Œæ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºå…¶å®ƒéƒ¨åˆ†çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(n)ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ¡¶åˆ’åˆ†çš„è¶Šå°ï¼Œå„ä¸ªæ¡¶ä¹‹é—´çš„æ•°æ®è¶Šå°‘ï¼Œæ’åºæ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šå°‘ã€‚ä½†ç›¸åº”çš„ç©ºé—´æ¶ˆè€—å°±ä¼šå¢å¤§ã€‚ </p><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n+k)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n+k)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n2)ã€€ã€€</p><h2 id="10-åŸºæ•°æ’åºï¼ˆRadix-Sortï¼‰"><a href="#10-åŸºæ•°æ’åºï¼ˆRadix-Sortï¼‰" class="headerlink" title="10. åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰"></a>10. åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰</h2><p>åŸºæ•°æ’åºä¹Ÿæ˜¯éæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œå¯¹æ¯ä¸€ä½è¿›è¡Œæ’åºï¼Œä»æœ€ä½ä½å¼€å§‹æ’åºï¼Œå¤æ‚åº¦ä¸ºO(kn),ä¸ºæ•°ç»„é•¿åº¦ï¼Œkä¸ºæ•°ç»„ä¸­çš„æ•°çš„æœ€å¤§çš„ä½æ•°ï¼›</p><p>åŸºæ•°æ’åºæ˜¯æŒ‰ç…§ä½ä½å…ˆæ’åºï¼Œç„¶åæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æ’åºï¼Œç„¶åå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±æ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æ’åºã€‚æœ€åçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚åŸºæ•°æ’åºåŸºäºåˆ†åˆ«æ’åºï¼Œåˆ†åˆ«æ”¶é›†ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚</p><h3 id="ç®—æ³•æè¿°-9"><a href="#ç®—æ³•æè¿°-9" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><ol><li>å–å¾—æ•°ç»„ä¸­çš„æœ€å¤§æ•°ï¼Œå¹¶å–å¾—ä½æ•°ï¼›</li><li>arrä¸ºåŸå§‹æ•°ç»„ï¼Œä»æœ€ä½ä½å¼€å§‹å–æ¯ä¸ªä½ç»„æˆradixæ•°ç»„ï¼›</li><li>å¯¹ radix è¿›è¡Œè®¡æ•°æ’åºï¼ˆåˆ©ç”¨è®¡æ•°æ’åºé€‚ç”¨äºå°èŒƒå›´æ•°çš„ç‰¹ç‚¹ï¼‰ã€‚</li></ol><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE3LmNuYmxvZ3MuY29tL2Jsb2cvODQ5NTg5LzIwMTcxMC84NDk1ODktMjAxNzEwMTUyMzI0NTM2NjgtMTM5NzY2MjUyNy5naWY"></p><h3 id="ä»£ç å®ç°-9"><a href="#ä»£ç å®ç°-9" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><pre><code class="java">/*** åŸºæ•°æ’åº* @param array* @return*/public static int[] RadixSort(int[] array) &#123;    if (array == null || array.length &lt; 2)        return array;    // 1.å…ˆç®—å‡ºæœ€å¤§æ•°çš„ä½æ•°ï¼›    int max = array[0];    for (int i = 1; i &lt; array.length; i++) &#123;        max = Math.max(max, array[i]);    &#125;    int maxDigit = 0;    while (max != 0) &#123;        max /= 10;        maxDigit++;    &#125;    int mod = 10, div = 1;    ArrayList&lt;ArrayList&lt;Integer&gt;&gt; bucketList = new ArrayList&lt;ArrayList&lt;Integer&gt;&gt;();    for (int i = 0; i &lt; 10; i++)        bucketList.add(new ArrayList&lt;Integer&gt;());    for (int i = 0; i &lt; maxDigit; i++, mod *= 10, div *= 10) &#123;        for (int j = 0; j &lt; array.length; j++) &#123;            int num = (array[j] % mod) / div;            bucketList.get(num).add(array[j]);        &#125;        int index = 0;        for (int j = 0; j &lt; bucketList.size(); j++) &#123;            for (int k = 0; k &lt; bucketList.get(j).size(); k++)                array[index++] = bucketList.get(j).get(k);            bucketList.get(j).clear();        &#125;    &#125;    return array;&#125;</code></pre><h3 id="ç®—æ³•åˆ†æ-9"><a href="#ç®—æ³•åˆ†æ-9" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p>æœ€ä½³æƒ…å†µï¼šT(n) = O(n * k)<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n * k)<br>å¹³å‡æƒ…å†µï¼šT(n) = O(n * k)</p><p>åŸºæ•°æ’åºæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>MSD ä»é«˜ä½å¼€å§‹è¿›è¡Œæ’åº </li><li>LSD ä»ä½ä½å¼€å§‹è¿›è¡Œæ’åº </li></ul><h3 id="åŸºæ•°æ’åº-vs-è®¡æ•°æ’åº-vs-æ¡¶æ’åº"><a href="#åŸºæ•°æ’åº-vs-è®¡æ•°æ’åº-vs-æ¡¶æ’åº" class="headerlink" title="åŸºæ•°æ’åº vs è®¡æ•°æ’åº vs æ¡¶æ’åº"></a>åŸºæ•°æ’åº vs è®¡æ•°æ’åº vs æ¡¶æ’åº</h3><p>è¿™ä¸‰ç§æ’åºç®—æ³•éƒ½åˆ©ç”¨äº†æ¡¶çš„æ¦‚å¿µï¼Œä½†å¯¹æ¡¶çš„ä½¿ç”¨æ–¹æ³•ä¸Šæœ‰æ˜æ˜¾å·®å¼‚ï¼š</p><ul><li>åŸºæ•°æ’åºï¼šæ ¹æ®é”®å€¼çš„æ¯ä½æ•°å­—æ¥åˆ†é…æ¡¶</li><li>è®¡æ•°æ’åºï¼šæ¯ä¸ªæ¡¶åªå­˜å‚¨å•ä¸€é”®å€¼</li><li>æ¡¶æ’åºï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ä¸€å®šèŒƒå›´çš„æ•°å€¼</li></ul>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ’åºç®—æ³• </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> ç”Ÿæ´»æŠ€èƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java è™šæ‹Ÿæœºé¢è¯•é¢˜</title>
      <link href="/2019-12-11/java-vm-interview/"/>
      <url>/2019-12-11/java-vm-interview/</url>
      
        <content type="html"><![CDATA[<h2 id="Javaè™šæ‹Ÿæœºé¢è¯•é¢˜-ï¼ˆâ­â­â­ï¼‰"><a href="#Javaè™šæ‹Ÿæœºé¢è¯•é¢˜-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="Javaè™šæ‹Ÿæœºé¢è¯•é¢˜ ï¼ˆâ­â­â­ï¼‰"></a>Javaè™šæ‹Ÿæœºé¢è¯•é¢˜ ï¼ˆâ­â­â­ï¼‰</h2><span id="more"></span><h4 id="1ã€JVMå†…å­˜åŒºåŸŸã€‚"><a href="#1ã€JVMå†…å­˜åŒºåŸŸã€‚" class="headerlink" title="1ã€JVMå†…å­˜åŒºåŸŸã€‚"></a>1ã€JVMå†…å­˜åŒºåŸŸã€‚</h4><p>JVMåŸºæœ¬æ„æˆ<img src="https://user-gold-cdn.xitu.io/2017/11/21/15fdc4cfaf97ca63?imageslim" alt="image"></p><p>ä»ä¸Šå›¾å¯çŸ¥ï¼ŒJVMä¸»è¦åŒ…æ‹¬å››ä¸ªéƒ¨åˆ†ï¼š</p><p>1.ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰:åœ¨JVMå¯åŠ¨æ—¶æˆ–è€…åœ¨ç±»è¿è¡Œå°†éœ€è¦çš„classåŠ è½½åˆ°JVMä¸­ã€‚ï¼ˆä¸‹å›¾è¡¨ç¤ºäº†ä»javaæºæ–‡ä»¶åˆ°JVMçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå¯é…åˆç†è§£ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2017/11/21/15fdc4cfb0e97353?imageslimo" alt="image"></p><p>2.æ‰§è¡Œå¼•æ“ï¼šè´Ÿè´£æ‰§è¡Œclassæ–‡ä»¶ä¸­åŒ…å«çš„å­—èŠ‚ç æŒ‡ä»¤ï¼›</p><p>3.å†…å­˜åŒºï¼ˆä¹Ÿå«è¿è¡Œæ—¶æ•°æ®åŒºï¼‰ï¼šæ˜¯åœ¨JVMè¿è¡Œçš„æ—¶å€™æ“ä½œæ‰€åˆ†é…çš„å†…å­˜åŒºã€‚è¿è¡Œæ—¶å†…å­˜åŒºä¸»è¦å¯ä»¥åˆ’åˆ†ä¸º5ä¸ªåŒºåŸŸï¼Œå¦‚å›¾ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2017/11/21/15fdc4cfaf3c52a9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p><p>æ–¹æ³•åŒº(MethodArea)ï¼šç”¨äºå­˜å‚¨ç±»ç»“æ„ä¿¡æ¯çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬å¸¸é‡æ± ã€é™æ€å¸¸é‡ã€æ„é€ å‡½æ•°ç­‰ã€‚è™½ç„¶JVMè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªè¾‘éƒ¨åˆ†ï¼Œ ä½†å®ƒå´æœ‰ä¸ªåˆ«ånon-heapï¼ˆéå †ï¼‰ï¼Œæ‰€ä»¥å¤§å®¶ä¸è¦ææ··æ·†äº†ã€‚æ–¹æ³•åŒºè¿˜åŒ…å«ä¸€ä¸ªè¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><p>javaå †(Heap)ï¼šå­˜å‚¨javaå®ä¾‹æˆ–è€…å¯¹è±¡çš„åœ°æ–¹ã€‚è¿™å—æ˜¯GCçš„ä¸»è¦åŒºåŸŸã€‚ä»å­˜å‚¨çš„å†…å®¹æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“ï¼Œæ–¹æ³•å’Œå †æ˜¯è¢«æ‰€æœ‰javaçº¿ç¨‹å…±äº«çš„ã€‚</p><p>javaæ ˆ(Stack)ï¼šjavaæ ˆæ€»æ˜¯å’Œçº¿ç¨‹å…³è”åœ¨ä¸€èµ·ï¼Œæ¯å½“åˆ›ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼ŒJVMå°±ä¼šä¸ºè¿™ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„javaæ ˆåœ¨è¿™ä¸ªjavaæ ˆä¸­,å…¶ä¸­åˆä¼šåŒ…å«å¤šä¸ªæ ˆå¸§ï¼Œæ¯è¿è¡Œä¸€ä¸ªæ–¹æ³•å°±å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€æ–¹æ³•è¿”å›ç­‰ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ä¸€æ ˆå¸§åœ¨javaæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ‰€ä»¥javaæ ˆæ˜¯ç°æˆæœ‰çš„ã€‚</p><p>ç¨‹åºè®¡æ•°å™¨(PCRegister)ï¼šç”¨äºä¿å­˜å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å†…å­˜åœ°å€ã€‚ç”±äºJVMç¨‹åºæ˜¯å¤šçº¿ç¨‹æ‰§è¡Œçš„ï¼ˆçº¿ç¨‹è½®æµåˆ‡æ¢ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯ç¨‹åˆ‡æ¢å›æ¥åï¼Œè¿˜èƒ½æ¢å¤åˆ°åŸå…ˆçŠ¶æ€ï¼Œå°±éœ€è¦ä¸€ä¸ªç‹¬ç«‹è®¡æ•°å™¨ï¼Œè®°å½•ä¹‹å‰ä¸­æ–­çš„åœ°æ–¹ï¼Œå¯è§ç¨‹åºè®¡æ•°å™¨ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p><p>æœ¬åœ°æ–¹æ³•æ ˆ(Native MethodStack)ï¼šå’Œjavaæ ˆçš„ä½œç”¨å·®ä¸å¤šï¼Œåªä¸è¿‡æ˜¯ä¸ºJVMä½¿ç”¨åˆ°nativeæ–¹æ³•æœåŠ¡çš„ã€‚</p><p>4.æœ¬åœ°æ–¹æ³•æ¥å£ï¼šä¸»è¦æ˜¯è°ƒç”¨Cæˆ–C++å®ç°çš„æœ¬åœ°æ–¹æ³•åŠå›è°ƒç»“æœã€‚</p><h5 id="å¼€çº¿ç¨‹å½±å“å“ªå—å†…å­˜ï¼Ÿ"><a href="#å¼€çº¿ç¨‹å½±å“å“ªå—å†…å­˜ï¼Ÿ" class="headerlink" title="å¼€çº¿ç¨‹å½±å“å“ªå—å†…å­˜ï¼Ÿ"></a>å¼€çº¿ç¨‹å½±å“å“ªå—å†…å­˜ï¼Ÿ</h5><p>æ¯å½“æœ‰çº¿ç¨‹è¢«åˆ›å»ºçš„æ—¶å€™ï¼ŒJVMå°±éœ€è¦ä¸ºå…¶åœ¨å†…å­˜ä¸­åˆ†é…è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ¥è®°å½•è°ƒç”¨æ–¹æ³•çš„å†…å®¹ï¼Œåˆ†é…ç¨‹åºè®¡æ•°å™¨è®°å½•æŒ‡ä»¤æ‰§è¡Œçš„ä½ç½®ï¼Œè¿™æ ·çš„å†…å­˜æ¶ˆè€—å°±æ˜¯åˆ›å»ºçº¿ç¨‹çš„å†…å­˜ä»£ä»·ã€‚</p><h4 id="2ã€JVMçš„å†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿ"><a href="#2ã€JVMçš„å†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿ" class="headerlink" title="2ã€JVMçš„å†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿ"></a>2ã€JVMçš„å†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿ</h4><p>Javaå†…å­˜æ¨¡å‹å³Java Memory Modelï¼Œç®€ç§°JMMã€‚JMMå®šä¹‰äº†Java è™šæ‹Ÿæœº(JVM)åœ¨è®¡ç®—æœºå†…å­˜(RAM)ä¸­çš„å·¥ä½œæ–¹å¼ã€‚JVMæ˜¯æ•´ä¸ªè®¡ç®—æœºè™šæ‹Ÿæ¨¡å‹ï¼Œæ‰€ä»¥JMMæ˜¯éš¶å±äºJVMçš„ã€‚</p><p>Javaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œå¹¶ä¸”é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ã€‚è¿™é‡Œæåˆ°çš„å…±äº«å†…å­˜æ¨¡å‹æŒ‡çš„å°±æ˜¯Javaå†…å­˜æ¨¡å‹(ç®€ç§°JMM)ï¼ŒJMMå†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼ŒJMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»/å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯JMMçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p><p>æ€»ä¹‹ï¼ŒJMMå°±æ˜¯ä¸€ç»„è§„åˆ™ï¼Œè¿™ç»„è§„åˆ™æ„åœ¨è§£å†³åœ¨å¹¶å‘ç¼–ç¨‹å¯èƒ½å‡ºç°çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶æä¾›äº†å†…ç½®è§£å†³æ–¹æ¡ˆï¼ˆhappen-beforeåŸåˆ™ï¼‰åŠå…¶å¤–éƒ¨å¯ä½¿ç”¨çš„åŒæ­¥æ‰‹æ®µ(synchronized/volatileç­‰)ï¼Œç¡®ä¿äº†ç¨‹åºæ‰§è¡Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„åº”æœ‰çš„åŸå­æ€§ï¼Œå¯è§†æ€§åŠå…¶æœ‰åºæ€§ã€‚</p><h5 id="éœ€è¦æ›´å…¨é¢ç†è§£å»ºè®®é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š"><a href="#éœ€è¦æ›´å…¨é¢ç†è§£å»ºè®®é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š" class="headerlink" title="éœ€è¦æ›´å…¨é¢ç†è§£å»ºè®®é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š"></a>éœ€è¦æ›´å…¨é¢ç†è§£å»ºè®®é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š</h5><p><a href="https://blog.csdn.net/javazejian/article/details/72772461#%E7%90%86%E8%A7%A3java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E4%B8%8Ejava%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">å…¨é¢ç†è§£Javaå†…å­˜æ¨¡å‹(JMM)åŠvolatileå…³é”®å­—</a></p><p><a href="https://blog.csdn.net/suifeng3051/article/details/52611310">å…¨é¢ç†è§£Javaå†…å­˜æ¨¡å‹</a></p><h4 id="3ã€æè¿°ä¸€ä¸‹GCçš„åŸç†å’Œå›æ”¶ç­–ç•¥ï¼Ÿ"><a href="#3ã€æè¿°ä¸€ä¸‹GCçš„åŸç†å’Œå›æ”¶ç­–ç•¥ï¼Ÿ" class="headerlink" title="3ã€æè¿°ä¸€ä¸‹GCçš„åŸç†å’Œå›æ”¶ç­–ç•¥ï¼Ÿ"></a>3ã€æè¿°ä¸€ä¸‹GCçš„åŸç†å’Œå›æ”¶ç­–ç•¥ï¼Ÿ</h4><p>æåˆ°åƒåœ¾å›æ”¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å»åšåƒåœ¾å›æ”¶éœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ </p><p>ä¸€èˆ¬è¯´æ¥ï¼Œæˆ‘ä»¬è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š</p><p>1ã€å›æ”¶å“ªäº›å†…å­˜ï¼Ÿ</p><p>2ã€ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ</p><p>3ã€å¦‚ä½•å›æ”¶ï¼Ÿ</p><p>è¿™äº›é—®é¢˜åˆ†åˆ«å¯¹åº”ç€å¼•ç”¨ç®¡ç†å’Œå›æ”¶ç­–ç•¥ç­‰æ–¹æ¡ˆã€‚</p><p>æåˆ°å¼•ç”¨ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“Javaä¸­æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼š</p><ul><li>å¼ºå¼•ç”¨ï¼šä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>è½¯å¼•ç”¨ï¼šSoftReferenceï¼Œç”¨æ¥æè¿°è¿˜æœ‰ç”¨ä½†æ˜¯éå¿…é¡»çš„å¯¹è±¡ï¼Œå½“å†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå›æ”¶è¿™ç±»å¯¹è±¡ã€‚</li><li>å¼±å¼•ç”¨ï¼šWeakReferenceï¼Œç”¨æ¥æè¿°éå¿…é¡»å¯¹è±¡ï¼Œå¼±å¼•ç”¨çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡GCå‘ç”Ÿæ—¶ï¼Œå½“GCå‘ç”Ÿæ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚</li><li>è™šå¼•ç”¨ï¼šPhantomReferenceï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´äº§ç”Ÿå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å–å¾—ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå­˜åœ¨çš„å”¯ä¸€ç›®çš„æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶å¯ä»¥æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</li></ul><p>ä¸åŒçš„å¼•ç”¨ç±»å‹ï¼Œåœ¨åšGCæ—¶ä¼šåŒºåˆ«å¯¹å¾…ï¼Œæˆ‘ä»¬å¹³æ—¶ç”Ÿæˆçš„Javaå¯¹è±¡ï¼Œé»˜è®¤éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦å¼ºå¼•ç”¨è¿˜åœ¨ï¼ŒGCå°±ä¸ä¼šå›æ”¶ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å¼ºå¼•ç”¨æ˜¯å¦å­˜åœ¨å‘¢ï¼Ÿ</p><p>ä¸€ä¸ªç®€å•çš„æ€è·¯å°±æ˜¯ï¼šå¼•ç”¨è®¡æ•°æ³•ï¼Œæœ‰å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨å°±+1ï¼Œä¸å†å¼•ç”¨å°±-1ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼çœ‹èµ·æ¥ç®€å•ç¾å¥½ï¼Œä½†å®ƒå´ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨è®¡æ•°çš„é—®é¢˜ã€‚</p><p>å› æ­¤å¯è¾¾æ€§åˆ†æç®—æ³•ç™»ä¸Šå†å²èˆå°ï¼Œç”¨å®ƒæ¥åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ˜¯å¦å­˜åœ¨ã€‚</p><p>å¯è¾¾æ€§åˆ†æç®—æ³•é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸ºGCRootsçš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹ä»ä¸Šå‘ä¸‹æœç´¢ï¼Œæ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ä¸GCRootsè¿æ¥æ—¶å°±è¯´æ˜æ­¤å¯¹è±¡ä¸å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡ä¸å¯è¾¾ã€‚</p><p>GC Rootså¯¹è±¡é€šå¸¸åŒ…æ‹¬ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰</li><li>æ–¹æ³•ä¸­ç±»çš„é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>Nativeæ–¹æ³•å¼•ç”¨çš„å¯¹è±¡</li></ul><p>å¯è¾¾æ€§åˆ†æç®—æ³•æ•´ä¸ªæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>ç¬¬ä¸€æ¬¡æ ‡è®°ï¼šå¯¹è±¡åœ¨ç»è¿‡å¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸GC Rootsæœ‰å¼•ç”¨é“¾ï¼Œåˆ™è¿›è¡Œç¬¬ä¸€æ¬¡æ ‡è®°å¹¶è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰æ¡ä»¶æ˜¯ï¼šè¯¥å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•æˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«æ‰§è¡Œè¿‡éƒ½ä¼šè¢«è®¤ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚<br>å¦‚æœæœ‰å¿…è¦æ‰§è¡Œï¼šåˆ™è¯¥å¯¹è±¡ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªF-Queueé˜Ÿåˆ—ï¼Œå¹¶ç¨ååœ¨ç”±è™šæ‹Ÿæœºå»ºç«‹çš„ä½ä¼˜å…ˆçº§Finalizerçº¿ç¨‹ä¸­è§¦å‘è¯¥å¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œä½†ä¸ä¿è¯ä¸€å®šç­‰å¾…å®ƒæ‰§è¡Œç»“æŸï¼Œå› ä¸ºå¦‚æœè¿™ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•å‘ç”Ÿäº†æ­»å¾ªç¯æˆ–è€…æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æƒ…å†µï¼Œä¼šé˜»å¡F-Queueé˜Ÿåˆ—é‡Œçš„å…¶ä»–å¯¹è±¡ï¼Œå½±å“GCã€‚</p><p>ç¬¬äºŒæ¬¡æ ‡è®°ï¼šGCå¯¹F-Queueé˜Ÿåˆ—é‡Œçš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œå¦‚æœåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶è¯¥å¯¹è±¡åˆæˆåŠŸè¢«å¼•ç”¨ï¼Œåˆ™ä¼šè¢«ç§»é™¤å³å°†å›æ”¶çš„é›†åˆï¼Œå¦åˆ™ä¼šè¢«å›æ”¶ã€‚</p><p>æ€»ä¹‹ï¼ŒJVMåœ¨åšåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥å †ä¸­çš„æ‰€æœ‰å¯¹è±¡å¦ä¼šè¢«è¿™äº›æ ¹é›†å¯¹è±¡å¼•ç”¨ï¼Œä¸èƒ½å¤Ÿè¢«å¼•ç”¨çš„å¯¹è±¡å°±ä¼šè¢«åœ¾æ”¶é›†å™¨å›æ”¶ã€‚ä¸€èˆ¬å›æ”¶ç®—æ³•ä¹Ÿæœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><p>1).æ ‡è®°-æ¸…é™¤ï¼ˆMark-sweepï¼‰</p><p>æ ‡è®°-æ¸…é™¤ç®—æ³•é‡‡ç”¨ä»æ ¹é›†åˆè¿›è¡Œæ‰«æï¼Œå¯¹å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œæ ‡è®°å®Œæ¯•åï¼Œå†æ‰«ææ•´ä¸ªç©ºé—´ä¸­æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œè¿›è¡Œå›æ”¶ã€‚æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸éœ€è¦è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨ï¼Œå¹¶ä¸”ä»…å¯¹ä¸å­˜æ´»çš„å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œåœ¨å­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æä¸ºé«˜æ•ˆï¼Œä½†ç”±äºæ ‡è®°-æ¸…é™¤ç®—æ³•ç›´æ¥å›æ”¶ä¸å­˜æ´»çš„å¯¹è±¡ï¼Œå› æ­¤ä¼šé€ æˆå†…å­˜ç¢ç‰‡ã€‚</p><p>2).æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</p><p>æ ‡è®°-æ•´ç†ç®—æ³•é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸€æ ·çš„æ–¹å¼è¿›è¡Œå¯¹è±¡çš„æ ‡è®°ï¼Œä½†åœ¨æ¸…é™¤æ—¶ä¸åŒï¼Œåœ¨å›æ”¶ä¸å­˜æ´»çš„å¯¹è±¡å ç”¨çš„ç©ºé—´åï¼Œä¼šå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å¾€å·¦ç«¯ç©ºé—²ç©ºé—´ç§»åŠ¨ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„æŒ‡é’ˆã€‚æ ‡è®°-æ•´ç†ç®—æ³•æ˜¯åœ¨æ ‡è®°-æ¸…é™¤ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œåˆè¿›è¡Œäº†å¯¹è±¡çš„ç§»åŠ¨ï¼Œå› æ­¤æˆæœ¬æ›´é«˜ï¼Œä½†æ˜¯å´è§£å†³äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚è¯¥åƒåœ¾å›æ”¶ç®—æ³•é€‚ç”¨äºå¯¹è±¡å­˜æ´»ç‡é«˜çš„åœºæ™¯ï¼ˆè€å¹´ä»£ï¼‰ã€‚</p><p>3).å¤åˆ¶ï¼ˆCopyingï¼‰</p><p>ã€€å¤åˆ¶ç®—æ³•å°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™ç§ç®—æ³•é€‚ç”¨äºå¯¹è±¡å­˜æ´»ç‡ä½çš„åœºæ™¯ï¼Œæ¯”å¦‚æ–°ç”Ÿä»£ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µã€‚</p><p>4).åˆ†ä»£æ”¶é›†ç®—æ³•</p><p>ä¸åŒçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ(å­˜æ´»æƒ…å†µ)æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ä½äºå †ä¸­ä¸åŒçš„åŒºåŸŸï¼Œå› æ­¤å¯¹å †å†…å­˜ä¸åŒåŒºåŸŸé‡‡ç”¨ä¸åŒçš„ç­–ç•¥è¿›è¡Œå›æ”¶å¯ä»¥æé«˜ JVM çš„æ‰§è¡Œæ•ˆç‡ã€‚å½“ä»£å•†ç”¨è™šæ‹Ÿæœºä½¿ç”¨çš„éƒ½æ˜¯åˆ†ä»£æ”¶é›†ç®—æ³•ï¼šæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»ç‡ä½ï¼Œå°±é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼›è€å¹´ä»£å­˜æ´»ç‡é«˜ï¼Œå°±ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•æˆ–è€…æ ‡è®°æ•´ç†ç®—æ³•ã€‚Javaå †å†…å­˜ä¸€èˆ¬å¯ä»¥åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ä¸‰ä¸ªæ¨¡å—ï¼š</p><h5 id="æ–°ç”Ÿä»£ï¼š"><a href="#æ–°ç”Ÿä»£ï¼š" class="headerlink" title="æ–°ç”Ÿä»£ï¼š"></a>æ–°ç”Ÿä»£ï¼š</h5><p>1.æ‰€æœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡é¦–å…ˆéƒ½æ˜¯æ”¾åœ¨æ–°ç”Ÿä»£çš„ã€‚æ–°ç”Ÿä»£çš„ç›®æ ‡å°±æ˜¯å°½å¯èƒ½å¿«é€Ÿçš„æ”¶é›†æ‰é‚£äº›ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ã€‚</p><p>2.æ–°ç”Ÿä»£å†…å­˜æŒ‰ç…§8:1:1çš„æ¯”ä¾‹åˆ†ä¸ºä¸€ä¸ªedenåŒºå’Œä¸¤ä¸ªsurvivor(survivor0,survivor1)åŒºã€‚å¤§éƒ¨åˆ†å¯¹è±¡åœ¨EdenåŒºä¸­ç”Ÿæˆã€‚å›æ”¶æ—¶å…ˆå°†edenåŒºå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ä¸€ä¸ªsurvivor0åŒºï¼Œç„¶åæ¸…ç©ºedenåŒºï¼Œå½“è¿™ä¸ªsurvivor0åŒºä¹Ÿå­˜æ”¾æ»¡äº†æ—¶ï¼Œåˆ™å°†edenåŒºå’Œsurvivor0åŒºå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªsurvivor1åŒºï¼Œç„¶åæ¸…ç©ºedenå’Œè¿™ä¸ªsurvivor0åŒºï¼Œæ­¤æ—¶survivor0åŒºæ˜¯ç©ºçš„ï¼Œç„¶åå°†survivor0åŒºå’Œsurvivor1åŒºäº¤æ¢ï¼Œå³ä¿æŒsurvivor1åŒºä¸ºç©ºï¼Œ å¦‚æ­¤å¾€å¤ã€‚</p><p>3.å½“survivor1åŒºä¸è¶³ä»¥å­˜æ”¾ edenå’Œsurvivor0çš„å­˜æ´»å¯¹è±¡æ—¶ï¼Œå°±å°†å­˜æ´»å¯¹è±¡ç›´æ¥å­˜æ”¾åˆ°è€å¹´ä»£ã€‚è‹¥æ˜¯è€å¹´ä»£ä¹Ÿæ»¡äº†å°±ä¼šè§¦å‘ä¸€æ¬¡Full GCï¼Œä¹Ÿå°±æ˜¯æ–°ç”Ÿä»£ã€è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ã€‚</p><p>4.æ–°ç”Ÿä»£å‘ç”Ÿçš„GCä¹Ÿå«åšMinor GCï¼ŒMinorGCå‘ç”Ÿé¢‘ç‡æ¯”è¾ƒé«˜(ä¸ä¸€å®šç­‰EdenåŒºæ»¡äº†æ‰è§¦å‘)ã€‚</p><h5 id="è€å¹´ä»£ï¼š"><a href="#è€å¹´ä»£ï¼š" class="headerlink" title="è€å¹´ä»£ï¼š"></a>è€å¹´ä»£ï¼š</h5><p>1.åœ¨è€å¹´ä»£ä¸­ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°è€å¹´ä»£ä¸­ã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºè€å¹´ä»£ä¸­å­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚</p><p>2.å†…å­˜æ¯”æ–°ç”Ÿä»£ä¹Ÿå¤§å¾ˆå¤š(å¤§æ¦‚æ¯”ä¾‹æ˜¯1:2)ï¼Œå½“è€å¹´ä»£å†…å­˜æ»¡æ—¶è§¦å‘Major GCï¼Œå³Full GCã€‚Full GCå‘ç”Ÿé¢‘ç‡æ¯”è¾ƒä½ï¼Œè€å¹´ä»£å¯¹è±¡å­˜æ´»æ—¶é—´æ¯”è¾ƒé•¿ã€‚</p><h5 id="æ°¸ä¹…ä»£ï¼š"><a href="#æ°¸ä¹…ä»£ï¼š" class="headerlink" title="æ°¸ä¹…ä»£ï¼š"></a>æ°¸ä¹…ä»£ï¼š</h5><p>æ°¸ä¹…ä»£ä¸»è¦å­˜æ”¾é™æ€æ–‡ä»¶ï¼Œå¦‚Javaç±»ã€æ–¹æ³•ç­‰ã€‚æ°¸ä¹…ä»£å¯¹åƒåœ¾å›æ”¶æ²¡æœ‰æ˜¾è‘—å½±å“ï¼Œä½†æ˜¯æœ‰äº›åº”ç”¨å¯èƒ½åŠ¨æ€ç”Ÿæˆæˆ–è€…è°ƒç”¨ä¸€äº›classï¼Œä¾‹å¦‚ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLibç­‰bytecodeæ¡†æ¶æ—¶ï¼Œåœ¨è¿™ç§æ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ°¸ä¹…ä»£ç©ºé—´æ¥å­˜æ”¾è¿™äº›è¿è¡Œè¿‡ç¨‹ä¸­æ–°å¢çš„ç±»ã€‚</p><h5 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h5><p>åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ï¼š</p><ul><li><p>Serialæ”¶é›†å™¨ï¼ˆå¤åˆ¶ç®—æ³•): æ–°ç”Ÿä»£å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œæ ‡è®°å’Œæ¸…ç†éƒ½æ˜¯å•çº¿ç¨‹ï¼Œä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆï¼›</p></li><li><p>Serial Oldæ”¶é›†å™¨ (æ ‡è®°-æ•´ç†ç®—æ³•): è€å¹´ä»£å•çº¿ç¨‹æ”¶é›†å™¨ï¼ŒSerialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼›</p></li><li><p>ParNewæ”¶é›†å™¨ (å¤åˆ¶ç®—æ³•): æ–°ç”Ÿä»£æ”¶å¹¶è¡Œé›†å™¨ï¼Œå®é™…ä¸Šæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œåœ¨å¤šæ ¸CPUç¯å¢ƒä¸‹æœ‰ç€æ¯”Serialæ›´å¥½çš„è¡¨ç°ï¼›</p></li><li><p>CMS(Concurrent Mark Sweep)æ”¶é›†å™¨ï¼ˆæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼‰ï¼š è€å¹´ä»£å¹¶è¡Œæ”¶é›†å™¨ï¼Œä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå…·æœ‰é«˜å¹¶å‘ã€ä½åœé¡¿çš„ç‰¹ç‚¹ï¼Œè¿½æ±‚æœ€çŸ­GCå›æ”¶åœé¡¿æ—¶é—´ã€‚</p></li><li><p>Parallel Oldæ”¶é›†å™¨ (æ ‡è®°-æ•´ç†ç®—æ³•)ï¼š è€å¹´ä»£å¹¶è¡Œæ”¶é›†å™¨ï¼Œååé‡ä¼˜å…ˆï¼ŒParallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼›</p></li><li><p>Parallel Scavengeæ”¶é›†å™¨ (å¤åˆ¶ç®—æ³•): æ–°ç”Ÿä»£å¹¶è¡Œæ”¶é›†å™¨ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œé«˜æ•ˆåˆ©ç”¨ CPUã€‚ååé‡ = ç”¨æˆ·çº¿ç¨‹æ—¶é—´/(ç”¨æˆ·çº¿ç¨‹æ—¶é—´+GCçº¿ç¨‹æ—¶é—´)ï¼Œé«˜ååé‡å¯ä»¥é«˜æ•ˆç‡çš„åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œé€‚åˆåå°åº”ç”¨ç­‰å¯¹äº¤äº’ç›¸åº”è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼›</p></li><li><p>G1(Garbage First)æ”¶é›†å™¨ (æ ‡è®°-æ•´ç†ç®—æ³•)ï¼š Javaå †å¹¶è¡Œæ”¶é›†å™¨ï¼ŒG1æ”¶é›†å™¨æ˜¯JDK1.7æä¾›çš„ä¸€ä¸ªæ–°æ”¶é›†å™¨ï¼ŒG1æ”¶é›†å™¨åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚æ­¤å¤–ï¼ŒG1æ”¶é›†å™¨ä¸åŒäºä¹‹å‰çš„æ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯ï¼šG1å›æ”¶çš„èŒƒå›´æ˜¯æ•´ä¸ªJavaå †(åŒ…æ‹¬æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£)ï¼Œè€Œå‰å…­ç§æ”¶é›†å™¨å›æ”¶çš„èŒƒå›´ä»…é™äºæ–°ç”Ÿä»£æˆ–è€å¹´ä»£ã€‚</p></li></ul><h5 id="å†…å­˜åˆ†é…å’Œå›æ”¶ç­–ç•¥"><a href="#å†…å­˜åˆ†é…å’Œå›æ”¶ç­–ç•¥" class="headerlink" title="å†…å­˜åˆ†é…å’Œå›æ”¶ç­–ç•¥"></a>å†…å­˜åˆ†é…å’Œå›æ”¶ç­–ç•¥</h5><p>JAVAè‡ªåŠ¨å†…å­˜ç®¡ç†ï¼šç»™å¯¹è±¡åˆ†é…å†…å­˜ ä»¥åŠ å›æ”¶åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜ã€‚</p><p>1ã€å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…ï¼Œå½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡MinorGCã€‚</p><p>2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚å¦‚å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚</p><p>3ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£ã€‚å½“å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ç»å†è¿‡ä¸€å®šæ¬¡æ•°ï¼ˆé»˜è®¤ä¸º15ï¼‰çš„Minor GCåï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚</p><p>4ã€åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šã€‚ä¸ºäº†æ›´å¥½åœ°é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜çŠ¶å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œåœ°è¦æ±‚å¯¹è±¡å¹´é¾„å¿…é¡»è¾¾åˆ°äº†MaxTenuringThresholdæ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„å¹´é¾„ã€‚</p><p><a href="https://blog.csdn.net/justloveyou_/article/details/71216049">éœ€è¦æ›´å…¨é¢çš„ç†è§£è¯·ç‚¹å‡»è¿™é‡Œ</a></p><h4 id="4ã€ç±»çš„åŠ è½½å™¨ï¼ŒåŒäº²æœºåˆ¶ï¼ŒAndroidçš„ç±»åŠ è½½å™¨ã€‚"><a href="#4ã€ç±»çš„åŠ è½½å™¨ï¼ŒåŒäº²æœºåˆ¶ï¼ŒAndroidçš„ç±»åŠ è½½å™¨ã€‚" class="headerlink" title="4ã€ç±»çš„åŠ è½½å™¨ï¼ŒåŒäº²æœºåˆ¶ï¼ŒAndroidçš„ç±»åŠ è½½å™¨ã€‚"></a>4ã€ç±»çš„åŠ è½½å™¨ï¼ŒåŒäº²æœºåˆ¶ï¼ŒAndroidçš„ç±»åŠ è½½å™¨ã€‚</h4><h5 id="ç±»çš„åŠ è½½å™¨"><a href="#ç±»çš„åŠ è½½å™¨" class="headerlink" title="ç±»çš„åŠ è½½å™¨"></a>ç±»çš„åŠ è½½å™¨</h5><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œä¸€ä¸ªJavaç¨‹åºéƒ½æ˜¯ç”±è‹¥å¹²ä¸ª.classæ–‡ä»¶ç»„ç»‡è€Œæˆçš„ä¸€ä¸ªå®Œæ•´çš„Javaåº”ç”¨ç¨‹åºï¼Œå½“ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå³ä¼šè°ƒç”¨è¯¥ç¨‹åºçš„ä¸€ä¸ªå…¥å£å‡½æ•°æ¥è°ƒç”¨ç³»ç»Ÿçš„ç›¸å…³åŠŸèƒ½ï¼Œè€Œè¿™äº›åŠŸèƒ½éƒ½è¢«å°è£…åœ¨ä¸åŒçš„classæ–‡ä»¶å½“ä¸­ï¼Œæ‰€ä»¥ç»å¸¸è¦ä»è¿™ä¸ªclassæ–‡ä»¶ä¸­è¦è°ƒç”¨å¦å¤–ä¸€ä¸ªclassæ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœå¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸å­˜åœ¨çš„è¯ï¼Œåˆ™ä¼šå¼•å‘ç³»ç»Ÿå¼‚å¸¸ã€‚</p><p>è€Œç¨‹åºåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½ç¨‹åºæ‰€è¦ç”¨åˆ°çš„classæ–‡ä»¶ï¼Œè€Œæ˜¯æ ¹æ®ç¨‹åºçš„éœ€è¦ï¼Œé€šè¿‡Javaçš„ç±»åŠ è½½åˆ¶ï¼ˆClassLoaderï¼‰æ¥åŠ¨æ€åŠ è½½æŸä¸ªclassæ–‡ä»¶åˆ°å†…å­˜å½“çš„ï¼Œä»è€Œåªæœ‰classæ–‡ä»¶è¢«è½½å…¥åˆ°äº†å†…å­˜ä¹‹åï¼Œæ‰èƒ½è¢«å…¶å®ƒclassæ–‡ä»¶æ‰€å¼•ç”¨ã€‚æ‰€ä»¥ClassLoaderå°±æ˜¯ç”¨æ¥åŠ¨æ€åŠ è½½classä»¶åˆ°å†…å­˜å½“ä¸­ç”¨çš„ã€‚</p><h5 id="åŒäº²æœºåˆ¶"><a href="#åŒäº²æœºåˆ¶" class="headerlink" title="åŒäº²æœºåˆ¶"></a>åŒäº²æœºåˆ¶</h5><p>ç±»çš„åŠ è½½å°±æ˜¯è™šæ‹Ÿæœºé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œè€Œå®Œæˆè¿™ä¸ªåŠ è½½åŠ¨ä½œçš„å°±æ˜¯ç±»åŠ è½½å™¨ã€‚</p><p>ç±»å’Œç±»åŠ è½½å™¨æ¯æ¯ç›¸å…³ï¼Œåˆ¤å®šä¸¤ä¸ªç±»æ˜¯å¦ç›¸ç­‰ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»è¢«åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„æƒ…å†µä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™å³ä¾¿æ˜¯ä¸¤ä¸ªç±»æ¥è‡ªåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«ä¸åŒç±»åŠ è½½å™¨åŠ è½½ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p><p>æ³¨ï¼šè¿™é‡Œçš„ç›¸ç­‰æ€§ä¿å‡½Classå¯¹è±¡çš„equals()æ–¹æ³•ã€isAssignableFrom()æ–¹æ³•ã€isInstance()æ–¹æ³•çš„è¿”å›ç»“æœä»¥åŠInstanceå…³é”®å­—å¯¹å¯¹è±¡æ‰€å±å…³ç³»çš„åˆ¤å®šç»“æœç­‰ã€‚</p><p>ç±»åŠ è½½å™¨å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼šè´Ÿè´£åŠ è½½<JAVA_HOME>\libç›®å½•ä¸‹æˆ–è€…è¢«-Xbootclasspathå‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„çš„ï¼Œå¹¶ä¸”æ˜¯è¢«è™šæ‹Ÿæœºæ‰€è¯†åˆ«çš„åº“åˆ°å†…å­˜ä¸­ã€‚</p></li><li><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šè´Ÿè´£åŠ è½½<JAVA_HOME>\lib\extç›®å½•ä¸‹æˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„çš„æ‰€æœ‰ç±»åº“åˆ°å†…å­˜ä¸­ã€‚</p></li><li><p>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ä¸Šçš„æŒ‡å®šç±»åº“ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰å®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬å°±æ˜¯è¿™ä¸ªç±»åŠ è½½å™¨å»åŠ è½½åº”ç”¨ç¨‹åºä¸­çš„ç±»åº“ã€‚</p></li></ul><p>1ã€åŸç†ä»‹ç»</p><p>ClassLoaderä½¿ç”¨çš„æ˜¯åŒäº²å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»çš„ï¼Œæ¯ä¸ªClassLoaderå®ä¾‹éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼ˆä¸æ˜¯ç»§æ‰¿çš„å…³ç³»ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«çš„å…³ç³»ï¼‰ï¼Œè™šæ‹Ÿæœºå†…ç½®çš„ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰æœ¬èº«æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œä½†å¯ä»¥ç”¨ä½œå…¶å®ƒlassLoaderå®ä¾‹çš„çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p><p>å½“ä¸€ä¸ªClassLoaderå®ä¾‹éœ€è¦åŠ è½½æŸä¸ªç±»æ—¶ï¼Œå®ƒä¼šåœ¨è¯•å›¾æœç´¢æŸä¸ªç±»ä¹‹å‰ï¼Œå…ˆæŠŠè¿™ä¸ªä»»åŠ¡å§”æ‰˜ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸Šè‡³ä¸‹ä¾æ¬¡æ£€æŸ¥çš„ï¼Œé¦–å…ˆç”±æœ€é¡¶å±‚çš„ç±»åŠ è½½å™¨Bootstrap ClassLoaderè¯•å›¾åŠ è½½ï¼Œå¦‚æœæ²¡åŠ è½½åˆ°ï¼Œåˆ™æŠŠä»»åŠ¡è½¬äº¤ç»™Extension ClassLoaderè¯•å›¾åŠ è½½ï¼Œå¦‚æœä¹Ÿæ²¡åŠ è½½åˆ°ï¼Œåˆ™è½¬äº¤ç»™App ClassLoader è¿›è¡ŒåŠ è½½ï¼Œå¦‚æœå®ƒä¹Ÿæ²¡æœ‰åŠ è½½å¾—åˆ°çš„è¯ï¼Œåˆ™è¿”å›ç»™å§”æ‰˜çš„å‘èµ·è€…ï¼Œç”±å®ƒåˆ°æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿæˆ–ç½‘ç»œç­‰å¾…URLä¸­åŠ è½½è¯¥ç±»ã€‚</p><p>å¦‚æœå®ƒä»¬éƒ½æ²¡æœ‰åŠ è½½åˆ°è¿™ä¸ªç±»æ—¶ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚å¦åˆ™å°†è¿™ä¸ªæ‰¾åˆ°çš„ç±»ç”Ÿæˆä¸€ä¸ªç±»çš„å®šä¹‰ï¼Œå°†å®ƒåŠ è½½åˆ°å†…å­˜å½“ä¸­ï¼Œæœ€åè¿”å›è¿™ä¸ªç±»åœ¨å†…å­˜ä¸­çš„Classå®ä¾‹å¯¹è±¡ã€‚</p><p>ç±»åŠ è½½æœºåˆ¶ï¼š</p><p>ç±»çš„åŠ è½½æŒ‡çš„æ˜¯å°†ç±»çš„.classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•å»å†…ï¼Œç„¶ååœ¨å †åŒºåˆ›å»ºä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œç”¨æ¥å°è£…åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ã€‚ç±»çš„åŠ è½½æœ€ç»ˆæ˜¯åœ¨å †åŒºå†…çš„Classå¯¹è±¡ï¼ŒClasså¯¹è±¡å°è£…äº†ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å‘Javaç¨‹åºå‘˜æä¾›äº†è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ã€‚</p><p>ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><p>1ï¼‰å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”±JVMåˆå§‹åŒ–åŠ è½½</p><p>2ï¼‰é€šè¿‡Class.forNameï¼ˆï¼‰æ–¹æ³•åŠ¨æ€åŠ è½½</p><p>3ï¼‰é€šè¿‡ClassLoader.loadClassï¼ˆï¼‰æ–¹æ³•åŠ¨æ€åŠ è½½</p><p>è¿™ä¹ˆå¤šç±»åŠ è½½å™¨ï¼Œé‚£ä¹ˆå½“ç±»åœ¨åŠ è½½çš„æ—¶å€™ä¼šä½¿ç”¨å“ªä¸ªåŠ è½½å™¨å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™å°±è¦æåˆ°ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼Œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://github.com/guoxiaoxing/android-open-source-project-analysis/raw/master/art/native/vm/classloader_model_structure.png" alt="image"></p><p>åŒäº²å§”æ´¾æ¨¡å‹çš„æ•´ä¸ªå·¥ä½œæµç¨‹éå¸¸çš„ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†åŠ è½½ç±»çš„è¯·æ±‚ï¼Œå®ƒä¸ä¼šè‡ªå·±ç«‹å»åŠ è½½ç±»ï¼Œå®ƒä¼šå…ˆå»è¯·æ±‚çˆ¶ç±»åŠ è½½å™¨ï¼Œæ¯ä¸ªå±‚æ¬¡çš„ç±»åŠ å™¨éƒ½æ˜¯å¦‚æ­¤ã€‚å±‚å±‚ä¼ é€’ï¼Œç›´åˆ°ä¼ é€’åˆ°æœ€é«˜å±‚çš„ç±»åŠ è½½å™¨åªæœ‰å½“ çˆ¶ç±»åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œæ‰ä¼šæœ‰å½“å­ç±»åŠ è½½å™¨å»åŠ è½½è¯¥ç±»ã€‚</p><p>2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ‰˜è¿™ç§æ¨¡å‹å‘¢ï¼Ÿ</p><p>å› ä¸ºè¿™æ ·å¯ä»¥é¿å…é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰å¿…è¦è®©å­ClassLoaderå†åŠ è½½ä¸€æ¬¡ã€‚</p><p>è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œæˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ç§å§”æ‰˜æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥éšæ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„Stringæ¥åŠ¨æ€æ›¿ä»£javaæ ¸å¿ƒapiä¸­å®šä¹‰çš„ç±»å‹ï¼Œè¿™æ ·ä¼šå­˜åœ¨éå¸¸å¤§çš„å®‰å…¨éšæ‚£ï¼Œè€ŒåŒäº²å§”æ‰˜çš„æ–¹å¼ï¼Œå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œå› ä¸ºStringå·²ç»åœ¨å¯åŠ¨æ—¶å°±è¢«å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrcpClassLoaderï¼‰åŠ è½½ï¼Œæ‰€ä»¥ç”¨æˆ·è‡ªå®šä¹‰çš„ClassLoaderæ°¸è¿œä¹Ÿæ— æ³•åŠ è½½ä¸€ä¸ªè‡ªå·±å†™çš„Stringï¼Œé™¤éä½ æ”¹å˜JDKä¸­ClassLoaderæœç´¢ç±»çš„é»˜è®¤ç®—æ³•ã€‚</p><p>3ã€ä½†æ˜¯JVMåœ¨æœç´¢ç±»çš„æ—¶å€™ï¼Œåˆæ˜¯å¦‚ä½•åˆ¤å®šä¸¤ä¸ªclassæ˜¯ç›¸åŒçš„å‘¢ï¼Ÿ</p><p>JVMåœ¨åˆ¤å®šä¸¤ä¸ªclassæ˜¯å¦ç›¸åŒæ—¶ï¼Œä¸ä»…è¦åˆ¤æ–­ä¸¤ä¸ªç±»åå¦ç›¸åŒï¼Œè€Œä¸”è¦åˆ¤æ–­æ˜¯å¦ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨å®ä¾‹åŠ è½½çš„ã€‚</p><p>åªæœ‰ä¸¤è€…åŒæ—¶æ»¡è¶³çš„æƒ…å†µä¸‹ï¼ŒJVMæ‰è®¤ä¸ºè¿™ä¸¤ä¸ªclassæ˜¯ç›¸åŒçš„ã€‚å°±ç®—ä¸¤ä¸ªclassæ˜¯åŒä¸€ä»½classå­—èŠ‚ç ï¼Œå¦‚æœè¢«ä¸¤ä¸ªä¸åŒçš„ClassLoaderå®ä¾‹æ‰€åŠ è½½ï¼ŒJVMä¹Ÿä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒclassã€‚</p><p>æ¯”å¦‚ç½‘ç»œä¸Šçš„ä¸€ä¸ªJavaç±»org.classloader.simple.NetClassLoaderSimpleï¼Œjavacç¼–è¯‘ä¹‹åç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶NetClasLoaderSimple.classï¼ŒClassLoaderAå’ŒClassLoaderBè¿™ä¸ªç±»åŠ è½½å™¨å¹¶è¯»å–äº†NetClassLoaderSimple.classæ–‡ä»¶å¹¶åˆ†åˆ«å®šä¹‰å‡ºäº†java.lang.Classå®ä¾‹æ¥è¡¨ç¤ºè¿™ä¸ªç±»ï¼Œå¯¹JVMæ¥è¯´ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡ï¼Œä½†å®ƒä»¬ç¡®å®æ˜¯ä¸€ä»½å­—èŠ‚ç æ–‡ä»¶ï¼Œå¦‚æœè¯•å›¾å°†è¿™ä¸ªClasså®ä¾‹ç”Ÿæˆå…·ä½“çš„å¯¹è±¡è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ä¼šæŠ›è¿è¡Œæ—¶å¼‚å¸¸java.lang.ClassCastExceptionï¼Œæç¤ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚</p><h4 id="Androidç±»åŠ è½½å™¨"><a href="#Androidç±»åŠ è½½å™¨" class="headerlink" title="Androidç±»åŠ è½½å™¨"></a>Androidç±»åŠ è½½å™¨</h4><p>å¯¹äºAndroidè€Œè¨€ï¼Œæœ€ç»ˆçš„apkæ–‡ä»¶åŒ…å«çš„æ˜¯dexç±»å‹çš„æ–‡ä»¶ï¼Œdexæ–‡ä»¶æ˜¯å°†classæ–‡ä»¶é‡æ–°æ‰“åŒ…ï¼Œæ‰“åŒ…çš„è§„åˆ™åˆä¸æ˜¯ç®€å•åœ°å‹ç¼©ï¼Œè€Œæ˜¯å®Œå…¨å¯¹classæ–‡ä»¶å†…éƒ¨çš„å„ç§å‡½æ•°è¡¨è¿›è¡Œä¼˜åŒ–ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå³dexæ–‡ä»¶ã€‚å› æ­¤åŠ è½½æŸç§ç‰¹æ®Šçš„Classæ–‡ä»¶å°±éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨DexClassLoaderã€‚</p><p>å¯ä»¥åŠ¨æ€åŠ è½½Jaré€šè¿‡URLClassLoader</p><p>1.ClassLoader éš”ç¦»é—®é¢˜ï¼šJVMè¯†åˆ«ä¸€ä¸ªç±»æ˜¯ç”± ClassLoaderid + PackageName + ClassNameã€‚</p><p>2.åŠ è½½ä¸åŒJaråŒ…ä¸­çš„å…¬å…±ç±»ï¼š</p><ul><li>è®©çˆ¶ClassLoaderåŠ è½½å…¬å…±çš„Jarï¼Œå­ClassLoadeåŠ è½½åŒ…å«å…¬å…±Jarçš„Jarï¼Œæ­¤æ—¶å­ClassLoaderåœ¨åŠ è½½Jarçš„æ—¶å€™ä¼šå…ˆå»çˆ¶ClassLoaderä¸­æ‰¾ã€‚(åªé€‚ç”¨Java)</li><li>é‡å†™åŠ è½½åŒ…å«å…¬å…±Jarçš„Jarçš„ClassLoaderï¼Œåœ¨loClassä¸­æ‰¾åˆ°å·²ç»åŠ è½½è¿‡å…¬å…±Jarçš„ClassLoaderï¼Œæ˜¯æŠŠçˆ¶ClassLoaderæ›¿æ¢æ‰ã€‚(åªé€‚ç”¨Java)</li><li>åœ¨ç”ŸæˆåŒ…å«å…¬å…±Jarçš„Jaræ—¶å€™æŠŠå…¬å…±Jarå»æ‰ã€‚</li></ul><h4 id="5ã€JVMè·ŸArtã€Dalvikå¯¹æ¯”ï¼Ÿ"><a href="#5ã€JVMè·ŸArtã€Dalvikå¯¹æ¯”ï¼Ÿ" class="headerlink" title="5ã€JVMè·ŸArtã€Dalvikå¯¹æ¯”ï¼Ÿ"></a>5ã€<a href="https://www.jianshu.com/p/58f817d176b7">JVMè·ŸArtã€Dalvikå¯¹æ¯”</a>ï¼Ÿ</h4><p>ã€€ã€€</p><h4 id="6ã€GCæ”¶é›†å™¨ç®€ä»‹ï¼Ÿä»¥åŠå®ƒçš„å†…å­˜åˆ’åˆ†æ€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#6ã€GCæ”¶é›†å™¨ç®€ä»‹ï¼Ÿä»¥åŠå®ƒçš„å†…å­˜åˆ’åˆ†æ€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="6ã€GCæ”¶é›†å™¨ç®€ä»‹ï¼Ÿä»¥åŠå®ƒçš„å†…å­˜åˆ’åˆ†æ€ä¹ˆæ ·çš„ï¼Ÿ"></a>6ã€GCæ”¶é›†å™¨ç®€ä»‹ï¼Ÿä»¥åŠå®ƒçš„å†…å­˜åˆ’åˆ†æ€ä¹ˆæ ·çš„ï¼Ÿ</h4><p>ï¼ˆ1ï¼‰ç®€ä»‹ï¼š</p><p>Garbage-Firstï¼ˆG1ï¼Œåƒåœ¾ä¼˜å…ˆï¼‰æ”¶é›†å™¨æ˜¯æœåŠ¡ç±»å‹çš„æ”¶é›†å™¨ï¼Œç›®æ ‡æ˜¯å¤šå¤„ç†å™¨æœºå™¨ã€å¤§å†…å­˜æœºå™¨ã€‚å®ƒé«˜åº¦ç¬¦åˆåƒåœ¾æ”¶é›†æš‚åœæ—¶é—´çš„ç›®æ ‡ï¼ŒåŒæ—¶å®ç°é«˜ååé‡ã€‚Oracle JDK 7 update 4 ä»¥åŠæ›´æ–°å‘å¸ƒç‰ˆå®Œå…¨æ”¯æŒG1åƒåœ¾æ”¶é›†å™¨</p><p>ï¼ˆ2ï¼‰G1çš„å†…å­˜åˆ’åˆ†æ–¹å¼ï¼š</p><p>å®ƒæ˜¯å°†å †å†…å­˜è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ heap åŒº,æ¯ä¸ªheapåŒºéƒ½æ˜¯é€»è¾‘ä¸Šè¿ç»­çš„ä¸€æ®µå†…å­˜(virtual memory). å…¶ä¸­ä¸€éƒ¨åˆ†åŒºåŸŸè¢«å½“æˆè€ä¸€ä»£æ”¶é›†å™¨ç›¸åŒçš„è§’è‰²(eden, survivor, old), ä½†æ¯ä¸ªè§’è‰²çš„åŒºåŸŸä¸ªæ•°éƒ½ä¸æ˜¯å›ºå®šçš„ã€‚è¿™åœ¨å†…å­˜ä½¿ç”¨ä¸Šæä¾›äº†æ›´å¤šçš„çµæ´»æ€§</p><h4 id="7ã€Javaçš„è™šæ‹ŸæœºJVMçš„ä¸¤ä¸ªå†…å­˜ï¼šæ ˆå†…å­˜å’Œå †å†…å­˜çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7ã€Javaçš„è™šæ‹ŸæœºJVMçš„ä¸¤ä¸ªå†…å­˜ï¼šæ ˆå†…å­˜å’Œå †å†…å­˜çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7ã€Javaçš„è™šæ‹ŸæœºJVMçš„ä¸¤ä¸ªå†…å­˜ï¼šæ ˆå†…å­˜å’Œå †å†…å­˜çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7ã€Javaçš„è™šæ‹ŸæœºJVMçš„ä¸¤ä¸ªå†…å­˜ï¼šæ ˆå†…å­˜å’Œå †å†…å­˜çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>JavaæŠŠå†…å­˜åˆ’åˆ†æˆä¸¤ç§ï¼šä¸€ç§æ˜¯æ ˆå†…å­˜ï¼Œä¸€ç§æ˜¯å †å†…å­˜ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼š</p><p>1ï¼‰æ ˆå†…å­˜ï¼šåœ¨å‡½æ•°ä¸­å®šä¹‰çš„ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡éƒ½åœ¨å‡½æ•°çš„æ ˆå†…å­˜ä¸­åˆ†é…ã€‚ å½“åœ¨ä¸€æ®µä»£ç å—å®šä¹‰ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJavaå°±åœ¨æ ˆä¸­ä¸ºè¿™ä¸ªå˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½“è¶…è¿‡å˜é‡çš„ä½œç”¨åŸŸåï¼ŒJavaä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ä¸ºè¯¥å˜é‡æ‰€åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œè¯¥å†…å­˜ç©ºé—´å¯ä»¥ç«‹å³è¢«å¦ä½œä»–ç”¨ã€‚</p><p>2ï¼‰å †å†…å­˜ï¼šå †å†…å­˜ç”¨æ¥å­˜æ”¾ç”±newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ã€‚åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ï¼Œç”±Javaè™šæ‹Ÿæœºçš„è‡ªåŠ¨åƒåœ¾å›æ”¶å™¨æ¥ç®¡ç†ã€‚</p><h4 id="8ã€JVMè°ƒä¼˜çš„å¸¸è§å‘½ä»¤è¡Œå·¥å…·æœ‰å“ªäº›ï¼ŸJVMå¸¸è§çš„è°ƒä¼˜å‚æ•°æœ‰å“ªäº›ï¼Ÿ"><a href="#8ã€JVMè°ƒä¼˜çš„å¸¸è§å‘½ä»¤è¡Œå·¥å…·æœ‰å“ªäº›ï¼ŸJVMå¸¸è§çš„è°ƒä¼˜å‚æ•°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="8ã€JVMè°ƒä¼˜çš„å¸¸è§å‘½ä»¤è¡Œå·¥å…·æœ‰å“ªäº›ï¼ŸJVMå¸¸è§çš„è°ƒä¼˜å‚æ•°æœ‰å“ªäº›ï¼Ÿ"></a>8ã€JVMè°ƒä¼˜çš„å¸¸è§å‘½ä»¤è¡Œå·¥å…·æœ‰å“ªäº›ï¼ŸJVMå¸¸è§çš„è°ƒä¼˜å‚æ•°æœ‰å“ªäº›ï¼Ÿ</h4><p>ï¼ˆ1ï¼‰JVMè°ƒä¼˜çš„å¸¸è§å‘½ä»¤å·¥å…·åŒ…æ‹¬ï¼š</p><p>1ï¼‰jpså‘½ä»¤ç”¨äºæŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„JVMè¿›ç¨‹ï¼Œ</p><p>2ï¼‰jstatå¯ä»¥å®æ—¶æ˜¾ç¤ºæœ¬åœ°æˆ–è¿œç¨‹JVMè¿›ç¨‹ä¸­ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰æ•°æ®</p><p>3ï¼‰jinfoç”¨äºæŸ¥è¯¢å½“å‰è¿è¡Œè¿™çš„JVMå±æ€§å’Œå‚æ•°çš„å€¼ã€‚</p><p>4ï¼‰jmapç”¨äºæ˜¾ç¤ºå½“å‰Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯</p><p>5ï¼‰jhatç”¨äºåˆ†æä½¿ç”¨jmapç”Ÿæˆçš„dumpæ–‡ä»¶ï¼Œæ˜¯JDKè‡ªå¸¦çš„å·¥å…·</p><p>6ï¼‰jstackç”¨äºç”Ÿæˆå½“å‰JVMçš„æ‰€æœ‰çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§æ˜¯è™šæ‹Ÿæœºæ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•,ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚</p><p>ï¼ˆ2ï¼‰JVMå¸¸è§çš„è°ƒä¼˜å‚æ•°åŒ…æ‹¬ï¼š</p><p>-Xmx</p><p>ã€€ã€€æŒ‡å®šjavaç¨‹åºçš„æœ€å¤§å †å†…å­˜, ä½¿ç”¨java -Xmx5000M -versionåˆ¤æ–­å½“å‰ç³»ç»Ÿèƒ½åˆ†é…çš„æœ€å¤§å †å†…å­˜</p><p>-Xms</p><p>ã€€ã€€æŒ‡å®šæœ€å°å †å†…å­˜, é€šå¸¸è®¾ç½®æˆè·Ÿæœ€å¤§å †å†…å­˜ä¸€æ ·ï¼Œå‡å°‘GC</p><p>-Xmn</p><p>ã€€ã€€è®¾ç½®å¹´è½»ä»£å¤§å°ã€‚æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å°ã€‚æ‰€ä»¥å¢å¤§å¹´è½»ä»£åï¼Œå°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8ã€‚</p><p>-Xss</p><p>ã€€ã€€æŒ‡å®šçº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´, æ­¤å‚æ•°å†³å®šäº†javaå‡½æ•°è°ƒç”¨çš„æ·±åº¦, å€¼è¶Šå¤§è°ƒç”¨æ·±åº¦è¶Šæ·±, è‹¥å€¼å¤ªå°åˆ™å®¹æ˜“å‡ºæ ˆæº¢å‡ºé”™è¯¯(StackOverflowError)</p><p>-XX:PermSize</p><p>ã€€ã€€æŒ‡å®šæ–¹æ³•åŒº(æ°¸ä¹…åŒº)çš„åˆå§‹å€¼,é»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œ åœ¨Java8æ°¸ä¹…åŒºç§»é™¤, ä»£ä¹‹çš„æ˜¯å…ƒæ•°æ®åŒºï¼Œ ç”±-XX:MetaspaceSizeæŒ‡å®š</p><p>-XX:MaxPermSize</p><p>ã€€ã€€æŒ‡å®šæ–¹æ³•åŒºçš„æœ€å¤§å€¼, é»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4ï¼Œ åœ¨java8ä¸­ç”±-XX:MaxMetaspaceSizeæŒ‡å®šå…ƒæ•°æ®åŒºçš„å¤§å°</p><p>-XX:NewRatio=n</p><p>ã€€ã€€å¹´è€ä»£ä¸å¹´è½»ä»£çš„æ¯”å€¼ï¼Œ-XX:NewRatio=2, è¡¨ç¤ºå¹´è€ä»£ä¸å¹´è½»ä»£çš„æ¯”å€¼ä¸º2:1</p><p>-XX:SurvivorRatio=n</p><p>ã€€ã€€EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ï¼Œ-XX:SurvivorRatio=8è¡¨ç¤ºEdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼æ˜¯8:1:1ï¼Œå› ä¸ºSurvivoråŒºæœ‰ä¸¤ä¸ª(from, to)</p><h4 id="9ã€jstack-jmap-jutilåˆ†åˆ«çš„æ„ä¹‰ï¼Ÿå¦‚ä½•çº¿ä¸Šæ’æŸ¥JVMçš„ç›¸å…³é—®é¢˜ï¼Ÿ"><a href="#9ã€jstack-jmap-jutilåˆ†åˆ«çš„æ„ä¹‰ï¼Ÿå¦‚ä½•çº¿ä¸Šæ’æŸ¥JVMçš„ç›¸å…³é—®é¢˜ï¼Ÿ" class="headerlink" title="9ã€jstack,jmap,jutilåˆ†åˆ«çš„æ„ä¹‰ï¼Ÿå¦‚ä½•çº¿ä¸Šæ’æŸ¥JVMçš„ç›¸å…³é—®é¢˜ï¼Ÿ"></a>9ã€jstack,jmap,jutilåˆ†åˆ«çš„æ„ä¹‰ï¼Ÿå¦‚ä½•çº¿ä¸Šæ’æŸ¥JVMçš„ç›¸å…³é—®é¢˜ï¼Ÿ</h4><h4 id="10ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹-æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±•-æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º-å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚"><a href="#10ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹-æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±•-æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º-å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚" class="headerlink" title="10ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹ æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±• æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚"></a>10ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹ æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±• æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚</h4><h4 id="11ã€å¦‚ä½•è§£å†³åŒæ—¶å­˜åœ¨çš„å¯¹è±¡åˆ›å»ºå’Œå¯¹è±¡å›æ”¶é—®é¢˜ï¼Ÿ"><a href="#11ã€å¦‚ä½•è§£å†³åŒæ—¶å­˜åœ¨çš„å¯¹è±¡åˆ›å»ºå’Œå¯¹è±¡å›æ”¶é—®é¢˜ï¼Ÿ" class="headerlink" title="11ã€å¦‚ä½•è§£å†³åŒæ—¶å­˜åœ¨çš„å¯¹è±¡åˆ›å»ºå’Œå¯¹è±¡å›æ”¶é—®é¢˜ï¼Ÿ"></a>11ã€å¦‚ä½•è§£å†³åŒæ—¶å­˜åœ¨çš„å¯¹è±¡åˆ›å»ºå’Œå¯¹è±¡å›æ”¶é—®é¢˜ï¼Ÿ</h4><h4 id="12ã€JVMä¸­æœ€å¤§å †å¤§å°æœ‰æ²¡æœ‰é™åˆ¶ï¼Ÿ"><a href="#12ã€JVMä¸­æœ€å¤§å †å¤§å°æœ‰æ²¡æœ‰é™åˆ¶ï¼Ÿ" class="headerlink" title="12ã€JVMä¸­æœ€å¤§å †å¤§å°æœ‰æ²¡æœ‰é™åˆ¶ï¼Ÿ"></a>12ã€JVMä¸­æœ€å¤§å †å¤§å°æœ‰æ²¡æœ‰é™åˆ¶ï¼Ÿ</h4><h4 id="13ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹-æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±•-æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º-å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚"><a href="#13ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹-æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±•-æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º-å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚" class="headerlink" title="13ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹ æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±• æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚"></a>13ã€JVMæ–¹æ³•åŒºå­˜å‚¨å†…å®¹ æ˜¯å¦ä¼šåŠ¨æ€æ‰©å±• æ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡º å‡ºç°çš„åŸå› æœ‰å“ªäº›ã€‚</h4><h4 id="14ã€å¦‚ä½•ç†è§£Javaçš„è™šå‡½æ•°è¡¨ï¼Ÿ"><a href="#14ã€å¦‚ä½•ç†è§£Javaçš„è™šå‡½æ•°è¡¨ï¼Ÿ" class="headerlink" title="14ã€å¦‚ä½•ç†è§£Javaçš„è™šå‡½æ•°è¡¨ï¼Ÿ"></a>14ã€å¦‚ä½•ç†è§£Javaçš„è™šå‡½æ•°è¡¨ï¼Ÿ</h4><h4 id="15ã€Javaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„åŸå› ã€‚"><a href="#15ã€Javaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„åŸå› ã€‚" class="headerlink" title="15ã€Javaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„åŸå› ã€‚"></a>15ã€Javaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„åŸå› ã€‚</h4><h4 id="16ã€å¯¹è±¡åˆ›å»ºã€å†…å­˜å¸ƒå±€ï¼Œè®¿é—®å®šä½ç­‰ã€‚"><a href="#16ã€å¯¹è±¡åˆ›å»ºã€å†…å­˜å¸ƒå±€ï¼Œè®¿é—®å®šä½ç­‰ã€‚" class="headerlink" title="16ã€å¯¹è±¡åˆ›å»ºã€å†…å­˜å¸ƒå±€ï¼Œè®¿é—®å®šä½ç­‰ã€‚"></a>16ã€å¯¹è±¡åˆ›å»ºã€å†…å­˜å¸ƒå±€ï¼Œè®¿é—®å®šä½ç­‰ã€‚</h4>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> èŒåœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿé¢è¯•é¢˜</title>
      <link href="/2019-12-08/job-interview-os/"/>
      <url>/2019-12-08/job-interview-os/</url>
      
        <content type="html"><![CDATA[<p>é›†åˆäº†ä¸€äº›æ“ä½œç³»ç»Ÿæ–¹é¢çš„é¢è¯•é¢˜ã€‚</p><span id="more"></span><h2 id="æ“ä½œç³»ç»Ÿé¢è¯•é¢˜-ï¼ˆâ­â­â­ï¼‰"><a href="#æ“ä½œç³»ç»Ÿé¢è¯•é¢˜-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ ï¼ˆâ­â­â­ï¼‰"></a>æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ ï¼ˆâ­â­â­ï¼‰</h2><h2 id="1ã€æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ"><a href="#1ã€æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ" class="headerlink" title="1ã€æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ"></a>1ã€<a href="https://blog.csdn.net/hguisu/article/details/5713164">æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ</a></h2><h2 id="2ã€è¿›ç¨‹è°ƒåº¦"><a href="#2ã€è¿›ç¨‹è°ƒåº¦" class="headerlink" title="2ã€è¿›ç¨‹è°ƒåº¦"></a>2ã€<a href="https://www.cnblogs.com/wawlian/archive/2012/02/17/2356398.html">è¿›ç¨‹è°ƒåº¦</a></h2><h2 id="3ã€è¯´ä¸‹Linuxè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#3ã€è¯´ä¸‹Linuxè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="3ã€è¯´ä¸‹Linuxè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>3ã€<a href="https://my.oschina.net/cnyinlinux/blog/422207">è¯´ä¸‹Linuxè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</a></h2><p>è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸»è¦å·®åˆ«åœ¨äºå®ƒä»¬æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿèµ„æºç®¡ç†æ–¹å¼ã€‚<strong>è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´</strong>ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œè€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„ã€‚<strong>çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡</strong>ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ï¼Œæ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®ï¼Œä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œè€—è´¹èµ„æºè¾ƒå¤§ï¼Œæ•ˆç‡è¦å·®ä¸€äº›ã€‚ä½†å¯¹äºä¸€äº›è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œï¼Œåªèƒ½ç”¨çº¿ç¨‹ï¼Œä¸èƒ½ç”¨è¿›ç¨‹ã€‚</p><ol><li><p>ç®€è€Œè¨€ä¹‹ï¼Œ<strong>ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹</strong>ã€‚</p></li><li><p>çº¿ç¨‹çš„åˆ’åˆ†å°ºåº¦å°äºè¿›ç¨‹ï¼Œä½¿å¾—å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘æ€§é«˜ã€‚</p></li><li><p>å¦å¤–ï¼Œè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒï¼Œè€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ï¼Œä»è€Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p></li><li><p>çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¿›ç¨‹è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚æ¯ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºçš„å‡ºå£ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ã€‚</p></li><li><p>ä»é€»è¾‘è§’åº¦æ¥çœ‹ï¼Œå¤šçº¿ç¨‹çš„æ„ä¹‰åœ¨äºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰å¤šä¸ªæ‰§è¡Œéƒ¨åˆ†å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚ä½†æ“ä½œç³»ç»Ÿå¹¶æ²¡æœ‰å°†å¤šä¸ªçº¿ç¨‹çœ‹åšå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œæ¥å®ç°è¿›ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ä»¥åŠèµ„æºåˆ†é…ï¼Œè¿™å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹çš„é‡è¦åŒºåˆ«ã€‚</p></li></ol><h2 id="4ã€ä½ èƒ½è§£é‡Šä¸€ä¸‹Linuxçš„è½¯é“¾æ¥å’Œç¡¬é“¾æ¥å—ï¼Ÿ"><a href="#4ã€ä½ èƒ½è§£é‡Šä¸€ä¸‹Linuxçš„è½¯é“¾æ¥å’Œç¡¬é“¾æ¥å—ï¼Ÿ" class="headerlink" title="4ã€ä½ èƒ½è§£é‡Šä¸€ä¸‹Linuxçš„è½¯é“¾æ¥å’Œç¡¬é“¾æ¥å—ï¼Ÿ"></a>4ã€ä½ èƒ½è§£é‡Šä¸€ä¸‹Linuxçš„è½¯é“¾æ¥å’Œç¡¬é“¾æ¥å—ï¼Ÿ</h2><p>Linuxé“¾æ¥åˆ†ä¸¤ç§ï¼Œä¸€ç§è¢«ç§°ä¸ºç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ï¼Œå¦ä¸€ç§è¢«ç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œlnå‘½ä»¤äº§ç”Ÿç¡¬é“¾æ¥ã€‚</p><h3 id="ç¡¬è¿æ¥"><a href="#ç¡¬è¿æ¥" class="headerlink" title="ç¡¬è¿æ¥"></a>ç¡¬è¿æ¥</h3><p>ç¡¬è¿æ¥æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œè¿æ¥ã€‚åœ¨Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å·(Inode Index)ã€‚åœ¨Linuxä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„ã€‚ä¸€èˆ¬è¿™ç§è¿æ¥å°±æ˜¯ç¡¬è¿æ¥ã€‚ç¡¬è¿æ¥çš„ä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬è¿æ¥åˆ°é‡è¦æ–‡ä»¶ï¼Œä»¥é˜²æ­¢â€œè¯¯åˆ â€çš„åŠŸèƒ½ã€‚å…¶åŸå› å¦‚ä¸Šæ‰€è¿°ï¼Œå› ä¸ºå¯¹åº”è¯¥ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¿æ¥ã€‚åªåˆ é™¤ä¸€ä¸ªè¿æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶å®ƒçš„è¿æ¥ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªè¿æ¥è¢«åˆ é™¤åï¼Œæ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„è¿æ¥æ‰ä¼šè¢«é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚</p><h3 id="è½¯è¿æ¥"><a href="#è½¯è¿æ¥" class="headerlink" title="è½¯è¿æ¥"></a>è½¯è¿æ¥</h3><p>å¦å¤–ä¸€ç§è¿æ¥ç§°ä¹‹ä¸ºç¬¦å·è¿æ¥ï¼ˆSymbolic Linkï¼‰ï¼Œä¹Ÿå«è½¯è¿æ¥ã€‚è½¯é“¾æ¥æ–‡ä»¶æœ‰ç±»ä¼¼äºWindowsçš„å¿«æ·æ–¹å¼ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ã€‚åœ¨ç¬¦å·è¿æ¥ä¸­ï¼Œæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«çš„æœ‰å¦ä¸€æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ã€‚</p><h2 id="5ã€å®‰å“æƒé™ç®¡ç†ï¼Œä¸ºä½•åœ¨æ¸…å•ä¸­æ³¨å†Œæƒé™ï¼Œå®‰å“APPå°±å¯ä»¥ä½¿ç”¨ï¼Œåä¹‹ä¸å¯ä»¥ï¼Ÿ"><a href="#5ã€å®‰å“æƒé™ç®¡ç†ï¼Œä¸ºä½•åœ¨æ¸…å•ä¸­æ³¨å†Œæƒé™ï¼Œå®‰å“APPå°±å¯ä»¥ä½¿ç”¨ï¼Œåä¹‹ä¸å¯ä»¥ï¼Ÿ" class="headerlink" title="5ã€å®‰å“æƒé™ç®¡ç†ï¼Œä¸ºä½•åœ¨æ¸…å•ä¸­æ³¨å†Œæƒé™ï¼Œå®‰å“APPå°±å¯ä»¥ä½¿ç”¨ï¼Œåä¹‹ä¸å¯ä»¥ï¼Ÿ"></a>5ã€å®‰å“æƒé™ç®¡ç†ï¼Œä¸ºä½•åœ¨æ¸…å•ä¸­æ³¨å†Œæƒé™ï¼Œå®‰å“APPå°±å¯ä»¥ä½¿ç”¨ï¼Œåä¹‹ä¸å¯ä»¥ï¼Ÿ</h2><p>æ­¤é¢˜è€ƒæŸ¥ Android çš„æƒé™ç®¡ç†åœ¨ Android çš„å®‰å…¨æ¶æ„ä¸­çš„ä½œç”¨ã€‚</p><p>Android æ˜¯ä¸€ä¸ªæƒé™åˆ†éš”çš„æ“ä½œç³»ç»Ÿï¼Œå…¶ä¸­æ¯ä¸ªåº”ç”¨éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç³»ç»Ÿæ ‡è¯†ï¼ˆLinux ç”¨æˆ· ID å’Œç»„ IDï¼‰ã€‚ç³»ç»Ÿå„éƒ¨åˆ†ä¹Ÿåˆ†éš”ä¸ºä¸åŒçš„æ ‡è¯†ã€‚Linux æ®æ­¤å°†ä¸åŒçš„åº”ç”¨ä»¥åŠåº”ç”¨ä¸ç³»ç»Ÿåˆ†éš”å¼€æ¥ã€‚</p><p>å…¶ä»–æ›´è¯¦ç»†çš„å®‰å…¨åŠŸèƒ½é€šè¿‡ã€æƒé™ã€æœºåˆ¶æä¾›ï¼Œæ­¤æœºåˆ¶ä¼šé™åˆ¶ç‰¹å®šè¿›ç¨‹å¯ä»¥æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼Œå¹¶ä¸”æ ¹æ® URI æƒé™æˆæƒä¸´æ—¶è®¿é—®ç‰¹å®šçš„æ•°æ®æ®µã€‚</p><p>Android å®‰å…¨æ¶æ„çš„ä¸­å¿ƒè®¾è®¡ç‚¹æ˜¯ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ä»»ä½•åº”ç”¨éƒ½æ²¡æœ‰æƒé™æ‰§è¡Œå¯¹å…¶ä»–åº”ç”¨ã€æ“ä½œç³»ç»Ÿæˆ–ç”¨æˆ·æœ‰ä¸åˆ©å½±å“çš„ä»»ä½•æ“ä½œã€‚è¿™åŒ…æ‹¬è¯»å–æˆ–å†™å…¥ç”¨æˆ·çš„ç§æœ‰æ•°æ®ï¼ˆä¾‹å¦‚è”ç³»äººæˆ–ç”µå­é‚®ä»¶ï¼‰ã€è¯»å–æˆ–å†™å…¥å…¶ä»–åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ã€æ‰§è¡Œç½‘ç»œè®¿é—®ã€ä½¿è®¾å¤‡ä¿æŒå”¤é†’çŠ¶æ€ç­‰ã€‚</p><p>ç”±äºæ¯ä¸ª Android åº”ç”¨éƒ½æ˜¯åœ¨è¿›ç¨‹æ²™ç›’ä¸­è¿è¡Œï¼Œå› æ­¤åº”ç”¨å¿…é¡»æ˜¾å¼å…±äº«èµ„æºå’Œæ•°æ®ã€‚å®ƒä»¬çš„æ–¹æ³•æ˜¯å£°æ˜éœ€è¦å“ªäº›æƒé™æ¥è·å–åŸºæœ¬æ²™ç›’æœªæä¾›çš„é¢å¤–åŠŸèƒ½ã€‚åº”ç”¨ä»¥é™æ€æ–¹å¼å£°æ˜å®ƒä»¬éœ€è¦çš„æƒé™ï¼Œç„¶å Android ç³»ç»Ÿæç¤ºç”¨æˆ·åŒæ„ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“é¢è¯•é¢˜</title>
      <link href="/2019-12-07/job-interview-db/"/>
      <url>/2019-12-07/job-interview-db/</url>
      
        <content type="html"><![CDATA[<p>é›†åˆäº†ä¸€äº›æ•°æ®åº“ç³»ç»Ÿæ–¹é¢çš„é¢è¯•é¢˜ã€‚</p><span id="more"></span><h2 id="æ•°æ®åº“é¢è¯•é¢˜-ï¼ˆâ­ï¼‰"><a href="#æ•°æ®åº“é¢è¯•é¢˜-ï¼ˆâ­ï¼‰" class="headerlink" title="æ•°æ®åº“é¢è¯•é¢˜ ï¼ˆâ­ï¼‰"></a>æ•°æ®åº“é¢è¯•é¢˜ ï¼ˆâ­ï¼‰</h2><h3 id="1ã€äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Ÿ"><a href="#1ã€äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Ÿ" class="headerlink" title="1ã€äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Ÿ"></a>1ã€äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Ÿ</h3><p>äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ã€‚æ‰€è°“çš„äº‹åŠ¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ä¾‹å¦‚ï¼Œé“¶è¡Œè½¬è´¦å·¥ä½œï¼šä»ä¸€ä¸ªè´¦å·æ‰£æ¬¾å¹¶ä½¿å¦ä¸€ä¸ªè´¦å·å¢æ¬¾ï¼Œè¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œåº”è¯¥æŠŠå®ƒä»¬çœ‹æˆä¸€ä¸ªäº‹åŠ¡ã€‚äº‹åŠ¡æ˜¯æ•°æ®åº“ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§çš„å•ä½ï¼Œåœ¨æ¯ä¸ªäº‹åŠ¡ç»“æŸæ—¶ï¼Œéƒ½èƒ½ä¿æŒæ•°æ®ä¸€è‡´æ€§ã€‚äº‹åŠ¡å…·æœ‰ä»¥ä¸‹4ä¸ªåŸºæœ¬ç‰¹å¾ï¼š</p><h4 id="äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼š"><a href="#äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼š" class="headerlink" title="äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼š"></a>äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼š</h4><ol><li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰ã€‚</strong> åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡åŒ…å«çš„æ‰€æœ‰æ“ä½œ<strong>è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»š</strong>ã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€‚</strong> ä¸€ä¸ªäº‹åŠ¡<strong>æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åéƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€</strong>ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€‚</strong> éš”ç¦»æ€§æ˜¯å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ¯”å¦‚æ“ä½œåŒä¸€å¼ è¡¨æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å¼€å¯çš„äº‹åŠ¡ï¼Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡çš„æ“ä½œæ‰€å¹²æ‰°ï¼Œ<strong>å¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»</strong>ã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚</strong> æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤äº†ï¼Œé‚£ä¹ˆ<strong>å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§</strong>çš„ã€‚</li></ol><h4 id="æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼š"><a href="#æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼š" class="headerlink" title="æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼š"></a>æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼š</h4><ol><li>Serializable(ä¸²è¡ŒåŒ–)ï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»çš„å‘ç”Ÿã€‚</li><li>Repeatable read (å¯é‡å¤è¯»)ï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»çš„å‘ç”Ÿã€‚</li><li>Read committed (è¯»å·²æäº¤)ï¼šå¯é¿å…è„è¯»çš„å‘ç”Ÿã€‚</li><li>Read uncommitted (è¯»æœªæäº¤)ï¼šæœ€ä½çº§åˆ«ï¼Œä»»ä½•æƒ…å†µéƒ½æ— æ³•ä¿è¯ã€‚</li></ol><h3 id="2ã€æ•°æ®åº“è®¾è®¡ä¸­å¸¸è®²çš„ä¸‰èŒƒå¼æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ"><a href="#2ã€æ•°æ®åº“è®¾è®¡ä¸­å¸¸è®²çš„ä¸‰èŒƒå¼æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€æ•°æ®åº“è®¾è®¡ä¸­å¸¸è®²çš„ä¸‰èŒƒå¼æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ"></a>2ã€æ•°æ®åº“è®¾è®¡ä¸­å¸¸è®²çš„ä¸‰èŒƒå¼æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ</h3><ol><li>ç¬¬ä¸€èŒƒå¼1NFï¼ˆåŸŸçš„åŸå­æ€§)ã€‚å¦‚æœæ•°æ®åº“è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µå€¼éƒ½æ˜¯ä¸å¯åˆ†è§£çš„åŸå­å€¼ï¼Œå°±è¯´æ˜è¯¥æ•°æ®åº“è¡¨æ»¡è¶³äº†ç¬¬ä¸€èŒƒå¼ã€‚</li><li>ç¬¬äºŒèŒƒå¼2NF(è¡¨ä¸­é™¤ä¸»é”®å¤–çš„å­—æ®µéƒ½å®Œå…¨ä¾èµ–ä¸»é”®)ã€‚ç¬¬äºŒèŒƒå¼æ˜¯åœ¨ç¬¬ä¸€èŒƒå¼åŸºç¡€ä¸Šå»ºç«‹çš„ã€‚ç¬¬äºŒèŒƒå¼æœ‰ä¸¤ä¸ªé‡ç‚¹:(1)è¡¨ä¸­å¿…é¡»æœ‰ä¸»é”®ï¼›(2)å…¶ä»–éä¸»å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½åªä¾èµ–ä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼ˆä¸»è¦é’ˆå¯¹è”åˆä¸»é”®è€Œè¨€ï¼‰ã€‚</li><li>ç¬¬ä¸‰èŒƒå¼3NFï¼ˆè¡¨ä¸­é™¤ä¸»é”®å¤–çš„å­—æ®µéƒ½å®Œå…¨ç›´æ¥ä¾èµ–ï¼Œä¸èƒ½æ˜¯ä¼ é€’ä¾èµ–ï¼‰ã€‚</li></ol><p>ä¸èƒ½æ˜¯ä¼ é€’ä¾èµ–ï¼Œå³ä¸èƒ½å­˜åœ¨ï¼šéä¸»é”®åˆ— A ä¾èµ–äºéä¸»é”®åˆ— Bï¼Œéä¸»é”®åˆ— B ä¾èµ–äºä¸»é”®çš„æƒ…å†µã€‚ç¬¬äºŒèŒƒå¼å’Œç¬¬ä¸‰èŒƒå¼åŒºåˆ†çš„å…³é”®ç‚¹ï¼š2NFï¼šéä¸»é”®åˆ—æ˜¯å¦å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè¿˜æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼›3NFï¼šéä¸»é”®åˆ—æ˜¯ç›´æ¥ä¾èµ–äºä¸»é”®ï¼Œè¿˜æ˜¯ç›´æ¥ä¾èµ–äºéä¸»é”®åˆ—ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Java å¹¶å‘é¢è¯•é¢˜</title>
      <link href="/2019-12-05/java-threading-interview/"/>
      <url>/2019-12-05/java-threading-interview/</url>
      
        <content type="html"><![CDATA[<h2 id="Javaå¹¶å‘é¢è¯•é¢˜"><a href="#Javaå¹¶å‘é¢è¯•é¢˜" class="headerlink" title="Javaå¹¶å‘é¢è¯•é¢˜"></a>Javaå¹¶å‘é¢è¯•é¢˜</h2><span id="more"></span><h3 id="ä¸€ã€çº¿ç¨‹æ± ç›¸å…³-ï¼ˆâ­â­â­ï¼‰"><a href="#ä¸€ã€çº¿ç¨‹æ± ç›¸å…³-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="ä¸€ã€çº¿ç¨‹æ± ç›¸å…³ ï¼ˆâ­â­â­ï¼‰"></a>ä¸€ã€çº¿ç¨‹æ± ç›¸å…³ ï¼ˆâ­â­â­ï¼‰</h3><h4 id="1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</h4><p>ç­”ï¼šçº¿ç¨‹æ± å°±æ˜¯äº‹å…ˆå°†å¤šä¸ªçº¿ç¨‹å¯¹è±¡æ”¾åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œä½¿ç”¨çš„æ—¶å€™å°±ä¸ç”¨newçº¿ç¨‹è€Œæ˜¯ç›´æ¥å»æ± ä¸­æ‹¿çº¿ç¨‹å³å¯ï¼ŒèŠ‚<br>çœäº†å¼€è¾Ÿå­çº¿ç¨‹çš„æ—¶é—´ï¼Œæé«˜äº†ä»£ç æ‰§è¡Œæ•ˆç‡ã€‚</p><h4 id="2ã€Javaä¸­çš„çº¿ç¨‹æ± å…±æœ‰å‡ ç§ï¼Ÿ"><a href="#2ã€Javaä¸­çš„çº¿ç¨‹æ± å…±æœ‰å‡ ç§ï¼Ÿ" class="headerlink" title="2ã€Javaä¸­çš„çº¿ç¨‹æ± å…±æœ‰å‡ ç§ï¼Ÿ"></a>2ã€Javaä¸­çš„çº¿ç¨‹æ± å…±æœ‰å‡ ç§ï¼Ÿ</h4><p>Javaæœ‰å››ç§çº¿ç¨‹æ± ï¼š</p><p>ç¬¬ä¸€ç§ï¼šnewCachedThreadPool</p><p>ä¸å›ºå®šçº¿ç¨‹æ•°é‡ï¼Œä¸”æ”¯æŒæœ€å¤§ä¸ºInteger.MAX_VALUEçš„çº¿ç¨‹æ•°é‡:</p><pre><code>public static ExecutorService newCachedThreadPool() &#123;    // è¿™ä¸ªçº¿ç¨‹æ± corePoolSizeä¸º0ï¼ŒmaximumPoolSizeä¸ºInteger.MAX_VALUE    // æ„æ€ä¹Ÿå°±æ˜¯è¯´æ¥ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªwokerï¼Œå›æ”¶æ—¶é—´æ˜¯60s    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,                                60L, TimeUnit.SECONDS,                                new SynchronousQueue&lt;Runnable&gt;());&#125;</code></pre><p>å¯ç¼“å­˜çº¿ç¨‹æ± ï¼š</p><p>1ã€çº¿ç¨‹æ•°æ— é™åˆ¶ã€‚<br>2ã€æœ‰ç©ºé—²çº¿ç¨‹åˆ™å¤ç”¨ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— ç©ºé—²çº¿ç¨‹åˆ™æ–°å»ºçº¿ç¨‹ã€‚<br>3ã€ä¸€å®šç¨‹åºå‡å°‘é¢‘ç¹åˆ›å»º/é”€æ¯çº¿ç¨‹ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚</p><p>ç¬¬äºŒç§ï¼šnewFixedThreadPool</p><p>ä¸€ä¸ªå›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± :</p><pre><code>public static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory) &#123;    // corePoolSizeè·ŸmaximumPoolSizeå€¼ä¸€æ ·ï¼ŒåŒæ—¶ä¼ å…¥ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—    // è¯¥çº¿ç¨‹æ± çš„çº¿ç¨‹ä¼šç»´æŒåœ¨æŒ‡å®šçº¿ç¨‹æ•°ï¼Œä¸ä¼šè¿›è¡Œå›æ”¶    return new ThreadPoolExecutor(nThreads, nThreads,                                0L, TimeUnit.MILLISECONDS,                                new LinkedBlockingQueue&lt;Runnable&gt;(),                                threadFactory);&#125;</code></pre><p>å®šé•¿çº¿ç¨‹æ± ï¼š</p><p>1ã€å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼ˆåŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼‰ã€‚<br>2ã€è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</p><p>ç¬¬ä¸‰ç§ï¼šnewSingleThreadExecutor</p><p>å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æ•°é‡ä¸º1çš„FixedThreadPool:</p><pre><code>public static ExecutorService newSingleThreadExecutor() &#123;    // çº¿ç¨‹æ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œä»»åŠ¡æ‰§è¡Œï¼Œå…¶ä»–çš„éƒ½æ”¾å…¥é˜»å¡é˜Ÿåˆ—    // å¤–é¢åŒ…è£…çš„FinalizableDelegatedExecutorServiceç±»å®ç°äº†finalizeæ–¹æ³•ï¼Œåœ¨JVMåƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šå…³é—­çº¿ç¨‹æ±     return new FinalizableDelegatedExecutorService        (new ThreadPoolExecutor(1, 1,                                0L, TimeUnit.MILLISECONDS,                                new LinkedBlockingQueue&lt;Runnable&gt;()));&#125;</code></pre><p>å•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼š</p><p>1ã€æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚<br>2ã€æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œï¼Œå³éµå¾ªé˜Ÿåˆ—çš„å…¥é˜Ÿå‡ºé˜Ÿè§„åˆ™ã€‚</p><p>ç¬¬å››ç§ï¼šnewScheduledThreadPoolã€‚</p><p>æ”¯æŒå®šæ—¶ä»¥æŒ‡å®šå‘¨æœŸå¾ªç¯æ‰§è¡Œä»»åŠ¡:</p><pre><code>public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123;    return new ScheduledThreadPoolExecutor(corePoolSize);&#125;</code></pre><p>æ³¨æ„ï¼šå‰ä¸‰ç§çº¿ç¨‹æ± æ˜¯ThreadPoolExecutorä¸åŒé…ç½®çš„å®ä¾‹ï¼Œæœ€åä¸€ç§æ˜¯ScheduledThreadPoolExecutorçš„å®ä¾‹ã€‚</p><h4 id="3ã€çº¿ç¨‹æ± åŸç†ï¼Ÿ"><a href="#3ã€çº¿ç¨‹æ± åŸç†ï¼Ÿ" class="headerlink" title="3ã€çº¿ç¨‹æ± åŸç†ï¼Ÿ"></a>3ã€<a href="https://itimetraveler.github.io/2018/02/13/%E3%80%90Java%E3%80%91%E7%BA%BF%E7%A8%8B%E6%B1%A0ThreadPoolExecutor%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">çº¿ç¨‹æ± åŸç†ï¼Ÿ</a></h4><p>ä»æ•°æ®ç»“æ„çš„è§’åº¦æ¥çœ‹ï¼Œçº¿ç¨‹æ± ä¸»è¦ä½¿ç”¨äº†é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰å’ŒHashSeté›†åˆæ„æˆã€‚<br>ä»ä»»åŠ¡æäº¤çš„æµç¨‹è§’åº¦æ¥çœ‹ï¼Œå¯¹äºä½¿ç”¨çº¿ç¨‹æ± çš„å¤–éƒ¨æ¥è¯´ï¼Œçº¿ç¨‹æ± çš„æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>1ã€å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•° &lt; coreSizeï¼Œé©¬ä¸Šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œè¯¥taskï¼Œä¸æ’é˜Ÿç­‰å¾…ï¼›2ã€å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•° &gt;= coreSizeï¼ŒæŠŠè¯¥taskæ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼›3ã€å¦‚æœé˜Ÿåˆ—å·²æ»¡ &amp;&amp; æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•° &lt; maximumPoolSizeï¼Œåˆ›å»ºæ–°çš„éæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œè¯¥taskï¼›4ã€å¦‚æœé˜Ÿåˆ—å·²æ»¡ &amp;&amp; æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•° &gt;= maximumPoolSizeï¼Œçº¿ç¨‹æ± è°ƒç”¨handlerçš„rejectæ–¹æ³•æ‹’ç»æœ¬æ¬¡æäº¤ã€‚</code></pre><p>ç†è§£è®°å¿†ï¼š1-2-3-4å¯¹åº”ï¼ˆæ ¸å¿ƒçº¿ç¨‹-&gt;é˜»å¡é˜Ÿåˆ—-&gt;éæ ¸å¿ƒçº¿ç¨‹-&gt;handleræ‹’ç»æäº¤ï¼‰ã€‚</p><h5 id="çº¿ç¨‹æ± çš„çº¿ç¨‹å¤ç”¨ï¼š"><a href="#çº¿ç¨‹æ± çš„çº¿ç¨‹å¤ç”¨ï¼š" class="headerlink" title="çº¿ç¨‹æ± çš„çº¿ç¨‹å¤ç”¨ï¼š"></a>çº¿ç¨‹æ± çš„çº¿ç¨‹å¤ç”¨ï¼š</h5><p>è¿™é‡Œå°±éœ€è¦æ·±å…¥åˆ°æºç addWorker()ï¼šå®ƒæ˜¯åˆ›å»ºæ–°çº¿ç¨‹çš„å…³é”®ï¼Œä¹Ÿæ˜¯çº¿ç¨‹å¤ç”¨çš„å…³é”®å…¥å£ã€‚æœ€ç»ˆä¼šæ‰§è¡Œåˆ°runWokerï¼Œå®ƒå–ä»»åŠ¡æœ‰ä¸¤ä¸ªæ–¹å¼ï¼š </p><ul><li>firstTaskï¼šè¿™æ˜¯æŒ‡å®šçš„ç¬¬ä¸€ä¸ªrunnableå¯æ‰§è¡Œä»»åŠ¡ï¼Œå®ƒä¼šåœ¨Wokerè¿™ä¸ªå·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œæ‰§è¡Œä»»åŠ¡runã€‚å¹¶ä¸”ç½®ç©ºè¡¨ç¤ºè¿™ä¸ªä»»åŠ¡å·²ç»è¢«æ‰§è¡Œã€‚ </li><li>getTask()ï¼šè¿™é¦–å…ˆæ˜¯ä¸€ä¸ªæ­»å¾ªç¯è¿‡ç¨‹ï¼Œå·¥ä½œçº¿ç¨‹å¾ªç¯ç›´åˆ°èƒ½å¤Ÿå–å‡ºRunnableå¯¹è±¡æˆ–è¶…æ—¶è¿”å›ï¼Œè¿™é‡Œçš„å–çš„ç›®æ ‡å°±æ˜¯ä»»åŠ¡é˜Ÿåˆ—workQueueï¼Œå¯¹åº”åˆšæ‰å…¥é˜Ÿçš„æ“ä½œï¼Œæœ‰å…¥æœ‰å‡ºã€‚</li></ul><p>å…¶å®å°±æ˜¯ä»»åŠ¡åœ¨å¹¶ä¸åªæ‰§è¡Œåˆ›å»ºæ—¶æŒ‡å®šçš„firstTaskç¬¬ä¸€ä»»åŠ¡ï¼Œè¿˜ä¼šä»ä»»åŠ¡é˜Ÿåˆ—çš„ä¸­é€šè¿‡getTask()æ–¹æ³•è‡ªå·±ä¸»åŠ¨å»å–ä»»åŠ¡æ‰§è¡Œï¼Œè€Œä¸”æ˜¯æœ‰/æ— æ—¶é—´é™å®šçš„é˜»å¡ç­‰å¾…ï¼Œä¿è¯çº¿ç¨‹çš„å­˜æ´»ã€‚</p><h5 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h5><p>semaphore å¯ç”¨äºè¿›ç¨‹é—´åŒæ­¥ä¹Ÿå¯ç”¨äºåŒä¸€ä¸ªè¿›ç¨‹é—´çš„çº¿ç¨‹åŒæ­¥ã€‚</p><p>å¯ä»¥ç”¨æ¥ä¿è¯ä¸¤ä¸ªæˆ–å¤šä¸ªå…³é”®ä»£ç æ®µä¸è¢«å¹¶å‘è°ƒç”¨ã€‚åœ¨è¿›å…¥ä¸€ä¸ªå…³é”®ä»£ç æ®µä¹‹å‰ï¼Œçº¿ç¨‹å¿…é¡»è·å–ä¸€ä¸ªä¿¡å·é‡ï¼›ä¸€æ—¦è¯¥å…³é”®ä»£ç æ®µå®Œæˆäº†ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å¿…é¡»é‡Šæ”¾ä¿¡å·é‡ã€‚å…¶å®ƒæƒ³è¿›å…¥è¯¥å…³é”®ä»£ç æ®µçš„çº¿ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ã€‚</p><h4 id="4ã€çº¿ç¨‹æ± éƒ½æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ"><a href="#4ã€çº¿ç¨‹æ± éƒ½æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="4ã€çº¿ç¨‹æ± éƒ½æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ"></a>4ã€çº¿ç¨‹æ± éƒ½æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ</h4><p>1ã€ArrayBlockingQueue</p><p>æ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p><p>2ã€LinkedBlockingQueue</p><p>ä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueã€‚é™æ€å·¥å‚æ–¹æ³•Executors.newFixedThreadPool()å’ŒExecutors.newSingleThreadExecutorä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</p><p>3ã€SynchronousQueue</p><p>ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼Œé™æ€å·¥å‚æ–¹æ³•Executors.newCachedThreadPoolä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</p><p>4ã€PriorityBlockingQueue</p><p>ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ã€‚</p><h4 id="5ã€æ€ä¹ˆç†è§£æ— ç•Œé˜Ÿåˆ—å’Œæœ‰ç•Œé˜Ÿåˆ—ï¼Ÿ"><a href="#5ã€æ€ä¹ˆç†è§£æ— ç•Œé˜Ÿåˆ—å’Œæœ‰ç•Œé˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="5ã€æ€ä¹ˆç†è§£æ— ç•Œé˜Ÿåˆ—å’Œæœ‰ç•Œé˜Ÿåˆ—ï¼Ÿ"></a>5ã€æ€ä¹ˆç†è§£æ— ç•Œé˜Ÿåˆ—å’Œæœ‰ç•Œé˜Ÿåˆ—ï¼Ÿ</h4><h5 id="æœ‰ç•Œé˜Ÿåˆ—"><a href="#æœ‰ç•Œé˜Ÿåˆ—" class="headerlink" title="æœ‰ç•Œé˜Ÿåˆ—"></a>æœ‰ç•Œé˜Ÿåˆ—</h5><p>1.åˆå§‹çš„poolSize &lt; corePoolSizeï¼Œæäº¤çš„runnableä»»åŠ¡ï¼Œä¼šç›´æ¥åšä¸ºnewä¸€ä¸ªThreadçš„å‚æ•°ï¼Œç«‹é©¬æ‰§è¡Œ ã€‚<br>2.å½“æäº¤çš„ä»»åŠ¡æ•°è¶…è¿‡äº†corePoolSizeï¼Œä¼šå°†å½“å‰çš„runableæäº¤åˆ°ä¸€ä¸ªblock queueä¸­ã€‚<br>3.æœ‰ç•Œé˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œå¦‚æœpoolSize &lt; maximumPoolsizeæ—¶ï¼Œä¼šå°è¯•new ä¸€ä¸ªThreadçš„è¿›è¡Œæ•‘æ€¥å¤„ç†ï¼Œç«‹é©¬æ‰§è¡Œå¯¹åº”çš„runnableä»»åŠ¡ã€‚<br>4.å¦‚æœ3ä¸­ä¹Ÿæ— æ³•å¤„ç†äº†ï¼Œå°±ä¼šèµ°åˆ°ç¬¬å››æ­¥æ‰§è¡Œrejectæ“ä½œã€‚</p><h5 id="æ— ç•Œé˜Ÿåˆ—"><a href="#æ— ç•Œé˜Ÿåˆ—" class="headerlink" title="æ— ç•Œé˜Ÿåˆ—"></a>æ— ç•Œé˜Ÿåˆ—</h5><p>ä¸æœ‰ç•Œé˜Ÿåˆ—ç›¸æ¯”ï¼Œé™¤éç³»ç»Ÿèµ„æºè€—å°½ï¼Œå¦åˆ™æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—ä¸å­˜åœ¨ä»»åŠ¡å…¥é˜Ÿå¤±è´¥çš„æƒ…å†µã€‚å½“æœ‰æ–°çš„ä»»åŠ¡åˆ°æ¥ï¼Œç³»ç»Ÿçš„çº¿ç¨‹æ•°å°äºcorePoolSizeæ—¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚å½“è¾¾åˆ°corePoolSizeåï¼Œå°±ä¸ä¼šç»§ç»­å¢åŠ ï¼Œè‹¥åç»­ä»æœ‰æ–°çš„ä»»åŠ¡åŠ å…¥ï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹èµ„æºï¼Œåˆ™ä»»åŠ¡ç›´æ¥è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚è‹¥ä»»åŠ¡åˆ›å»ºå’Œå¤„ç†çš„é€Ÿåº¦å·®å¼‚å¾ˆå¤§ï¼Œæ— ç•Œé˜Ÿåˆ—ä¼šä¿æŒå¿«é€Ÿå¢é•¿ï¼Œç›´åˆ°è€—å°½ç³»ç»Ÿå†…å­˜ã€‚<br>å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡å¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeï¼Œå¦‚æœè¿˜æœ‰ä»»åŠ¡åˆ°æ¥å°±ä¼šé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ã€‚</p><h4 id="6ã€å¤šçº¿ç¨‹ä¸­çš„å®‰å…¨é˜Ÿåˆ—ä¸€èˆ¬é€šè¿‡ä»€ä¹ˆå®ç°ï¼Ÿ"><a href="#6ã€å¤šçº¿ç¨‹ä¸­çš„å®‰å…¨é˜Ÿåˆ—ä¸€èˆ¬é€šè¿‡ä»€ä¹ˆå®ç°ï¼Ÿ" class="headerlink" title="6ã€å¤šçº¿ç¨‹ä¸­çš„å®‰å…¨é˜Ÿåˆ—ä¸€èˆ¬é€šè¿‡ä»€ä¹ˆå®ç°ï¼Ÿ"></a>6ã€<a href="https://blog.csdn.net/bieleyang/article/details/78027032">å¤šçº¿ç¨‹ä¸­çš„å®‰å…¨é˜Ÿåˆ—ä¸€èˆ¬é€šè¿‡ä»€ä¹ˆå®ç°ï¼Ÿ</a></h4><p>Javaæä¾›çš„çº¿ç¨‹å®‰å…¨çš„Queueå¯ä»¥åˆ†ä¸ºé˜»å¡é˜Ÿåˆ—å’Œéé˜»å¡é˜Ÿåˆ—ï¼Œå…¶ä¸­é˜»å¡é˜Ÿåˆ—çš„å…¸å‹ä¾‹å­æ˜¯BlockingQueueï¼Œéé˜»å¡é˜Ÿåˆ—çš„å…¸å‹ä¾‹å­æ˜¯ConcurrentLinkedQueue.</p><p>å¯¹äºBlockingQueueï¼Œæƒ³è¦å®ç°é˜»å¡åŠŸèƒ½ï¼Œéœ€è¦è°ƒç”¨put(e) take() æ–¹æ³•ã€‚è€ŒConcurrentLinkedQueueæ˜¯åŸºäºé“¾æ¥èŠ‚ç‚¹çš„ã€æ— ç•Œçš„ã€çº¿ç¨‹å®‰å…¨çš„éé˜»å¡é˜Ÿåˆ—ã€‚</p><h3 id="äºŒã€Synchronizedã€volatileã€Lock-ReentrantLock-ç›¸å…³-ï¼ˆâ­â­â­ï¼‰"><a href="#äºŒã€Synchronizedã€volatileã€Lock-ReentrantLock-ç›¸å…³-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="äºŒã€Synchronizedã€volatileã€Lock(ReentrantLock)ç›¸å…³ ï¼ˆâ­â­â­ï¼‰"></a>äºŒã€Synchronizedã€volatileã€Lock(ReentrantLock)ç›¸å…³ ï¼ˆâ­â­â­ï¼‰</h3><h4 id="1ã€synchronizedçš„åŸç†ï¼Ÿ"><a href="#1ã€synchronizedçš„åŸç†ï¼Ÿ" class="headerlink" title="1ã€synchronizedçš„åŸç†ï¼Ÿ"></a>1ã€synchronizedçš„åŸç†ï¼Ÿ</h4><p>synchronized ä»£ç å—æ˜¯ç”±ä¸€å¯¹å„¿ monitorenter/monitorexit æŒ‡ä»¤å®ç°çš„ï¼ŒMonitor å¯¹è±¡æ˜¯åŒæ­¥çš„åŸºæœ¬å®ç°ï¼Œè€Œ synchronized åŒæ­¥æ–¹æ³•ä½¿ç”¨äº†ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚</p><p>åœ¨ Java 6 ä¹‹å‰ï¼ŒMonitor çš„å®ç°å®Œå…¨æ˜¯ä¾é æ“ä½œç³»ç»Ÿå†…éƒ¨çš„äº’æ–¥é”ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ‰€ä»¥åŒæ­¥æ“ä½œæ˜¯ä¸€ä¸ªæ— å·®åˆ«çš„é‡é‡çº§æ“ä½œã€‚</p><p>ç°ä»£çš„ï¼ˆOracleï¼‰JDK ä¸­ï¼ŒJVM å¯¹æ­¤è¿›è¡Œäº†å¤§åˆ€é˜”æ–§åœ°æ”¹è¿›ï¼Œæä¾›äº†ä¸‰ç§ä¸åŒçš„ Monitor å®ç°ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ä¸‰ç§ä¸åŒçš„é”ï¼šåæ–œé”ï¼ˆBiased Lockingï¼‰ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ï¼Œå¤§å¤§æ”¹è¿›äº†å…¶æ€§èƒ½ã€‚</p><p>æ‰€è°“é”çš„å‡çº§ã€é™çº§ï¼Œå°±æ˜¯ JVM ä¼˜åŒ– synchronized è¿è¡Œçš„æœºåˆ¶ï¼Œå½“ JVM æ£€æµ‹åˆ°ä¸åŒçš„ç«äº‰çŠ¶å†µæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°é€‚åˆçš„é”å®ç°ï¼Œè¿™ç§åˆ‡æ¢å°±æ˜¯é”çš„å‡çº§ã€é™çº§ã€‚</p><p>å½“æ²¡æœ‰ç«äº‰å‡ºç°æ—¶ï¼Œé»˜è®¤ä¼šä½¿ç”¨åæ–œé”ã€‚JVM ä¼šåˆ©ç”¨ CAS æ“ä½œï¼Œåœ¨å¯¹è±¡å¤´ä¸Šçš„ Mark Word éƒ¨åˆ†è®¾ç½®çº¿ç¨‹ IDï¼Œä»¥è¡¨ç¤ºè¿™ä¸ªå¯¹è±¡åå‘äºå½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥å¹¶ä¸æ¶‰åŠçœŸæ­£çš„äº’æ–¥é”ã€‚è¿™æ ·åšçš„å‡è®¾æ˜¯åŸºäºåœ¨å¾ˆå¤šåº”ç”¨åœºæ™¯ä¸­ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸­æœ€å¤šä¼šè¢«ä¸€ä¸ªçº¿ç¨‹é”å®šï¼Œä½¿ç”¨åæ–œé”å¯ä»¥é™ä½æ— ç«äº‰å¼€é”€ã€‚</p><p>å¦‚æœæœ‰å¦å¤–çš„çº¿ç¨‹è¯•å›¾é”å®šæŸä¸ªå·²ç»è¢«åæ–œè¿‡çš„å¯¹è±¡ï¼ŒJVM å°±éœ€è¦æ’¤é”€ï¼ˆrevokeï¼‰åæ–œé”ï¼Œå¹¶åˆ‡æ¢åˆ°è½»é‡çº§é”å®ç°ã€‚è½»é‡çº§é”ä¾èµ– CAS æ“ä½œ Mark Word æ¥è¯•å›¾è·å–é”ï¼Œå¦‚æœé‡è¯•æˆåŠŸï¼Œå°±ä½¿ç”¨æ™®é€šçš„è½»é‡çº§é”ï¼›å¦åˆ™ï¼Œè¿›ä¸€æ­¥å‡çº§ä¸ºé‡é‡çº§é”ï¼ˆå¯èƒ½ä¼šå…ˆè¿›è¡Œè‡ªæ—‹é”å‡çº§ï¼Œå¦‚æœå¤±è´¥å†å°è¯•é‡é‡çº§é”å‡çº§ï¼‰ã€‚</p><p>æˆ‘æ³¨æ„åˆ°æœ‰çš„è§‚ç‚¹è®¤ä¸º Java ä¸ä¼šè¿›è¡Œé”é™çº§ã€‚å®é™…ä¸Šæ®æˆ‘æ‰€çŸ¥ï¼Œé”é™çº§ç¡®å®æ˜¯ä¼šå‘ç”Ÿçš„ï¼Œå½“ JVM è¿›å…¥å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰é—²ç½®çš„ Monitorï¼Œç„¶åè¯•å›¾è¿›è¡Œé™çº§ã€‚</p><h4 id="2ã€Synchronizedä¼˜åŒ–åçš„é”æœºåˆ¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒåŒ…æ‹¬è‡ªæ—‹é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Ÿ"><a href="#2ã€Synchronizedä¼˜åŒ–åçš„é”æœºåˆ¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒåŒ…æ‹¬è‡ªæ—‹é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Ÿ" class="headerlink" title="2ã€Synchronizedä¼˜åŒ–åçš„é”æœºåˆ¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒåŒ…æ‹¬è‡ªæ—‹é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Ÿ"></a>2ã€Synchronizedä¼˜åŒ–åçš„é”æœºåˆ¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒåŒ…æ‹¬è‡ªæ—‹é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Ÿ</h4><p>è‡ªæ—‹é”ï¼š</p><p>çº¿ç¨‹è‡ªæ—‹è¯´ç™½äº†å°±æ˜¯è®©cpuåœ¨åšæ— ç”¨åŠŸï¼Œæ¯”å¦‚ï¼šå¯ä»¥æ‰§è¡Œå‡ æ¬¡forå¾ªç¯ï¼Œå¯ä»¥æ‰§è¡Œå‡ æ¡ç©ºçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œç›®çš„æ˜¯å ç€CPUä¸æ”¾ï¼Œç­‰å¾…è·å–é”çš„æœºä¼šã€‚å¦‚æœæ—‹çš„æ—¶é—´è¿‡é•¿ä¼šå½±å“æ•´ä½“æ€§èƒ½ï¼Œæ—¶é—´è¿‡çŸ­åˆè¾¾ä¸åˆ°å»¶è¿Ÿé˜»å¡çš„ç›®çš„ã€‚</p><p>åå‘é”</p><p>åå‘é”å°±æ˜¯ä¸€æ—¦çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—äº†ç›‘è§†å¯¹è±¡ï¼Œä¹‹åè®©ç›‘è§†å¯¹è±¡â€œåå‘â€è¿™ä¸ªçº¿ç¨‹ï¼Œä¹‹åçš„å¤šæ¬¡è°ƒç”¨åˆ™å¯ä»¥é¿å…CASæ“ä½œï¼Œè¯´ç™½äº†å°±æ˜¯ç½®ä¸ªå˜é‡ï¼Œå¦‚æœå‘ç°ä¸ºtrueåˆ™æ— éœ€å†èµ°å„ç§åŠ é”/è§£é”æµç¨‹ã€‚</p><p>è½»é‡çº§é”ï¼š</p><p>è½»é‡çº§é”æ˜¯ç”±åå‘æ‰€å‡çº§æ¥çš„ï¼Œåå‘é”è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥å—çš„æƒ…å†µä¸‹ï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”ç«äº‰ç”¨çš„æ—¶å€™ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼›</p><p>é‡é‡çº§é”</p><p>é‡é‡é”åœ¨JVMä¸­åˆå«å¯¹è±¡ç›‘è§†å™¨ï¼ˆMonitorï¼‰ï¼Œå®ƒå¾ˆåƒCä¸­çš„Mutexï¼Œé™¤äº†å…·å¤‡Mutex(0|1)äº’æ–¥çš„åŠŸèƒ½ï¼Œå®ƒè¿˜è´Ÿè´£å®ç°äº†Semaphore(ä¿¡å·é‡)çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒè‡³å°‘åŒ…å«ä¸€ä¸ªç«äº‰é”çš„é˜Ÿåˆ—ï¼Œå’Œä¸€ä¸ªä¿¡å·é˜»å¡é˜Ÿåˆ—ï¼ˆwaité˜Ÿåˆ—ï¼‰ï¼Œå‰è€…è´Ÿè´£åšäº’æ–¥ï¼Œåä¸€ä¸ªç”¨äºåšçº¿ç¨‹åŒæ­¥ã€‚</p><h4 id="3ã€è°ˆè°ˆå¯¹Synchronizedå…³é”®å­—æ¶‰åŠåˆ°çš„ç±»é”ï¼Œæ–¹æ³•é”ï¼Œé‡å…¥é”çš„ç†è§£ï¼Ÿ"><a href="#3ã€è°ˆè°ˆå¯¹Synchronizedå…³é”®å­—æ¶‰åŠåˆ°çš„ç±»é”ï¼Œæ–¹æ³•é”ï¼Œé‡å…¥é”çš„ç†è§£ï¼Ÿ" class="headerlink" title="3ã€è°ˆè°ˆå¯¹Synchronizedå…³é”®å­—æ¶‰åŠåˆ°çš„ç±»é”ï¼Œæ–¹æ³•é”ï¼Œé‡å…¥é”çš„ç†è§£ï¼Ÿ"></a>3ã€è°ˆè°ˆå¯¹Synchronizedå…³é”®å­—æ¶‰åŠåˆ°çš„ç±»é”ï¼Œæ–¹æ³•é”ï¼Œé‡å…¥é”çš„ç†è§£ï¼Ÿ</h4><p>synchronizedä¿®é¥°é™æ€æ–¹æ³•è·å–çš„æ˜¯ç±»é”(ç±»çš„å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡)ã€‚</p><p>synchronizedä¿®é¥°æ™®é€šæ–¹æ³•æˆ–ä»£ç å—è·å–çš„æ˜¯å¯¹è±¡é”ã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº†åŒä¸€æ—¶åˆ»å¯¹äºæ¯ä¸€ä¸ªç±»å®ä¾‹ï¼Œå…¶æ‰€æœ‰å£°æ˜ä¸º synchronized çš„æˆå‘˜å‡½æ•°ä¸­è‡³å¤šåªæœ‰ä¸€ä¸ªå¤„äºå¯æ‰§è¡ŒçŠ¶æ€ï¼Œä»è€Œæœ‰æ•ˆé¿å…äº†ç±»æˆå‘˜å˜é‡çš„è®¿é—®å†²çªã€‚</p><p>å®ƒä¿©æ˜¯ä¸å†²çªçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè·å–äº†ç±»é”çš„çº¿ç¨‹å’Œè·å–äº†å¯¹è±¡é”çš„çº¿ç¨‹æ˜¯ä¸å†²çªçš„ï¼</p><pre><code>public class Widget &#123;    // é”ä½äº†    public synchronized void doSomething() &#123;        ...    &#125;&#125;public class LoggingWidget extends Widget &#123;    // é”ä½äº†    public synchronized void doSomething() &#123;        System.out.println(toString() + &quot;: calling doSomething&quot;);        super.doSomething();    &#125;&#125;</code></pre><p>å› ä¸ºé”çš„æŒæœ‰è€…æ˜¯â€œçº¿ç¨‹â€ï¼Œè€Œä¸æ˜¯â€œè°ƒç”¨â€ã€‚</p><p>çº¿ç¨‹Aå·²ç»æ˜¯æœ‰äº†LoggingWidgetå®ä¾‹å¯¹è±¡çš„é”äº†ï¼Œå½“å†éœ€è¦çš„æ—¶å€™å¯ä»¥ç»§ç»­<strong>â€œå¼€é”â€</strong>è¿›å»çš„ï¼</p><p>è¿™å°±æ˜¯å†…ç½®é”çš„å¯é‡å…¥æ€§ã€‚</p><h4 id="4ã€waitã€sleepçš„åŒºåˆ«å’Œnotifyè¿è¡Œè¿‡ç¨‹ã€‚"><a href="#4ã€waitã€sleepçš„åŒºåˆ«å’Œnotifyè¿è¡Œè¿‡ç¨‹ã€‚" class="headerlink" title="4ã€waitã€sleepçš„åŒºåˆ«å’Œnotifyè¿è¡Œè¿‡ç¨‹ã€‚"></a>4ã€waitã€sleepçš„åŒºåˆ«å’Œnotifyè¿è¡Œè¿‡ç¨‹ã€‚</h4><h5 id="waitã€sleepçš„åŒºåˆ«"><a href="#waitã€sleepçš„åŒºåˆ«" class="headerlink" title="waitã€sleepçš„åŒºåˆ«"></a>waitã€sleepçš„åŒºåˆ«</h5><p>æœ€å¤§çš„ä¸åŒæ˜¯åœ¨ç­‰å¾…æ—¶ wait ä¼šé‡Šæ”¾é”ï¼Œè€Œ sleep ä¸€ç›´æŒæœ‰é”ã€‚wait é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’ï¼Œsleep é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œã€‚    </p><ul><li>é¦–å…ˆï¼Œè¦è®°ä½è¿™ä¸ªå·®åˆ«ï¼Œâ€œsleepæ˜¯Threadç±»çš„æ–¹æ³•,waitæ˜¯Objectç±»ä¸­å®šä¹‰çš„æ–¹æ³•â€ã€‚å°½ç®¡è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šå½±å“çº¿ç¨‹çš„æ‰§è¡Œè¡Œä¸ºï¼Œä½†æ˜¯æœ¬è´¨ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚</li><li>Thread.sleepä¸ä¼šå¯¼è‡´é”è¡Œä¸ºçš„æ”¹å˜ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ˜¯æ‹¥æœ‰é”çš„ï¼Œé‚£ä¹ˆThread.sleepä¸ä¼šè®©çº¿ç¨‹é‡Šæ”¾é”ã€‚å¦‚æœèƒ½å¤Ÿå¸®åŠ©ä½ è®°å¿†çš„è¯ï¼Œå¯ä»¥ç®€å•è®¤ä¸ºå’Œé”ç›¸å…³çš„æ–¹æ³•éƒ½å®šä¹‰åœ¨Objectç±»ä¸­ï¼Œå› æ­¤è°ƒç”¨Thread.sleepæ˜¯ä¸ä¼šå½±å“é”çš„ç›¸å…³è¡Œä¸ºã€‚</li><li>Thread.sleepå’ŒObject.waitéƒ½ä¼šæš‚åœå½“å‰çš„çº¿ç¨‹ï¼Œå¯¹äºCPUèµ„æºæ¥è¯´ï¼Œä¸ç®¡æ˜¯å“ªç§æ–¹å¼æš‚åœçš„çº¿ç¨‹ï¼Œéƒ½è¡¨ç¤ºå®ƒæš‚æ—¶ä¸å†éœ€è¦CPUçš„æ‰§è¡Œæ—¶é—´ã€‚OSä¼šå°†æ‰§è¡Œæ—¶é—´åˆ†é…ç»™å…¶å®ƒçº¿ç¨‹ã€‚åŒºåˆ«æ˜¯ï¼Œè°ƒç”¨waitåï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹æ‰§è¡Œnotify/notifyAllæ‰èƒ½å¤Ÿé‡æ–°è·å¾—CPUæ‰§è¡Œæ—¶é—´ã€‚</li><li>çº¿ç¨‹çš„çŠ¶æ€å‚è€ƒ Thread.Stateçš„å®šä¹‰ã€‚æ–°åˆ›å»ºçš„ä½†æ˜¯æ²¡æœ‰æ‰§è¡Œï¼ˆè¿˜æ²¡æœ‰è°ƒç”¨start())çš„çº¿ç¨‹å¤„äºâ€œå°±ç»ªâ€ï¼Œæˆ–è€…è¯´Thread.State.NEWçŠ¶æ€ã€‚</li><li>Thread.State.BLOCKEDï¼ˆé˜»å¡ï¼‰è¡¨ç¤ºçº¿ç¨‹æ­£åœ¨è·å–é”æ—¶ï¼Œå› ä¸ºé”ä¸èƒ½è·å–åˆ°è€Œè¢«è¿«æš‚åœæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼Œä¸€ç›´ç­‰åˆ°è¿™ä¸ªé”è¢«åˆ«çš„çº¿ç¨‹é‡Šæ”¾ã€‚BLOCKEDçŠ¶æ€ä¸‹çº¿ç¨‹ï¼ŒOSè°ƒåº¦æœºåˆ¶éœ€è¦å†³å®šä¸‹ä¸€ä¸ªèƒ½å¤Ÿè·å–é”çš„çº¿ç¨‹æ˜¯å“ªä¸ªï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±æ˜¯äº§ç”Ÿé”çš„äº‰ç”¨ï¼Œæ— è®ºå¦‚ä½•è¿™éƒ½æ˜¯å¾ˆè€—æ—¶çš„æ“ä½œã€‚</li></ul><h5 id="notifyè¿è¡Œè¿‡ç¨‹"><a href="#notifyè¿è¡Œè¿‡ç¨‹" class="headerlink" title="notifyè¿è¡Œè¿‡ç¨‹"></a>notifyè¿è¡Œè¿‡ç¨‹</h5><p>å½“çº¿ç¨‹Aï¼ˆæ¶ˆè´¹è€…ï¼‰è°ƒç”¨wait()æ–¹æ³•åï¼Œçº¿ç¨‹Aè®©å‡ºé”ï¼Œè‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶åŠ å…¥é”å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ã€‚<br>çº¿ç¨‹Bï¼ˆç”Ÿäº§è€…ï¼‰è·å–é”åï¼Œè°ƒç”¨notifyæ–¹æ³•é€šçŸ¥é”å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œä½¿å¾—çº¿ç¨‹Aä»ç­‰å¾…é˜Ÿåˆ—è¿›å…¥é˜»å¡é˜Ÿåˆ—ã€‚<br>çº¿ç¨‹Aè¿›å…¥é˜»å¡é˜Ÿåˆ—åï¼Œç›´è‡³çº¿ç¨‹Bé‡Šæ”¾é”åï¼Œçº¿ç¨‹Aç«äº‰å¾—åˆ°é”ç»§ç»­ä»wait()æ–¹æ³•åæ‰§è¡Œã€‚</p><h4 id="5ã€synchronizedå…³é”®å­—å’ŒLockçš„åŒºåˆ«ä½ çŸ¥é“å—ï¼Ÿä¸ºä»€ä¹ˆLockçš„æ€§èƒ½å¥½ä¸€äº›ï¼Ÿ"><a href="#5ã€synchronizedå…³é”®å­—å’ŒLockçš„åŒºåˆ«ä½ çŸ¥é“å—ï¼Ÿä¸ºä»€ä¹ˆLockçš„æ€§èƒ½å¥½ä¸€äº›ï¼Ÿ" class="headerlink" title="5ã€synchronizedå…³é”®å­—å’ŒLockçš„åŒºåˆ«ä½ çŸ¥é“å—ï¼Ÿä¸ºä»€ä¹ˆLockçš„æ€§èƒ½å¥½ä¸€äº›ï¼Ÿ"></a>5ã€synchronizedå…³é”®å­—å’ŒLockçš„åŒºåˆ«ä½ çŸ¥é“å—ï¼Ÿä¸ºä»€ä¹ˆLockçš„æ€§èƒ½å¥½ä¸€äº›ï¼Ÿ</h4><table><thead><tr><th>ç±»åˆ«</th><th>synchronized</th><th>Lockï¼ˆåº•å±‚å®ç°ä¸»è¦æ˜¯Volatile + CASï¼‰</th></tr></thead><tbody><tr><td>å­˜åœ¨å±‚æ¬¡</td><td>Javaçš„å…³é”®å­—ï¼Œåœ¨jvmå±‚é¢ä¸Š</td><td>æ˜¯ä¸€ä¸ªç±»</td></tr><tr><td>é”çš„é‡Šæ”¾</td><td>1ã€å·²è·å–é”çš„çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ï¼Œé‡Šæ”¾é”          2ã€çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œjvmä¼šè®©çº¿ç¨‹é‡Šæ”¾é”ã€‚</td><td>åœ¨finallyä¸­å¿…é¡»é‡Šæ”¾é”ï¼Œä¸ç„¶å®¹æ˜“é€ æˆçº¿ç¨‹æ­»é”ã€‚</td></tr><tr><td>é”çš„è·å–</td><td>å‡è®¾Açº¿ç¨‹è·å¾—é”ï¼ŒBçº¿ç¨‹ç­‰å¾…ã€‚å¦‚æœAçº¿ç¨‹é˜»å¡ï¼ŒBçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ã€‚</td><td>åˆ†æƒ…å†µè€Œå®šï¼ŒLockæœ‰å¤šä¸ªé”è·å–çš„æ–¹å¼ï¼Œå¤§è‡´å°±æ˜¯å¯ä»¥å°è¯•è·å¾—é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…</td></tr><tr><td>é”çŠ¶æ€</td><td>æ— æ³•åˆ¤æ–­</td><td>å¯ä»¥åˆ¤æ–­</td></tr><tr><td>é”ç±»å‹</td><td>å¯é‡å…¥ ä¸å¯ä¸­æ–­ éå…¬å¹³</td><td>å¯é‡å…¥ å¯åˆ¤æ–­ å¯å…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰</td></tr><tr><td>æ€§èƒ½</td><td>å°‘é‡åŒæ­¥</td><td>å¤§é‡åŒæ­¥</td></tr><tr><td></td><td></td><td></td></tr><tr><td>Lockï¼ˆReentrantLockï¼‰çš„åº•å±‚å®ç°ä¸»è¦æ˜¯Volatile + CASï¼ˆä¹è§‚é”ï¼‰ï¼Œè€ŒSynchronizedæ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œæ¯”è¾ƒè€—æ€§èƒ½ã€‚ä½†æ˜¯åœ¨JDK1.6ä»¥åå¯¹Synchronizedçš„é”æœºåˆ¶è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒåŠ å…¥äº†åå‘é”ã€è½»é‡çº§é”ã€è‡ªæ—‹é”ã€é‡é‡çº§é”ï¼Œåœ¨å¹¶å‘é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½å¯èƒ½ä¼˜äºLockæœºåˆ¶ã€‚æ‰€ä»¥å»ºè®®ä¸€èˆ¬è¯·æ±‚å¹¶å‘é‡ä¸å¤§çš„æƒ…å†µä¸‹ä½¿ç”¨synchronizedå…³é”®å­—ã€‚</td><td></td><td></td></tr></tbody></table><h4 id="6ã€volatileåŸç†ã€‚"><a href="#6ã€volatileåŸç†ã€‚" class="headerlink" title="6ã€volatileåŸç†ã€‚"></a>6ã€volatileåŸç†ã€‚</h4><p>åœ¨ã€ŠJavaå¹¶å‘ç¼–ç¨‹ï¼šæ ¸å¿ƒç†è®ºã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»æåˆ°å¯è§æ€§ã€æœ‰åºæ€§åŠåŸå­æ€§é—®é¢˜ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡Synchronizedå…³é”®å­—æ¥è§£å†³è¿™äº›ä¸ªé—®é¢˜ï¼Œä¸è¿‡å¦‚æœå¯¹SynchonizedåŸç†æœ‰äº†è§£çš„è¯ï¼Œåº”è¯¥çŸ¥é“Synchronizedæ˜¯ä¸€ä¸ªè¾ƒé‡é‡çº§çš„æ“ä½œï¼Œå¯¹ç³»ç»Ÿçš„æ€§èƒ½æœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œæ‰€ä»¥å¦‚æœæœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬é€šå¸¸éƒ½é¿å…ä½¿ç”¨Synchronizedæ¥è§£å†³é—®é¢˜ã€‚</p><p>è€Œvolatileå…³é”®å­—å°±æ˜¯Javaä¸­æä¾›çš„å¦ä¸€ç§è§£å†³å¯è§æ€§æœ‰åºæ€§é—®é¢˜çš„æ–¹æ¡ˆã€‚å¯¹äºåŸå­æ€§ï¼Œéœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼Œä¹Ÿæ˜¯å¤§å®¶å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹ï¼šå¯¹volatileå˜é‡çš„å•æ¬¡è¯»/å†™æ“ä½œå¯ä¿è¯åŸå­æ€§çš„ï¼Œå¦‚longå’Œdoubleç±»å‹å˜é‡ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯i++è¿™ç§æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºæœ¬è´¨ä¸Ši++æ˜¯è¯»ã€å†™ä¸¤æ¬¡æ“ä½œã€‚</p><p>volatileä¹Ÿæ˜¯äº’æ–¥åŒæ­¥çš„ä¸€ç§å®ç°ï¼Œä¸è¿‡å®ƒéå¸¸çš„è½»é‡çº§ã€‚</p><h5 id="volatile-çš„æ„ä¹‰ï¼Ÿ"><a href="#volatile-çš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="volatile çš„æ„ä¹‰ï¼Ÿ"></a>volatile çš„æ„ä¹‰ï¼Ÿ</h5><ul><li>é˜²æ­¢CPUæŒ‡ä»¤é‡æ’åº</li></ul><p>volatileæœ‰ä¸¤æ¡å…³é”®çš„è¯­ä¹‰ï¼š</p><p>ä¿è¯è¢«volatileä¿®é¥°çš„å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯è§çš„</p><p>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</p><p>è¦ç†è§£volatileå…³é”®å­—ï¼Œæˆ‘ä»¬å¾—å…ˆä»Javaçš„çº¿ç¨‹æ¨¡å‹å¼€å§‹è¯´èµ·ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://github.com/guoxiaoxing/android-open-source-project-analysis/raw/master/art/native/process/java_memory_model.png" alt="image"></p><p>Javaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰å­—æ®µï¼ˆè¿™äº›å­—æ®µåŒ…æ‹¬å®ä¾‹å­—æ®µã€é™æ€å­—æ®µç­‰ï¼Œä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ç­‰ï¼Œå› ä¸ºè¿™äº›æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå¹¶ä¸å­˜åœ¨ç«äº‰ï¼‰éƒ½å­˜åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼š æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜é‡Œä¿å­˜äº†çº¿ç¨‹æ‰€ä½¿ç”¨åˆ°çš„å˜é‡åœ¨ä¸»å†…å­˜é‡Œçš„å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œåªèƒ½åœ¨å·¥ä½œå†…å­˜é‡Œè¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ï¼Œå½“ç„¶ä¸åŒå†…å­˜ä¹‹é—´ä¹Ÿ æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸»å†…å­˜æ˜¯çº¿ç¨‹ä¼ å€¼çš„åª’ä»‹ã€‚</p><p>æˆ‘ä»¬æ¥ç†è§£ç¬¬ä¸€å¥è¯ï¼š</p><pre><code>ä¿è¯è¢«volatileä¿®é¥°çš„å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯è§çš„</code></pre><p>å¦‚ä½•ä¿è¯å¯è§æ€§ï¼Ÿ</p><p>è¢«volatileä¿®é¥°çš„å˜é‡åœ¨å·¥ä½œå†…å­˜ä¿®æ”¹åä¼šè¢«å¼ºåˆ¶å†™å›ä¸»å†…å­˜ï¼Œå…¶ä»–çº¿ç¨‹åœ¨ä½¿ç”¨æ—¶ä¹Ÿä¼šå¼ºåˆ¶ä»ä¸»å†…å­˜åˆ·æ–°ï¼Œè¿™æ ·å°±ä¿è¯äº†ä¸€è‡´æ€§ã€‚</p><p>å…³äºâ€œä¿è¯è¢«volatileä¿®é¥°çš„å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯è§çš„â€ï¼Œæœ‰ç§å¸¸è§çš„é”™è¯¯ç†è§£ï¼š</p><ul><li>ç”±äºvolatileä¿®é¥°çš„å˜é‡åœ¨å„ä¸ªçº¿ç¨‹é‡Œéƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥åŸºäºvolatileå˜é‡çš„è¿ç®—åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„ã€‚</li></ul><p>è¿™å¥è¯çš„å‰åŠéƒ¨åˆ†æ˜¯å¯¹çš„ï¼ŒååŠéƒ¨åˆ†å´é”™äº†ï¼Œå› æ­¤å®ƒå¿˜è®°è€ƒè™‘å˜é‡çš„æ“ä½œæ˜¯å¦å…·æœ‰åŸå­æ€§è¿™ä¸€é—®é¢˜ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code>private volatile int start = 0;private void volatile Keyword() &#123;    Runnable runnable = new Runnable() &#123;        @Override        public void run() &#123;            for (int i = 0; i &lt; 10; i++) &#123;                start++;            &#125;        &#125;    &#125;;    for (int i = 0; i &lt; 10; i++) &#123;        Thread thread = new Thread(runnable);        thread.start();    &#125;    Log.d(TAG, &quot;start = &quot; + start);&#125;</code></pre><p><img src="https://github.com/guoxiaoxing/android-open-source-project-analysis/raw/master/art/native/process/volatile_thread_safe.png" alt="image"></p><p>è¿™æ®µä»£ç å¯åŠ¨äº†10ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡10æ¬¡è‡ªå¢ï¼ŒæŒ‰é“ç†æœ€ç»ˆç»“æœåº”è¯¥æ˜¯100ï¼Œä½†æ˜¯ç»“æœå¹¶éå¦‚æ­¤ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p><p>ä»”ç»†çœ‹ä¸€ä¸‹start++ï¼Œå®ƒå…¶å®å¹¶éä¸€ä¸ªåŸå­æ“ä½œï¼Œç®€å•æ¥çœ‹ï¼Œå®ƒæœ‰ä¸¤æ­¥ï¼š</p><p>1ã€å–å‡ºstartçš„å€¼ï¼Œå› ä¸ºæœ‰volatileçš„ä¿®é¥°ï¼Œè¿™æ—¶å€™çš„å€¼æ˜¯æ­£ç¡®çš„ã€‚</p><p>2ã€è‡ªå¢ï¼Œä½†æ˜¯è‡ªå¢çš„æ—¶å€™ï¼Œåˆ«çš„çº¿ç¨‹å¯èƒ½å·²ç»æŠŠstartåŠ å¤§äº†ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æœ‰å¯èƒ½æŠŠè¾ƒå°çš„startå†™å›ä¸»å†…å­˜ä¸­ã€‚<br>æ‰€ä»¥volatileåªèƒ½ä¿è¯å¯è§æ€§ï¼Œåœ¨ä¸ç¬¦åˆä»¥ä¸‹åœºæ™¯ä¸‹æˆ‘ä»¬ä¾ç„¶éœ€è¦é€šè¿‡åŠ é”æ¥ä¿è¯åŸå­æ€§ï¼š</p><ul><li>è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡å½“å‰çš„å€¼ï¼Œæˆ–è€…åªæœ‰å•ä¸€çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ã€‚ï¼ˆè¦ä¹ˆç»“æœä¸ä¾èµ–å½“å‰å€¼ï¼Œè¦ä¹ˆæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œè¦ä¹ˆåªè¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ï¼‰</li><li>å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸ<br>æ¯”æ–¹è¯´æˆ‘ä»¬ä¼šåœ¨çº¿ç¨‹é‡ŒåŠ ä¸ªbooleanå˜é‡ï¼Œæ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Œè¿™ç§æƒ…å†µå°±éå¸¸é€‚åˆä½¿ç”¨volatileã€‚</li></ul><p>æˆ‘ä»¬å†æ¥ç†è§£ç¬¬äºŒå¥è¯ã€‚</p><p>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</p><p>ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼Ÿ</p><ul><li><p>æŒ‡ä»¤é‡æ’åºæ˜¯æŒ‡æŒ‡ä»¤ä¹±åºæ‰§è¡Œï¼Œå³åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ç›´æ¥è¿è¡Œå½“å‰æœ‰èƒ½åŠ›ç«‹å³æ‰§è¡Œçš„åç»­æŒ‡ä»¤ï¼Œé¿å¼€ä¸ºè·å–ä¸€æ¡æŒ‡ä»¤æ‰€éœ€æ•°æ®è€Œé€ æˆçš„ç­‰å¾…ï¼Œé€šè¿‡ä¹±åºæ‰§è¡Œçš„æŠ€æœ¯æä¾›æ‰§è¡Œæ•ˆç‡ã€‚</p></li><li><p>æŒ‡ä»¤é‡æ’åºä¼šåœ¨è¢«volatileä¿®é¥°çš„å˜é‡çš„èµ‹å€¼æ“ä½œå‰ï¼Œæ·»åŠ ä¸€ä¸ªå†…å­˜å±éšœï¼ŒæŒ‡ä»¤é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºç§»åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚</p></li></ul><h4 id="7ã€synchronized-å’Œ-volatile-å…³é”®å­—çš„ä½œç”¨å’ŒåŒºåˆ«ã€‚"><a href="#7ã€synchronized-å’Œ-volatile-å…³é”®å­—çš„ä½œç”¨å’ŒåŒºåˆ«ã€‚" class="headerlink" title="7ã€synchronized å’Œ volatile å…³é”®å­—çš„ä½œç”¨å’ŒåŒºåˆ«ã€‚"></a>7ã€synchronized å’Œ volatile å…³é”®å­—çš„ä½œç”¨å’ŒåŒºåˆ«ã€‚</h4><h5 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h5><p>1ï¼‰ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§å³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥æ˜¯ç«‹å³å¯è§çš„ã€‚</p><p>2ï¼‰ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</p><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h5><p>volatile æœ¬è´¨æ˜¯åœ¨å‘Šè¯‰jvmå½“å‰å˜é‡åœ¨å¯„å­˜å™¨ï¼ˆå·¥ä½œå†…å­˜ï¼‰ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€ä»ä¸»å­˜ä¸­è¯»å–ï¼›synchronizedåˆ™æ˜¯é”å®šå½“å‰å˜é‡ï¼Œåªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡ï¼Œå…¶å®ƒçº¿ç¨‹è¢«é˜»å¡ä½ã€‚</p><h5 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h5><p>1.volatile ä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«ï¼›synchronizedåˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡ã€æ–¹æ³•ã€å’Œç±»çº§åˆ«çš„ã€‚</p><p>2.volatile ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ï¼›synchronized åˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚</p><p>3.volatile ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronized å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚</p><p>4.volatile æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›synchronizedæ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p><h4 id="8ã€ReentrantLockçš„å†…éƒ¨å®ç°ã€‚"><a href="#8ã€ReentrantLockçš„å†…éƒ¨å®ç°ã€‚" class="headerlink" title="8ã€ReentrantLockçš„å†…éƒ¨å®ç°ã€‚"></a>8ã€<a href="https://www.cnblogs.com/chengxiao/p/7255941.html">ReentrantLockçš„å†…éƒ¨å®ç°</a>ã€‚</h4><p>ReentrantLockå®ç°çš„å‰æå°±æ˜¯AbstractQueuedSynchronizerï¼Œç®€ç§°AQSï¼Œæ˜¯java.util.concurrentçš„æ ¸å¿ƒï¼ŒCountDownLatchã€FutureTaskã€Semaphoreã€ReentrantLockç­‰éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨ç±»æ˜¯è¿™ä¸ªæŠ½è±¡ç±»çš„å­ç±»ã€‚ç”±äºAQSæ˜¯åŸºäºFIFOé˜Ÿåˆ—çš„å®ç°ï¼Œå› æ­¤å¿…ç„¶å­˜åœ¨ä¸€ä¸ªä¸ªèŠ‚ç‚¹ï¼ŒNodeå°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒNodeæœ‰ä¸¤ç§æ¨¡å¼ï¼šå…±äº«æ¨¡å¼å’Œç‹¬å æ¨¡å¼ã€‚ReentrantLockæ˜¯åŸºäºAQSçš„ï¼ŒAQSæ˜¯Javaå¹¶å‘åŒ…ä¸­ä¼—å¤šåŒæ­¥ç»„ä»¶çš„æ„å»ºåŸºç¡€ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªintç±»å‹çš„çŠ¶æ€å˜é‡stateå’Œä¸€ä¸ªFIFOé˜Ÿåˆ—æ¥å®Œæˆå…±äº«èµ„æºçš„è·å–ï¼Œçº¿ç¨‹çš„æ’é˜Ÿç­‰å¾…ç­‰ã€‚AQSæ˜¯ä¸ªåº•å±‚æ¡†æ¶ï¼Œé‡‡ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†é€šç”¨çš„è¾ƒä¸ºå¤æ‚çš„é€»è¾‘éª¨æ¶ï¼Œæ¯”å¦‚çº¿ç¨‹çš„æ’é˜Ÿï¼Œé˜»å¡ï¼Œå”¤é†’ç­‰ï¼Œå°†è¿™äº›å¤æ‚ä½†å®è´¨é€šç”¨çš„éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦æ„å»ºåŒæ­¥ç»„ä»¶çš„ä½¿ç”¨è€…æ— éœ€å…³å¿ƒçš„ï¼Œä½¿ç”¨è€…ä»…éœ€é‡å†™ä¸€äº›ç®€å•çš„æŒ‡å®šçš„æ–¹æ³•å³å¯ï¼ˆå…¶å®å°±æ˜¯å¯¹äºå…±äº«å˜é‡stateçš„ä¸€äº›ç®€å•çš„è·å–é‡Šæ”¾çš„æ“ä½œï¼‰ã€‚AQSçš„å­ç±»ä¸€èˆ¬åªéœ€è¦é‡å†™tryAcquire(int arg)å’ŒtryRelease(int arg)ä¸¤ä¸ªæ–¹æ³•å³å¯ã€‚</p><h5 id="ReentrantLockçš„å¤„ç†é€»è¾‘ï¼š"><a href="#ReentrantLockçš„å¤„ç†é€»è¾‘ï¼š" class="headerlink" title="ReentrantLockçš„å¤„ç†é€»è¾‘ï¼š"></a>ReentrantLockçš„å¤„ç†é€»è¾‘ï¼š</h5><p>å…¶å†…éƒ¨å®šä¹‰äº†ä¸‰ä¸ªé‡è¦çš„é™æ€å†…éƒ¨ç±»ï¼ŒSyncï¼ŒNonFairSyncï¼ŒFairSyncã€‚Syncä½œä¸ºReentrantLockä¸­å…¬ç”¨çš„åŒæ­¥ç»„ä»¶ï¼Œç»§æ‰¿äº†AQSï¼ˆè¦åˆ©ç”¨AQSå¤æ‚çš„é¡¶å±‚é€»è¾‘å˜›ï¼Œçº¿ç¨‹æ’é˜Ÿï¼Œé˜»å¡ï¼Œå”¤é†’ç­‰ç­‰ï¼‰ï¼›NonFairSyncå’ŒFairSyncåˆ™éƒ½ç»§æ‰¿Syncï¼Œè°ƒç”¨Syncçš„å…¬ç”¨é€»è¾‘ï¼Œç„¶åå†åœ¨å„è‡ªå†…éƒ¨å®Œæˆè‡ªå·±ç‰¹å®šçš„é€»è¾‘ï¼ˆå…¬å¹³æˆ–éå…¬å¹³ï¼‰ã€‚</p><p>æ¥ç€è¯´ä¸‹è¿™ä¸¤è€…çš„lock()æ–¹æ³•å®ç°åŸç†ï¼š</p><h5 id="NonFairSyncï¼ˆéå…¬å¹³å¯é‡å…¥é”ï¼‰"><a href="#NonFairSyncï¼ˆéå…¬å¹³å¯é‡å…¥é”ï¼‰" class="headerlink" title="NonFairSyncï¼ˆéå…¬å¹³å¯é‡å…¥é”ï¼‰"></a>NonFairSyncï¼ˆéå…¬å¹³å¯é‡å…¥é”ï¼‰</h5><p>1.å…ˆè·å–stateå€¼ï¼Œè‹¥ä¸º0ï¼Œæ„å‘³ç€æ­¤æ—¶æ²¡æœ‰çº¿ç¨‹è·å–åˆ°èµ„æºï¼ŒCASå°†å…¶è®¾ç½®ä¸º1ï¼Œè®¾ç½®æˆåŠŸåˆ™ä»£è¡¨è·å–åˆ°æ’ä»–é”äº†ï¼›</p><p>2.è‹¥stateå¤§äº0ï¼Œè‚¯å®šæœ‰çº¿ç¨‹å·²ç»æŠ¢å åˆ°èµ„æºäº†ï¼Œæ­¤æ—¶å†å»åˆ¤æ–­æ˜¯å¦å°±æ˜¯è‡ªå·±æŠ¢å çš„ï¼Œæ˜¯çš„è¯ï¼Œstateç´¯åŠ ï¼Œè¿”å›trueï¼Œé‡å…¥æˆåŠŸï¼Œstateçš„å€¼å³æ˜¯çº¿ç¨‹é‡å…¥çš„æ¬¡æ•°ï¼›</p><p>3.å…¶ä»–æƒ…å†µï¼Œåˆ™è·å–é”å¤±è´¥ã€‚</p><h5 id="FairSyncï¼ˆå…¬å¹³å¯é‡å…¥é”ï¼‰"><a href="#FairSyncï¼ˆå…¬å¹³å¯é‡å…¥é”ï¼‰" class="headerlink" title="FairSyncï¼ˆå…¬å¹³å¯é‡å…¥é”ï¼‰"></a>FairSyncï¼ˆå…¬å¹³å¯é‡å…¥é”ï¼‰</h5><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¬å¹³é”çš„å¤§è‡´é€»è¾‘ä¸éå…¬å¹³é”æ˜¯ä¸€è‡´çš„ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºæœ‰äº†!hasQueuedPredecessors()è¿™ä¸ªåˆ¤æ–­é€»è¾‘ï¼Œå³ä¾¿stateä¸º0ï¼Œä¹Ÿä¸èƒ½è´¸ç„¶ç›´æ¥å»è·å–ï¼Œè¦å…ˆå»çœ‹æœ‰æ²¡æœ‰è¿˜åœ¨æ’é˜Ÿçš„çº¿ç¨‹ï¼Œè‹¥æ²¡æœ‰ï¼Œæ‰èƒ½å°è¯•å»è·å–ï¼Œåšåé¢çš„å¤„ç†ã€‚åä¹‹ï¼Œè¿”å›falseï¼Œè·å–å¤±è´¥ã€‚</p><p>æœ€åï¼Œè¯´ä¸‹ReentrantLockçš„tryRelease()æ–¹æ³•å®ç°åŸç†ï¼š</p><p>è‹¥stateå€¼ä¸º0ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å·²å®Œå…¨é‡Šæ”¾å¹²å‡€ï¼Œè¿”å›trueï¼Œä¸Šå±‚çš„AQSä¼šæ„è¯†åˆ°èµ„æºå·²ç©ºå‡ºã€‚è‹¥ä¸ä¸º0ï¼Œåˆ™è¡¨ç¤ºçº¿ç¨‹è¿˜å æœ‰èµ„æºï¼Œåªä¸è¿‡å°†æ­¤æ¬¡é‡å…¥çš„èµ„æºçš„é‡Šæ”¾äº†è€Œå·²ï¼Œè¿”å›falseã€‚</p><p>ReentrantLockæ˜¯ä¸€ç§å¯é‡å…¥çš„ï¼Œå¯å®ç°å…¬å¹³æ€§çš„äº’æ–¥é”ï¼Œå®ƒçš„è®¾è®¡åŸºäºAQSæ¡†æ¶ï¼Œå¯é‡å…¥å’Œå…¬å¹³æ€§çš„å®ç°é€»è¾‘éƒ½ä¸éš¾ç†è§£ï¼Œæ¯é‡å…¥ä¸€æ¬¡ï¼Œstateå°±åŠ 1ï¼Œå½“ç„¶åœ¨é‡Šæ”¾çš„æ—¶å€™ï¼Œä¹Ÿå¾—ä¸€å±‚ä¸€å±‚é‡Šæ”¾ã€‚è‡³äºå…¬å¹³æ€§ï¼Œåœ¨å°è¯•è·å–é”çš„æ—¶å€™å¤šäº†ä¸€ä¸ªåˆ¤æ–­ï¼šæ˜¯å¦æœ‰æ¯”è‡ªå·±ç”³è¯·æ—©çš„çº¿ç¨‹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œè‹¥æœ‰ï¼Œå»ç­‰å¾…ï¼›è‹¥æ²¡æœ‰ï¼Œæ‰å…è®¸å»æŠ¢å ã€‚ã€€ã€€</p><h4 id="9ã€ReentrantLock-ã€synchronized-å’Œ-volatile-æ¯”è¾ƒï¼Ÿ"><a href="#9ã€ReentrantLock-ã€synchronized-å’Œ-volatile-æ¯”è¾ƒï¼Ÿ" class="headerlink" title="9ã€ReentrantLock ã€synchronized å’Œ volatile æ¯”è¾ƒï¼Ÿ"></a>9ã€ReentrantLock ã€synchronized å’Œ volatile æ¯”è¾ƒï¼Ÿ</h4><p>synchronizedæ˜¯äº’æ–¥åŒæ­¥çš„ä¸€ç§å®ç°ã€‚</p><p>synchronizedï¼šå½“æŸä¸ªçº¿ç¨‹è®¿é—®è¢«synchronizedæ ‡è®°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹ä¾¿è·å¾—äº†è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿æš‚æ—¶æ— æ³•è®¿é—®è¿™ä¸ªæ–¹æ³•ï¼Œåªæœ‰ç­‰å¾…è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ä»£ç å—ã€‚</p><p>å‰é¢æˆ‘ä»¬å·²ç»è¯´äº†volatileå…³é”®å­—ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥ç»¼åˆåˆ†ævolatileä¸synchronizedå…³é”®å­—çš„ä½¿ç”¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code>public class Singleton &#123;    // volatileä¿è¯äº†ï¼š1 instanceåœ¨å¤šçº¿ç¨‹å¹¶å‘çš„å¯è§æ€§ 2 ç¦æ­¢instanceåœ¨æ“ä½œæ˜¯çš„æŒ‡ä»¤é‡æ’åº    private volatile static Singleton instance;    private Singleton()&#123;&#125;    public static Singleton getInstance() &#123;        // ç¬¬ä¸€æ¬¡åˆ¤ç©ºï¼Œä¿è¯ä¸å¿…è¦çš„åŒæ­¥        if (instance == null) &#123;            // synchronizedå¯¹SingletonåŠ å…¨å±€é”ï¼Œä¿è¯æ¯æ¬¡åªè¦ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå®ä¾‹            synchronized (Singleton.class) &#123;                // ç¬¬äºŒæ¬¡åˆ¤ç©ºæ—¶ä¸ºäº†åœ¨nullçš„æƒ…å†µä¸‹åˆ›å»ºå®ä¾‹                if (instance == null) &#123;                    instance = new Singleton();                &#125;            &#125;        &#125;        return instance;    &#125;&#125;</code></pre><p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„DCLå•ä¾‹ã€‚</p><p>å®ƒçš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/guoxiaoxing/android-open-source-project-analysis/raw/master/art/native/process/synchronized_bytecode.png" alt="image"></p><p>å¯ä»¥çœ‹åˆ°è¢«synchronizedåŒæ­¥çš„ä»£ç å—ï¼Œä¼šåœ¨å‰ååˆ†åˆ«åŠ ä¸Šmonitorenterå’Œmonitorexitï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ç éƒ½éœ€è¦æŒ‡å®šåŠ é”å’Œè§£é”çš„å¯¹è±¡ã€‚</p><p>å…³äºåŠ é”å’Œè§£é”çš„å¯¹è±¡ï¼š</p><p>synchronizedä»£ç å— ï¼šåŒæ­¥ä»£ç å—ï¼Œä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªä»£ç å—ï¼Œä½œç”¨å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªä»£ç å—çš„å¯¹è±¡ã€‚</p><p>synchronizedæ–¹æ³• ï¼šåŒæ­¥æ–¹æ³•ï¼Œä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œä½œç”¨å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ã€‚</p><p>synchronizedé™æ€æ–¹æ³• ï¼šåŒæ­¥é™æ€æ–¹æ³•ï¼Œä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªé™æ€æ–¹æ³•ï¼Œä½œç”¨å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><p>synchronized(this)ï¼šä½œç”¨èŒƒå›´æ˜¯è¯¥å¯¹è±¡ä¸­æ‰€æœ‰è¢«synchronizedæ ‡è®°çš„å˜é‡ã€æ–¹æ³•æˆ–ä»£ç å—ï¼Œä½œç”¨å¯¹è±¡æ˜¯å¯¹è±¡æœ¬èº«ã€‚</p><p>synchronized(ClassName.class) ï¼šä½œç”¨èŒƒå›´æ˜¯é™æ€çš„æ–¹æ³•æˆ–è€…é™æ€å˜é‡ï¼Œä½œç”¨å¯¹è±¡æ˜¯Classå¯¹è±¡ã€‚</p><p>synchronized(this)æ·»åŠ çš„æ˜¯å¯¹è±¡é”ï¼Œsynchronized(ClassName.class)æ·»åŠ çš„æ˜¯ç±»é”ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><p>å¯¹è±¡é”ï¼šJavaçš„æ‰€æœ‰å¯¹è±¡éƒ½å«æœ‰1ä¸ªäº’æ–¥é”ï¼Œè¿™ä¸ªé”ç”±JVMè‡ªåŠ¨è·å–å’Œé‡Šæ”¾ã€‚çº¿ç¨‹è¿›å…¥synchronizedæ–¹æ³•çš„æ—¶å€™è·å–è¯¥å¯¹è±¡çš„é”ï¼Œå½“ç„¶å¦‚æœå·²ç»æœ‰çº¿ç¨‹è·å–äº†è¿™ä¸ªå¯¹è±¡çš„é”é‚£ä¹ˆå½“å‰çº¿ç¨‹ä¼šç­‰å¾…ï¼›synchronizedæ–¹æ³•æ­£å¸¸è¿”å›æˆ–è€…æŠ›å¼‚å¸¸è€Œç»ˆæ­¢ï¼ŒJVMä¼šè‡ªåŠ¨é‡Šæ”¾å¯¹è±¡é”ã€‚è¿™é‡Œä¹Ÿä½“ç°äº†ç”¨synchronizedæ¥åŠ é”çš„å¥½å¤„ï¼Œæ–¹æ³•æŠ›å¼‚å¸¸çš„æ—¶å€™ï¼Œé”ä»ç„¶å¯ä»¥ç”±JVMæ¥è‡ªåŠ¨é‡Šæ”¾ã€‚</p></li><li><p>ç±»é”ï¼šå¯¹è±¡é”æ˜¯ç”¨æ¥æ§åˆ¶å®ä¾‹æ–¹æ³•ä¹‹é—´çš„åŒæ­¥ï¼Œç±»é”æ˜¯æ¥æ§åˆ¶é™æ€æ–¹æ³•ï¼ˆæˆ–é™æ€å˜é‡äº’æ–¥ä½“ï¼‰ä¹‹é—´çš„åŒæ­¥ã€‚å…¶å®ç±»é”åªæ˜¯ä¸€ä¸ªæ¦‚å¿µä¸Šçš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå®ƒåªç”¨æ¥å¸®åŠ©æˆ‘ä»¬ç†è§£é”å®šå®ä¾‹æ–¹æ³•å’Œé™æ€æ–¹æ³•çš„åŒºåˆ«çš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œjavaç±»å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªå¯¹è±¡ï¼Œä½†æ˜¯åªæœ‰1ä¸ªClasså¯¹è±¡ï¼Œä¹Ÿå°±è¯´ç±»çš„ä¸åŒå®ä¾‹ä¹‹é—´å…±äº«è¯¥ç±»çš„Classå¯¹è±¡ã€‚Classå¯¹è±¡å…¶å®ä¹Ÿä»…ä»…æ˜¯1ä¸ªjavaå¯¹è±¡ï¼Œåªä¸è¿‡æœ‰ç‚¹ç‰¹æ®Šè€Œå·²ã€‚ç”±äºæ¯ä¸ªjavaå¯¹è±¡éƒ½æœ‰ä¸ªäº’æ–¥é”ï¼Œè€Œç±»çš„é™æ€æ–¹æ³•æ˜¯éœ€è¦Classå¯¹è±¡ã€‚æ‰€ä»¥æ‰€è°“ç±»é”ï¼Œä¸è¿‡æ˜¯Classå¯¹è±¡çš„é”è€Œå·²ã€‚è·å–ç±»çš„Classå¯¹è±¡æœ‰å¥½å‡ ç§ï¼Œæœ€ç®€å•çš„å°±æ˜¯MyClass.classçš„æ–¹å¼ã€‚ç±»é”å’Œå¯¹è±¡é”ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯ç±»çš„Classå¯¹è±¡çš„é”ï¼Œä¸€ä¸ªæ˜¯ç±»çš„å®ä¾‹çš„é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šä¸€ä¸ªçº¿ç¨‹è®¿é—®é™æ€sychronizedçš„æ—¶å€™ï¼Œå…è®¸å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¯¹è±¡çš„å®ä¾‹synchronizedæ–¹æ³•ã€‚åè¿‡æ¥ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œä¸ºä»–ä»¬éœ€è¦çš„é”æ˜¯ä¸åŒçš„ã€‚</p></li></ul><h3 id="ä¸‰ã€å…¶å®ƒ-ï¼ˆâ­â­â­ï¼‰"><a href="#ä¸‰ã€å…¶å®ƒ-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="ä¸‰ã€å…¶å®ƒ ï¼ˆâ­â­â­ï¼‰"></a>ä¸‰ã€å…¶å®ƒ ï¼ˆâ­â­â­ï¼‰</h3><h4 id="1ã€å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#1ã€å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="1ã€å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ"></a>1ã€å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</h4><p>ä½¿ç”¨å¤šçº¿ç¨‹å°±ä¸€å®šæ•ˆç‡é«˜å—ï¼Ÿæœ‰æ—¶å€™ä½¿ç”¨å¤šçº¿ç¨‹å¹¶ä¸æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè€Œæ˜¯ä½¿å¾—CPUèƒ½åŒæ—¶å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚</p><ul><li><p>ä¸ºäº†ä¸é˜»å¡ä¸»çº¿ç¨‹,å¯åŠ¨å…¶ä»–çº¿ç¨‹æ¥åšäº‹æƒ…,æ¯”å¦‚APPä¸­çš„è€—æ—¶æ“ä½œéƒ½ä¸åœ¨UIçº¿ç¨‹ä¸­åšã€‚</p></li><li><p>å®ç°æ›´å¿«çš„åº”ç”¨ç¨‹åº,å³ä¸»çº¿ç¨‹ä¸“é—¨ç›‘å¬ç”¨æˆ·è¯·æ±‚,å­çº¿ç¨‹ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚,ä»¥è·å¾—å¤§çš„ååé‡.æ„Ÿè§‰è¿™ç§æƒ…å†µï¼Œå¤šçº¿ç¨‹çš„æ•ˆç‡æœªå¿…é«˜ã€‚è¿™ç§æƒ…å†µä¸‹çš„å¤šçº¿ç¨‹æ˜¯ä¸ºäº†ä¸å¿…ç­‰å¾…ï¼Œå¯ä»¥å¹¶è¡Œå¤„ç†å¤šæ¡æ•°æ®ã€‚æ¯”å¦‚JavaWebçš„å°±æ˜¯ä¸»çº¿ç¨‹ä¸“é—¨ç›‘å¬ç”¨æˆ·çš„HTTPè¯·æ±‚ï¼Œç„¶å¯åŠ¨å­çº¿ç¨‹å»å¤„ç†ç”¨æˆ·çš„HTTPè¯·æ±‚ã€‚</p></li><li><p>æŸç§è™½ç„¶ä¼˜å…ˆçº§å¾ˆä½çš„æœåŠ¡ï¼Œä½†æ˜¯å´è¦ä¸å®šæ—¶å»åšã€‚æ¯”å¦‚Jvmçš„åƒåœ¾å›æ”¶ã€‚</p></li><li><p>æŸç§ä»»åŠ¡ï¼Œè™½ç„¶è€—æ—¶ï¼Œä½†æ˜¯ä¸æ¶ˆè€—CPUçš„æ“ä½œæ—¶é—´ï¼Œå¼€å¯ä¸ªçº¿ç¨‹ï¼Œæ•ˆç‡ä¼šæœ‰æ˜¾è‘—æé«˜ã€‚æ¯”å¦‚è¯»å–æ–‡ä»¶ï¼Œç„¶åå¤„ç†ã€‚ç£ç›˜IOæ˜¯ä¸ªå¾ˆè€—è´¹æ—¶é—´ï¼Œä½†æ˜¯ä¸è€—CPUè®¡ç®—çš„å·¥ä½œã€‚æ‰€ä»¥å¯ä»¥ä¸€ä¸ªçº¿ç¨‹è¯»å–æ•°æ®ï¼Œä¸€ä¸ªçº¿ç¨‹å¤„ç†æ•°æ®ã€‚è‚¯å®šæ¯”ä¸€ä¸ªçº¿ç¨‹è¯»å–æ•°æ®ï¼Œç„¶åå¤„ç†æ•ˆç‡é«˜ã€‚å› ä¸ºä¸¤ä¸ªçº¿ç¨‹çš„æ—¶å€™å……åˆ†åˆ©ç”¨äº†CPUç­‰å¾…ç£ç›˜IOçš„ç©ºé—²æ—¶é—´ã€‚</p></li></ul><h4 id="2ã€CopyOnWriteArrayListçš„äº†è§£ã€‚"><a href="#2ã€CopyOnWriteArrayListçš„äº†è§£ã€‚" class="headerlink" title="2ã€CopyOnWriteArrayListçš„äº†è§£ã€‚"></a>2ã€CopyOnWriteArrayListçš„äº†è§£ã€‚</h4><h5 id="Copy-On-Write-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Copy-On-Write-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Copy-On-Write æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Copy-On-Write æ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>åœ¨è®¡ç®—æœºä¸­å°±æ˜¯å½“ä½ æƒ³è¦å¯¹ä¸€å—å†…å­˜è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬ä¸åœ¨åŸæœ‰å†…å­˜å—ä¸­è¿›è¡Œå†™æ“ä½œï¼Œè€Œæ˜¯å°†å†…å­˜æ‹·è´ä¸€ä»½ï¼Œåœ¨æ–°çš„å†…å­˜ä¸­è¿›è¡Œå†™æ“ä½œï¼Œå†™å®Œä¹‹åå‘¢ï¼Œå°±å°†æŒ‡å‘åŸæ¥å†…å­˜æŒ‡é’ˆæŒ‡å‘æ–°çš„å†…å­˜ï¼ŒåŸæ¥çš„å†…å­˜å°±å¯ä»¥è¢«å›æ”¶æ‰ã€‚</p><h5 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h5><p>CopyOnWriteArrayListè¿™æ˜¯ä¸€ä¸ªArrayListçš„çº¿ç¨‹å®‰å…¨çš„å˜ä½“ï¼ŒCopyOnWriteArrayList åº•å±‚å®ç°æ·»åŠ çš„åŸç†æ˜¯å…ˆcopyå‡ºä¸€ä¸ªå®¹å™¨(å¯ä»¥ç®€ç§°å‰¯æœ¬)ï¼Œå†å¾€æ–°çš„å®¹å™¨é‡Œæ·»åŠ è¿™ä¸ªæ–°çš„æ•°æ®ï¼Œæœ€åæŠŠæ–°çš„å®¹å™¨çš„å¼•ç”¨åœ°å€èµ‹å€¼ç»™äº†ä¹‹å‰é‚£ä¸ªæ—§çš„çš„å®¹å™¨åœ°å€ï¼Œä½†æ˜¯åœ¨æ·»åŠ è¿™ä¸ªæ•°æ®çš„æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœè¦å»è¯»å–æ•°æ®ï¼Œä»ç„¶æ˜¯è¯»å–åˆ°æ—§çš„å®¹å™¨é‡Œçš„æ•°æ®ã€‚</p><h5 id="ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="ä¼˜ç‚¹å’Œç¼ºç‚¹:"></a>ä¼˜ç‚¹å’Œç¼ºç‚¹:</h5><p>ä¼˜ç‚¹:</p><p>1.æ®ä¸€è‡´æ€§å®Œæ•´ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºåŠ é”äº†ï¼Œå¹¶å‘æ•°æ®ä¸ä¼šä¹±ã€‚</p><p>2.è§£å†³äº†åƒArrayListã€Vectorè¿™ç§é›†åˆå¤šçº¿ç¨‹éå†è¿­ä»£é—®é¢˜ï¼Œè®°ä½ï¼ŒVectorè™½ç„¶çº¿ç¨‹å®‰å…¨ï¼Œåªä¸è¿‡æ˜¯åŠ äº†synchronizedå…³é”®å­—ï¼Œè¿­ä»£é—®é¢˜å®Œå…¨æ²¡æœ‰è§£å†³ï¼</p><p>ç¼ºç‚¹:</p><p>1.å†…å­˜å æœ‰é—®é¢˜:å¾ˆæ˜æ˜¾ï¼Œä¸¤ä¸ªæ•°ç»„åŒæ—¶é©»æ‰åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœå®é™…åº”ç”¨ä¸­ï¼Œæ•°æ®æ¯”è¾ƒå¤šï¼Œè€Œä¸”æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå ç”¨å†…å­˜ä¼šæ¯”è¾ƒå¤§ï¼Œé’ˆå¯¹è¿™ä¸ªå…¶å®å¯ä»¥ç”¨ConcurrentHashMapæ¥ä»£æ›¿ã€‚</p><p>2.æ•°æ®ä¸€è‡´æ€§:CopyOnWriteå®¹å™¨åªèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚æ‰€ä»¥å¦‚æœä½ å¸Œæœ›å†™å…¥çš„çš„æ•°æ®ï¼Œé©¬ä¸Šèƒ½è¯»åˆ°ï¼Œè¯·ä¸è¦ä½¿ç”¨CopyOnWriteå®¹å™¨ã€‚</p><h5 id="ä½¿ç”¨åœºæ™¯ï¼š"><a href="#ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h5><p>1ã€è¯»å¤šå†™å°‘ï¼ˆç™½åå•ï¼Œé»‘åå•ï¼Œå•†å“ç±»ç›®çš„è®¿é—®å’Œæ›´æ–°åœºæ™¯ï¼‰ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†™çš„æ—¶å€™ä¼šå¤åˆ¶æ–°é›†åˆã€‚</p><p>2ã€é›†åˆä¸å¤§ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†™çš„æ—¶å€™ä¼šå¤åˆ¶æ–°é›†åˆã€‚</p><p>3ã€å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œä¸ºä»€ä¹ˆï¼Œå› ä¸ºæœ‰å¯èƒ½ä¼šè¯»å–åˆ°æ—§çš„é›†åˆæ•°æ®ã€‚</p><h4 id="3ã€ConcurrentHashMapåŠ é”æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œè¯¦ç»†è¯´ä¸€ä¸‹ï¼Ÿ"><a href="#3ã€ConcurrentHashMapåŠ é”æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œè¯¦ç»†è¯´ä¸€ä¸‹ï¼Ÿ" class="headerlink" title="3ã€ConcurrentHashMapåŠ é”æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œè¯¦ç»†è¯´ä¸€ä¸‹ï¼Ÿ"></a>3ã€ConcurrentHashMapåŠ é”æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œè¯¦ç»†è¯´ä¸€ä¸‹ï¼Ÿ</h4><h5 id="Java7-ConcurrentHashMap"><a href="#Java7-ConcurrentHashMap" class="headerlink" title="Java7 ConcurrentHashMap"></a>Java7 ConcurrentHashMap</h5><p>ConcurrentHashMapä½œä¸ºä¸€ç§çº¿ç¨‹å®‰å…¨ä¸”é«˜æ•ˆçš„å“ˆå¸Œè¡¨çš„è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶å…¶ä¸­çš„â€åˆ†æ®µé”â€çš„æ–¹æ¡ˆï¼Œç›¸æ¯”HashTableçš„è¡¨é”åœ¨æ€§èƒ½ä¸Šçš„æå‡éå¸¸ä¹‹å¤§ã€‚HashTableå®¹å™¨åœ¨ç«äº‰æ¿€çƒˆçš„å¹¶å‘ç¯å¢ƒä¸‹è¡¨ç°å‡ºæ•ˆç‡ä½ä¸‹çš„åŸå› ï¼Œæ˜¯å› ä¸ºæ‰€æœ‰è®¿é—®HashTableçš„çº¿ç¨‹éƒ½å¿…é¡»ç«äº‰åŒä¸€æŠŠé”ï¼Œé‚£å‡å¦‚å®¹å™¨é‡Œæœ‰å¤šæŠŠé”ï¼Œæ¯ä¸€æŠŠé”ç”¨äºé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé‚£ä¹ˆå½“å¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®æ—¶ï¼Œçº¿ç¨‹é—´å°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¹¶å‘è®¿é—®æ•ˆç‡ï¼Œè¿™å°±æ˜¯ConcurrentHashMapæ‰€ä½¿ç”¨çš„é”åˆ†æ®µæŠ€æœ¯ï¼Œé¦–å…ˆå°†æ•°æ®åˆ†æˆä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</p><p>ConcurrentHashMap æ˜¯ä¸€ä¸ª Segment æ•°ç»„ï¼ŒSegment é€šè¿‡ç»§æ‰¿ ReentrantLock æ¥è¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦åŠ é”çš„æ“ä½œé”ä½çš„æ˜¯ä¸€ä¸ª segmentï¼Œè¿™æ ·åªè¦ä¿è¯æ¯ä¸ª Segment æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±å®ç°äº†å…¨å±€çš„çº¿ç¨‹å®‰å…¨ã€‚</p><p>concurrencyLevelï¼šå¹¶è¡Œçº§åˆ«ã€å¹¶å‘æ•°ã€Segment æ•°ã€‚é»˜è®¤æ˜¯ 16ï¼Œä¹Ÿå°±æ˜¯è¯´ ConcurrentHashMap æœ‰ 16 ä¸ª Segmentsï¼Œæ‰€ä»¥ç†è®ºä¸Šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ€å¤šå¯ä»¥åŒæ—¶æ”¯æŒ 16 ä¸ªçº¿ç¨‹å¹¶å‘å†™ï¼Œåªè¦å®ƒä»¬çš„æ“ä½œåˆ†åˆ«åˆ†å¸ƒåœ¨ä¸åŒçš„ Segment ä¸Šã€‚è¿™ä¸ªå€¼å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®ä¸ºå…¶ä»–å€¼ï¼Œä½†æ˜¯ä¸€æ—¦åˆå§‹åŒ–ä»¥åï¼Œå®ƒæ˜¯ä¸å¯ä»¥æ‰©å®¹çš„ã€‚å…¶ä¸­çš„æ¯ä¸ª Segment å¾ˆåƒ HashMapï¼Œä¸è¿‡å®ƒè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥è¦éº»çƒ¦äº›ã€‚</p><p>åˆå§‹åŒ–æ§½: ensureSegment</p><p>ConcurrentHashMap åˆå§‹åŒ–çš„æ—¶å€™ä¼šåˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ§½ segment[0]ï¼Œå¯¹äºå…¶ä»–æ§½æ¥è¯´ï¼Œåœ¨æ’å…¥ç¬¬ä¸€ä¸ªå€¼çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ã€‚å¯¹äºå¹¶å‘æ“ä½œä½¿ç”¨ CAS è¿›è¡Œæ§åˆ¶ã€‚</p><h5 id="Java8-ConcurrentHashMap"><a href="#Java8-ConcurrentHashMap" class="headerlink" title="Java8 ConcurrentHashMap"></a>Java8 ConcurrentHashMap</h5><p>æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ç»“æ„ä¸Šå’Œ Java8 çš„ HashMapï¼ˆæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼‰ åŸºæœ¬ä¸Šä¸€æ ·ï¼Œä¸è¿‡å®ƒè¦ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œæ‰€ä»¥åœ¨æºç ä¸Šç¡®å®è¦å¤æ‚ä¸€äº›ã€‚1.8 åœ¨ 1.7 çš„æ•°æ®ç»“æ„ä¸Šåšäº†å¤§çš„æ”¹åŠ¨ï¼Œé‡‡ç”¨çº¢é»‘æ ‘ä¹‹åå¯ä»¥ä¿è¯æŸ¥è¯¢æ•ˆç‡ï¼ˆO(logn)ï¼‰ï¼Œç”šè‡³å–æ¶ˆäº† ReentrantLock æ”¹ä¸ºäº† synchronizedï¼Œè¿™æ ·å¯ä»¥çœ‹å‡ºåœ¨æ–°ç‰ˆçš„ JDK ä¸­å¯¹ synchronized ä¼˜åŒ–æ˜¯å¾ˆåˆ°ä½çš„ã€‚</p><h4 id="4ã€çº¿ç¨‹æ­»é”çš„4ä¸ªæ¡ä»¶ï¼Ÿ"><a href="#4ã€çº¿ç¨‹æ­»é”çš„4ä¸ªæ¡ä»¶ï¼Ÿ" class="headerlink" title="4ã€çº¿ç¨‹æ­»é”çš„4ä¸ªæ¡ä»¶ï¼Ÿ"></a>4ã€çº¿ç¨‹æ­»é”çš„4ä¸ªæ¡ä»¶ï¼Ÿ</h4><p>æ­»é”æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Œå¦‚ä½•é¿å…æ­»é”ï¼Ÿ</p><p>å½“çº¿ç¨‹AæŒæœ‰ç‹¬å é”aï¼Œå¹¶å°è¯•å»è·å–ç‹¬å é”bçš„åŒæ—¶ï¼Œçº¿ç¨‹BæŒæœ‰ç‹¬å é”bï¼Œå¹¶å°è¯•è·å–ç‹¬å é”açš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå‘ç”ŸABä¸¤ä¸ªçº¿ç¨‹ç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œå‘ç”Ÿçš„é˜»å¡ç°è±¡ï¼Œæˆ‘ä»¬ç§°ä¸ºæ­»é”ã€‚</p><pre><code>public class DeadLockDemo &#123;    public static void main(String[] args) &#123;        // çº¿ç¨‹a        Thread td1 = new Thread(new Runnable() &#123;            public void run() &#123;                DeadLockDemo.method1();            &#125;        &#125;);        // çº¿ç¨‹b        Thread td2 = new Thread(new Runnable() &#123;            public void run() &#123;                DeadLockDemo.method2();            &#125;        &#125;);        td1.start();        td2.start();    &#125;    public static void method1() &#123;        synchronized (String.class) &#123;            try &#123;                Thread.sleep(2000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;            System.out.println(&quot;çº¿ç¨‹aå°è¯•è·å–integer.class&quot;);            synchronized (Integer.class) &#123;            &#125;        &#125;    &#125;    public static void method2() &#123;        synchronized (Integer.class) &#123;            try &#123;                Thread.sleep(2000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;            System.out.println(&quot;çº¿ç¨‹bå°è¯•è·å–String.class&quot;);            synchronized (String.class) &#123;            &#125;        &#125;    &#125;&#125;</code></pre><p>é€ æˆæ­»é”çš„å››ä¸ªæ¡ä»¶ï¼š</p><ul><li>äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚</li><li>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªçº¿ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶ï¼šçº¿ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²çº¿ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li></ul><p>åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œé¿å…äº†é€»è¾‘ä¸­å‡ºç°æ•°ä¸ªçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹æ–¹çº¿ç¨‹æ‰€éœ€è¦çš„ç‹¬å é”çš„çš„æƒ…å†µï¼Œå°±å¯ä»¥é¿å…æ­»é”ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public class BreakDeadLockDemo &#123;    public static void main(String[] args) &#123;        // çº¿ç¨‹a        Thread td1 = new Thread(new Runnable() &#123;            public void run() &#123;                DeadLockDemo2.method1();            &#125;        &#125;);        // çº¿ç¨‹b        Thread td2 = new Thread(new Runnable() &#123;            public void run() &#123;                DeadLockDemo2.method2();            &#125;        &#125;);        td1.start();        td2.start();    &#125;    public static void method1() &#123;        synchronized (String.class) &#123;            try &#123;                Thread.sleep(2000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;            System.out.println(&quot;çº¿ç¨‹aå°è¯•è·å–integer.class&quot;);            synchronized (Integer.class) &#123;                System.out.println(&quot;çº¿ç¨‹aè·å–åˆ°integer.class&quot;);            &#125;        &#125;    &#125;    public static void method2() &#123;        // ä¸å†è·å–çº¿ç¨‹aéœ€è¦çš„Integer.classé”ã€‚        synchronized (String.class) &#123;            try &#123;                Thread.sleep(2000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;            System.out.println(&quot;çº¿ç¨‹bå°è¯•è·å–Integer.class&quot;);            synchronized (Integer.class) &#123;                System.out.println(&quot;çº¿ç¨‹bè·å–åˆ°Integer.class&quot;);            &#125;        &#125;    &#125;&#125;</code></pre><h4 id="5ã€CASä»‹ç»ï¼Ÿ"><a href="#5ã€CASä»‹ç»ï¼Ÿ" class="headerlink" title="5ã€CASä»‹ç»ï¼Ÿ"></a>5ã€CASä»‹ç»ï¼Ÿ</h4><h5 id="Unsafe"><a href="#Unsafe" class="headerlink" title="Unsafe"></a>Unsafe</h5><p>Unsafeæ˜¯CASçš„æ ¸å¿ƒç±»ã€‚å› ä¸ºJavaæ— æ³•ç›´æ¥è®¿é—®åº•å±‚æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯é€šè¿‡æœ¬åœ°ï¼ˆnativeï¼‰æ–¹æ³•æ¥è®¿é—®ã€‚ä¸è¿‡å°½ç®¡å¦‚æ­¤ï¼ŒJVMè¿˜æ˜¯å¼€äº†ä¸€ä¸ªåé—¨ï¼ŒJDKä¸­æœ‰ä¸€ä¸ªç±»Unsafeï¼Œå®ƒæä¾›äº†ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œã€‚</p><h5 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h5><p>CASï¼ŒCompare and Swapå³æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œè®¾è®¡å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ï¼Œjava.util.concurrentåŒ…å…¨å®Œå»ºç«‹åœ¨CASä¹‹ä¸Šï¼Œæ²¡æœ‰CASä¹Ÿå°±æ²¡æœ‰æ­¤åŒ…ï¼Œå¯è§CASçš„é‡è¦æ€§ã€‚å½“å‰çš„å¤„ç†å™¨åŸºæœ¬éƒ½æ”¯æŒCASï¼Œåªä¸è¿‡ä¸åŒçš„å‚å®¶çš„å®ç°ä¸ä¸€æ ·ç½¢äº†ã€‚å¹¶ä¸”CASä¹Ÿæ˜¯é€šè¿‡Unsafeå®ç°çš„ï¼Œç”±äºCASéƒ½æ˜¯ç¡¬ä»¶çº§åˆ«çš„æ“ä½œï¼Œå› æ­¤æ•ˆç‡ä¼šæ¯”æ™®é€šåŠ é”é«˜ä¸€äº›ã€‚</p><h5 id="CASçš„ç¼ºç‚¹"><a href="#CASçš„ç¼ºç‚¹" class="headerlink" title="CASçš„ç¼ºç‚¹"></a>CASçš„ç¼ºç‚¹</h5><p>CASçœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†è¿™ç§æ“ä½œæ˜¾ç„¶æ— æ³•æ¶µç›–å¹¶å‘ä¸‹çš„æ‰€æœ‰åœºæ™¯ï¼Œå¹¶ä¸”CASä»è¯­ä¹‰ä¸Šæ¥è¯´ä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªé€»è¾‘æ¼æ´ï¼šå¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aå€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¦‚æœåœ¨è¿™æ®µæœŸé—´å®ƒçš„å€¼æ›¾ç»è¢«æ”¹æˆäº†Bï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªæ¼æ´ç§°ä¸ºCASæ“ä½œçš„â€ABAâ€é—®é¢˜ã€‚java.util.concurrentåŒ…ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»â€AtomicStampedReferenceâ€ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯CASçš„æ­£ç¡®æ€§ã€‚ä¸è¿‡ç›®å‰æ¥è¯´è¿™ä¸ªç±»æ¯”è¾ƒâ€é¸¡è‚‹â€ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ABAé—®é¢˜å¹¶ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ABAé—®é¢˜ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½å›é¿åŸå­ç±»æ›´åŠ é«˜æ•ˆã€‚</p><h4 id="6ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#6ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="6ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a>6ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</h4><p>ç®€è€Œè¨€ä¹‹,ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹,ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</p><ul><li><p>1ã€çº¿ç¨‹çš„åˆ’åˆ†å°ºåº¦å°äºè¿›ç¨‹ï¼Œä½¿å¾—å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘æ€§é«˜ã€‚</p></li><li><p>2ã€è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒï¼Œè€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ï¼Œä»è€Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p></li><li><p>3ã€çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¿›ç¨‹è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚æ¯ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºçš„å‡ºå£ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ã€‚</p></li><li><p>4ã€ä»é€»è¾‘è§’åº¦æ¥çœ‹ï¼Œå¤šçº¿ç¨‹çš„æ„ä¹‰åœ¨äºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰å¤šä¸ªæ‰§è¡Œéƒ¨åˆ†å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚ä½†æ“ä½œç³»ç»Ÿå¹¶æ²¡æœ‰å°†å¤šä¸ªçº¿ç¨‹çœ‹åšå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œæ¥å®ç°è¿›ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ä»¥åŠèµ„æºåˆ†é…ã€‚è¿™å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹çš„é‡è¦åŒºåˆ«ã€‚</p></li><li><p>5ã€è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨,è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“,æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½,å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½.çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº,åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ),ä½†æ˜¯å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çš„çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºã€‚</p></li><li><p>6ã€ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹;åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</p></li><li><p>7ã€è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œè€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„ã€‚çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ï¼Œæ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®ï¼Œä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œè€—è´¹èµ„æºè¾ƒå¤§ï¼Œæ•ˆç‡è¦å·®ä¸€äº›ã€‚</p></li></ul><h4 id="7ã€ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ"><a href="#7ã€ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ" class="headerlink" title="7ã€ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ"></a>7ã€ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ</h4><p>çº¿ç¨‹çš„é˜»å¡</p><p>ä¸ºäº†è§£å†³å¯¹å…±äº«å­˜å‚¨åŒºçš„è®¿é—®å†²çªï¼ŒJava å¼•å…¥äº†åŒæ­¥æœºåˆ¶ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥è€ƒå¯Ÿå¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œæ˜¾ç„¶åŒæ­¥æœºåˆ¶å·²ç»ä¸å¤Ÿäº†ï¼Œå› ä¸ºåœ¨ä»»æ„æ—¶åˆ»æ‰€è¦æ±‚çš„èµ„æºä¸ä¸€å®šå·²ç»å‡†å¤‡å¥½äº†è¢«è®¿é—®ï¼Œåè¿‡æ¥ï¼ŒåŒä¸€æ—¶åˆ»å‡†å¤‡å¥½äº†çš„èµ„æºä¹Ÿå¯èƒ½ä¸æ­¢ä¸€ä¸ªã€‚ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µä¸‹çš„è®¿é—®æ§åˆ¶é—®é¢˜ï¼ŒJava å¼•å…¥äº†å¯¹é˜»å¡æœºåˆ¶çš„æ”¯æŒ.</p><p>é˜»å¡æŒ‡çš„æ˜¯æš‚åœä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä»¥ç­‰å¾…æŸä¸ªæ¡ä»¶å‘ç”Ÿï¼ˆå¦‚æŸèµ„æºå°±ç»ªï¼‰ï¼Œå­¦è¿‡æ“ä½œç³»ç»Ÿçš„åŒå­¦å¯¹å®ƒä¸€å®šå·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚Java æä¾›äº†å¤§é‡æ–¹æ³•æ¥æ”¯æŒé˜»å¡ï¼Œä¸‹é¢è®©æˆ‘ä»¬é€ä¸€åˆ†æã€‚</p><p>sleep() æ–¹æ³•ï¼šsleep() å…è®¸ æŒ‡å®šä»¥æ¯«ç§’ä¸ºå•ä½çš„ä¸€æ®µæ—¶é—´ä½œä¸ºå‚æ•°ï¼Œå®ƒä½¿å¾—çº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸èƒ½å¾—åˆ°CPU æ—¶é—´ï¼ŒæŒ‡å®šçš„æ—¶é—´ä¸€è¿‡ï¼Œçº¿ç¨‹é‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚ å…¸å‹åœ°ï¼Œsleep() è¢«ç”¨åœ¨ç­‰å¾…æŸä¸ªèµ„æºå°±ç»ªçš„æƒ…å½¢ï¼šæµ‹è¯•å‘ç°æ¡ä»¶ä¸æ»¡è¶³åï¼Œè®©çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´åé‡æ–°æµ‹è¯•ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³ä¸ºæ­¢ã€‚</p><p>suspend() å’Œ resume() æ–¹æ³•ï¼šä¸¤ä¸ªæ–¹æ³•é…å¥—ä½¿ç”¨ï¼Œsuspend()ä½¿å¾—çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”ä¸ä¼šè‡ªåŠ¨æ¢å¤ï¼Œå¿…é¡»å…¶å¯¹åº”çš„resume() è¢«è°ƒç”¨ï¼Œæ‰èƒ½ä½¿å¾—çº¿ç¨‹é‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚å…¸å‹åœ°ï¼Œsuspend() å’Œ resume() è¢«ç”¨åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿçš„ç»“æœçš„æƒ…å½¢ï¼šæµ‹è¯•å‘ç°ç»“æœè¿˜æ²¡æœ‰äº§ç”Ÿåï¼Œè®©çº¿ç¨‹é˜»å¡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿäº†ç»“æœåï¼Œè°ƒç”¨ resume() ä½¿å…¶æ¢å¤ã€‚</p><p>yield() æ–¹æ³•ï¼šyield() ä½¿å¾—çº¿ç¨‹æ”¾å¼ƒå½“å‰åˆ†å¾—çš„ CPU æ—¶é—´ï¼Œä½†æ˜¯ä¸ä½¿çº¿ç¨‹é˜»å¡ï¼Œå³çº¿ç¨‹ä»å¤„äºå¯æ‰§è¡ŒçŠ¶æ€ï¼Œéšæ—¶å¯èƒ½å†æ¬¡åˆ†å¾— CPU æ—¶é—´ã€‚è°ƒç”¨ yield() çš„æ•ˆæœç­‰ä»·äºè°ƒåº¦ç¨‹åºè®¤ä¸ºè¯¥çº¿ç¨‹å·²æ‰§è¡Œäº†è¶³å¤Ÿçš„æ—¶é—´ä»è€Œè½¬åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p><p>wait() å’Œ notify() æ–¹æ³•ï¼šä¸¤ä¸ªæ–¹æ³•é…å¥—ä½¿ç”¨ï¼Œwait() ä½¿å¾—çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå®ƒæœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§å…è®¸æŒ‡å®šä»¥æ¯«ç§’ä¸ºå•ä½çš„ä¸€æ®µæ—¶é—´ä½œä¸ºå‚æ•°ï¼Œå¦ä¸€ç§æ²¡æœ‰å‚æ•°ï¼Œå‰è€…å½“å¯¹åº”çš„ notify() è¢«è°ƒç”¨æˆ–è€…è¶…å‡ºæŒ‡å®šæ—¶é—´æ—¶çº¿ç¨‹é‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ï¼Œåè€…åˆ™å¿…é¡»å¯¹åº”çš„ notify() è¢«è°ƒç”¨ã€‚åˆçœ‹èµ·æ¥å®ƒä»¬ä¸ suspend() å’Œ resume() æ–¹æ³•å¯¹æ²¡æœ‰ä»€ä¹ˆåˆ†åˆ«ï¼Œä½†æ˜¯äº‹å®ä¸Šå®ƒä»¬æ˜¯æˆªç„¶ä¸åŒçš„ã€‚åŒºåˆ«çš„æ ¸å¿ƒåœ¨äºï¼Œå‰é¢å™è¿°çš„æ‰€æœ‰æ–¹æ³•ï¼Œé˜»å¡æ—¶éƒ½ä¸ä¼šé‡Šæ”¾å ç”¨çš„é”ï¼ˆå¦‚æœå ç”¨äº†çš„è¯ï¼‰ï¼Œè€Œè¿™ä¸€å¯¹æ–¹æ³•åˆ™ç›¸åã€‚</p><p>ä¸Šè¿°çš„æ ¸å¿ƒåŒºåˆ«å¯¼è‡´äº†ä¸€ç³»åˆ—çš„ç»†èŠ‚ä¸Šçš„åŒºåˆ«ã€‚</p><p>é¦–å…ˆï¼Œå‰é¢å™è¿°çš„æ‰€æœ‰æ–¹æ³•éƒ½éš¶å±äº Thread ç±»ï¼Œä½†æ˜¯è¿™ä¸€å¯¹å´ç›´æ¥éš¶å±äº Object ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ‹¥æœ‰è¿™ä¸€å¯¹æ–¹æ³•ã€‚åˆçœ‹èµ·æ¥è¿™ååˆ†ä¸å¯æ€è®®ï¼Œä½†æ˜¯å®é™…ä¸Šå´æ˜¯å¾ˆè‡ªç„¶çš„ï¼Œå› ä¸ºè¿™ä¸€å¯¹æ–¹æ³•é˜»å¡æ—¶è¦é‡Šæ”¾å ç”¨çš„é”ï¼Œè€Œé”æ˜¯ä»»ä½•å¯¹è±¡éƒ½å…·æœ‰çš„ï¼Œè°ƒç”¨ä»»æ„å¯¹è±¡çš„ wait() æ–¹æ³•å¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡ä¸Šçš„é”è¢«é‡Šæ”¾ã€‚è€Œè°ƒç”¨ ä»»æ„å¯¹è±¡çš„notify()æ–¹æ³•åˆ™å¯¼è‡´å› è°ƒç”¨è¯¥å¯¹è±¡çš„ wait() æ–¹æ³•è€Œé˜»å¡çš„çº¿ç¨‹ä¸­éšæœºé€‰æ‹©çš„ä¸€ä¸ªè§£é™¤é˜»å¡ï¼ˆä½†è¦ç­‰åˆ°è·å¾—é”åæ‰çœŸæ­£å¯æ‰§è¡Œï¼‰ã€‚</p><p>å…¶æ¬¡ï¼Œå‰é¢å™è¿°çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯åœ¨ä»»ä½•ä½ç½®è°ƒç”¨ï¼Œä½†æ˜¯è¿™ä¸€å¯¹æ–¹æ³•å´å¿…é¡»åœ¨ synchronized æ–¹æ³•æˆ–å—ä¸­è°ƒç”¨ï¼Œç†ç”±ä¹Ÿå¾ˆç®€å•ï¼Œåªæœ‰åœ¨synchronized æ–¹æ³•æˆ–å—ä¸­å½“å‰çº¿ç¨‹æ‰å æœ‰é”ï¼Œæ‰æœ‰é”å¯ä»¥é‡Šæ”¾ã€‚åŒæ ·çš„é“ç†ï¼Œè°ƒç”¨è¿™ä¸€å¯¹æ–¹æ³•çš„å¯¹è±¡ä¸Šçš„é”å¿…é¡»ä¸ºå½“å‰çº¿ç¨‹æ‰€æ‹¥æœ‰ï¼Œè¿™æ ·æ‰æœ‰é”å¯ä»¥é‡Šæ”¾ã€‚å› æ­¤ï¼Œè¿™ä¸€å¯¹æ–¹æ³•è°ƒç”¨å¿…é¡»æ”¾ç½®åœ¨è¿™æ ·çš„ synchronized æ–¹æ³•æˆ–å—ä¸­ï¼Œè¯¥æ–¹æ³•æˆ–å—çš„ä¸Šé”å¯¹è±¡å°±æ˜¯è°ƒç”¨è¿™ä¸€å¯¹æ–¹æ³•çš„å¯¹è±¡ã€‚è‹¥ä¸æ»¡è¶³è¿™ä¸€æ¡ä»¶ï¼Œåˆ™ç¨‹åºè™½ç„¶ä»èƒ½ç¼–è¯‘ï¼Œä½†åœ¨è¿è¡Œæ—¶ä¼šå‡ºç°IllegalMonitorStateException å¼‚å¸¸ã€‚</p><p>wait() å’Œ notify() æ–¹æ³•çš„ä¸Šè¿°ç‰¹æ€§å†³å®šäº†å®ƒä»¬ç»å¸¸å’Œsynchronized æ–¹æ³•æˆ–å—ä¸€èµ·ä½¿ç”¨ï¼Œå°†å®ƒä»¬å’Œæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ä½œä¸€ä¸ªæ¯”è¾ƒå°±ä¼šå‘ç°å®ƒä»¬çš„ç›¸ä¼¼æ€§ï¼šsynchronizedæ–¹æ³•æˆ–å—æä¾›äº†ç±»ä¼¼äºæ“ä½œç³»ç»ŸåŸè¯­çš„åŠŸèƒ½ï¼Œå®ƒä»¬çš„æ‰§è¡Œä¸ä¼šå—åˆ°å¤šçº¿ç¨‹æœºåˆ¶çš„å¹²æ‰°ï¼Œè€Œè¿™ä¸€å¯¹æ–¹æ³•åˆ™ç›¸å½“äº block å’Œwakeup åŸè¯­ï¼ˆè¿™ä¸€å¯¹æ–¹æ³•å‡å£°æ˜ä¸º synchronizedï¼‰ã€‚å®ƒä»¬çš„ç»“åˆä½¿å¾—æˆ‘ä»¬å¯ä»¥å®ç°æ“ä½œç³»ç»Ÿä¸Šä¸€ç³»åˆ—ç²¾å¦™çš„è¿›ç¨‹é—´é€šä¿¡çš„ç®—æ³•ï¼ˆå¦‚ä¿¡å·é‡ç®—æ³•ï¼‰ï¼Œå¹¶ç”¨äºè§£å†³å„ç§å¤æ‚çš„çº¿ç¨‹é—´é€šä¿¡é—®é¢˜ã€‚ï¼ˆæ­¤å¤–ï¼Œçº¿ç¨‹é—´é€šä¿¡çš„æ–¹å¼è¿˜æœ‰å¤šä¸ªçº¿ç¨‹é€šè¿‡synchronizedå…³é”®å­—è¿™ç§æ–¹å¼æ¥å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€whileè½®è¯¢ã€ä½¿ç”¨java.io.PipedInputStream å’Œ java.io.PipedOutputStreamè¿›è¡Œé€šä¿¡çš„ç®¡é“é€šä¿¡ï¼‰ã€‚</p><p>å…³äº wait() å’Œ notify() æ–¹æ³•æœ€åå†è¯´æ˜ä¸¤ç‚¹ï¼š</p><p>ç¬¬ä¸€ï¼šè°ƒç”¨ notify() æ–¹æ³•å¯¼è‡´è§£é™¤é˜»å¡çš„çº¿ç¨‹æ˜¯ä»è°ƒç”¨è¯¥å¯¹è±¡çš„ wait() æ–¹æ³•è€Œé˜»å¡çš„çº¿ç¨‹ä¸­éšæœºé€‰å–çš„ï¼Œæˆ‘ä»¬æ— æ³•é¢„æ–™å“ªä¸€ä¸ªçº¿ç¨‹å°†ä¼šè¢«é€‰æ‹©ï¼Œæ‰€ä»¥ç¼–ç¨‹æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œé¿å…å› è¿™ç§ä¸ç¡®å®šæ€§è€Œäº§ç”Ÿé—®é¢˜ã€‚</p><p>ç¬¬äºŒï¼šé™¤äº† notify()ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³• notifyAll() ä¹Ÿå¯èµ·åˆ°ç±»ä¼¼ä½œç”¨ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œè°ƒç”¨ notifyAll() æ–¹æ³•å°†æŠŠå› è°ƒç”¨è¯¥å¯¹è±¡çš„ wait() æ–¹æ³•è€Œé˜»å¡çš„æ‰€æœ‰çº¿ç¨‹ä¸€æ¬¡æ€§å…¨éƒ¨è§£é™¤é˜»å¡ã€‚å½“ç„¶ï¼Œåªæœ‰è·å¾—é”çš„é‚£ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚</p><p>è°ˆåˆ°é˜»å¡ï¼Œå°±ä¸èƒ½ä¸è°ˆä¸€è°ˆæ­»é”ï¼Œç•¥ä¸€åˆ†æå°±èƒ½å‘ç°ï¼Œsuspend() æ–¹æ³•å’Œä¸æŒ‡å®šè¶…æ—¶æœŸé™çš„ wait() æ–¹æ³•çš„è°ƒç”¨éƒ½å¯èƒ½äº§ç”Ÿæ­»é”ã€‚é—æ†¾çš„æ˜¯ï¼ŒJava å¹¶ä¸åœ¨è¯­è¨€çº§åˆ«ä¸Šæ”¯æŒæ­»é”çš„é¿å…ï¼Œæˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­å¿…é¡»å°å¿ƒåœ°é¿å…æ­»é”ã€‚</p><p>ä»¥ä¸Šæˆ‘ä»¬å¯¹ Java ä¸­å®ç°çº¿ç¨‹é˜»å¡çš„å„ç§æ–¹æ³•ä½œäº†ä¸€ç•ªåˆ†æï¼Œæˆ‘ä»¬é‡ç‚¹åˆ†æäº† wait() å’Œ notify() æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬çš„åŠŸèƒ½æœ€å¼ºå¤§ï¼Œä½¿ç”¨ä¹Ÿæœ€çµæ´»ï¼Œä½†æ˜¯è¿™ä¹Ÿå¯¼è‡´äº†å®ƒä»¬çš„æ•ˆç‡è¾ƒä½ï¼Œè¾ƒå®¹æ˜“å‡ºé”™ã€‚å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬åº”è¯¥çµæ´»ä½¿ç”¨å„ç§æ–¹æ³•ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚</p><h4 id="8ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#8ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="8ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>8ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h4><p>çº¿ç¨‹çŠ¶æ€æµç¨‹å›¾</p><p><img src="https://github.com/guoxiaoxing/android-open-source-project-analysis/raw/master/art/native/process/java_thread_state.png" alt="image"></p><ul><li>NEWï¼šåˆ›å»ºçŠ¶æ€ï¼Œçº¿ç¨‹åˆ›å»ºä¹‹åï¼Œä½†æ˜¯è¿˜æœªå¯åŠ¨ã€‚</li><li>RUNNABLEï¼šè¿è¡ŒçŠ¶æ€ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹ï¼Œä½†æœ‰å¯èƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¾‹å¦‚ç­‰å¾…CPUã€IOç­‰ã€‚</li><li>WAITINGï¼šç­‰å¾…çŠ¶æ€ï¼Œä¸€èˆ¬æ˜¯è°ƒç”¨äº†wait()ã€join()ã€LockSupport.spark()ç­‰æ–¹æ³•ã€‚</li><li>TIMED_WAITINGï¼šè¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯å¸¦æ—¶é—´çš„ç­‰å¾…çŠ¶æ€ã€‚ä¸€èˆ¬æ˜¯è°ƒç”¨äº†wait(time)ã€join(time)ã€LockSupport.sparkNanos()ã€LockSupport.sparkUnit()ç­‰æ–¹æ³•ã€‚</li><li>BLOCKEDï¼šé˜»å¡çŠ¶æ€ï¼Œç­‰å¾…é”çš„é‡Šæ”¾ï¼Œä¾‹å¦‚è°ƒç”¨äº†synchronizedå¢åŠ äº†é”ã€‚</li><li>TERMINATEDï¼šç»ˆæ­¢çŠ¶æ€ï¼Œä¸€èˆ¬æ˜¯çº¿ç¨‹å®Œæˆä»»åŠ¡åé€€å‡ºæˆ–è€…å¼‚å¸¸ç»ˆæ­¢ã€‚</li></ul><p>NEWã€WAITINGã€TIMED_WAITINGéƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œæˆ‘ä»¬é‡ç‚¹è¯´ä¸€è¯´RUNNABLEè¿è¡Œæ€å’ŒBLOCKEDé˜»å¡æ€ã€‚</p><p>çº¿ç¨‹è¿›å…¥RUNNABLEè¿è¡Œæ€ä¸€èˆ¬åˆ†ä¸ºäº”ç§æƒ…å†µï¼š</p><ul><li>çº¿ç¨‹è°ƒç”¨sleep(time)åç»“æŸäº†ä¼‘çœ æ—¶é—´</li><li>çº¿ç¨‹è°ƒç”¨çš„é˜»å¡IOå·²ç»è¿”å›ï¼Œé˜»å¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•</li><li>çº¿ç¨‹æˆåŠŸçš„è·å–äº†èµ„æºé”</li><li>çº¿ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªé€šçŸ¥ï¼ŒæˆåŠŸçš„è·å¾—äº†å…¶ä»–çº¿ç¨‹å‘å‡ºçš„é€šçŸ¥</li><li>çº¿ç¨‹å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œç„¶åè°ƒç”¨äº†resume()æ¢å¤æ–¹æ³•ï¼Œè§£é™¤äº†æŒ‚èµ·ã€‚</li></ul><p>çº¿ç¨‹è¿›å…¥BLOCKEDé˜»å¡æ€ä¸€èˆ¬ä¹Ÿåˆ†ä¸ºäº”ç§æƒ…å†µï¼š</p><ul><li>çº¿ç¨‹è°ƒç”¨sleep()æ–¹æ³•ä¸»åŠ¨æ”¾å¼ƒå æœ‰çš„èµ„æº</li><li>çº¿ç¨‹è°ƒç”¨äº†é˜»å¡å¼IOçš„æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•è¿”å›å‰ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ã€‚</li><li>çº¿ç¨‹è§†å›¾è·å¾—ä¸€ä¸ªèµ„æºé”ï¼Œä½†æ˜¯è¯¥èµ„æºé”æ­£è¢«å…¶ä»–çº¿ç¨‹é”æŒæœ‰ã€‚</li><li>çº¿ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªé€šçŸ¥</li><li>çº¿ç¨‹è°ƒåº¦å™¨è°ƒç”¨suspend()æ–¹æ³•å°†è¯¥çº¿ç¨‹æŒ‚èµ·</li></ul><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å’Œçº¿ç¨‹çŠ¶æ€ç›¸å…³çš„ä¸€äº›æ–¹æ³•ã€‚</p><ul><li><p>sleep()æ–¹æ³•è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´å†…æš‚åœæ‰§è¡Œï¼Œæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯ä»¥é€šè¿‡Thread.currentThread()æ–¹æ³•è·å–ã€‚</p></li><li><p>yield()æ–¹æ³•æ”¾å¼ƒçº¿ç¨‹æŒæœ‰çš„CPUèµ„æºï¼Œå°†å…¶è®©ç»™å…¶ä»–ä»»åŠ¡å»å ç”¨CPUæ‰§è¡Œæ—¶é—´ã€‚ä½†æ”¾å¼ƒçš„æ—¶é—´ä¸ç¡®å®šï¼Œæœ‰å¯èƒ½åˆšåˆšæ”¾å¼ƒï¼Œé©¬ä¸Šåˆè·å¾—CPUæ—¶é—´ç‰‡ã€‚</p></li><li><p>wait()æ–¹æ³•æ˜¯å½“å‰æ‰§è¡Œä»£ç çš„çº¿ç¨‹è¿›è¡Œç­‰å¾…ï¼Œå°†å½“å‰çº¿ç¨‹æ”¾å…¥é¢„æ‰§è¡Œé˜Ÿåˆ—ï¼Œå¹¶åœ¨wait()æ‰€åœ¨çš„ä»£ç å¤„åœæ­¢æ‰§è¡Œï¼Œç›´åˆ°æ¥åˆ°é€šçŸ¥æˆ–è€…è¢«ä¸­æ–­ä¸ºæ­¢ã€‚è¯¥æ–¹æ³•å¯ä»¥ä½¿å¾—è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹é‡Šæ”¾å…±äº«èµ„æºçš„é”ï¼Œ ç„¶åä»è¿è¡ŒçŠ¶æ€é€€å‡ºï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°å†æ¬¡è¢«å”¤é†’ã€‚è¯¥æ–¹æ³•åªèƒ½åœ¨åŒæ­¥ä»£ç å—é‡Œè°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸ã€‚wait(long millis)æ–¹æ³•ç­‰å¾…æŸä¸€æ®µæ—¶é—´å†…æ˜¯å¦æœ‰çº¿ç¨‹å¯¹é”è¿›è¡Œå”¤é†’ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´åˆ™è‡ªåŠ¨å”¤é†’ã€‚</p></li><li><p>notify()æ–¹æ³•ç”¨æ¥é€šçŸ¥é‚£äº›å¯èƒ½ç­‰å¾…è¯¥å¯¹è±¡çš„å¯¹è±¡é”çš„å…¶ä»–çº¿ç¨‹ï¼Œè¯¥æ–¹æ³•å¯ä»¥éšæœºå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰åŒä¸€å…±äº«èµ„æºçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä½¿è¯¥çº¿ç¨‹é€€å‡ºç­‰å¾…é˜Ÿåˆ—ï¼Œè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚</p></li><li><p>notifyAll()æ–¹æ³•å¯ä»¥ä½¿æ‰€æœ‰æ­£åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…åŒä¸€å…±äº«èµ„æºçš„å…¨éƒ¨çº¿ç¨‹ä»ç­‰å¾…çŠ¶æ€é€€å‡ºï¼Œè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ï¼Œä¸€èˆ¬ä¼šæ˜¯ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹å…ˆæ‰§è¡Œï¼Œä½†æ˜¯æ ¹æ®è™šæ‹Ÿæœºçš„å®ç°ä¸åŒï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯éšæœºæ‰§è¡Œã€‚</p></li><li><p>join()æ–¹æ³•å¯ä»¥è®©è°ƒç”¨å®ƒçš„çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæˆåï¼Œå†å»æ‰§è¡Œè¯¥çº¿ç¨‹åé¢çš„ä»£ç ï¼Œå®ƒå…·æœ‰è®©çº¿ç¨‹æ’é˜Ÿçš„ä½œç”¨ã€‚</p></li></ul><h4 id="9ã€ä¹è§‚é”ä¸æ‚²è§‚é”ã€‚"><a href="#9ã€ä¹è§‚é”ä¸æ‚²è§‚é”ã€‚" class="headerlink" title="9ã€ä¹è§‚é”ä¸æ‚²è§‚é”ã€‚"></a>9ã€<a href="https://juejin.im/post/5b4977ae5188251b146b2fc8">ä¹è§‚é”ä¸æ‚²è§‚é”</a>ã€‚</h4><h5 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h5><p>æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><h5 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h5><p>æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚</p><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><p>ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰ï¼Œè€Œä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</p><h5 id="ä¹è§‚é”å¸¸è§çš„ä¸¤ç§å®ç°æ–¹å¼"><a href="#ä¹è§‚é”å¸¸è§çš„ä¸¤ç§å®ç°æ–¹å¼" class="headerlink" title="ä¹è§‚é”å¸¸è§çš„ä¸¤ç§å®ç°æ–¹å¼"></a>ä¹è§‚é”å¸¸è§çš„ä¸¤ç§å®ç°æ–¹å¼</h5><p>1ã€ç‰ˆæœ¬å·æœºåˆ¶</p><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šåŠ 1ã€‚å½“çº¿ç¨‹Aè¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„versionå€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><p>2ã€CASç®—æ³•</p><p>å³compare and swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æœ‰åçš„æ— é”ç®—æ³•ã€‚CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚ ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå³ä¸æ–­çš„é‡è¯•ã€‚</p><h5 id="ä¹è§‚é”çš„ç¼ºç‚¹"><a href="#ä¹è§‚é”çš„ç¼ºç‚¹" class="headerlink" title="ä¹è§‚é”çš„ç¼ºç‚¹"></a>ä¹è§‚é”çš„ç¼ºç‚¹</h5><p>1ã€ABA é—®é¢˜</p><p>å¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aå€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºCASæ“ä½œçš„ â€œABAâ€é—®é¢˜ã€‚</p><p>JDK 1.5 ä»¥åçš„ AtomicStampedReference ç±»ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä¸­çš„ compareAndSet æ–¹æ³•å°±æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</p><p>2ã€è‡ªæ—‹CASï¼ˆä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸï¼‰å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p><p>3ã€CAS åªå¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆï¼Œå½“æ“ä½œæ¶‰åŠè·¨å¤šä¸ªå…±äº«å˜é‡æ—¶ CAS æ— æ•ˆã€‚ä½†æ˜¯ä» JDK 1.5å¼€å§‹ï¼Œæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œ.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æˆ–è€…åˆ©ç”¨AtomicReferenceç±»æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚</p><h4 id="10ã€run-å’Œstart-æ–¹æ³•åŒºåˆ«ï¼Ÿ"><a href="#10ã€run-å’Œstart-æ–¹æ³•åŒºåˆ«ï¼Ÿ" class="headerlink" title="10ã€run()å’Œstart()æ–¹æ³•åŒºåˆ«ï¼Ÿ"></a>10ã€run()å’Œstart()æ–¹æ³•åŒºåˆ«ï¼Ÿ</h4><p>1.start()æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œï¼Œè¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•è€Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼š</p><p>é€šè¿‡è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œ<br>è¿™æ—¶æ­¤çº¿ç¨‹æ˜¯å¤„äºå°±ç»ªçŠ¶æ€ï¼Œ<br>å¹¶æ²¡æœ‰è¿è¡Œã€‚<br>ç„¶åé€šè¿‡æ­¤Threadç±»è°ƒç”¨æ–¹æ³•run()æ¥å®Œæˆå…¶è¿è¡Œæ“ä½œçš„ï¼Œ<br>è¿™é‡Œæ–¹æ³•run()ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œ<br>å®ƒåŒ…å«äº†è¦æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹çš„å†…å®¹ï¼Œ<br>Runæ–¹æ³•è¿è¡Œç»“æŸï¼Œ<br>æ­¤çº¿ç¨‹ç»ˆæ­¢ï¼Œ<br>è€ŒCPUå†è¿è¡Œå…¶å®ƒçº¿ç¨‹ï¼Œåœ¨Androidä¸­ä¸€èˆ¬æ˜¯ä¸»çº¿ç¨‹ã€‚</p><p>2.run()æ–¹æ³•å½“ä½œæ™®é€šæ–¹æ³•çš„æ–¹å¼è°ƒç”¨ï¼Œç¨‹åºè¿˜æ˜¯è¦é¡ºåºæ‰§è¡Œï¼Œè¿˜æ˜¯è¦ç­‰å¾…runæ–¹æ³•ä½“æ‰§è¡Œå®Œæ¯•åæ‰å¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼š</p><p>è€Œå¦‚æœç›´æ¥ç”¨Runæ–¹æ³•ï¼Œ<br>è¿™åªæ˜¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•è€Œå·²ï¼Œ<br>ç¨‹åºä¸­ä¾ç„¶åªæœ‰ä¸»çº¿ç¨‹â€“è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œ<br>å…¶ç¨‹åºæ‰§è¡Œè·¯å¾„è¿˜æ˜¯åªæœ‰ä¸€æ¡ï¼Œ<br>è¿™æ ·å°±æ²¡æœ‰è¾¾åˆ°å†™çº¿ç¨‹çš„ç›®çš„ã€‚</p><h4 id="11ã€å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ åŸç†ã€‚"><a href="#11ã€å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ åŸç†ã€‚" class="headerlink" title="11ã€å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ åŸç†ã€‚"></a>11ã€å¤šçº¿ç¨‹æ–­ç‚¹ç»­ä¼ åŸç†ã€‚</h4><p>åœ¨æœ¬åœ°ä¸‹è½½è¿‡ç¨‹ä¸­è¦ä½¿ç”¨æ•°æ®åº“å®æ—¶å­˜å‚¨åˆ°åº•å­˜å‚¨åˆ°æ–‡ä»¶çš„å“ªä¸ªä½ç½®äº†ï¼Œè¿™æ ·ç‚¹å‡»å¼€å§‹ç»§ç»­ä¼ é€’æ—¶ï¼Œæ‰èƒ½é€šè¿‡HTTPçš„GETè¯·æ±‚ä¸­çš„setRequestProperty(â€œRangeâ€,â€bytes=startIndex-endIndexâ€);æ–¹æ³•å¯ä»¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œæ•°æ®ä»å“ªé‡Œå¼€å§‹ï¼Œåˆ°å“ªé‡Œç»“æŸã€‚åŒæ—¶åœ¨æœ¬åœ°çš„æ–‡ä»¶å†™å…¥æ—¶ï¼ŒRandomAccessFileçš„seek()æ–¹æ³•ä¹Ÿæ”¯æŒåœ¨æ–‡ä»¶ä¸­çš„ä»»æ„ä½ç½®è¿›è¡Œå†™å…¥æ“ä½œã€‚åŒæ—¶é€šè¿‡å¹¿æ’­æˆ–äº‹ä»¶æ€»çº¿æœºåˆ¶å°†å­çº¿ç¨‹çš„è¿›åº¦å‘Šè¯‰Activityçš„è¿›åº¦æ¡ã€‚å…³äºæ–­çº¿ç»­ä¼ çš„HTTPçŠ¶æ€ç æ˜¯206ï¼Œå³HttpStatus.SC_PARTIAL_CONTENTã€‚</p><h4 id="12ã€æ€ä¹ˆå®‰å…¨åœæ­¢ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿçº¿ç¨‹æ± é‡Œæœ‰ç±»ä¼¼æœºåˆ¶å—ï¼Ÿ"><a href="#12ã€æ€ä¹ˆå®‰å…¨åœæ­¢ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿçº¿ç¨‹æ± é‡Œæœ‰ç±»ä¼¼æœºåˆ¶å—ï¼Ÿ" class="headerlink" title="12ã€æ€ä¹ˆå®‰å…¨åœæ­¢ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿçº¿ç¨‹æ± é‡Œæœ‰ç±»ä¼¼æœºåˆ¶å—ï¼Ÿ"></a>12ã€æ€ä¹ˆå®‰å…¨åœæ­¢ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿçº¿ç¨‹æ± é‡Œæœ‰ç±»ä¼¼æœºåˆ¶å—ï¼Ÿ</h4><h5 id="ç»ˆæ­¢çº¿ç¨‹"><a href="#ç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="ç»ˆæ­¢çº¿ç¨‹"></a>ç»ˆæ­¢çº¿ç¨‹</h5><p>1ã€ä½¿ç”¨violate booleanå˜é‡é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ã€‚ï¼ˆæ¨èï¼‰</p><p>2ã€ä½¿ç”¨interrupt()æ–¹æ³•ä¸­æ–­çº¿ç¨‹ï¼Œä½†æ˜¯çº¿ç¨‹ä¸ä¸€å®šä¼šç»ˆæ­¢ã€‚</p><p>3ã€ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢çº¿ç¨‹ã€‚ä¸å®‰å…¨ä¸»è¦æ˜¯ï¼šthread.stop()è°ƒç”¨ä¹‹åï¼Œåˆ›å»ºå­çº¿ç¨‹çš„çº¿ç¨‹å°±ä¼šæŠ›å‡ºThreadDeatherrorçš„é”™è¯¯ï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾å­çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰é”ã€‚</p><h5 id="ç»ˆæ­¢çº¿ç¨‹æ± "><a href="#ç»ˆæ­¢çº¿ç¨‹æ± " class="headerlink" title="ç»ˆæ­¢çº¿ç¨‹æ± "></a>ç»ˆæ­¢çº¿ç¨‹æ± </h5><p>ExecutorServiceçº¿ç¨‹æ± å°±æä¾›äº†shutdownå’ŒshutdownNowè¿™æ ·çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± è‡ªèº«ä»¥åŠå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹ã€‚</p><p>1ã€shutdownå…³é—­çº¿ç¨‹æ± </p><p>çº¿ç¨‹æ± ä¸ä¼šç«‹åˆ»é€€å‡ºï¼Œç›´åˆ°æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡éƒ½å·²ç»å¤„ç†å®Œæˆï¼Œæ‰ä¼šé€€å‡ºã€‚ </p><p>2ã€shutdownNowå…³é—­çº¿ç¨‹æ± å¹¶ä¸­æ–­ä»»åŠ¡</p><p>ç»ˆæ­¢ç­‰å¾…æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶è¿”å›å®ƒä»¬çš„åˆ—è¡¨ã€‚è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œè¯•å›¾ç»ˆæ­¢çš„æ–¹æ³•æ˜¯è°ƒç”¨Thread.interrupt()ï¼Œä½†æ˜¯å¤§å®¶çŸ¥é“ï¼Œå¦‚æœçº¿ç¨‹ä¸­æ²¡æœ‰sleep ã€waitã€Conditionã€å®šæ—¶é”ç­‰åº”ç”¨, interrupt()æ–¹æ³•æ˜¯æ— æ³•ä¸­æ–­å½“å‰çš„çº¿ç¨‹çš„ã€‚æ‰€ä»¥ï¼ŒShutdownNow()å¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± å°±ä¸€å®šç«‹å³å°±èƒ½é€€å‡ºï¼Œå®ƒå¯èƒ½å¿…é¡»è¦ç­‰å¾…æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆäº†æ‰èƒ½é€€å‡ºã€‚</p><h4 id="13ã€å †å†…å­˜ï¼Œæ ˆå†…å­˜ç†è§£ï¼Œæ ˆå¦‚ä½•è½¬æ¢æˆå †ï¼Ÿ"><a href="#13ã€å †å†…å­˜ï¼Œæ ˆå†…å­˜ç†è§£ï¼Œæ ˆå¦‚ä½•è½¬æ¢æˆå †ï¼Ÿ" class="headerlink" title="13ã€å †å†…å­˜ï¼Œæ ˆå†…å­˜ç†è§£ï¼Œæ ˆå¦‚ä½•è½¬æ¢æˆå †ï¼Ÿ"></a>13ã€å †å†…å­˜ï¼Œæ ˆå†…å­˜ç†è§£ï¼Œæ ˆå¦‚ä½•è½¬æ¢æˆå †ï¼Ÿ</h4><ul><li>åœ¨å‡½æ•°ä¸­å®šä¹‰çš„ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡éƒ½æ˜¯åœ¨å‡½æ•°çš„æ ˆå†…å­˜ä¸­åˆ†é…ã€‚</li><li>å †å†…å­˜ç”¨äºå­˜æ”¾ç”±newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ã€‚JVMé‡Œçš„â€œå †â€ï¼ˆheapï¼‰ç‰¹æŒ‡ç”¨äºå­˜æ”¾Javaå¯¹è±¡çš„å†…å­˜åŒºåŸŸã€‚æ‰€ä»¥æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼ŒJavaå¯¹è±¡å…¨éƒ¨éƒ½åœ¨å †ä¸Šã€‚JVMçš„å †è¢«åŒä¸€ä¸ªJVMå®ä¾‹ä¸­çš„æ‰€æœ‰Javaçº¿ç¨‹å…±äº«ã€‚å®ƒé€šå¸¸ç”±æŸç§è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶æ‰€ç®¡ç†ï¼Œè¿™ç§æœºåˆ¶é€šå¸¸å«åšâ€œåƒåœ¾å›æ”¶â€ï¼ˆgarbage collectionï¼ŒGCï¼‰ã€‚</li><li>å †ä¸»è¦ç”¨æ¥å­˜æ”¾å¯¹è±¡çš„ï¼Œæ ˆä¸»è¦æ˜¯ç”¨æ¥æ‰§è¡Œç¨‹åºçš„ã€‚</li><li>å®é™…ä¸Šï¼Œæ ˆä¸­çš„å˜é‡æŒ‡å‘å †å†…å­˜ä¸­çš„å˜é‡ï¼Œè¿™å°±æ˜¯ Java ä¸­çš„æŒ‡é’ˆ!</li></ul><h4 id="14ã€å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„ä¸ªæ•°ï¼›"><a href="#14ã€å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„ä¸ªæ•°ï¼›" class="headerlink" title="14ã€å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„ä¸ªæ•°ï¼›"></a>14ã€å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„ä¸ªæ•°ï¼›</h4><h4 id="15ã€å¤šè¿›ç¨‹å¼€å‘ä»¥åŠå¤šè¿›ç¨‹åº”ç”¨åœºæ™¯ï¼›"><a href="#15ã€å¤šè¿›ç¨‹å¼€å‘ä»¥åŠå¤šè¿›ç¨‹åº”ç”¨åœºæ™¯ï¼›" class="headerlink" title="15ã€å¤šè¿›ç¨‹å¼€å‘ä»¥åŠå¤šè¿›ç¨‹åº”ç”¨åœºæ™¯ï¼›"></a>15ã€å¤šè¿›ç¨‹å¼€å‘ä»¥åŠå¤šè¿›ç¨‹åº”ç”¨åœºæ™¯ï¼›</h4><h4 id="16ã€Javaçš„çº¿ç¨‹æ¨¡å‹ï¼›"><a href="#16ã€Javaçš„çº¿ç¨‹æ¨¡å‹ï¼›" class="headerlink" title="16ã€Javaçš„çº¿ç¨‹æ¨¡å‹ï¼›"></a>16ã€Javaçš„çº¿ç¨‹æ¨¡å‹ï¼›</h4><h4 id="17ã€æ­»é”çš„æ¦‚å¿µï¼Œæ€ä¹ˆé¿å…æ­»é”ï¼Ÿ"><a href="#17ã€æ­»é”çš„æ¦‚å¿µï¼Œæ€ä¹ˆé¿å…æ­»é”ï¼Ÿ" class="headerlink" title="17ã€æ­»é”çš„æ¦‚å¿µï¼Œæ€ä¹ˆé¿å…æ­»é”ï¼Ÿ"></a>17ã€æ­»é”çš„æ¦‚å¿µï¼Œæ€ä¹ˆé¿å…æ­»é”ï¼Ÿ</h4><h4 id="18ã€å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹è¯»å†™æ–‡ä»¶çš„å®‰å…¨ï¼Ÿ"><a href="#18ã€å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹è¯»å†™æ–‡ä»¶çš„å®‰å…¨ï¼Ÿ" class="headerlink" title="18ã€å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹è¯»å†™æ–‡ä»¶çš„å®‰å…¨ï¼Ÿ"></a>18ã€å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹è¯»å†™æ–‡ä»¶çš„å®‰å…¨ï¼Ÿ</h4><h4 id="19ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Œä»¥åŠå¦‚ä½•é˜²æ­¢çº¿ç¨‹çš„å†…å­˜æ³„æ¼ï¼Ÿ"><a href="#19ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Œä»¥åŠå¦‚ä½•é˜²æ­¢çº¿ç¨‹çš„å†…å­˜æ³„æ¼ï¼Ÿ" class="headerlink" title="19ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Œä»¥åŠå¦‚ä½•é˜²æ­¢çº¿ç¨‹çš„å†…å­˜æ³„æ¼ï¼Ÿ"></a>19ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Œä»¥åŠå¦‚ä½•é˜²æ­¢çº¿ç¨‹çš„å†…å­˜æ³„æ¼ï¼Ÿ</h4><h4 id="20ã€ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä»…ä»…ç”¨è¿›ç¨‹ï¼Ÿ"><a href="#20ã€ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä»…ä»…ç”¨è¿›ç¨‹ï¼Ÿ" class="headerlink" title="20ã€ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä»…ä»…ç”¨è¿›ç¨‹ï¼Ÿ"></a>20ã€ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä»…ä»…ç”¨è¿›ç¨‹ï¼Ÿ</h4><h4 id="21ã€å¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®ï¼Ÿ"><a href="#21ã€å¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®ï¼Ÿ" class="headerlink" title="21ã€å¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®ï¼Ÿ"></a>21ã€å¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®ï¼Ÿ</h4><h4 id="22ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ"><a href="#22ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ" class="headerlink" title="22ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ"></a>22ã€çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ</h4><h4 id="23ã€æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ"><a href="#23ã€æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ" class="headerlink" title="23ã€æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ"></a>23ã€æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</h4><h4 id="24ã€ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¦æ±‚å†™æˆ–è€…è¯»ï¼Œèƒ½ä¸èƒ½å®ç°ï¼Ÿå¦‚ä½•é˜²æ­¢è¿›ç¨‹çš„åŒæ­¥ï¼Ÿ"><a href="#24ã€ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¦æ±‚å†™æˆ–è€…è¯»ï¼Œèƒ½ä¸èƒ½å®ç°ï¼Ÿå¦‚ä½•é˜²æ­¢è¿›ç¨‹çš„åŒæ­¥ï¼Ÿ" class="headerlink" title="24ã€ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¦æ±‚å†™æˆ–è€…è¯»ï¼Œèƒ½ä¸èƒ½å®ç°ï¼Ÿå¦‚ä½•é˜²æ­¢è¿›ç¨‹çš„åŒæ­¥ï¼Ÿ"></a>24ã€ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¦æ±‚å†™æˆ–è€…è¯»ï¼Œèƒ½ä¸èƒ½å®ç°ï¼Ÿå¦‚ä½•é˜²æ­¢è¿›ç¨‹çš„åŒæ­¥ï¼Ÿ</h4><h4 id="25ã€è°ˆè°ˆå¯¹å¤šçº¿ç¨‹çš„ç†è§£å¹¶ä¸¾ä¾‹è¯´æ˜"><a href="#25ã€è°ˆè°ˆå¯¹å¤šçº¿ç¨‹çš„ç†è§£å¹¶ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="25ã€è°ˆè°ˆå¯¹å¤šçº¿ç¨‹çš„ç†è§£å¹¶ä¸¾ä¾‹è¯´æ˜"></a>25ã€è°ˆè°ˆå¯¹å¤šçº¿ç¨‹çš„ç†è§£å¹¶ä¸¾ä¾‹è¯´æ˜</h4><h4 id="26ã€çº¿ç¨‹çš„çŠ¶æ€å’Œä¼˜å…ˆçº§ã€‚"><a href="#26ã€çº¿ç¨‹çš„çŠ¶æ€å’Œä¼˜å…ˆçº§ã€‚" class="headerlink" title="26ã€çº¿ç¨‹çš„çŠ¶æ€å’Œä¼˜å…ˆçº§ã€‚"></a>26ã€çº¿ç¨‹çš„çŠ¶æ€å’Œä¼˜å…ˆçº§ã€‚</h4><h4 id="27ã€ThreadLocalçš„ä½¿ç”¨"><a href="#27ã€ThreadLocalçš„ä½¿ç”¨" class="headerlink" title="27ã€ThreadLocalçš„ä½¿ç”¨"></a>27ã€ThreadLocalçš„ä½¿ç”¨</h4><h4 id="28ã€Javaä¸­çš„å¹¶å‘å·¥å…·ï¼ˆCountDownLatchï¼ŒCyclicBarrierç­‰ï¼‰"><a href="#28ã€Javaä¸­çš„å¹¶å‘å·¥å…·ï¼ˆCountDownLatchï¼ŒCyclicBarrierç­‰ï¼‰" class="headerlink" title="28ã€Javaä¸­çš„å¹¶å‘å·¥å…·ï¼ˆCountDownLatchï¼ŒCyclicBarrierç­‰ï¼‰"></a>28ã€Javaä¸­çš„å¹¶å‘å·¥å…·ï¼ˆCountDownLatchï¼ŒCyclicBarrierç­‰ï¼‰</h4><h4 id="29ã€è¿›ç¨‹çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­çš„å®ç°"><a href="#29ã€è¿›ç¨‹çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­çš„å®ç°" class="headerlink" title="29ã€è¿›ç¨‹çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­çš„å®ç°"></a>29ã€è¿›ç¨‹çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­çš„å®ç°</h4><h4 id="30ã€åŒçº¿ç¨‹é€šè¿‡çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ‰“å°12121212â€¦â€¦"><a href="#30ã€åŒçº¿ç¨‹é€šè¿‡çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ‰“å°12121212â€¦â€¦" class="headerlink" title="30ã€åŒçº¿ç¨‹é€šè¿‡çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ‰“å°12121212â€¦â€¦."></a>30ã€åŒçº¿ç¨‹é€šè¿‡çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ‰“å°12121212â€¦â€¦.</h4><h4 id="31ã€javaçº¿ç¨‹ï¼Œåœºæ™¯å®ç°ï¼Œå¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®"><a href="#31ã€javaçº¿ç¨‹ï¼Œåœºæ™¯å®ç°ï¼Œå¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®" class="headerlink" title="31ã€javaçº¿ç¨‹ï¼Œåœºæ™¯å®ç°ï¼Œå¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®"></a>31ã€javaçº¿ç¨‹ï¼Œåœºæ™¯å®ç°ï¼Œå¤šä¸ªçº¿ç¨‹å¦‚ä½•åŒæ—¶è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœå¦‚ä½•ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ•°æ®å®Œæˆååˆæˆä¸€ä¸ªæ•°æ®</h4><h4 id="32ã€æœåŠ¡å™¨åªæä¾›æ•°æ®æ¥æ”¶æ¥å£ï¼Œåœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹æ¡ä»¶ä¸‹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„æœ‰åºåˆ°è¾¾ï¼Ÿ"><a href="#32ã€æœåŠ¡å™¨åªæä¾›æ•°æ®æ¥æ”¶æ¥å£ï¼Œåœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹æ¡ä»¶ä¸‹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„æœ‰åºåˆ°è¾¾ï¼Ÿ" class="headerlink" title="32ã€æœåŠ¡å™¨åªæä¾›æ•°æ®æ¥æ”¶æ¥å£ï¼Œåœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹æ¡ä»¶ä¸‹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„æœ‰åºåˆ°è¾¾ï¼Ÿ"></a>32ã€æœåŠ¡å™¨åªæä¾›æ•°æ®æ¥æ”¶æ¥å£ï¼Œåœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹æ¡ä»¶ä¸‹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„æœ‰åºåˆ°è¾¾ï¼Ÿ</h4><h4 id="33ã€å•æœºä¸Šä¸€ä¸ªçº¿ç¨‹æ± æ­£åœ¨å¤„ç†æœåŠ¡ï¼Œå¦‚æœå¿½ç„¶æ–­ç”µäº†æ€ä¹ˆåŠï¼ˆæ­£åœ¨å¤„ç†å’Œé˜»å¡é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ€ä¹ˆå¤„ç†ï¼‰ï¼Ÿ"><a href="#33ã€å•æœºä¸Šä¸€ä¸ªçº¿ç¨‹æ± æ­£åœ¨å¤„ç†æœåŠ¡ï¼Œå¦‚æœå¿½ç„¶æ–­ç”µäº†æ€ä¹ˆåŠï¼ˆæ­£åœ¨å¤„ç†å’Œé˜»å¡é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ€ä¹ˆå¤„ç†ï¼‰ï¼Ÿ" class="headerlink" title="33ã€å•æœºä¸Šä¸€ä¸ªçº¿ç¨‹æ± æ­£åœ¨å¤„ç†æœåŠ¡ï¼Œå¦‚æœå¿½ç„¶æ–­ç”µäº†æ€ä¹ˆåŠï¼ˆæ­£åœ¨å¤„ç†å’Œé˜»å¡é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ€ä¹ˆå¤„ç†ï¼‰ï¼Ÿ"></a>33ã€å•æœºä¸Šä¸€ä¸ªçº¿ç¨‹æ± æ­£åœ¨å¤„ç†æœåŠ¡ï¼Œå¦‚æœå¿½ç„¶æ–­ç”µäº†æ€ä¹ˆåŠï¼ˆæ­£åœ¨å¤„ç†å’Œé˜»å¡é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ€ä¹ˆå¤„ç†ï¼‰ï¼Ÿ</h4>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> èŒåœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŠ¨æ€ä»£ç†æœºåˆ¶</title>
      <link href="/2019-11-30/dynamic-proxy/"/>
      <url>/2019-11-30/dynamic-proxy/</url>
      
        <content type="html"><![CDATA[<p>Java åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§ä»£ç†æœºåˆ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬åŠ¨æ€åœ°ã€åœ¨ä¸ä¿®æ”¹åŸä»£ç çš„åŸºç¡€ä¸Šï¼Œè®©ä»£ç å®Œæˆå®ƒæœ¬æ¥æ— æ³•å®Œæˆçš„å·¥ä½œã€‚</p><span id="more"></span><h2 id="é™æ€ä»£ç†æ˜¯ä»€ä¹ˆ"><a href="#é™æ€ä»£ç†æ˜¯ä»€ä¹ˆ" class="headerlink" title="é™æ€ä»£ç†æ˜¯ä»€ä¹ˆ"></a>é™æ€ä»£ç†æ˜¯ä»€ä¹ˆ</h2><p>å“å“ï¼Ÿæ ‡é¢˜ä¸æ˜¯åœ¨è®²åŠ¨æ€ä»£ç†å—ï¼Ÿ</p><p>è¦æƒ³çŸ¥é“åŠ¨æ€ä»£ç†ï¼Œå¿…é¡»å…ˆçŸ¥é“é™æ€ä»£ç†ã€‚</p><p>é™æ€ä»£ç†æ¨¡å¼å¯ä»¥åœ¨<strong>ä¸ä¿®æ”¹è¢«ä»£ç†å¯¹è±¡</strong>çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æ‰©å±•ä»£ç†ç±»ï¼Œè¿›è¡Œä¸€äº›åŠŸèƒ½çš„é™„åŠ ä¸å¢å¼ºã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»£ç†ç±»å’Œè¢«ä»£ç†ç±»åº”è¯¥å…±åŒå®ç°ä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…æ˜¯å…±åŒç»§æ‰¿æŸä¸ªç±»ã€‚å®ƒçš„ç±»å‹æ˜¯äº‹å…ˆé¢„å®šå¥½çš„ï¼Œåœ¨ç¼–è¯‘æ—¶<strong>ä¼šè¢«ç¼–è¯‘è¿› .class æ–‡ä»¶</strong>ä¸­ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ã€‚</p><p>æ¯”å¦‚æˆ‘ç”µå½±é™¢è¦æ”¾ç”µå½±ï¼Œæ”¾ç”µå½±ä¹‹å‰è¦æ”¾å¹¿å‘Šå§ï¼Œä½†æ˜¯ç”µå½±æœ¬èº«æ˜¯ä¸èƒ½è¿›è¡Œä¿®æ”¹çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä»£ç†çš„æ–¹æ³•ï¼Œåœ¨ç”µå½±çš„å‰ã€åéƒ½åŠ å…¥å¹¿å‘Šçš„æ’­æ”¾åŠŸèƒ½ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ¥å£ï¼Œæœ‰äº†é€šç”¨æ¥å£ï¼Œæ‰æœ‰äº†ä»£ç†æ¨¡å¼å®ç°çš„åŸºç¡€ã€‚</p><pre><code class="java">package com.debugLife.proxyTest;public interface Movie &#123;    public void play();&#125;</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€éƒ¨ç”µå½±ï¼ˆè¢«ä»£ç†ç±»ï¼‰ï¼š</p><pre><code class="java">public com.debugLife.proxyTest;public class AMovie implements Movie &#123;    @Override    public void play() &#123;        System.out.println(&quot;æ­£åœ¨æ’­æ”¾ç”µå½± -ã€ŠæŒ‡ç¯ç‹ã€‹&quot;);    &#125;&#125;</code></pre><p>å®ƒå®ç°äº† Movie æ¥å£ï¼Œå½“è°ƒç”¨<code>play()</code>æ–¹æ³•æ—¶ï¼Œç”µå½±å°±å¼€å§‹æ’­æ”¾äº†ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ç”µå½±é™¢ï¼ˆä»£ç†ç±»ï¼‰ï¼š</p><pre><code class="java">public com.debugLife.proxyTest;public class Cinema implements Movie &#123;    AMovie aMovie;    public Cinema(AMovie aMovie) &#123;        super();        this.aMovie = aMovie;    &#125;    @Override    public void play() &#123;        playAds();        aMovie.play();        playAds();    &#125;    private void playAds() &#123;        System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);    &#125;&#125;</code></pre><p>æ­¤æ—¶çš„ Cinema å·²ç»æ˜¯ä»£ç†å¯¹è±¡äº†ï¼Œå®ƒæœ‰ä¸€ä¸ª<code>play()</code>æ–¹æ³•ï¼Œé‡Œé¢æœ‰å®ƒè‡ªå·±çš„ä¸€äº›å°ä¹ä¹ã€‚</p><p>è€Œå½±é™¢å¼€å§‹è¿è¥æ—¶ï¼Œå°±æ˜¯è¿™æ ·äº†ï¼š</p><pre><code class="java">package com.debugLife.proxyTest;public class WandaCinema &#123;    public static void main(String[] args) &#123;        AMovie aMovie = new AMovie();        Movie movie = new Cinema(aMovie);        movie.play();    &#125;&#125;</code></pre><p>ç»“æœä¸å¿…å¤šæƒ³ï¼Œè‚¯å®šå¦‚ä¸‹ï¼š</p><pre><code>å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼æ­£åœ¨æ’­æ”¾ç”µå½± -ã€ŠæŒ‡ç¯ç‹ã€‹å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼</code></pre><p>é™æ€ä»£ç†çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å®ƒé€šå¸¸<strong>åªèƒ½ä»£ç†ä¸€ä¸ªç±»</strong>ï¼Œè¿™å¯¹äºæ—¥ç›Šå¢é•¿çš„éœ€æ±‚æ¥çœ‹ï¼Œ100ä¸ªç±»ï¼Œå°±å‡ ä¹è¦å†™100ä¸ªä»£ç†æ–¹æ³•ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆå®é™…çš„ã€‚</p><p>é‚£ä¹ˆï¼Œèƒ½å¦ä¸å†™ä»£ç†ç±»ï¼Œè€Œç›´æ¥å¾—åˆ°ä»£ç† Class å¯¹è±¡ï¼Œç„¶åæ ¹æ®å®ƒåˆ›å»ºä»£ç†å®ä¾‹ï¼ˆåå°„ï¼‰å‘¢ï¼Ÿä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå‡ºç°äº†åŠ¨æ€ä»£ç†ã€‚</p><h2 id="åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆ"><a href="#åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆ" class="headerlink" title="åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆ"></a>åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆ</h2><p>Java çš„åŠ¨æ€ä»£ç†æœºåˆ¶å¯è°“æ˜¯ã€ç‹¸çŒ«æ¢å¤ªå­ã€çš„å…¸èŒƒäº†ã€‚ä¸ºäº†<strong>ä¸æš´éœ²å†…éƒ¨çš„æ¥å£</strong>ï¼Œé‡‡å–äº†ä¸ºå…¶ä»–å¯¹è±¡<strong>æä¾›ä¸€ä¸ªä»£ç†</strong>ä»¥æ§åˆ¶å¯¹æŸä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†ç±»ä¸»è¦è´Ÿè´£ä¸ºå§”æ‰˜ç±»ï¼ˆçœŸå®å¯¹è±¡ï¼‰é¢„å¤„ç†æ¶ˆæ¯ã€è¿‡æ»¤æ¶ˆæ¯ã€ä¼ é€’æ¶ˆæ¯ç»™å§”æ‰˜ç±»ï¼Œä»£ç†ç±»ä¸ç°å®å…·ä½“æœåŠ¡ï¼Œè€Œæ˜¯åˆ©ç”¨å§”æ‰˜ç±»æ¥å®ŒæˆæœåŠ¡ï¼Œå¹¶å°†æ‰§è¡Œç»“æœå°è£…å¤„ç†ã€‚</p><p>JDK æä¾›äº†<code>java.lang.reflect.InvocationHandler</code>æ¥å£å’Œ<code>java.lang.reflect.Proxy</code>ç±»ï¼Œè¿™ä¸¤ä¸ªç±»ç›¸äº’é…åˆï¼Œå…¥å£æ˜¯ Proxyï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆèŠå®ƒã€‚</p><p>Proxyæœ‰ä¸ªé™æ€æ–¹æ³•ï¼š<code>getProxyClass(ClassLoader, interfaces)</code>ï¼Œåªè¦ä½ ç»™å®ƒä¼ å…¥ç±»åŠ è½½å™¨å’Œä¸€ç»„æ¥å£ï¼Œå®ƒå°±ç»™ä½ è¿”å›ä»£ç† Class å¯¹è±¡ã€‚</p><p>ç”¨é€šä¿—çš„è¯è¯´ï¼Œ<code>getProxyClass()</code>è¿™ä¸ªæ–¹æ³•ï¼Œä¼šä»ä½ ä¼ å…¥çš„æ¥å£ Class ä¸­ï¼Œã€æ‹·è´ã€ç±»ç»“æ„ä¿¡æ¯åˆ°ä¸€ä¸ªæ–°çš„ Class å¯¹è±¡ä¸­ï¼Œä½†æ–°çš„ Class å¯¹è±¡å¸¦æœ‰æ„é€ å™¨ï¼Œæ˜¯å¯ä»¥åˆ›å»ºå¯¹è±¡çš„ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œä¸€ä¸ªå¤§å†…å¤ªç›‘ï¼ˆæ¥å£Classï¼‰ï¼Œç©ºæœ‰ä¸€èº«æ­¦è‰ºï¼ˆç±»ä¿¡æ¯ï¼‰ï¼Œä½†æ˜¯æ— æ³•ä¼ ç»™åäººã€‚ç°åœ¨æ±Ÿæ¹–ä¸Šæœ‰ä¸ªå¦™æ‰‹ç¥åŒ»ï¼ˆProxyç±»ï¼‰ï¼Œå‘æ˜äº†å…‹éš†å¤§æ³•ï¼ˆgetProxyClassï¼‰ï¼Œä¸ä»…èƒ½å…‹éš†å¤ªç›‘çš„ä¸€èº«æ­¦è‰ºï¼Œè¿˜ä¿ç•™äº†å°DDï¼ˆæ„é€ å™¨ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬æ˜ç¡®æ¥å£ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡æ¥å£çš„Classå¯¹è±¡ï¼Œåˆ›å»ºä¸€ä¸ªä»£ç†Classï¼Œé€šè¿‡ä»£ç†Classå³å¯åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</p><p>å¤§ä½“æ€è·¯å¦‚ä¸‹ï¼š</p><div class="center-img"><p><img src="/img/java-proxy-1588601750.png"></p></div><p>å…¶ä¸­é™æ€ä»£ç†çš„æœºåˆ¶å¦‚ä¸‹ï¼š</p><div class="center-img"><p><img src="/img/java-proxy-1588602762.png"></p></div><p>åŠ¨æ€ä»£ç†çš„æœºåˆ¶å¦‚ä¸‹ï¼š</p><div class="center-img"><p><img src="/img/java-proxy-1588603762.png"></p></div><p>æ‰€ä»¥ï¼Œ<code>Proxy.getProxyClass()</code>è¿™ä¸ªæ–¹æ³•çš„æœ¬è´¨å°±æ˜¯ï¼š<strong>ç”¨ Class æ¥åˆ¶é€  Class</strong></p><p>ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨<code>Proxy.newProxyInstance()</code>ç›´æ¥è¿”å›ä»£ç†å®ä¾‹ï¼Œä¸­é—´çš„è¿‡ç¨‹å…¨éƒ¨éšè—ã€‚</p><p>è¿˜æ˜¯æ¥çœ‹åˆšæ‰ç”µå½±é™¢çš„ä¾‹å­ã€‚ä½¿ç”¨åŠ¨æ€ä»£ç†çš„è¯ï¼Œåº”è¯¥æ˜¯ä¸‹é¢è¿™ç§æ–¹å¼ï¼š</p><pre><code class="java">Movie proxyMovie = (Movie)Proxy.newProxyInstance(        Movie.class.getClassLoader(),        new Class&lt;?&gt;[] &#123; Movie.class &#125; ,        new InvocationHandler() &#123;            @Override            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;                System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);                Movie movie = new AMovie();                method.invoke(movie, args);                System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);                return null;            &#125;        &#125;);proxyMovie.play();</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å·²ç»ä¸å†éœ€è¦é™æ€ä»£ç†ç±»ã€Cinemaã€äº†ï¼Œå¯ä»¥ç›´æ¥æƒ³æ€ä¹ˆç©å°±æ€ä¹ˆç©äº†ï¼Œç”šè‡³æˆ‘å¯ä»¥ä¸è°ƒç”¨<code>method.invoke()</code>æ–¹æ³•ï¼Œè®©<code>proxyMovie.play()</code>æ—¶ï¼Œä¸å†è°ƒç”¨<code>AMovie.play()</code>æ–¹æ³•ï¼Œç›´æ¥å…¨ç¨‹å¹¿å‘Šï¼</p><pre><code class="java">Movie proxyMovie = (Movie)Proxy.newProxyInstance(        Movie.class.getClassLoader(),        new Class&lt;?&gt;[] &#123; Movie.class &#125; ,        new InvocationHandler() &#123;            @Override            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;                System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);                // Movie movie = new AMovie();                // method.invoke(movie, args);                System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);                return null;            &#125;        &#125;);proxyMovie.play();</code></pre><p>è¾“å…¥ç»“æœå°±å¦‚ä¸‹ï¼š</p><pre><code>å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼</code></pre><p>çœŸæ˜¯å¹²(sang)å¾—(xin)æ¼‚(bing)äº®(kuang)ã€‚æœ‰äº†åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯ä»¥åœ¨åŸæœ‰æ¥å£å’Œè¢«ä»£ç†ç±»çš„åŸºç¡€ä¸Š<strong>åšå‡ºä»»ä½•æ‹“å±•</strong>ï¼Œè€Œ<strong>ä¸ä¼šå½±å“åˆ°åŸæœ‰æ¥å£å’Œè¢«ä»£ç†ç±»</strong>ã€‚è€Œä¸”è¿˜çœæ‰äº†ä¸€ä¸ªä»£ç†ç±»ã€‚</p><p>å¦‚æœæ–°æ·»åŠ äº†ä¸€éƒ¨ç”µå½±ï¼ˆè¢«ä»£ç†ç±»ï¼‰å«BMovieï¼Œé‚£ä¹ˆæˆ‘å°±å¾—æ”¹<code>invoke()</code>æ–¹æ³•äº†ï¼Œè¿™ç§æ–¹æ³•å¿’å·®åŠ²ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹è¿›ä¸€ä¸‹ï¼š</p><pre><code class="java">public static void main(String[] args) throws Exception &#123;    Movie aMovie = (Movie)getProxy(new AMovie());    Movie bMovie = (Movie)getProxy(new BMovie());    aMovie.play();    bMovie.play();&#125;private static Object getProxy(final Object target) throws Exception &#123;    return Proxy.newProxyInstance(target.getClass().getClassLoader(),            target.getClass().getInterfaces(),            new InvocationHandler() &#123;                @Override                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;                    System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);                    method.invoke(target, args);                    System.out.println(&quot;å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼&quot;);                    return null;                &#125;            &#125;);&#125;</code></pre><p>å°±å¯ä»¥è¾“å‡ºä¸‹é¢çš„ç»“æœï¼š</p><pre><code>å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼æ­£åœ¨æ’­æ”¾ç”µå½± -ã€ŠæŒ‡ç¯ç‹ã€‹å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼æ­£åœ¨æ’­æ”¾ç”µå½± -ã€Šæ–­èƒŒå±±ã€‹å¾—äº†ç—”ç–®æ€ä¹ˆåŠï¼Ÿå¤§é“æ£å­åŒ»é™¢æ‰¾æ…ä¸»ä»»ï¼</code></pre><h2 id="ä¸ºä½•è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶"><a href="#ä¸ºä½•è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶" class="headerlink" title="ä¸ºä½•è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶"></a>ä¸ºä½•è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶</h2><ol><li>è®¾è®¡æ¨¡å¼ä¸­æœ‰ä¸€ä¸ªè®¾è®¡åŸåˆ™æ˜¯<strong>å¼€é—­åŸåˆ™</strong>ï¼Œæ˜¯è¯´å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚æˆ‘ä»¬åœ¨å·¥ä½œä¸­æœ‰æ—¶ä¼šæ¥æ‰‹å¾ˆå¤šå‰äººçš„ä»£ç ï¼Œé‡Œé¢ä»£ç é€»è¾‘è®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Œè¿™æ—¶å°±å¾ˆéš¾å»ä¸‹æ‰‹ä¿®æ”¹ä»£ç ï¼Œé‚£ä¹ˆè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»£ç†å¯¹ç±»è¿›è¡Œå¢å¼ºã€‚</li><li>å®ç°æ— ä¾µå…¥å¼çš„ä»£ç æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯<strong>æ–¹æ³•çš„å¢å¼º</strong>ã€‚åŒæ—¶è®©ä½ å¯ä»¥åœ¨ä¸ç”¨ä¿®æ”¹æºç çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºä¸€äº›æ–¹æ³•ï¼Œç”šè‡³åœ¨æ–¹æ³•çš„å‰åä½ å¯ä»¥åšä½ ä»»ä½•æƒ³åšçš„äº‹æƒ…ï¼ˆç”šè‡³ä¸å»æ‰§è¡Œè¿™ä¸ªæ–¹æ³•éƒ½å¯ä»¥ï¼‰ã€‚</li><li>é‡‡ç”¨åŠ¨æ€ä»£ç†çš„æœºåˆ¶å¯ä»¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</li></ol><h2 id="åŠ¨æ€ä»£ç†çš„å®ç°åŸç†"><a href="#åŠ¨æ€ä»£ç†çš„å®ç°åŸç†" class="headerlink" title="åŠ¨æ€ä»£ç†çš„å®ç°åŸç†"></a>åŠ¨æ€ä»£ç†çš„å®ç°åŸç†</h2><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡<code>Proxy.newInstance()</code>æ¥åˆ›å»ºçš„ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼š</p><pre><code class="java">// java.lang.reflect.Proxy.javapublic static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)        throws IllegalArgumentException &#123;    Objects.requireNonNull(h);    final Class&lt;?&gt;[] intfs = interfaces.clone();    // Android ä¸­ä¼šç§»é™¤ä¸‹é¢å‡ è¡Œä»£ç ï¼šSecurityManager ç›¸å…³    final SecurityManager sm = System.getSecurityManager();    if (sm != null) &#123;        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);    &#125;    // æŸ¥æ‰¾æˆ–è€…ç”ŸæˆæŒ‡å®šçš„ä»£ç†ç±»    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);    // ä½¿ç”¨æŒ‡å®šçš„è°ƒç”¨è€…è°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°    try &#123;        if (sm != null) &#123;            checkNewProxyPermission(Reflection.getCallerClass(), cl);        &#125;        final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);        final InvocationHandler ih = h;        if (!Modifier.isPublic(cl.getModifiers())) &#123;            AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;                public Void run() &#123;                    cons.setAccessible(true);                    return null;                &#125;            &#125;);        &#125;        return cons.newInstance(new Object[]&#123;h&#125;);    &#125; catch (IllegalAccessException|InstantiationException e) &#123;        throw new InternalError(e.toString(), e);    &#125; catch (InvocationTargetException e) &#123;        Throwable t = e.getCause();        if (t instanceof RuntimeException) &#123;            throw (RuntimeException) t;        &#125; else &#123;            throw new InternalError(t.toString(), t);        &#125;    &#125; catch (NoSuchMethodException e) &#123;        throw new InternalError(e.toString(), e);    &#125;&#125;</code></pre><p>ä¸Šæ–¹ä»£ç ä¸­ï¼Œ<code>getProxyClass0()</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class="java">// java.lang.reflect.Proxy.java// ç”Ÿæˆä»£ç†ç±»ã€‚åœ¨è°ƒç”¨è¿™é‡Œä¹‹å‰ï¼Œå¿…é¡»è¦å…ˆè°ƒç”¨ checkProxyAccess() æ–¹æ³•private static Class&lt;?&gt; getProxyClass0(ClassLoader loader,                                        Class&lt;?&gt;... interfaces) &#123;    if (interfaces.length &gt; 65535) &#123;        throw new IllegalArgumentException(&quot;interface limit exceeded&quot;);    &#125;    // å¦‚æœæŒ‡å®šæ¥å£çš„ä»£ç†ç±»å·²ç»å­˜åœ¨äºç¼“å­˜ proxyClassCache ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–äº†è¿”å›å³å¯ï¼›    // å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æŒ‡å®šä»£ç†å¯¹è±¡ï¼Œåˆ™é€šè¿‡ ProxyClassFactory æ¥åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚    return proxyClassCache.get(loader, interfaces);&#125;</code></pre><p>ç»§ç»­çœ‹ ProxyClassFactory æ˜¯æ€æ ·åˆ›å»ºä»£ç†ç±»çš„ï¼š</p><pre><code class="java">// java.lang.reflect.Proxy.java/** * ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œç»™å®š ClassLoader å’Œ interface çš„åˆ—è¡¨ä¹‹åï¼Œå¯ä»¥åˆ›å»ºã€å®šä¹‰å¹¶è¿”å›ä»£ç†ç±» */private static final class ProxyClassFactory    implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt;&#123;    // æ‰€æœ‰çš„ä»£ç†ç±»åå‰ç¼€ç»™å®ƒææˆ &quot;$Proxy&quot;    private static final String proxyClassNamePrefix = &quot;$Proxy&quot;;    // æ¯ä¸ªä»£ç†ç±»åç”Ÿæˆæ—¶å†æ¥ä¸ªæ•°å­—ç¼–å·    private static final AtomicLong nextUniqueNumber = new AtomicLong();    @Override    public Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123;        Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = new IdentityHashMap&lt;&gt;(interfaces.length);        for (Class&lt;?&gt; intf : interfaces) &#123;            Class&lt;?&gt; interfaceClass = null;            try &#123;                // ç”¨Class.forName æŸ¥æ‰¾ä¸€ä¸‹ç»™å®šçš„æ¥å£æ˜¯å¦å­˜åœ¨                interfaceClass = Class.forName(intf.getName(), false, loader);            &#125; catch (ClassNotFoundException e) &#123;            &#125;            // ç„¶åå¯¹æ¯” apply ä¸­ä¼ å…¥çš„ class æ˜¯å¦ä¸ ClassLoader ä¸­æ‰¾åˆ°çš„ class æ˜¯å¦ç›¸åŒ            if (interfaceClass != intf) &#123;                throw new IllegalArgumentException(                    intf + &quot; is not visible from class loader&quot;);            &#125;            // éªŒè¯è¿™ä¸ª class æ˜¯ä¸æ˜¯æ¥å£            if (!interfaceClass.isInterface()) &#123;                throw new IllegalArgumentException(                    interfaceClass.getName() + &quot; is not an interface&quot;);            &#125;            // éªŒè¯è¿™ä¸ª class çš„å”¯ä¸€æ€§            if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) &#123;                throw new IllegalArgumentException(                    &quot;repeated interface: &quot; + interfaceClass.getName());            &#125;        &#125;        String proxyPkg = null;     // è¦ç”Ÿæˆçš„ä»£ç†ç±»çš„åŒ…å        int accessFlags = Modifier.PUBLIC | Modifier.FINAL;        // è®°å½•ä¸‹ä¸€ä¸ªé public çš„ class çš„åŒ…åï¼Œä»£ç†ç±»ä¹Ÿå°†ä¼šè¢«å®šä¹‰åœ¨è¿™ä¸ªåŒ…é‡Œã€‚        // åŒæ—¶éªŒè¯æ‰€æœ‰çš„é public çš„ class éƒ½åœ¨è¿™ä¸ªåŒ…é‡Œã€‚        for (Class&lt;?&gt; intf : interfaces) &#123;            int flags = intf.getModifiers();            if (!Modifier.isPublic(flags)) &#123;                accessFlags = Modifier.FINAL;                String name = intf.getName();                int n = name.lastIndexOf(&#39;.&#39;);                String pkg = ((n == -1) ? &quot;&quot; : name.substring(0, n + 1));                if (proxyPkg == null) &#123;                    proxyPkg = pkg;                &#125; else if (!pkg.equals(proxyPkg)) &#123;                    throw new IllegalArgumentException(                        &quot;non-public interfaces from different packages&quot;);                &#125;            &#125;        &#125;        // å¦‚æœæ²¡æœ‰é public çš„ classï¼Œå°±ä½¿ç”¨ com.sun.proxy åŒ…        if (proxyPkg == null) &#123;            proxyPkg = ReflectUtil.PROXY_PACKAGE + &quot;.&quot;;        &#125;        // æä¸ªåå­—ç»™è¿™ä¸ªä»£ç†ç±»        long num = nextUniqueNumber.getAndIncrement();        String proxyName = proxyPkg + proxyClassNamePrefix + num;        // ç”Ÿæˆè¿™ä¸ªä»£ç†ç±»çš„å­—èŠ‚ç         byte[] proxyClassFile = ProxyGenerator.generateProxyClass(            proxyName, interfaces, accessFlags);        try &#123;            // è°ƒç”¨ native æ–¹æ³•            // private static native Class&lt;?&gt; defineClass0(ClassLoader loader, String name,            //                                   byte[] b, int off, int len);            return defineClass0(loader, proxyName,                                proxyClassFile, 0, proxyClassFile.length);        &#125; catch (ClassFormatError e) &#123;            /*                * A ClassFormatError here means that (barring bugs in the                * proxy class generation code) there was some other                * invalid aspect of the arguments supplied to the proxy                * class creation (such as virtual machine limitations                * exceeded).                */            throw new IllegalArgumentException(e.toString());        &#125;    &#125;&#125;</code></pre><p>çœ‹æ¥ä¸»è¦ç”Ÿæˆ class çš„è¿‡ç¨‹åœ¨<code>ProxyGenerator.generateProxyClass()</code>ä¸­ï¼Œç»§ç»­è·Ÿè¸ªï¼š</p><pre><code class="java">// sun.misc.ProxyGenerator.java// æ­¤å¤„æ˜¯ Java çš„ä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼Œæ˜¯å¦è¦ä¿å­˜ç”Ÿæˆçš„æ–‡ä»¶private static final boolean saveGeneratedFiles = (Boolean)AccessController.doPrivileged(new GetBooleanAction(&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;));public static byte[] generateProxyClass(final String var0, Class&lt;?&gt;[] var1, int var2) &#123;    ProxyGenerator var3 = new ProxyGenerator(var0, var1, var2);    // ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶    final byte[] var4 = var3.generateClassFile();    if (saveGeneratedFiles) &#123;        AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;            public Void run() &#123;                try &#123;                    int var1 = var0.lastIndexOf(46);                    Path var2;                    if (var1 &gt; 0) &#123;                        Path var3 = Paths.get(var0.substring(0, var1).replace(&#39;.&#39;, File.separatorChar));                        Files.createDirectories(var3);                        var2 = var3.resolve(var0.substring(var1 + 1, var0.length()) + &quot;.class&quot;);                    &#125; else &#123;                        var2 = Paths.get(var0 + &quot;.class&quot;);                    &#125;                    Files.write(var2, var4, new OpenOption[0]);                    return null;                &#125; catch (IOException var4x) &#123;                    throw new InternalError(&quot;I/O exception saving generated file: &quot; + var4x);                &#125;            &#125;        &#125;);    &#125;    return var4;&#125;// ç”Ÿæˆ class æ–‡ä»¶private byte[] generateClassFile() &#123;    // å°† Object ä¸­çš„ä¸€äº›æ–¹æ³•æ·»åŠ åˆ°ä»£ç†ç±»ä¸­    this.addProxyMethod(hashCodeMethod, Object.class);    this.addProxyMethod(equalsMethod, Object.class);    this.addProxyMethod(toStringMethod, Object.class);    Class[] var1 = this.interfaces;    int var2 = var1.length;    int var3;    Class var4;    for(var3 = 0; var3 &lt; var2; ++var3) &#123;        var4 = var1[var3];        Method[] var5 = var4.getMethods();        int var6 = var5.length;        // å°† interface ä¸­çš„æ–¹æ³•æ·»åŠ åˆ°ä»£ç†ç±»ä¸­        for(int var7 = 0; var7 &lt; var6; ++var7) &#123;            Method var8 = var5[var7];            this.addProxyMethod(var8, var4);        &#125;    &#125;    Iterator var11 = this.proxyMethods.values().iterator();    List var12;    while(var11.hasNext()) &#123;        var12 = (List)var11.next();        checkReturnTypes(var12);    &#125;    Iterator var15;    try &#123;        // æ·»åŠ æ„é€ å‡½æ•°        this.methods.add(this.generateConstructor());        var11 = this.proxyMethods.values().iterator();        while(var11.hasNext()) &#123;            var12 = (List)var11.next();            var15 = var12.iterator();            while(var15.hasNext()) &#123;                ProxyGenerator.ProxyMethod var16 = (ProxyGenerator.ProxyMethod)var15.next();                this.fields.add(new ProxyGenerator.FieldInfo(var16.methodFieldName, &quot;Ljava/lang/reflect/Method;&quot;, 10));                this.methods.add(var16.generateMethod());            &#125;        &#125;        // æ·»åŠ é™æ€æ–¹æ³•        this.methods.add(this.generateStaticInitializer());    &#125; catch (IOException var10) &#123;        throw new InternalError(&quot;unexpected I/O Exception&quot;, var10);    &#125;    if (this.methods.size() &gt; 65535) &#123;        throw new IllegalArgumentException(&quot;method limit exceeded&quot;);    &#125; else if (this.fields.size() &gt; 65535) &#123;        throw new IllegalArgumentException(&quot;field limit exceeded&quot;);    &#125; else &#123;        this.cp.getClass(dotToSlash(this.className));        this.cp.getClass(&quot;java/lang/reflect/Proxy&quot;);        var1 = this.interfaces;        var2 = var1.length;        for(var3 = 0; var3 &lt; var2; ++var3) &#123;            var4 = var1[var3];            this.cp.getClass(dotToSlash(var4.getName()));        &#125;        this.cp.setReadOnly();        ByteArrayOutputStream var13 = new ByteArrayOutputStream();        DataOutputStream var14 = new DataOutputStream(var13);        try &#123;            var14.writeInt(-889275714);            var14.writeShort(0);            var14.writeShort(49);            this.cp.write(var14);            var14.writeShort(this.accessFlags);            var14.writeShort(this.cp.getClass(dotToSlash(this.className)));            var14.writeShort(this.cp.getClass(&quot;java/lang/reflect/Proxy&quot;));            var14.writeShort(this.interfaces.length);            Class[] var17 = this.interfaces;            int var18 = var17.length;            for(int var19 = 0; var19 &lt; var18; ++var19) &#123;                Class var22 = var17[var19];                var14.writeShort(this.cp.getClass(dotToSlash(var22.getName())));            &#125;            var14.writeShort(this.fields.size());            var15 = this.fields.iterator();            while(var15.hasNext()) &#123;                ProxyGenerator.FieldInfo var20 = (ProxyGenerator.FieldInfo)var15.next();                var20.write(var14);            &#125;            var14.writeShort(this.methods.size());            var15 = this.methods.iterator();            while(var15.hasNext()) &#123;                ProxyGenerator.MethodInfo var21 = (ProxyGenerator.MethodInfo)var15.next();                var21.write(var14);            &#125;            var14.writeShort(0);            return var13.toByteArray();        &#125; catch (IOException var9) &#123;            throw new InternalError(&quot;unexpected I/O Exception&quot;, var9);        &#125;    &#125;&#125;private void addProxyMethod(Method var1, Class&lt;?&gt; var2) &#123;    String var3 = var1.getName();    Class[] var4 = var1.getParameterTypes();    Class var5 = var1.getReturnType();    Class[] var6 = var1.getExceptionTypes();    String var7 = var3 + getParameterDescriptors(var4);    Object var8 = (List)this.proxyMethods.get(var7);    if (var8 != null) &#123;        Iterator var9 = ((List)var8).iterator();        while(var9.hasNext()) &#123;            ProxyGenerator.ProxyMethod var10 = (ProxyGenerator.ProxyMethod)var9.next();            if (var5 == var10.returnType) &#123;                ArrayList var11 = new ArrayList();                collectCompatibleTypes(var6, var10.exceptionTypes, var11);                collectCompatibleTypes(var10.exceptionTypes, var6, var11);                var10.exceptionTypes = new Class[var11.size()];                var10.exceptionTypes = (Class[])var11.toArray(var10.exceptionTypes);                return;            &#125;        &#125;    &#125; else &#123;        var8 = new ArrayList(3);        this.proxyMethods.put(var7, var8);    &#125;    ((List)var8).add(new ProxyGenerator.ProxyMethod(var3, var4, var5, var6, var2));&#125;</code></pre><p>å­—èŠ‚ç ç”Ÿæˆä¹‹åï¼Œè°ƒç”¨ native æ–¹æ³•<code>defineClass0()</code>æ¥è§£æå­—èŠ‚ç ï¼Œç”Ÿæˆäº†ä»£ç†ç±»ã€‚</p><p>native å±‚çš„å…·ä½“å®ç°<a href="https://stackoverflow.com/questions/40217559/how-to-find-the-native-method-from-the-jvm-source-code">çœ‹è¿™ä¸ªé“¾æ¥</a></p><p>ç”¨ä¸€ä¸ªæµç¨‹å›¾æ¥æ€»ç»“ä¸€ä¸‹ï¼š</p><div style="width: 100%; text-align:center;"><p><img src="/img/29.png"></p></div>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> Java </tag>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java åŸºç¡€é¢è¯•é¢˜</title>
      <link href="/2019-11-30/java-junior-interview/"/>
      <url>/2019-11-30/java-junior-interview/</url>
      
        <content type="html"><![CDATA[<p>é›†åˆäº†ä¸€äº› Java çš„åŸºç¡€é¢è¯•é¢˜ã€‚</p><span id="more"></span><h2 id="ä¸€ã€é¢å‘å¯¹è±¡-ï¼ˆâ­â­â­ï¼‰"><a href="#ä¸€ã€é¢å‘å¯¹è±¡-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="ä¸€ã€é¢å‘å¯¹è±¡ ï¼ˆâ­â­â­ï¼‰"></a>ä¸€ã€é¢å‘å¯¹è±¡ ï¼ˆâ­â­â­ï¼‰</h2><h3 id="1ã€è°ˆè°ˆå¯¹javaå¤šæ€çš„ç†è§£ï¼Ÿ"><a href="#1ã€è°ˆè°ˆå¯¹javaå¤šæ€çš„ç†è§£ï¼Ÿ" class="headerlink" title="1ã€è°ˆè°ˆå¯¹javaå¤šæ€çš„ç†è§£ï¼Ÿ"></a>1ã€è°ˆè°ˆå¯¹javaå¤šæ€çš„ç†è§£ï¼Ÿ</h3><p>å¤šæ€æ˜¯æŒ‡çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•è¢«å­ç±»é‡å†™æ—¶ï¼Œå¯ä»¥äº§ç”Ÿè‡ªå·±çš„åŠŸèƒ½è¡Œä¸ºï¼ŒåŒä¸€ä¸ªæ“ä½œä½œç”¨äºä¸åŒå¯¹è±¡ï¼Œå¯ä»¥æœ‰ä¸åŒçš„è§£é‡Šï¼Œäº§ç”Ÿä¸åŒçš„æ‰§è¡Œç»“æœã€‚</p><p>å¤šæ€çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶ï¼š</p><ul><li>ç»§æ‰¿çˆ¶ç±»ã€‚</li><li>é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚</li><li>çˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ã€‚</li></ul><p>ä»€ä¹ˆæ˜¯å¤šæ€</p><p><strong>é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚</strong> ä»ä¸€å®šè§’åº¦æ¥çœ‹ï¼Œå°è£…å’Œç»§æ‰¿å‡ ä¹éƒ½æ˜¯ä¸ºå¤šæ€è€Œå‡†å¤‡çš„ã€‚è¿™æ˜¯æˆ‘ä»¬æœ€åä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„çŸ¥è¯†ç‚¹ã€‚</p><p><strong>å¤šæ€çš„å®šä¹‰ï¼š</strong> æŒ‡å…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯åšå‡ºå“åº”ã€‚å³åŒä¸€æ¶ˆæ¯å¯ä»¥æ ¹æ®å‘é€å¯¹è±¡çš„ä¸åŒè€Œé‡‡ç”¨å¤šç§ä¸åŒçš„è¡Œä¸ºæ–¹å¼ï¼ˆå‘é€æ¶ˆæ¯å°±æ˜¯æŒ‡å‡½æ•°è°ƒç”¨ï¼‰ã€‚</p><p><strong>å®ç°å¤šæ€çš„æŠ€æœ¯ç§°ä¸ºï¼š</strong> åŠ¨æ€ç»‘å®šï¼ˆdynamic bindingï¼‰ï¼Œæ˜¯æŒ‡åœ¨æ‰§è¡ŒæœŸé—´åˆ¤æ–­æ‰€å¼•ç”¨å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œæ ¹æ®å…¶å®é™…çš„ç±»å‹è°ƒç”¨å…¶ç›¸åº”çš„æ–¹æ³•ã€‚</p><p><strong>å¤šæ€çš„ä½œç”¨ï¼š</strong> æ¶ˆé™¤ç±»å‹ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚</p><p>ç°å®ä¸­ï¼Œå…³äºå¤šæ€çš„ä¾‹å­ä¸èƒœæšä¸¾ã€‚æ¯”æ–¹è¯´æŒ‰ä¸‹ F1 é”®è¿™ä¸ªåŠ¨ä½œï¼Œå¦‚æœå½“å‰åœ¨ Flash ç•Œé¢ä¸‹å¼¹å‡ºçš„å°±æ˜¯ AS 3 çš„å¸®åŠ©æ–‡æ¡£ï¼›å¦‚æœå½“å‰åœ¨ Word ä¸‹å¼¹å‡ºçš„å°±æ˜¯ Word å¸®åŠ©ï¼›åœ¨ Windows ä¸‹å¼¹å‡ºçš„å°±æ˜¯ Windows å¸®åŠ©å’Œæ”¯æŒã€‚åŒä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨ä¸åŒçš„å¯¹è±¡ä¸Šä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚</p><p>å¤šæ€çš„å¥½å¤„ï¼š</p><p>1.å¯æ›¿æ¢æ€§ï¼ˆsubstitutabilityï¼‰ã€‚å¤šæ€å¯¹å·²å­˜åœ¨ä»£ç å…·æœ‰å¯æ›¿æ¢æ€§ã€‚ä¾‹å¦‚ï¼Œå¤šæ€å¯¹åœ†Circleç±»å·¥ä½œï¼Œå¯¹å…¶ä»–ä»»ä½•åœ†å½¢å‡ ä½•ä½“ï¼Œå¦‚åœ†ç¯ï¼Œä¹ŸåŒæ ·å·¥ä½œã€‚</p><p>2.å¯æ‰©å……æ€§ï¼ˆextensibilityï¼‰ã€‚å¤šæ€å¯¹ä»£ç å…·æœ‰å¯æ‰©å……æ€§ã€‚å¢åŠ æ–°çš„å­ç±»ä¸å½±å“å·²å­˜åœ¨ç±»çš„å¤šæ€æ€§ã€ç»§æ‰¿æ€§ï¼Œä»¥åŠå…¶ä»–ç‰¹æ€§çš„è¿è¡Œå’Œæ“ä½œã€‚å®é™…ä¸Šæ–°åŠ å­ç±»æ›´å®¹æ˜“è·å¾—å¤šæ€åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨å®ç°äº†åœ†é”¥ã€åŠåœ†é”¥ä»¥åŠåŠçƒä½“çš„å¤šæ€åŸºç¡€ä¸Šï¼Œå¾ˆå®¹æ˜“å¢æ·»çƒä½“ç±»çš„å¤šæ€æ€§ã€‚</p><p>3.æ¥å£æ€§ï¼ˆinterface-abilityï¼‰ã€‚å¤šæ€æ˜¯è¶…ç±»é€šè¿‡æ–¹æ³•ç­¾åï¼Œå‘å­ç±»æä¾›äº†ä¸€ä¸ªå…±åŒæ¥å£ï¼Œç”±å­ç±»æ¥å®Œå–„æˆ–è€…è¦†ç›–å®ƒè€Œå®ç°çš„ã€‚</p><p>4.çµæ´»æ€§ï¼ˆflexibilityï¼‰ã€‚å®ƒåœ¨åº”ç”¨ä¸­ä½“ç°äº†çµæ´»å¤šæ ·çš„æ“ä½œï¼Œæé«˜äº†ä½¿ç”¨æ•ˆç‡ã€‚</p><p>5.ç®€åŒ–æ€§ï¼ˆsimplicityï¼‰ã€‚å¤šæ€ç®€åŒ–å¯¹åº”ç”¨è½¯ä»¶çš„ä»£ç ç¼–å†™å’Œä¿®æ”¹è¿‡ç¨‹ï¼Œå°¤å…¶åœ¨å¤„ç†å¤§é‡å¯¹è±¡çš„è¿ç®—å’Œæ“ä½œæ—¶ï¼Œè¿™ä¸ªç‰¹ç‚¹å°¤ä¸ºçªå‡ºå’Œé‡è¦ã€‚</p><p>Javaä¸­å¤šæ€çš„å®ç°æ–¹å¼ï¼šæ¥å£å®ç°ï¼Œç»§æ‰¿çˆ¶ç±»è¿›è¡Œæ–¹æ³•é‡å†™ï¼ŒåŒä¸€ä¸ªç±»ä¸­è¿›è¡Œæ–¹æ³•é‡è½½ã€‚</p><h3 id="2ã€ä½ æ‰€çŸ¥é“çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#2ã€ä½ æ‰€çŸ¥é“çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="2ã€ä½ æ‰€çŸ¥é“çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ"></a>2ã€ä½ æ‰€çŸ¥é“çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ</h3><p>ç­”ï¼šJava ä¸­ä¸€èˆ¬è®¤ä¸ºæœ‰23ç§è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰€æœ‰çš„éƒ½ä¼šï¼Œä½†æ˜¯å…¶ä¸­å¸¸ç”¨çš„ç§è®¾è®¡æ¨¡å¼åº”è¯¥å»æŒæ¡ã€‚ä¸‹é¢åˆ—å‡ºäº†æ‰€æœ‰çš„è®¾è®¡æ¨¡å¼ã€‚è¦æŒæ¡çš„è®¾è®¡æ¨¡å¼æˆ‘å•ç‹¬åˆ—å‡ºæ¥äº†ï¼Œå½“ç„¶èƒ½æŒæ¡çš„è¶Šå¤šè¶Šå¥½ã€‚</p><p>æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><p><strong>åˆ›å»ºå‹æ¨¡å¼</strong>ï¼Œå…±äº”ç§ï¼š</p><ol><li>å·¥å‚æ–¹æ³•æ¨¡å¼</li><li>æŠ½è±¡å·¥å‚æ¨¡å¼</li><li>å•ä¾‹æ¨¡å¼</li><li>å»ºé€ è€…æ¨¡å¼</li><li>åŸå‹æ¨¡å¼</li></ol><p><strong>ç»“æ„å‹æ¨¡å¼</strong>ï¼Œå…±ä¸ƒç§ï¼š</p><ol><li>é€‚é…å™¨æ¨¡å¼</li><li>è£…é¥°å™¨æ¨¡å¼</li><li>ä»£ç†æ¨¡å¼</li><li>å¤–è§‚æ¨¡å¼</li><li>æ¡¥æ¥æ¨¡å¼</li><li>ç»„åˆæ¨¡å¼</li><li>äº«å…ƒæ¨¡å¼</li></ol><p><strong>è¡Œä¸ºå‹æ¨¡å¼</strong>ï¼Œå…±åä¸€ç§ï¼š</p><ol><li>ç­–ç•¥æ¨¡å¼</li><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</li><li>è§‚è€…æ¨¡å¼</li><li>è¿­ä»£å­æ¨¡å¼</li><li>è´£ä»»é“¾æ¨¡å¼</li><li>å‘½ä»¤æ¨¡å¼</li><li>å¤‡å¿˜å½•æ¨¡å¼</li><li>çŠ¶æ€æ¨¡å¼</li><li>è®¿é—®è€…æ¨¡å¼</li><li>ä¸­ä»‹è€…æ¨¡å¼</li><li>è§£é‡Šå™¨æ¨¡å¼</li></ol><p><a href="/design-pattern-must/">å…·ä½“å¯è§æˆ‘çš„è®¾è®¡æ¨¡å¼æ€»ç»“ç¬”è®°</a></p><h3 id="3ã€é€šè¿‡é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ"><a href="#3ã€é€šè¿‡é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="3ã€é€šè¿‡é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ"></a>3ã€é€šè¿‡é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</h3><ol><li>ä¸ç”¨<code>synchronized</code>ï¼ŒèŠ‚çœæ—¶é—´ã€‚ </li><li>è°ƒç”¨<code>getInstance()</code>çš„æ—¶å€™æ‰ä¼šåˆ›å»ºå¯¹è±¡ï¼Œä¸è°ƒç”¨ä¸åˆ›å»ºï¼ŒèŠ‚çœç©ºé—´ï¼Œè¿™æœ‰ç‚¹åƒæ‡’æ±‰å¼ã€‚</li></ol><h3 id="4ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ"><a href="#4ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ" class="headerlink" title="4ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ"></a>4ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ</h3><p>é™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†çš„åŒºåˆ«åœ¨äºä»£ç†ç±»ç”Ÿæˆçš„æ—¶é—´ä¸åŒï¼Œå³æ ¹æ®ç¨‹åºè¿è¡Œå‰ä»£ç†ç±»æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¯ä»¥å°†ä»£ç†åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚å¦‚æœéœ€è¦å¯¹å¤šä¸ªç±»è¿›è¡Œä»£ç†ï¼Œå¹¶ä¸”ä»£ç†çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç”¨é™æ€ä»£ç†é‡å¤ç¼–å†™ä»£ç†ç±»å°±éå¸¸çš„éº»çƒ¦ï¼Œå¯ä»¥ç”¨åŠ¨æ€ä»£ç†åŠ¨æ€çš„ç”Ÿæˆä»£ç†ç±»ã€‚</p><pre><code class="java">// ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡public Object getProxyInstance() &#123;    return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),            new InvocationHandler() &#123;                @Override                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;                    System.out.println(&quot;å¼€å¯äº‹åŠ¡&quot;);                    // æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•                    Object returnValue = method.invoke(target, args);                    System.out.println(&quot;æäº¤äº‹åŠ¡&quot;);                    return null;                &#125;            &#125;);&#125;</code></pre><ul><li>é™æ€ä»£ç†ä½¿ç”¨åœºæ™¯ï¼šå››å¤§ç»„ä»¶åŒAIDLä¸AMSè¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡</li><li>åŠ¨æ€ä»£ç†ä½¿ç”¨åœºæ™¯ï¼šRetrofitä½¿ç”¨äº†åŠ¨æ€ä»£ç†æå¤§åœ°æå‡äº†æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li></ul><h3 id="5ã€ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€Builderæ¨¡å¼çš„åŒºåˆ«ï¼Ÿ"><a href="#5ã€ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€Builderæ¨¡å¼çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="5ã€ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€Builderæ¨¡å¼çš„åŒºåˆ«ï¼Ÿ"></a>5ã€ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€Builderæ¨¡å¼çš„åŒºåˆ«ï¼Ÿ</h3><ul><li>ç®€å•å·¥å‚æ¨¡å¼ï¼šä¸€ä¸ªå·¥å‚æ–¹æ³•åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ã€‚</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šä¸€ä¸ªå…·ä½“çš„å·¥å‚ç±»è´Ÿè´£åˆ›å»ºä¸€ä¸ªå…·ä½“å¯¹è±¡ç±»å‹ã€‚</li><li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šä¸€ä¸ªå…·ä½“çš„å·¥å‚ç±»è´Ÿè´£åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³çš„å¯¹è±¡ã€‚</li><li>Builderæ¨¡å¼ï¼šå¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œå®ƒæ›´æ³¨é‡å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚</li></ul><h3 id="6ã€è£…é¥°æ¨¡å¼å’Œä»£ç†æ¨¡å¼æœ‰å“ªäº›åŒºåˆ«-ï¼Ÿä¸æ¡¥æ¥æ¨¡å¼ç›¸æ¯”å‘¢ï¼Ÿ"><a href="#6ã€è£…é¥°æ¨¡å¼å’Œä»£ç†æ¨¡å¼æœ‰å“ªäº›åŒºåˆ«-ï¼Ÿä¸æ¡¥æ¥æ¨¡å¼ç›¸æ¯”å‘¢ï¼Ÿ" class="headerlink" title="6ã€è£…é¥°æ¨¡å¼å’Œä»£ç†æ¨¡å¼æœ‰å“ªäº›åŒºåˆ« ï¼Ÿä¸æ¡¥æ¥æ¨¡å¼ç›¸æ¯”å‘¢ï¼Ÿ"></a>6ã€è£…é¥°æ¨¡å¼å’Œä»£ç†æ¨¡å¼æœ‰å“ªäº›åŒºåˆ« ï¼Ÿä¸æ¡¥æ¥æ¨¡å¼ç›¸æ¯”å‘¢ï¼Ÿ</h3><ol><li>è£…é¥°æ¨¡å¼æ˜¯ä»¥å®¢æˆ·ç«¯é€æ˜çš„æ–¹å¼æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œæ˜¯ç»§æ‰¿å…³ç³»çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼›è€Œä»£ç†æ¨¡å¼åˆ™æ˜¯ç»™ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ¥æ§åˆ¶å¯¹åŸæœ‰å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>è£…é¥°æ¨¡å¼åº”è¯¥ä¸ºæ‰€è£…é¥°çš„å¯¹è±¡å¢å¼ºåŠŸèƒ½ï¼›ä»£ç†æ¨¡å¼å¯¹ä»£ç†çš„å¯¹è±¡æ–½åŠ æ§åˆ¶ï¼Œä½†ä¸å¯¹å¯¹è±¡æœ¬èº«çš„åŠŸèƒ½è¿›è¡Œå¢åŠ ã€‚</li><li>æ¡¥æ¥æ¨¡å¼çš„ä½œç”¨äºä»£ç†ã€è£…é¥°æˆªç„¶ä¸åŒï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†åº”å¯¹æŸä¸ªç±»æ—æœ‰å¤šä¸ªå˜åŒ–ç»´åº¦å¯¼è‡´å­ç±»ç±»å‹æ€¥å‰§å¢å¤šçš„åœºæ™¯ã€‚é€šè¿‡æ¡¥æ¥æ¨¡å¼å°†å¤šä¸ªå˜åŒ–ç»´åº¦éš”ç¦»å¼€ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ï¼Œæœ€åé€šè¿‡ç»„åˆä½¿å®ƒä»¬åº”å¯¹å¤šç»´å˜åŒ–ï¼Œå‡å°‘å­ç±»çš„æ•°é‡å’Œå¤æ‚åº¦ã€‚</li></ol><h3 id="7ã€å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ"><a href="#7ã€å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="7ã€å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ"></a>7ã€å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ</h3><p>å¤–è§‚æ¨¡å¼é‡ç‚¹æ˜¯å¯¹å¤–å°è£…ç»Ÿä¸€çš„é«˜å±‚æ¥å£ï¼Œä¾¿äºç”¨æˆ·ä½¿ç”¨ï¼›è€Œä¸­ä»‹æ¨¡å¼åˆ™æ˜¯é¿å…å¤šä¸ªäº’ç›¸åä½œçš„å¯¹è±¡ç›´æ¥å¼•ç”¨ï¼Œå®ƒä»¬ä¹‹é—´çš„äº¤äº’é€šè¿‡ä¸€ä¸ªä¸­ä»‹å¯¹è±¡è¿›è¡Œï¼Œä»è€Œä½¿å¾—å®ƒä»¬è€¦åˆæ¾æ•£ï¼Œèƒ½å¤Ÿæ˜“äºåº”å¯¹å˜åŒ–ã€‚</p><h3 id="8ã€ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ"><a href="#8ã€ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8ã€ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ"></a>8ã€ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ</h3><p>è™½ç„¶ä¸¤è€…çš„ç±»å‹ç»“æ„æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„æœ¬è´¨å´æ˜¯ä¸ä¸€æ ·çš„ã€‚ç­–ç•¥æ¨¡å¼é‡åœ¨æ•´ä¸ªç®—æ³•çš„æ›¿æ¢ï¼Œä¹Ÿå°±æ˜¯ç­–ç•¥çš„æ›¿æ¢ï¼Œè€ŒçŠ¶æ€æ¨¡å¼åˆ™æ˜¯é€šè¿‡çŠ¶æ€æ¥æ”¹å˜è¡Œä¸ºã€‚</p><h3 id="9ã€é€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼çš„å¼‚åŒï¼Ÿ"><a href="#9ã€é€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼çš„å¼‚åŒï¼Ÿ" class="headerlink" title="9ã€é€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼çš„å¼‚åŒï¼Ÿ"></a>9ã€é€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼çš„å¼‚åŒï¼Ÿ</h3><p>è¿™ä¸‰ä¸ªæ¨¡å¼çš„ç›¸åŒä¹‹å¤„æ˜¯ï¼Œå®ƒä»¬éƒ½ä½œç”¨äºç”¨æˆ·ä¸çœŸå®è¢«ä½¿ç”¨çš„ç±»æˆ–ç³»ç»Ÿä¹‹é—´ï¼Œä½œä¸€ä¸ªä¸­é—´å±‚ï¼Œèµ·åˆ°äº†è®©ç”¨æˆ·é—´æ¥åœ°è°ƒç”¨çœŸå®çš„ç±»çš„ä½œç”¨ã€‚å®ƒä»¬çš„ä¸åŒä¹‹å¤–åœ¨äºï¼Œå¦‚ä¸Šæ‰€è¿°çš„åº”ç”¨åœºåˆä¸åŒå’Œæœ¬è´¨çš„æ€æƒ³ä¸åŒã€‚</p><p>ä»£ç†ä¸å¤–è§‚çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œä»£ç†å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå•ä¸€å¯¹è±¡ï¼Œè€Œå¤–è§‚å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå­ç³»ç»Ÿï¼Œä»£ç†çš„å®¢æˆ·å¯¹è±¡æ— æ³•ç›´æ¥è®¿é—®å¯¹è±¡ï¼Œç”±ä»£ç†æä¾›å•ç‹¬çš„ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œè€Œé€šå¸¸å¤–è§‚å¯¹è±¡æä¾›å¯¹å­ç³»ç»Ÿå„å…ƒä»¶åŠŸèƒ½çš„ç®€åŒ–çš„å…±åŒå±‚æ¬¡çš„è°ƒç”¨æ¥å£ã€‚ä»£ç†æ˜¯ä¸€ç§åŸæ¥å¯¹è±¡çš„ä»£è¡¨ï¼Œå…¶å®ƒéœ€è¦ä¸è¿™ä¸ªå¯¹è±¡æ‰“äº¤é“çš„æ“ä½œéƒ½æ˜¯å’Œè¿™ä¸ªä»£è¡¨äº¤æ¶‰çš„ã€‚è€Œé€‚é…å™¨åˆ™ä¸éœ€è¦è™šæ„å‡ºä¸€ä¸ªä»£è¡¨è€…ï¼Œåªéœ€è¦ä¸ºåº”ä»˜ç‰¹å®šä½¿ç”¨ç›®çš„ï¼Œå°†åŸæ¥çš„ç±»è¿›è¡Œä¸€äº›ç»„åˆã€‚</p><p>å¤–è§‚ä¸é€‚é…å™¨éƒ½æ˜¯å¯¹ç°å­˜ç³»ç»Ÿçš„å°è£…ã€‚å¤–è§‚å®šä¹‰çš„æ–°çš„æ¥å£ï¼Œè€Œé€‚é…å™¨åˆ™æ˜¯å¤ç”¨ä¸€ä¸ªåŸæœ‰çš„æ¥å£ï¼Œé€‚é…å™¨æ˜¯ä½¿ä¸¤ä¸ªå·²æœ‰çš„æ¥å£ååŒå·¥ä½œï¼Œè€Œå¤–è§‚åˆ™æ˜¯ä¸ºç°å­˜ç³»ç»Ÿæä¾›ä¸€ä¸ªæ›´ä¸ºæ–¹ä¾¿çš„è®¿é—®æ¥å£ã€‚å¦‚æœç¡¬è¦è¯´å¤–è§‚æ˜¯é€‚é…ï¼Œé‚£ä¹ˆé€‚é…å™¨æœ‰ç”¨æ¥é€‚é…å¯¹è±¡çš„ï¼Œè€Œå¤–è§‚æ˜¯ç”¨æ¥é€‚é…æ•´ä¸ªå­ç³»ç»Ÿçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤–è§‚æ‰€é’ˆå¯¹çš„å¯¹è±¡çš„ç²’åº¦æ›´å¤§ã€‚</p><p>ä»£ç†æ¨¡å¼æä¾›ä¸çœŸå®çš„ç±»ä¸€è‡´çš„æ¥å£ï¼Œæ„åœ¨ç”¨ä»£ç†ç±»æ¥å¤„ç†çœŸå®çš„ç±»ï¼Œå®ç°ä¸€äº›ç‰¹å®šçš„æœåŠ¡æˆ–çœŸå®ç±»çš„éƒ¨åˆ†åŠŸèƒ½ï¼ŒFacadeï¼ˆå¤–è§‚ï¼‰æ¨¡å¼æ³¨é‡ç®€åŒ–æ¥å£ï¼ŒAdapterï¼ˆé€‚é…å™¨ï¼‰æ¨¡å¼æ³¨é‡è½¬æ¢æ¥å£ã€‚</p><h3 id="10ã€ä»£ç çš„åå‘³é“ï¼š"><a href="#10ã€ä»£ç çš„åå‘³é“ï¼š" class="headerlink" title="10ã€ä»£ç çš„åå‘³é“ï¼š"></a>10ã€ä»£ç çš„åå‘³é“ï¼š</h3><ol><li><strong>ä»£ç é‡å¤ã€‚</strong> ä»£ç é‡å¤å‡ ä¹æ˜¯æœ€å¸¸è§çš„å¼‚å‘³äº†ã€‚ä»–ä¹Ÿæ˜¯Refactoring çš„ä¸»è¦ç›®æ ‡ä¹‹ä¸€ã€‚ä»£ç é‡å¤å¾€å¾€æ¥è‡ªäºcopy-and-paste çš„ç¼–ç¨‹é£æ ¼ã€‚</li><li><strong>æ–¹æ³•è¿‡é•¿ã€‚</strong> ä¸€ä¸ªæ–¹æ³•åº”å½“å…·æœ‰è‡ªæˆ‘ç‹¬ç«‹çš„æ„å›¾ï¼Œä¸è¦æŠŠå‡ ä¸ªæ„å›¾æ”¾åœ¨ä¸€èµ·ã€‚</li><li><strong>ç±»æä¾›çš„åŠŸèƒ½å¤ªå¤šã€‚</strong> æŠŠå¤ªå¤šçš„è´£ä»»äº¤ç»™äº†ä¸€ä¸ªç±»ï¼Œä¸€ä¸ªç±»åº”è¯¥ä»…æä¾›ä¸€ä¸ªå•ä¸€çš„åŠŸèƒ½ã€‚</li><li><strong>æ•°æ®æ³¥å›¢ã€‚</strong> æŸäº›æ•°æ®é€šå¸¸åƒå­©å­ä¸€æ ·æˆç¾¤ç©è€ï¼šä¸€èµ·å‡ºç°åœ¨å¾ˆå¤šç±»çš„æˆå‘˜å˜é‡ä¸­ï¼Œä¸€èµ·å‡ºç°åœ¨è®¸å¤šæ–¹æ³•çš„å‚æ•°ä¸­â€¦..ï¼Œè¿™äº›æ•°æ®æˆ–è®¸åº”è¯¥è‡ªå·±ç‹¬ç«‹å½¢æˆå¯¹è±¡ã€‚ æ¯”å¦‚ä»¥å•ä¾‹çš„å½¢å¼å¯¹å¤–æä¾›è‡ªå·±çš„å®ä¾‹ã€‚</li><li><strong>å†—èµ˜ç±»ã€‚</strong> ä¸€ä¸ªå¹²æ´»ä¸å¤šçš„ç±»ã€‚ç±»çš„ç»´æŠ¤éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œå¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…äº†å¤ªå°‘çš„è´£ä»»ï¼Œåº”å½“æ¶ˆé™¤å®ƒã€‚ </li><li><strong>éœ€è¦å¤ªå¤šæ³¨é‡Šã€‚</strong> ç»å¸¸è§‰å¾—è¦å†™å¾ˆå¤šæ³¨é‡Šè¡¨ç¤ºä½ çš„ä»£ç éš¾ä»¥ç†è§£ã€‚å¦‚æœè¿™ç§æ„Ÿè§‰å¤ªå¤šï¼Œè¡¨ç¤ºä½ éœ€è¦Refactoringã€‚ </li></ol><h3 id="11ã€æ˜¯å¦èƒ½ä»Androidä¸­ä¸¾å‡ ä¸ªä¾‹å­è¯´è¯´ç”¨åˆ°äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼-ï¼Ÿ"><a href="#11ã€æ˜¯å¦èƒ½ä»Androidä¸­ä¸¾å‡ ä¸ªä¾‹å­è¯´è¯´ç”¨åˆ°äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼-ï¼Ÿ" class="headerlink" title="11ã€æ˜¯å¦èƒ½ä»Androidä¸­ä¸¾å‡ ä¸ªä¾‹å­è¯´è¯´ç”¨åˆ°äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ ï¼Ÿ"></a>11ã€æ˜¯å¦èƒ½ä»Androidä¸­ä¸¾å‡ ä¸ªä¾‹å­è¯´è¯´ç”¨åˆ°äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ ï¼Ÿ</h3><h4 id="AlertDialogã€Notificationæºç ä¸­ä½¿ç”¨äº†Buliderï¼ˆå»ºé€ è€…ï¼‰æ¨¡å¼å®Œæˆå‚æ•°çš„åˆå§‹åŒ–ï¼š"><a href="#AlertDialogã€Notificationæºç ä¸­ä½¿ç”¨äº†Buliderï¼ˆå»ºé€ è€…ï¼‰æ¨¡å¼å®Œæˆå‚æ•°çš„åˆå§‹åŒ–ï¼š" class="headerlink" title="AlertDialogã€Notificationæºç ä¸­ä½¿ç”¨äº†Buliderï¼ˆå»ºé€ è€…ï¼‰æ¨¡å¼å®Œæˆå‚æ•°çš„åˆå§‹åŒ–ï¼š"></a>AlertDialogã€Notificationæºç ä¸­ä½¿ç”¨äº†Buliderï¼ˆå»ºé€ è€…ï¼‰æ¨¡å¼å®Œæˆå‚æ•°çš„åˆå§‹åŒ–ï¼š</h4><p>åœ¨ AlertDialog çš„ Builder æ¨¡å¼ä¸­å¹¶æ²¡æœ‰çœ‹åˆ° Director è§’è‰²çš„å‡ºç°ï¼Œå…¶å®åœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼ŒAndroid å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§ GOF çš„ç»å…¸è®¾è®¡æ¨¡å¼æ¥å®ç°ï¼Œè€Œæ˜¯åšäº†ä¸€äº›ä¿®æ”¹ï¼Œä½¿å¾—è¿™ä¸ªæ¨¡å¼æ›´æ˜“äºä½¿ç”¨ã€‚è¿™ä¸ªçš„ AlertDialog.Builder åŒæ—¶æ‰®æ¼”äº†ä¸Šä¸‹æ–‡ä¸­æåˆ°çš„ builderã€ConcreteBuilderã€Director çš„è§’è‰²ï¼Œç®€åŒ–äº† Builder æ¨¡å¼çš„è®¾è®¡ã€‚å½“æ¨¡å—æ¯”è¾ƒç¨³å®šï¼Œä¸å­˜åœ¨ä¸€äº›å˜åŒ–æ—¶ï¼Œå¯ä»¥åœ¨ç»å…¸æ¨¡å¼å®ç°çš„åŸºç¡€ä¸Šåšå‡ºä¸€äº›ç²¾ç®€ï¼Œè€Œä¸æ˜¯ç…§æ¬ GOF ä¸Šçš„ç»å…¸å®ç°ï¼Œæ›´ä¸è¦ç”Ÿæ¬ç¡¬å¥—ï¼Œä½¿ç¨‹åºå¤±å»æ¶æ„ä¹‹ç¾ã€‚</p><ul><li>å®šä¹‰ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å³å°†é…ç½®ä»ç›®æ ‡ç±»ä¸­éš”ç¦»å‡ºæ¥ï¼Œé¿å…è¿‡å¤šçš„ setter æ–¹æ³•ã€‚</li><li>ä¼˜ç‚¹ï¼š<ol><li>è‰¯å¥½çš„å°è£…æ€§ï¼Œä½¿ç”¨å»ºé€ è€…æ¨¡å¼å¯ä»¥ä½¿å®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ã€‚</li><li>å»ºé€ è€…ç‹¬ç«‹ï¼Œå®¹æ˜“æ‰©å±•ã€‚</li></ol></li><li>ç¼ºç‚¹ï¼š<br>ä¼šäº§ç”Ÿå¤šä½™çš„ Builder å¯¹è±¡ä»¥åŠ Director å¯¹è±¡ï¼Œæ¶ˆè€—å†…å­˜ã€‚</li></ul><h4 id="æ—¥å¸¸å¼€å‘çš„-BaseActivity-æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š"><a href="#æ—¥å¸¸å¼€å‘çš„-BaseActivity-æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š" class="headerlink" title="æ—¥å¸¸å¼€å‘çš„ BaseActivity æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š"></a>æ—¥å¸¸å¼€å‘çš„ BaseActivity æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š</h4><p>å®šä¹‰ï¼šä¸ºåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–è€…æ˜¯ç›¸äº’ä¾èµ–çš„å¯¹è±¡æä¾›ä¸€ä¸ªæ¥å£ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚</p><p>ä¸»é¢˜åˆ‡æ¢çš„åº”ç”¨ï¼š</p><p>æ¯”å¦‚æˆ‘ä»¬çš„åº”ç”¨ä¸­æœ‰ä¸¤å¥—ä¸»é¢˜ï¼Œåˆ†åˆ«ä¸ºäº®è‰²ä¸»é¢˜LightThemeå’Œæš—è‰²ä¸»é¢˜DarkThemeï¼Œè¿™ä¸¤ç§ä¸»é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæŠ½è±¡çš„ç±»æˆ–æ¥å£æ¥å®šä¹‰ï¼Œè€Œåœ¨å¯¹åº”ä¸»é¢˜ä¸‹æˆ‘ä»¬åˆæœ‰å„ç±»ä¸åŒçš„UIå…ƒç´ ï¼Œæ¯”å¦‚Buttonã€TextViewã€Dialogã€ActionBarç­‰ï¼Œè¿™äº›UIå…ƒç´ éƒ½ä¼šåˆ†åˆ«å¯¹åº”ä¸åŒçš„ä¸»é¢˜ï¼Œè¿™äº›UIå…ƒç´ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŠ½è±¡çš„ç±»æˆ–æ¥å£å®šä¹‰ï¼ŒæŠ½è±¡çš„ä¸»é¢˜ã€å…·ä½“çš„ä¸»é¢˜ã€æŠ½è±¡çš„UIå…ƒç´ å’Œå…·ä½“çš„UIå…ƒç´ ä¹‹é—´çš„å…³ç³»å°±æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼æœ€å¥½çš„ä½“ç°ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>åˆ†ç¦»æ¥å£ä¸å®ç°ï¼Œé¢å‘æ¥å£ç¼–ç¨‹ï¼Œä½¿å…¶ä»å…·ä½“çš„äº§å“å®ç°ä¸­è§£è€¦ï¼ŒåŒæ—¶åŸºäºæ¥å£ä¸å®ç°çš„åˆ†ç¦»ï¼Œä½¿æŠ½è±¡è¯¥å·¥å‚æ–¹æ³•æ¨¡å¼åœ¨åˆ‡æ¢äº§å“ç±»æ—¶æ›´åŠ çµæ´»ã€å®¹æ˜“ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç±»æ–‡ä»¶çš„çˆ†ç‚¸æ€§å¢åŠ ã€‚</li><li>æ–°çš„äº§å“ç±»ä¸æ˜“æ‰©å±•ã€‚</li></ul><h4 id="Okhttpå†…éƒ¨ä½¿ç”¨äº†è´£ä»»é“¾æ¨¡å¼æ¥å®Œæˆæ¯ä¸ªInterceptoræ‹¦æˆªå™¨çš„è°ƒç”¨ï¼š"><a href="#Okhttpå†…éƒ¨ä½¿ç”¨äº†è´£ä»»é“¾æ¨¡å¼æ¥å®Œæˆæ¯ä¸ªInterceptoræ‹¦æˆªå™¨çš„è°ƒç”¨ï¼š" class="headerlink" title="Okhttpå†…éƒ¨ä½¿ç”¨äº†è´£ä»»é“¾æ¨¡å¼æ¥å®Œæˆæ¯ä¸ªInterceptoræ‹¦æˆªå™¨çš„è°ƒç”¨ï¼š"></a>Okhttpå†…éƒ¨ä½¿ç”¨äº†è´£ä»»é“¾æ¨¡å¼æ¥å®Œæˆæ¯ä¸ªInterceptoræ‹¦æˆªå™¨çš„è°ƒç”¨ï¼š</h4><p>å®šä¹‰ï¼šä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p>ViewGroupäº‹ä»¶ä¼ é€’çš„é€’å½’è°ƒç”¨å°±ç±»ä¼¼ä¸€æ¡è´£ä»»é“¾ï¼Œä¸€æ—¦å…¶å¯»æ‰¾åˆ°è´£ä»»è€…ï¼Œé‚£ä¹ˆå°†ç”±è´£ä»»è€…æŒæœ‰å¹¶æ¶ˆè´¹æ‰è¯¥æ¬¡äº‹ä»¶ï¼Œå…·ä½“ä½“ç°åœ¨Viewçš„onTouchEventæ–¹æ³•ä¸­è¿”å›å€¼çš„è®¾ç½®ï¼Œå¦‚æœonTouchEventè¿”å›falseï¼Œé‚£ä¹ˆæ„å‘³ç€å½“å‰Viewä¸ä¼šæ˜¯è¯¥æ¬¡äº‹ä»¶çš„è´£ä»»äººï¼Œå°†ä¸ä¼šå¯¹å…¶æŒæœ‰ï¼›å¦‚æœä¸ºtrueåˆ™ç›¸åï¼Œæ­¤æ—¶Viewä¼šæŒæœ‰è¯¥äº‹ä»¶å¹¶ä¸å†å‘ä¸‹ä¼ é€’ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><p>å°†è¯·æ±‚è€…å’Œå¤„ç†è€…å…³ç³»è§£è€¦ï¼Œæä¾›ä»£ç çš„çµæ´»æ€§ã€‚</p><p>ç¼ºç‚¹ï¼š</p><p>å¯¹é“¾ä¸­è¯·æ±‚å¤„ç†è€…çš„éå†ä¸­ï¼Œå¦‚æœå¤„ç†è€…å¤ªå¤šï¼Œé‚£ä¹ˆéå†å¿…å®šä¼šå½±å“æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€äº›é€’å½’è°ƒç”¨ä¸­ï¼Œè¦æ…é‡ã€‚</p><h4 id="RxJavaçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š"><a href="#RxJavaçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š" class="headerlink" title="RxJavaçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š"></a>RxJavaçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š</h4><p>å®šä¹‰ï¼šå®šä¹‰å¯¹è±¡é—´ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œåˆ™æ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p><p>ListView/RecyclerViewçš„Adapterçš„notifyDataSetChangedæ–¹æ³•ã€å¹¿æ’­ã€äº‹ä»¶æ€»çº¿æœºåˆ¶ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼ä¸»è¦çš„ä½œç”¨å°±æ˜¯å¯¹è±¡è§£è€¦ï¼Œå°†è§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿè€…å®Œå…¨éš”ç¦»ï¼Œåªä¾èµ–äºObserverå’ŒObservableæŠ½è±¡ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆï¼Œåº”å¯¹ä¸šåŠ¡å˜åŒ–ã€‚</li><li>å¢å¼ºç³»ç»Ÿçµæ´»æ€§ã€å¯æ‰©å±•æ€§ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åœ¨Javaä¸­æ¶ˆæ¯çš„é€šçŸ¥é»˜è®¤æ˜¯é¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªè§‚å¯Ÿè€…å¡é¡¿ï¼Œä¼šå½±å“æ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€èˆ¬è€ƒè™‘é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼ã€‚</li></ul><h4 id="AIDLä»£ç†æ¨¡å¼ï¼š"><a href="#AIDLä»£ç†æ¨¡å¼ï¼š" class="headerlink" title="AIDLä»£ç†æ¨¡å¼ï¼š"></a>AIDLä»£ç†æ¨¡å¼ï¼š</h4><p>å®šä¹‰ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p>é™æ€ä»£ç†ï¼šä»£ç è¿è¡Œå‰ä»£ç†ç±»çš„classç¼–è¯‘æ–‡ä»¶å°±å·²ç»å­˜åœ¨ã€‚</p><p>åŠ¨æ€ä»£ç†ï¼šé€šè¿‡åå°„åŠ¨æ€åœ°ç”Ÿæˆä»£ç†è€…çš„å¯¹è±¡ã€‚ä»£ç†è°å°†ä¼šåœ¨æ‰§è¡Œé˜¶æ®µå†³å®šã€‚å°†åŸæ¥ä»£ç†ç±»æ‰€åšçš„å·¥ä½œç”±InvocationHandleræ¥å¤„ç†ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>å½“æ— æ³•æˆ–ä¸æƒ³ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾æ—¶å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ï¼Œä¸ºäº†ä¿è¯å®¢æˆ·ç«¯ä½¿ç”¨çš„é€æ˜æ€§ï¼Œå§”æ‰˜å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éœ€è¦å®ç°ç›¸åŒçš„æ¥å£ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¯¹ç±»çš„å¢åŠ ã€‚</li></ul><h4 id="ListView-RecyclerView-GridViewçš„é€‚é…å™¨æ¨¡å¼ï¼š"><a href="#ListView-RecyclerView-GridViewçš„é€‚é…å™¨æ¨¡å¼ï¼š" class="headerlink" title="ListView/RecyclerView/GridViewçš„é€‚é…å™¨æ¨¡å¼ï¼š"></a>ListView/RecyclerView/GridViewçš„é€‚é…å™¨æ¨¡å¼ï¼š</h4><p>é€‚é…å™¨æ¨¡å¼æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œæ— æ³•åœ¨ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>æ¥å£ä¸å…¼å®¹ã€‚</li><li>æƒ³è¦å»ºç«‹ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„ç±»ã€‚</li><li>éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„è¾“å‡ºæ¥å£ï¼Œè€Œè¾“å…¥ç«¯çš„ç±»å‹ä¸å¯é¢„çŸ¥ã€‚</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ›´å¥½çš„å¤ç”¨æ€§ï¼šå¤ç”¨ç°æœ‰çš„åŠŸèƒ½ã€‚</li><li>æ›´å¥½çš„æ‰©å±•æ€§ï¼šæ‰©å±•ç°æœ‰çš„åŠŸèƒ½ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>è¿‡å¤šåœ°ä½¿ç”¨é€‚é…å™¨ï¼Œä¼šè®©ç³»ç»Ÿéå¸¸é›¶ä¹±ï¼Œä¸æ˜“äºæ•´ä½“æŠŠæ¡ã€‚ä¾‹å¦‚ï¼Œæ˜æ˜çœ‹åˆ°è°ƒç”¨çš„æ˜¯Aæ¥å£ï¼Œå…¶å®å†…éƒ¨è¢«é€‚é…æˆäº†Bæ¥å£çš„å®ç°ï¼Œä¸€ä¸ªç³»ç»Ÿå¦‚æœå‡ºç°å¤ªå¤šè¿™ç§æƒ…å†µï¼Œæ— å¼‚äºä¸€åœºç¾éš¾ã€‚</li></ul><h4 id="Context-ContextImplå¤–è§‚æ¨¡å¼ï¼š"><a href="#Context-ContextImplå¤–è§‚æ¨¡å¼ï¼š" class="headerlink" title="Context/ContextImplå¤–è§‚æ¨¡å¼ï¼š"></a>Context/ContextImplå¤–è§‚æ¨¡å¼ï¼š</h4><p>è¦æ±‚ä¸€ä¸ªå­ç³»ç»Ÿçš„å¤–éƒ¨ä¸å…¶å†…éƒ¨çš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡è¿›è¡Œï¼Œé—¨é¢æ¨¡å¼æä¾›ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>ä¸ºä¸€ä¸ªå¤æ‚å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•æ¥å£ã€‚</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¯¹å®¢æˆ·ç¨‹åºéšè—å­ç³»ç»Ÿç»†èŠ‚ï¼Œå› è€Œå‡å°‘äº†å®¢æˆ·å¯¹äºå­ç³»ç»Ÿçš„è€¦åˆï¼Œèƒ½å¤Ÿæ‹¥æŠ±å˜åŒ–ã€‚</li><li>å¤–è§‚ç±»å¯¹å­ç³»ç»Ÿçš„æ¥å£å°è£…ï¼Œä½¿å¾—ç³»ç»Ÿæ›´æ˜“ç”¨ä½¿ç”¨ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¤–è§‚ç±»æ¥å£è†¨èƒ€ã€‚</li><li>å¤–è§‚ç±»æ²¡æœ‰éµå¾ªå¼€é—­åŸåˆ™ï¼Œå½“ä¸šåŠ¡å‡ºç°å˜æ›´æ—¶ï¼Œå¯èƒ½éœ€è¦ç›´æ¥ä¿®æ”¹å¤–è§‚ç±»ã€‚</li></ul><h2 id="äºŒã€é›†åˆæ¡†æ¶-ï¼ˆâ­â­â­ï¼‰"><a href="#äºŒã€é›†åˆæ¡†æ¶-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="äºŒã€é›†åˆæ¡†æ¶ ï¼ˆâ­â­â­ï¼‰"></a>äºŒã€é›†åˆæ¡†æ¶ ï¼ˆâ­â­â­ï¼‰</h2><h3 id="1ã€é›†åˆæ¡†æ¶ï¼Œlistï¼Œmapï¼Œsetéƒ½æœ‰å“ªäº›å…·ä½“çš„å®ç°ç±»ï¼ŒåŒºåˆ«éƒ½æ˜¯ä»€ä¹ˆ"><a href="#1ã€é›†åˆæ¡†æ¶ï¼Œlistï¼Œmapï¼Œsetéƒ½æœ‰å“ªäº›å…·ä½“çš„å®ç°ç±»ï¼ŒåŒºåˆ«éƒ½æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€é›†åˆæ¡†æ¶ï¼Œlistï¼Œmapï¼Œsetéƒ½æœ‰å“ªäº›å…·ä½“çš„å®ç°ç±»ï¼ŒåŒºåˆ«éƒ½æ˜¯ä»€ä¹ˆ?"></a>1ã€é›†åˆæ¡†æ¶ï¼Œlistï¼Œmapï¼Œsetéƒ½æœ‰å“ªäº›å…·ä½“çš„å®ç°ç±»ï¼ŒåŒºåˆ«éƒ½æ˜¯ä»€ä¹ˆ?</h3><p>Javaé›†åˆé‡Œä½¿ç”¨æ¥å£æ¥å®šä¹‰åŠŸèƒ½ï¼Œæ˜¯ä¸€å¥—å®Œå–„çš„ç»§æ‰¿ä½“ç³»ã€‚Iterator æ˜¯æ‰€æœ‰é›†åˆçš„æ€»æ¥å£ï¼Œå…¶ä»–æ‰€æœ‰æ¥å£éƒ½ç»§æ‰¿äºå®ƒï¼Œè¯¥æ¥å£å®šä¹‰äº†é›†åˆçš„éå†æ“ä½œï¼ŒCollection æ¥å£ç»§æ‰¿äº Iteratorï¼Œæ˜¯é›†åˆçš„æ¬¡çº§æ¥å£ï¼ˆMap ç‹¬ç«‹å­˜åœ¨ï¼‰ï¼Œå®šä¹‰äº†é›†åˆçš„ä¸€äº›é€šç”¨æ“ä½œã€‚</p><h4 id="Javaé›†åˆçš„ç±»ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#Javaé›†åˆçš„ç±»ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="Javaé›†åˆçš„ç±»ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š"></a>Javaé›†åˆçš„ç±»ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</h4><p><img src="http://blog.cigis-cloud.com/aaji-1591348465.png" alt="Java é›†åˆç±»"></p><ul><li>Listï¼šæœ‰åºã€å¯é‡å¤ï¼›ç´¢å¼•æŸ¥è¯¢é€Ÿåº¦å¿«ï¼›æ’å…¥ã€åˆ é™¤ä¼´éšæ•°æ®ç§»åŠ¨ï¼Œé€Ÿåº¦æ…¢ï¼›</li><li>Setï¼šæ— åºï¼Œä¸å¯é‡å¤ï¼›</li><li>Mapï¼šé”®å€¼å¯¹ï¼Œé”®å”¯ä¸€ï¼Œå€¼å¤šä¸ªï¼›</li></ul><ol><li>Listã€Set éƒ½æ˜¯ç»§æ‰¿è‡ª Collection æ¥å£ï¼ŒMap åˆ™ä¸æ˜¯;</li><li>List ç‰¹ç‚¹ï¼šå…ƒç´ <strong>æœ‰æ”¾å…¥é¡ºåº</strong>ï¼Œå…ƒç´ å¯<strong>é‡å¤</strong>;</li><li>Set ç‰¹ç‚¹ï¼šå…ƒç´ <strong>æ— æ”¾å…¥é¡ºåº</strong>ï¼Œå…ƒç´ <strong>ä¸å¯é‡å¤</strong>ï¼Œé‡å¤å…ƒç´ ä¼šç›–æ‰ã€‚ï¼ˆæ³¨æ„ï¼šå…ƒç´ è™½ç„¶æ— æ”¾å…¥é¡ºåºï¼Œä½†æ˜¯å…ƒç´ åœ¨ Set ä¸­ä½ç½®æ˜¯ç”±è¯¥å…ƒç´ çš„ HashCode å†³å®šçš„ï¼Œå…¶ä½ç½®å…¶å®æ˜¯å›ºå®šï¼ŒåŠ å…¥ Set çš„Objectå¿…é¡»å®šä¹‰equals()æ–¹æ³•ï¼›å¦å¤– List æ”¯æŒ<code>for</code>å¾ªç¯ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸‹æ ‡æ¥éå†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨ï¼Œä½†æ˜¯ Set åªèƒ½ç”¨è¿­ä»£ï¼Œå› ä¸ºä»–æ— åºï¼Œæ— æ³•ç”¨ä¸‹æ ‡å–å¾—æƒ³è¦çš„å€¼ï¼‰ã€‚</li><li>Set å’Œ List å¯¹æ¯”ï¼š<br>Setï¼šæ£€ç´¢å…ƒç´ æ•ˆç‡ä½ä¸‹ï¼Œåˆ é™¤å’Œæ’å…¥æ•ˆç‡é«˜ï¼Œæ’å…¥å’Œåˆ é™¤ä¸ä¼šå¼•èµ·å…ƒç´ ä½ç½®æ”¹å˜ã€‚<br>Listï¼šå’Œæ•°ç»„ç±»ä¼¼ï¼ŒList å¯ä»¥åŠ¨æ€å¢é•¿ï¼ŒæŸ¥æ‰¾å…ƒç´ æ•ˆç‡é«˜ï¼Œæ’å…¥åˆ é™¤å…ƒç´ æ•ˆç‡ä½ï¼Œå› ä¸ºä¼šå¼•èµ·å…¶ä»–å…ƒç´ ä½ç½®æ”¹å˜ã€‚</li><li>Mapé€‚åˆå‚¨å­˜é”®å€¼å¯¹çš„æ•°æ®ã€‚</li><li>çº¿ç¨‹å®‰å…¨é›†åˆç±»ä¸éçº¿ç¨‹å®‰å…¨é›†åˆç±»ï¼ˆå¦‚ä¸‹è¡¨ï¼‰<table><thead><tr><th>çº¿ç¨‹ä¸å®‰å…¨</th><th>çº¿ç¨‹å®‰å…¨</th></tr></thead><tbody><tr><td>LinkedList</td><td>Vector</td></tr><tr><td>ArrayList</td><td>HashTable</td></tr><tr><td>HashSet</td><td></td></tr><tr><td>HashMap</td><td>ConcurrentHashMap</td></tr></tbody></table></li></ol><h4 id="ä¸‹é¢æ˜¯è¿™äº›ç±»å…·ä½“çš„ä½¿ç”¨ä»‹ç»ï¼š"><a href="#ä¸‹é¢æ˜¯è¿™äº›ç±»å…·ä½“çš„ä½¿ç”¨ä»‹ç»ï¼š" class="headerlink" title="ä¸‹é¢æ˜¯è¿™äº›ç±»å…·ä½“çš„ä½¿ç”¨ä»‹ç»ï¼š"></a>ä¸‹é¢æ˜¯è¿™äº›ç±»å…·ä½“çš„ä½¿ç”¨ä»‹ç»ï¼š</h4><h4 id="ArrayList-ä¸-LinkedList-çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯"><a href="#ArrayList-ä¸-LinkedList-çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯" class="headerlink" title="ArrayList ä¸ LinkedList çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯"></a>ArrayList ä¸ LinkedList çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯</h4><ul><li><p>Arraylistï¼š<br><strong>ä¼˜ç‚¹ï¼š</strong> ArrayListæ˜¯å®ç°äº†åŸºäºåŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„,å› åœ°å€è¿ç»­ï¼Œä¸€æ—¦æ•°æ®å­˜å‚¨å¥½äº†ï¼ŒæŸ¥è¯¢æ“ä½œæ•ˆç‡ä¼šæ¯”è¾ƒé«˜ï¼ˆåœ¨å†…å­˜é‡Œæ˜¯è¿ç€æ”¾çš„ï¼‰ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong> å› ä¸ºåœ°å€è¿ç»­ï¼ŒArrayListè¦ç§»åŠ¨æ•°æ®,æ‰€ä»¥æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡æ¯”è¾ƒä½ã€‚</p></li><li><p>LinkedListï¼š<br><strong>ä¼˜ç‚¹ï¼š</strong> LinkedList åŸºäºé“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œåœ°å€æ˜¯ä»»æ„çš„ï¼Œå…¶åœ¨å¼€è¾Ÿå†…å­˜ç©ºé—´çš„æ—¶å€™ä¸éœ€è¦ç­‰ä¸€ä¸ªè¿ç»­çš„åœ°å€ï¼Œå¯¹æ–°å¢å’Œåˆ é™¤æ“ä½œ<code>add</code>å’Œ<code>remove</code>ï¼ŒLinedList æ¯”è¾ƒå ä¼˜åŠ¿ã€‚LikedList é€‚ç”¨äºè¦å¤´å°¾æ“ä½œæˆ–æ’å…¥æŒ‡å®šä½ç½®çš„åœºæ™¯ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong> å› ä¸º LinkedList è¦ç§»åŠ¨æŒ‡é’ˆ,æ‰€ä»¥æŸ¥è¯¢æ“ä½œæ€§èƒ½æ¯”è¾ƒä½ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯åˆ†æï¼š<br>å½“éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¯¹æ­¤è®¿é—®çš„æƒ…å†µä¸‹é€‰ç”¨ ArrayListï¼Œå½“è¦å¯¹æ•°æ®è¿›è¡Œå¤šæ¬¡å¢åŠ åˆ é™¤ä¿®æ”¹æ—¶é‡‡ç”¨ LinkedListã€‚</p></li></ul><h4 id="ArrayList-å’Œ-LinkedList-çš„æ‰©å®¹æœºåˆ¶"><a href="#ArrayList-å’Œ-LinkedList-çš„æ‰©å®¹æœºåˆ¶" class="headerlink" title="ArrayList å’Œ LinkedList çš„æ‰©å®¹æœºåˆ¶"></a>ArrayList å’Œ LinkedList çš„æ‰©å®¹æœºåˆ¶</h4><ul><li><p>ArrayList:<br>ArrayList åˆå§‹åŒ–å¤§å°æ˜¯ 10ã€‚ï¼ˆå¦‚æœä½ çŸ¥é“ä½ çš„ ArrayList ä¼šè¾¾åˆ°å¤šå°‘å®¹é‡ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±æŒ‡å®šï¼Œèƒ½èŠ‚çœæ‰©å®¹çš„æ€§èƒ½å¼€æ”¯ï¼‰æ‰©å®¹çš„è§„åˆ™æ˜¯ï¼Œæ–°å¢çš„æ—¶å€™å‘ç°å®¹é‡ä¸å¤Ÿç”¨äº†ï¼Œå°±å»æ‰©å®¹ã€‚æ‰©å®¹å¤§å°è§„åˆ™æ˜¯ï¼Œ<code>newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1)</code>ã€‚ä¾‹å¦‚ï¼šåŸå§‹å¤§å°æ˜¯ 10 ï¼Œæ‰©å®¹åçš„å¤§å°å°±æ˜¯ 10 + 5 = 15ï¼‰</p></li><li><p>LinkedList:<br>LinkedList æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ²¡æœ‰åˆå§‹åŒ–å¤§å°ï¼Œä¹Ÿæ²¡æœ‰æ‰©å®¹çš„æœºåˆ¶ï¼Œå°±æ˜¯ä¸€ç›´åœ¨å‰é¢æˆ–è€…åé¢æ–°å¢å°±å¥½ã€‚</p></li></ul><h4 id="ArrayList-ä¸-Vector-çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯"><a href="#ArrayList-ä¸-Vector-çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯" class="headerlink" title="ArrayList ä¸ Vector çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯"></a>ArrayList ä¸ Vector çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯</h4><p>ArrayListæœ‰ä¸‰ä¸ªæ„é€ æ–¹æ³•ï¼š</p><pre><code class="java">public ArrayList(int intinitialCapacity) // æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šåˆå§‹å®¹é‡çš„ç©ºåˆ—è¡¨public ArrayList() // æ„é€ ä¸€ä¸ªåˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ã€‚public ArrayList(Collection&lt;? extends E&gt; c) // æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®š collection çš„å…ƒç´ çš„åˆ—è¡¨</code></pre><p>Vectoræœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼š</p><pre><code class="java">public Vector() // ä½¿ç”¨æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œç­‰äºé›¶çš„å®¹é‡å¢é‡æ„é€ ä¸€ä¸ªç©ºå‘é‡public Vector(int initialCapacity) // æ„é€ ä¸€ä¸ªç©ºå‘é‡ï¼Œä½¿å…¶å†…éƒ¨æ•°æ®æ•°ç»„çš„å¤§å°ï¼Œå…¶æ ‡å‡†å®¹é‡å¢é‡ä¸ºé›¶public Vector(Collection&lt;? extends E&gt; c) // æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®š collection ä¸­çš„å…ƒç´ çš„å‘é‡public Vector(int initialCapacity, int capacityIncrement) // ä½¿ç”¨æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œå®¹é‡å¢é‡æ„é€ ä¸€ä¸ªç©ºçš„å‘é‡</code></pre><p>ArrayListå’ŒVectoréƒ½æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œä¸»è¦æœ‰è¿™ä¹ˆå››ä¸ªåŒºåˆ«ï¼š</p><p>1)Vectoræ˜¯å¤šçº¿ç¨‹å®‰å…¨çš„ï¼Œçº¿ç¨‹å®‰å…¨å°±æ˜¯è¯´å¤šçº¿ç¨‹è®¿é—®ä»£ç ï¼Œä¸ä¼šäº§ç”Ÿä¸ç¡®å®šçš„ç»“æœã€‚è€ŒArrayListä¸æ˜¯ï¼Œè¿™å¯ä»¥ä»æºç ä¸­çœ‹å‡ºï¼ŒVectorç±»ä¸­çš„æ–¹æ³•å¾ˆå¤šæœ‰synchroniedè¿›è¡Œä¿®é¥°ï¼Œè¿™æ ·å°±å¯¼è‡´äº†Vectoråœ¨æ•ˆç‡ä¸Šæ— æ³•ä¸ArrayLstç›¸æ¯”ï¼›</p><p>2)ä¸¤ä¸ªéƒ½æ˜¯é‡‡ç”¨çš„çº¿æ€§è¿ç»­ç©ºé—´å­˜å‚¨å…ƒç´ ï¼Œä½†æ˜¯å½“ç©ºé—´å……è¶³çš„æ—¶å€™ï¼Œä¸¤ä¸ªç±»çš„å¢åŠ æ–¹å¼æ˜¯ä¸åŒã€‚</p><p>3)Vectorå¯ä»¥è®¾ç½®å¢é•¿å› å­ï¼Œè€ŒArrayListä¸å¯ä»¥ã€‚</p><p>4)Vectoræ˜¯ä¸€ç§è€çš„åŠ¨æ€æ•°ç»„ï¼Œæ˜¯çº¿ç¨‹åŒæ­¥çš„ï¼Œæ•ˆç‡å¾ˆä½ï¼Œä¸€èˆ¬ä¸èµæˆä½¿ç”¨ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼š</p><p>1.Vectoræ˜¯çº¿ç¨‹åŒæ­¥çš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒArraListæ˜¯çº¿ç¨‹å¼‚æ­¥çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ã€‚å¦‚æœä¸è€ƒè™‘åˆ°çº¿ç¨‹çš„å®‰å…¨å› ç´ ï¼Œä¸€èˆ¬ç”¨ArrayListæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p><p>2.å¦‚æœé›†åˆä¸­çš„å…ƒç´ çš„æ•°ç›®å¤§äºç›®å‰é›†åˆæ•°ç»„çš„é•¿åº¦æ—¶ï¼Œåœ¨é›†åˆä¸­ä½¿ç”¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ•°æ®ï¼Œç”¨Vectoræœ‰ä¸€å®šçš„ä¼˜åŠ¿ã€‚</p><h4 id="HashSetä¸TreeSetçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯"><a href="#HashSetä¸TreeSetçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯" class="headerlink" title="HashSetä¸TreeSetçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯"></a>HashSetä¸TreeSetçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯</h4><p>1.TreeSet æ˜¯äºŒå‰æ ‘ï¼ˆçº¢é»‘æ ‘çš„æ ‘æ®ç»“æ„ï¼‰å®ç°çš„ï¼ŒTreestä¸­çš„æ•°æ®æ˜¯è‡ªåŠ¨æ’å¥½åºçš„ï¼Œä¸å…è®¸æ”¾å…¥nullå€¼ã€‚</p><p>2.HashSet æ˜¯å“ˆå¸Œè¡¨å®ç°çš„ï¼ŒHashSetä¸­çš„æ•°æ®æ˜¯æ— åºçš„å¯ä»¥æ”¾å…¥nullï¼Œä½†åªèƒ½æ”¾å…¥ä¸€ä¸ªnullï¼Œä¸¤è€…ä¸­çš„å€¼éƒ½ä¸é‡å¤ï¼Œå°±å¦‚æ•°æ®åº“ä¸­å”¯ä¸€çº¦æŸã€‚</p><p>3.HashSetè¦æ±‚æ”¾å…¥çš„å¯¹è±¡å¿…é¡»å®ç°HashCode()æ–¹æ³•ï¼Œæ”¾çš„å¯¹è±¡ï¼Œæ˜¯ä»¥hashcodeç ä½œä¸ºæ ‡è¯†çš„ï¼Œè€Œå…·æœ‰ç›¸åŒå†…å®¹çš„Stringå¯¹è±¡ï¼Œhashcodeæ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥æ”¾å…¥çš„å†…å®¹ä¸èƒ½é‡å¤ä½†æ˜¯åŒä¸€ä¸ªç±»çš„å¯¹è±¡å¯ä»¥æ”¾å…¥ä¸åŒçš„å®ä¾‹ã€‚</p><p>é€‚ç”¨åœºæ™¯åˆ†æ:</p><p>HashSetæ˜¯åŸºäºHashç®—æ³•å®ç°çš„ï¼Œå…¶æ€§èƒ½é€šå¸¸éƒ½ä¼˜äºTreeSetã€‚ä¸ºå¿«é€ŸæŸ¥æ‰¾è€Œè®¾è®¡çš„Setï¼Œæˆ‘ä»¬é€šå¸¸éƒ½åº”è¯¥ä½¿ç”¨HashSetï¼Œåœ¨æˆ‘ä»¬éœ€è¦æ’åºçš„åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨TreeSetã€‚</p><h4 id="HashMapä¸TreeMapã€HashTableçš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯"><a href="#HashMapä¸TreeMapã€HashTableçš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯" class="headerlink" title="HashMapä¸TreeMapã€HashTableçš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯"></a>HashMapä¸TreeMapã€HashTableçš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯</h4><p>HashMap éçº¿ç¨‹å®‰å…¨  </p><p>HashMapï¼šåŸºäºå“ˆå¸Œè¡¨(æ•£åˆ—è¡¨)å®ç°ã€‚ä½¿ç”¨HashMapè¦æ±‚çš„é”®ç±»æ˜ç¡®å®šä¹‰äº†hashCode()å’Œequals()[å¯ä»¥é‡å†™hasCode()å’Œequals()]ï¼Œä¸ºäº†ä¼˜åŒ–HashMapç©ºé—´çš„ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥è°ƒä¼˜åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚å…¶ä¸­æ•£åˆ—è¡¨çš„å†²çªå¤„ç†ä¸»åˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯å¼€æ”¾å®šå€æ³•ï¼Œå¦ä¸€ç§æ˜¯é“¾è¡¨æ³•ã€‚HashMapå®ç°ä¸­é‡‡ç”¨çš„æ˜¯é“¾è¡¨æ³•ã€‚</p><p>TreeMapï¼šéçº¿ç¨‹å®‰å…¨åŸºäºçº¢é»‘æ ‘å®ç°ã€‚TreeMapæ²¡æœ‰è°ƒä¼˜é€‰é¡¹ï¼Œå› ä¸ºè¯¥æ ‘æ€»å¤„äºå¹³è¡¡çŠ¶æ€ã€‚</p><p>é€‚ç”¨åœºæ™¯åˆ†æï¼š</p><p>HashMapå’ŒHashTable:HashMapå»æ‰äº†HashTableçš„containæ–¹æ³•ï¼Œä½†æ˜¯åŠ ä¸Šäº†containsValue()å’ŒcontainsKey()æ–¹æ³•ã€‚HashTableæ˜¯åŒæ­¥çš„ï¼Œè€ŒHashMapæ˜¯éåŒæ­¥çš„ï¼Œæ•ˆç‡ä¸Šæ¯”HashTableè¦é«˜ã€‚HashMapå…è®¸ç©ºé”®å€¼ï¼Œè€ŒHashTableä¸å…è®¸ã€‚</p><p>HashMapï¼šé€‚ç”¨äºMapä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ ã€‚</p><p>Treemapï¼šé€‚ç”¨äºæŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéå†é”®(key)ã€‚<br>(ps:å…¶å®æˆ‘ä»¬å·¥ä½œçš„è¿‡ç¨‹ä¸­å¯¹é›†åˆçš„ä½¿ç”¨æ˜¯å¾ˆé¢‘ç¹çš„,ç¨æ³¨æ„å¹¶æ€»ç»“ç§¯ç´¯ä¸€ä¸‹,åœ¨é¢è¯•çš„æ—¶å€™åº”è¯¥ä¼šå›ç­”çš„å¾ˆè½»æ¾)</p><h3 id="2ã€seté›†åˆä»åŸç†ä¸Šå¦‚ä½•ä¿è¯ä¸é‡å¤ï¼Ÿ"><a href="#2ã€seté›†åˆä»åŸç†ä¸Šå¦‚ä½•ä¿è¯ä¸é‡å¤ï¼Ÿ" class="headerlink" title="2ã€seté›†åˆä»åŸç†ä¸Šå¦‚ä½•ä¿è¯ä¸é‡å¤ï¼Ÿ"></a>2ã€seté›†åˆä»åŸç†ä¸Šå¦‚ä½•ä¿è¯ä¸é‡å¤ï¼Ÿ</h3><p>1ï¼‰åœ¨å¾€setä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœæŒ‡å®šå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ æˆåŠŸã€‚</p><p>2ï¼‰å…·ä½“æ¥è®²ï¼šå½“å‘HashSetä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé¦–å…ˆè®¡ç®—å…ƒç´ çš„hashcodeå€¼ï¼Œç„¶åç”¨è¿™ä¸ªï¼ˆå…ƒç´ çš„hashcodeï¼‰%ï¼ˆHashMapé›†åˆçš„å¤§å°ï¼‰+1è®¡ç®—å‡ºè¿™ä¸ªå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®ä¸ºç©ºï¼Œå°±å°†å…ƒç´ æ·»åŠ è¿›å»ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç”¨equalsæ–¹æ³•æ¯”è¾ƒå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±ä¸æ·»åŠ ï¼Œå¦åˆ™æ‰¾ä¸€ä¸ªç©ºä½æ·»åŠ ã€‚</p><h3 id="3ã€HashMapå’ŒHashTableçš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼Œä¸¤è€…åº•å±‚å®ç°çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3ã€HashMapå’ŒHashTableçš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼Œä¸¤è€…åº•å±‚å®ç°çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3ã€HashMapå’ŒHashTableçš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼Œä¸¤è€…åº•å±‚å®ç°çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>3ã€HashMapå’ŒHashTableçš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼Œä¸¤è€…åº•å±‚å®ç°çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>HashMapå’ŒHashTableçš„åŒºåˆ«ï¼š</p><p>äºŒè€…éƒ½å®ç°äº†Map æ¥å£ï¼Œæ˜¯å°†å”¯ä¸€çš„é”®æ˜ å°„åˆ°ç‰¹å®šçš„å€¼ä¸Šï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š</p><p>1)HashMap æ²¡æœ‰æ’åºï¼Œå…è®¸ä¸€ä¸ªnull é”®å’Œå¤šä¸ªnull å€¼,è€ŒHashtable ä¸å…è®¸ï¼›</p><p>2)HashMap æŠŠHashtable çš„contains æ–¹æ³•å»æ‰äº†ï¼Œæ”¹æˆcontainsvalue å’ŒcontainsKey, å› ä¸ºcontains æ–¹æ³•å®¹æ˜“è®©äººå¼•èµ·è¯¯è§£ï¼›</p><p>3)Hashtable ç»§æ‰¿è‡ªDictionary ç±»ï¼ŒHashMap æ˜¯Java1.2 å¼•è¿›çš„Map æ¥å£çš„å®ç°ï¼›</p><p>4)Hashtable çš„æ–¹æ³•æ˜¯Synchronized çš„ï¼Œè€ŒHashMap ä¸æ˜¯ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®Hashtable æ—¶ï¼Œä¸éœ€è¦è‡ªå·±ä¸ºå®ƒçš„æ–¹æ³•å®ç°åŒæ­¥ï¼Œè€ŒHashMap å°±å¿…é¡»ä¸ºä¹‹æä¾›é¢å¤–çš„åŒæ­¥ã€‚Hashtable å’ŒHashMap é‡‡ç”¨çš„hash/rehash ç®—æ³•å¤§è‡´ä¸€æ ·ï¼Œæ‰€ä»¥æ€§èƒ½ä¸ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚</p><p>HashMapå’ŒHashTableçš„åº•å±‚å®ç°æ•°æ®ç»“æ„ï¼š</p><p>HashMapå’ŒHashtableçš„åº•å±‚å®ç°éƒ½æ˜¯æ•°ç»„ + é“¾è¡¨ç»“æ„å®ç°çš„ï¼ˆjdk8ä»¥å‰ï¼‰</p><h3 id="4ã€HashMapã€ConcurrentHashMapã€hash-ç›¸å…³åŸç†è§£æï¼Ÿ"><a href="#4ã€HashMapã€ConcurrentHashMapã€hash-ç›¸å…³åŸç†è§£æï¼Ÿ" class="headerlink" title="4ã€HashMapã€ConcurrentHashMapã€hash()ç›¸å…³åŸç†è§£æï¼Ÿ"></a>4ã€HashMapã€ConcurrentHashMapã€hash()ç›¸å…³åŸç†è§£æï¼Ÿ</h3><h4 id="HashMap-1-7çš„åŸç†ï¼š"><a href="#HashMap-1-7çš„åŸç†ï¼š" class="headerlink" title="HashMap 1.7çš„åŸç†ï¼š"></a>HashMap 1.7çš„åŸç†ï¼š</h4><p>HashMap åº•å±‚æ˜¯åŸºäº æ•°ç»„ + é“¾è¡¨ ç»„æˆçš„ï¼Œä¸è¿‡åœ¨ jdk1.7 å’Œ 1.8 ä¸­å…·ä½“å®ç°ç¨æœ‰ä¸åŒã€‚</p><p>è´Ÿè½½å› å­ï¼š</p><ul><li>ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¾¾åˆ°äº† 16 * 0.75 = 12 å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</li><li>å› æ­¤é€šå¸¸å»ºè®®èƒ½æå‰é¢„ä¼° HashMap çš„å¤§å°æœ€å¥½ï¼Œå°½é‡çš„å‡å°‘æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li></ul><p>å…¶å®çœŸæ­£å­˜æ”¾æ•°æ®çš„æ˜¯ Entry&lt;K,V&gt;[] tableï¼ŒEntry æ˜¯ HashMap ä¸­çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ƒæœ‰keyã€valueã€nextã€hashï¼ˆkeyçš„hashcodeï¼‰æˆå‘˜å˜é‡ã€‚</p><p>put æ–¹æ³•ï¼š</p><ul><li>åˆ¤æ–­å½“å‰æ•°ç»„æ˜¯å¦éœ€è¦åˆå§‹åŒ–ã€‚</li><li>å¦‚æœ key ä¸ºç©ºï¼Œåˆ™ put ä¸€ä¸ªç©ºå€¼è¿›å»ã€‚</li><li>æ ¹æ® key è®¡ç®—å‡º hashcodeã€‚</li><li>æ ¹æ®è®¡ç®—å‡ºçš„ hashcode å®šä½å‡ºæ‰€åœ¨æ¡¶ã€‚</li><li>å¦‚æœæ¡¶æ˜¯ä¸€ä¸ªé“¾è¡¨åˆ™éœ€è¦éå†åˆ¤æ–­é‡Œé¢çš„ hashcodeã€key æ˜¯å¦å’Œä¼ å…¥ key ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™è¿›è¡Œè¦†ç›–ï¼Œå¹¶è¿”å›åŸæ¥çš„å€¼ã€‚</li><li>å¦‚æœæ¡¶æ˜¯ç©ºçš„ï¼Œè¯´æ˜å½“å‰ä½ç½®æ²¡æœ‰æ•°æ®å­˜å…¥ï¼Œæ–°å¢ä¸€ä¸ª Entry å¯¹è±¡å†™å…¥å½“å‰ä½ç½®ã€‚ï¼ˆå½“è°ƒç”¨ addEntry å†™å…¥ Entry æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚å¦‚æœéœ€è¦å°±è¿›è¡Œä¸¤å€æ‰©å……ï¼Œå¹¶å°†å½“å‰çš„ key é‡æ–° hash å¹¶å®šä½ã€‚è€Œåœ¨ createEntry ä¸­ä¼šå°†å½“å‰ä½ç½®çš„æ¡¶ä¼ å…¥åˆ°æ–°å»ºçš„æ¡¶ä¸­ï¼Œå¦‚æœå½“å‰æ¡¶æœ‰å€¼å°±ä¼šåœ¨ä½ç½®å½¢æˆé“¾è¡¨ã€‚ï¼‰</li></ul><p>get æ–¹æ³•ï¼š</p><ul><li>é¦–å…ˆä¹Ÿæ˜¯æ ¹æ® key è®¡ç®—å‡º hashcodeï¼Œç„¶åå®šä½åˆ°å…·ä½“çš„æ¡¶ä¸­ã€‚</li><li>åˆ¤æ–­è¯¥ä½ç½®æ˜¯å¦ä¸ºé“¾è¡¨ã€‚</li><li>ä¸æ˜¯é“¾è¡¨å°±æ ¹æ® keyã€key çš„ hashcode æ˜¯å¦ç›¸ç­‰æ¥è¿”å›å€¼ã€‚</li><li>ä¸ºé“¾è¡¨åˆ™éœ€è¦éå†ç›´åˆ° key åŠ hashcode ç›¸ç­‰æ—¶å€™å°±è¿”å›å€¼ã€‚</li><li>å•¥éƒ½æ²¡å–åˆ°å°±ç›´æ¥è¿”å› null ã€‚</li></ul><h4 id="HashMap-1-8çš„åŸç†ï¼š"><a href="#HashMap-1-8çš„åŸç†ï¼š" class="headerlink" title="HashMap 1.8çš„åŸç†ï¼š"></a>HashMap 1.8çš„åŸç†ï¼š</h4><p>å½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼›æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå› æ­¤ 1.8 ä¸­é‡ç‚¹ä¼˜åŒ–äº†è¿™ä¸ªæŸ¥è¯¢æ•ˆç‡ã€‚</p><p>TREEIFY_THRESHOLD ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„é˜ˆå€¼ã€‚</p><p>HashEntry ä¿®æ”¹ä¸º Nodeã€‚</p><p>put æ–¹æ³•ï¼š</p><ul><li>åˆ¤æ–­å½“å‰æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œç©ºçš„å°±éœ€è¦åˆå§‹åŒ–ï¼ˆåœ¨resizeæ–¹æ³• ä¸­ä¼šåˆ¤æ–­æ˜¯å¦è¿›è¡Œåˆå§‹åŒ–ï¼‰ã€‚</li><li>æ ¹æ®å½“å‰ key çš„ hashcode å®šä½åˆ°å…·ä½“çš„æ¡¶ä¸­å¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¡¨æ˜æ²¡æœ‰ Hash å†²çªå°±ç›´æ¥åœ¨å½“å‰ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°æ¡¶å³å¯ã€‚</li><li>å¦‚æœå½“å‰æ¡¶æœ‰å€¼ï¼ˆ Hash å†²çªï¼‰ï¼Œé‚£ä¹ˆå°±è¦æ¯”è¾ƒå½“å‰æ¡¶ä¸­çš„ keyã€key çš„ hashcode ä¸å†™å…¥çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±èµ‹å€¼ç»™ e,åœ¨ç¬¬ 8 æ­¥çš„æ—¶å€™ä¼šç»Ÿä¸€è¿›è¡Œèµ‹å€¼åŠè¿”å›ã€‚</li><li>å¦‚æœå½“å‰æ¡¶ä¸ºçº¢é»‘æ ‘ï¼Œé‚£å°±è¦æŒ‰ç…§çº¢é»‘æ ‘çš„æ–¹å¼å†™å…¥æ•°æ®ã€‚</li><li>å¦‚æœæ˜¯ä¸ªé“¾è¡¨ï¼Œå°±éœ€è¦å°†å½“å‰çš„ keyã€value å°è£…æˆä¸€ä¸ªæ–°èŠ‚ç‚¹å†™å…¥åˆ°å½“å‰æ¡¶çš„åé¢ï¼ˆå½¢æˆé“¾è¡¨ï¼‰ã€‚</li><li>æ¥ç€åˆ¤æ–­å½“å‰é“¾è¡¨çš„å¤§å°æ˜¯å¦å¤§äºé¢„è®¾çš„é˜ˆå€¼ï¼Œå¤§äºæ—¶å°±è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</li><li>å¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­æ‰¾åˆ° key ç›¸åŒæ—¶ç›´æ¥é€€å‡ºéå†ã€‚</li><li>å¦‚æœ e != null å°±ç›¸å½“äºå­˜åœ¨ç›¸åŒçš„ key,é‚£å°±éœ€è¦å°†å€¼è¦†ç›–ã€‚</li><li>æœ€ååˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚</li></ul><p>get æ–¹æ³•ï¼š</p><ul><li>é¦–å…ˆå°† key hash ä¹‹åå–å¾—æ‰€å®šä½çš„æ¡¶ã€‚</li><li>å¦‚æœæ¡¶ä¸ºç©ºåˆ™ç›´æ¥è¿”å› null ã€‚</li><li>å¦åˆ™åˆ¤æ–­æ¡¶çš„ç¬¬ä¸€ä¸ªä½ç½®(æœ‰å¯èƒ½æ˜¯é“¾è¡¨ã€çº¢é»‘æ ‘)çš„ key æ˜¯å¦ä¸ºæŸ¥è¯¢çš„ keyï¼Œæ˜¯å°±ç›´æ¥è¿”å› valueã€‚</li><li>å¦‚æœç¬¬ä¸€ä¸ªä¸åŒ¹é…ï¼Œåˆ™åˆ¤æ–­å®ƒçš„ä¸‹ä¸€ä¸ªæ˜¯çº¢é»‘æ ‘è¿˜æ˜¯é“¾è¡¨ã€‚</li><li>çº¢é»‘æ ‘å°±æŒ‰ç…§æ ‘çš„æŸ¥æ‰¾æ–¹å¼è¿”å›å€¼ã€‚</li><li>ä¸ç„¶å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†åŒ¹é…è¿”å›å€¼ã€‚</li></ul><p>ä¿®æ”¹ä¸ºçº¢é»‘æ ‘ä¹‹åæŸ¥è¯¢æ•ˆç‡ç›´æ¥æé«˜åˆ°äº† O(logn)ã€‚ä½†æ˜¯ HashMap åŸæœ‰çš„é—®é¢˜ä¹Ÿéƒ½å­˜åœ¨ï¼Œæ¯”å¦‚åœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨æ—¶å®¹æ˜“å‡ºç°æ­»å¾ªç¯ï¼š</p><ul><li>åœ¨ HashMap æ‰©å®¹çš„æ—¶å€™ä¼šè°ƒç”¨ resize() æ–¹æ³•ï¼Œå°±æ˜¯è¿™é‡Œçš„å¹¶å‘æ“ä½œå®¹æ˜“åœ¨ä¸€ä¸ªæ¡¶ä¸Šå½¢æˆç¯å½¢é“¾è¡¨ï¼›è¿™æ ·å½“è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œè®¡ç®—å‡ºçš„ index æ­£å¥½æ˜¯ç¯å½¢é“¾è¡¨çš„ä¸‹æ ‡å°±ä¼šå‡ºç°æ­»å¾ªç¯ï¼šåœ¨ 1.7 ä¸­ hash å†²çªé‡‡ç”¨çš„å¤´æ’æ³•å½¢æˆçš„é“¾è¡¨ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹ä¼šå½¢æˆå¾ªç¯é“¾è¡¨ï¼Œä¸€æ—¦æœ‰æŸ¥è¯¢è½åˆ°äº†è¿™ä¸ªé“¾è¡¨ä¸Šï¼Œå½“è·å–ä¸åˆ°å€¼æ—¶å°±ä¼šæ­»å¾ªç¯ã€‚</li></ul><h4 id="ConcurrentHashMap-1-7åŸç†ï¼š"><a href="#ConcurrentHashMap-1-7åŸç†ï¼š" class="headerlink" title="ConcurrentHashMap 1.7åŸç†ï¼š"></a>ConcurrentHashMap 1.7åŸç†ï¼š</h4><p>ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äº ReentrantLockã€‚ä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel (Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚</p><p>put æ–¹æ³•:</p><p>é¦–å…ˆæ˜¯é€šè¿‡ key å®šä½åˆ° Segmentï¼Œä¹‹ååœ¨å¯¹åº”çš„ Segment ä¸­è¿›è¡Œå…·ä½“çš„ putã€‚</p><ul><li>è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚</li><li>é¦–å…ˆç¬¬ä¸€æ­¥çš„æ—¶å€™ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥è‚¯å®šå°±æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰ï¼Œåˆ™åˆ©ç”¨ scanAndLockForPut() è‡ªæ—‹è·å–é”:</li></ul><pre><code>å°è¯•è‡ªæ—‹è·å–é”ã€‚å¦‚æœé‡è¯•çš„æ¬¡æ•°è¾¾åˆ°äº† MAX_SCAN_RETRIES åˆ™æ”¹ä¸ºé˜»å¡é”è·å–ï¼Œä¿è¯èƒ½è·å–æˆåŠŸã€‚</code></pre><ul><li>å°†å½“å‰ Segment ä¸­çš„ table é€šè¿‡ key çš„ hashcode å®šä½åˆ° HashEntryã€‚</li><li>éå†è¯¥ HashEntryï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¼ å…¥çš„ key å’Œå½“å‰éå†çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–æ—§çš„ valueã€‚</li><li>ä¸ºç©ºåˆ™éœ€è¦æ–°å»ºä¸€ä¸ª HashEntry å¹¶åŠ å…¥åˆ° Segment ä¸­ï¼ŒåŒæ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</li><li>æœ€åä¼šä½¿ç”¨unlock()è§£é™¤å½“å‰ Segment çš„é”ã€‚</li></ul><p>get æ–¹æ³•ï¼š</p><ul><li>åªéœ€è¦å°† Key é€šè¿‡ Hash ä¹‹åå®šä½åˆ°å…·ä½“çš„ Segment ï¼Œå†é€šè¿‡ä¸€æ¬¡ Hash å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚</li><li>ç”±äº HashEntry ä¸­çš„ value å±æ€§æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡è·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼ã€‚</li><li>ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚</li></ul><h4 id="ConcurrentHashMap-1-8åŸç†ï¼š"><a href="#ConcurrentHashMap-1-8åŸç†ï¼š" class="headerlink" title="ConcurrentHashMap 1.8åŸç†ï¼š"></a>ConcurrentHashMap 1.8åŸç†ï¼š</h4><p>1.7 å·²ç»è§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œå¹¶ä¸”èƒ½æ”¯æŒ N ä¸ª Segment è¿™ä¹ˆå¤šæ¬¡æ•°çš„å¹¶å‘ï¼Œä½†ä¾ç„¶å­˜åœ¨ HashMap åœ¨ 1.7 ç‰ˆæœ¬ä¸­çš„é—®é¢˜ï¼šé‚£å°±æ˜¯æŸ¥è¯¢éå†é“¾è¡¨æ•ˆç‡å¤ªä½ã€‚å’Œ 1.8 HashMap ç»“æ„ç±»ä¼¼ï¼šå…¶ä¸­æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚</p><p>CASï¼š</p><p>å¦‚æœobjå†…çš„valueå’Œexpectç›¸ç­‰ï¼Œå°±è¯æ˜æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜è¿‡è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆå°±æ›´æ–°å®ƒä¸ºupdateï¼Œå¦‚æœè¿™ä¸€æ­¥çš„CASæ²¡æœ‰æˆåŠŸï¼Œé‚£å°±é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼ç»§ç»­è¿›è¡ŒCASæ“ä½œã€‚</p><p>é—®é¢˜ï¼š</p><ul><li>ç›®å‰åœ¨JDKçš„atomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceæ¥è§£å†³ABAé—®é¢˜ã€‚è¿™ä¸ªç±»çš„compareAndSetæ–¹æ³•ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</li><li>å¦‚æœCASä¸æˆåŠŸï¼Œåˆ™ä¼šåŸåœ°è‡ªæ—‹ï¼Œå¦‚æœé•¿æ—¶é—´è‡ªæ—‹ä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</li></ul><p>put æ–¹æ³•ï¼š</p><ul><li>æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>å¦‚æœå½“å‰ key å®šä½å‡ºçš„ Nodeä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚</li><li>å¦‚æœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚</li><li>å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚</li><li>æœ€åï¼Œå¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</li></ul><p>get æ–¹æ³•ï¼š</p><ul><li>æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æ¥è¿”å›å€¼ã€‚</li><li>å¦‚æœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼è·å–å€¼ã€‚</li><li>å°±ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†è·å–å€¼ã€‚</li></ul><p>1.8 åœ¨ 1.7 çš„æ•°æ®ç»“æ„ä¸Šåšäº†å¤§çš„æ”¹åŠ¨ï¼Œé‡‡ç”¨çº¢é»‘æ ‘ä¹‹åå¯ä»¥ä¿è¯æŸ¥è¯¢æ•ˆç‡ï¼ˆO(logn)ï¼‰ï¼Œç”šè‡³å–æ¶ˆäº† ReentrantLock æ”¹ä¸ºäº† synchronizedï¼Œè¿™æ ·å¯ä»¥çœ‹å‡ºåœ¨æ–°ç‰ˆçš„ JDK ä¸­å¯¹ synchronized ä¼˜åŒ–æ˜¯å¾ˆåˆ°ä½çš„ã€‚</p><p><a href="https://crossoverjie.top/2018/07/23/java-senior/ConcurrentHashMap/">HashMapã€ConcurrentHashMap 1.7/1.8å®ç°åŸç†</a></p><p><a href="https://www.hollischuang.com/archives/2091">hash()ç®—æ³•å…¨è§£æ</a></p><h4 id="HashMapä½•æ—¶æ‰©å®¹ï¼š"><a href="#HashMapä½•æ—¶æ‰©å®¹ï¼š" class="headerlink" title="HashMapä½•æ—¶æ‰©å®¹ï¼š"></a>HashMapä½•æ—¶æ‰©å®¹ï¼š</h4><p>å½“å‘å®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­å½“å‰å®¹å™¨çš„å…ƒç´ ä¸ªæ•°ï¼Œå¦‚æœå¤§äºç­‰äºé˜ˆå€¼â€”å³å¤§äºå½“å‰æ•°ç»„çš„é•¿åº¦ä¹˜ä»¥åŠ è½½å› å­çš„å€¼çš„æ—¶å€™ï¼Œå°±è¦è‡ªåŠ¨æ‰©å®¹ã€‚</p><h4 id="æ‰©å®¹çš„ç®—æ³•æ˜¯ä»€ä¹ˆï¼š"><a href="#æ‰©å®¹çš„ç®—æ³•æ˜¯ä»€ä¹ˆï¼š" class="headerlink" title="æ‰©å®¹çš„ç®—æ³•æ˜¯ä»€ä¹ˆï¼š"></a>æ‰©å®¹çš„ç®—æ³•æ˜¯ä»€ä¹ˆï¼š</h4><p>æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ã€‚</p><h4 id="Hashmapå¦‚ä½•è§£å†³æ•£åˆ—ç¢°æ’ï¼ˆå¿…é—®ï¼‰ï¼Ÿ"><a href="#Hashmapå¦‚ä½•è§£å†³æ•£åˆ—ç¢°æ’ï¼ˆå¿…é—®ï¼‰ï¼Ÿ" class="headerlink" title="Hashmapå¦‚ä½•è§£å†³æ•£åˆ—ç¢°æ’ï¼ˆå¿…é—®ï¼‰ï¼Ÿ"></a>Hashmapå¦‚ä½•è§£å†³æ•£åˆ—ç¢°æ’ï¼ˆå¿…é—®ï¼‰ï¼Ÿ</h4><p>Javaä¸­HashMapæ˜¯åˆ©ç”¨â€œæ‹‰é“¾æ³•â€å¤„ç†HashCodeçš„ç¢°æ’é—®é¢˜ã€‚åœ¨è°ƒç”¨HashMapçš„putæ–¹æ³•æˆ–getæ–¹æ³•æ—¶ï¼Œéƒ½ä¼šé¦–å…ˆè°ƒç”¨hashcodeæ–¹æ³•ï¼Œå»æŸ¥æ‰¾ç›¸å…³çš„keyï¼Œå½“æœ‰å†²çªæ—¶ï¼Œå†è°ƒç”¨equalsæ–¹æ³•ã€‚hashMapåŸºäºhasingåŸç†ï¼Œæˆ‘ä»¬é€šè¿‡putå’Œgetæ–¹æ³•å­˜å–å¯¹è±¡ã€‚å½“æˆ‘ä»¬å°†é”®å€¼å¯¹ä¼ é€’ç»™putæ–¹æ³•æ—¶ï¼Œä»–è°ƒç”¨é”®å¯¹è±¡çš„hashCode()æ–¹æ³•æ¥è®¡ç®—hashCodeï¼Œç„¶åæ‰¾åˆ°bucketï¼ˆå“ˆå¸Œæ¡¶ï¼‰ä½ç½®æ¥å­˜å‚¨å¯¹è±¡ã€‚å½“è·å–å¯¹è±¡æ—¶ï¼Œé€šè¿‡é”®å¯¹è±¡çš„equals()æ–¹æ³•æ‰¾åˆ°æ­£ç¡®çš„é”®å€¼å¯¹ï¼Œç„¶åè¿”å›å€¼å¯¹è±¡ã€‚HashMapä½¿ç”¨é“¾è¡¨æ¥è§£å†³ç¢°æ’é—®é¢˜ï¼Œå½“ç¢°æ’å‘ç”Ÿäº†ï¼Œå¯¹è±¡å°†ä¼šå­˜å‚¨åœ¨é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚hashMapåœ¨æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹å­˜å‚¨é”®å€¼å¯¹å¯¹è±¡ã€‚å½“ä¸¤ä¸ªä¸åŒçš„é”®å´æœ‰ç›¸åŒçš„hashCodeæ—¶ï¼Œä»–ä»¬ä¼šå­˜å‚¨åœ¨åŒä¸€ä¸ªbucketä½ç½®çš„é“¾è¡¨ä¸­ã€‚é”®å¯¹è±¡çš„equals()æ¥æ‰¾åˆ°é”®å€¼å¯¹ã€‚</p><h4 id="Hashmapåº•å±‚ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ"><a href="#Hashmapåº•å±‚ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="Hashmapåº•å±‚ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ"></a>Hashmapåº•å±‚ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ</h4><ul><li>å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨æ—¶å®¹æ˜“å‡ºç°æ­»å¾ªç¯ï¼Œåœ¨ HashMap æ‰©å®¹çš„æ—¶å€™ä¼šè°ƒç”¨ resize() æ–¹æ³•ï¼Œå°±æ˜¯è¿™é‡Œçš„å¹¶å‘æ“ä½œå®¹æ˜“åœ¨ä¸€ä¸ªæ¡¶ä¸Šå½¢æˆç¯å½¢é“¾è¡¨ï¼›è¿™æ ·å½“è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œè®¡ç®—å‡ºçš„ index æ­£å¥½æ˜¯ç¯å½¢é“¾è¡¨çš„ä¸‹æ ‡å°±ä¼šå‡ºç°æ­»å¾ªç¯ï¼›</li><li>åœ¨ 1.7 ä¸­ hash å†²çªé‡‡ç”¨çš„å¤´æ’æ³•å½¢æˆçš„é“¾è¡¨ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹ä¼šå½¢æˆå¾ªç¯é“¾è¡¨ï¼Œä¸€æ—¦æœ‰æŸ¥è¯¢è½åˆ°äº†è¿™ä¸ªé“¾è¡¨ä¸Šï¼Œå½“è·å–ä¸åˆ°å€¼æ—¶å°±ä¼šæ­»å¾ªç¯ã€‚</li></ul><h3 id="5ã€ArrayMapè·ŸSparseArrayåœ¨HashMapä¸Šé¢çš„æ”¹è¿›ï¼Ÿ"><a href="#5ã€ArrayMapè·ŸSparseArrayåœ¨HashMapä¸Šé¢çš„æ”¹è¿›ï¼Ÿ" class="headerlink" title="5ã€ArrayMapè·ŸSparseArrayåœ¨HashMapä¸Šé¢çš„æ”¹è¿›ï¼Ÿ"></a>5ã€ArrayMapè·ŸSparseArrayåœ¨HashMapä¸Šé¢çš„æ”¹è¿›ï¼Ÿ</h3><p>HashMapè¦å­˜å‚¨å®Œè¿™äº›æ•°æ®å°†è¦ä¸æ–­çš„æ‰©å®¹ï¼Œè€Œä¸”åœ¨æ­¤è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ä¸æ–­çš„åšhashè¿ç®—ï¼Œè¿™å°†å¯¹æˆ‘ä»¬çš„å†…å­˜ç©ºé—´é€ æˆå¾ˆå¤§æ¶ˆè€—å’Œæµªè´¹ã€‚</p><h4 id="SparseArray"><a href="#SparseArray" class="headerlink" title="SparseArray:"></a>SparseArray:</h4><p>SparseArrayæ¯”HashMapæ›´çœå†…å­˜ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹æ€§èƒ½æ›´å¥½ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒé¿å…äº†å¯¹keyçš„è‡ªåŠ¨è£…ç®±ï¼ˆintè½¬ä¸ºIntegerç±»å‹ï¼‰ï¼Œå®ƒå†…éƒ¨åˆ™æ˜¯é€šè¿‡ä¸¤ä¸ªæ•°ç»„æ¥è¿›è¡Œæ•°æ®å­˜å‚¨çš„ï¼Œä¸€ä¸ªå­˜å‚¨keyï¼Œå¦å¤–ä¸€ä¸ªå­˜å‚¨valueï¼Œä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå®ƒå†…éƒ¨å¯¹æ•°æ®è¿˜é‡‡å–äº†å‹ç¼©çš„æ–¹å¼æ¥è¡¨ç¤ºç¨€ç–æ•°ç»„çš„æ•°æ®ï¼Œä»è€ŒèŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ä»æºç ä¸­å¯ä»¥çœ‹åˆ°keyå’Œvalueåˆ†åˆ«æ˜¯ç”¨æ•°ç»„è¡¨ç¤ºï¼š</p><pre><code>private int[] mKeys;private Object[] mValues;</code></pre><p>åŒæ—¶ï¼ŒSparseArrayåœ¨å­˜å‚¨å’Œè¯»å–æ•°æ®æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯äºŒåˆ†æŸ¥æ‰¾æ³•ã€‚ä¹Ÿå°±æ˜¯åœ¨putæ·»åŠ æ•°æ®çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•å’Œä¹‹å‰çš„keyæ¯”è¾ƒå½“å‰æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ çš„keyçš„å¤§å°ï¼Œç„¶åæŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—å¥½ï¼Œæ‰€ä»¥ï¼ŒSparseArrayå­˜å‚¨çš„å…ƒç´ éƒ½æ˜¯æŒ‰å…ƒç´ çš„keyå€¼ä»å°åˆ°å¤§æ’åˆ—å¥½çš„ã€‚<br>è€Œåœ¨è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•åˆ¤æ–­å…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥ï¼Œåœ¨è·å–æ•°æ®çš„æ—¶å€™éå¸¸å¿«ï¼Œæ¯”HashMapå¿«çš„å¤šã€‚</p><h4 id="ArrayMap"><a href="#ArrayMap" class="headerlink" title="ArrayMap:"></a>ArrayMap:</h4><p>ArrayMapåˆ©ç”¨ä¸¤ä¸ªæ•°ç»„ï¼ŒmHashesç”¨æ¥ä¿å­˜æ¯ä¸€ä¸ªkeyçš„hashå€¼ï¼ŒmArrrayå¤§å°ä¸ºmHashesçš„2å€ï¼Œä¾æ¬¡ä¿å­˜keyå’Œvalueã€‚</p><pre><code>mHashes[index] = hash;mArray[index&lt;&lt;1] = key;mArray[(index&lt;&lt;1)+1] = value;</code></pre><p>å½“æ’å…¥æ—¶ï¼Œæ ¹æ®keyçš„hashcode()æ–¹æ³•å¾—åˆ°hashå€¼ï¼Œè®¡ç®—å‡ºåœ¨mArraysçš„indexä½ç½®ï¼Œç„¶ååˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°å¯¹åº”çš„ä½ç½®è¿›è¡Œæ’å…¥ï¼Œå½“å‡ºç°å“ˆå¸Œå†²çªæ—¶ï¼Œä¼šåœ¨indexçš„ç›¸é‚»ä½ç½®æ’å…¥ã€‚</p><h4 id="å‡è®¾æ•°æ®é‡éƒ½åœ¨åƒçº§ä»¥å†…çš„æƒ…å†µä¸‹ï¼š"><a href="#å‡è®¾æ•°æ®é‡éƒ½åœ¨åƒçº§ä»¥å†…çš„æƒ…å†µä¸‹ï¼š" class="headerlink" title="å‡è®¾æ•°æ®é‡éƒ½åœ¨åƒçº§ä»¥å†…çš„æƒ…å†µä¸‹ï¼š"></a>å‡è®¾æ•°æ®é‡éƒ½åœ¨åƒçº§ä»¥å†…çš„æƒ…å†µä¸‹ï¼š</h4><p>1ã€å¦‚æœkeyçš„ç±»å‹å·²ç»ç¡®å®šä¸ºintç±»å‹ï¼Œé‚£ä¹ˆä½¿ç”¨SparseArrayï¼Œå› ä¸ºå®ƒé¿å…äº†è‡ªåŠ¨è£…ç®±çš„è¿‡ç¨‹ï¼Œå¦‚æœkeyä¸ºlongç±»å‹ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ä¸ªLongSparseArrayæ¥ç¡®ä¿keyä¸ºlongç±»å‹æ—¶çš„ä½¿ç”¨</p><p>2ã€å¦‚æœkeyç±»å‹ä¸ºå…¶å®ƒçš„ç±»å‹ï¼Œåˆ™ä½¿ç”¨ArrayMapã€‚</p><h2 id="ä¸‰ã€åå°„-ï¼ˆâ­â­â­ï¼‰"><a href="#ä¸‰ã€åå°„-ï¼ˆâ­â­â­ï¼‰" class="headerlink" title="ä¸‰ã€åå°„ ï¼ˆâ­â­â­ï¼‰"></a>ä¸‰ã€åå°„ ï¼ˆâ­â­â­ï¼‰</h2><h3 id="1ã€è¯´è¯´ä½ å¯¹Javaåå°„çš„ç†è§£ï¼Ÿ"><a href="#1ã€è¯´è¯´ä½ å¯¹Javaåå°„çš„ç†è§£ï¼Ÿ" class="headerlink" title="1ã€è¯´è¯´ä½ å¯¹Javaåå°„çš„ç†è§£ï¼Ÿ"></a>1ã€è¯´è¯´ä½ å¯¹Javaåå°„çš„ç†è§£ï¼Ÿ</h3><p>ç­”ï¼šJava ä¸­çš„åå°„é¦–å…ˆæ˜¯èƒ½å¤Ÿè·å–åˆ°Javaä¸­è¦åå°„ç±»çš„å­—èŠ‚ç ï¼Œ è·å–å­—èŠ‚ç æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><p>1.Class.forName(className)</p><p>2.ç±»å.class</p><p>3.this.getClass()ã€‚</p><p>ç„¶åå°†å­—èŠ‚ç ä¸­çš„æ–¹æ³•ï¼Œå˜é‡ï¼Œæ„é€ å‡½æ•°ç­‰æ˜ å°„æˆç›¸åº”çš„Methodã€Filedã€Constructorç­‰ç±»ï¼Œè¿™äº›ç±»æä¾›äº†ä¸°å¯Œçš„æ–¹æ³•å¯ä»¥è¢«æˆ‘ä»¬æ‰€ä½¿ç”¨ã€‚</p><p><a href="https://www.sczyh30.com/posts/Java/java-reflection-1/">æ·±å…¥è§£æJavaåå°„ï¼ˆ1ï¼‰ - åŸºç¡€</a></p><p><a href="https://blog.csdn.net/sinat_38259539/article/details/71799078">JavaåŸºç¡€ä¹‹â€”åå°„ï¼ˆéå¸¸é‡è¦ï¼‰</a></p><h2 id="å››ã€æ³›å‹-ï¼ˆâ­â­ï¼‰"><a href="#å››ã€æ³›å‹-ï¼ˆâ­â­ï¼‰" class="headerlink" title="å››ã€æ³›å‹ ï¼ˆâ­â­ï¼‰"></a>å››ã€æ³›å‹ ï¼ˆâ­â­ï¼‰</h2><h3 id="1ã€ç®€å•ä»‹ç»ä¸€ä¸‹javaä¸­çš„æ³›å‹ï¼Œæ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µï¼Œè§£æä¸åˆ†æ´¾ï¼Ÿ"><a href="#1ã€ç®€å•ä»‹ç»ä¸€ä¸‹javaä¸­çš„æ³›å‹ï¼Œæ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µï¼Œè§£æä¸åˆ†æ´¾ï¼Ÿ" class="headerlink" title="1ã€ç®€å•ä»‹ç»ä¸€ä¸‹javaä¸­çš„æ³›å‹ï¼Œæ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µï¼Œè§£æä¸åˆ†æ´¾ï¼Ÿ"></a>1ã€ç®€å•ä»‹ç»ä¸€ä¸‹javaä¸­çš„æ³›å‹ï¼Œæ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µï¼Œè§£æä¸åˆ†æ´¾ï¼Ÿ</h3><p>æ³›å‹æ˜¯Java SE1.5çš„æ–°ç‰¹æ€§ï¼Œæ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“çš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ã€‚è¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•çš„åˆ›å»ºä¸­ï¼Œåˆ†åˆ«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚ Javaè¯­è¨€å¼•å…¥æ³›å‹çš„å¥½å¤„æ˜¯å®‰å…¨ç®€å•ã€‚</p><p>åœ¨Java SE 1.5ä¹‹å‰ï¼Œæ²¡æœ‰æ³›å‹çš„æƒ…å†µçš„ä¸‹ï¼Œé€šè¿‡å¯¹ç±»å‹Objectçš„å¼•ç”¨æ¥å®ç°å‚æ•°çš„â€œä»»æ„åŒ–â€ï¼Œâ€œä»»æ„åŒ–â€å¸¦æ¥çš„ç¼ºç‚¹æ˜¯è¦åšæ˜¾å¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè€Œè¿™ç§è½¬æ¢æ˜¯è¦æ±‚å¼€å‘è€…å®é™…å‚æ•°ç±»å‹å¯ä»¥é¢„çŸ¥çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚å¯¹äºå¼ºåˆ¶ç±»å‹æ¢é”™è¯¯çš„æƒ…å†µï¼Œç¼–è¯‘å™¨å¯èƒ½ä¸æç¤ºé”™è¯¯ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™å‡ºç°å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨éšæ‚£ã€‚</p><p>æ³›å‹çš„å¥½å¤„æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥ç±»å‹å®‰å…¨ï¼Œå¹¶ä¸”æ‰€æœ‰çš„è½¬æ¢éƒ½æ˜¯è‡ªåŠ¨å’Œéšå¼çš„ï¼Œæé«˜ä»£ç çš„é‡ç”¨ç‡ã€‚</p><p>1ã€æ³›å‹çš„ç±»å‹å‚æ•°åªèƒ½æ˜¯ç±»ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»ï¼‰ï¼Œä¸æ˜¯ç®€å•ç±»å‹ã€‚</p><p>2ã€åŒä¸€ç§æ³›å‹å¯ä»¥å¯¹åº”å¤šä¸ªç‰ˆæœ¬ï¼ˆå› ä¸ºå‚æ•°ç±»å‹æ˜¯ä¸ç¡®çš„ï¼‰ï¼Œä¸åŒç‰ˆæœ¬çš„æ³›å‹ç±»å®ä¾‹æ˜¯ä¸å…¼å®¹çš„ã€‚</p><p>3ã€æ³›å‹çš„ç±»å‹å‚æ•°å¯ä»¥æœ‰å¤šä¸ªã€‚</p><p>4ã€æ³›å‹çš„å‚æ•°ç±»å‹å¯ä»¥ä½¿ç”¨extendsè¯­å¥ï¼Œä¾‹å¦‚<T extends superclass>ã€‚ä¹ æƒ¯ä¸Šç§°ä¸ºâ€œæœ‰ç•Œç±»å‹â€ã€‚</p><p>5ã€æ³›å‹çš„å‚æ•°ç±»å‹è¿˜å¯ä»¥æ˜¯é€šé…ç¬¦ç±»å‹ã€‚ä¾‹å¦‚Class&lt;?&gt; classType = Class.forName(â€œjava.lang.Stringâ€);</p><h4 id="æ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µ"><a href="#æ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µ" class="headerlink" title="æ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µ"></a>æ³›å‹æ“¦é™¤ä»¥åŠç›¸å…³çš„æ¦‚å¿µ</h4><p>æ³›å‹ä¿¡æ¯åªå­˜åœ¨ä»£ç ç¼–è¯‘é˜¶æ®µï¼Œåœ¨è¿›å…¥JVMä¹‹å‰ï¼Œä¸æ³›å‹å…³çš„ä¿¡æ¯éƒ½ä¼šè¢«æ“¦é™¤æ‰ã€‚</p><p>åœ¨ç±»å‹æ“¦é™¤çš„æ—¶å€™ï¼Œå¦‚æœæ³›å‹ç±»é‡Œçš„ç±»å‹å‚æ•°æ²¡æœ‰æŒ‡å®šä¸Šé™ï¼Œåˆ™ä¼šè¢«è½¬æˆObjectç±»å‹ï¼Œå¦‚æœæŒ‡å®šäº†ä¸Šé™ï¼Œåˆ™ä¼šè¢«ä¼ è½¬æ¢æˆå¯¹åº”çš„ç±»å‹ä¸Šé™ã€‚</p><p>Javaä¸­çš„æ³›å‹åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ç¼–è¯‘å™¨è¿™ä¸ªå±‚æ¬¡æ¥å®ç°çš„ã€‚ç”Ÿæˆçš„Javaå­—èŠ‚ç ä¸­æ˜¯ä¸åŒ…å«æ³›å‹ä¸­çš„ç±»å‹ä¿¡æ¯çš„ã€‚ä½¿ç”¨æ³›å‹çš„æ—¶å€™åŠ ä¸Šçš„ç±»å‹å‚æ•°ï¼Œä¼šåœ¨ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™æ“¦é™¤æ‰ã€‚è¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºç±»å‹æ“¦é™¤ã€‚</p><p>ç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼š</p><p>1ã€å…ˆæ£€æŸ¥ï¼Œåœ¨ç¼–è¯‘ï¼Œä»¥åŠæ£€æŸ¥ç¼–è¯‘çš„å¯¹è±¡å’Œå¼•ç”¨ä¼ é€’çš„é¢˜</p><p>2ã€è‡ªåŠ¨ç±»å‹è½¬æ¢</p><p>3ã€ç±»å‹æ“¦é™¤ä¸å¤šæ€çš„å†²çªå’Œè§£å†³æ–¹æ³•</p><p>4ã€æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹</p><p>5ã€è¿è¡Œæ—¶ç±»å‹æŸ¥è¯¢</p><p>6ã€å¼‚å¸¸ä¸­ä½¿ç”¨æ³›å‹çš„é—®é¢˜</p><p>7ã€æ•°ç»„ï¼ˆè¿™ä¸ªä¸å±äºç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜ï¼‰</p><p>9ã€ç±»å‹æ“¦é™¤åçš„å†²çª</p><p>10ã€æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜</p><h2 id="äº”ã€æ³¨è§£-ï¼ˆâ­â­ï¼‰"><a href="#äº”ã€æ³¨è§£-ï¼ˆâ­â­ï¼‰" class="headerlink" title="äº”ã€æ³¨è§£ ï¼ˆâ­â­ï¼‰"></a>äº”ã€æ³¨è§£ ï¼ˆâ­â­ï¼‰</h2><h3 id="1ã€è¯´è¯´ä½ å¯¹Javaæ³¨è§£çš„ç†è§£ï¼Ÿ"><a href="#1ã€è¯´è¯´ä½ å¯¹Javaæ³¨è§£çš„ç†è§£ï¼Ÿ" class="headerlink" title="1ã€è¯´è¯´ä½ å¯¹Javaæ³¨è§£çš„ç†è§£ï¼Ÿ"></a>1ã€è¯´è¯´ä½ å¯¹Javaæ³¨è§£çš„ç†è§£ï¼Ÿ</h3><p>æ³¨è§£ç›¸å½“äºä¸€ç§æ ‡è®°ï¼Œåœ¨ç¨‹åºä¸­åŠ äº†æ³¨è§£å°±ç­‰äºä¸ºç¨‹åºæ‰“ä¸Šäº†æŸç§æ ‡è®°ã€‚ç¨‹åºå¯ä»¥åˆ©ç”¨avaçš„åå°„æœºåˆ¶æ¥äº†è§£ä½ çš„ç±»åŠå„ç§å…ƒç´ ä¸Šæœ‰æ— ä½•ç§æ ‡è®°ï¼Œé’ˆå¯¹ä¸åŒçš„æ ‡è®°ï¼Œå°±å»åšç›¸åº”çš„äº‹ä»¶ã€‚æ ‡è®°å¯ä»¥åŠ åœ¨åŒ…ï¼Œç±»ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šã€‚</p><h2 id="å…­ã€å…¶å®ƒ-ï¼ˆâ­â­ï¼‰"><a href="#å…­ã€å…¶å®ƒ-ï¼ˆâ­â­ï¼‰" class="headerlink" title="å…­ã€å…¶å®ƒ ï¼ˆâ­â­ï¼‰"></a>å…­ã€å…¶å®ƒ ï¼ˆâ­â­ï¼‰</h2><h3 id="1ã€Javaçš„charæ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œæ˜¯æ€ä¹ˆå­˜Utf-8çš„å­—ç¬¦çš„ï¼Ÿ"><a href="#1ã€Javaçš„charæ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œæ˜¯æ€ä¹ˆå­˜Utf-8çš„å­—ç¬¦çš„ï¼Ÿ" class="headerlink" title="1ã€Javaçš„charæ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œæ˜¯æ€ä¹ˆå­˜Utf-8çš„å­—ç¬¦çš„ï¼Ÿ"></a>1ã€Javaçš„charæ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œæ˜¯æ€ä¹ˆå­˜Utf-8çš„å­—ç¬¦çš„ï¼Ÿ</h3><h4 id="æ˜¯å¦ç†Ÿæ‚‰Java-charå’Œå­—ç¬¦ä¸²ï¼ˆåˆçº§ï¼‰"><a href="#æ˜¯å¦ç†Ÿæ‚‰Java-charå’Œå­—ç¬¦ä¸²ï¼ˆåˆçº§ï¼‰" class="headerlink" title="æ˜¯å¦ç†Ÿæ‚‰Java charå’Œå­—ç¬¦ä¸²ï¼ˆåˆçº§ï¼‰"></a>æ˜¯å¦ç†Ÿæ‚‰Java charå’Œå­—ç¬¦ä¸²ï¼ˆåˆçº§ï¼‰</h4><ul><li>charæ˜¯2ä¸ªå­—èŠ‚ï¼Œutf-8æ˜¯1~3ä¸ªå­—èŠ‚ã€‚</li><li>å­—ç¬¦é›†ï¼ˆå­—ç¬¦é›†ä¸æ˜¯ç¼–ç ï¼‰ï¼šASCIIç ä¸Unicodeç ã€‚</li><li>å­—ç¬¦ -&gt; 0xd83dde00(ç ç‚¹ï¼‰ã€‚</li></ul><h4 id="æ˜¯å¦äº†è§£å­—ç¬¦çš„æ˜ å°„å’Œå­˜å‚¨ç»†èŠ‚ï¼ˆä¸­çº§ï¼‰"><a href="#æ˜¯å¦äº†è§£å­—ç¬¦çš„æ˜ å°„å’Œå­˜å‚¨ç»†èŠ‚ï¼ˆä¸­çº§ï¼‰" class="headerlink" title="æ˜¯å¦äº†è§£å­—ç¬¦çš„æ˜ å°„å’Œå­˜å‚¨ç»†èŠ‚ï¼ˆä¸­çº§ï¼‰"></a>æ˜¯å¦äº†è§£å­—ç¬¦çš„æ˜ å°„å’Œå­˜å‚¨ç»†èŠ‚ï¼ˆä¸­çº§ï¼‰</h4><p>äººç±»è®¤çŸ¥ï¼šå­—ç¬¦ =&gt; å­—ç¬¦é›†ï¼š0x4e2d(char) =&gt; è®¡ç®—æœºå­˜å‚¨(byte)ï¼š01001110:4eã€00101101:2d</p><p>ç¼–ç ï¼šUTF-16</p><p>â€œä¸­â€.getBytes(â€œutf-6â€); -&gt; fe ff 4e 2dï¼š4ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­å‰é¢çš„fe ffåªæ˜¯å­—èŠ‚åºæ ‡å¿—ã€‚</p><h4 id="æ˜¯å¦èƒ½è§¦ç±»æ—é€šï¼Œæ¨ªå‘å¯¹æ¯”å…¶ä»–è¯­è¨€ï¼ˆé«˜çº§ï¼‰"><a href="#æ˜¯å¦èƒ½è§¦ç±»æ—é€šï¼Œæ¨ªå‘å¯¹æ¯”å…¶ä»–è¯­è¨€ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="æ˜¯å¦èƒ½è§¦ç±»æ—é€šï¼Œæ¨ªå‘å¯¹æ¯”å…¶ä»–è¯­è¨€ï¼ˆé«˜çº§ï¼‰"></a>æ˜¯å¦èƒ½è§¦ç±»æ—é€šï¼Œæ¨ªå‘å¯¹æ¯”å…¶ä»–è¯­è¨€ï¼ˆé«˜çº§ï¼‰</h4><p>Python2çš„å­—ç¬¦ä¸²ï¼š</p><ul><li>byteString = â€œä¸­â€</li><li>unicodeString = uâ€ä¸­â€</li></ul><p>ä»¤äººè¿·æƒ‘çš„å­—ç¬¦ä¸²é•¿åº¦</p><pre><code>emoij = u&quot;è¡¨æƒ…&quot;print(len(emoji)</code></pre><p>Javaä¸python 3.2åŠä»¥ä¸‹ï¼š2å­—èŠ‚<br>python &gt;= 3.3ï¼š1å­—èŠ‚</p><p><strong>æ³¨æ„ï¼šJava 9å¯¹latinå­—ç¬¦çš„å­˜å‚¨ç©ºé—´åšäº†ä¼˜åŒ–ï¼Œä½†å­—ç¬¦ä¸²é•¿åº¦è¿˜æ˜¯!= å­—ç¬¦æ•°ã€‚</strong></p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li>Java charä¸å­˜UTF-8çš„å­—èŠ‚ï¼Œè€Œæ˜¯UTF-16ã€‚</li><li>Unicodeé€šç”¨å­—ç¬¦é›†å ä¸¤ä¸ªå­—èŠ‚ï¼Œä¾‹å¦‚â€œä¸­â€ã€‚</li><li>Unicodeæ‰©å±•å­—ç¬¦é›†éœ€è¦ç”¨ä¸€å¯¹charæ¥è¡¨ç¤ºï¼Œä¾‹å¦‚â€œè¡¨æƒ…â€ã€‚</li><li>Unicodeæ˜¯å­—ç¬¦é›†ï¼Œä¸æ˜¯ç¼–ç ï¼Œä½œç”¨ç±»ä¼¼äºASCIIç ã€‚</li><li>Java Stringçš„lengthä¸æ˜¯å­—ç¬¦æ•°ã€‚</li></ul><h3 id="2ã€Java-Stringå¯ä»¥æœ‰å¤šé•¿ï¼Ÿ"><a href="#2ã€Java-Stringå¯ä»¥æœ‰å¤šé•¿ï¼Ÿ" class="headerlink" title="2ã€Java Stringå¯ä»¥æœ‰å¤šé•¿ï¼Ÿ"></a>2ã€Java Stringå¯ä»¥æœ‰å¤šé•¿ï¼Ÿ</h3><h4 id="æ˜¯å¦å¯¹å­—ç¬¦ä¸²ç¼–è§£ç æœ‰æ·±å…¥äº†è§£ï¼ˆä¸­çº§ï¼‰"><a href="#æ˜¯å¦å¯¹å­—ç¬¦ä¸²ç¼–è§£ç æœ‰æ·±å…¥äº†è§£ï¼ˆä¸­çº§ï¼‰" class="headerlink" title="æ˜¯å¦å¯¹å­—ç¬¦ä¸²ç¼–è§£ç æœ‰æ·±å…¥äº†è§£ï¼ˆä¸­çº§ï¼‰"></a>æ˜¯å¦å¯¹å­—ç¬¦ä¸²ç¼–è§£ç æœ‰æ·±å…¥äº†è§£ï¼ˆä¸­çº§ï¼‰</h4><p>åˆ†é…åˆ°æ ˆï¼š</p><pre><code>String longString = &quot;aaa...aaa&quot;;</code></pre><p>åˆ†é…åˆ°å †ï¼š</p><pre><code>byte[] bytes = loadFromFile(new File(&quot;superLongText.txt&quot;);String superLongString = new String(bytes);</code></pre><h4 id="æ˜¯å¦å¯¹å­—ç¬¦ä¸²åœ¨å†…å­˜å½“ä¸­çš„å­˜å‚¨å½¢å¼æœ‰æ·±å…¥äº†è§£ï¼ˆé«˜çº§ï¼‰"><a href="#æ˜¯å¦å¯¹å­—ç¬¦ä¸²åœ¨å†…å­˜å½“ä¸­çš„å­˜å‚¨å½¢å¼æœ‰æ·±å…¥äº†è§£ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="æ˜¯å¦å¯¹å­—ç¬¦ä¸²åœ¨å†…å­˜å½“ä¸­çš„å­˜å‚¨å½¢å¼æœ‰æ·±å…¥äº†è§£ï¼ˆé«˜çº§ï¼‰"></a>æ˜¯å¦å¯¹å­—ç¬¦ä¸²åœ¨å†…å­˜å½“ä¸­çš„å­˜å‚¨å½¢å¼æœ‰æ·±å…¥äº†è§£ï¼ˆé«˜çº§ï¼‰</h4><h4 id="æ˜¯å¦å¯¹Javaè™šæ‹Ÿæœºå­—èŠ‚ç æœ‰è¶³å¤Ÿçš„äº†è§£ï¼ˆé«˜çº§ï¼‰"><a href="#æ˜¯å¦å¯¹Javaè™šæ‹Ÿæœºå­—èŠ‚ç æœ‰è¶³å¤Ÿçš„äº†è§£ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="æ˜¯å¦å¯¹Javaè™šæ‹Ÿæœºå­—èŠ‚ç æœ‰è¶³å¤Ÿçš„äº†è§£ï¼ˆé«˜çº§ï¼‰"></a>æ˜¯å¦å¯¹Javaè™šæ‹Ÿæœºå­—èŠ‚ç æœ‰è¶³å¤Ÿçš„äº†è§£ï¼ˆé«˜çº§ï¼‰</h4><p>æºæ–‡ä»¶ï¼š*.java</p><pre><code>String longString = &quot;aaa...aaa&quot;;å­—èŠ‚æ•° &lt;= 65535</code></pre><p>å­—èŠ‚ç ï¼š*.class</p><pre><code>CONSTANT_Utf8_info &#123;     u1 tag;     u2 length;    (0~65535) u1 bytes[length];     æœ€å¤š65535ä¸ªå­—èŠ‚ &#125;</code></pre><p>javacçš„ç¼–è¯‘å™¨æœ‰é—®é¢˜ï¼Œ&lt; 65535åº”è¯¥æ”¹ä¸º&lt; = 65535ã€‚</p><p><strong>Java String æ ˆåˆ†é…</strong></p><ul><li>å—å­—èŠ‚ç é™åˆ¶ï¼Œå­—ç¬¦ä¸²æœ€ç»ˆçš„MUTF-8å­—èŠ‚æ•°ä¸è¶…è¿‡65535ã€‚</li><li>Latinå­—ç¬¦ï¼Œå—Javacä»£ç é™åˆ¶ï¼Œæœ€å¤š65534ä¸ªã€‚</li><li>éLatinå­—ç¬¦æœ€ç»ˆå¯¹åº”å­—èŠ‚ä¸ªæ•°å·®å¼‚è¾ƒå¤§ï¼Œæœ€å¤šå­—èŠ‚ä¸ªæ•°æ˜¯65535ã€‚</li><li>å¦‚æœè¿è¡Œæ—¶æ–¹æ³•åŒºè®¾ç½®è¾ƒå°ï¼Œä¹Ÿä¼šå—åˆ°æ–¹æ³•åŒºå¤§å°çš„é™åˆ¶ã€‚</li></ul><h4 id="æ˜¯å¦å¯¹javaè™šæ‹ŸæœºæŒ‡ä»¤æœ‰ä¸€å®šçš„è®¤è¯†ï¼ˆé«˜çº§ï¼‰"><a href="#æ˜¯å¦å¯¹javaè™šæ‹ŸæœºæŒ‡ä»¤æœ‰ä¸€å®šçš„è®¤è¯†ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="æ˜¯å¦å¯¹javaè™šæ‹ŸæœºæŒ‡ä»¤æœ‰ä¸€å®šçš„è®¤è¯†ï¼ˆé«˜çº§ï¼‰"></a>æ˜¯å¦å¯¹javaè™šæ‹ŸæœºæŒ‡ä»¤æœ‰ä¸€å®šçš„è®¤è¯†ï¼ˆé«˜çº§ï¼‰</h4><p>new String(bytes)å†…éƒ¨æ˜¯é‡‡ç”¨äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå…¶å¯¹åº”çš„è™šæ‹ŸæœºæŒ‡ä»¤æ˜¯newarray [int] ï¼Œæ•°ç»„ç†è®ºæœ€å¤§ä¸ªæ•°ä¸ºInteger.MAX_VALUEï¼Œæœ‰äº›è™šæ‹Ÿæœºéœ€è¦ä¸€äº›å¤´éƒ¨ä¿¡æ¯ï¼Œæ‰€ä»¥MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8ã€‚</p><p><strong>Java String å †åˆ†é…</strong></p><ul><li>å—è™šæ‹ŸæœºæŒ‡ä»¤é™åˆ¶ï¼Œå­—ç¬¦æ•°ç†è®ºä¸Šé™ä¸ºInteger.MAX_VALUEã€‚</li><li>å—è™šæ‹Ÿæœºå®ç°é™åˆ¶ï¼Œå®é™…ä¸Šé™å¯èƒ½ä¼šå°äºInteger.MAX_VALUEã€‚</li><li>å¦‚æœå †å†…å­˜è¾ƒå°ï¼Œä¹Ÿä¼šå—åˆ°å †å†…å­˜çš„é™åˆ¶ã€‚</li></ul><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong>Java Stringå­—é¢é‡å½¢å¼</strong></p><ul><li>å­—èŠ‚ç ä¸­CONSTANT_Utf8_infoçš„é™åˆ¶</li><li>Javacæºç é€»è¾‘çš„é™åˆ¶</li><li>æ–¹æ³•åŒºå¤§å°çš„é™åˆ¶</li></ul><p><strong>Java Stringè¿è¡Œæ—¶åˆ›å»ºåœ¨å †ä¸Šçš„å½¢å¼</strong></p><ul><li>Javaè™šæ‹ŸæœºæŒ‡ä»¤newarrayçš„é™åˆ¶</li><li>Javaè™šæ‹Ÿæœºå †å†…å­˜å¤§å°çš„é™åˆ¶</li></ul><h3 id="3ã€Javaçš„åŒ¿åå†…éƒ¨ç±»æœ‰å“ªäº›é™åˆ¶ï¼Ÿ"><a href="#3ã€Javaçš„åŒ¿åå†…éƒ¨ç±»æœ‰å“ªäº›é™åˆ¶ï¼Ÿ" class="headerlink" title="3ã€Javaçš„åŒ¿åå†…éƒ¨ç±»æœ‰å“ªäº›é™åˆ¶ï¼Ÿ"></a>3ã€Javaçš„åŒ¿åå†…éƒ¨ç±»æœ‰å“ªäº›é™åˆ¶ï¼Ÿ</h3><h4 id="è€ƒå¯ŸåŒ¿åå†…éƒ¨ç±»çš„æ¦‚å¿µå’Œç”¨æ³•ï¼ˆåˆçº§ï¼‰"><a href="#è€ƒå¯ŸåŒ¿åå†…éƒ¨ç±»çš„æ¦‚å¿µå’Œç”¨æ³•ï¼ˆåˆçº§ï¼‰" class="headerlink" title="è€ƒå¯ŸåŒ¿åå†…éƒ¨ç±»çš„æ¦‚å¿µå’Œç”¨æ³•ï¼ˆåˆçº§ï¼‰"></a>è€ƒå¯ŸåŒ¿åå†…éƒ¨ç±»çš„æ¦‚å¿µå’Œç”¨æ³•ï¼ˆåˆçº§ï¼‰</h4><ul><li>åŒ¿åå†…éƒ¨ç±»çš„åå­—ï¼šæ²¡æœ‰äººç±»è®¤çŸ¥æ„ä¹‰ä¸Šçš„åå­—</li><li>åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£</li><li>åŒ…å.OuterClass$1ï¼Œè¡¨ç¤ºå®šä½çš„ç¬¬ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ã€‚å¤–éƒ¨ç±»åŠ $Nï¼ŒNæ˜¯åŒ¿åå†…éƒ¨ç±»çš„é¡ºåºã€‚</li></ul><h4 id="è€ƒå¯Ÿè¯­è¨€è§„èŒƒä»¥åŠè¯­è¨€çš„æ¨ªå‘å¯¹æ¯”ç­‰ï¼ˆä¸­çº§ï¼‰"><a href="#è€ƒå¯Ÿè¯­è¨€è§„èŒƒä»¥åŠè¯­è¨€çš„æ¨ªå‘å¯¹æ¯”ç­‰ï¼ˆä¸­çº§ï¼‰" class="headerlink" title="è€ƒå¯Ÿè¯­è¨€è§„èŒƒä»¥åŠè¯­è¨€çš„æ¨ªå‘å¯¹æ¯”ç­‰ï¼ˆä¸­çº§ï¼‰"></a>è€ƒå¯Ÿè¯­è¨€è§„èŒƒä»¥åŠè¯­è¨€çš„æ¨ªå‘å¯¹æ¯”ç­‰ï¼ˆä¸­çº§ï¼‰</h4><p>åŒ¿åå†…éƒ¨ç±»çš„ç»§æ‰¿ç»“æ„ï¼šJavaä¸­çš„åŒ¿åå†…éƒ¨ç±»ä¸å¯ä»¥ç»§æ‰¿ï¼Œåªæœ‰å†…éƒ¨ç±»æ‰å¯ä»¥æœ‰å®ç°ç»§æ‰¿ã€å®ç°æ¥å£çš„ç‰¹æ€§ã€‚è€ŒKotlinæ˜¯çš„åŒ¿åå†…éƒ¨ç±»æ˜¯æ”¯æŒç»§æ‰¿çš„ï¼Œå¦‚</p><pre><code>val runnableFoo = object: Foo(),Runnable &#123;         override fun run() &#123;                 &#125; &#125;</code></pre><h4 id="ä½œä¸ºè€ƒå¯Ÿå†…å­˜æ³„æ¼çš„åˆ‡å…¥ç‚¹ï¼ˆé«˜çº§ï¼‰"><a href="#ä½œä¸ºè€ƒå¯Ÿå†…å­˜æ³„æ¼çš„åˆ‡å…¥ç‚¹ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="ä½œä¸ºè€ƒå¯Ÿå†…å­˜æ³„æ¼çš„åˆ‡å…¥ç‚¹ï¼ˆé«˜çº§ï¼‰"></a>ä½œä¸ºè€ƒå¯Ÿå†…å­˜æ³„æ¼çš„åˆ‡å…¥ç‚¹ï¼ˆé«˜çº§ï¼‰</h4><p>åŒ¿åå†…éƒ¨ç±»çš„æ„é€ æ–¹æ³•ï¼ˆæ·±å…¥æºç å­—èŠ‚ç æ¢ç´¢è¯­è¨€æœ¬è´¨çš„èƒ½åŠ›ï¼‰ï¼š</p><ul><li>åŒ¿åå†…éƒ¨ç±»ä¼šé»˜è®¤æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li><li>ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ã€‚</li></ul><p>å…¶å‚æ•°åˆ—è¡¨åŒ…æ‹¬</p><ul><li>å¤–éƒ¨å¯¹è±¡ï¼ˆå®šä¹‰åœ¨éé™æ€åŸŸå†…ï¼‰</li><li>çˆ¶ç±»çš„å¤–éƒ¨å¯¹è±¡ï¼ˆçˆ¶ç±»éé™æ€ï¼‰</li><li>çˆ¶ç±»çš„æ„é€ æ–¹æ³•å‚æ•°ï¼ˆçˆ¶ç±»æœ‰æ„é€ æ–¹æ³•ä¸”å‚æ•°åˆ—è¡¨ä¸ä¸ºç©ºï¼‰</li><li>å¤–éƒ¨æ•è·çš„å˜é‡ï¼ˆæ–¹æ³•ä½“å†…æœ‰å¼•ç”¨å¤–éƒ¨finalå˜é‡ï¼‰</li></ul><p>Lambdaè½¬æ¢(SAMç±»å‹ï¼Œä»…æ”¯æŒå•ä¸€æ¥å£ç±»å‹ï¼‰ï¼š</p><p>å¦‚æœCallBackæ˜¯ä¸€ä¸ªinterfaceï¼Œä¸æ˜¯æŠ½è±¡ç±»ï¼Œåˆ™å¯ä»¥è½¬æ¢ä¸ºLambdaè¡¨è¾¾å¼ã€‚</p><pre><code>CallBack callBack = () -&gt; &#123;         ... &#125;;</code></pre><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li>æ²¡æœ‰äººç±»è®¤çŸ¥æ„ä¹‰ä¸Šçš„åå­—ã€‚</li><li>åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£ã€‚</li><li>çˆ¶ç±»æ˜¯éé™æ€çš„ç±»å‹ï¼Œåˆ™éœ€çˆ¶ç±»å¤–éƒ¨å®ä¾‹æ¥åˆå§‹åŒ–ã€‚</li><li>å¦‚æœå®šä¹‰åœ¨éé™æ€ä½œç”¨åŸŸå†…ï¼Œä¼šå¼•ç”¨å¤–éƒ¨ç±»å®ä¾‹ã€‚</li><li>åªèƒ½æ•è·å¤–éƒ¨ä½œç”¨åŸŸå†…çš„finalå˜é‡ã€‚</li><li>åˆ›å»ºæ—¶åªæœ‰å•ä¸€æ–¹æ³•çš„æ¥å£å¯ä»¥ç”¨Lambdaè½¬æ¢ã€‚</li></ul><h4 id="æŠ€å·§ç‚¹æ‹¨"><a href="#æŠ€å·§ç‚¹æ‹¨" class="headerlink" title="æŠ€å·§ç‚¹æ‹¨"></a>æŠ€å·§ç‚¹æ‹¨</h4><p>å…³æ³¨è¯­è¨€ç‰ˆæœ¬çš„å˜åŒ–ï¼š</p><ul><li>ä½“ç°å¯¹æŠ€æœ¯çš„çƒ­æƒ…</li><li>ä½“ç°å¥½å­¦çš„å“è´¨</li><li>æ˜¾å¾—ä¸“ä¸š</li></ul><h3 id="4ã€Javaä¸­å¯¹å¼‚å¸¸æ˜¯å¦‚ä½•è¿›è¡Œåˆ†ç±»çš„ï¼Ÿ"><a href="#4ã€Javaä¸­å¯¹å¼‚å¸¸æ˜¯å¦‚ä½•è¿›è¡Œåˆ†ç±»çš„ï¼Ÿ" class="headerlink" title="4ã€Javaä¸­å¯¹å¼‚å¸¸æ˜¯å¦‚ä½•è¿›è¡Œåˆ†ç±»çš„ï¼Ÿ"></a>4ã€Javaä¸­å¯¹å¼‚å¸¸æ˜¯å¦‚ä½•è¿›è¡Œåˆ†ç±»çš„ï¼Ÿ</h3><h4 id="å¼‚å¸¸æ•´ä½“åˆ†ç±»ï¼š"><a href="#å¼‚å¸¸æ•´ä½“åˆ†ç±»ï¼š" class="headerlink" title="å¼‚å¸¸æ•´ä½“åˆ†ç±»ï¼š"></a>å¼‚å¸¸æ•´ä½“åˆ†ç±»ï¼š</h4><p>Javaå¼‚å¸¸ç»“æ„ä¸­å®šä¹‰æœ‰Throwableç±»ã€‚ Exceptionå’ŒErrorä¸ºå…¶å­ç±»ã€‚</p><p>Erroræ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œæ¯”å¦‚OutOfMemoryErrorã€StackOverflowErrorã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚</p><p>Exceptionæ˜¯ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™ç§å¼‚å¸¸åˆ†ä¸¤å¤§ç±»è¿è¡Œæ—¶å¼‚å¸¸å’Œéè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¨‹åºä¸­åº”å½“å°½å¯èƒ½å»å¤„ç†è¿™äº›å¼‚å¸¸ã€‚</p><p>è¿è¡Œæ—¶å¼‚å¸¸éƒ½æ˜¯RuntimeExceptionç±»åŠå…¶å­ç±»å¼‚å¸¸ï¼Œå¦‚NullPointerExceptionã€IndexOutOfBoundsExceptionç­‰ï¼Œ è¿™äº›å¼‚å¸¸æ˜¯ä¸æ£€æŸ¥å¼‚å¸¸ï¼Œç¨‹åºä¸­å¯ä»¥é€‰æ‹©æ•è·å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ã€‚è¿™äº›å¼‚å¸¸ä¸€èˆ¬æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·çš„ï¼Œ ç¨‹åºåº”è¯¥ä»é€»è¾‘è§’åº¦å°½å¯èƒ½é¿å…è¿™ç±»å¼‚å¸¸çš„å‘ç”Ÿã€‚</p><h4 id="å¼‚å¸¸å¤„ç†çš„ä¸¤ä¸ªåŸºæœ¬åŸåˆ™"><a href="#å¼‚å¸¸å¤„ç†çš„ä¸¤ä¸ªåŸºæœ¬åŸåˆ™" class="headerlink" title="å¼‚å¸¸å¤„ç†çš„ä¸¤ä¸ªåŸºæœ¬åŸåˆ™:"></a>å¼‚å¸¸å¤„ç†çš„ä¸¤ä¸ªåŸºæœ¬åŸåˆ™:</h4><p>1ã€å°½é‡ä¸è¦æ•è·ç±»ä¼¼ Exception è¿™æ ·çš„é€šç”¨å¼‚å¸¸ï¼Œè€Œæ˜¯åº”è¯¥æ•è·ç‰¹å®šå¼‚å¸¸ã€‚</p><p>2ã€ä¸è¦ç”Ÿåå¼‚å¸¸ã€‚</p><h4 id="NoClassDefFoundError-å’Œ-ClassNotFoundException-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#NoClassDefFoundError-å’Œ-ClassNotFoundException-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="NoClassDefFoundError å’Œ ClassNotFoundException æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>NoClassDefFoundError å’Œ ClassNotFoundException æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>ClassNotFoundExceptionçš„äº§ç”ŸåŸå› ä¸»è¦æ˜¯ï¼š<br>Javaæ”¯æŒä½¿ç”¨åå°„æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç±»ï¼Œä¾‹å¦‚ä½¿ç”¨Class.forNameæ–¹æ³•æ¥åŠ¨æ€åœ°åŠ è½½ç±»æ—¶ï¼Œå¯ä»¥å°†ç±»åä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸Šè¿°æ–¹æ³•ä»è€Œå°†æŒ‡å®šç±»åŠ è½½åˆ°JVMå†…å­˜ä¸­ï¼Œå¦‚æœè¿™ä¸ªç±»åœ¨ç±»è·¯å¾„ä¸­æ²¡æœ‰è¢«æ‰¾åˆ°ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚<br>è§£å†³è¯¥é—®é¢˜éœ€è¦ç¡®ä¿æ‰€éœ€çš„ç±»è¿åŒå®ƒä¾èµ–çš„åŒ…å­˜åœ¨äºç±»è·¯å¾„ä¸­ï¼Œå¸¸è§é—®é¢˜åœ¨äºç±»åä¹¦å†™é”™è¯¯ã€‚<br>å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¯¼è‡´ClassNotFoundExceptionçš„åŸå› å°±æ˜¯ï¼šå½“ä¸€ä¸ªç±»å·²ç»æŸä¸ªç±»åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªç±»åŠ è½½å™¨åˆå°è¯•ç€åŠ¨æ€åœ°ä»åŒä¸€ä¸ªåŒ…ä¸­åŠ è½½è¿™ä¸ªç±»ã€‚é€šè¿‡æ§åˆ¶åŠ¨æ€ç±»åŠ è½½è¿‡ç¨‹ï¼Œå¯ä»¥é¿å…ä¸Šè¿°æƒ…å†µå‘ç”Ÿã€‚</p><p>NoClassDefFoundErroräº§ç”Ÿçš„åŸå› åœ¨äºï¼š<br>å¦‚æœJVMæˆ–è€…ClassLoaderå®ä¾‹å°è¯•åŠ è½½ï¼ˆå¯ä»¥é€šè¿‡æ­£å¸¸çš„æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½¿ç”¨newæ¥åˆ›å»ºæ–°çš„å¯¹è±¡ï¼‰ç±»çš„æ—¶å€™å´æ‰¾ä¸åˆ°ç±»çš„å®šä¹‰ã€‚è¦æŸ¥æ‰¾çš„ç±»åœ¨ç¼–è¯‘çš„æ—¶å€™æ˜¯å­˜åœ¨çš„ï¼Œè¿è¡Œçš„æ—¶å€™å´æ‰¾ä¸åˆ°äº†ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šå¯¼è‡´NoClassDefFoundError.<br>é€ æˆè¯¥é—®é¢˜çš„åŸå› å¯èƒ½æ˜¯æ‰“åŒ…è¿‡ç¨‹æ¼æ‰äº†éƒ¨åˆ†ç±»ï¼Œæˆ–è€…jaråŒ…å‡ºç°æŸåæˆ–è€…ç¯¡æ”¹ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯æŸ¥æ‰¾é‚£äº›åœ¨å¼€å‘æœŸé—´å­˜åœ¨äºç±»è·¯å¾„ä¸‹ä½†åœ¨è¿è¡ŒæœŸé—´å´ä¸åœ¨ç±»è·¯å¾„ä¸‹çš„ç±»ã€‚</p><h3 id="5ã€String-ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆä¸å¯å˜çš„ï¼Ÿ"><a href="#5ã€String-ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆä¸å¯å˜çš„ï¼Ÿ" class="headerlink" title="5ã€String ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆä¸å¯å˜çš„ï¼Ÿ"></a>5ã€String ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆä¸å¯å˜çš„ï¼Ÿ</h3><p>Stringæ˜¯ä¸å¯å˜çš„ï¼ˆä¿®æ”¹Stringæ—¶ï¼Œä¸ä¼šåœ¨åŸæœ‰çš„å†…å­˜åœ°å€ä¿®æ”¹ï¼Œè€Œæ˜¯é‡æ–°æŒ‡å‘ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰ï¼ŒStringç”¨finalä¿®é¥°ï¼Œä¸å¯ç»§æ‰¿ï¼ŒStringæœ¬è´¨ä¸Šæ˜¯ä¸ªfinalçš„char[]æ•°ç»„ï¼Œæ‰€ä»¥char[]æ•°ç»„çš„å†…å­˜åœ°å€ä¸ä¼šè¢«ä¿®æ”¹ï¼Œè€Œä¸”String ä¹Ÿæ²¡æœ‰å¯¹å¤–æš´éœ²ä¿®æ”¹char[]æ•°ç»„çš„æ–¹æ³•ã€‚ä¸å¯å˜æ€§å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ä»¥åŠå­—ç¬¦ä¸²ä¸²å¸¸é‡æ± çš„å®ç°ã€‚</p><h3 id="6ã€Javaé‡Œçš„å¹‚ç­‰æ€§äº†è§£å—ï¼Ÿ"><a href="#6ã€Javaé‡Œçš„å¹‚ç­‰æ€§äº†è§£å—ï¼Ÿ" class="headerlink" title="6ã€Javaé‡Œçš„å¹‚ç­‰æ€§äº†è§£å—ï¼Ÿ"></a>6ã€Javaé‡Œçš„å¹‚ç­‰æ€§äº†è§£å—ï¼Ÿ</h3><p>å¹‚ç­‰æ€§åŸæœ¬æ˜¯æ•°å­¦ä¸Šçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå³ï¼šf(x) = f(f(x))ï¼Œå¯¹åŒä¸€ä¸ªç³»ç»Ÿï¼Œä½¿ç”¨åŒæ ·çš„æ¡ä»¶ï¼Œä¸€æ¬¡è¯·æ±‚å’Œé‡å¤çš„å¤šæ¬¡è¯·æ±‚å¯¹ç³»ç»Ÿèµ„æºçš„å½±å“æ˜¯ä¸€è‡´çš„ã€‚</p><p>å¹‚ç­‰æ€§æœ€ä¸ºå¸¸è§çš„åº”ç”¨å°±æ˜¯ç”µå•†çš„å®¢æˆ·ä»˜æ¬¾ï¼Œè¯•æƒ³ä¸€ä¸‹å¦‚æœä½ åœ¨ä»˜æ¬¾çš„æ—¶å€™å› ä¸ºç½‘ç»œç­‰å„ç§é—®é¢˜å¤±è´¥äº†ï¼Œç„¶åå»é‡å¤çš„ä»˜äº†ä¸€æ¬¡ï¼Œæ˜¯ä¸€ç§å¤šä¹ˆç³Ÿç³•çš„ä½“éªŒã€‚å¹‚ç­‰æ€§å°±æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p><p>å®ç°å¹‚ç­‰æ€§å¯ä»¥ä½¿ç”¨Tokenæœºåˆ¶ã€‚</p><p>æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºæ¯ä¸€æ¬¡æ“ä½œç”Ÿæˆä¸€ä¸ªå”¯ä¸€æ€§çš„å‡­è¯ï¼Œä¹Ÿå°±æ˜¯tokenã€‚ä¸€ä¸ªtokenåœ¨æ“ä½œçš„æ¯ä¸€ä¸ªé˜¶æ®µåªæœ‰ä¸€æ¬¡æ‰§è¡Œæƒï¼Œä¸€æ—¦æ‰§è¡ŒæˆåŠŸåˆ™ä¿å­˜æ‰§è¡Œç»“æœã€‚å¯¹é‡å¤çš„è¯·æ±‚ï¼Œè¿”å›åŒä¸€ä¸ªç»“æœã€‚</p><p>ä¾‹å¦‚ï¼šç”µå•†å¹³å°ä¸Šçš„è®¢å•idå°±æ˜¯æœ€é€‚åˆçš„tokenã€‚å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¼šç»å†å¤šä¸ªç¯èŠ‚ï¼Œæ¯”å¦‚ç”Ÿæˆè®¢å•ï¼Œå‡åº“å­˜ï¼Œå‡ä¼˜æƒ åˆ¸ç­‰ç­‰ã€‚æ¯ä¸€ä¸ªç¯èŠ‚æ‰§è¡Œæ—¶éƒ½å…ˆæ£€æµ‹ä¸€ä¸‹è¯¥è®¢å•idæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡è¿™ä¸€æ­¥éª¤ï¼Œå¯¹æœªæ‰§è¡Œçš„è¯·æ±‚ï¼Œæ‰§è¡Œæ“ä½œå¹¶ç¼“å­˜ç»“æœï¼Œè€Œå¯¹å·²ç»æ‰§è¡Œè¿‡çš„idï¼Œåˆ™ç›´æ¥è¿”å›ä¹‹å‰çš„æ‰§è¡Œç»“æœï¼Œä¸åšä»»ä½•æ“<br>ä½œã€‚è¿™æ ·å¯ä»¥åœ¨æœ€å¤§ç¨‹åº¦ä¸Šé¿å…æ“ä½œçš„é‡å¤æ‰§è¡Œé—®é¢˜ï¼Œç¼“å­˜èµ·æ¥çš„æ‰§è¡Œç»“æœä¹Ÿèƒ½ç”¨äºäº‹åŠ¡çš„æ§åˆ¶ç­‰ã€‚</p><h3 id="7ã€ä¸ºä»€ä¹ˆJavaé‡Œçš„åŒ¿åå†…éƒ¨ç±»åªèƒ½è®¿é—®finalä¿®é¥°çš„å¤–éƒ¨å˜é‡ï¼Ÿ"><a href="#7ã€ä¸ºä»€ä¹ˆJavaé‡Œçš„åŒ¿åå†…éƒ¨ç±»åªèƒ½è®¿é—®finalä¿®é¥°çš„å¤–éƒ¨å˜é‡ï¼Ÿ" class="headerlink" title="7ã€ä¸ºä»€ä¹ˆJavaé‡Œçš„åŒ¿åå†…éƒ¨ç±»åªèƒ½è®¿é—®finalä¿®é¥°çš„å¤–éƒ¨å˜é‡ï¼Ÿ"></a>7ã€ä¸ºä»€ä¹ˆJavaé‡Œçš„åŒ¿åå†…éƒ¨ç±»åªèƒ½è®¿é—®finalä¿®é¥°çš„å¤–éƒ¨å˜é‡ï¼Ÿ</h3><p>åŒ¿åå†…éƒ¨ç±»ç”¨æ³•ï¼š</p><pre><code>public class TryUsingAnonymousClass &#123;    public void useMyInterface() &#123;        final Integer number = 123;        System.out.println(number);        MyInterface myInterface = new MyInterface() &#123;            @Override            public void doSomething() &#123;                System.out.println(number);            &#125;        &#125;;        myInterface.doSomething();        System.out.println(number);    &#125;&#125;</code></pre><p>ç¼–è¯‘åçš„ç»“æœ</p><pre><code>class TryUsingAnonymousClass$1        implements MyInterface &#123;    private final TryUsingAnonymousClass this$0;    private final Integer paramInteger;    TryUsingAnonymousClass$1(TryUsingAnonymousClass this$0, Integer paramInteger) &#123;        this.this$0 = this$0;        this.paramInteger = paramInteger;    &#125;    public void doSomething() &#123;        System.out.println(this.paramInteger);    &#125;&#125;</code></pre><p>å› ä¸ºåŒ¿åå†…éƒ¨ç±»æœ€ç»ˆä¼šç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œè€Œè¢«è¯¥ç±»ä½¿ç”¨çš„å˜é‡ä¼šä»¥æ„é€ å‡½æ•°å‚æ•°çš„å½¢å¼ä¼ é€’ç»™è¯¥ç±»ï¼Œä¾‹å¦‚ï¼šInteger paramIntegerï¼Œå¦‚æœå˜é‡ä¸å®šä¹‰æˆfinalçš„ï¼ŒparamIntegeråœ¨åŒ¿åå†…éƒ¨ç±»è¢«å¯ä»¥è¢«ä¿®æ”¹ï¼Œè¿›è€Œé€ æˆå’Œå¤–éƒ¨çš„paramIntegerä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¸ºäº†é¿å…è¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå› æ¬¡Javaè§„å®šåŒ¿åå†…éƒ¨ç±»åªèƒ½è®¿é—®finalä¿®é¥°çš„å¤–éƒ¨å˜é‡ã€‚</p><h3 id="8ã€è®²ä¸€ä¸‹Javaçš„ç¼–ç æ–¹å¼ï¼Ÿ"><a href="#8ã€è®²ä¸€ä¸‹Javaçš„ç¼–ç æ–¹å¼ï¼Ÿ" class="headerlink" title="8ã€è®²ä¸€ä¸‹Javaçš„ç¼–ç æ–¹å¼ï¼Ÿ"></a>8ã€è®²ä¸€ä¸‹Javaçš„ç¼–ç æ–¹å¼ï¼Ÿ</h3><p>ä¸ºä»€ä¹ˆéœ€è¦ç¼–ç </p><p>è®¡ç®—æœºå­˜å‚¨ä¿¡æ¯çš„æœ€å°å•å…ƒæ˜¯ä¸€ä¸ªå­—èŠ‚å³8bitï¼Œæ‰€ä»¥èƒ½ç¤ºçš„èŒƒå›´æ˜¯0~255ï¼Œè¿™ä¸ªèŒƒå›´æ— æ³•ä¿å­˜æ‰€æœ‰çš„å­—ç¬¦ï¼Œæ‰€ä»¥è¦ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„charæ¥è¡¨ç¤ºè¿™äº›å­—ç¬¦ï¼Œä»charåˆ°byteéœ€è¦ç¼–ç ã€‚</p><p>å¸¸è§çš„ç¼–ç æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><p>ASCIIï¼šæ€»å…±æœ‰ 128 ä¸ªï¼Œç”¨ä¸€ä¸ªå­—èŠ‚çš„ä½ 7 ä½è¡¨ç¤ºï¼Œ031 æ˜¯æ§åˆ¶å­—ç¬¦å¦‚æ¢è¡Œå›è½¦åˆ é™¤ç­‰ï¼›32126 æ˜¯æ‰“å°å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡é”®ç›˜è¾“å…¥å¹¶ä¸”èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>GBKï¼šç èŒƒå›´æ˜¯ 8140~FEFEï¼ˆå»æ‰ XX7Fï¼‰æ€»å…±æœ‰ 23940 ä¸ªç ä½ï¼Œå®ƒèƒ½è¡¨ç¤º 21003 ä¸ªæ±‰å­—ï¼Œå®ƒçš„ç¼–ç æ˜¯å’Œ GB2312 å…¼å®¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨ GB2312 ç¼–ç çš„æ±‰å­—å¯ä»¥ç”¨ GBK æ¥è§£ç ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰ä¹±ç ã€‚</p><p>UTF-16ï¼šUTF-16 å…·ä½“å®šä¹‰äº† Unicode å­—ç¬¦åœ¨è®¡ç®—æœºä¸­å­˜å–æ–¹æ³•ã€‚UTF-16 ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤º Unicode è½¬åŒ–æ ¼å¼ï¼Œè¿™ä¸ªæ˜¯å®šé•¿çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä¸è®ºä»€ä¹ˆå­—ç¬¦éƒ½å¯ä»¥ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¸¤ä¸ªå­—èŠ‚æ˜¯ 16 ä¸ª bitï¼Œæ‰€ä»¥å« UTF-16ã€‚UTF-16 è¡¨ç¤ºå­—ç¬¦éå¸¸æ–¹ä¾¿ï¼Œæ¯ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªåœ¨å­—ç¬¦ä¸²æ“ä½œæ—¶å°±å¤§å¤§ç®€åŒ–äº†æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯ Java ä»¥ UTF-16 ä½œä¸ºå†…å­˜çš„å­—ç¬¦å­˜å‚¨æ ¼å¼çš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› ã€‚</p><p>UTF-8ï¼šç»Ÿä¸€é‡‡ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè™½ç„¶åœ¨è¡¨ç¤ºä¸Šéå¸¸ç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å­—ç¬¦ç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºçš„ç°åœ¨è¦ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå­˜å‚¨ç©ºé—´æ”¾å¤§äº†ä¸€å€ï¼Œåœ¨ç°åœ¨çš„ç½‘ç»œå¸¦å®½è¿˜éå¸¸æœ‰é™çš„ä»Šå¤©ï¼Œè¿™æ ·ä¼šå¢å¤§ç½‘ç»œä¼ è¾“çš„æµé‡ï¼Œè€Œä¸”ä¹Ÿæ²¡å¿…è¦ã€‚è€Œ UTF-8 é‡‡ç”¨äº†ä¸€ç§å˜é•¿æŠ€æœ¯ï¼Œæ¯ä¸ªç¼–ç åŒºåŸŸæœ‰ä¸åŒçš„å­—ç é•¿åº¦ã€‚ä¸åŒç±»å‹çš„å­—ç¬¦å¯ä»¥æ˜¯ç”± 1~6 ä¸ªå­—èŠ‚ç»„æˆã€‚</p><p>Javaä¸­éœ€è¦ç¼–ç çš„åœ°æ–¹ä¸€èˆ¬éƒ½åœ¨å­—ç¬¦åˆ°å­—èŠ‚çš„è½¬æ¢ä¸Šï¼Œè¿™ä¸ªä¸€èˆ¬åŒ…æ‹¬ç£ç›˜IOå’Œç½‘ç»œIOã€‚</p><p>Reader ç±»æ˜¯ Java çš„ I/O ä¸­è¯»å­—ç¬¦çš„çˆ¶ç±»ï¼Œè€ŒInputStream ç±»æ˜¯è¯»å­—èŠ‚çš„çˆ¶ç±»ï¼ŒInputStreamReaderç±»å°±æ˜¯å…³è”å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢ï¼Œå®ƒè´Ÿè´£åœ¨ I/O è¿‡ç¨‹ä¸­å¤„ç†è¯»å–å­—èŠ‚åˆ°å­—ç¬¦çš„è½¬æ¢ï¼Œè€Œå…·ä½“å­—èŠ‚åˆ°å­—ç¬¦è§£ç å®ç°ç”± StreamDecoder å»å®ç°ï¼Œåœ¨ StreamDecoder è§£ç è¿‡ç¨‹ä¸­å¿…é¡»ç”±ç”¨æˆ·æŒ‡å®š Charset ç¼–ç æ ¼å¼ã€‚</p><h3 id="9ã€Stringï¼ŒStringBufferï¼ŒStringBuilderæœ‰å“ªäº›ä¸åŒï¼Ÿ"><a href="#9ã€Stringï¼ŒStringBufferï¼ŒStringBuilderæœ‰å“ªäº›ä¸åŒï¼Ÿ" class="headerlink" title="9ã€Stringï¼ŒStringBufferï¼ŒStringBuilderæœ‰å“ªäº›ä¸åŒï¼Ÿ"></a>9ã€Stringï¼ŒStringBufferï¼ŒStringBuilderæœ‰å“ªäº›ä¸åŒï¼Ÿ</h3><p>ä¸‰è€…åœ¨æ‰§è¡Œé€Ÿåº¦æ–¹é¢çš„æ¯”è¾ƒï¼šStringBuilder &gt;Â  StringBufferÂ  &gt;Â  String</p><p>Stringæ¯æ¬¡å˜åŒ–ä¸€ä¸ªå€¼å°±ä¼šå¼€è¾Ÿä¸€ä¸ªæ–°çš„å†…å­˜ç©ºé—´</p><p>StringBuilderï¼šçº¿ç¨‹éå®‰å…¨çš„</p><p>StringBufferï¼šçº¿ç¨‹å®‰å…¨çš„</p><p>å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“ï¼šÂ </p><p>1.å¦‚æœè¦æ“ä½œå°‘é‡çš„æ•°æ®ç”¨ Stringã€‚</p><p>2.å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®ç”¨ StringBuilderã€‚</p><p>3.å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®ç”¨ StringBufferã€‚</p><p>String æ˜¯ Java è¯­è¨€éå¸¸åŸºç¡€å’Œé‡è¦çš„ç±»ï¼Œæä¾›äº†æ„é€ å’Œç®¡ç†å­—ç¬¦ä¸²çš„å„ç§åŸºæœ¬é€»è¾‘ã€‚å®ƒæ˜¯å…¸å‹çš„ Immutable ç±»ï¼Œè¢«å£°æ˜æˆä¸º final classï¼Œæ‰€æœ‰å±æ€§ä¹Ÿéƒ½æ˜¯ final çš„ã€‚ä¹Ÿç”±äºå®ƒçš„ä¸å¯å˜æ€§ï¼Œç±»ä¼¼æ‹¼æ¥ã€è£å‰ªå­—ç¬¦ä¸²ç­‰åŠ¨ä½œï¼Œéƒ½ä¼šäº§ç”Ÿæ–°çš„ String å¯¹è±¡ã€‚ç”±äºå­—ç¬¦ä¸²æ“ä½œçš„æ™®éæ€§ï¼Œæ‰€ä»¥ç›¸å…³æ“ä½œçš„æ•ˆç‡å¾€å¾€å¯¹åº”ç”¨æ€§èƒ½æœ‰æ˜æ˜¾å½±å“ã€‚</p><p>StringBuffer æ˜¯ä¸ºè§£å†³ä¸Šé¢æåˆ°æ‹¼æ¥äº§ç”Ÿå¤ªå¤šä¸­é—´å¯¹è±¡çš„é—®é¢˜è€Œæä¾›çš„ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ append æˆ–è€… add æ–¹æ³•ï¼ŒæŠŠå­—ç¬¦ä¸²æ·»åŠ åˆ°å·²æœ‰åºåˆ—çš„æœ«å°¾æˆ–è€…æŒ‡å®šä½ç½®ã€‚StringBuffer æœ¬è´¨æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å¯ä¿®æ”¹å­—ç¬¦åºåˆ—ï¼Œå®ƒä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿéšä¹‹å¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼Œæ‰€ä»¥é™¤éæœ‰çº¿ç¨‹å®‰å…¨çš„éœ€è¦ï¼Œä¸ç„¶è¿˜æ˜¯æ¨èä½¿ç”¨å®ƒçš„åç»§è€…ï¼Œä¹Ÿå°±æ˜¯ StringBuilderã€‚</p><p>StringBuilder æ˜¯ Java 1.5 ä¸­æ–°å¢çš„ï¼Œåœ¨èƒ½åŠ›ä¸Šå’Œ StringBuffer æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œä½†æ˜¯å®ƒå»æ‰äº†çº¿ç¨‹å®‰å…¨çš„éƒ¨åˆ†ï¼Œæœ‰æ•ˆå‡å°äº†å¼€é”€ï¼Œæ˜¯ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„é¦–é€‰ã€‚</p><h3 id="10ã€ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿå†…éƒ¨ç±»çš„ä½œç”¨ã€‚"><a href="#10ã€ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿå†…éƒ¨ç±»çš„ä½œç”¨ã€‚" class="headerlink" title="10ã€ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿå†…éƒ¨ç±»çš„ä½œç”¨ã€‚"></a>10ã€ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿå†…éƒ¨ç±»çš„ä½œç”¨ã€‚</h3><p>å†…éƒ¨ç±»å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸å…¶ä»–å¤–å›´å¯¹è±¡çš„ä¿¡æ¯ç›¸äº’ç‹¬ç«‹ã€‚</p><p>åœ¨å•ä¸ªå¤–å›´ç±»ä¸­ï¼Œå¯ä»¥è®©å¤šä¸ªå†…éƒ¨ç±»ä»¥ä¸åŒçš„æ–¹å¼å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…ç»§æ‰¿åŒä¸€ä¸ªç±»ã€‚</p><p>åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡å¹¶ä¸ä¾èµ–äºå¤–å›´ç±»å¯¹è±¡çš„åˆ›å»ºã€‚</p><p>å†…éƒ¨ç±»å¹¶æ²¡æœ‰ä»¤äººè¿·æƒ‘çš„â€œis-aâ€å…³ç³»ï¼Œä»–å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ã€‚</p><p>å†…éƒ¨ç±»æä¾›äº†æ›´å¥½çš„å°è£…ï¼Œé™¤äº†è¯¥å¤–å›´ç±»ï¼Œå…¶ä»–ç±»éƒ½ä¸èƒ½è®¿é—®ã€‚ã€‚</p><h3 id="11ã€æŠ½è±¡ç±»å’Œæ¥å£åŒºåˆ«ï¼Ÿ"><a href="#11ã€æŠ½è±¡ç±»å’Œæ¥å£åŒºåˆ«ï¼Ÿ" class="headerlink" title="11ã€æŠ½è±¡ç±»å’Œæ¥å£åŒºåˆ«ï¼Ÿ"></a>11ã€æŠ½è±¡ç±»å’Œæ¥å£åŒºåˆ«ï¼Ÿ</h3><p>å…±åŒç‚¹</p><ul><li>æ˜¯ä¸Šå±‚çš„æŠ½è±¡å±‚ã€‚</li><li>éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚</li><li>éƒ½èƒ½åŒ…å«æŠ½è±¡çš„æ–¹æ³•ï¼Œè¿™äº›æŠ½è±¡çš„æ–¹æ³•ç”¨äºæè¿°ç±»å…·å¤‡çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸æä¾›å…·ä½“çš„å®ç°ã€‚</li></ul><p>åŒºåˆ«ï¼š</p><ul><li>1ã€åœ¨æŠ½è±¡ç±»ä¸­å¯ä»¥å†™éæŠ½è±¡çš„æ–¹æ³•ï¼Œä»è€Œé¿å…åœ¨å­ç±»ä¸­é‡å¤ä¹¦å†™ä»–ä»¬ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œè¿™æ˜¯æŠ½è±¡ç±»çš„ä¼˜åŠ¿ï¼Œæ¥å£ä¸­åªèƒ½æœ‰æŠ½è±¡çš„æ–¹æ³•ã€‚</li><li>2ã€å¤šç»§æ‰¿ï¼šä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼Œè¿™ä¸ªçˆ¶ç±»å¯ä»¥æ˜¯å…·ä½“çš„ç±»ä¹Ÿå¯æ˜¯æŠ½è±¡ç±»ï¼Œä½†æ˜¯ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</li><li>3ã€æŠ½è±¡ç±»å¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œæ¥å£æ ¹æœ¬ä¸å­˜åœ¨æ–¹æ³•çš„å®ç°ã€‚</li><li>4ã€å­ç±»ä½¿ç”¨extendså…³é”®å­—æ¥ç»§æ‰¿æŠ½è±¡ç±»ã€‚å¦‚æœå­ç±»ä¸æ˜¯æŠ½è±¡ç±»çš„è¯ï¼Œå®ƒéœ€è¦æä¾›æŠ½è±¡ç±»ä¸­æ‰€æœ‰å£°æ˜æ–¹æ³•çš„å®ç°ã€‚å­ç±»ä½¿ç”¨å…³é”®å­—implementsæ¥å®ç°æ¥å£ã€‚å®ƒéœ€è¦æä¾›æ¥å£ä¸­æ‰€æœ‰å£°æ˜æ–¹æ³•çš„å®ç°ã€‚</li><li>5ã€æ„é€ å™¨ï¼šæŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨ï¼Œæ¥å£ä¸èƒ½æœ‰æ„é€ å™¨ã€‚</li><li>6ã€å’Œæ™®é€šJavaç±»çš„åŒºåˆ«ï¼šé™¤äº†ä½ ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»ä¹‹å¤–ï¼ŒæŠ½è±¡ç±»å’Œæ™®é€šJavaç±»æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œæ¥å£æ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹ã€‚</li><li>7ã€è®¿é—®ä¿®é¥°ç¬¦:æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰publicã€protectedå’Œdefaultä¿®é¥°ç¬¦ï¼Œæ¥å£æ–¹æ³•é»˜è®¤ä¿®é¥°ç¬¦æ˜¯publicã€‚ä½ ä¸å¯ä»¥ä½¿ç”¨å…¶å®ƒä¿®é¥°ç¬¦ã€‚</li><li>8ã€mainæ–¹æ³•:æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰mainæ–¹æ³•å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿è¡Œå®ƒæ¥å£æ²¡æœ‰mainæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½è¿è¡Œå®ƒã€‚</li><li>9ã€é€Ÿåº¦:æŠ½è±¡ç±»æ¯”æ¥å£é€Ÿåº¦è¦å¿«ï¼Œæ¥å£æ˜¯ç¨å¾®æœ‰ç‚¹æ…¢çš„ï¼Œå› ä¸ºå®ƒéœ€è¦æ—¶é—´å»å¯»æ‰¾åœ¨ç±»ä¸­å®ç°çš„æ–¹æ³•ã€‚</li><li>10ã€æ·»åŠ æ–°æ–¹æ³•:å¦‚æœä½ å¾€æŠ½è±¡ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç»™å®ƒæä¾›é»˜è®¤çš„å®ç°ã€‚å› æ­¤ä½ ä¸éœ€è¦æ”¹å˜ä½ ç°åœ¨çš„ä»£ç ã€‚å¦‚æœä½ å¾€æ¥å£ä¸­æ·»åŠ æ–¹æ³•ï¼Œé‚£ä¹ˆä½ å¿…é¡»æ”¹å˜å®ç°è¯¥æ¥å£çš„ç±»ã€‚</li></ul><h3 id="12ã€æ¥å£çš„æ„ä¹‰ï¼Ÿ"><a href="#12ã€æ¥å£çš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="12ã€æ¥å£çš„æ„ä¹‰ï¼Ÿ"></a>12ã€æ¥å£çš„æ„ä¹‰ï¼Ÿ</h3><p>è§„èŒƒã€æ‰©å±•ã€å›è°ƒã€‚</p><h3 id="13ã€çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ"><a href="#13ã€çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ" class="headerlink" title="13ã€çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ"></a>13ã€çˆ¶ç±»çš„é™æ€æ–¹æ³•èƒ½å¦è¢«å­ç±»é‡å†™ï¼Ÿ</h3><p>ä¸èƒ½ã€‚å­ç±»ç»§æ‰¿çˆ¶ç±»åï¼Œç”¨ç›¸åŒçš„é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•ï¼Œè¿™æ—¶éé™æ€æ–¹æ³•è¦†ç›–çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼ˆå³æ–¹æ³•é‡å†™ï¼‰ï¼Œçˆ¶ç±»çš„è¯¥é™æ€æ–¹æ³•è¢«éšè—ï¼ˆå¦‚æœå¯¹è±¡æ˜¯çˆ¶ç±»åˆ™è°ƒç”¨è¯¥éšè—çš„æ–¹æ³•ï¼‰ï¼Œå¦å¤–å­ç±»å¯ç»§æ‰¿çˆ¶ç±»çš„é™æ€ä¸éé™æ€æ–¹æ³•ï¼Œè‡³äºæ–¹æ³•é‡è½½æˆ‘è§‰å¾—å®ƒå…¶ä¸­ä¸€è¦ç´ å°±æ˜¯åœ¨åŒä¸€ç±»ä¸­ï¼Œä¸èƒ½è¯´çˆ¶ç±»ä¸­çš„ä»€ä¹ˆæ–¹æ³•ä¸å­ç±»é‡Œçš„ä»€ä¹ˆæ–¹æ³•æ˜¯æ–¹æ³•é‡è½½çš„ä½“ç°ã€‚</p><h3 id="14ã€æŠ½è±¡ç±»çš„æ„ä¹‰"><a href="#14ã€æŠ½è±¡ç±»çš„æ„ä¹‰" class="headerlink" title="14ã€æŠ½è±¡ç±»çš„æ„ä¹‰?"></a>14ã€æŠ½è±¡ç±»çš„æ„ä¹‰?</h3><p>ä¸ºå…¶å­ç±»æä¾›ä¸€ä¸ªå…¬å…±çš„ç±»å‹ï¼Œå°è£…å­ç±»ä¸­çš„é‡å¤å†…å®¹ï¼Œå®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»è™½ç„¶æœ‰ä¸åŒçš„å®ç° ä½†æ˜¯å®šä¹‰æ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="15ã€é™æ€å†…éƒ¨ç±»ã€éé™æ€å†…éƒ¨ç±»çš„ç†è§£ï¼Ÿ"><a href="#15ã€é™æ€å†…éƒ¨ç±»ã€éé™æ€å†…éƒ¨ç±»çš„ç†è§£ï¼Ÿ" class="headerlink" title="15ã€é™æ€å†…éƒ¨ç±»ã€éé™æ€å†…éƒ¨ç±»çš„ç†è§£ï¼Ÿ"></a>15ã€é™æ€å†…éƒ¨ç±»ã€éé™æ€å†…éƒ¨ç±»çš„ç†è§£ï¼Ÿ</h3><p>é™æ€å†…éƒ¨ç±»ï¼šåªæ˜¯ä¸ºäº†é™ä½åŒ…çš„æ·±åº¦ï¼Œæ–¹ä¾¿ç±»çš„ä½¿ç”¨ï¼Œé™æ€å†…éƒ¨ç±»é€‚ç”¨äºåŒ…å«åœ¨ç±»å½“ä¸­ï¼Œä½†åˆä¸ä¾èµ–ä¸å¤–åœ¨çš„ç±»ï¼Œä¸ç”¨ä½¿ç”¨å¤–åœ¨ç±»çš„éé™æ€å±æ€§å’Œæ–¹æ³•ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ç±»ç»“æ„è€Œå®šä¹‰ã€‚åœ¨åˆ›å»ºé™æ€å†…éƒ¨ç±»çš„æ—¶å€™ï¼Œä¸éœ€è¦å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>éé™æ€å†…éƒ¨ç±»ï¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨å¤–éƒ¨ç±»çš„æ‰€æœ‰å˜é‡å’Œæ–¹æ³•ã€‚</p><h3 id="16ã€ä¸ºä»€ä¹ˆå¤å†™equalsæ–¹æ³•çš„åŒæ—¶éœ€è¦å¤å†™hashcodeæ–¹æ³•ï¼Œå‰è€…ç›¸åŒåè€…æ˜¯å¦ç›¸åŒï¼Œåè¿‡æ¥å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#16ã€ä¸ºä»€ä¹ˆå¤å†™equalsæ–¹æ³•çš„åŒæ—¶éœ€è¦å¤å†™hashcodeæ–¹æ³•ï¼Œå‰è€…ç›¸åŒåè€…æ˜¯å¦ç›¸åŒï¼Œåè¿‡æ¥å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="16ã€ä¸ºä»€ä¹ˆå¤å†™equalsæ–¹æ³•çš„åŒæ—¶éœ€è¦å¤å†™hashcodeæ–¹æ³•ï¼Œå‰è€…ç›¸åŒåè€…æ˜¯å¦ç›¸åŒï¼Œåè¿‡æ¥å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>16ã€ä¸ºä»€ä¹ˆå¤å†™equalsæ–¹æ³•çš„åŒæ—¶éœ€è¦å¤å†™hashcodeæ–¹æ³•ï¼Œå‰è€…ç›¸åŒåè€…æ˜¯å¦ç›¸åŒï¼Œåè¿‡æ¥å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3><p>è¦è€ƒè™‘åˆ°ç±»ä¼¼HashMapã€HashTableã€HashSetçš„è¿™ç§æ•£åˆ—çš„æ•°æ®ç±»å‹çš„è¿ç”¨ï¼Œå½“æˆ‘ä»¬é‡å†™equalsæ—¶ï¼Œæ˜¯ä¸ºäº†ç”¨è‡ªèº«çš„æ–¹å¼å»åˆ¤æ–­ä¸¤ä¸ªè‡ªå®šä¹‰å¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œç„¶è€Œå¦‚æœæ­¤æ—¶åˆšå¥½éœ€è¦æˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡å»å……å½“hashmapçš„é”®å€¼ä½¿ç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°æˆ‘ä»¬è®¤ä¸ºçš„åŒä¸€å¯¹è±¡ï¼Œå´å› ä¸ºhashå€¼ä¸åŒè€Œå¯¼è‡´hashmapä¸­å­˜äº†ä¸¤ä¸ªå¯¹è±¡ï¼Œä»è€Œæ‰éœ€è¦è¿›è¡Œhashcodeæ–¹æ³•çš„è¦†ç›–ã€‚</p><h3 id="17ã€equals-å’Œ-hashcode-çš„å…³ç³»ï¼Ÿ"><a href="#17ã€equals-å’Œ-hashcode-çš„å…³ç³»ï¼Ÿ" class="headerlink" title="17ã€equals å’Œ hashcode çš„å…³ç³»ï¼Ÿ"></a>17ã€equals å’Œ hashcode çš„å…³ç³»ï¼Ÿ</h3><p>hashcodeå’Œequalsçš„çº¦å®šå…³ç³»å¦‚ä¸‹ï¼š</p><ul><li><p>1ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œé‚£ä¹ˆä»–ä»¬ä¸€å®šæœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ï¼ˆhashcodeï¼‰ã€‚</p></li><li><p>2ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡æœ‰å¯èƒ½ç›¸ç­‰ä¹Ÿæœ‰å¯èƒ½ä¸ç›¸ç­‰ã€‚ï¼ˆéœ€è¦å†é€šè¿‡equalsæ¥åˆ¤æ–­ï¼‰</p></li></ul><h3 id="18ã€javaä¸ºä»€ä¹ˆè·¨å¹³å°ï¼Ÿ"><a href="#18ã€javaä¸ºä»€ä¹ˆè·¨å¹³å°ï¼Ÿ" class="headerlink" title="18ã€javaä¸ºä»€ä¹ˆè·¨å¹³å°ï¼Ÿ"></a>18ã€javaä¸ºä»€ä¹ˆè·¨å¹³å°ï¼Ÿ</h3><p>å› ä¸ºJavaç¨‹åºç¼–è¯‘ä¹‹åçš„ä»£ç ä¸æ˜¯èƒ½è¢«ç¡¬ä»¶ç³»ç»Ÿç›´æ¥è¿è¡Œçš„ä»£ç ï¼Œè€Œæ˜¯ä¸€ç§â€œä¸­é—´ç â€â€”â€”å­—èŠ‚ç ã€‚ç„¶åä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šå®‰è£…æœ‰ä¸åŒçš„Javaè™šæ‹Ÿæœº(JVM)ï¼Œç”±JVMæ¥æŠŠå­—èŠ‚ç å†â€œç¿»è¯‘â€æˆæ‰€å¯¹åº”çš„ç¡¬ä»¶å¹³å°èƒ½å¤Ÿæ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤å¯¹äºJavaç¼–ç¨‹è€…æ¥è¯´ï¼Œä¸éœ€è¦è€ƒè™‘ç¡¬ä»¶å¹³å°æ˜¯ä»€ä¹ˆã€‚æ‰€ä»¥Javaå¯ä»¥è·¨å¹³å°ã€‚</p><h3 id="19ã€æµ®ç‚¹æ•°çš„ç²¾å‡†è®¡ç®—"><a href="#19ã€æµ®ç‚¹æ•°çš„ç²¾å‡†è®¡ç®—" class="headerlink" title="19ã€æµ®ç‚¹æ•°çš„ç²¾å‡†è®¡ç®—"></a>19ã€æµ®ç‚¹æ•°çš„ç²¾å‡†è®¡ç®—</h3><p>BigDecimalç±»è¿›è¡Œå•†ä¸šè®¡ç®—ï¼ŒFloatå’ŒDoubleåªèƒ½ç”¨æ¥åšç§‘å­¦è®¡ç®—æˆ–è€…æ˜¯å·¥ç¨‹è®¡ç®—ã€‚</p><h3 id="20ã€finalï¼Œfinallyï¼Œfinalizeçš„åŒºåˆ«ï¼Ÿ"><a href="#20ã€finalï¼Œfinallyï¼Œfinalizeçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="20ã€finalï¼Œfinallyï¼Œfinalizeçš„åŒºåˆ«ï¼Ÿ"></a>20ã€finalï¼Œfinallyï¼Œfinalizeçš„åŒºåˆ«ï¼Ÿ</h3><p>final å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»ã€æ–¹æ³•ã€å˜é‡ï¼Œåˆ†åˆ«æœ‰ä¸åŒçš„æ„ä¹‰ï¼Œfinal ä¿®é¥°çš„ class ä»£è¡¨ä¸å¯ä»¥ç»§æ‰¿æ‰©å±•ï¼Œfinal çš„å˜é‡æ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ï¼Œè€Œ final çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸å¯ä»¥é‡å†™çš„ï¼ˆoverrideï¼‰ã€‚</p><p>finally åˆ™æ˜¯ Java ä¿è¯é‡ç‚¹ä»£ç ä¸€å®šè¦è¢«æ‰§è¡Œçš„ä¸€ç§æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ try-finally æˆ–è€… try-catch-finally æ¥è¿›è¡Œç±»ä¼¼å…³é—­ JDBC è¿æ¥ã€ä¿è¯ unlock é”ç­‰åŠ¨ä½œã€‚</p><p>finalize æ˜¯åŸºç¡€ç±» java.lang.Object çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„è®¾è®¡ç›®çš„æ˜¯ä¿è¯å¯¹è±¡åœ¨è¢«åƒåœ¾æ”¶é›†å‰å®Œæˆç‰¹å®šèµ„æºçš„å›æ”¶ã€‚finalize æœºåˆ¶ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ JDK 9 å¼€å§‹è¢«æ ‡è®°ä¸º deprecatedã€‚Java å¹³å°ç›®å‰åœ¨é€æ­¥ä½¿ç”¨ java.lang.ref.Cleaner æ¥æ›¿æ¢æ‰åŸæœ‰çš„ finalize å®ç°ã€‚Cleaner çš„å®ç°åˆ©ç”¨äº†å¹»è±¡å¼•ç”¨ï¼ˆPhantomReferenceï¼‰ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„æ‰€è°“ post-mortem æ¸…ç†æœºåˆ¶ã€‚åˆ©ç”¨å¹»è±¡å¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯å¯¹è±¡è¢«å½»åº•é”€æ¯å‰åšä¸€äº›ç±»ä¼¼èµ„æºå›æ”¶çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ“ä½œç³»ç»Ÿæœ‰é™çš„èµ„æºï¼‰ï¼Œå®ƒæ¯” finalize æ›´åŠ è½»é‡ã€æ›´åŠ å¯é ã€‚</p><h3 id="21ã€é™æ€å†…éƒ¨ç±»çš„è®¾è®¡æ„å›¾"><a href="#21ã€é™æ€å†…éƒ¨ç±»çš„è®¾è®¡æ„å›¾" class="headerlink" title="21ã€é™æ€å†…éƒ¨ç±»çš„è®¾è®¡æ„å›¾"></a>21ã€é™æ€å†…éƒ¨ç±»çš„è®¾è®¡æ„å›¾</h3><p>é™æ€å†…éƒ¨ç±»ä¸éé™æ€å†…éƒ¨ç±»ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«ï¼šéé™æ€å†…éƒ¨ç±»åœ¨ç¼–è¯‘å®Œæˆä¹‹åä¼šéšå«åœ°ä¿å­˜ç€ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨æ˜¯æŒ‡å‘åˆ›å»ºå®ƒçš„å¤–å›´å†…ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å´æ²¡æœ‰ã€‚</p><p>æ²¡æœ‰è¿™ä¸ªå¼•ç”¨å°±æ„å‘³ç€ï¼š</p><p>å®ƒçš„åˆ›å»ºæ˜¯ä¸éœ€è¦ä¾èµ–äºå¤–å›´ç±»çš„ã€‚<br>å®ƒä¸èƒ½ä½¿ç”¨ä»»ä½•å¤–å›´ç±»çš„éstaticæˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚</p><h3 id="22ã€Javaä¸­å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#22ã€Javaä¸­å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="22ã€Javaä¸­å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>22ã€Javaä¸­å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨Javaä¸­ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><p>1.åˆ›å»ºé˜¶æ®µ(Created)</p><p>JVM åŠ è½½ç±»çš„classæ–‡ä»¶ æ­¤æ—¶æ‰€æœ‰çš„staticå˜é‡å’Œstaticä»£ç å—å°†è¢«æ‰§è¡Œ<br>åŠ è½½å®Œæˆåï¼Œå¯¹å±€éƒ¨å˜é‡è¿›è¡Œèµ‹å€¼ï¼ˆå…ˆçˆ¶åå­çš„é¡ºåºï¼‰<br>å†æ‰§è¡Œnewæ–¹æ³• è°ƒç”¨æ„é€ å‡½æ•°<br>ä¸€æ—¦å¯¹è±¡è¢«åˆ›å»ºï¼Œå¹¶è¢«åˆ†æ´¾ç»™æŸäº›å˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€å°±åˆ‡æ¢åˆ°äº†åº”ç”¨é˜¶æ®µã€‚</p><p>2.åº”ç”¨é˜¶æ®µ(In Use)</p><p>å¯¹è±¡è‡³å°‘è¢«ä¸€ä¸ªå¼ºå¼•ç”¨æŒæœ‰ç€ã€‚</p><p>3.ä¸å¯è§é˜¶æ®µ(Invisible)</p><p>å½“ä¸€ä¸ªå¯¹è±¡å¤„äºä¸å¯è§é˜¶æ®µæ—¶ï¼Œè¯´æ˜ç¨‹åºæœ¬èº«ä¸å†æŒæœ‰è¯¥å¯¹è±¡çš„ä»»ä½•å¼ºå¼•ç”¨ï¼Œè™½ç„¶è¯¥è¿™äº›å¼•ç”¨ä»ç„¶æ˜¯å­˜åœ¨ç€çš„ã€‚<br>ç®€å•è¯´å°±æ˜¯ç¨‹åºçš„æ‰§è¡Œå·²ç»è¶…å‡ºäº†è¯¥å¯¹è±¡çš„ä½œç”¨åŸŸäº†ã€‚</p><p>4.ä¸å¯è¾¾é˜¶æ®µ(Unreachable)</p><p>å¯¹è±¡å¤„äºä¸å¯è¾¾é˜¶æ®µæ˜¯æŒ‡è¯¥å¯¹è±¡ä¸å†è¢«ä»»ä½•å¼ºå¼•ç”¨æ‰€æŒæœ‰ã€‚<br>ä¸â€œä¸å¯è§é˜¶æ®µâ€ç›¸æ¯”ï¼Œâ€œä¸å¯è§é˜¶æ®µâ€æ˜¯æŒ‡ç¨‹åºä¸å†æŒæœ‰è¯¥å¯¹è±¡çš„ä»»ä½•å¼ºå¼•ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å¯¹è±¡ä»å¯èƒ½è¢«JVMç­‰ç³»ç»Ÿä¸‹çš„æŸäº›å·²è£…è½½çš„é™æ€å˜é‡æˆ–çº¿ç¨‹æˆ–JNIç­‰å¼ºå¼•ç”¨æŒæœ‰ç€ï¼Œè¿™äº›ç‰¹æ®Šçš„å¼ºå¼•ç”¨è¢«ç§°ä¸ºâ€GC rootâ€ã€‚å­˜åœ¨ç€è¿™äº›GC rootä¼šå¯¼è‡´å¯¹è±¡çš„å†…å­˜æ³„éœ²æƒ…å†µï¼Œæ— æ³•è¢«å›æ”¶ã€‚</p><p>5.æ”¶é›†é˜¶æ®µ(Collected)</p><p>å½“åƒåœ¾å›æ”¶å™¨å‘ç°è¯¥å¯¹è±¡å·²ç»å¤„äºâ€œä¸å¯è¾¾é˜¶æ®µâ€å¹¶ä¸”åƒåœ¾å›æ”¶å™¨å·²ç»å¯¹è¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´é‡æ–°åˆ†é…åšå¥½å‡†å¤‡æ—¶ï¼Œåˆ™å¯¹è±¡è¿›å…¥äº†â€œæ”¶é›†é˜¶æ®µâ€ã€‚å¦‚æœè¯¥å¯¹è±¡å·²ç»é‡å†™äº†finalize()æ–¹æ³•ï¼Œåˆ™ä¼šå»æ‰§è¡Œè¯¥æ–¹æ³•çš„ç»ˆç«¯æ“ä½œã€‚</p><p>6.ç»ˆç»“é˜¶æ®µ(Finalized)</p><p>å½“å¯¹è±¡æ‰§è¡Œå®Œfinalize()æ–¹æ³•åä»ç„¶å¤„äºä¸å¯è¾¾çŠ¶æ€æ—¶ï¼Œåˆ™è¯¥å¯¹è±¡è¿›å…¥ç»ˆç»“é˜¶æ®µã€‚åœ¨è¯¥é˜¶æ®µæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨å¯¹è¯¥å¯¹è±¡ç©ºé—´è¿›è¡Œå›æ”¶ã€‚</p><p>7.å¯¹è±¡ç©ºé—´é‡åˆ†é…é˜¶æ®µ(De-allocated)</p><p>åƒåœ¾å›æ”¶å™¨å¯¹è¯¥å¯¹è±¡çš„æ‰€å ç”¨çš„å†…å­˜ç©ºé—´è¿›è¡Œå›æ”¶æˆ–è€…å†åˆ†é…äº†ï¼Œåˆ™è¯¥å¯¹è±¡å½»åº•æ¶ˆå¤±äº†ï¼Œç§°ä¹‹ä¸ºâ€œå¯¹è±¡ç©ºé—´é‡æ–°åˆ†é…é˜¶æ®µã€‚</p><h3 id="23ã€é™æ€å±æ€§å’Œé™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼Ÿæ˜¯å¦å¯ä»¥è¢«é‡å†™ï¼Ÿä»¥åŠåŸå› ï¼Ÿ"><a href="#23ã€é™æ€å±æ€§å’Œé™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼Ÿæ˜¯å¦å¯ä»¥è¢«é‡å†™ï¼Ÿä»¥åŠåŸå› ï¼Ÿ" class="headerlink" title="23ã€é™æ€å±æ€§å’Œé™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼Ÿæ˜¯å¦å¯ä»¥è¢«é‡å†™ï¼Ÿä»¥åŠåŸå› ï¼Ÿ"></a>23ã€é™æ€å±æ€§å’Œé™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥è¢«ç»§æ‰¿ï¼Ÿæ˜¯å¦å¯ä»¥è¢«é‡å†™ï¼Ÿä»¥åŠåŸå› ï¼Ÿ</h3><p>ç»“è®ºï¼šjavaä¸­é™æ€å±æ€§å’Œé™æ€æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œä½†æ˜¯ä¸å¯ä»¥è¢«é‡å†™è€Œæ˜¯è¢«éšè—ã€‚</p><p>åŸå› ï¼š</p><p>1). é™æ€æ–¹æ³•å’Œå±æ€§æ˜¯å±äºç±»çš„ï¼Œè°ƒç”¨çš„æ—¶å€™ç›´æ¥é€šè¿‡ç±»å.æ–¹æ³•åå®Œæˆï¼Œä¸éœ€è¦ç»§æ‰¿æœºåˆ¶å³å¯ä»¥è°ƒç”¨ã€‚å¦‚æœå­ç±»é‡Œé¢å®šä¹‰äº†é™æ€æ–¹æ³•å’Œå±æ€§ï¼Œé‚£ä¹ˆè¿™æ—¶å€™çˆ¶ç±»çš„é™æ€æ–¹æ³•æˆ–å±æ€§ç§°ä¹‹ä¸ºâ€éšè—â€ã€‚å¦‚æœä½ æƒ³è¦è°ƒç”¨çˆ¶ç±»çš„é™æ€æ–¹æ³•å’Œå±æ€§ï¼Œç›´æ¥é€šè¿‡çˆ¶ç±»å.æ–¹æ³•æˆ–å˜é‡åå®Œæˆï¼Œè‡³äºæ˜¯å¦ç»§æ‰¿ä¸€è¯´ï¼Œå­ç±»æ˜¯æœ‰ç»§æ‰¿é™æ€æ–¹æ³•å’Œå±æ€§ï¼Œä½†æ˜¯è·Ÿå®ä¾‹æ–¹æ³•å’Œå±æ€§ä¸å¤ªä¸€æ ·ï¼Œå­˜åœ¨â€éšè—â€çš„è¿™ç§æƒ…å†µã€‚</p><p>2). å¤šæ€ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°ä¾èµ–äºç»§æ‰¿ã€æ¥å£å’Œé‡å†™ã€é‡è½½ï¼ˆç»§æ‰¿å’Œé‡å†™æœ€ä¸ºå…³é”®ï¼‰ã€‚æœ‰äº†ç»§æ‰¿å’Œé‡å†™å°±å¯ä»¥å®ç°çˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘ä¸åŒå­ç±»çš„å¯¹è±¡ã€‚é‡å†™çš„åŠŸèƒ½æ˜¯ï¼šâ€é‡å†™â€åå­ç±»çš„ä¼˜å…ˆçº§è¦é«˜äºçˆ¶ç±»çš„ä¼˜å…ˆçº§ï¼Œä½†æ˜¯â€œéšè—â€æ˜¯æ²¡æœ‰è¿™ä¸ªä¼˜å…ˆçº§ä¹‹åˆ†çš„ã€‚</p><p>3). é™æ€å±æ€§ã€é™æ€æ–¹æ³•å’Œéé™æ€çš„å±æ€§éƒ½å¯ä»¥è¢«ç»§æ‰¿å’Œéšè—è€Œä¸èƒ½è¢«é‡å†™ï¼Œå› æ­¤ä¸èƒ½å®ç°å¤šæ€ï¼Œä¸èƒ½å®ç°çˆ¶ç±»çš„å¼•ç”¨å¯ä»¥æŒ‡å‘ä¸åŒå­ç±»çš„å¯¹è±¡ã€‚éé™æ€æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿å’Œé‡å†™ï¼Œå› æ­¤å¯ä»¥å®ç°å¤šæ€ã€‚</p><h3 id="24ã€objectç±»çš„equal-å’Œhashcode-æ–¹æ³•é‡å†™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"><a href="#24ã€objectç±»çš„equal-å’Œhashcode-æ–¹æ³•é‡å†™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="24ã€objectç±»çš„equal å’Œhashcode æ–¹æ³•é‡å†™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"></a>24ã€objectç±»çš„equal å’Œhashcode æ–¹æ³•é‡å†™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h3><p>åœ¨Java APIæ–‡æ¡£ä¸­å…³äºhashCodeæ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç‚¹è§„å®šï¼ˆåŸæ–‡æ¥è‡ªjavaæ·±å…¥è§£æä¸€ä¹¦ï¼‰ï¼š</p><p>1ã€åœ¨javaåº”ç”¨ç¨‹åºæ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœåœ¨equalsæ–¹æ³•æ¯”è¾ƒä¸­æ‰€ç”¨çš„ä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šå¤šæ¬¡è°ƒç”¨hashCodeæ–¹æ³•æ—¶å¿…é¡»ä¸€è‡´åœ°è¿”å›ç›¸åŒçš„æ•´æ•°ã€‚å¦‚æœå¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªåº”ç”¨æ—¶ï¼Œä¸è¦æ±‚è¯¥æ•´æ•°å¿…é¡»ç›¸åŒã€‚</p><p>2ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡è°ƒç”¨equalsæ–¹æ³•æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡è°ƒç”¨hashCodeæ–¹æ³•å¿…é¡»è¿”å›ç›¸åŒçš„æ•´æ•°ã€‚</p><p>3ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡è°ƒç”¨equalsæ–¹æ³•æ˜¯ä¸ç›¸ç­‰çš„ï¼Œä¸è¦æ±‚è¿™ä¸¤ä¸ªå¯¹è±¡è°ƒç”¨hashCodeæ–¹æ³•å¿…é¡»è¿”å›ä¸åŒçš„æ•´æ•°ã€‚ä½†æ˜¯ç¨‹åºå‘˜åº”è¯¥æ„è¯†åˆ°å¯¹ä¸åŒçš„å¯¹è±¡äº§ç”Ÿä¸åŒçš„hashå€¼å¯ä»¥æä¾›å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚</p><h3 id="25ã€javaä¸­-å’Œequalså’ŒhashCodeçš„åŒºåˆ«ï¼Ÿ"><a href="#25ã€javaä¸­-å’Œequalså’ŒhashCodeçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="25ã€javaä¸­==å’Œequalså’ŒhashCodeçš„åŒºåˆ«ï¼Ÿ"></a>25ã€javaä¸­==å’Œequalså’ŒhashCodeçš„åŒºåˆ«ï¼Ÿ</h3><p>é»˜è®¤æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯ä»è¶…ç±»Objectç»§æ‰¿è€Œæ¥çš„equalsæ–¹æ³•ä¸â€˜==â€™æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œæ¯”è¾ƒçš„éƒ½æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œä½†æˆ‘ä»¬å¯ä»¥é‡å†™equalsæ–¹æ³•ï¼Œä½¿å…¶æŒ‰ç…§æˆ‘ä»¬çš„éœ€æ±‚çš„æ–¹å¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚Stringç±»é‡å†™äº†equalsæ–¹æ³•ï¼Œä½¿å…¶æ¯”è¾ƒçš„æ˜¯å­—ç¬¦çš„åºåˆ—ï¼Œè€Œä¸å†æ˜¯å†…å­˜åœ°å€ã€‚åœ¨javaçš„é›†åˆä¸­ï¼Œåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„è§„åˆ™æ˜¯ï¼š</p><pre><code>  1.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„hashCodeæ˜¯å¦ç›¸ç­‰ã€‚  2.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ç”¨equalsè¿ç®—æ˜¯å¦ç›¸ç­‰ã€‚</code></pre><h3 id="26ã€Javaçš„å››ç§å¼•ç”¨åŠä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#26ã€Javaçš„å››ç§å¼•ç”¨åŠä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="26ã€Javaçš„å››ç§å¼•ç”¨åŠä½¿ç”¨åœºæ™¯ï¼Ÿ"></a>26ã€Javaçš„å››ç§å¼•ç”¨åŠä½¿ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li>å¼ºå¼•ç”¨ï¼ˆFinalReferenceï¼‰ï¼šåœ¨å†…å­˜ä¸è¶³æ—¶ä¸ä¼šè¢«å›æ”¶ã€‚å¹³å¸¸ç”¨çš„æœ€å¤šçš„å¯¹è±¡ï¼Œå¦‚æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</li><li>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ï¼šåœ¨å†…å­˜ä¸è¶³æ—¶ä¼šè¢«å›æ”¶ã€‚ç”¨äºå®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</li><li>å¼±å¼•ç”¨ï¼ˆWeakReferencï¼‰ï¼šåªè¦GCå›æ”¶å™¨å‘ç°äº†å®ƒï¼Œå°±ä¼šå°†ä¹‹å›æ”¶ã€‚ç”¨äºMapæ•°æ®ç»“æ„ä¸­ï¼Œå¼•ç”¨å ç”¨å†…å­˜ç©ºé—´è¾ƒå¤§çš„å¯¹è±¡ã€‚</li><li>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ï¼šåœ¨å›æ”¶ä¹‹å‰ï¼Œä¼šè¢«æ”¾å…¥ReferenceQueueï¼ŒJVMä¸ä¼šè‡ªåŠ¨å°†è¯¥referentå­—æ®µå€¼è®¾ç½®æˆnullã€‚å…¶å®ƒå¼•ç”¨è¢«JVMå›æ”¶ä¹‹åæ‰ä¼šè¢«æ”¾å…¥ReferenceQueueä¸­ã€‚ç”¨äºå®ç°ä¸€ä¸ªå¯¹è±¡è¢«å›æ”¶ä¹‹å‰åšä¸€äº›æ¸…ç†å·¥ä½œã€‚</li></ul><h3 id="27ã€ç±»çš„åŠ è½½è¿‡ç¨‹ï¼ŒPerson-person-new-Person-ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚"><a href="#27ã€ç±»çš„åŠ è½½è¿‡ç¨‹ï¼ŒPerson-person-new-Person-ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚" class="headerlink" title="27ã€ç±»çš„åŠ è½½è¿‡ç¨‹ï¼ŒPerson person = new Person();ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚"></a>27ã€ç±»çš„åŠ è½½è¿‡ç¨‹ï¼ŒPerson person = new Person();ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</h3><p>1).å› ä¸ºnewç”¨åˆ°äº†Person.classï¼Œæ‰€ä»¥ä¼šå…ˆæ‰¾åˆ°Person.classæ–‡ä»¶ï¼Œå¹¶åŠ è½½åˆ°å†…å­˜ä¸­;</p><p>2).æ‰§è¡Œè¯¥ç±»ä¸­çš„staticä»£ç å—ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œç»™Person.classç±»è¿›è¡Œåˆå§‹åŒ–;</p><p>3).åœ¨å †å†…å­˜ä¸­å¼€è¾Ÿç©ºé—´åˆ†é…å†…å­˜åœ°å€;</p><p>4).åœ¨å †å†…å­˜ä¸­å»ºç«‹å¯¹è±¡çš„ç‰¹æœ‰å±æ€§ï¼Œå¹¶è¿›è¡Œé»˜è®¤åˆå§‹åŒ–;</p><p>5).å¯¹å±æ€§è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–;</p><p>6).å¯¹å¯¹è±¡è¿›è¡Œæ„é€ ä»£ç å—åˆå§‹åŒ–;</p><p>7).å¯¹å¯¹è±¡è¿›è¡Œä¸ä¹‹å¯¹åº”çš„æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–;</p><p>8).å°†å†…å­˜åœ°å€ä»˜ç»™æ ˆå†…å­˜ä¸­çš„på˜é‡ã€‚</p><h3 id="28ã€JAVAå¸¸é‡æ± "><a href="#28ã€JAVAå¸¸é‡æ± " class="headerlink" title="28ã€JAVAå¸¸é‡æ± "></a>28ã€JAVAå¸¸é‡æ± </h3><p>Intergerä¸­çš„128(-128~127)</p><p>a.å½“æ•°å€¼èŒƒå›´ä¸º-128~127æ—¶ï¼šå¦‚æœä¸¤ä¸ªnewå‡ºæ¥çš„Integerå¯¹è±¡ï¼Œå³ä½¿å€¼ç›¸åŒï¼Œé€šè¿‡â€œ==â€æ¯”è¾ƒç»“æœä¸ºfalseï¼Œä½†ä¸¤ä¸ªå¯¹ç›´æ¥èµ‹å€¼ï¼Œåˆ™é€šè¿‡â€œ==â€æ¯”è¾ƒç»“æœä¸ºâ€œtrueï¼Œè¿™ä¸€ç‚¹ä¸Stringéå¸¸ç›¸ä¼¼ã€‚</p><p>b.å½“æ•°å€¼ä¸åœ¨-128~127æ—¶ï¼Œæ— è®ºé€šè¿‡å“ªç§æ–¹å¼ï¼Œå³ä½¿ä¸¤å¯¹è±¡çš„å€¼ç›¸ç­‰ï¼Œé€šè¿‡â€œ==â€æ¯”è¾ƒï¼Œå…¶ç»“æœä¸ºfalseï¼›</p><p>c.å½“ä¸€ä¸ªIntegerå¯¹è±¡ç›´æ¥ä¸ä¸€ä¸ªintåŸºæœ¬æ•°æ®ç±»å‹é€šè¿‡â€œ==â€æ¯”è¾ƒï¼Œå…¶ç»“æœä¸ç¬¬ä¸€ç‚¹ç›¸åŒï¼›</p><p>d.Integerå¯¹è±¡çš„hashå€¼ä¸ºæ•°å€¼æœ¬èº«ï¼›</p><p>ä¸ºä»€ä¹ˆæ˜¯-128-127?</p><p>åœ¨Integerç±»ä¸­æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»IntegerCacheï¼Œåœ¨IntegrCacheç±»ä¸­æœ‰ä¸€ä¸ªIntegeræ•°ç»„ï¼Œç”¨ä»¥ç¼“å­˜å½“å‰æ•°å€¼èŒƒå›´ä¸º-128~127æ—¶çš„Integerå¯¹è±¡ã€‚</p><h3 id="29ã€åœ¨é‡å†™equalsæ–¹æ³•æ—¶ï¼Œéœ€è¦éµå¾ªå“ªäº›çº¦å®šï¼Œå…·ä½“ä»‹ç»ä¸€ä¸‹ï¼Ÿ"><a href="#29ã€åœ¨é‡å†™equalsæ–¹æ³•æ—¶ï¼Œéœ€è¦éµå¾ªå“ªäº›çº¦å®šï¼Œå…·ä½“ä»‹ç»ä¸€ä¸‹ï¼Ÿ" class="headerlink" title="29ã€åœ¨é‡å†™equalsæ–¹æ³•æ—¶ï¼Œéœ€è¦éµå¾ªå“ªäº›çº¦å®šï¼Œå…·ä½“ä»‹ç»ä¸€ä¸‹ï¼Ÿ"></a>29ã€åœ¨é‡å†™equalsæ–¹æ³•æ—¶ï¼Œéœ€è¦éµå¾ªå“ªäº›çº¦å®šï¼Œå…·ä½“ä»‹ç»ä¸€ä¸‹ï¼Ÿ</h3><p>é‡å†™equalsæ–¹æ³•æ—¶éœ€è¦éµå¾ªé€šç”¨çº¦å®šï¼šè‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§ã€éç©ºæ€§</p><p>1ï¼‰è‡ªåæ€§</p><p>å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼x,x.equals(x)å¿…é¡»è¿”å›trueã€‚â€”è¿™ä¸€ç‚¹åŸºæœ¬ä¸Šä¸ä¼šæœ‰å•¥é—®é¢˜</p><p>2ï¼‰å¯¹ç§°æ€§</p><p>å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xå’Œyï¼Œå½“ä¸”ä»…å½“x.equals(y)ä¸ºtrueæ—¶ï¼Œy.equals(x)ä¹Ÿä¸ºtrueã€‚</p><p>3ï¼‰ä¼ é€’æ€§</p><p>å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xã€yã€zã€‚å¦‚æœx.equals(y)==true,y.equals(z)==true,é‚£ä¹ˆx.equals(z)==trueã€‚</p><p>4ï¼‰ ä¸€è‡´æ€§</p><p>å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xå’Œyï¼Œåªè¦equalsçš„æ¯”è¾ƒæ“ä½œåœ¨å¯¹è±¡æ‰€ç”¨çš„ä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå¤šæ¬¡è°ƒç”¨x.equals(y)å°±ä¼šä¸€è‡´æ€§åœ°è¿”å›true,æˆ–è€…ä¸€è‡´æ€§çš„è¿”å›falseã€‚</p><p>5ï¼‰éç©ºæ€§</p><p>æ‰€æœ‰æ¯”è¾ƒçš„å¯¹è±¡éƒ½ä¸èƒ½ä¸ºç©ºã€‚</p><h3 id="30ã€æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«"><a href="#30ã€æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«" class="headerlink" title="30ã€æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«"></a>30ã€<a href="http://www.cnblogs.com/chenssy/p/3308489.html">æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«</a></h3><h3 id="31ã€Integerç±»å¯¹intçš„ä¼˜åŒ–"><a href="#31ã€Integerç±»å¯¹intçš„ä¼˜åŒ–" class="headerlink" title="31ã€Integerç±»å¯¹intçš„ä¼˜åŒ–"></a>31ã€<a href="http://denverj.iteye.com/blog/745422">Integerç±»å¯¹intçš„ä¼˜åŒ–</a></h3>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> èŒåœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP ä¸ HTTPS</title>
      <link href="/2019-10-23/http-and-https/"/>
      <url>/2019-10-23/http-and-https/</url>
      
        <content type="html"><![CDATA[<p>ä½œä¸ºå¼€å‘è€…ï¼Œå¿…é¡»è¦å¯¹ HTTP ä¸ HTTPS çš„æ¦‚å¿µã€åŒºåˆ«å’Œä¼˜ç¼ºç‚¹æœ‰æ‰€äº†è§£ï¼Œåœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™æ‰èƒ½å¯¹ç—‡ä¸‹è¯ã€‚</p><span id="more"></span><p><a href="https://www.jianshu.com/p/14cd2c9d2cd2">è¿™ä¸ª</a></p><ul><li>HTTP: HTTP åè®®ï¼ˆHyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ï¼šæ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨æˆ–å…¶ä»–ç¨‹åºä¸WebæœåŠ¡å™¨ä¹‹é—´çš„åº”ç”¨å±‚é€šä¿¡åè®® ã€‚</li><li>HTTPS: HTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºHTTP+SSL/TLSï¼Œ å³ HTTP ä¸‹åŠ å…¥ SSL å±‚ï¼ŒHTTPS çš„å®‰å…¨åŸºç¡€æ˜¯ SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦ SSLï¼Œç”¨äºå®‰å…¨çš„ HTTP æ•°æ®ä¼ è¾“ã€‚</li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://pic2.zhimg.com/80/v2-54ff04e1b0cc698f08f76d6356f59fac_1440w.png" alt="HTTP ä¸ HTTPS"></p><h2 id="HTTP-è¯·æ±‚è¿‡ç¨‹"><a href="#HTTP-è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="HTTP è¯·æ±‚è¿‡ç¨‹"></a>HTTP è¯·æ±‚è¿‡ç¨‹</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸º HTTP çš„è¯·æ±‚è¿‡ç¨‹ï¼š</p><p><img src="https://picb.zhimg.com/80/v2-e367a5e3bc28fb7fd083ddc201e7e693_1440w.png" alt="HTTP è¯·æ±‚è¿‡ç¨‹"></p><p>HTTP è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰ä»»ä½•èº«ä»½ç¡®è®¤çš„è¿‡ç¨‹ï¼Œæ•°æ®å…¨éƒ¨æ˜æ–‡ä¼ è¾“ï¼Œã€è£¸å¥”ã€åœ¨äº’è”ç½‘ä¸Šï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é­åˆ°é»‘å®¢çš„æ”»å‡»ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://pic1.zhimg.com/80/v2-831635f04f3732e866af0ec6ce1040e7_1440w.png" alt="HTTP é»‘å®¢æ”»å‡»"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚å¾ˆå®¹æ˜“è¢«é»‘å®¢æˆªè·ï¼Œå¦‚æœæ­¤æ—¶é»‘å®¢å†’å……æœåŠ¡å™¨ï¼Œåˆ™å…¶å¯è¿”å›ä»»æ„ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸è¢«å®¢æˆ·ç«¯å¯Ÿè§‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°ä¸€è¯â€œåŠ«æŒâ€ï¼Œç°è±¡å¦‚ä¸‹ï¼š</p><p>ä¸‹é¢ä¸¤å›¾ä¸­ï¼Œæµè§ˆå™¨ä¸­å¡«å…¥çš„æ˜¯ç›¸åŒçš„URLï¼Œå·¦è¾¹æ˜¯æ­£ç¡®å“åº”ï¼Œè€Œå³è¾¹åˆ™æ˜¯è¢«åŠ«æŒåçš„å“åº”</p><p><img src="https://pic3.zhimg.com/80/v2-299b4a71f9b005fa15fbcd4cabfd841b_1440w.png" alt="åŠ«æŒæ•ˆæœ"></p><p>æ‰€ä»¥ HTTP ä¼ è¾“é¢ä¸´çš„é£é™©æœ‰ï¼š</p><ol><li>çªƒå¬é£é™©ï¼šé»‘å®¢å¯ä»¥è·çŸ¥é€šä¿¡å†…å®¹ã€‚</li><li>ç¯¡æ”¹é£é™©ï¼šé»‘å®¢å¯ä»¥ä¿®æ”¹é€šä¿¡å†…å®¹ã€‚</li><li>å†’å……é£é™©ï¼šé»‘å®¢å¯ä»¥å†’å……ä»–äººèº«ä»½å‚ä¸é€šä¿¡ã€‚</li></ol><h2 id="HTTP-å‘-HTTPS-æ¼”åŒ–çš„è¿‡ç¨‹"><a href="#HTTP-å‘-HTTPS-æ¼”åŒ–çš„è¿‡ç¨‹" class="headerlink" title="HTTP å‘ HTTPS æ¼”åŒ–çš„è¿‡ç¨‹"></a>HTTP å‘ HTTPS æ¼”åŒ–çš„è¿‡ç¨‹</h2><p>ç¬¬ä¸€æ­¥ï¼šä¸ºäº†é˜²æ­¢ä¸Šè¿°ç°è±¡çš„å‘ç”Ÿï¼Œäººä»¬æƒ³åˆ°ä¸€ä¸ªåŠæ³•ï¼šå¯¹ä¼ è¾“çš„ä¿¡æ¯åŠ å¯†ï¼ˆå³ä½¿é»‘å®¢æˆªè·ï¼Œä¹Ÿæ— æ³•ç ´è§£ï¼‰</p><p><img src="https://pic1.zhimg.com/80/v2-8d8138e883455e4d316d644c79a89314_1440w.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­¤ç§æ–¹å¼å±äºå¯¹ç§°åŠ å¯†ï¼ŒåŒæ–¹æ‹¥æœ‰ç›¸åŒçš„å¯†é’¥ï¼Œä¿¡æ¯å¾—åˆ°å®‰å…¨ä¼ è¾“ï¼Œä½†æ­¤ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼š</p><ol><li>ä¸åŒçš„å®¢æˆ·ç«¯ã€æœåŠ¡å™¨æ•°é‡åºå¤§ï¼Œæ‰€ä»¥åŒæ–¹éƒ½éœ€è¦ç»´æŠ¤å¤§é‡çš„å¯†é’¥ï¼Œç»´æŠ¤æˆæœ¬å¾ˆé«˜</li><li>å› æ¯ä¸ªå®¢æˆ·ç«¯ã€æœåŠ¡å™¨çš„å®‰å…¨çº§åˆ«ä¸åŒï¼Œå¯†é’¥ææ˜“æ³„éœ²</li></ol><p>ç¬¬äºŒæ­¥ï¼šæ—¢ç„¶ä½¿ç”¨å¯¹ç§°åŠ å¯†æ—¶ï¼Œå¯†é’¥ç»´æŠ¤è¿™ä¹ˆç¹çï¼Œé‚£æˆ‘ä»¬å°±ç”¨éå¯¹ç§°åŠ å¯†è¯•è¯•</p><p><img src="https://pic1.zhimg.com/80/v2-660bec42419281a9ec47c029089a77c9_1440w.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯ç”¨å…¬é’¥å¯¹è¯·æ±‚å†…å®¹åŠ å¯†ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ç§é’¥å¯¹å†…å®¹è§£å¯†ï¼Œåä¹‹äº¦ç„¶ï¼Œä½†ä¸Šè¿°è¿‡ç¨‹ä¹Ÿå­˜åœ¨ç¼ºç‚¹ï¼š</p><p>å…¬é’¥æ˜¯å…¬å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯é»‘å®¢ä¹Ÿä¼šæœ‰å…¬é’¥ï¼‰ï¼Œæ‰€ä»¥ç¬¬ â‘£ æ­¥ç§é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œå¦‚æœè¢«é»‘å®¢æˆªè·ï¼Œå…¶å¯ä»¥ä½¿ç”¨å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œè·å–å…¶ä¸­çš„å†…å®¹</p><p>ç¬¬ä¸‰æ­¥ï¼šéå¯¹ç§°åŠ å¯†æ—¢ç„¶ä¹Ÿæœ‰ç¼ºé™·ï¼Œé‚£æˆ‘ä»¬å°±å°†å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œå–å…¶ç²¾åã€å»å…¶ç³Ÿç²•ï¼Œå‘æŒ¥ä¸¤è€…çš„å„è‡ªçš„ä¼˜åŠ¿</p><p><img src="https://picb.zhimg.com/80/v2-22570e3e422de7951ce7c5c3e8435312_1440w.png"></p><ol><li>ç¬¬ â‘¢ æ­¥æ—¶ï¼Œå®¢æˆ·ç«¯è¯´ï¼šï¼ˆå’±ä»¬åç»­å›è¯é‡‡ç”¨å¯¹ç§°åŠ å¯†å§ï¼Œè¿™æ˜¯å¯¹ç§°åŠ å¯†çš„ç®—æ³•å’Œå¯¹ç§°å¯†é’¥ï¼‰è¿™æ®µè¯ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä¼ ç»™æœåŠ¡å™¨ï¼›</li><li>æœåŠ¡å™¨æ”¶åˆ°ä¿¡æ¯åï¼Œç”¨ç§é’¥è§£å¯†ï¼Œæå–å‡ºå¯¹ç§°åŠ å¯†ç®—æ³•å’Œå¯¹ç§°å¯†é’¥åï¼ŒæœåŠ¡å™¨è¯´ï¼šï¼ˆå¥½çš„ï¼‰å¯¹ç§°å¯†é’¥åŠ å¯†ï¼›</li><li>åç»­ä¸¤è€…ä¹‹é—´ä¿¡æ¯çš„ä¼ è¾“å°±å¯ä»¥ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„æ–¹å¼äº†ã€‚</li></ol><p>é‡åˆ°çš„é—®é¢˜ï¼š</p><ol><li>å®¢æˆ·ç«¯å¦‚ä½•è·å¾—å…¬é’¥ï¼Ÿ</li><li>å¦‚ä½•ç¡®è®¤æœåŠ¡å™¨æ˜¯çœŸå®çš„è€Œä¸æ˜¯é»‘å®¢ï¼Ÿ</li></ol><p>ç¬¬å››æ­¥ï¼šè·å–å…¬é’¥ä¸ç¡®è®¤æœåŠ¡å™¨èº«ä»½</p><p><img src="https://pic2.zhimg.com/80/v2-f2ac6567fa1a3c10e73eba59eab3823a_1440w.png"></p><ol><li>è·å–å…¬é’¥<ol><li>æä¾›ä¸€ä¸ªä¸‹è½½å…¬é’¥çš„åœ°å€ï¼Œå›è¯å‰è®©å®¢æˆ·ç«¯å»ä¸‹è½½ã€‚ï¼ˆç¼ºç‚¹ï¼šä¸‹è½½åœ°å€æœ‰å¯èƒ½æ˜¯å‡çš„ï¼›å®¢æˆ·ç«¯æ¯æ¬¡åœ¨å›è¯å‰éƒ½å…ˆå»ä¸‹è½½å…¬é’¥ä¹Ÿå¾ˆéº»çƒ¦ï¼‰</li><li>ä¼šè¯å¼€å§‹æ—¶ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥å‘ç»™å®¢æˆ·ç«¯ï¼ˆç¼ºç‚¹ï¼šé»‘å®¢å†’å……æœåŠ¡å™¨ï¼Œå‘é€ç»™å®¢æˆ·ç«¯å‡çš„å…¬é’¥ï¼‰</li></ol></li><li>æœ‰æœ¨æœ‰ä¸€ç§æ–¹å¼æ—¢å¯ä»¥å®‰å…¨çš„è·å–å…¬é’¥ï¼Œåˆèƒ½é˜²æ­¢é»‘å®¢å†’å……å‘¢ï¼Ÿ é‚£å°±éœ€è¦ç”¨åˆ°ç»ˆææ­¦å™¨äº†ï¼š<strong>SSL è¯ä¹¦</strong></li></ol><p><img src="https://pic3.zhimg.com/80/v2-5e2241fae8b593ff7f3b3a308ef81c10_1440w.png" alt="ä½¿ç”¨ SSL è¯ä¹¦"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ç¬¬ â‘¡ æ­¥æ—¶æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªSSLè¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼ŒSSL è¯ä¹¦ä¸­åŒ…å«çš„å…·ä½“å†…å®¹æœ‰ï¼š</p><ul><li>è¯ä¹¦çš„å‘å¸ƒæœºæ„CA</li><li>è¯ä¹¦çš„æœ‰æ•ˆæœŸ</li><li>å…¬é’¥</li><li>è¯ä¹¦æ‰€æœ‰è€…</li><li>ç­¾å</li><li>å…¶å®ƒ</li></ul><ol start="3"><li>å®¢æˆ·ç«¯åœ¨æ¥å—åˆ°æœåŠ¡ç«¯å‘æ¥çš„SSLè¯ä¹¦æ—¶ï¼Œä¼šå¯¹è¯ä¹¦çš„çœŸä¼ªè¿›è¡Œæ ¡éªŒï¼Œä»¥æµè§ˆå™¨ä¸ºä¾‹è¯´æ˜å¦‚ä¸‹ï¼š</li></ol><p>ï¼ˆ1ï¼‰é¦–å…ˆæµè§ˆå™¨è¯»å–è¯ä¹¦ä¸­çš„è¯ä¹¦æ‰€æœ‰è€…ã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯è¿›è¡Œä¸€ä¸€æ ¡éªŒ</p><p>ï¼ˆ2ï¼‰æµè§ˆå™¨å¼€å§‹æŸ¥æ‰¾æ“ä½œç³»ç»Ÿä¸­å·²å†…ç½®çš„å—ä¿¡ä»»çš„è¯ä¹¦å‘å¸ƒæœºæ„CAï¼Œä¸æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸­çš„é¢å‘è€…CAæ¯”å¯¹ï¼Œç”¨äºæ ¡éªŒè¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•æœºæ„é¢å‘</p><p>ï¼ˆ3ï¼‰å¦‚æœæ‰¾ä¸åˆ°ï¼Œæµè§ˆå™¨å°±ä¼šæŠ¥é”™ï¼Œè¯´æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯ä¸å¯ä¿¡ä»»çš„ã€‚</p><p>ï¼ˆ4ï¼‰å¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šä»æ“ä½œç³»ç»Ÿä¸­å–å‡º é¢å‘è€…CA çš„å…¬é’¥ï¼Œç„¶åå¯¹æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦é‡Œé¢çš„ç­¾åè¿›è¡Œè§£å¯†</p><p>ï¼ˆ5ï¼‰æµè§ˆå™¨ä½¿ç”¨ç›¸åŒçš„hashç®—æ³•è®¡ç®—å‡ºæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦çš„hashå€¼ï¼Œå°†è¿™ä¸ªè®¡ç®—çš„hashå€¼ä¸è¯ä¹¦ä¸­ç­¾ååšå¯¹æ¯”</p><p>ï¼ˆ6ï¼‰å¯¹æ¯”ç»“æœä¸€è‡´ï¼Œåˆ™è¯æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦åˆæ³•ï¼Œæ²¡æœ‰è¢«å†’å……</p><p>ï¼ˆ7ï¼‰æ­¤æ—¶æµè§ˆå™¨å°±å¯ä»¥è¯»å–è¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œç”¨äºåç»­åŠ å¯†äº†</p><ol start="4"><li>æ‰€ä»¥é€šè¿‡å‘é€SSLè¯ä¹¦çš„å½¢å¼ï¼Œæ—¢è§£å†³äº†å…¬é’¥è·å–é—®é¢˜ï¼Œåˆè§£å†³äº†é»‘å®¢å†’å……é—®é¢˜ï¼Œä¸€ç®­åŒé›•ï¼ŒHTTPSåŠ å¯†è¿‡ç¨‹ä¹Ÿå°±æ­¤å½¢æˆ</li></ol><p>æ‰€ä»¥ç›¸æ¯”HTTPï¼ŒHTTPS ä¼ è¾“æ›´åŠ å®‰å…¨</p><p>ï¼ˆ1ï¼‰ æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯åŠ å¯†ä¼ æ’­ï¼Œé»‘å®¢æ— æ³•çªƒå¬ã€‚</p><p>ï¼ˆ2ï¼‰ å…·æœ‰æ ¡éªŒæœºåˆ¶ï¼Œä¸€æ—¦è¢«ç¯¡æ”¹ï¼Œé€šä¿¡åŒæ–¹ä¼šç«‹åˆ»å‘ç°ã€‚</p><p>ï¼ˆ3ï¼‰ é…å¤‡èº«ä»½è¯ä¹¦ï¼Œé˜²æ­¢èº«ä»½è¢«å†’å……ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»¼ä¸Šæ‰€è¿°ï¼Œç›¸æ¯” HTTP åè®®ï¼ŒHTTPS åè®®å¢åŠ äº†å¾ˆå¤šæ¡æ‰‹ã€åŠ å¯†è§£å¯†ç­‰æµç¨‹ï¼Œè™½ç„¶è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œä½†å…¶å¯ä»¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªäº’è”ç½‘è†¨èƒ€çš„æ—¶ä»£ï¼Œå…¶ä¸­éšè—ç€å„ç§çœ‹ä¸è§çš„å±æœºï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œç»´æŠ¤ç½‘ç»œç¨³å®šï¼Œå»ºè®®å¤§å®¶å¤šå¤šæ¨å¹¿HTTPSã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2015</title>
      <link href="/2015-12-31/my-2015/"/>
      <url>/2015-12-31/my-2015/</url>
      
        <content type="html"><![CDATA[<p>åˆåˆ°ä¸€å¹´å°¾å£°æ—¶ï¼Œæˆ‘ä¹Ÿè¯¥å¥½å¥½æ€»ç»“è¿™ä¸€å¹´äº†ã€‚<br>åŸŸåæ¢äº†ï¼Œå˜æˆäº†<a href="http://serious-think.me/">serious-think.me</a>ã€‚è¿™ä¸ªåŸŸåä¹Ÿæ˜¯æƒ³äº†ä¸€æ®µæ—¶é—´ï¼ŒåŸæ¥çš„è‹±æ–‡+æ•°å­—ä¸æ–¹ä¾¿è¾“å…¥ï¼Œè€Œä¸”æ˜¾å¾—ä¸å¤Ÿä¸¥è‚ƒã€‚<br>è¿™ä¸ªåŸŸåå‘¢ï¼Œ<strong>serious</strong>æ˜¯æˆ‘çš„è‹±æ–‡åï¼Œä¹Ÿæ˜¯è®¤çœŸã€ä¸¥è‚ƒçš„æ„æ€ï¼Œ<strong>think</strong>æ˜¯æƒ³ã€æ€è€ƒï¼Œä¹Ÿç®—æ˜¯åŒå…³å§ã€‚</p><p>è¿˜æ˜¯å»¶ç»­ä»¥å‰çš„è€ä¼ ç»Ÿï¼Œè®©æˆ‘ä»¬ç”¨å››å¤§å‘³è§‰æ¥æ€»ç»“è¿™365å¤©ã€‚</p><span id="more"></span><h2 style="text-align: center;">  <span style="color:#ffa500;">é…¸</span></h2><p>è¦è¯´è¿™é…¸å•Šï¼Œä»Šå¹´ç®—ä¸‹æ¥ï¼Œæ— éå°±æ˜¯è¿™é’±çš„äº‹ã€‚</p><p>å› ä¸ºåœ¨14å¹´çš„5æœˆä»½ï¼Œå“¥è£å‡æˆ¿å¥´çš„è§’è‰²ã€‚åœ¨è€å®¶ä¹°äº†ä¸€å¥—å¤§æˆ¿çº¸ã€‚å„ç§é—®é¢˜æ¥è¸µè€Œè‡³ã€‚é¦–å½“å…¶å†²çš„å°±æ˜¯é’±çš„é—®é¢˜ã€‚è½¦ä½ã€åœ°ä¸‹å®¤ã€å„ç§æŠ¼é‡‘å„ç§è´¹ç”¨ï¼ŒæŠŠæˆ‘ä»¬ä¿©å¼„å¾—ç–²æƒ«ä¸å ªï¼Œä¹Ÿå› ä¸ºè¿™ä»¶äº‹æƒ…åµäº†å‡ æ¬¡æ¶ã€‚æˆ‘å¦ˆä¹Ÿå››å¤„å€Ÿé’±ï¼Œæ€»ç®—æ˜¯æŠŠæˆ‘ä»¬çš„é’±å‡‘é½ï¼ŒæŠŠæˆ¿å­ç»™æå®šäº†ã€‚</p><p>ä½†æ˜¯å‘¢ï¼Œä¹Ÿæ˜¯å› ä¸ºé’±ä¸å¤Ÿï¼Œä¹°æˆ¿æ—¶åªäº¤äº†15%çš„é¦–ä»˜ï¼Œå¦å¤–15%éœ€è¦åœ¨äº¤æˆ¿çš„æ—¶å€™äº¤ï¼Œä¹Ÿç®—æ˜¯å‡è½»äº†ä¸€ç‚¹å‹åŠ›ï¼Œä¸ç”¨åœ¨æœ‰é™çš„æ—¶é—´å†…å‡‘é‚£ä¹ˆå¤šé’±ã€‚</p><p>å³ä¾¿æ˜¯è¿™æ ·ï¼Œä¹Ÿç€å®å› ä¸ºå‡‘é’±ã€å€Ÿé’±ï¼Œæ‹Œäº†å‡ æ¬¡å˜´ã€‚</p><p>å¥½æ­¹ä¸€è·¯èµ°æ¥ï¼Œå†çœ‹çœ‹ä¹‹å‰é‡åˆ°çš„éš¾é¢˜ï¼Œéƒ½æ˜¯ç¬‘è¯ã€‚</p><p>å†è”æƒ³åˆ°ç°åœ¨æˆ‘ä»¬80åè¿™ä¸€ä»£äººï¼Œå¿ƒé‡ŒçœŸæ˜¯é…¸æºœæºœçš„ï¼Œå§”å±ˆå´åˆæ— å¤„å¯è¯‰ï¼Œè®©äººå¿ƒé‡Œæ†‹å±ˆå¾—å¾ˆã€‚</p><p>ä½†æ˜¯è½¬å¿µä¸€æƒ³ï¼Œæˆ‘ä¿©å¥‹æ–—æ‰æœ‰å‡ å¹´æ—¶å…‰ï¼Œå±…ç„¶å°±æœ‰äº†è‡ªå·±çš„æˆ¿å­ï¼Œå¿ƒé‡Œä¸Šæ€»ç®—æ˜¯æœ‰äº†â€œå®¶â€çš„æ„Ÿè§‰å§ã€‚æˆ‘ä»¬ä¸¤ä¸ªäººèŠå¤©ï¼Œå¶å°”ä¹Ÿä¼šæ„Ÿæ…¨ï¼ŒèŠ±äº†é’±ï¼Œå°±æ˜¯ç‰¹ä¹ˆçš„ä¸ä¸€æ ·ã€‚</p><h2 style="text-align: center;">  <span style="color:#0000ff;">ç”œ</span></h2><p>ç”œçš„äº‹æƒ…ï¼Œé‚£å¯çœŸæœ‰å¾—è¯´äº†ã€‚ä»Šå¹´é«˜å…´çš„äº‹å„¿çœŸä¸å°‘ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘è£å‡å¥¶çˆ¸äº†ï¼ä»Šå¹´6æœˆä»½çš„æ—¶å€™å¼€å§‹å‡†å¤‡é€ äººï¼Œå‡†å¤‡äº†å‡ ä¸ªæœˆï¼Œåª³å¦‡çš„è‚šå­æ¯«æ— åŠ¨é™ï¼Œæˆ‘ä¿©ä¹Ÿå¿«è¢«é€¼ç–¯äº†ï¼Œåæ¥å®åœ¨ä¸è¡Œï¼Œåˆ°åŒ»é™¢ä¸€é—®ï¼Œäººå®¶å¤§å¤«éœ‡æƒŠå¾—è¦å‘½ï¼šä½ ä¿©è¿™æ‰å‡ ä¸ªæœˆå•Šï¼Ÿï¼å°±æ¥é—®ï¼Ÿï¼ä¸¤å¹´éƒ½è¦ä¸ä¸Šå†æ¥æ‰¾æˆ‘ï¼</p><p>æ²¡æˆæƒ³ï¼Œå›å»ä¹‹åçš„è¿™ä¸ªæœˆï¼Œé©¬ä¸Šå°±æœ‰åŠ¨é™äº†ï¼çœ‹åˆ°ä¸¤é“æ çš„é‚£ä¸ªæ—©ä¸Šï¼Œé‚£çœŸå«ä¸€ä¸ªå…´å¥‹å•Šã€‚</p><p>æœ€è¿‘å°±å¼€å§‹è®¤çœŸç…§é¡¾åª³å¦‡äº†ã€‚è®¤çœŸç…§é¡¾åª³å¦‡ä¹Ÿæ˜¯ä¸€ä»¶ä»¤äººå¼€å¿ƒçš„äº‹æƒ…ï¼Œå¥¹å¼€å¿ƒï¼Œæˆ‘ä¹Ÿè·Ÿç€å¼€å¿ƒï¼Œå®å®ä¹Ÿè·Ÿç€å¼€å¿ƒï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ</p><p>å¦ä¸€ä»¶äº‹æ˜¯å“¥è£å‡ç®¡ç†å±‚ï¼ˆå¤§é›¾ï¼‰å•¦ï¼è™½ç„¶ç»éªŒæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯æ¥è¿™å®¶å…¬å¸ä¸€å¹´ä¹‹åï¼Œå‘ç°è‡ªå·±çš„æ°´å¹³æœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹çš„é•¿è¿›ï¼Œå¯ä»¥å¸¦ä¸€ä¸¤ä¸ªå°å¼Ÿäº†ã€‚äºæ˜¯é¢†å¯¼æ‰¾åˆ°æˆ‘ï¼Œè¯´å‡†å¤‡ç»™æˆ‘æ‹›ä¸¤ä¸ªå¸®æ‰‹ã€‚å¬åˆ°è¿™å¸­è¯ï¼Œé¦–å…ˆæ„Ÿè§‰æ˜¯é¢†å¯¼å¯¹æˆ‘çš„è‚¯å®šï¼Œå…¶æ¬¡æ‰æ„Ÿè§‰åˆ°è‡ªå·±ä¹Ÿç®—æ˜¯æœ‰äº†ä¸€ç‚¹è¿›æ­¥å§ã€‚</p><p>äºæ˜¯å¾ˆå¿«æ‹›åˆ°äº†ä¸¤ä¸ªæ–°åŒäº‹ï¼Œä¹Ÿæ²¡æœ‰å•¥ä¸Šä¸‹çº§çš„å…³ç³»ï¼Œäº’å¸®äº’åŠ©ï¼Œè€Œä¸”æˆ‘è¿™äººä¹Ÿæ²¡å•¥æ¶å­ï¼Œè‡ªå·±ä¼šçš„ä¸œè¥¿éƒ½ä¼šå€¾å›Šç›¸æˆï¼Œä¹‹å‰å­¤å†›å¥‹æˆ˜çš„æ—¥å­ä¹Ÿç»ˆäºç®—æ˜¯ç»“æŸäº†ã€‚</p><p>å†ä¸€ä»¶äº‹æ˜¯æˆ‘å‘å…¬å¸ç”³è¯·äº†ä¸€å°MacBook Proï¼Œæœ¬ä»¥ä¸ºå¯èƒ½æ²¡æˆï¼Œæ²¡æƒ³åˆ°é¢†å¯¼éå¸¸çˆ½å¿«åœ°æ‰¹å‡†äº†ã€‚ç»ˆäºå¯ä»¥ä¸ç”¨å†å€’è…¾ä»£ç äº†ã€‚ã€‚æœ¬æ¥å°±æœ‰å›å®¶å†å·¥ä½œä¸€ä¼šå„¿çš„ä¹ æƒ¯ï¼Œç°åœ¨å¯ä»¥å¸¦ç€æœ¬å­å›å®¶å¹²æ´»äº†ï¼Œè¿˜çœŸæ˜¯ç›¸å½“å¼€å¿ƒçš„ä¸€ä»¶äº‹ã€‚</p><p>ç¬¬ä¸‰ä»¶äº‹å•Šï¼Œæ˜¯å“¥ä¹Ÿå½“äº†ä¸€å›ä¼˜ç§€å‘˜å·¥ã€‚æ˜¯äººäº‹çš„åŒäº‹å‘Šè¯‰æˆ‘çš„ï¼Œå“¥å½“æ—¶å¼ºè£…é•‡å®šï¼Œå…¶å®å¿ƒé‡Œæ—©å°±ä¹å¼€äº†èŠ±ã€‚ä¸è¿‡ä¹Ÿæ˜¯ï¼Œçœ‹çœ‹è¿™ä¸€å¹´ï¼Œæˆ‘ä¹Ÿæ˜¯æœ‰ç‚¹è¿›æ­¥çš„ï¼Œè¿™ä¹Ÿå……åˆ†è¯´æ˜äº†ä¸Šé¢å¯¹æˆ‘çš„è®¤å¯ï¼Œå¤šä»¤äººå¼€å¿ƒï¼</p><h2 style="text-align: center;">  <span style="color:#008000;">è‹¦</span></h2><p>è‹¦ï¼Œæ— éæ˜¯å·¥ä½œä¸Šçš„äº‹æƒ…ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> å¹´ç»ˆæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è®¾ç½®SSHä½¿ç”¨å…¬é’¥è®¤è¯ç™»å½•ä¸»æœº</title>
      <link href="/2015-07-24/ssh-using-public-key/"/>
      <url>/2015-07-24/ssh-using-public-key/</url>
      
        <content type="html"><![CDATA[<div id="menu"></div><p><a href="#Overview">æ€»è§ˆ</a></p><p><a href="#Linux">åœ¨Linuxæˆ–OS Xä¸Šè®¾ç½®SSHä½¿ç”¨å…¬é’¥</a></p><p><a href="#Windows">åœ¨Windowsä¸Šä½¿ç”¨PuTTYè®¾ç½®SSHä½¿ç”¨å…¬é’¥</a></p><span id="more"></span><p>###æ€»è§ˆ</p><p>åœ¨ä½¿ç”¨SSHæ—¶ï¼Œåˆ©ç”¨å…¬é’¥æ¥è¿›è¡Œè®¤è¯åçš„é“¾æ¥ï¼Œæ˜¯æ¯”åªåˆ©ç”¨å¯†ç æ¥è¿›è¡ŒéªŒè¯è¦å®‰å…¨å¾—å¤šçš„ã€‚SSHå…¬é’¥è®¤è¯æ˜¯åŸºäºéå¯¹ç§°åŠ å¯†ç®—æ³•çš„ï¼Œè¿™ç§åŠ å¯†ç®—æ³•ä¼šç”Ÿæˆä¸€å¯¹keyï¼Œä¸€ä¸ªâ€œç§æœ‰â€keyï¼Œä¹Ÿå°±æ˜¯ç§é’¥ï¼Œå’Œä¸€ä¸ªâ€œå…¬æœ‰â€keyï¼Œå³å…¬é’¥ã€‚ä½ åœ¨ä½ çš„ç”µè„‘ä¸Šåªä¿å­˜ä¸€ä¸ªç§é’¥ï¼Œç”¨æ¥è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚åŒæ—¶ä½ ä¹Ÿå¯ä»¥æŠŠå…¬é’¥åˆ†äº«ç»™ä»»ä½•äººï¼ˆä¸è¦ç»™ä»–ç§é’¥å“Ÿï¼‰ï¼Œæˆ–è€…å­˜å‚¨åœ¨è¿œç¨‹ä¸»æœºçš„æŸä¸ªç›®å½•ä¸Šï¼Œæ¯”å¦‚ <code>.ssh/autorized_keys</code>ã€‚</p><p>ä½¿ç”¨SSHå…¬é’¥è®¤è¯ï¼š</p><p>è¿œç¨‹ä¸»æœºå¿…é¡»è¦å®‰è£…äº†SSHï¼ˆä»»æ„ç‰ˆæœ¬ï¼‰ã€‚æœ¬æ–‡å‡è®¾è¿œç¨‹ä¸»æœºä½¿ç”¨äº†OpenSSHï¼ˆå¯¹ï¼Œå°±æ˜¯ä¸Šä¸€ç¯‡æ–‡è¯´çš„å°ç¬¬å®‰é‚£å¤§å­¦çš„UTISä¸­å¿ƒç³»ç»Ÿä½¿ç”¨çš„é‚£ä¸ªï¼‰ã€‚å¦‚æœè¿œç¨‹ä¸»æœºæ­£åœ¨ä½¿ç”¨ä¸€ä¸ªå¥‡æ€ªçš„SSHç‰ˆæœ¬ï¼ˆæ¯”å¦‚Tectia SSHï¼‰ï¼Œä¸‹æ–‡å³å°†ä½¿ç”¨çš„æ–¹æ³•å¯èƒ½ä¸æ­£ç¡®ã€‚</p><p>ä½ çš„ç”µè„‘ä¹Ÿå¿…é¡»å®‰è£…æŸç§ç‰ˆæœ¬çš„SSHå·¥å…·ã€‚æœ¬æ–‡å‡è®¾ä½ åœ¨Linuxæˆ–Mac OS Xä¸‹ä½¿ç”¨å‘½ä»¤è¡Œä¸­çš„SSHï¼Œåœ¨Windowsä¸‹ä½¿ç”¨PuTTYã€‚</p><p>è¿˜æœ‰ä¸ªå‰ææ˜¯ä½ èƒ½å¤ŸæŠŠå…¬é’¥æƒ³åŠæ³•ä¼ è¾“åˆ°è¿œç¨‹ä¸»æœºä¸Šã€‚ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•åˆ°è¿œç¨‹ä¸»æœºæˆ–è€…æœ‰ç½‘ç»œç®¡ç†å‘˜æ¥å¸®ä½ åšè¿™ä»¶äº‹ã€‚</p><p>å…¬é’¥å¯ä»¥å­˜å‚¨åˆ° <code>~/.ssh/authorized_keys</code>ç›®å½•ä¸‹ã€‚</p><p><a href="#menu">Back to top</a></p><div id="Linux"></div><p>###åœ¨Linuxæˆ–OS Xä¸Šè®¾ç½®SSHä½¿ç”¨å…¬é’¥</p><ol><li>ä½¿ç”¨å‘½ä»¤è¡Œçš„SSHåˆ›å»ºä¸€å¯¹Keyï¼ŒåŠ å¯†ç®—æ³•å¯ä»¥æ˜¯DSAæˆ–è€…RSAï¼š</li></ol><ul><li>åˆ›å»ºDSA Keyï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</li></ul><pre><code class="bash">ssh-keygen -t dsa</code></pre><ul><li>åˆ›å»ºRSA Keyï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</li></ul><pre><code class="bash">ssh-keygen -t rsa</code></pre><ol start="2"><li><p>æ¥ä¸‹æ¥ssh-keygenä¼šæé†’ä½ æä¾›ä¸€ä¸ªæ–‡ä»¶åæ¥å‚¨å­˜keyæ–‡ä»¶ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªå¯†ç æ¥ä¿æŠ¤ä½ çš„ç§é’¥ã€‚</p><ul><li><p>æ–‡ä»¶åï¼šå¦‚æœä½ è¦ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶åï¼ˆå’Œè·¯å¾„ï¼‰çš„è¯ï¼Œç›´æ¥å›è½¦å°±å¥½äº†ã€‚å¦‚æœä½ æƒ³æŒ‡å®šæ–‡ä»¶åï¼ˆå’Œè·¯å¾„ï¼‰çš„è¯ï¼Œå°±è¾“å…¥è·¯å¾„å¹¶å›è½¦ã€‚<br>  ä½†æ˜¯å¾ˆå¤šè¿œç¨‹ä¸»æœºè®¾ç½®ä¸ºåªæ¥å—ä½¿ç”¨é»˜è®¤è·¯å¾„å’Œé»˜è®¤æ–‡ä»¶åçš„ç§é’¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè¦ä½¿ç”¨å…¶ä»–æ–‡ä»¶åçš„ç§é’¥ï¼Œå°±è¦åšä¸€ç‚¹ç‚¹è®¾ç½®äº†ï¼Œä¸‹æ–‡ä¼šæœ‰ä»‹ç»ã€‚</p></li><li><p>å¯†ç ï¼šè¾“å…¥ä¸å°‘äº5ä¸ªå­—ç¬¦çš„å¯†ç ï¼Œç„¶åå›è½¦ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨å¯†ç ï¼Œåˆ™å¯ä»¥ç›´æ¥å›è½¦ã€‚<br>  <em>UITSå¼ºçƒˆå»ºè®®ä½¿ç”¨å¯†ç æ¥ä¿æŠ¤ä½ çš„ç§é’¥ã€‚å¦‚æœä¸ä½¿ç”¨å¯†ç çš„è¯ï¼Œä»»ä½•èƒ½è®¿é—®ä½ ç”µè„‘çš„äººéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªç§é’¥æ¥è¿›è¡Œè¿œç¨‹ä¸»æœºçš„ç™»å½•ã€‚</em></p></li></ul><p> ä½ çš„ç§é’¥æŒ‰ç…§ä½ çš„è¾“å…¥ä¿å­˜åœ¨ç›¸åº”çš„ä½ç½®ï¼ˆ<code>~/.ssh/id_rsa</code>æˆ–è€… <code>~/.ssh/my_ssh_key</code>ï¼‰ã€‚<br> è€Œç›¸å¯¹åº”çš„å…¬é’¥ä¹Ÿä¼šä¿å­˜åœ¨ä¸ç§é’¥ç›¸åŒçš„ä½ç½®ï¼Œå¹¶ä¸”ä¼šåœ¨ç§é’¥çš„æ–‡ä»¶ååé¢åŠ ä¸€ä¸ª.pubçš„åç¼€ï¼ˆ<code>~/.ssh/id_rsa.pub</code>æˆ–è€… <code>~/.ssh/my_ssh_key.pub</code>ï¼‰ã€‚</p></li><li><p>ä½¿ç”¨SFTPæˆ–è€…SCPå°†å…¬é’¥æ‹·è´åˆ°è¿œç¨‹ä¸»æœºä¸Šã€‚ä¾‹å¦‚ï¼š</p><pre><code class="bash">scp ~/.ssh/id_rsa.pub serious@cy198706.com:  // ä¸è¦å¿˜è®°åé¢è¿™ä¸ª&quot;`:`&quot;</code></pre><p> æ¥ç€è¾“å…¥ä½ åœ¨è¯¥è¿œç¨‹ä¸»æœºä¸Šçš„ç”¨æˆ·å¯†ç ï¼Œè®¤è¯é€šè¿‡ä¹‹åï¼Œå…¬é’¥å°±ä¼šè¢«æ‹·è´åˆ°è¿œç¨‹ä¸»æœºä½ çš„homeç›®å½•ä¸‹ã€‚</p></li><li><p>ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•è¿œç¨‹ä¸»æœºã€‚<br> <em>å¦‚æœä½ æ²¡æœ‰æƒé™ç™»å½•è¿œç¨‹ä¸»æœºï¼Œé‚£ä¹ˆä½ éœ€è¦è”ç³»ç½‘ç»œç®¡ç†å‘˜æ¥å¸®ä½ åˆ›å»º</em><code>~/.ssh/authorized_keys</code><em>æ–‡ä»¶ã€‚</em></p></li><li><p>å¦‚æœä½ çš„è¿œç¨‹ä¸»æœºä¸­æ²¡æœ‰<code>~/.ssh/authorized_keys</code>æ–‡ä»¶ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªï¼š</p><pre><code class="bash">mkdir -p ~/.ssh  touch ~/.ssh/authorized_keys</code></pre><p> <em>å¦‚æœå·²æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨</em></p></li><li><p>å°†æ­¥éª¤3ä¸­æ‹·è´è¿‡æ¥çš„å…¬é’¥æ–‡ä»¶ï¼ˆ<code>~/id_rsa.pub</code>ï¼‰çš„å†…å®¹å†™å…¥ <code>~/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ã€‚</p><pre><code class="bash">cat ~/id_rsa.pub &gt; ~/.ssh/authorized_keys</code></pre><p> ç„¶åæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å†™å…¥æˆåŠŸï¼š</p><pre><code class="bash">cat ~/.ssh/authorized_keys | more</code></pre></li><li><p>ç°åœ¨å¯ä»¥å®‰å…¨åœ°åˆ é™¤å…¬é’¥æ–‡ä»¶äº†ï¼š</p><pre><code class="bash">rm ~/id_rsa.pub</code></pre></li><li><p>ä½ å¯ä»¥åœ¨å…¶ä»–çš„ä¸»æœºä¸Šä¹Ÿæ·»åŠ è¿™ä¸ªå…¬é’¥ï¼Œåªéœ€è¦é‡å¤3-7æ­¥éª¤å°±å¯ä»¥å•¦ã€‚</p></li><li><p>ç°åœ¨ä½ åº”è¯¥å¯ä»¥ä½¿ç”¨SSHç™»å½•åˆ°è¿œç¨‹ä¸»æœºäº†ã€‚ç™»å½•çš„ä¸»æœºæ˜¯<a href="http://cy198706.com/">cy198706.com</a>ï¼Œç™»å½•æ—¶çš„ç”¨æˆ·åæ˜¯seriousï¼Œç™»å½•æ‰€ç”¨çš„ç”µè„‘å°±æ˜¯å­˜æœ‰ä½ åˆšæ‰åˆ›å»ºçš„ç§é’¥çš„è¿™å°ç”µè„‘ã€‚</p><p> å¦‚æœä½ åˆšæ‰åˆ›å»ºç§é’¥æ—¶ä½¿ç”¨å¯†ç ä¿æŠ¤äº†ï¼Œé‚£ä¹ˆè¿œç¨‹ä¸»æœºä¼šè¦æ±‚ä½ åœ¨SSHæ—¶è¾“å…¥å¯†ç ï¼ˆè¯¥å¯†ç å¹¶ä¸ä¼šè¢«ä¼ è¾“åˆ°è¿œç¨‹ä¸»æœºï¼Œåªåšæœ¬åœ°éªŒè¯ï¼‰ï¼š</p><pre><code class="bash">[serious@desktop ~]$ ssh serious@cy198706.comEnter passphrase for key &#39;~/.ssh/id_dsa&#39;: Last login: Fri Jul 24 09:23:17 2015 from serious.somewhere.org</code></pre><p> å¦‚æœä½ åˆšæ‰åœ¨åˆ›å»ºç§é’¥æ—¶æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶åï¼ˆæˆ–è·¯å¾„ï¼‰ï¼Œåˆ™ä½ éœ€è¦ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•æ¥è¿›è¡ŒSSHï¼š</p><ul><li>åœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥-iå‚æ•°ï¼Œå¹¶æŒ‡å®šç§é’¥çš„è·¯å¾„ã€‚ä¾‹å¦‚ä½ åˆšæ‰æŠŠç§é’¥å­˜åœ¨äº†<code>~/.ssh/mykeys/my_host</code>ï¼Œå¹¶è¦ä½¿ç”¨è¿™ä¸ªç§é’¥æ¥è¿›è¡ŒSSHçš„è¯ï¼š</li></ul><pre><code class="bash">  ssh -i ~/.ssh/mykeys/myhost serious@cy198706.com</code></pre><ul><li>ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚<br>SSHä¼šä¾æ¬¡ä»ä»¥ä¸‹å‡ å¤„è¯»å–é…ç½®ä¿¡æ¯ï¼š<ol><li>å‘½ä»¤è¡Œå‚æ•°</li><li>~/.ssh/configï¼ˆä¹Ÿè®¸ä¸å­˜åœ¨ï¼‰</li><li>/etc/ssh/ssh_configä¸¤ä¸ªæ–‡ä»¶ä¸­è¯»å–é…ç½®ä¿¡æ¯</li></ol></li></ul><p> SSHé…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªåŒ…å«å…³é”®è¯å’Œå‚æ•°çš„æ–‡æœ¬æ–‡ä»¶ã€‚è¦æŒ‡å®šè¿æ¥æŸå°è¿œç¨‹ä¸»æœºæ—¶è¦ä½¿ç”¨å“ªä¸ªç§é’¥ï¼Œåªéœ€è¦ä½¿ç”¨æ–‡ä»¶ç¼–è¾‘å™¨æ·»åŠ ä¸€æ¡è®°å½•å³å¯ã€‚</p><p> ä¾‹å¦‚ï¼Œè¦è¿æ¥åˆ°<a href="http://cy198706.com/">cy198706.com</a>ï¼ŒåŒæ—¶ä½¿ç”¨<code>~/.ssh/mykeys/cy_host</code>è¿™ä¸ªç§é’¥ï¼Œåˆ™éœ€è¦åœ¨ <code>~/.ssh/config</code>ï¼ˆå¦‚æœæ²¡æœ‰è‡ªè¡Œåˆ›å»ºï¼‰æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œï¼š</p><pre><code class="bash">Host cy198706.com IdentityFile ~/.ssh/mykeys/cy_host</code></pre><p> ä¿å­˜æ–‡ä»¶ä¹‹åï¼ŒSSHå°±ä¼šåˆ©ç”¨è¿™ä¸ªè§„åˆ™æ¥è®¿é—®æŒ‡å®šçš„ä¸»æœºã€‚</p><p> ä½ ä¹Ÿå¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ï¼š</p><pre><code class="bash">   Host host1.cy198706.comIdentityFile ~/.ssh/mykeys/cy_host1  Host host2.cy198706.comIdentityFile ~/.ssh/mykeys/cy_host2  Host host3.cy198706.comIdentityFile ~/.ssh/mykeys/cy_host3</code></pre><p> ç”šè‡³å¯ä»¥ä½¿ç”¨é€šé…ç¬¦<code>*</code>æ¥æŒ‡å®šè§„åˆ™ï¼š</p><pre><code class="bash">  Host *.cy198706.comIdentityFile ~/.ssh/mykeys/cy_host</code></pre><p> è¦æƒ³å¾—çŸ¥æ›´å¤šå…³äºSSHé…ç½®æ–‡ä»¶çš„ç”¨æ³•ï¼ŒæŸ¥çœ‹<a href="https://kb.iu.edu/d/afjm">å¸®åŠ©é¡µé¢</a>ï¼Œæˆ–è€…<code>man ssh_config</code>ã€‚</p></li></ol><p><a href="#menu">Back to top</a></p><div id="Windows"></div><p>###åœ¨Windowsä¸Šä½¿ç”¨PuTTYè®¾ç½®SSHä½¿ç”¨å…¬é’¥</p><p><em>PuTTYå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œè¿˜æœ‰ç”¨æ¥ç”Ÿæˆkeyçš„PuTTYgenå·¥å…·ï¼Œä»¥åŠPageant SSHè®¤è¯ä»£ç†å·¥å…·ï¼Œè¿˜æœ‰PuTTY SCPï¼ŒPutty SFTPå·¥å…·éƒ½æ˜¯æ‰“åŒ…åœ¨ä¸€èµ·ä¸‹è½½çš„ã€‚æ‰“åŒ…ç‰ˆå¯ä»¥åœ¨<a href="http://the.earth.li/~sgtatham/putty/latest/x86/putty.zip">è¿™å„¿</a>ä¸‹è½½åˆ°ã€‚å®‰è£…ç‰ˆå¯ä»¥åœ¨<a href="http://the.earth.li/~sgtatham/putty/latest/x86/putty-0.64-installer.exe">è¿™å„¿</a>ä¸‹è½½åˆ°ã€‚</em></p><p><em>å¢™å†…çš„åŒå­¦ä½ ä»¬æœ‰ç¦äº†ï¼Œè¯¥ç½‘ç«™å·²è¢«å¢™å¾—ä½“æ— å®Œè‚¤ï¼Œæˆ‘ä¸Šä¼ åˆ°äº†<a href="http://pan.baidu.com/s/1eQpmNAE">åº¦å¨˜ç½‘ç›˜</a>æä¾›ä¸‹è½½ã€‚</em></p><p><em>ä¸‹è½½å®Œæˆåéƒ½æœ‰è¿™äº›æ–‡ä»¶ï¼š</em></p><figure>  <img src="/images/putty1.png" alt="PuTTY"></figure><ol><li><p>æ‰“å¼€PuTTYgenï¼Œå¦‚å›¾æ‰€ç¤º</p><figure><img src="/images/putty2.png" alt="PuTTY"></figure></li><li><p>åœ¨ä¸‹æ–¹çš„<code>Parameters</code>åŒºåŸŸï¼Œå¯ä»¥é€‰æ‹©<code>SSH-2 RSA</code>æˆ–è€…<code>SSH-2 DSA</code>åŠ å¯†æ–¹å¼ã€‚<code>Number of bits in a generated key</code>å‚æ•°ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥ã€‚</p></li><li><p>ç‚¹å‡»<code>Generate</code>ï¼Œä¸Šæ–¹ä¼šå‡ºç°ä¸€ä¸ªè¿›åº¦æ¡ï¼Œå¹¶ä¸”æç¤ºä½ åœ¨ç©ºç™½åŒºåŸŸç§»åŠ¨é¼ æ ‡ï¼ˆåˆ«ç§»å‡ºå»äº†ï¼ëˆˆ_ëˆˆï¼‰ï¼Œå®ƒå°±ä¼šéšæœºç”Ÿæˆä¸€å¯¹keyã€‚ç„¶åå…¬é’¥å°±ä¼šæ˜¾ç¤ºåœ¨ä¸Šæ–¹çš„æ¡†é‡Œã€‚å¦‚å›¾æ‰€ç¤ºã€‚</p><figure><img src="/images/putty3.png" alt="PuTTY"></figure></li><li><p>åœ¨<code>Key passphrase</code>å’Œ<code>Confirm passphrase</code>è¾“å…¥æ¡†ä¸­ï¼Œè¾“å…¥ä¸€ä¸ªå¯†ç æ¥ä¿æŠ¤ä½ çš„ç§é’¥ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸è¾“å…¥ã€‚</p></li></ol><p><em>UITSå¼ºçƒˆå»ºè®®ä½¿ç”¨å¯†ç æ¥ä¿æŠ¤ä½ çš„ç§é’¥ã€‚å¦‚æœä¸ä½¿ç”¨å¯†ç çš„è¯ï¼Œä»»ä½•èƒ½è®¿é—®ä½ ç”µè„‘çš„äººéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªç§é’¥æ¥è¿›è¡Œè¿œç¨‹ä¸»æœºçš„ç™»å½•ã€‚</em></p><ol start="5"><li><p>ç‚¹å‡»ä¸‹æ–¹<code>Save public key</code>ï¼ŒæŒ‡å®šå…¬é’¥çš„åç§°ï¼Œä¿å­˜å…¬é’¥ã€‚</p></li><li><p>ç‚¹å‡»ä¸‹æ–¹<code>Save private key</code>ï¼ŒæŒ‡å®šç§é’¥çš„åç§°ï¼Œä¿å­˜ç§é’¥ã€‚<br> <em>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨å¯†ç ä¿æŠ¤ç§é’¥çš„è¯ï¼Œè¿™æ—¶PuTTYgenä¼šæé†’ä½ æ˜¯å¦ç¡®å®šä¸ä½¿ç”¨å¯†ç ä¿æŠ¤ã€‚</em></p></li><li><p>ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•è¿œç¨‹ä¸»æœºã€‚<br> <em>å¦‚æœä½ æ²¡æœ‰æƒé™ç™»å½•è¿œç¨‹ä¸»æœºï¼Œé‚£ä¹ˆä½ éœ€è¦è”ç³»ç½‘ç»œç®¡ç†å‘˜æ¥å¸®ä½ åˆ›å»º</em><code>~/.ssh/authorized_keys</code><em>æ–‡ä»¶ã€‚</em></p></li><li><p>å¦‚æœä½ çš„è¿œç¨‹ä¸»æœºä¸­æ²¡æœ‰<code>~/.ssh/authorized_keys</code>æ–‡ä»¶ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªï¼š</p><pre><code class="bash">mkdir -p ~/.ssh  touch ~/.ssh/authorized_keys</code></pre><p> <em>å¦‚æœå·²æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨</em></p></li><li><p>åœ¨ä½ çš„ç”µè„‘ä¸Šï¼Œåœ¨PuTTYgenä¸­ï¼Œå°†å…¬é’¥çš„å†…å®¹æ‹·è´ä¸€ä¸‹ï¼Œç„¶åï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸­æŠŠå†…å®¹å¤åˆ¶åˆ°<code>~/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ã€‚</p></li><li><p>æ‰“å¼€Pageant SSHè®¤è¯ä»£ç†å·¥å…·ã€‚è¿™ç©æ„ä¼šåœ¨åå°è¿è¡Œï¼Œä½ åªèƒ½åœ¨ç³»ç»Ÿæ‰˜ç›˜åŒºåŸŸçœ‹åˆ°å®ƒã€‚å³å‡»æ‰˜ç›˜åŒºåŸŸä¸­çš„å›¾æ ‡ï¼Œé€‰æ‹©Add Keyï¼Œç„¶åæ‰¾åˆ°ä½ åˆšæ‰ä¿å­˜çš„ç§é’¥ï¼Œé€‰æ‹©ä¹‹ã€‚</p><p>å¦‚æœä½ åœ¨åˆ›å»ºç§é’¥æ—¶ä½¿ç”¨äº†å¯†ç ä¿æŠ¤ï¼ŒPageantä¼šè¯¢é—®ä½ çš„å¯†ç æ˜¯ä»€ä¹ˆã€‚</p></li><li><p>ç°åœ¨Pageantä¼šæŠŠç§é’¥ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“ä½ ä½¿ç”¨PuTTYè®¿é—®è¿œç¨‹ä¸»æœºæ—¶ï¼Œè¯¥ç§é’¥å°±ä¼šèµ·ä½œç”¨ã€‚</p></li><li><p>æ‰“å¼€PuTTYå®¢æˆ·ç«¯ã€‚å¦‚å›¾ã€‚</p><figure><img src="/images/putty4.png" alt="PuTTY"></figure><ul><li><p><code>Session</code>é¡µé¢çš„<code>Host Name (or IP address)</code>è¾“å…¥æ¡†ä¸­ï¼Œè¾“å…¥è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·åå’Œåœ°å€ï¼Œä¾‹å¦‚<code>serious@cy198706.com</code>ã€‚</p></li><li><p>åœ¨<code>Connection type</code>ä¸­ï¼Œé€‰æ‹©SSH</p></li><li><p>åœ¨å·¦ä¾§åˆ—è¡¨çš„<code>Category</code>ä¸­ï¼Œæ‰¾åˆ°<code>Auth</code>é¡µé¢ï¼ˆ<code>Connection &gt; SSH &gt; Auth</code>ï¼‰ã€‚åœ¨<code>Auth</code>é¡µé¢çš„<code>Authentication methods</code>åŒºåŸŸä¸­ï¼Œå‹¾é€‰<code>Attempt authentication using Pageant</code>ã€‚</p><figure><img src="/images/putty5.png" alt="PuTTY"></figure></li><li><p>è¿”å›<code>Session</code>é¡µé¢ï¼Œåœ¨<code>Saved Sessions</code>åŒºåŸŸä¸­è¾“å…¥ä¸€ä¸ªåç§°ç”¨æ¥ä¿å­˜è¿™å¥—é…ç½®ï¼Œç„¶åç‚¹å‡»ä¿å­˜ã€‚</p></li><li><p>ç‚¹å‡»<code>Open</code>è¿æ¥åˆ°è¿œç¨‹ä¸»æœºã€‚å½“Pageantåœ¨åå°è¿è¡Œæ—¶ï¼ŒPuTTYå°†ä¼šè‡ªåŠ¨è·å¾—ç§é’¥å¹¶ä½¿ç”¨ï¼Œåœ¨ç™»å½•åˆ°è¿œç¨‹ä¸»æœºçš„è¿‡ç¨‹ä¸­ä¸ä¼šå†æ¬¡è¯¢é—®ç§é’¥çš„ä¿æŠ¤å¯†ç ä¹‹ç±»çš„ä¿¡æ¯ã€‚</p></li></ul><p><em>åˆ°è¿™å„¿é…ç½®åŸºæœ¬å®Œæˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡åœ¨å¼€æœºä¹‹åï¼Œå¦‚æœè¦ä½¿ç”¨Pageantï¼Œå°±å¿…é¡»æ‰‹åŠ¨å¯åŠ¨å®ƒï¼Œæ·»åŠ ç§é’¥ï¼Œå†ä½¿ç”¨PuTTYã€‚å½“ç„¶ä¹Ÿæœ‰å¿«æ·çš„åŠæ³•ï¼Œä¸‹æ–‡å°†ä¼šç»§ç»­ä»‹ç»ã€‚</em></p></li><li><p>æ‰“å¼€â€œå¯åŠ¨â€æ–‡ä»¶å¤¹ï¼š</p><ul><li><p>Windows 8ä¸‹ï¼ŒæŒ‰Windows+Rï¼Œè¾“å…¥<code>shell:startup</code>åå›è½¦å°±æ‰“å¼€äº†ã€‚</p></li><li><p>Windows 7ä¸‹ï¼Œä»å¼€å§‹èœå•ï¼Œç‚¹å‡»æ‰€æœ‰ç¨‹åºï¼Œæ‰¾åˆ°å¯åŠ¨èœå•ï¼Œå³å‡»æ‰“å¼€ã€‚</p></li><li><p>æˆ–è€…ç›´æ¥å¯¼èˆªåˆ°â€œå¯åŠ¨â€æ–‡ä»¶å¤¹ï¼š</p><pre><code class="bash">C:\Users\your_name\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code></pre></li></ul></li><li><p>åœ¨æ–‡ä»¶å¤¹ä¸­å³é”®æ–°å»ºä¸€ä¸ªå¿«æ·æ–¹å¼ã€‚ç„¶ååœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†çš„è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ Pageant.exeçš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æµè§ˆæ‰¾åˆ°å®ƒã€‚æ¥ç€åœ¨è¯¥è·¯å¾„çš„åé¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œè¾“å…¥ç§é’¥çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼š</p><pre><code class="bash">&quot;C:\Program Files (x86)\PuTTY\pageant.exe&quot; &quot;C:\Users\your_name\ssh_key\putty_private.ppk&quot;</code></pre><p>åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œç»™å¿«æ·æ–¹å¼å–ä¸ªåå­—ï¼Œç‚¹å‡»å®Œæˆã€‚</p><p>è¿™æ ·åœ¨ä»¥åç”µè„‘å¼€æœºä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨åŠ è½½è¯¥ç§é’¥åˆ°Pageantä¸­ï¼Œçœå»äº†æ‰‹åŠ¨å¯åŠ¨çš„éº»çƒ¦ã€‚</p></li></ol><p><a href="#menu">Back to top</a></p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºåŸºç¡€çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSH ä¸ SSH2</title>
      <link href="/2015-07-23/ssh-and-ssh2/"/>
      <url>/2015-07-23/ssh-and-ssh2/</url>
      
        <content type="html"><![CDATA[<p>ä»€ä¹ˆæ˜¯SSHå’ŒSSH2ï¼Ÿçœ‹å®Œè¿™ç¯‡ä½ å°±æ‡‚å•¦ã€‚</p><span id="more"></span><ul><li><p>SSH(Secure Shell)åœ¨ä½ é€šè¿‡ç½‘ç»œç™»å½•åˆ°å¦ä¸€å°è®¡ç®—æœºã€è¿œç¨‹æ‰§è¡Œå‘½ä»¤æˆ–è€…ä¼ è¾“æ–‡ä»¶æ—¶ï¼Œä¸ºä½ æä¾›ä¸€ä¸ªåŠ å¯†çš„é€šé“ã€‚SSHæä¾›ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ä¸»æœºå¯¹ä¸»æœºã€ä¸»æœºå¯¹ç”¨æˆ·çš„è®¤è¯ï¼Œå°±å¦‚åŒç½‘ç»œä¸Šçš„åŠ å¯†é€šä¿¡ä¸€æ ·ã€‚</p></li><li><p>SSH2æ˜¯ä¸€ä¸ªæ›´åŠ å®‰å…¨ã€æœ‰æ•ˆï¼Œç§»æ¤æ€§å¼ºçš„SSHç‰ˆæœ¬ï¼Œå®ƒåŒ…å«SFTPåŠŸèƒ½ã€‚SFTPä¸FTPåŠŸèƒ½ç›¸åŒï¼Œä½†SFTPæ˜¯åŠ å¯†çš„ã€‚åœ¨å°å¼Ÿå®‰é‚£å¤§å­¦ï¼ŒUITS(<a href="https://uits.iu.edu/">University Information Technology Services</a>)å·²å°†å…¶ä¸­å¿ƒç³»ç»Ÿå‡çº§åˆ°äº†SSH2ï¼ˆé€šå¸¸éƒ½ä½¿ç”¨OpenSSHï¼‰ï¼Œå¹¶ä¸”æå€¡ç”¨æˆ·éƒ½ä½¿ç”¨SSH2æ¥è¿›è¡Œç½‘ç»œåŠ å¯†é€šè®¯ã€‚</p></li></ul><p>Mac OS X é›†æˆäº†OpenSSHã€‚åœ¨Windowsä¸‹ï¼Œåˆ™éœ€è¦ä¸‹è½½ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„SSHå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚SecureCRTå’ŒPuttyã€‚</p><p>å½“ç¬¬ä¸€æ¬¡è¿æ¥åˆ°æŸå°ä¸»æœºæ—¶ï¼ŒSSHå°†ç»™ä½ æä¾›ä¸»æœºçš„æŒ‡çº¹ï¼Œå¹¶ä¸”è¯¢é—®ä½ æ˜¯å¦è¦å°†è¿™ä¸ªæ–°çš„æŒ‡çº¹å’Œä¸»æœºçš„è·¯å¾„å­˜å‚¨åˆ°æœ¬åœ°æ•°æ®åº“ä¸­ã€‚åœ¨åŒæ„ä¹‹å‰ï¼Œä½ åº”è¯¥å¥½å¥½æ¯”å¯¹ä¸€ä¸‹è¿™ä¸ªæŒ‡çº¹æ˜¯å¦ä¸ä½ ä¹‹å‰å¾—çŸ¥çš„æŒ‡çº¹ï¼ˆè°ç®¡ä½ æ€ä¹ˆå¾—çŸ¥çš„ï¼Œæ‰“ç”µè¯å‘—ï¼‰ç›¸åŒï¼Œä»¥é¿å…è¿æ¥åˆ°ä¸€ä¸ªæ±Ÿæ¹–éª—å­çš„ä¸»æœºä¸Šã€‚è¾“å…¥<code>yes</code>ä¹‹åï¼Œè¿™æ¡æ¶ˆæ¯å°±ä¸ä¼šå†å‡ºç°äº†ã€‚</p><p>æ¯”éªŒè¯å¯†ç æ›´å¥½çš„ï¼ŒSSH2èƒ½ä½¿ç”¨å…¬ç”¨å¯†é’¥æ¥è¿›è¡Œä¸»æœºçš„è®¤è¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¿æ¥åˆ°æŸå°è¿œç¨‹ä¸»æœºï¼Œåç§°ä¸ºhost.cy198706.com ï¼ˆå½“ç„¶æ­£åœ¨ä½¿ç”¨SSH2ï¼‰ï¼ŒSSH2ä¼šä½¿ç”¨è¿™å¥—æœºåˆ¶æ¥éªŒè¯è¿™å°ä¸»æœºæ˜¯å¦å¯ç™»å½•ã€‚å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥åœ¨ç™»å½•ä¸»æœºæ—¶ï¼Œè®¾ç½®SSH2ä½¿ç”¨å…¬é’¥æ¥è¿›è¡Œè®¤è¯ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯†ç è®¤è¯ã€‚å¦‚ä½•è®¾ç½®ï¼Œè¯·çœ‹<a href="/ssh-using-public-key/">å¦‚ä½•è®¾ç½®SSHä½¿ç”¨å…¬é’¥è®¤è¯ç™»å½•ä¸»æœº</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºåŸºç¡€çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨antä¸­ä½¿ç”¨execæ›´æ–°ç‰ˆæœ¬å·</title>
      <link href="/2015-07-17/ant-with-exec/"/>
      <url>/2015-07-17/ant-with-exec/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨Androidä¸­ç”¨Antè‡ªåŠ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªè¦æ±‚ï¼Œæ˜¯ä»Gitè·å–ç‰ˆæœ¬æäº¤çš„æ€»æ¬¡æ•°ï¼ŒåŠ ä¸Šæœ€åˆç‰ˆæœ¬çš„ç‰ˆæœ¬å·ï¼Œåšä¸ºæœ€æ–°ç‰ˆæœ¬çš„ç‰ˆæœ¬å·ã€‚</p><p>èµ·åˆæ˜¯å†™äº†ä¸€ä¸ªshellè„šæœ¬æ¥åšè¿™ä»¶äº‹ã€‚</p><pre><code class="sh">#!/bin/bashcd /home/serious/Workspace/client/count=`git rev-list origin/master --count`result=2.0.$countecho $resultsed -i &quot;s/android:versionName=\&quot;2.0.*\&quot;/android:versionName=\&quot;$&#123;result&#125;\&quot;/g&quot; AndroidManifest.xml</code></pre><p>ä½†æ˜¯è¿™ä¹ˆä¸€æ¥ï¼Œæ‰“åŒ…ä¹‹å‰å°±ä¼šå¤šä¸€ä¸ªæ­¥éª¤ã€‚æˆ‘è¿™ä¹ˆæ‡’çš„äººï¼Œæ€ä¹ˆèƒ½å…è®¸è¿™ç§äº‹æƒ…å‘ç”Ÿï¼Ÿæ€ä¹ˆèƒ½åä»¥å¾…æ¯™ï¼Ÿ</p><p>äºæ˜¯å°±ç¿»çœ‹äº†antçš„æ–‡æ¡£ï¼Œæ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p><span id="more"></span><p>åœ¨build.xmlä¸­ï¼ŒåŠ å…¥è¿™ä¹ˆä¸€æ®µï¼š</p><pre><code class="xml">&lt;target name=&quot;versioncode&quot;&gt;    &lt;exec executable=&quot;sh&quot;&gt;        &lt;arg value=&quot;update_vercode.sh&quot; /&gt;    &lt;/exec&gt;&lt;/target&gt;</code></pre><p>æå®šã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ ·è¿˜å¤šäº†ä¸ªshæ–‡ä»¶å•Šã€‚æˆ‘ä½œä¸ºä¸€ä¸ªå¹¶ä¸æ˜¯å¤„å¥³åº§çš„æ´ç™–ï¼Œæ€ä¹ˆèƒ½å…è®¸è¿™ç§äº‹æƒ…å‘ç”Ÿï¼Ÿæ€ä¹ˆèƒ½åä»¥å¾…æ¯™ï¼Ÿ</p><p>äºæ˜¯æ‰¾åˆ°äº†ä¸‹é¢çš„è§£å†³æ–¹æ¡ˆï¼š</p><pre><code class="xml">&lt;target name=&quot;versioncode&quot;&gt;        &lt;exec executable=&quot;sh&quot; outputproperty=&quot;v_name&quot;&gt;            &lt;arg value=&quot;-c&quot; /&gt;            &lt;arg value=&quot;git rev-list origin/master --count&quot; /&gt;        &lt;/exec&gt;        &lt;echo&gt;Revision (app): $&#123;v_name&#125;&lt;/echo&gt;        &lt;replaceregexp file=&quot;AndroidManifest.xml&quot; match=&#39;android:versionName=&quot;2.0.*&quot;&#39; replace=&#39;android:versionName=&quot;2.0.$&#123;v_name&#125;&quot;&#39; /&gt;&lt;/target&gt;</code></pre><p>Antä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ—¶ï¼ˆæ¯”å¦‚ä¸Šæ–‡çš„gitå‘½ä»¤å’Œshå‘½ä»¤ï¼‰ï¼Œåœ¨Windowsä¸‹å’Œåœ¨Linuxä¸‹çš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚</p><ul><li>Windows</li></ul><pre><code class="xml">&lt;target name=&quot;help&quot;&gt;  &lt;exec executable=&quot;cmd&quot;&gt;    &lt;arg value=&quot;/c&quot;/&gt;    &lt;arg value=&quot;ant.bat&quot;/&gt;    &lt;arg value=&quot;-p&quot;/&gt;  &lt;/exec&gt;&lt;/target&gt;</code></pre><ul><li>Linux</li></ul><pre><code class="xml">&lt;target name=&quot;help&quot;&gt;  &lt;exec executable=&quot;sh&quot;&gt;    &lt;arg value=&quot;-c&quot;/&gt;    &lt;arg value=&quot;ant.sh&quot;/&gt;    &lt;arg value=&quot;-p&quot;/&gt;  &lt;/exec&gt;&lt;/target&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼±è€…åªä¼šæŠ±æ€¨ï¼Œå¼ºè€…æ€»ä¼šæ”¹å˜</title>
      <link href="//gabby/%25e5%25bc%25b1%25e8%2580%2585%25e5%258f%25aa%25e4%25bc%259a%25e6%258a%25b1%25e6%2580%25a8%25ef%25bc%258c%25e5%25bc%25ba%25e8%2580%2585%25e6%2580%25bb%25e4%25bc%259a%25e6%2594%25b9%25e5%258f%2598/"/>
      <url>//gabby/%25e5%25bc%25b1%25e8%2580%2585%25e5%258f%25aa%25e4%25bc%259a%25e6%258a%25b1%25e6%2580%25a8%25ef%25bc%258c%25e5%25bc%25ba%25e8%2580%2585%25e6%2580%25bb%25e4%25bc%259a%25e6%2594%25b9%25e5%258f%2598/</url>
      
        <content type="html"><![CDATA[<p>ç°åœ¨ï¼Œæ¯å¤©ä¸­åˆï¼Œåƒé¥­çš„æ—¶å€™ï¼Œæˆ‘è·Ÿä¸‰ä¸ªåŒäº‹æ˜¯åœ¨ä¸€èµ·çš„ã€‚è€Œå™©æ¢¦ä¹Ÿå°±å¼€å§‹äº†ã€‚</p><p>æˆ‘ä»¬å››ä¸ªäººï¼Œæˆ‘æ˜¯å±±ä¸œçš„ï¼Œä¸¤ä¸ªæ¹–åŒ—çš„ï¼Œä¸€ä¸ªæ¹–å—çš„ã€‚æ¹–åŒ—çš„ä¸¤ä¸ªæš‚ä¸”å‘½åä¸º<strong>J</strong>å›å’Œ<strong>H</strong>å›ï¼Œæ¹–å—çš„å‘½åä¸º<strong>L</strong>å›ã€‚<span id="more"></span></p><img alt="" src="http://wenwen.soso.com/p/20100404/20100404173452-1536354237.jpg" style="width: 500px; height: 375px;" /><p><strong>J</strong>å›æ˜¯æ¯”è¾ƒæ­£å¸¸çš„é‚£ç§äººï¼Œå†œæ‘å‡ºèº«ï¼Œæœ‰å››ä¸ªå§å§ã€‚å¯¹å„ç§äº‹æƒ…éƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œä¸éšå¤§æµï¼Œå–œæ¬¢å„ç§å„æ ·çš„æ±½è½¦ï¼Œè€Œä¸”æå…¶æ¸…æ¥šæ¯ç§é…ç½®çš„ä»·æ ¼ï¼Œå–œå¥½å†›äº‹ï¼Œå–œå¥½ç»æµï¼Œå£é½¿æœ‰ç‚¹ä¸æ¸…æ¥šï¼Œè„¸ä¸Šçš„é’æ˜¥ç—˜ä¹Ÿæ— è§†è¿™å®¶ä¼™å·²ç»23äº†ï¼Œå™Œå™Œåœ°å¾€å¤–é•¿ã€‚æ€»ä¹‹ï¼Œæ˜¯ä¸ªå¾ˆå¥½ç›¸å¤„çš„äººã€‚</p><p><strong>L</strong>å›æ˜¯ä¸ªç‰¹åˆ«å–œæ¬¢ç§€ä¸‹é™çš„äººã€‚æ ‡å‡†90åï¼Œè‡ªä»ä»–åŠ å…¥äº†æˆ‘ä»¬ï¼Œæˆ‘ä»¬éƒ½æ„Ÿè§‰ï¼Œæˆ‘ä»¬å°ç»„çš„å¹³å‡æ™ºå•†è¢«æ‹‰åˆ°äº†ä¸€ä¸ªè‚‰çœ¼ä¸å¯è§çš„æ°´å¹³ã€‚å¹³æ—¶æˆ‘ä»¬ä»¨éƒ½å–œæ¬¢è°ƒæˆä»–ï¼Œä»ä»–èº«ä¸Šçš„å›´å·¾ï¼Œåˆ°ä»–æ·±ä¸å¯æµ‹çš„æ™ºå•†ã€‚æˆ‘æ„Ÿè§‰ï¼Œæ¯ä¸€ä¸ªå››äººç»„é‡Œï¼Œæ€»éœ€è¦è¿™ä¹ˆä¸€ä¸ªäººï¼Œä¹Ÿæ€»ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªäººï¼Œè¿™æ ·åœ¨è·¯ä¸Šï¼Œä¸è‡³äºå†·åœºã€‚</p><p><img src="http://www.xlabc.com/upfiles/allimg/090624/1431250.jpg" style="margin-left: 10px; float: right;" /><strong>H</strong>å›æ˜¯ä¸ªè®©æˆ‘ç‰¹åˆ«æœ‰æ„Ÿè§¦çš„äººï¼Œçœ‹åˆ°ä»–ï¼Œæˆ‘å°±çŸ¥é“ï¼Œæˆ‘ä»¥åä¸èƒ½åšå“ªäº›äº‹äº†ã€‚å¹¶ä¸æ˜¯è¯´ä»–å¤šä¹ˆå¤šä¹ˆä¸åƒæ ·ï¼Œè€Œæ˜¯ï¼Œåœ¨å¤–äººé¢å‰ï¼Œåƒè¿™æ ·è¡¨ç°ï¼Œåªèƒ½è¢«åˆ«äººæ— è§†ï¼Œå¹¶ä¸”åœ¨å¿ƒé‡Œéª‚ä¸€å¥&ldquo;å‚»é€¼&rdquo;ã€‚</p><p>ä»–çš„æŠ€èƒ½å°±æ˜¯&ldquo;æŠ±æ€¨&rdquo;ï¼Œå¯¹ä»»ä½•ä¸€ç‚¹å°äº‹éƒ½èƒ½æŠ±æ€¨ä¸ªæ²¡å®Œæ²¡äº†ï¼Œå•æ‰€æ²¡çº¸äº†ï¼Œæ˜¨å¤©åˆåŠ ç­äº†ï¼Œå‘ç¥¨æŠ¥äº†æ²¡ç»™é’±ï¼Œç°åœ¨ç»“å©šçœŸTMæ—©ï¼Œç”µæ¢¯çœŸå¤Ÿæ…¢çš„ç­‰ç­‰ç­‰ç­‰ï¼Œæ¯å¤©éƒ½ä¼šå¬åˆ°ä»–çš„æŠ±æ€¨ã€‚<br>ä»–çš„å¦ä¸€ä¸ªæŠ€èƒ½æ˜¯&ldquo;å­¤åƒ»&rdquo;ï¼Œå½“å¤§å®¶éƒ½èŠå¤©çš„æ—¶å€™ï¼Œä»–å°±ç‹¬è‡ªè£…é…·ï¼Œç”šè‡³èŠäº†ä¸€ä¼šï¼Œå‘ç°ä»–å±…ç„¶ä¸è§äº†ã€‚å›æ¥é—®&ldquo;å»å“ªäº†&rdquo;ï¼Œä¹Ÿä¸å±å£°ï¼Œçœ‹èµ·æ¥åƒä¸ªæ€¨å¦‡ï¼Œåœ¨æ€¨æˆ‘ä»¬æŠŠä»–æŠ›å¼ƒäº†ã€‚<br>ç¬¬ä¸‰ä¸ªæŠ€èƒ½æ˜¯&ldquo;å£åˆ&rdquo;ï¼Œæ— è®ºä¸­åˆåƒä»€ä¹ˆï¼Œç»å¯¹èƒ½å¬åˆ°ä»–è¯´&ldquo;ä»€ä¹ˆä¸œè¥¿ï¼Œéš¾åƒæ­»äº†&rdquo;ï¼Œç„¶ååƒå¾—å¹²å¹²å‡€å‡€ã€‚æˆ–è€…åœ¨è‡ªå·±çš„èœæ¯”è¾ƒå•ä¸€æ—¶ï¼Œå¤¹åˆ«äººä¸€ç­·å­ï¼Œç„¶åçœ‰å¤´ç´§çš±ï¼Œè¯´&ldquo;è¿™ç§ä¸œè¥¿ä½ ä¹Ÿåƒå¾—ä¸‹&rdquo;ï¼Œæå¾—åˆ«äººå…¨æ— èƒƒå£ã€‚</p><p>ä½†å› ä¸ºæˆ‘æ˜¯åæ¥äººï¼Œç®—æ˜¯&ldquo;æ–°äºº&rdquo;ï¼Œè™½ç„¶å¹´é¾„æ˜¯æœ€å¤§çš„ï¼ˆä¸€ä¸ª90åï¼Œä¸€ä¸ªä¸€è„šè¸åœ¨90é—¨æ§›ä¸Šï¼Œä¸€ä¸ª89å¹´çš„ï¼‰ï¼Œä½†ä¹Ÿæ²¡èµ„æ ¼è¯´åˆ«äººä»€ä¹ˆã€‚å…¶å®æˆ‘ä¹Ÿä¸æƒ³å¯¹ä»–è¯´ä»€ä¹ˆï¼Œæ²¡å¿…è¦å•Šã€‚</p><p>ä»¥å‰æˆ‘ä¹Ÿæ˜¯ä¸ªå¾ˆèƒ½æŠ±æ€¨çš„äººï¼Œå¤§äº‹å°äº‹éƒ½è¦æŠ±æ€¨ä¸€ç•ªï¼Œå¯èƒ½ä¹Ÿçƒ¦åˆ°äº†æˆ‘çš„ä¸€äº›æœ‹å‹ï¼Œä»–ä»¬å¯èƒ½ä¹Ÿæœ‰è·Ÿæˆ‘ç°åœ¨ä¸€æ ·çš„æƒ³æ³•ã€‚ä¸è¿‡åæ¥å‘ç°ï¼ŒæŠ±æ€¨å…¶å®ä»€ä¹ˆä¹Ÿæ”¹å˜ä¸äº†ï¼Œå®‰å®‰å¿ƒå¿ƒåƒä½ çš„é¥­ï¼ŒæˆåŠŸæ¶ˆåŒ–ï¼ŒæˆåŠŸæ’æ³„ï¼Œè¿™å°±ç®—æ˜¯åŠŸå¾·åœ†æ»¡äº†ï¼ŒæŠ±æ€¨æœ‰ä»€ä¹ˆç”¨å‘¢ã€‚</p><p>å¿˜è®°åœ¨å“ªçœ‹åˆ°è¿™å¥è¯äº†ï¼Œ&ldquo;å¼±è€…æŠ±æ€¨å‘½è¿çš„æ— æƒ…,å¼ºè€…æ‰¼ä½å‘½è¿çš„å’½å–‰&rdquo;ã€‚çš„ç¡®æ˜¯è¿™æ ·ï¼ŒæŠ±æ€¨ä¸æ˜¯ä¸å¯ä»¥ï¼Œå¶å°”æŠ±æ€¨ä¸€ä¸‹å¹¶ä¸ä¼šè¡¨ç¤ºä½ è¿™ä¸ªäººæ˜¯ä¸ªåºŸç‰©ï¼Œå› ä¸ºæ²¡æœ‰å“ªä¸ªäººçš„å¿ƒæ€§æ˜¯å®Œç¾çš„ã€‚ä½†æ˜¯å¤©å¤©æŠ±æ€¨ï¼Œå½“æŠ±æ€¨æˆä¸ºä¸€ç§ä¹ æƒ¯ï¼Œå°±ä¼šè¢«å‘½è¿æŠ›å¼ƒã€‚</p><p>æœ‰æ—¶ï¼ŒæŠ±æ€¨çš„æ„Ÿè§‰æŒºä¸é”™ï¼Œå› ä¸ºæˆ‘ä»¬æ€»å–œæ¬¢åš&ldquo;å¯¹&rdquo;çš„ä¸€æ–¹ã€‚æˆ‘ä»¬æ€»æ˜¯ä¸ºè‡ªå·±è¾©è§£ï¼š&ldquo;æ˜¯è¿™ä¸ªäººä¾µçŠ¯äº†æˆ‘&rdquo;ã€&ldquo;æ˜¯é‚£ä¸ªå®¶ä¼™çš„é”™&rdquo;ï¼Œæ®Šä¸çŸ¥æˆ‘ä»¬æ­£ä¸€æ­¥æ­¥æ»‘å…¥æŠ±æ€¨çš„æ³¥æ½­ï¼Œæ­¢æ­¥ä¸å‰ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥é€‰æ‹©ï¼šæ˜¯é™·å…¥è‡ªä»¥ä¸ºæ˜¯çš„æ³¥æ½­ï¼Œè¿˜æ˜¯æ”¾ä¸‹æŠ±æ€¨ç»§ç»­ä¸Šè·¯ï¼Ÿåˆ«å¿˜äº†è‡ªå·±æ´»å¾—æ»‹æ¶¦æ‰æ˜¯å¯¹ä»–äººæœ€å¥½çš„æŠ¥å¤ã€‚</p><p>è¯´çœŸçš„ï¼ŒåŸ‹æ€¨ä¸–ç•Œå¯ä»¥ä¸Šç˜¾ã€‚ä½†åªè¦ä½ æ„¿æ„ï¼Œä½ å°±èƒ½åœæ­¢æŠ±æ€¨çš„æ¸¸æˆã€‚æœ‰æ—¶æˆ‘ä»¬æ²¡æ³•æ”¹æ‰ä¹ æƒ¯ï¼Œå› ä¸ºæˆ‘ä»¬æƒ§æ€•æ”¹å˜ã€‚ä½†è¯·ç›¸ä¿¡åªè¦ä½ æŠ›å¼ƒåŸ‹æ€¨çš„ä¹ æƒ¯ï¼Œä¸€ä¸ªå´­æ–°çš„ä½ ä¾¿è¯ç”Ÿäº†ã€‚ç­”æ¡ˆå’Œæ–¹å‘å°±åœ¨ä½ æ‹¨å¼€äº‘é›¾çš„é‚£ä¸€åˆ¹é‚£ä¾¿å¯ä»¥æ¸…æ¥šçœ‹åˆ°ã€‚</p><p>ç°åœ¨ç¤¾ä¼šå„ç§ç«äº‰æ¿€çƒˆä¸¥é…·ã€å„ç§ææƒ§çš„è”“å»¶çº ç»“ï¼Œè®©æˆ‘ä»¬å˜å¾—å¦‚åˆºçŒ¬èˆ¬&ldquo;å‰‘æ°”åè¶³&rdquo;ï¼šå¯¹å‘¨é­çš„ä¸€åˆ‡æŠ±æ€¨ä¸æ­¢ï¼Œå´æå°‘é™ä¸‹å¿ƒæ¥åçœè‡ªå·±ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´å°±åº”å°†ä¸€åˆ‡è´£ä»»éƒ½æ½ç»™è‡ªå·±ï¼Œè€Œæ˜¯åº”è¯¥æ¥å—ç°å®ï¼Œä»ç»å†ä¸­æˆé•¿ï¼ŒåŸè°…è‡ªå·±ï¼Œä»å¤±è´¥ä¸­é‡æ–°æŒ¯ä½œï¼Œå¹¶åˆ¶å®šä¸‹ä¸€æ­¥çš„è®¡åˆ’ã€‚ä¸ç®¡æ€æ ·ï¼Œæ—¶é—´ä¸ç­‰äººã€‚</p><p>å›½å¤–éƒ½æœ‰ä¸“å®¶ç ”ç©¶å‡ºï¼Œå¬å¤šäº†æŠ±æ€¨ï¼Œä¼šæŸä¼¤æˆ‘ä»¬è‹±æ˜ç¥æ­¦çš„å¤§è„‘çš„ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬è¿œç¦»æŠ±æ€¨å§ã€‚</p><p>æœ‰ä¸€åˆ™å¤è€çš„å¯“è¨€ï¼Œæˆ–è®¸å¯ä»¥ç»™æˆ‘ä»¬ä¸€äº›å¯ç¤ºã€‚</p><blockquote><p>æœ‰ä¸€ä¸ªå¹´è½»çš„å†œå¤«ï¼Œåˆ’ç€å°èˆ¹ï¼Œç»™å¦ä¸€ä¸ªæ‘å­çš„å±…æ°‘è¿é€è‡ªå®¶çš„å†œäº§å“ã€‚é‚£å¤©çš„å¤©æ°”é…·çƒ­éš¾è€ï¼Œå†œå¤«æ±—æµæµƒèƒŒï¼Œè‹¦ä¸å ªè¨€ã€‚ä»–å¿ƒæ€¥ç«ç‡åœ°åˆ’ç€å°èˆ¹ï¼Œå¸Œæœ›èµ¶ç´§å®Œæˆè¿é€ä»»åŠ¡ï¼Œä»¥ä¾¿åœ¨å¤©é»‘ä¹‹å‰èƒ½è¿”å›å®¶ä¸­ã€‚çªç„¶ï¼Œå†œå¤«å‘ç°ï¼Œå‰é¢å¦å¤–ä¸€åªå°èˆ¹ï¼Œæ²¿æ²³è€Œä¸‹ï¼Œè¿é¢å‘è‡ªå·±å¿«é€Ÿé©¶æ¥ã€‚çœ¼è§ç€ä¸¤åªèˆ¹å°±è¦æ’ä¸Šäº†ï¼Œä½†é‚£åªèˆ¹å¹¶æ²¡æœ‰ä¸æ¯«é¿è®©çš„æ„æ€ï¼Œä¼¼ä¹æ˜¯æœ‰æ„è¦æ’ç¿»å†œå¤«çš„å°èˆ¹ã€‚</p><p>&ldquo;è®©å¼€ï¼Œå¿«ç‚¹è®©å¼€ï¼ä½ è¿™ä¸ªç™½ç—´ï¼&rdquo;å†œå¤«å¤§å£°åœ°å‘å¯¹é¢çš„èˆ¹å¼å«é“ã€‚&ldquo;å†ä¸è®©å¼€ä½ å°±è¦æ’ä¸Šæˆ‘äº†ï¼&rdquo;ä½†å†œå¤«çš„å¼å«å®Œå…¨æ²¡ç”¨ï¼Œå°½ç®¡å†œå¤«æ‰‹å¿™è„šä¹±åœ°ä¼å›¾è®©å¼€æ°´é“ï¼Œä½†ä¸ºæ—¶å·²æ™šï¼Œé‚£åªèˆ¹è¿˜æ˜¯é‡é‡åœ°æ’ä¸Šäº†ä»–ã€‚å†œå¤«è¢«æ¿€æ€’äº†ï¼Œä»–å‰å£°æ–¥è´£é“ï¼š&ldquo;ä½ ä¼šä¸ä¼šé©¾èˆ¹ï¼Œè¿™ä¹ˆå®½çš„æ²³é¢ï¼Œä½ ç«Ÿç„¶æ’åˆ°äº†æˆ‘çš„èˆ¹ä¸Šï¼Ÿï¼&rdquo;å½“å†œå¤«æ€’ç›®å®¡è§†å¯¹æ–¹å°èˆ¹æ—¶ï¼Œä»–åƒæƒŠåœ°å‘ç°ï¼Œå°èˆ¹ä¸Šç©ºæ— ä¸€äººã€‚å¬ä»–å¤§å‘¼å°å«ï¼Œå‰è¨€æ–¥éª‚çš„åªæ˜¯ä¸€åªæŒ£è„±äº†ç»³ç´¢ã€é¡ºæ²³æ¼‚æµçš„ç©ºèˆ¹ã€‚</p></blockquote><p>å¥½ä¹…æ²¡ç å­—äº†ï¼Œè¯­ç«­è¯ç©·äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> äººç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2012</title>
      <link href="//gabby/%25e6%2588%2591%25e7%259a%25842012/"/>
      <url>//gabby/%25e6%2588%2591%25e7%259a%25842012/</url>
      
        <content type="html"><![CDATA[<div>  &nbsp; &nbsp; &nbsp; &nbsp; 2012å¹´ï¼Œæœ‰æƒŠæ— é™©åœ°è¿‡æ¥äº†ã€‚</div><div>  &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å›é¡¾è¿™ä¸€å¹´ï¼Œé…¸ç”œè‹¦è¾£éƒ½æœ‰ï¼Œç®—æ˜¯è®©æˆ‘åœ¨è¿™ä¸€å¹´ä½“ä¼šåˆ°äº†äººç”Ÿçš„å¤šå§¿å¤šå½©ã€‚</div><div>  &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä¹‹å‰åœ¨æˆ‘çš„è„‘æµ·é‡Œï¼Œå°è±¡æœ€æ·±çš„ä¸€å¹´æ˜¯1993å¹´ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå°è±¡æœ€æ·±åˆ»ï¼Œä½†æ˜¯å¦‚æœåˆ«äººé—®èµ·æ¥ï¼Œè‚¯å®šå°±æ˜¯1993å¹´ï¼Œå¯èƒ½è·Ÿçº½çº¦ä¸–è´¸ä¸­å¿ƒå‘ç”Ÿçˆ†ç‚¸æœ‰å…³ç³»ï¼Ÿï¼ˆç¬‘ï¼‰</div><div>  &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ç°åœ¨æ¥è¯´ï¼Œå°è±¡æœ€æ·±åˆ»çš„è‚¯å®šå°±æ˜¯2012å¹´äº†ã€‚</div><div>  &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; 2012å¹´æ³¨å®šæ˜¯ä¸å¹³å‡¡çš„ä¸€å¹´ï¼Œ25å²ï¼Œç®—æ˜¯æ­£å¼åº¦è¿‡äº†äººç”Ÿçš„1/4&#8211;æˆ–è®¸æ˜¯1/3æ›´å¥½äº›ã€‚è¿™ä¸€å¹´ä¸–ç•Œä¸Šå‘ç”Ÿçš„äº‹æƒ…å¤ªå¤šï¼Œè·Ÿæˆ‘æœ‰å…³ç³»çš„å€’æ˜¯ä¸å¤šã€‚æˆ–è®¸ä¸–ç•Œæœ«æ—¥è·Ÿæˆ‘æœ‰ç‚¹å…³ç³»å§ï¼Œä½†æ˜¯è¿™ä¸€å¤©æ˜¯è·Ÿæœ€çˆ±çš„äººä¸€èµ·åº¦è¿‡çš„ï¼Œè›®æœ‰æ„ä¹‰ã€‚</div><div>  <span id="more"></span></div><h2 style="text-align: center;">  <span style="color:#ffa500;">é…¸</span></h2><p style="text-align: center;">  <strong>&#8212; é…¸æ˜¯ç§å‚¬åŒ–å‰‚</strong></p><div>  &nbsp; &nbsp; &nbsp; &nbsp; 2010å¹´æˆ‘æ¥åˆ°åŒ—äº¬ï¼Œåˆ°2012å¹´7æœˆæ•´ä¸¤å¹´ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; åŒ—äº¬ç»™æˆ‘çš„ç¬¬ä¸€å°è±¡å¾ˆä¸é”™ï¼Œäº¤é”™ç›˜æ‚çš„ç«‹äº¤æ¡¥ï¼Œå“ªå“ªéƒ½æ˜¯äººçš„æ™¯ç‚¹ï¼Œå¹²å‡€çš„è¡—é“ï¼Œæ»¡ç›®çš„é«˜æ¥¼å¤§å¦ï¼Œç©¿å¾—å¾ˆæœ‰è´¨é‡çš„è¡Œäººã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æ·±å…¥äº†è§£åŒ—äº¬åï¼Œæ‰æ„Ÿè§‰ä¸æ˜¯é‚£ä¹ˆå›äº‹ã€‚åŒ—äº¬è¡¨é¢çœ‹èµ·æ¥å¾ˆå…‰é²œäº®ä¸½ï¼Œå†…é‡Œçš„æ±¡æµŠæ˜¯æ·±åˆ°éª¨é«“é‡Œçš„ã€‚ç¢äºå¤©æœåˆ¶åº¦ï¼Œæˆ‘ä¸èƒ½åœ¨è¿™é‡Œè¯´ä¸€æœä¹‹éƒ½çš„åè¯ï¼Œå¦åˆ™è¢«è·¨çœäº†å°±ä¸å¥½äº†ã€‚æ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯å¤©æœçš„ä¸€åˆ†å­ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ç°åœ¨çš„äº¬åŸç»™æˆ‘çš„æ„Ÿè§‰å¾ˆå·®ã€‚æ··æµŠçš„ç©ºæ°”ï¼Œæ¯å¤©è¦ç˜«ç—ªå‡ æ¬¡çš„äº¤é€šï¼ˆåœ°é“å¾ˆæ–¹ä¾¿ï¼‰ï¼Œé±¼é¾™æ··æ‚çš„äººï¼Œé«˜æ˜çš„éª—å­ï¼Œæ˜‚è´µçš„ç”Ÿæ´»ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; äº†è§£äº†äº¬åŸï¼Œå´åˆä¸å¾—ä¸åœ¨è¿™ç§å¤§ç¯å¢ƒä¸‹éšæ³¢é€æµï¼ŒçœŸçš„æ˜¯å¾ˆæ— å¥ˆï¼Œè°è®©å’±æ˜¯ä¸ºäº†ç”Ÿæ´»å‘¢ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; 2011å¹´åº•ï¼Œåœ¨åˆè‚¥åº¦è¿‡äº†ä¸€æ®µç°æš—çš„æ—¶å…‰ï¼Œåœ¨2012å¹´å¹´åˆåˆè½¬æˆ˜é™•è¥¿ï¼Œ1ä¸ªæœˆä¸é•¿ä¸çŸ­ï¼Œä½†å´å°†æˆ‘çš„ä¿¡å¿ƒå’Œè€å¿ƒç£¨å¾—ä¸€å¹²äºŒå‡€ã€‚ç´¢æ€§ç¦»å¼€é™•è¥¿ï¼Œç‹¬è‡ªä¸€äººè¸ä¸Šå›åŒ—äº¬çš„è·¯ï¼Œå¿ƒä¸­çš„é…¸æ¶©æ— äººå¯è¯‰ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æ¥ä¸‹æ¥åœ¨æ‰¾å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œåˆè¢«æ‰“å‡»å¾—ä½“æ— å®Œè‚¤ã€‚æ€»æƒ³ç€è‡ªå·±å·²ç»å¯ä»¥ç‹¬å½“ä¸€é¢äº†ï¼Œåˆ°å¤´æ¥è¿˜æ˜¯ä»€ä¹ˆéƒ½ä¸ä¼šï¼Œè¢«é¢è¯•çš„äººè¯´å¾—é¢çº¢è€³èµ¤ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æœ€åæ¥åˆ°è¿™å®¶å…¬å¸ï¼Œè‡ªå·±æ‰€åœ¨çš„éƒ¨é—¨åªæœ‰è‡ªå·±ä¸€ä¸ªäººï¼Œåœ¨åˆ«äººçœ‹èµ·æ¥&ldquo;å“‡ï¼Œä½ æ—¢æ˜¯éƒ¨é—¨ç»ç†åˆæ˜¯æŠ€æœ¯æ€»ç›‘åˆæ˜¯å‘˜å·¥å“ï¼&rdquo;ï¼Œå´æ— æ³•äº†è§£å…¶ä¸­çš„éš¾å—ä¹‹å¤„ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å› ä¸ºå‰æœŸè¢«æ‰“å‡»ï¼Œå·¥èµ„æ²¡æ•¢è¦å¤ªé«˜ï¼Œä»¥è‡´ç°åœ¨æ‰‹å¤´è¿˜æ˜¯ç´§å¼ å¾—è¦å‘½ã€‚æˆ‘åˆä¸ä¼šå­˜é’±ï¼Œå‡ ä¹æ¯ä¸ªæœˆéƒ½å‘æœˆå…‰ç¾¤ä½“é æ‹¢ï¼Œæ€»æ˜¯æ„Ÿè§‰é’±ä¸å¤Ÿã€‚è¯´å®è¯æˆ‘å¯¹é‡‘é’±çš„æ¬²æœ›å¹¶ä¸å¼ºçƒˆï¼Œä½†æœ‰æ—¶åœ¨è¡—ä¸Šèµ°ï¼Œé£å•Šé›¨å•Šçš„å¹è¿‡æ¥ï¼Œè¿˜æ˜¯å¾ˆç¾¡æ…•é‚£äº›ååœ¨è½¦é‡Œæš–æš–å’Œå’Œèˆ’èˆ’æœæœçš„äººçš„ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æ¢äº†å·¥ä½œï¼Œä¹Ÿæ¢äº†ä¸ªæ–°çš„ä½æ‰€ã€‚ä¹Ÿè®¸æ˜¯æˆ‘æ¶‰ä¸–æœªæ·±ï¼Œä¹Ÿè®¸æ˜¯æˆ‘çœŸçš„æ²¡ä»€ä¹ˆè„‘å­ï¼Œå¯¹äººæ²¡ä»€ä¹ˆé˜²å¤‡ä¹‹å¿ƒï¼Œå±…ç„¶å°±è¢«éª—ç€ä½äº†ä¸ªå¾ˆæš—å¾ˆæš—çš„éš”æ–­é—´ã€‚å½“æ—¶æ­£æ˜¯æ˜¥å¤äº¤é™…æ—¶ï¼Œæ¸©åº¦å’Œæ¹¿åº¦éƒ½é€‚å®œï¼Œä½†åˆ°äº†å¤å¤©å°±æœ‰æƒ³æ­»çš„å¿ƒäº†ã€‚è¿™éƒ½ä¸æ˜¯é‡ç‚¹ï¼Œå¤§ä¸äº†å¤šæ´—æ¾¡ï¼Œå¤šå¼€ä¼šé£æ‰‡ï¼Œé‡ç‚¹æ˜¯åŒä½çš„äººæ˜¯æœ‰å¤šå¥‡è‘©ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; éš”å£æ˜¯å››ä¸ªç™½ç—´ï¼Œå…¶ä¸­ä¸€ä¸ªä»æ¥ä¸ä¸Šç­ï¼Œå› ä¸ºæˆ‘éšæ—¶éƒ½èƒ½å¬åˆ°ä»–çš„å¤§å—“é—¨ï¼Œåœ¨å–Š&ldquo;è‰¹ï¼åŠ è¡€å•Šï¼è‰¹ï¼Œä¼šä¸ä¼šæ‰“ï¼&rdquo;ï¼›ç¬¬äºŒä¸ªæ‹‰å®Œå±ä»æ¥ä¸å†²ï¼Œç»ˆäºåœ¨ä¸€ä¸ªæ™šä¸Šéš”å£çš„éš”å£çš„å¥³äººå¿ä¸ä½äº†ï¼Œè·Ÿè¿™ç™½ç—´å¤§åµäº†ä¸€é€šï¼Œè¿™ç™½ç—´è¿˜TMç©¿ç€çº¢è£¤è¡©ï¼Œç«™åœ¨èµ°å»Šé‡Œï¼Œè·Ÿä¸ªæš´éœ²ç‹‚ä¸€æ ·ï¼›ç¬¬ä¸‰ä¸ªä¼šå¼¹å‰ä»–ï¼Œæ›¾ç»çš„è®°å½•æ˜¯è¿ç»­å”±äº†ä¸¤ä¸ªæ˜ŸæœŸçš„ã€Šä½ çš„èƒŒåŒ…ã€‹ï¼Œè¿™ä¹Ÿå°±ç½¢äº†ï¼Œå…³é”®æ˜¯ä»–å”±æ­Œçš„è°ƒè°ƒå®åœ¨è®©äººä¸æ•¢ç›´è§†ï¼ŒçœŸæ•™äººæ¬²æ­»ä¸æ¬²ç”Ÿï¼›ç¬¬å››ä¸ªæ¯å¤©éƒ½è¦æŠ±æ€¨ç”Ÿæ´»çš„ä¸å…¬å¹³ï¼Œæ¯å¤©å›åˆ°å®¶éƒ½è¦é•¿å¹ä¸€å£æ°”ï¼Œç„¶åå¼€å§‹è¯‰è‹¦ï¼Œè¯´çœŸæ²¡æ„æ€ï¼Œæ‹¿è¿™ä¸¤åƒå—é’±çš„å·¥èµ„ï¼Œè¿˜æ¯å¤©ç´¯å¾—è·Ÿå­™å­ä¸€æ ·ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; éš”å£çš„éš”å£çš„å¥³äººå…¶å®ä¹Ÿæ˜¯ä¸ªå¥‡è‘©ã€‚å¥¹è·Ÿå¦ä¸€ä¸ªå¥³äººä½åœ¨ä¸€èµ·ï¼Œæ´—æ¾¡æ—¶ä¸€å®šæ˜¯ä¸¤ä¸ªäººä¸€èµ·ï¼Œæ—¶é—´ç‰¹åˆ«ç‰¹åˆ«é•¿ï¼Œè‡³å°‘è¦ä¸¤ä¸ªå°æ—¶ï¼Œè¿™è®©æˆ‘ä»¬å–å¤šäº†æ°´æ†‹ç€çš„äººæƒ…ä½•ä»¥å ªã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; è¿˜æœ‰å·è‚¥çš‚çš„ï¼Œå‡ºé—¨ä»æ¥ä¸å…³é—¨çš„ï¼Œæ´—äº†è¢œå­å†…è£¤éšä¾¿å¾€åˆ«äººè¡£æœä¸Šæ­çš„ï¼Œåœ¨æ»¡æ˜¯èŸ‘è‚çš„å¨æˆ¿é‡Œåšé¥­çš„ï¼Œåœ¨æ´—è¡£æœºé‡Œæ´—é‹çš„ï¼Œåœ¨å†°ç®±é‡Œæ”¾é¿å­•å¥—çš„ã€‚ã€‚äººç”ŸçœŸçš„å¾ˆç¥å¥‡ï¼Œå¯ä»¥é‡è§å„ç§å„æ ·çš„äººã€‚<br /> &nbsp;</div><h2 style="text-align: center;">  <span style="color:#0000ff;">ç”œ</span></h2><p style="text-align: center;">  <strong>&#8212; æœ€å¹¸ç¦çš„å°±æ˜¯ç”œ</strong></p><div>  &nbsp; &nbsp; &nbsp; &nbsp; 2012å¹´2æœˆ2æ—¥ï¼Œè¿™ä¸ªæ—¥å­å¾ˆæ™®é€šï¼Œæˆ‘è®¤è¯†äº†å¥¹ã€‚å½“æ—¶æˆ‘äººåœ¨åˆè‚¥ï¼Œä¸€è…”è‹¦é—·æ— äººèƒ½è§£ï¼Œä¹Ÿæ˜¯å¥¹å¸®æˆ‘æ’è§£ï¼Œè·Ÿæˆ‘ä¸€èµ·å¬‰ç¬‘æ€’éª‚ï¼Œç»™æˆ‘æŒ‡æ˜æ–¹å‘ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; èŒ«èŒ«äººæµ·ä¸­ä¸¤äººä»ç›¸é‡ï¼Œç›¸è¯†ï¼Œç›¸çŸ¥ï¼Œç›¸äº²ç›¸çˆ±ï¼Œè¿™å°±æ˜¯ç¼˜åˆ†å§ã€‚å½“æˆ‘å‘ç°ä¸¤äººçš„æ‰‹æœºå·ç«Ÿç„¶åªå·®ä¸€ä½æ•°æ—¶ï¼Œå¿ƒé‡Œæœ‰ç§å¼‚æ ·çš„æ„Ÿè§‰ï¼Œæˆ‘è§‰å¾—ï¼Œå°±æ˜¯å¥¹äº†ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å¥¹è¯´å¥¹è„¾æ°”å¾ˆæš´èºï¼Œæ€»æ˜¯åŠ¨ä¸åŠ¨å°±å‘ç«ï¼Œè¿™ç‚¹æˆ‘é¢†æ•™åˆ°äº†ã€‚ä¸è¿‡ï¼Œçˆ±å¥¹ï¼Œå°±å¯ä»¥åŒ…å®¹å¥¹çš„ç¼ºç‚¹ï¼Œå†µä¸”æˆ‘çš„è„¾æ°”å¥½ï¼Œä¹Ÿç®—æ˜¯äº’è¡¥å§ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å¯æ˜¯å¥¹ä¹Ÿæ¸©æŸ”ä¼¼æ°´å•Šï¼Œæˆ‘å°±å®Œå…¨æŠ—æ‹’ä¸äº†è¿™ä¸€ç‚¹ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; 4æœˆ7å·æˆ‘å°±å‘å¥¹è¡¨ç™½äº†ã€‚è¿˜ç®—æ˜¯é¡ºåˆ©å§ï¼Œè™½ç„¶å¥¹åæ¥è€å‘æˆ‘æŠ±æ€¨æˆ‘æ²¡æ­£å¼åœ°è¿½è¿‡å¥¹ã€‚ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; é©¬ä¸Šåˆè¦2æœˆ2å·äº†ï¼Œä¸€å¹´è¿‡å¾—çœŸå¿«ã€‚åœ¨è¿™ä¸€å¹´é‡Œï¼Œæˆ‘ä»¬ä¸€èµ·æ¯«æ— å½¢è±¡åœ°å¤§ç¬‘ï¼Œä¸€èµ·ä¸ºä¼¤å¿ƒçš„äº‹æƒ…æŠ±å¤´ç—›å“­ï¼Œä¸ºäº†ä¸€ç‚¹å°å±äº‹åµæ¶ï¼Œä¸ºäº†ä¸€ç‚¹ä¸å…¬å¹³åˆä¼™æ€’éª‚ï¼Œè¿™éƒ½æ˜¯æœ€ç¾å¥½çš„å›å¿†ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æˆ‘ä»¬ä¸€èµ·å‡ºå»æ—…è¡Œï¼Œä¸€èµ·ä¸ºæœªæ¥åšæ‰“ç®—ï¼Œä¸€èµ·åšé¥­ï¼Œä¸€èµ·å­¦è·³èˆï¼Œä¸€èµ·å‡è‚¥ï¼ˆå‘ƒæŸäººçœ‹åˆ°ä¸è¦ææˆ‘ï¼‰ï¼Œè®¸è®¸å¤šå¤šçš„æ•…äº‹ï¼Œéƒ½æ˜¯æˆ‘ä»¬çš„è´¢å¯Œã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æˆ‘æ›¾ç»åœ¨å¥¹ä¸Šè¯¾çš„æ—¶å€™çªç„¶å‡ºç°åœ¨å¥¹çš„èº«åï¼Œåœ¨å„¿ç«¥èŠ‚çš„æ—¶å€™å¸¦ç€å…”æ–¯åŸºå»é©¾æ ¡æ¥å¥¹ï¼Œåœ¨ä¸ƒå¤•çš„æ—¶å€™ç»™å¥¹é€èŠ±ï¼Œåœ¨åœ£è¯å¤œçš„æ—¶å€™ç»™å¥¹å®šæƒ…çš„æˆ’æŒ‡&#8211;å¥½å§ï¼Œæˆ‘æ‰¿è®¤è¿™äº›éƒ½ä¸æµªæ¼«ï¼Œæˆ‘å¹¶ä¸æ˜¯ä¸ªä¼šåˆ¶é€ æµªæ¼«çš„äººï¼Œå¥¹ä¹Ÿè€è¯´&ldquo;å’±ä¿©å°±åƒè€å¤«è€å¦»ä¼¼çš„ï¼Œæœ‰æœ¨æœ‰&rdquo;ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä»Šå¹´ç”Ÿè¿‡ä¸¤åœºå¤§ç—…ï¼Œéƒ½æŠŠå¥¹å“åäº†ã€‚ç¬¬ä¸€åœºæ˜¯æ— ç¼˜æ•…åœ°æ‹‰è‚šå­ï¼ŒæŒç»­äº†å¿«ä¸€ä¸ªå‘¨ï¼Œæ•´ä¸ªäººéƒ½è™šè„±äº†ï¼Œå‘çƒ§ï¼Œæ²¡åŠ›æ°”åŠ¨ã€‚å¥¹åŠå¤œä¸¤ç‚¹è·‘å‡ºå»ä¹°é€€çƒ§è¯ï¼Œæˆ‘åœ¨åºŠä¸Šæ„ŸåŠ¨å¾—æ­»å»æ´»æ¥çš„ã€‚ç¬¬äºŒåœºæ˜¯éå¸¸ä¸¥é‡çš„æ„Ÿå†’ï¼Œæˆ‘ä»æ¥æ²¡æœ‰æ„Ÿå†’åˆ°è¿™ç§ç¨‹åº¦ï¼Œä»ä¸€å¼€å§‹çš„å—“å­ç–¼ï¼Œå’³å—½ï¼Œåˆ°åæ¥å‘•åï¼Œå‘çƒ§ï¼Œæ‹‰è‚šå­ï¼Œæµé¼»æ¶•ã€‚ã€‚åæ¥é€¢äººæˆ‘å°±è¯´ï¼Œè¿™æ¬¡å¯ç®—æ˜¯å½»åº•æ„Ÿå†’äº†ä¸€æ¬¡ã€‚å¥¹è¯·å‡åœ¨å®¶ç…§é¡¾æˆ‘ï¼Œæˆ‘å¾ˆæ„§ç–šï¼Œåœ¨å¥¹åšé¥­çš„æ—¶å€™ï¼ŒæŒªåˆ°å¨æˆ¿å»çœ‹å¥¹ï¼Œå¥¹è¯´&ldquo;æ¥è¿™å¹²ä»€ä¹ˆï¼Œèµ¶ç´§å›å»ï¼Œåˆ«å†»ç€ã€‚&rdquo;æˆ‘å‘å¥¹è¡¨è¾¾æˆ‘çš„æ­‰ç–šä¹‹æƒ…ï¼Œå¥¹å¾ˆå¹³æ·¡åœ°è¯´&ldquo;è¿™ä¸åº”è¯¥çš„ä¹ˆã€‚&rdquo;äººç”Ÿå¾—æ­¤å¥³ï¼Œæ— æ‰€æ±‚ä¹Ÿã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; 2012å¹´12æœˆ9å·ï¼Œæˆ‘ä»¬è®¢å©šäº†ã€‚10ä¸ªæœˆç›¸å¤„çš„æ—¶é—´ï¼Œæˆ‘è§‰å¾—è¿™å°±æ˜¯æˆ‘çš„äººç”Ÿä¼´ä¾£äº†ï¼Œå¯ä»¥å°†è‡ªå·±äº¤ä»˜äºˆå¥¹ï¼Œå¥¹ä¹Ÿå¯ä»¥æŠŠè‡ªå·±çš„æœªæ¥äº¤ç»™æˆ‘ã€‚æˆ‘ç›¸ä¿¡ï¼Œæœªæ¥åœ¨æˆ‘ä»¬è‡ªå·±çš„æ‰‹ä¸Šï¼<br /> &nbsp;</div><h2 style="text-align: center;">  <span style="color:#008000;">è‹¦</span></h2><p style="text-align: center;">  <strong>&#8212; äººé—´æ­£é“æ˜¯æ²§æ¡‘</strong></p><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä½›è¯´ï¼šäººæœ‰å…«è‹¦ï¼Œç”Ÿè‹¦ï¼Œè€è‹¦ï¼Œç—…è‹¦ï¼Œæ­»è‹¦ï¼Œæ€¨æ†ä¼šè‹¦ï¼Œçˆ±åˆ«ç¦»è‹¦ï¼Œæ±‚ä¸å¾—è‹¦ï¼Œäº”è•´ç‚½ç››è‹¦ã€‚å”¯æœ‰èº«å¿ƒæ”¾ç©ºï¼Œæ–¹èƒ½äººç¦»éš¾ï¼Œéš¾ç¦»èº«ï¼Œä¸€åˆ‡ç¾æ®ƒåŒ–ä¸ºå°˜ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; æˆ‘è¿™ä¸ªäººï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§è€å¿ƒï¼Œè¦è¯´åƒè‹¦ï¼ŒçœŸåƒä¸äº†ã€‚å¯æ˜¯æœ‰äº›è‹¦ï¼Œå´æ˜¯èƒ½æ±è¿‡æ¥çš„ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä»å»å¹´å››æœˆä»½è¿›å…¥è¿™å®¶å…¬å¸ï¼Œå°±å¼€å§‹äº†ä¸€ç§å’Œä»¥å‰æˆªç„¶ä¸åŒçš„ç”Ÿæ´»ã€‚æ¯å¤©ä¸Šç­è¦æŒ¤å…¬äº¤ï¼ŒæŒ¤å®Œå…¬äº¤æŒ¤åœ°é“ï¼Œæ¯å¤©ä¸Šç­ä¸‹ç­éƒ½è¦æµªè´¹æ‰ä¸¤ä¸ªå°æ—¶ï¼Œè®©äººæ„Ÿå¹åŒ—äº¬äººæ€ä¹ˆè¿™ä¹ˆå¤šçš„åŒæ—¶ï¼Œä¹Ÿæš—æš—å«è‹¦ã€‚æˆ‘æœ‰è½»åº¦å¼ºè¿«ç—‡ï¼Œè®¨åŒåœ¨è½¦ä¸Šè¢«ä¸è®¤è¯†çš„äººç¢°ï¼Œæ‰€ä»¥æŒ¤è½¦çš„æ—¶å€™æ˜¯ä¸ªå¾ˆç—›è‹¦çš„è¿‡ç¨‹ã€‚å¸¸å¸¸å¾ˆå¥½çš„å¿ƒæƒ…ï¼Œå°±å› ä¸ºæŒ¤äº†ä¸ªå…¬äº¤æˆ–è€…åœ°é“ï¼Œé©¬ä¸Šå°±ä¹Œäº‘å¯†å¸ƒäº†ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä½†çœ‹çœ‹å‘¨å›´çš„äººï¼Œå“ªä¸ªåˆä¸æ˜¯è¿™æ ·ï¼Œè¿˜æœ‰å¾ˆå¤šé€šå·çš„äººï¼Œå¤§è€æ—©å°±åè½¦ï¼Œåˆ°å›½è´¸ä¸Šç­ã€‚æ‰€ä»¥ï¼Œè¿™ç‚¹è‹¦ï¼Œåˆç®—å¾—äº†ä»€ä¹ˆï¼Œæˆ‘ä¹Ÿæ²¡èµ„æ ¼æŠ±æ€¨ä»€ä¹ˆï¼Œå¹´è½»äººï¼Œåƒç‚¹è‹¦æ€•ä»€ä¹ˆï¼Œç­‰åˆ°å¹´çºªå¤§äº†ï¼Œæ‰èƒ½æ‡‚å¾—ï¼Œè¿™äº›æ“è›‹çš„ç»éªŒæ‰å«äººç”Ÿã€‚</div><div>  &nbsp;</div><h2 style="text-align: center;">  <span style="color:#b22222;">è¾£</span></h2><p style="text-align: center;">  <strong>&#8212; ç§æˆ‘è¿™çˆ†è„¾æ°”</strong></p><div>  &nbsp; &nbsp; &nbsp; &nbsp; å°çš„æ—¶å€™è¿˜è›®èƒ½åƒè¾£çš„ï¼Œé•¿å¤§äº†è¶Šå‘ä¸è¡Œäº†ã€‚å°±å¥½åƒæˆ‘å°æ—¶å€™è¢«éª‚æ²¡ä»€ä¹ˆå…³ç³»ï¼Œè„¸çš®åšï¼Œé•¿å¤§äº†è„¸çš®è–„ï¼Œè¢«éª‚äº†å°±æŒ‚ä¸ä½äº†ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; è¿™ä¸€å¹´è¢«å¾ˆå¤šä¸åŒçš„äººéª‚è¿‡ã€‚æœ‰çš„æ˜¯å–„æ„çš„ï¼Œæœ‰çš„æ˜¯æ¶æ„çš„ã€‚æ¶æ„çš„æˆ‘ä»æ¥éƒ½ä¸æ”¾åœ¨èº«ä¸Šï¼Œå› ä¸ºæˆ‘æ˜¯ä¸ä¼šå»å’¬é©¬è·¯ä¸Šå¯¹ç€æˆ‘ç‹‚å çš„ç‹—çš„ã€‚å–„æ„çš„éª‚æ¯æ¬¡éƒ½ä¼šéš¾è¿‡ï¼Œä½†è¿‡åéƒ½ä¼šæƒ³æ˜ç™½ï¼Œæˆ‘è¢«éª‚ä¹Ÿæ˜¯åº”è¯¥çš„ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å¤§æŠµæ˜¯åœ¨1æœˆä»½ï¼Œå½“æ—¶åœ¨åˆè‚¥ï¼Œè·Ÿè€å¤–ä¸€èµ·å…±äº‹ã€‚æœ‰ä¸€æ¬¡å‡ºäº†ç‚¹é—®é¢˜ï¼Œæˆ‘æ²¡æœ‰è·Ÿä»–å•†é‡å°±æ“…è‡ªåšäº†å†³å®šï¼Œå½“æ—¶æˆ‘æƒ³ï¼Œè¿™ä¸ªå†³å®šå¹¶ä¸ä¼šå¯¹æˆ‘ä»¬é€ æˆä»€ä¹ˆå½±å“ã€‚æ²¡æƒ³åˆ°è€å¤–çŸ¥é“ä¹‹åé›·éœ†éœ‡æ€’ï¼Œå¤§å£°åœ°æ–¥è´£æˆ‘ï¼Œè¯´ä¸ºä»€ä¹ˆä¸å‘Šè¯‰ä»–ï¼Œä¸ºä»€ä¹ˆä¸é€šçŸ¥å…¶ä»–çš„é¢†å¯¼è®©ä»–ä»¬æ¥æ‹¿ä¸»æ„ã€‚æˆ‘çš„çˆ†è„¾æ°”ä¹Ÿç¬é—´ç‡ƒäº†ï¼Œè·Ÿä»–å¯¹å‘›èµ·æ¥ï¼Œåœºé¢ä¸€æ—¶å¤±æ§ã€‚åæ¥ä»–æŠ›ä¸‹ä¸€å¥&ldquo;ä½ è‡ªå·±æƒ³æƒ³å§&rdquo;å°±å›åŠå…¬å®¤äº†ã€‚æ€’ç«è¿‡åï¼Œæˆ‘é™ä¸‹å¿ƒæ¥ï¼Œæƒ³å½“æ—¶çš„ç¡®ä¸åº”è¯¥è‡ªå·±æ‹¿å†³å®šï¼Œæ¯•ç«Ÿä¸æ˜¯ä¸€å—é’±ä¸¤å—é’±çš„äº‹ï¼Œæ˜¯æ¯å¤©ä¸Šåƒä¸‡çš„äº¤æ˜“ï¼Œå¦‚æœæœ‰äº†å·®é”™ï¼Œäº‹æƒ…åªèƒ½è½åœ¨æˆ‘çš„å¤´ä¸Šï¼Œå› ä¸ºè¿™ä¸ªå†³å®šæ˜¯æˆ‘åšçš„ï¼Œæˆ‘æ‹…å½“ä¸èµ·ã€‚äº‹åè·Ÿè€å¤–é“æ­‰ï¼Œä»–æ¥å—äº†ï¼Œä¹Ÿæ²¡å†è¯´ä»€ä¹ˆï¼Œæ‰€å¹¸ä¹Ÿæ²¡å‘ç”Ÿä»€ä¹ˆäº‹æƒ…ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; åæ¥æœ‰ä¸€æ¬¡ã€‚é‚£ä¸€æ®µæ—¶é—´æˆ‘æ— æ‰€äº‹äº‹ï¼Œä¸Šé¢äº¤ç»™æˆ‘çš„äº‹æƒ…æˆ‘éƒ½ä¸åšï¼Œå› ä¸ºä»–ä»¬éƒ½è¿œåœ¨é™•è¥¿ã€‚æ¯å¤©éƒ½æ˜¯&ldquo;æ”¾ç¾Šæ··æ—¥å­&rdquo;çš„çŠ¶æ€ï¼Œä¸Šç­çœ‹å°è¯´ï¼Œä¸‹ç­ç©æ¸¸æˆï¼Œä¸äº¦ä¹ä¹ã€‚æœŸé—´æœ‰ä¸ªå…¶ä»–çš„é¢†å¯¼ä¼šæŒ‡ä½¿æˆ‘åšä¸€äº›è·‘è…¿çš„äº‹æƒ…ï¼Œæˆ‘ç¢äºä¸Šä¸‹çº§çš„å…³ç³»ï¼Œå°±ä¼šå¸®ä»–åšäº›äº‹æƒ…ã€‚åæ¥æˆ‘çš„ç›´å±é¢†å¯¼ä¸“ç¨‹æ‰“ç”µè¯è¿‡æ¥ï¼ŒåŠˆå¤´ç›–è„¸éª‚æˆ‘ä¸€é€šï¼Œè¯´&ldquo;æˆ‘æ‰æ˜¯ä½ çš„é¢†å¯¼ï¼Œåˆ«çš„é¢†å¯¼æŒ‡ä½¿æˆ‘çš„å‘˜å·¥ï¼Œæˆ‘çš„å‘˜å·¥å¯ä»¥ä¸å¹²ï¼ä¸‹æ¬¡å†è®©æˆ‘çŸ¥é“ä½ æ›¿ä»–è·‘è…¿ï¼Œä½ å°±å¹²è„†å»ä»–é‚£è¾¹å¾—äº†ï¼ç¨‹åºå‘˜ä¸æ˜¯ç”¨æ¥è·‘è…¿ä¹°çƒŸçš„ï¼&rdquo;æˆ‘å¿ƒé‡Œå¾ˆå§”å±ˆï¼Œå´ä¹Ÿåªèƒ½åæ€è‡ªå·±çš„ä¸æ˜¯ã€‚é¢†å¯¼ä¹Ÿæ˜¯æœ‰é€†é³çš„ï¼Œä»–çš„é€†é³å¤§æ¦‚å°±æ˜¯è¿™æ ·å§ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å› ä¸ºè®¢å©šï¼Œå°±ç‰µæ‰¯åˆ°ä¹°æˆ¿ï¼Œç»“å©šï¼Œç”Ÿå­ã€‚æˆ‘å¿ƒé‡Œå‹åŠ›éª¤å¢ã€‚80åéƒ½æ˜¯æ‚²æ‘§çš„ä¸€ä»£ï¼Œä»–ä»¬ç”Ÿæ´»çš„å¹´ä»£ï¼Œæ‹¿ç€ä»€ä¹ˆéƒ½ä¹°ä¸èµ·çš„å·¥èµ„ï¼Œè¿‡ç€ä»€ä¹ˆéƒ½ä¹°ä¸èµ·çš„æ—¥å­ã€‚ä½†æ˜¯å¯¹æˆ‘æ¥è¯´ï¼Œå‹åŠ›æ˜¯é˜»ç¢ï¼Œä¹Ÿæ˜¯åŠ¨åŠ›ï¼Œåªæƒ³ç€é æ­»å·¥èµ„æ¯å¤©å¥½åƒæ‡’ä½œï¼Œä»€ä¹ˆæ—¶å€™æ˜¯ä¸ªå¤´ã€‚çˆ¸å¦ˆè‚¯å®šä¹Ÿå¸Œæœ›æˆ‘ä»¥åèƒ½æœ‰ä¸ªå¥½ç”Ÿæ´»ï¼Œä¸æ˜¯ä¹ˆã€‚</div><div>  &nbsp;</div><h2 style="text-align: center;">  ç»­</h2><p style="text-align: center;">  <strong>&#8212; äººç”Ÿè¿˜è¦ç»§ç»­</strong></p><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä»åŠä¸ªæœˆå‰å°±å¼€å§‹è§„åˆ’è¿™ç¯‡æ–‡ç« ï¼Œåæ¥å‘ç°è¿˜æ˜¯æ²¡æœ‰æŒ‰ç…§é¢„æƒ³çš„è·¯å­ç å­—ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; é…¸ç”œè‹¦è¾£å†™å®Œï¼Œæ„Ÿè§‰åˆæ˜ç™½äº†å¾ˆå¤šä¸œè¥¿ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; ä¸Šé«˜ä¸­çš„æ—¶å€™ï¼Œæˆ‘å†™è¿‡ä¸€å¥è¯ï¼šäººç”Ÿå°±æ˜¯ä¸ªèˆå°ï¼Œå„ç§å„æ ·çš„å‰§éƒ½åœ¨ä¸Šæ¼”ç€ã€‚å¦‚æœæ²¡æœ‰å‰§ç›®ï¼Œé‚£å°±æ²¡äººçœ‹äº†ã€‚</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; å¾ˆå¯¹ï¼Œæ˜¯ä¸ï¼Ÿå˜¿å˜¿ã€‚<br /> &nbsp;</div><div>  &nbsp; &nbsp; &nbsp; &nbsp; è·¯è¿˜è¦ç»§ç»­èµ°ï¼Œç›é›…äººè¯´å¥½çš„ä¸–ç•Œæœ«æ—¥å¹¶æ²¡æœ‰å¦‚çº¦è€Œè‡³ï¼Œ2013è¿ˆç€è½»æ¾çš„è„šæ­¥å‘æˆ‘ä»¬èµ°æ¥ã€‚æˆ‘ä»¬ä¸èƒ½åœä¸‹ï¼Œæ›´ä¸èƒ½æ”¾å¼ƒï¼Œä¸–ç•Œå¤šä¹ˆç²¾å½©ã€‚</div>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FlipBoard &amp;#8211; ä¼˜ç§€çš„ç¤¾äº¤æ‚å¿—</title>
      <link href="//just-try/flipboard/"/>
      <url>//just-try/flipboard/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ç”¨ç¤¾äº¤ç½‘ç»œå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚æ–°æµªå¾®åšï¼Œæ¯”å¦‚Weicoï¼Œæ¯”å¦‚å››æ¬¡å…ƒï¼Œä½†éƒ½åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚<br>æˆ‘ç”¨æ–°é—»è½¯ä»¶å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚ç™¾åº¦æ–°é—»Appï¼Œæ¯”å¦‚Google Readerï¼Œæ¯”å¦‚ç½‘æ˜“Zakerï¼Œä½†éƒ½åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚<br>æˆ‘ç”¨æ‚å¿—å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚Vivaï¼Œæ¯”å¦‚æŒåª’ï¼Œæ¯”å¦‚Google Currentsï¼Œä½†éƒ½åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚</p><p>Flipboardå¯ä»¥åšåˆ°ã€‚Flipboardå¯ä»¥å®Œç¾åœ°ç»“åˆç¤¾äº¤ä¸æ–°é—»ä¸æ‚å¿—å…ƒç´ ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ Flipboardï¼Ÿå®ƒåšäº†ä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ï¼šæŠŠä½ çš„æ–°æµªå¾®åšå’Œè±†ç“£å’Œå˜æˆäº†ä¸€æœ¬æ‚å¿—ã€‚</p><p>Flipboard åé¦ˆå‡ºæ¥çš„æ˜¯ä¸€ç§ä¼˜é›…çš„æ€åº¦ï¼Œå°†é˜…è¯»çœŸæ­£å˜æˆä¸€ç§&ldquo;äº«å—&rdquo;ã€‚å®ƒä¸ä¼—ä¸åŒçš„åœ°æ–¹å°±åœ¨äºå®ƒçš„è®¾è®¡ï¼Œå¤§é‡çš„è§¦æ‘¸æ“ä½œè®©å®ƒå˜å¾—éå¸¸è¿·äººï¼š</p><blockquote><ol><li>ç‚¹å‡»ä¸€ç¯‡æ–‡ç« ï¼Œå®ƒå°±ä¼š&ldquo;æ”¾å¤§&rdquo;å»æ˜¾ç¤ºæ›´å¤šçš„ å†…å®¹ã€‚  </li><li>ç‚¹å‡»ä¸€ä¸ªè§†é¢‘ï¼Œå®ƒå°±ä¼šåœ¨æ–‡ç« å†…æ’­æ”¾ã€‚  </li><li>è®©æ‰€æœ‰çš„ä¸œè¥¿å»é€‚åº”ä½ çš„è®¾å¤‡ï¼Œè¿ç…§ç‰‡éƒ½ä¼šä»ç«–ç›´è½¬æ¢åˆ°æ°´å¹³æ–¹å‘ã€‚  </li><li>ç‚¹å‡»é•¿æ–‡é‡Œçš„&ldquo;è·å–æ›´å¤šç½‘ç»œå†…å®¹&rdquo;å°†ä¼šé‡å®šå‘åˆ°è¯¥æ–‡çš„å‘å¸ƒç«™ç‚¹ã€‚  </li><li>å½“ä½ å¯¼å…¥è‡ªå·±æŸä¸ªç¤¾äº¤ç½‘ç»œé‡Œå¥½å‹æ—¶ï¼Œä»–ä»¬çš„ç…§ç‰‡ã€çŠ¶æ€ä¿¡æ¯éƒ½ä¼šæ˜¾ç¤ºåœ¨å¸ƒå±€ç²¾è‡´çš„é¡µé¢é‡Œã€‚  </li><li>æ ¹æ®æ­£åœ¨é˜…è¯»çš„å†…å®¹ï¼Œä½ å¯ä»¥é€šè¿‡è§¦æ‘¸æ¥åˆ†äº«ã€æ”¶è—ã€è¡¨ç¤ºå–œå¥½æˆ–è€…è½¬å‘ã€‚</li></ol></blockquote><p>Flipboardåˆ†ä¸º&ldquo;é€šç”¨ç‰ˆ&rdquo;ä¸&ldquo;å¤©æœç‰ˆ&rdquo;ï¼Œé‰´äºé˜…è¯»è¿™ç¯‡æ–‡ç« çš„äººå¤§éƒ¨åˆ†æ˜¯å¤©æœäººï¼Œæˆ‘å°±ä»¥&ldquo;å¤©æœç‰ˆ&rdquo;åšä¸ºè¯„æµ‹çš„ä¸»è¦å†…å®¹ã€‚  </p><span id="more"></span><p>é¦–æ¬¡å®‰è£…è¿›å…¥Flipboardæ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªæ¬¢è¿ç•Œé¢ï¼Œéå¸¸ç±»ä¼¼Twitterçš„æ¬¢è¿ç•Œé¢ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-18-58.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-18-58.png" style="width: 480px; height: 854px;" /></a></div><p>é¡µé¢çš„ä¸‹éƒ¨è¿˜ä¼šè‡ªåŠ¨æœ‰ä¸€ä¸ªå‘ä¸Š&ldquo;ç¿»&rdquo;çš„åŠ¨ä½œï¼Œæç¤ºä½ å¯ä»¥é€šè¿‡&ldquo;å‘ä¸Šæ»‘&rdquo;çš„æ‰‹åŠ¿è¿›å…¥ä¸‹ä¸€ä¸ªé¡µé¢ã€‚æˆ‘ä»¬æ¥&ldquo;ç¿»&rdquo;ä¸€ä¸‹ï¼Œè¿›å…¥ç™»å½•ç•Œé¢ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-19-20.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-19-20.png" style="width: 480px; height: 854px;" /></a></div><p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ˜¯å¦è¦é€šè¿‡Flipboardè´¦å·æ¥ç™»å½•ã€‚ä¸ç™»å½•ä¹Ÿå¯ä»¥ï¼Œåªä¸è¿‡åœ¨ç®¡ç†ç¤¾äº¤ç½‘ç»œæ–¹é¢ä¼šæœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œä¹‹åä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æ¥è¿›è¡Œç™»å½•ã€‚</p><p>æˆ‘æ³¨å†Œäº†ä¸€ä¸ªFlipboardè´¦å·ï¼Œå¹¶ç”¨å…¶æ¥ç™»å½•ã€‚æ¥ä¸‹æ¥å°±ä¼šè·³è½¬åˆ°å¦ä¸€ä¸ªç•Œé¢ï¼Œé€‰æ‹©è¦è®¢é˜…çš„å†…å®¹ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-19-41.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-19-41.png" style="width: 480px; height: 854px;" /></a></div><p>é€‰æ‹©ä½ å–œæ¬¢çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡&ldquo;ç¿»&rdquo;çš„æ‰‹åŠ¿æ¥çœ‹çœ‹ä¸‹ä¸€é¡µçš„å¯è®¢é˜…å†…å®¹ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-19-47.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-19-47.png" /></a></div><p>é€‰æ‹©å®Œæˆï¼Œç‚¹å‡»å³ä¸Šè§’çš„&ldquo;å®Œæˆ&rdquo;æŒ‰é’®ï¼Œå°±å¯ä»¥è¿›å…¥é¦–é¡µäº†ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-22-01.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-22-01.png" /></a></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ&ldquo;å°é¢æ•…äº‹&rdquo;ä¸&ldquo;Flipboardç²¾é€‰&rdquo;ã€&ldquo;æ–°é—»&rdquo;ä¸‰ä¸ªç‰ˆå—ä»¥ä¸€å¤§äºŒå°çš„æ–¹å¼æ’åˆ—åœ¨å±å¹•ä¸Šã€‚</p><p>ç‚¹å‡»&ldquo;å°é¢æ•…äº‹&rdquo;ï¼Œåˆ™æ•´ä¸ªé¡µé¢ä¼šè¢«&ldquo;å°é¢æ•…äº‹&rdquo;æ‰€å æ®ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-22-44.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-22-44.png" /></a></div><p>åœ¨Flipboardä¸­ï¼Œæœ€å¸¸ç”¨çš„æ‰‹åŠ¿å°±æ˜¯&ldquo;ç‚¹å‡»&rdquo;&ldquo;å‘ä¸Šæ»‘&rdquo;&ldquo;å‘ä¸‹æ»‘&rdquo;å’Œ&ldquo;å‘å³æ»‘&rdquo;ã€‚</p><p>ç‚¹å‡»é€šå¸¸ç”¨äºæµè§ˆè¯¦ç»†å†…å®¹å’Œé€‰ä¸­é“¾æ¥å¹¶æŸ¥çœ‹ï¼ŒæŸ¥çœ‹å›¾ç‰‡ï¼ŒæŸ¥çœ‹è§†é¢‘ç­‰ã€‚æ¯”å¦‚åœ¨ä¸Šä¸€å¼ å›¾ä¸­ç‚¹å‡»ï¼Œåˆ™ä¼šè¿›å…¥è¯¦ç»†ä¿¡æ¯é¡µé¢ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-04-11-25-46.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-04-11-25-46.png" style="width: 480px; height: 854px;" /></a></div><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-31-33.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-31-33.png" /></a></div><p>å‘ä¸Šæ»‘é€šå¸¸ç”¨äºç»§ç»­æµè§ˆä¸‹é¢çš„å†…å®¹ã€‚æ¯”å¦‚åœ¨åˆšæ‰çš„&ldquo;å°é¢æ•…äº‹&rdquo;å‘ä¸Šæ»‘ï¼Œåˆ™ä¼šçœ‹åˆ°å…¶ä»–çš„å°é¢æ•…äº‹é¡¹ç›®ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-22-55.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-22-55.png" /></a></div><p>å‘ä¸‹æ»‘é€šå¸¸ç”¨äºå›é¡¾ä¸Šé¢çš„å†…å®¹ï¼Œå’Œåˆ·æ–°æ•´ä¸ªé¡µé¢çš„å†…å®¹ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-30-41.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-30-41.png" /></a></div><p>å‘å³æ»‘ä¸€èˆ¬ç”¨æ¥è¿”å›ä¸Šä¸€ä¸ªé¡µé¢ã€‚</p><p>å¦‚æœæˆ‘æƒ³è®¢é˜…å…¶ä»–é¢‘é“å’Œå†…å®¹å‘¢ï¼Œå¾ˆç®€å•ï¼Œéšæ—¶éšåœ°ç‚¹å‡»å³ä¸Šè§’çš„å°æ——å­ï¼Œå°±å¯ä»¥è¿›å…¥å¿«æ·é¢æ¿ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-23-26.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-23-26.png" style="width: 480px; height: 854px;" /></a></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå³ä¸Šè§’å¯ä»¥å¿«é€Ÿåœ°å‘å¾®åšï¼ˆå½“ç„¶å‰ææ˜¯ä½ é€šè¿‡è´¦å·ç™»å½•ç»‘å®šäº†å¾®åšæˆ–è€…äººäººç­‰ï¼‰ï¼Œä¸‹é¢çš„åˆ—è¡¨å°±æ˜¯åˆ†ç±»äº†ã€‚</p><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-23-38.png" style="width: 480px; height: 854px;" /></div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-24-40.png" style="width: 480px; height: 854px;" /></div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-25-30.png" /></div><p>å¦‚æœéœ€è¦è®¢é˜…ï¼Œåˆ™ç›´æ¥ç‚¹å‡»é¡¹ç›®å³è¾¹çš„åŠ å·å°±å¯ä»¥äº†ã€‚</p><p>æ²¡æœ‰å–œæ¬¢çš„å†…å®¹ï¼Ÿæ²¡å…³ç³»ï¼Œæœç´¢æ¥å¸®ä½ ã€‚æœç´¢ä¸ä½†ä¼šå¸®ä½ æ‰¾åˆ°ç›¸åº”çš„ç‰ˆå—ç”¨äºæ·»åŠ åˆ°è®¢é˜…ï¼Œä¹Ÿå¯ä»¥å¸®ä½ æ‰¾åˆ°å«æœ‰äº›å…³é”®å­—çš„å¾®åšã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-27-02.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-27-02.png" style="width: 480px; height: 854px;" /></a></div><p>Flipboard&ldquo;é€šç”¨ç‰ˆ&rdquo;ä¸&ldquo;å¤©æœç‰ˆ&rdquo;æœ‰ä¸€ä¸ªå°åŒºåˆ«ï¼Œå°±æ˜¯&ldquo;å¤©æœç‰ˆ&rdquo;å¯ä»¥è¿›è¡Œç¦»çº¿ä¸‹è½½ï¼Œä»¥ä¾¿åœ¨ä¿¡å·ä¸å¥½æˆ–è€…ä¸æƒ³æµªè´¹æµé‡æ—¶è¿›è¡Œé˜…è¯»ã€‚çœ‹æ¥çš„ç¡®å¾ˆæœ‰&ldquo;å¤©æœç‰¹è‰²&rdquo;ï¼Œå› ä¸ºå¤©æœçš„ç½‘ç»œä¿¡å·çš„ç¡®æ˜¯å¤ªå·®äº†ï¼Œèµ°å“ªå“ªæ²¡ç½‘ç»œï¼Œè€Œä¸”å¤©æœçš„ç½‘æ˜¯ä¸–ç•Œä¸Šæœ€è´µçš„ï¼Œè°ä¸æƒ³çœç‚¹é’±å•Šã€‚ã€‚ã€‚</p><p>åœ¨é˜…è¯»ç•Œé¢ç‚¹å‡»è®¾å¤‡ä¸Šçš„èœå•æŒ‰é’®ï¼Œå°±å¯ä»¥å¼¹å‡ºä¸€ä¸ªå°èœå•ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-23-45.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-23-45.png" /></a></div><p>Flipboardçš„è®¾ç½®æŒ‰é’®è—å¾—å¾ˆå¦™ï¼Œä¸ä»”ç»†è§‚ç§è¿˜çœŸä¸å¥½æ‰¾ã€‚<br>åœ¨é¦–é¡µï¼Œå‘ä¸‹ç¿»ä¸€é¡µï¼Œçœ‹è§å…¶ä»–è®¢é˜…å†…å®¹çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å³ä¸‹è§’æœ‰ä¸ªå°é½¿è½®ï¼Œè¿™å°±æ˜¯è®¾ç½®ç•Œé¢çš„å…¥å£äº†ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-30-56.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-30-56.png" /></a></div><p>é¡ºé“æä¸€å¥ï¼Œå½“è¿™ä¸ªé¡µé¢ä¸Šçš„å†…å®¹æœ‰æ›´æ–°æ—¶ï¼Œæ¯ä¸€ä¸ªå°å—å—ä¼šåƒç™¾é¡µçª—ä¸€æ ·ç¿»ä¸‹æ¥ï¼Œæ•ˆæœå¾ˆæ£’ã€‚</p><p>Flipboardçš„è®¾ç½®é€‰é¡¹ä¸å¤šï¼Œå…¶å®æ²¡å¿…è¦è®¾ç½®å¤ªå¤šçš„ä¸œè¥¿ï¼Œå› ä¸ºè½¯ä»¶æœ¬èº«çš„è®¾ç½®å·²ç»å¾ˆä¸é”™äº†ã€‚</p><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-29-10.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-01-17-29-10.png" /></a></div><div style="text-align: center;">  <a href="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-04-12-28-30.png"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/Screenshot_2013-02-04-12-28-30.png" style="width: 480px; height: 854px;" /></a></div><p>æ€»çš„æ¥è¯´ï¼ŒFlipboardå¤§èƒ†åœ°å°†ç¤¾äº¤å…ƒç´ é›†ä¸­åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡æ‚å¿—çš„æ–¹å¼å±•ç¤ºåœ¨ç”¨æˆ·é¢å‰ï¼Œæ˜¯ä¸€ç§å¾ˆæœ‰åˆ›æ„çš„è¡Œä¸ºã€‚<br>å½“ç„¶ï¼Œå®ƒä¹Ÿæ˜¯æœ‰ä¸€äº›ä¸è¶³çš„ï¼Œæ¯”å¦‚åœ¨è¿‡æ»¤&ldquo;æ— èŠçš„å†…å®¹&rdquo;æ–¹é¢ï¼Œå°±åšå¾—ä¸å¤ªå¥½ï¼›ä¸Šæ‰‹è¿‡ç¨‹ç¨æ˜¾ç¹çï¼›æ— æ³•é€‰æ‹©&ldquo;åªé˜…è¯»æ–‡å­—&rdquo;ï¼ˆé’ˆå¯¹å°æ°´ç®¡ç”¨æˆ·ï¼‰ç­‰ç­‰ã€‚</p><p>ä½†ä¼˜ç‚¹è¶³ä»¥ç›–è¿‡ç¼ºç‚¹ï¼ŒFlipboardåœ¨iosä¸Šçš„è¡¨ç°æ¯”Androidä¸Šæ›´å¥½ï¼Œä½†æ‰‹è¾¹æ²¡æœ‰iosè®¾å¤‡ï¼Œé‚ä½œç½¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android App </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨GAE+GoAgentç§‘å­¦ä¸Šç½‘</title>
      <link href="//just-try/gae-proxy-goagent/"/>
      <url>//just-try/gae-proxy-goagent/</url>
      
        <content type="html"><![CDATA[<p>ç»ˆäºè¦èŠåˆ°è¿™ä¸ªè¯é¢˜äº†å—ã€‚ã€‚</p><p>å› ä¸ºæˆ‘æœ€è¿‘å‘ç°ï¼ŒGoogleè€æ˜¯å±è”½æˆ‘ï¼Œæˆ‘æœç´¢äº†ä¸€ä¸ªå®Œå…¨ä¸ä¼šè§¦åŠä»»ä½•åº•çº¿çš„è¯ï¼Œç«Ÿç„¶å°±æŠŠæˆ‘Banæ‰äº†ï¼Œå¯¼è‡´å…¨å…¬å¸éƒ½ä¸Šä¸äº†Googleã€‚ã€‚</p><p>ä¹‹å‰æŠ˜è…¾è¿‡GAE+GoAgentï¼Œä¹ŸæˆåŠŸè¿‡ï¼Œåæ¥å‘ç°æ²¡ä»€ä¹ˆå¤§ç”¨ï¼Œå› ä¸ºä¸Šç­æ—¶åˆä¸èƒ½è€æŒ‚ç€GoAgentï¼Œæ¯•ç«Ÿç”¨å†…ç½‘çš„æ—¶å€™è¿˜æ˜¯å±…å¤šçš„ã€‚ä½†è¿™æ¬¡å®åœ¨æ˜¯å¿ä¸äº†äº†ï¼Œå¯¹ä¸èµ·äº†ï¼Œä¼Ÿå¤§çš„GFWï¼Œæˆ‘è¦è·ƒè¿‡ä½ ä¸«çš„ã€‚  </p><span id="more"></span><p>åºŸè¯ä¸è¯´ï¼Œå…ˆå»åˆ›å»ºä¸€ä¸ªGoogleçš„è´¦å·ï¼Œå¦‚æœä½ æ²¡æœ‰è´¦å·çš„è¯ï¼Œé‚£è¿˜èŠä»€ä¹ˆèŠã€‚<br>&nbsp;</p><h4 id="ä¸€ã€ç”³è¯·Google-Appid"><a href="#ä¸€ã€ç”³è¯·Google-Appid" class="headerlink" title="ä¸€ã€ç”³è¯·Google Appid"></a>ä¸€ã€ç”³è¯·Google Appid</h4><ol><li>è¿›å…¥<a href="https://appengine.google.com/">Google AppEngine</a>ï¼Œç‚¹å‡»&ldquo;Create Application&rdquo;ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºçš„è¯ï¼Œåº”è¯¥ä¼šæç¤ºè¦è¾“å…¥æ‰‹æœºå·ç è¿›è¡ŒéªŒè¯ï¼Œå¤§èƒ†åœ°éªŒè¯å§ï¼ŒGoogleä¸ä¼šå‘ä½ çš„ã€‚</li></ol><p>éªŒè¯å®Œæˆåï¼Œè¿›å…¥å¦‚ä¸‹ç•Œé¢ï¼š<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205112620.jpg" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205112620.jpg" /></a><br>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºåº”ç”¨çš„è¯ï¼Œä¸‹æ–¹ä¼šæç¤ºåŒæ„è°·æ­Œçš„åè®®ï¼Œå‹¾é€‰ä¸Š&ldquo;I accept these terms.&rdquo;å°±å¯ä»¥äº†ã€‚</p><ol start="2"><li><p>å¡«å†™ä½ çš„Appidï¼Œè®°å¾—æ£€æŸ¥ä¸€ä¸‹å¯ç”¨æ€§ï¼Œå› ä¸ºAppidå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚<br>ç„¶åå¡«å…¥åº”ç”¨çš„åç§°ï¼Œéšä¾¿èµ·å•¦ï¼Œæ¯”å¦‚myagent-byebyeGFWä¹‹ç±»çš„ã€‚ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œåç§°æ˜¯æœ‰è§„å®šçš„ï¼Œ&ldquo;åªèƒ½åœ¨4-30ä¸ªå­—ç¬¦ä¹‹é—´ï¼Œå­—æ¯ã€æ•°å­—ã€å¼•å·ã€è¿å­—ç¬¦ã€é€—å·å’Œå¹å·ä¸ºå¯ç”¨å­—ç¬¦ã€‚&rdquo;ä¹ æƒ¯å†™Cå’ŒJavaçš„åŒå­¦ä»¬è¦æ³¨æ„ï¼Œä¸è¦åŠ ä¸‹åˆ’çº¿ä¸Šå»ã€‚</p></li><li><p>ç‚¹å‡»&ldquo;Create Application&rdquo;ã€‚å¥½å“ï¼Œå‡ºç°å¦‚ä¸‹é¡µé¢ï¼Œè¡¨ç¤ºä½ çš„Appå·²ç»åˆ›å»ºæˆåŠŸäº†ï¼<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205112538.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205112538.jpg"></a><br>ç½‘é¡µä¸Šçš„æ“ä½œå®Œæˆï¼Œæ¥ä¸‹æ¥æ˜¯æœ¬åœ°æ“ä½œã€‚</p></li><li><p>å»<a href="https://code.google.com/p/goagent/">ä¼ é€é—¨</a>è¿™å„¿ä¸‹è½½GoAgentçš„ç¨‹åºåŒ…ï¼Œå¦‚æœä¸‹è½½ä¸äº†çš„è¯ï¼ˆå—¯ï¼Œä½ è¢«å¢™äº†ï¼‰ï¼Œå¯ä»¥ä¸‹è½½æ–‡ç« æœ€åæä¾›çš„é™„ä»¶ã€‚</p></li></ol><p>5.&nbsp;è§£å‹GoAgentåˆ°ä»»æ„ä½ç½®ã€‚è¿›å…¥Serveræ–‡ä»¶å¤¹ï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€pythonæ–‡ä»¶å¤¹ä¸‹çš„app.yamlæ–‡ä»¶ï¼Œå°†ç¬¬ä¸€è¡ŒApplication:your_appidåçš„your_appidæ›´æ¢ä¸ºä½ åˆšæ‰ç”³è¯·çš„appidã€‚ä¿å­˜é€€å‡ºã€‚</p><ol start="6"><li>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒUploader.batï¼Œæç¤ºè¾“å…¥Appidï¼Œè¾“å…¥é‚®ç®±ï¼ˆæ³¨å†ŒGoogleè´¦å·æ—¶çš„é‚®ç®±ï¼‰ï¼Œè¾“å…¥å¯†ç ï¼Œå°±è‡ªåŠ¨å¼€å§‹ä¸Šä¼ äº†ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205113930.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205113930.jpg"></a></li></ol><p>åˆ°æœ€åï¼Œå‡ºç°è¿™ä¸ªä¸œè¥¿ï¼Œå°±è¡¨æ˜æˆåŠŸé¸Ÿã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205122648.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205122648.jpg"></a><br>&nbsp;</p><h4 id="äºŒã€é…ç½®GoAgentå®¢æˆ·ç«¯"><a href="#äºŒã€é…ç½®GoAgentå®¢æˆ·ç«¯" class="headerlink" title="äºŒã€é…ç½®GoAgentå®¢æˆ·ç«¯"></a>äºŒã€é…ç½®GoAgentå®¢æˆ·ç«¯</h4><ol><li><p>è¿›å…¥localæ–‡ä»¶å¤¹ï¼ˆä¸Serveræ–‡ä»¶å¤¹åŒçº§ç›®å½•ï¼‰ï¼Œæ‰“å¼€proxy.iniï¼Œä¿®æ”¹[gae]æ¨¡å—ä¸‹çš„appidå­—æ®µä¸ºä½ åˆšæ‰ç”³è¯·çš„appidã€‚ä¿å­˜é€€å‡ºã€‚</p></li><li><p>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œgoagent.exeï¼Œå‡ºç°æ­¤çª—å£ï¼Œè¿™ä¸ªçª—å£å°±å¼€ç€ï¼Œå®ƒå°±æ˜¯ä½ çš„&ldquo;é—¨&rdquo;ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205122830.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205122830.jpg"></a><br>&nbsp;</p></li></ol><h4 id="ä¸‰ã€å®‰è£…æµè§ˆå™¨æ’ä»¶"><a href="#ä¸‰ã€å®‰è£…æµè§ˆå™¨æ’ä»¶" class="headerlink" title="ä¸‰ã€å®‰è£…æµè§ˆå™¨æ’ä»¶"></a>ä¸‰ã€å®‰è£…æµè§ˆå™¨æ’ä»¶</h4><ol><li>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯chromeæµè§ˆå™¨ï¼Œå»<a href="https://chrome.google.com/webstore/detail/proxy-switchysharp/dpplabbmogkhghncfbfdeeokoefdjegm">è¿™å„¿</a>ä¸‹è½½SwitchySharpæ’ä»¶ï¼Œå®‰è£…ã€‚ç„¶åæ‰“å¼€SwitchySharpï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡»&ldquo;ä»æ–‡ä»¶æ¢å¤&rdquo;å¯¼å…¥ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åœ¨æ–‡ç« æœ€åæä¾›ä¸‹è½½ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205123020.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205123020.jpg"></a></li></ol><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Firefoxæµè§ˆå™¨ï¼Œå»<a href="https://addons.mozilla.org/zh-cn/firefox/addon/foxyproxy-standard/">è¿™å„¿</a>ä¸‹è½½FoxyProxyæ’ä»¶ï¼Œå®‰è£…ã€‚ç„¶åæ‰“å¼€SwitchySharpï¼Œç‚¹å‡»&ldquo;æ–°å»ºä»£ç†æœåŠ¡å™¨&rdquo;ï¼Œæ¥ç€åœ¨&ldquo;æ‰‹åŠ¨é…ç½®ä»£ç†æœåŠ¡å™¨&rdquo;é¡¹ç›®ä¸­è¾“å…¥ipåœ°å€&ldquo;127.0.0.1&rdquo;ï¼Œç«¯å£å·8087ã€‚ç‚¹å‡»ç¡®å®šï¼Œä¼šå¼¹å‡ºä¸€ä¸ªæç¤ºï¼Œé—®ä½ æ˜¯ä¸æ˜¯åœ¨æµè§ˆæ‰€æœ‰çš„ç½‘å€æ—¶éƒ½è¦ä½¿ç”¨ä»£ç†ï¼Œå› ä¸ºä½ æ²¡æœ‰æ·»åŠ ç™½åå•ã€‚ç‚¹å‡»æ˜¯ï¼Œå°±é…ç½®å®Œæˆäº†ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205123725.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205123725.jpg"></a></p><ol start="2"><li>å¯ç”¨æ’ä»¶<br>Chromeä¸­ç‚¹å‡»SwitchySharpæŒ‰é’®ï¼Œé€‰æ‹©&ldquo;GoAgent&rdquo;ï¼Œè®°å¾—æˆ‘ä»¬åˆšæ‰è¿˜å¼€ç€çš„&ldquo;é—¨&rdquo;å—ï¼Ÿç°åœ¨Chromeå°±ä»è¿™é“&ldquo;é—¨&rdquo;é‡Œå‡ºå»äº†ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205124528.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205124528.jpg"></a></li></ol><p>Firefoxä¸­å³é”®ç‚¹å‡»FoxyProxyæŒ‰é’®ï¼Œé€‰æ‹©&ldquo;ä¸ºå…¨éƒ¨URLså¯ç”¨ä»£ç†æœåŠ¡å™¨:127.0.0.1:8087&rdquo;ï¼Œå°±å¯ä»¥äº†ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205123825.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205123825.jpg"></a></p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>å››ã€ç–‘éš¾æ‚ç—‡</p><p>æœ‰çš„æ—¶å€™åœ¨è®¿é—®Twitter, Youtubeæ—¶ä¼šæç¤º&ldquo;è¯¥ç½‘ç«™çš„å®‰å…¨è¯ä¹¦ä¸å—ä¿¡ä»»&rdquo;ï¼Œå¦‚å›¾æ‰€ç¤º<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125036.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125036.jpg"></a></p><p>åŸå› æ˜¯åœ¨ä½¿ç”¨GoAgentä»£ç†çš„æ—¶å€™ï¼ŒTwitterç­‰ç½‘ç«™æ˜¯éœ€è¦SSLåŠ å¯†çš„ï¼ŒGoAgent<br>GoAgentæ˜¯ä¸ªä»£ç†ï¼Œå¥½æ¯”å°±æ˜¯ä¸ªwebæœåŠ¡å™¨ï¼Œä½ é€šè¿‡ä»–æµè§ˆhttpsçš„åŠ å¯†ç½‘é¡µçš„æ—¶å€™ï¼Œè¦åšè®¤è¯å†è½¬å‘ç»™ä½ çš„æµè§ˆå™¨ã€‚å¦‚æœä¸åŠ è¯ä¹¦ï¼Œä½ çš„æµè§ˆå™¨è®¤ä¸ºè¿™ä¸ªhttpsç½‘ç«™æ˜¯ä¼ªé€ çš„ï¼Œä¸è®©ä½ æ‰“å¼€ã€‚ç‰¹åˆ«æ˜¯Chromeå’ŒFirefoxï¼Œè¦æ±‚ä¸­è½¬çš„ä»£ç†ç½‘ç«™æµè§ˆhttpsç½‘é¡µæ˜¯å¿…é¡»è¦è¯ä¹¦ï¼Œå¦åˆ™ä¸èƒ½æ‰“å¼€ã€‚è¿™ä¸ªæ˜¯æµè§ˆå™¨è‡ªèº«çš„é˜²æ­¢é’“é±¼æ”»å‡»çš„å®‰å…¨æ‰‹æ®µã€‚</p><p>è§£å†³çš„åŠæ³•ï¼Œå°±æ˜¯æ‰¾åˆ°åˆšæ‰ä¸‹è½½çš„GoAgentï¼Œåœ¨localæ–‡ä»¶å¤¹é‡Œï¼Œæ‰¾åˆ°CA.crtæ–‡ä»¶ï¼Œå°±æ˜¯GoAgentçš„æä¾›çš„è¯ä¹¦æ–‡ä»¶ï¼ˆä»–ä»¬ä¹Ÿæ˜¯èŠ±é’±ä¹°çš„å“¦ï¼‰ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å¯¼å…¥åˆ°ç³»ç»Ÿä¸­ã€‚  </p><ol><li><p>åŒå‡»æ‰“å¼€CA.crtæ–‡ä»¶ï¼Œå‡ºç°è¯ä¹¦å¯¼å…¥å‘å¯¼ã€‚ç‚¹å‡»&ldquo;å®‰è£…è¯ä¹¦&rdquo;ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125603.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125603.jpg"></a></p></li><li><p>é€‰æ‹©&ldquo;æœ¬åœ°è®¡ç®—æœº&rdquo;ï¼ˆå½“ç„¶ï¼Œé€‰æ‹©&ldquo;å½“å‰ç”¨æˆ·&rdquo;ä¹Ÿå¯ä»¥ï¼Œåªä¸è¿‡åˆ‡æ¢ç”¨æˆ·æ—¶å°±å¤±æ•ˆäº†ï¼‰ï¼Œç‚¹å‡»&ldquo;ä¸‹ä¸€æ­¥&rdquo;ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125618.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125618.jpg"></a></p></li></ol><p>3.&nbsp;é€‰æ‹©&ldquo;å°†æ‰€æœ‰çš„è¯ä¹¦éƒ½æ”¾å…¥ä¸‹åˆ—å­˜å‚¨&rdquo;ï¼Œç‚¹å‡»&ldquo;æµè§ˆ&rdquo;ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125626.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125626.jpg"></a></p><p>4.&nbsp;é€‰æ‹©&ldquo;å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„&rdquo;ï¼Œç‚¹å‡»&ldquo;ç¡®å®š&rdquo;ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125635.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125635.jpg"></a></p><p>5.&nbsp;ç‚¹å‡»&ldquo;ä¸‹ä¸€æ­¥&rdquo;ï¼Œå†ç‚¹å‡»&ldquo;å®Œæˆ&rdquo;ï¼Œå‡ºç°å¯¼å…¥æˆåŠŸçš„çª—å£ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125655.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205125655.jpg"></a></p><p>ä¸ºä»€ä¹ˆè¦è‡ªå·±ç­¾åæ ¹è¯ä¹¦å‘¢ï¼Ÿå› ä¸ºGAEå¹³å°é™åˆ¶ï¼Œæ²¡æ³•æ”¯æŒçœŸæ­£çš„SSLåŠ å¯†ï¼ŒGoAgentåªèƒ½é€šè¿‡ä¼ªé€ è¯ä¹¦çš„æ–¹å¼åšåˆ°ä»£ç†SSLåŠ å¯†çš„ç½‘ç«™ï¼Œè¿™ä¸ªè¯ä¹¦å°±æ˜¯ç”¨æ¥æ¬ºéª—æµè§ˆå™¨çš„ã€‚<br>&nbsp;</p><h4 id="äº”ã€ç©å§"><a href="#äº”ã€ç©å§" class="headerlink" title="äº”ã€ç©å§"></a>äº”ã€ç©å§</h4><p><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205133033.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205133033.jpg"></a></p><p><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205132928.jpg"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/QQ20130205132928.jpg"></a></p><p><a class="readmore" href="http://pan.baidu.com/share/link?shareid=265965&uk=151049050" target="_blank"><img alt="" src="http://cy198706.com/blog/wp-content/uploads/2013/04/download.png" /></a><br>&nbsp;</p>]]></content>
      
      
      <categories>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GAE </tag>
            
            <tag> Google </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ”¯æŒWindows8çš„ä¸€é”®å¤‡ä»½è¿˜åŸå·¥å…· &amp;#8211; OneKeyä¸€é”®å¤‡ä»½/è¿˜åŸ</title>
      <link href="//just-try/onekey-ghost/"/>
      <url>//just-try/onekey-ghost/</url>
      
        <content type="html"><![CDATA[<p>å…¶å®æˆ‘ä¸ªäººä¸å¤ªä¹ æƒ¯ä½¿ç”¨ä¸€é”®å¤‡ä»½/è¿˜åŸï¼Œå› ä¸ºæˆ‘é™¤äº†åˆšå‡ºæ–°çš„æ“ä½œç³»ç»Ÿæ—¶éœ€è¦æŠ˜è…¾ä¸€æ®µæ—¶é—´å¤–ï¼Œå¹³æ—¶å‡ ä¹ä¸é‡è£…ç³»ç»Ÿã€‚å¦‚æœç³»ç»Ÿå‡ºç°é—®é¢˜ï¼Œä¹Ÿèƒ½è‡ªå·±é‡è£…ã€‚</p><p>ä½†æ˜¯å‡¡äº‹éƒ½æœ‰ä¸ªä¸‡ä¸€ã€‚æœ‰çš„æ—¶å€™è¿˜æ˜¯å¤‡ä»½ä¸€ä¸‹æ¯”è¾ƒå¥½ï¼Œæ¯”å¦‚çŠ¯æ‡’çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸€é”®è¿˜åŸæ¥è¿˜åŸå½“æ—¶å¤‡ä»½çš„å®Œç¾æ— ç¼ºçš„ç³»ç»ŸçŠ¶æ€ã€‚</p><p>è¿‡å¹´å›å®¶æ—¶ï¼Œå¸®è€çˆ¸å®‰è£…Windows8ï¼Œä»–ç°åœ¨å¯¹æ“ä½œç³»ç»Ÿè¦æ±‚ä¸é«˜ï¼Œèƒ½ç©ä¸ªæ¸¸æˆï¼ˆä½¿å‘½å¬å”¤å•Šã€å­¤å²›å±æœºå•Šã€æ½œè¡Œè€…å•Šä¹‹ç±»çš„FPSæ¸¸æˆï¼‰ï¼Œèƒ½ä¸Šä¸ªç½‘ï¼Œèƒ½è·Ÿè¿œåœ¨å¸éƒ½çš„æˆ‘è§†é¢‘ä¸€ä¸‹ï¼Œå°±è¶³å¤Ÿäº†ã€‚æ‰€ä»¥ä¸€æ—¦å‡ºç°è‡´å‘½çš„ç³»ç»Ÿé—®é¢˜ï¼Œå°±æ²¡æ³•å­äº†ï¼Œåªèƒ½æ±‚åŠ©äºæˆ‘ã€‚</p><p>ç´¢æ€§ç»™ä»–å®‰è£…ä¸ªä¸€é”®å¤‡ä»½/è¿˜åŸï¼Œå‡ºç°é—®é¢˜å¯ä»¥ä½¿ç”¨æ—¶å…‰æœºå›åˆ°è¿‡å»ã€‚  </p><span id="more"></span><p>OneKeyä¸€é”®è¿˜åŸæ˜¯ä¸€æ¬¾è½»é‡çº§çš„å¤‡ä»½/è¿˜åŸå·¥å…·ï¼Œæ— éœ€å®‰è£…ï¼Œåªéœ€è¦ä¸€ä¸ªexeæ–‡ä»¶å°±èƒ½å·¥ä½œã€‚è®¾ç½®é€‰é¡¹ä¹Ÿä¸å¤æ‚ï¼Œè‡ªåŠ¨æ€§æ¯”è¾ƒé«˜ï¼Œç»æµ‹è¯•æœ‰æ•ˆï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚</p><p>ä¸Šå‡ å¼ çœŸç›¸å›¾ã€‚<br>&nbsp;</p><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20130217155619.jpg" style="width: 449px; height: 373px;" /></div><p>è¿™æ˜¯æ‰“å¼€è½¯ä»¶åçš„ä¸»ç•Œé¢ï¼Œå¯ä»¥é€‰æ‹©&ldquo;è¿˜åŸç³»ç»Ÿ&rdquo;æˆ–è€…&ldquo;å¤‡ä»½ç³»ç»Ÿ&rdquo;ã€‚å½“å‰æ­£åœ¨æ´»åŠ¨çš„ä¸»åˆ†åŒºä¼šåœ¨ä¸‹é¢ä½¿ç”¨ç²—ä½“æ ‡è¯†å‡ºæ¥ã€‚<br>&nbsp;</p><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20130217155639.jpg" style="width: 449px; height: 373px;" /></div><p>é«˜çº§èœå•é€‚åˆæ‡‚å¾—ä¸€äº›ç”µè„‘çŸ¥è¯†çš„äººæ¥æ“ä½œã€‚<br>&nbsp;</p><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20130217155649.jpg" style="width: 449px; height: 373px;" /></div><p>è¿˜å¯ä»¥å°†ä¸€é”®å¤‡ä»½/è¿˜åŸåŠ å…¥ç³»ç»Ÿå¯åŠ¨é¡¹ä¸­ï¼Œå¹¶å¯ä»¥è‡ªå®šä¹‰èœå•çš„åç§°ã€‚å¯¹äºä¸€äº›ä»¥å‰ä¹ æƒ¯ä½¿ç”¨F11å¯åŠ¨&ldquo;ä¸€é”®GHOST&rdquo;ä¹‹ç±»çš„è½¯ä»¶çš„ç”¨æˆ·ï¼Œè¿˜è®¾ç½®äº†&ldquo;çƒ­é”®å¯åŠ¨&rdquo;åŠŸèƒ½ã€‚</p><p>å®‰è£…å®Œæˆåï¼Œåœ¨å¯åŠ¨èœå•å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªå¯åŠ¨é¡¹ï¼š</p><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20130217155712.jpg" /></div><p style="text-align: center;">  é™„ä¸Šä¸‹è½½é“¾æ¥ï¼š<br /> <a class="readmore" href="http://pan.baidu.com/share/link?shareid=324988&uk=151049050"><img alt="" src="http://cy198706.com/blog/wp-content/uploads/2013/04/download.png" style="width: 126px; height: 128px;" /></a></p>]]></content>
      
      
      <categories>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšæ‰‹ä¸€æ‹</title>
      <link href="//pictures/%25e9%259a%258f%25e6%2589%258b%25e4%25b8%2580%25e6%258b%258d/"/>
      <url>//pictures/%25e9%259a%258f%25e6%2589%258b%25e4%25b8%2580%25e6%258b%258d/</url>
      
        <content type="html"><![CDATA[<p>éšä¾¿ä¸€æ‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ã€‚ã€‚<span id="more"></span></p><div style="text-align: center;">  <a href="http://cy198706.com/blog/wp-content/uploads/2013/02/IMG_1414.jpg"><img alt="" src="http://cy198706.com/blog/wp-content/uploads/2013/02/IMG_1414.jpg" style="height: 450px; width: 600px;" /></a></div>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšæ‰‹æ‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†äº«å£çº¸ 1920&amp;#215;1080</title>
      <link href="//pictures/wallpaper_1920x1080/"/>
      <url>//pictures/wallpaper_1920x1080/</url>
      
        <content type="html"><![CDATA[<p>åˆ†äº«ä¸€å¼ å£çº¸å§ï¼Œå‹äººçš„ç«™å…³é—­äº†ï¼Œç°åœ¨æ‰¾å£çº¸åªèƒ½è‡ªåŠ›æ›´ç”Ÿäº†ã€‚ã€‚<br>å¦‚æœæ²¡çŒœé”™ï¼Œåº”è¯¥æ˜¯é˜¿å°”å‘æ–¯å±±çš„ä¸€å¼ å›¾ç‰‡ã€‚<br>ç‚¹å‡»å›¾ç‰‡è¿›å…¥æ— æ°´å°ç‰ˆä¸‹è½½ã€‚ <a href="http://pan.baidu.com/share/link?shareid=370061&uk=151049050"><img src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/the-alps_1920x1080.jpg" alt="wallpaper"></a></p>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨360 &amp;#8211; è°ˆè°ˆç”¨æˆ·éšç§</title>
      <link href="//gabby/why-not-360-talk-about-users-privacy/"/>
      <url>//gabby/why-not-360-talk-about-users-privacy/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h2><p>å¥‡è™360åˆ›ç«‹äº2005å¹´9æœˆï¼Œä¸»è¥ä»¥360å®‰å…¨å«å£«ã€360æ€æ¯’ä¸ºä»£è¡¨çš„å…è´¹ç½‘ç»œå®‰å…¨å¹³å°ï¼ŒåŒæ—¶æ‹¥æœ‰å¥‡è™é—®ç­”ç­‰ç‹¬ç«‹ä¸šåŠ¡ã€‚å²‚ä»Šå¥‡è™360æ‹¥æœ‰360å®‰å…¨æµè§ˆå™¨ã€360ä¿é™©ç®±ã€360æ€æ¯’ã€360è½¯ä»¶ç®¡å®¶ã€360ç½‘é¡µé˜²ç«å¢™ã€360æ‰‹æœºå«å£«ã€360æé€Ÿæµè§ˆå™¨ã€360æœç´¢ç­‰ç³»åˆ—äº§å“ã€‚</p><p>ç°åœ¨360çš„ä¸œè¥¿å·²ç»å äº†å¤§éƒ¨åˆ†ä¸­å›½äººçš„ç”µè„‘äº†ã€‚å…¶æ‹³å¤´äº§å“360å®‰å…¨å«å£«åœ¨å¸‚åœºä¸Šå æœ‰çš„ä»½é¢å·²ç»é«˜è¾¾80%ä»¥ä¸Šï¼Œåœ¨2011å¹´6æœˆåº•ï¼Œå·²æœ‰2äº¿ç”¨æˆ·åœ¨ä½¿ç”¨360çš„äº§å“ï¼Œæ¸—é€ç‡å·²ç»è¾¾åˆ°52.2%ã€‚</p><p>æˆ‘åœ¨ä¸ƒå…«å¹´ä¹‹å‰ï¼Œè¿˜æ˜¯éå¸¸ä¾èµ–360çš„ã€‚å› ä¸ºé‚£æ—¶å€™æˆ‘å¾ˆæ‡’ï¼Œè€Œä¸”æ˜¯ä¸ªç”µè„‘ç™½ç—´ï¼Œæ€»æ˜¯ä¼šè¢«è«åå®‰è£…ä¸Šä¸€äº›ä¸ªåƒåœ¾æ’ä»¶ï¼Œé¦–é¡µæ€»æ˜¯è¢«ç¯¡æ”¹ï¼Œç”¨äº†360ä¹‹åï¼Œå°±å¯ä»¥è½»æ¾åœ°å°†è¿™äº›ä¸œè¥¿è§£å†³æ‰ã€‚<br>åæ¥æœ‰ä¸€æ¬¡è¢«å¼ºåˆ¶å®‰è£…äº†360åï¼Œå®ƒå°±æŠŠæˆ‘çš„ç³»ç»Ÿæå´©æºƒäº†ï¼Œè€Œä¸”è¿å®‰å…¨æ¨¡å¼å’ŒPEéƒ½æ— æ³•è¿›å…¥ï¼Œåªèƒ½é‡è£…ç³»ç»Ÿï¼ŒæŸå¤±äº†ä¸å°‘æ•°æ®ã€‚<br>ç¬¬äºŒæ¬¡è¢«å¼ºåˆ¶å®‰è£…åï¼Œè¿™å­™å­åˆä»¥è¿…é›·ä¸åŠæ©è€³ç›—é“ƒä¹‹åŠ¿æ€æ­»äº†æˆ‘çš„ç”µè„‘ã€‚</p><p>ä»æ­¤å†ä¹Ÿä¸ç”¨360ï¼Œè·Ÿ360æœ‰å…³çš„ä¸€åˆ‡éƒ½è®¨åŒï¼Œæœ‰æ®µæ—¶é—´ç”šè‡³çœ‹åˆ°é»„è·Ÿç»¿çš„ç»„åˆæˆ‘å°±æ¥æ°”ã€‚</p><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/360.png" /></div><p>åæ¥360çš„æµæ°“è¡Œå¾„å¼€å§‹è¢«ä¸–äººæ‰€çŸ¥ï¼Œçªƒå–ç”¨æˆ·éšç§ã€å¼ºåˆ¶å®‰è£…360å®‰å…¨æµè§ˆå™¨ã€æ‚„æ‚„å¸è½½ç«äº‰å¯¹æ‰‹çš„è½¯ä»¶ã€å·å·ä¸Šä¼ ä¸çŸ¥åçš„æ•°æ®åŒ…ã€‚ã€‚è¿™å‡ ç§è¡Œä¸ºåœ¨æ™®é€šäººçœ‹æ¥å¯èƒ½æ²¡ä»€ä¹ˆï¼Œ&ldquo;åªè¦ä¸å¦¨ç¢æˆ‘ç”¨ç”µè„‘å°±è¡Œå‘—&rdquo;ï¼Œå…¶å®è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ360çš„äº§å“åœ¨å„ç§é£å£æµªå°–ä¸‹ï¼Œä¾ç„¶èƒ½åœ¨ä¸­å›½ç»§ç»­ç”Ÿå­˜ä¸‹å»çš„æ ¹æœ¬åŸå› ã€‚å³ä¾¿å®ƒä¸€ç›´åœ¨è¿åè¡Œä¸šè§„åˆ™ã€‚</p><p>2æœˆ26æ—¥çš„ã€Šæ¯æ—¥ç»æµæ–°é—»ã€‹åˆŠç™»äº†ä¸€ç¯‡æ–‡ç« ã€Š<a href="http://epaper.nbd.com.cn/shtml/mrjjxw/20130226/118530.shtml">å¥‡è™360é»‘åŒ£å­ä¹‹è°œï¼šæš—è—åé—¨ç›—å–ç”¨æˆ·éšç§</a>ã€‹ï¼Œç‹ ç‹ åœ°æ­äº†æŠŠ360çš„è€åº•ã€‚  </p><span id="more"></span><h2 id="ä¸€ã€ä½•ä¸ºç”¨æˆ·éšç§"><a href="#ä¸€ã€ä½•ä¸ºç”¨æˆ·éšç§" class="headerlink" title="ä¸€ã€ä½•ä¸ºç”¨æˆ·éšç§"></a><span>ä¸€ã€ä½•ä¸ºç”¨æˆ·éšç§</span></h2><h6 style="text-align: right;">  <span><em>&#8211; è¿™æ˜¯æˆ‘çš„å°ç§˜å¯†</em></span></h6><blockquote><p><span>éšç§æ˜¯ä¸€ç§ä¸å…¬å…±åˆ©ç›Šã€ç¾¤ä½“åˆ©ç›Šæ— å…³ï¼Œå½“äº‹äººä¸æ„¿ä»–äººçŸ¥é“æˆ–ä»–äººä¸ä¾¿çŸ¥é“çš„ä¸ªäººä¿¡æ¯ï¼Œå½“äº‹äººä¸æ„¿ä»–äººå¹²æ¶‰æˆ–ä»–äººä¸ä¾¿å¹²æ¶‰çš„ä¸ªäººç§äº‹ï¼Œä»¥åŠå½“äº‹äººä¸æ„¿ä»–äººä¾µå…¥æˆ–ä»–äººä¸ä¾¿ä¾µå…¥çš„ä¸ªäººé¢†åŸŸã€‚</span></p></blockquote><p><span>å¾ˆç»•å£ã€‚ç®€å•æ¥è¯´ï¼Œéšç§å°±æ˜¯&ldquo;æˆ‘ä¸æƒ³è®©åˆ«äººçœ‹åˆ°æˆ–è€…å¬åˆ°æˆ–è€…ä¹±åŠ¨çš„ä¸œè¥¿&rdquo;ï¼Œæœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯ä¸ªäººæ—¥è®°ã€‚</p> </p><p>  é‚£ä¹ˆæ”¾åˆ°äº’è”ç½‘ä¸Šï¼Œç”¨æˆ·éšç§åŸºæœ¬åŒ…æ‹¬ï¼š<br /> 1. ä¸ªäººä¿¡æ¯ã€‚åŒ…æ‹¬èº«ä»½ä¿¡æ¯ã€è´¢äº§ä¿¡æ¯ã€å®¶åº­ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ç­‰ç­‰ã€‚<br /> 2. å¯†ç ã€‚ç™»å½•ç½‘ç«™ã€è®ºå›éœ€è¦å¯†ç ï¼›ç™»å½•ç½‘é“¶ã€ç½‘ä¸Šæ”¯ä»˜äº¤æ˜“éœ€è¦å¯†ç ï¼›ç™»å½•é‚®ç®±éœ€è¦å¯†ç ï¼›ç©ç½‘ç»œæ¸¸æˆéœ€è¦å¯†ç ï¼Œå¯†ç ä¹Ÿå±äºç”¨æˆ·éšç§ã€‚<br /> 3. é‚®ç®±åœ°å€ã€‚åœ¨æ³¨å†Œä¸€äº›ç½‘ç«™ï¼ˆç°åœ¨å‡ ä¹æ‰€æœ‰ç½‘ç«™ï¼‰æ—¶ï¼Œéƒ½ä¼šè¦æ±‚è¾“å…¥é‚®ç®±åœ°å€ï¼Œä½†å¦‚æœé€‰æ‹©ä¸å…¬å¼€ï¼Œç½‘ç«™ä¸€èˆ¬ä¼šæ‰¿è¯ºä¸å…¬å¼€é‚®ç®±ï¼Œåªä¾›ç”¨æˆ·å¿˜è®°å¯†ç æ—¶å‘é€é‡ç½®é“¾æ¥ä½¿ç”¨ã€‚é‚®ç®±ä¹Ÿæ˜¯ç”¨æˆ·éšç§ã€‚<br /> 4. ç½‘ç»œæ´»åŠ¨è¸ªè¿¹ã€‚åŒ…æ‹¬IPåœ°å€ã€ç½‘ç«™æµè§ˆå†å²ã€Cookies<a href="#comm1"><span style="color:#b22222;"><sup>æ³¨1</sup></span></a>ã€è®°å½•è¡¨å•ã€ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€ç”¨æˆ·åœ¨ä¸ªäººç”µè„‘ä¸Šçš„ä¸€åˆ‡åŠ¨ä½œç­‰ã€‚</p><p>  å¯ä»¥çœ‹å‡ºï¼Œåœ¨ç½‘ç»œä¸Šï¼Œè¦æ³¨æ„çš„ä¸œè¥¿æ›´å¤šï¼Œç”¨æˆ·éœ€è¦ä¿å¯†çš„ï¼Œæ¯”åœ¨ç°å®ç”Ÿæ´»ä¸­è¦å¤æ‚çš„å¤šã€‚éš”å£ç‹è€äºŒåœ¨å¤–é¢æœ‰ä¸ªå°ä¸‰ï¼ŒåŒäº‹ä»Šå¤©æ—©ä¸Šè¸©é¦™è•‰çš®æ»‘å€’æ‰äº†é¢—ç‰™ï¼ŒXXæ˜æ˜Ÿè·ŸXXæ˜æ˜ŸåŒå®¿åŒé£ï¼Œæå¤§å˜´çœŸæ­£çš„èº«ä»½æ˜¯å›½å®‰å±€å±€é•¿ï¼Œæ˜¨å¤©è‹è€å¸ˆçš„ç‰‡å­å¾ˆå¥½çœ‹ã€‚ã€‚è¿™äº›éšç§çš„ä¿æŠ¤æ–¹å¼å¾ˆç®€å•&#8211;ç®¡å¥½ä½ çš„å˜´ã€‚<br /> ä½†åœ¨ç½‘ç»œä¸Šå°±ä¸ä¸€æ ·äº†ï¼Œé™¤éä½ æ‹”æ‰ç½‘çº¿ä¸€äº†ç™¾äº†ï¼Œå¦åˆ™è¢«å¨é€¼åˆ©è¯±çš„ITæ”»åŸç‹®ä»¬ä¼šç”¨å„ç§å¥‡è‘©æ–¹å¼æ”»ç ´ä½ çš„é˜²çº¿ï¼Œçªƒå–ä½ çš„éšç§ã€‚ä»ä½ çš„ç³»ç»Ÿï¼Œä½ çš„ç¡¬ç›˜ï¼Œä½ çš„é¼ æ ‡ã€é”®ç›˜ã€æ‘„åƒå¤´ã€Uç›˜ï¼Œä»ä»»ä½•åœ°æ–¹çªƒå–ä¿¡æ¯ã€‚</p><p>  äº’è”ç½‘ä¸Šæœ‰å¥åè¨€ï¼š&ldquo;åœ¨ç½‘ä¸Šï¼Œæ²¡äººçŸ¥é“ä½ æ˜¯ä¸€æ¡ç‹—<a href="#comm2"><span style="color:#b22222;"><sup>æ³¨2</sup></span></a>&rdquo;ï¼Œç”¨ä»¥æè¿°äº’è”ç½‘çš„åŒ¿åç‰¹æ€§ã€‚ä½†æ˜¯ç°åœ¨å†è¯´è¿™å¥è¯ï¼Œå°±çœŸæœ‰ç‚¹ä¸è´Ÿè´£ä»»äº†ã€‚</span></p><p style="text-align: center;">  <span><img alt="åœ¨ç½‘ä¸Šæ²¡äººçŸ¥é“ä½ æ˜¯ä¸€æ¡ç‹—" src="http://upload.wikimedia.org/wikipedia/zh/f/f8/Internet_dog.jpg" style="width: 300px; height: 335px;" /></span></p><p style="text-align: center;">  <span><span style="font-family:arial,helvetica,sans-serif;"><cite><em>å›¾ç‰‡æ¥è‡ªç»´åŸºç™¾ç§‘</em></cite></span></span></p><p>  <span>ç»Ÿè®¡/å¹¿å‘Šå•†å¯ä»¥é€šè¿‡ä½ æµè§ˆäº’è”ç½‘çš„ä¹ æƒ¯ï¼Œåœ¨å‡ æ¯«ç§’å†…æ¨æ–­å‡ºä½ çš„èº«ä»½ï¼Œå¹¶ä¸”ç²¾å‡†åœ°ç»™ä½ æŠ•æ”¾ä½ å¯èƒ½ä¼šå–œæ¬¢çš„å¹¿å‘Šã€‚è¿™äº›&ldquo;ä¹ æƒ¯&rdquo;æ˜¯ä»Cookiesæˆ–è€…æ˜¯è·Ÿè¸ªæ¶ˆæ¯ä¸­è·å–çš„ã€‚å‡å¦‚åä¸ºLuckyçš„ç‹—ç‚¹å‡»äº†ä¸‰äº”ä¸ªå…³äºç‹—ç²®çš„ç½‘ç«™çš„è¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡æ‰“å¼€æµè§ˆå™¨ï¼Œå¼¹å‡ºçš„ä¼šæ˜¯å…³äºç‹—ç²®å’Œåˆ·æ¯›å™¨çš„å¹¿å‘Šï¼Œè€Œä¸æ˜¯å…³äºé©¬æ¡¶çš„å¹¿å‘Šã€‚ç°åœ¨ä¸»æµæµè§ˆå™¨éƒ½è®¾æœ‰&ldquo;Do Not Track&rdquo;çš„åŠŸèƒ½æˆ–æ’ä»¶ï¼Œå¯ä»¥é˜»æ­¢ç¬¬ä¸‰æ–¹ç»Ÿè®¡/å¹¿å‘Šå•†è·å–ä½ çš„æµè§ˆå†å²ã€‚ä½†è¿™æ ·ä¹Ÿä¼šå¯¼è‡´ä½ åœ¨æµè§ˆæœ‰å¹¿å‘Šçš„ç½‘ç«™æ—¶ï¼Œç¬¬ä¸‰æ–¹ç»Ÿè®¡/å¹¿å‘Šå•†ç»™ä½ æŠ•æ”¾ä¸€äº›æ— å˜å¤´çš„å¹¿å‘Šï¼Œå…¶å®åŒæ–¹éƒ½ä¸è®¨å¥½ã€‚</p>     <p>    å½“ç„¶ï¼Œè¿™é‡Œè®¨è®ºçš„ç”¨æˆ·éšç§ä¸ä»…é™äºä¸ªäººç”µè„‘ï¼Œæ‰‹æœºé‡Œçš„éšç§ä¹ŸåŒæ ·é‡è¦ã€‚è”ç³»äººã€çŸ­ä¿¡ã€æ—¥ç¨‹å®‰æ’ã€æµè§ˆå™¨å†å²ç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥å½’åˆ’åœ¨ç”¨æˆ·éšç§ä¸­ã€‚æ¯”è¾ƒæ˜æ˜¾çš„ä¾‹å­æ˜¯å®‰å“æ‰‹æœºç”¨æˆ·åœ¨å®‰è£…è½¯ä»¶æ—¶ï¼Œä¼šæç¤ºè¯¥è½¯ä»¶çš„æƒé™ï¼ŒåŒ…æ‹¬è”ç½‘æƒé™ã€è¯»å–SDå¡ã€è¯»å–è”ç³»äººç­‰ã€‚å¦‚æœä½ ä¸‹è½½äº†ä¸€ä¸ªæ¨ç®±å­æ¸¸æˆï¼Œä½†è¿™ä¸ªæ¸¸æˆå´æœ‰ç€è¯»å–è”ç³»äººã€æ‹¨æ‰“ç”µè¯ã€å‘é€çŸ­ä¿¡ã€æ›´æ”¹ç³»ç»Ÿæ–‡ä»¶ç­‰æƒé™ï¼Œä½ è¿˜ä¼šç”¨å—ï¼Ÿä½ æ ¹æœ¬ä¸çŸ¥é“åœ¨æ¸¸æˆåœ¨åå°åšç€ä»€ä¹ˆï¼Œä¹Ÿè®¸ä½ åœ¨äº«å—ç€æ¨æ¨ä¹çš„åŒæ—¶ï¼Œä½ è·Ÿä½ MMçš„ç”œè¨€èœœè¯­å·²ç»è¢«ä¸Šä¼ åˆ°ä¸€ä¸ªä¸çŸ¥åçš„æœåŠ¡å™¨å»äº†ã€‚è¿™å…¶å®å·²ç»ä¾µçŠ¯äº†ç”¨æˆ·çš„åˆæ³•æƒç›Šäº†ã€‚  </p>    <p>    å¦‚æœä¸Šé¢è¿™äº›è¿˜æ˜¯&ldquo;å°Case&rdquo;çš„è¯ï¼Œä¸‹é¢çš„ä¼šè®©ä½ æ‰‹å¿ƒå†’æ±—çš„ï¼š<br /> æ³¨å†Œäº†ä¸€ä¸ªç¤¾äº¤ç½‘ç«™ï¼Œç½‘ç«™è¯´&ldquo;æˆ‘ä»¬åªæ¥å—å®ååˆ¶çš„ä¼šå‘˜å“Ÿäº²&rdquo;ï¼Œä½ å°±å‘Šè¯‰äº†ä»–ä½ çš„åå­—ï¼Œä½ çš„èº«ä»½è¯å·ï¼Œæˆ·å£æ‰€åœ¨åœ°ï¼Œè€å®¶åœ¨å“ªé‡Œï¼Œæœ‰æ²¡æœ‰å¯¹è±¡ï¼Œæœ‰æ²¡æœ‰æˆ¿å­ï¼Œæœ‰æ²¡æœ‰æ±½è½¦ï¼Œåœ¨å“ªé‡Œä¸Šå­¦ï¼Œåœ¨å“ªé‡Œä¸Šç­ï¼›ä¸ºäº†é˜²æ­¢è´¦å·è¢«ç›—ï¼Œä¹Ÿæ–¹ä¾¿å‚ä¸æ´»åŠ¨æ—¶æŠ½å¥–é€å¥–å“é€ç°é‡‘ï¼Œä½ åˆå‘Šè¯‰äº†ä»–ä½ ç°åœ¨çš„ä½å€ï¼Œä½ çš„æ‰‹æœºå·ï¼Œä½ çš„é“¶è¡Œå¡æˆ–è€…ä¿¡ç”¨å¡å·ï¼›ä¸ºäº†æ¨èä½ çš„æœ‹å‹ä»¬ä¹Ÿåˆ°è¿™é‡Œæ¥ä»è€Œå½¢æˆä¸€ä¸ªå°åœˆå­æ–¹ä¾¿äº¤æµï¼Œä½ åˆä¸Šä¼ äº†ä½ çš„é€šè®¯å½•ï¼Œç»™å„ç§äº²æˆšæœ‹å‹å‘æ³¨å†Œé“¾æ¥ã€‚ã€‚ä½ çš„æ‰€æœ‰ä¿¡æ¯éƒ½äº¤ç»™äº†è¿™ä¸ªç¤¾äº¤ç½‘ç«™çš„æ•°æ®åº“ã€‚å¦‚æœè¿™ä¸ªç½‘ç«™éµå®ˆæ¸¸æˆè§„åˆ™çš„è¯ï¼Œé‚£è¿˜å¥½ï¼Œåä¹‹åˆ™ä¸æ•¢æƒ³åƒã€‚  </p>    <p>    å…³é”®æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯ä½ è‡ªæ„¿çš„ã€‚ä»€ä¹ˆï¼Ÿä½ è¯´äººå®¶æœ‰&ldquo;éšç§æ¡æ¬¾å£°æ˜&rdquo;ï¼Ÿæˆ‘åªèƒ½è¯´&ldquo;è¯´å‡ºå»çš„è¯æ³¼å‡ºå»çš„æ°´ï¼Œæ”¶å›æ¥çš„ä¹Ÿæ˜¯è„æ°´&rdquo;ã€‚  </p>    <p>    å…¶å®æœ‰å…³éšç§çš„æ¦‚å¿µï¼Œæ˜¯å› äººè€Œå¼‚çš„ã€‚ä»»ä½•ä¸ä½ æœ‰å…³çš„å†…å®¹ï¼Œéƒ½å¯èƒ½æ˜¯éšç§ï¼Œæ— éé‚£äº›èƒ½ç›´æ¥å…³è”åˆ°ä½ èº«ä»½ä¿¡æ¯çš„å†…å®¹ï¼Œæ›´ä¸ºé‡è¦è€Œæ•æ„Ÿã€‚æœ‰äº›äººä¸åœ¨ä¹éšç§ï¼Œé‚£è¿™äº›ä¸œè¥¿å°±æ— æ‰€è°“äº†ï¼Œç ´ç½å­ç ´æ‘”äº†ï¼›æœ‰äº›äººç‰¹åˆ«åœ¨ä¹éšç§ï¼Œé‚£ä¹ˆåœ¨ä¿æŠ¤éšç§ä¸Šå°±è¦å¤šåŠ æ³¨æ„ä¸€ç•ªã€‚</span>  </p>    <h2>    <span>äºŒã€ä¸ºä»€ä¹ˆè¦ä¿æŠ¤ç”¨æˆ·éšç§</span>  </h2>    <h6 style="text-align: right;">    <span><em>&#8211; ç”¨å››å­—æˆè¯­æ¥è¯´&ldquo;å…³ä½ å±äº‹&rdquo;</em></span>  </h6>    <p>    <span>æœ‰ä¸€å¤©ï¼ŒAå…¬å¸æ¥æ‰‹äº†ä½ å®¶å°åŒºçš„ç®¡ç†ä¸šåŠ¡ï¼Œå¹¶æ‰¿è¯ºæ‰€æœ‰å®‰ä¿å’Œç‰©ä¸šéƒ½æ˜¯å…è´¹çš„ï¼Œä»£ä»·æ˜¯æŠŠä½ æ‰€èƒ½çœ‹è§çš„ä¸œè¥¿éƒ½æ¢æˆAå…¬å¸æ——ä¸‹çš„ã€‚åœè½¦åœºã€è‡ªæ¥æ°´ã€æš–æ°”ã€èŠ±å›­ï¼Œéƒ½æ˜¯Aå…¬å¸çš„äº§å“ã€‚ä½ æƒ³äº†æƒ³ï¼Œå†³å®šä½¿ç”¨ä»–ä»¬çš„å®‰ä¿å¥—é¤ï¼Œå°±å› ä¸ºè¿™ä¸€åˆ‡éƒ½æ˜¯å…è´¹çš„ã€‚</p>     <pre><code>&lt;p&gt;  è¿™å¤©æ™šä¸Šä½ å¤§åƒäº†ä¸€é¡¿ï¼Œä½†æ˜¯ä¸çŸ¥è‚¿ä¹ˆçš„ï¼Œåƒåäº†è‚šå­ï¼Œå½“ä½ æ€¥æ€¥å¿™å¿™å†²åˆ°è‡ªå®¶å•æ‰€ï¼Œä¸€é€šä¹±æªä¹±ç‚®åï¼Œçªç„¶å‘ç°ï¼Œæœ‰ä¸ªäººæ­£åœ¨ä½ æ—è¾¹ç›¯ç€ä½ ã€‚æ¯›éª¨æ‚šç„¶çš„åŒæ—¶ï¼Œä½ ä¸ç¦é—®é“ï¼šä½ æ˜¯è°ï¼Œæ¥è¿™é‡Œå¹²ä»€ä¹ˆï¼Ÿé‚£ä¸ªäººä¸ç´§ä¸æ…¢åœ°è¯´ï¼šæˆ‘æ˜¯Aå…¬å¸çš„ï¼Œå‡ºäºå¯¹ä½ å®‰å…¨çš„è€ƒè™‘ï¼Œæˆ‘æœ‰æƒåœ¨è¿™é‡Œç›‘è§†ä½ ã€‚å½“ä½ ç¾æ„¤éš¾å½“çš„æ—¶å€™ï¼Œä½ çªç„¶å‘ç°ï¼Œä½ çš„å•æ‰€ï¼Œä½ çš„å¨æˆ¿ï¼Œä½ çš„å±‹å­ï¼Œä½ çš„åºŠï¼Œç”šè‡³ä½ çš„å†°ç®±ï¼Œè¡£æ¶ä¸Šéƒ½æœ‰æ‘„åƒå¤´ï¼Œè€Œä¸”æ‰€æœ‰çš„æ‘„åƒå¤´éƒ½æ˜¯ä¸ºä¿æŠ¤ä½ çš„å®‰å…¨ï¼Œæ‰çªƒå–ä½ çš„éšç§çš„ã€‚&lt;/p&gt;&lt;p&gt;  ä½ æ‰€åšçš„äº‹æƒ…ï¼Œå¤©çŸ¥ï¼Œåœ°çŸ¥ï¼Œä½ çŸ¥ï¼ŒAå…¬å¸çŸ¥ã€‚&lt;/p&gt;&lt;p&gt;  çªç„¶æœ‰ä¸€å¤©ï¼Œå¤©Aå…¬å¸çš„ç½‘ç»œè¢«æŸä½é«˜äººå…¥ä¾µäº†ï¼Œå› ä¸ºæ•´ä¸ªå°åŒºåœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œè¿™ä½é«˜äººæŠŠä½ åœ¨å®¶é‡Œå¹²çš„æ‰€æœ‰äº‹æƒ…ï¼Œå¹¿æ’­ç»™äº†æ•´ä¸ªå°åŒºçš„äººã€‚&lt;/p&gt;&lt;p&gt;  äºæ˜¯ï¼Œæœ¬æ¥æ‰“ç®—è·Ÿä½ çº¦ä¼šä½ çš„3å·æ¥¼çš„ç‹ç¾ä¸½ï¼Œçªç„¶è¯´&amp;ldquo;å‘ƒä»Šå¤©æœ‰äº‹ä¸èƒ½å»äº†å¯¹ä¸èµ·å†è§ä½ æ˜¯ä¸ªå¥½äºº&amp;rdquo;ï¼›é‚»å±…æäºŒå§å®¶å‡ºæ¥é›ç‹—ï¼Œå†ä¹Ÿä¸å…è®¸å®ƒå®¶çš„ç‹—è¿‡æ¥è¹­ä½ çš„è…¿ï¼›ä½ çš„ç”µè¯ç»å¸¸æ¥åˆ°éªšæ‰°ç”µè¯å’ŒçŸ­ä¿¡ï¼›å°åŒºé—¨å£å–èœçš„å–ç»™ä½ çš„æ—¶å€™ç‰¹åˆ«è´µï¼›ä½ çš„WOWè´¦å·è¢«æ‰’å¾—ä¸€å¹²äºŒå‡€ã€‚ã€‚ä¸€åˆ‡çš„ä¸€åˆ‡ï¼ŒåŸå› éƒ½æ˜¯ä»–ä»¬çŸ¥é“äº†ä½ çš„éšç§ï¼Œå³ä½¿ä½ ä¼ªè£…å¾—å†å¥½ï¼Œåˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;  ä½ æ€¥æ€¥å¿™å¿™åœ°é€€æ‰Aå…¬å¸çš„æ‰€æœ‰ä¸šåŠ¡ï¼Œä½†å´å‘ç°ï¼Œåœ¨ä½ æ‰“ç®—é€€ä¸šåŠ¡çš„æ—¶å€™ï¼ŒAå…¬å¸æš—ä¸­åšç¥Ÿï¼Œåƒèˆ¬é˜»æŒ ä¸‡èˆ¬éªšæ‰°ï¼Œè®©ä½ æ— æ³•æˆåŠŸé€€æ‰å®ƒï¼Œå¹¶ä¸”å®ƒå·²ç»å·å·æŒ¤æ‰äº†åˆ«çš„ç‰©ä¸šå…¬å¸ï¼Œè®©ä½ &amp;ldquo;ä¸å¾—ä¸ç”¨&amp;rdquo;ã€‚&lt;/p&gt;&lt;p&gt;  äºæ˜¯ä½ çš„ç”Ÿæ´»é™·å…¥æ··ä¹±ã€‚ã€‚&lt;/p&gt;&lt;p&gt;  è¯šç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå‡æƒ³ï¼Œä½†åœ¨ç”¨æˆ·éšç§æ—¥ç›Šé‡è¦çš„ä»Šå¤©ï¼Œä¿æŠ¤ç”¨æˆ·éšç§å·²ç»æˆä¸ºäº†å½“åŠ¡ä¹‹æ€¥ã€‚&lt;/p&gt;&lt;p&gt;  å¹³æ—¶æˆ‘ä»¬æ¥åˆ°çš„&amp;ldquo;æ¨é”€ä¿é™©&amp;rdquo;ã€&amp;ldquo;å°å§ä½ çš„æˆ¿å­å–ä¸å–&amp;rdquo;ã€&amp;ldquo;è°ƒæŸ¥é—®å·&amp;rdquo;ç­‰éªšæ‰°ç”µè¯ï¼Œæ˜¯ç¨‹åº¦æ¯”è¾ƒè½»å¾®çš„éšç§æ³„éœ²ï¼Œä»–ä»¬çŸ¥é“çš„å¯èƒ½ä»…æœ‰ä½ çš„å°‘é‡ä¿¡æ¯ã€‚è€Œä¸”ä½ ä¸å¿…æƒŠè®¶ä»–ä»¬æ˜¯æ€ä¹ˆè·å¾—è¿™äº›ä¿¡æ¯çš„ï¼Œæˆ‘è¯´è¿‡ï¼Œ&amp;ldquo;éšç§ä¿æŠ¤æ¡æ¬¾&amp;rdquo;éƒ½æ˜¯å±è¯ï¼Œä½ æœ€ç›¸ä¿¡çš„é“¶è¡Œä¹Ÿä¼šä¸ºäº†é’±å‡ºå–ä½ ã€‚&lt;/p&gt;&lt;p&gt;  ç°åœ¨ä½ çŸ¥é“ä¿æŠ¤éšç§çš„é‡è¦æ€§äº†å§ã€‚&lt;/p&gt;&lt;p&gt;  &lt;/span&gt;&lt;/p&gt;&lt;h2&gt;  ä¸‰ã€å¦‚ä½•ä¿æŠ¤ç”¨æˆ·éšç§&lt;/h2&gt;&lt;h6 style=&quot;text-align: right;&quot;&gt;  &amp;#8211; ä½ å¦ˆå«ä½ å›å®¶åƒé¥­ï¼&lt;/h6&gt;&lt;p&gt;  å·¥ä¿¡éƒ¨åœ¨2011å¹´å¹´åˆå‘å¸ƒäº†ã€Šäº’è”ç½‘ä¿¡æ¯æœåŠ¡å¸‚åœºç§©åºç›‘ç£ç®¡ç†æš‚è¡ŒåŠæ³•(å¾æ±‚æ„è§ç¨¿)ã€‹ï¼ˆä»¥ä¸‹ç®€ç§°ã€Šå¾æ±‚æ„è§ç¨¿ã€‹ï¼‰ï¼Œåœ¨ä¿æŠ¤ç”¨æˆ·éšç§æ–¹é¢æå‡ºæ˜ç¡®è¦æ±‚: äº’è”ç½‘ä¼ä¸šåº”å°Šé‡ç”¨æˆ·éšç§, ç»´æŠ¤ä¸ªäººä¿¡æ¯å®‰å…¨, è§„èŒƒä¸ªäººä¿¡æ¯å¤„ç†è¡Œä¸ºã€‚æœªç»æ³•å¾‹æ³•è§„çš„æ˜ç¡®æˆæƒæˆ–ç”¨æˆ·çš„æ˜ç¤ºåŒæ„, äº’è”ç½‘ä¼ä¸šä¸å¾—æ“…è‡ªæ”¶é›†å’Œå¤„ç†ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€‚å¯ä»¥è‚¯å®šçš„æ˜¯,ã€Šå¾æ±‚æ„è§ç¨¿ã€‹ä¸­å¯¹äºä¿æŠ¤ç”¨æˆ·éšç§çš„è¦æ±‚å°†ä¼šå¯¹ä»Šåçš„è·µè¡Œäº§ç”Ÿéœ‡æ…‘, ä¸€åœºå…³ä¹ç½‘ç»œéšç§æƒçš„ä¿å«æˆ˜å³å°†æ‰“å“ã€‚&lt;/p&gt;&lt;p&gt;  åšä¸ºæ™®é€šç½‘æ°‘ï¼Œæœ‰æ³•å¾‹æ­¦å™¨å¹¶ä¸è¡¨ç¤ºå°±å®‰å…¨äº†ï¼Œæ¯•ç«Ÿå¾ˆå¤šæ—¶å€™æ³•å¾‹æ˜¯å¤Ÿä¸åˆ°çš„ï¼Œå¦åˆ™ä¹Ÿå°±ä¸ä¼šæœ‰é‚£ä¹ˆå¤š&amp;ldquo;æ“¦è¾¹çƒ&amp;rdquo;äº†ã€‚æˆ‘ä»¬å¿…é¡»ä¹Ÿé‡‡å–é€‚å½“çš„æªæ–½ï¼Œä¿æŠ¤è‡ªå·±çš„éšç§ã€‚&lt;/p&gt;&lt;div style=&quot;text-align: center;&quot;&gt;  &lt;img alt=&quot;&quot; src=&quot;http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/01300000329092127073620955652.jpg&quot; /&gt;&lt;/div&gt;&lt;p&gt;  ä¸Šæ–‡æåˆ°è¿‡&amp;ldquo;Do Not Track&amp;rdquo;åŠŸèƒ½ï¼Œ&amp;ldquo;Do Not Track&amp;rdquo;æ ‡è®°ä¼šå‘ç½‘ç«™å‘é€ä¸€ä¸ªä¿¡å·ï¼Œè¡¨ç¤ºä½ ä¸æ„¿æ„åˆ«äººåœ¨ä½ æµè§ˆç½‘ç«™æ—¶æ”¶é›†ä½ å¯¹è¯¥ç½‘ç«™çš„è®¿é—®ä¿¡æ¯ç”¨ä»¥è·Ÿè¸ªä½ ã€‚è¯¥åŠŸèƒ½åœ¨IE9å‘å¸ƒæ—¶è¢«æå‡ºæ¥ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥é˜»æ­¢ç¬¬ä¸‰æ–¹å¹¿å‘Šä»£ç†å•†é€šè¿‡Cookiesè·å–ç”¨æˆ·ä¿¡æ¯ã€‚ä½†è¿™ä¸ªåŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ç”¨æˆ·è‡ªè¡Œå¼€å¯ï¼Œå¹¶æ·»åŠ TPLï¼ˆ&amp;ldquo;Tracking Protect List&amp;rdquo;ï¼‰æ¥æ­£ç¡®è¿è¡Œã€‚&lt;/p&gt;&lt;div style=&quot;text-align: center;&quot;&gt;  &lt;img alt=&quot;&quot; src=&quot;http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/do_not_track_1.png&quot; style=&quot;width: 615px; height: 275px;&quot; /&gt;&lt;/div&gt;&lt;div&gt;  &lt;br /&gt; åƒChromeã€Firefoxæµè§ˆå™¨ä¹Ÿæœ‰æ­¤åŠŸèƒ½ï¼Œä½†å…¶å®æœ€æ–¹ä¾¿çš„åŠæ³•å°±æ˜¯å®‰è£…ä¸€ä¸ªåä¸ºAdBlock Plusçš„æ’ä»¶ï¼Œå¯ä»¥å±è”½ç½‘é¡µä¸Šçš„å¹¿å‘Šï¼Œä¹Ÿå°±å¯ä»¥ä»æ ¹æœ¬ä¸Šæ–­äº†ä¿¡æ¯è·Ÿè¸ªã€‚&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;  &lt;img alt=&quot;&quot; src=&quot;http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/do_not_track_3.png&quot; /&gt;&lt;/div&gt;&lt;p&gt;  ä¸è¦ä½¿ç”¨360çš„ä¸œè¥¿ã€‚åœ¨äº’è”ç½‘ä¸Šï¼Œ360å®Œå…¨å¯ä»¥æ‰®æ¼”Aå…¬å¸çš„è§’è‰²ã€‚æƒ³åƒä¸€ä¸‹ï¼Œä½ ä»Šå¤©çœ‹äº†ä»€ä¹ˆç‰‡ï¼Œå¤„ç†äº†ä»€ä¹ˆæ–‡æ¡£ï¼Œä¸Šç½‘çœ‹äº†ä»€ä¹ˆï¼Œè¾“å…¥çš„ç½‘é“¶å¯†ç ï¼Œä¹°çš„ä¸œè¥¿ï¼Œ360å…¨éƒ½çŸ¥é“çš„æ¸…æ¸…æ¥šæ¥šã€‚è€Œä¸”ä½ æ ¹æœ¬ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆæ—¶å€™çªƒå–ä½ çš„éšç§çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2&gt;  å››ã€ç»“è¯­&lt;/h2&gt;&lt;p&gt;  æœ‰ä¸€ä¸ªç½‘ç«™å«&amp;ldquo;&lt;a href=&quot;http://www.xliar.com&quot;&gt;ä¸­å›½è°è¨€æµ‹è¯„ä¸­å¿ƒ&lt;/a&gt;&amp;rdquo;ï¼Œè¿™é‡Œæœ‰ä¸ªç‹¬ç«‹è°ƒæŸ¥å‘˜ä¸ºä¿æŠ¤ä¸­å›½ç½‘æ°‘çš„ç”¨æˆ·éšç§åšäº†å¾ˆå¤šçš„è´¡çŒ®ã€‚å…¶ä¸ç•å¼ºæƒçš„ç²¾ç¥ä¹Ÿå¾—åˆ°äº†å¾ˆå¤šç½‘æ°‘çš„èµèµã€‚ç°å®ä¸­éœ€è¦è¿™æ ·çš„äººï¼Œä¸ä»…éœ€è¦ä»–ä»¬å‹‡äºæŒ‘æˆ˜æƒå¨ï¼Œä¹Ÿéœ€è¦ä»–ä»¬æ¥æé†’æˆ‘ä»¬ï¼Œåº”è¯¥ä¿æŠ¤è‡ªå·±ã€‚&lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;    è™½ç„¶ï¼Œä»–ä»¬çŸ¥é“ï¼Œä»–ä»¬çš„åŠªåŠ›ï¼Œå°±æ˜¯å ‚å‰è¯ƒå¾·å¼çš„ï¼Œä½†å¿…é¡»æœ‰äººå»åšã€‚  &lt;/p&gt;    &lt;p style=&quot;text-align: right;&quot;&gt;    &amp;#8211;ã€Šæ¯æ—¥ç»æµæ–°é—»ã€‹  &lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;  èµ„æ–™ï¼š&lt;br /&gt; 1. &lt;a href=&quot;http://epaper.nbd.com.cn/shtml/mrjjxw/20130226/118530.shtml&quot;&gt;æ¯æ—¥ç»æµæ–°é—» &amp;#8211;&amp;nbsp;å¥‡è™360é»‘åŒ£å­ä¹‹è°œï¼šæš—è—åé—¨ç›—å–ç”¨æˆ·éšç§&lt;/a&gt;&lt;br /&gt; 2. &lt;a href=&quot;http://baike.baidu.com/view/1458023.htm?fromId=815488&quot;&gt;ç™¾åº¦ç™¾ç§‘ &amp;#8211; å¥‡è™360&lt;/a&gt;&lt;br /&gt; 3. &lt;a href=&quot;http://zh.wikipedia.org/wiki/%E5%9C%A8%E7%BD%91%E4%B8%8A%EF%BC%8C%E6%B2%A1%E6%9C%89%E4%BA%BA%E7%9F%A5%E9%81%93%E4%BD%A0%E6%98%AF%E4%B8%80%E6%9D%A1%E7%8B%97&quot;&gt;ç»´åŸºç™¾ç§‘ &amp;#8211; åœ¨äº’è”ç½‘ä¸Šï¼Œæ²¡äººçŸ¥é“ä½ æ˜¯ä¸€æ¡ç‹—&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;div id=&quot;comm1&quot;&gt;  &lt;span style=&quot;color:#b22222;&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;font-family: &#39;times new roman&#39;, times, serif;&quot;&gt;æ³¨1ï¼šCookiesæ˜¯ä¸€ç§æ–‡æœ¬æ–‡ä»¶ï¼Œé‡Œé¢å­˜å‚¨ç€ç”¨æˆ·IDã€å¯†ç ã€æµè§ˆè¿‡çš„ç½‘é¡µã€åœç•™çš„æ—¶é—´ç­‰ä¿¡æ¯ï¼Œæ˜¯ç”¨æˆ·è®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œç½‘ç«™åœ¨ç”¨æˆ·ç”µè„‘é‡Œæ¤å…¥çš„ä¸€ä¸ªæ–‡ä»¶ã€‚é€šè¿‡Cookiesï¼Œç½‘ç«™ä¸ä»…èƒ½å¤ŸçŸ¥é“è¯¥ç”¨æˆ·è®¿é—®äº†å“ªäº›ç½‘ç«™ï¼Œåœç•™äº†å¤šé•¿æ—¶é—´ï¼Œæµè§ˆäº†å“ªäº›ç½‘é¡µç­‰ä¿¡æ¯ã€‚å¯¹äºç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯æœç´¢å¼•æ“æ¥è¯´ï¼Œå…·æœ‰æå¤§çš„å•†ä¸šä»·å€¼ã€‚åŸºäºCookiesé‡Œé¢å­˜å‚¨çš„ä¿¡æ¯ï¼Œç½‘ç«™å¯ä»¥äº†è§£åˆ°è¯¥ç”¨æˆ·çš„ä¸Šç½‘è¡Œä¸ºï¼Œå¹¶æ®æ­¤ç²¾å‡†åœ°å‘ç”¨æˆ·æŠ•æ”¾å•†ä¸šå¹¿å‘Šã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&lt;/div&gt;&lt;div id=&quot;comm2&quot;&gt;  &lt;span style=&quot;color:#b22222;&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;font-family: &#39;times new roman&#39;, times, serif;&quot;&gt;æ³¨2ï¼š&amp;ldquo;åœ¨äº’è”ç½‘ä¸Šï¼Œæ²¡äººçŸ¥é“ä½ æ˜¯ä¸€æ¡ç‹—&amp;rdquo;ï¼ˆOn the Internet, nobody knows you&#39;re a dogï¼‰æ˜¯ä¸€å¥äº’è”ç½‘ä¸Šçš„å¸¸ç”¨è¯­ï¼Œå› ä¸ºä½œä¸ºã€Šçº½çº¦å®¢ã€‹1993å¹´7æœˆ5æ—¥åˆŠç™»çš„ä¸€åˆ™ç”±å½¼å¾—&amp;middot;æ–½æ³°çº³ï¼ˆPeter Steinerï¼‰åˆ›ä½œçš„æ¼«ç”»çš„æ ‡é¢˜è€Œå˜å¾—æµè¡Œã€‚ è¿™åˆ™æ¼«ç”»ä¸­æœ‰ä¸¤åªç‹—ï¼šä¸€åªååœ¨è®¡ç®—æœºå‰çš„ä¸€å¼ æ¤…å­ä¸Šï¼Œä¸ååœ¨åœ°æ¿ä¸Šçš„å¦ä¸€åªç‹—è¯´æ¼«ç”»çš„æ ‡é¢˜ï¼š&amp;ldquo;åœ¨äº’è”ç½‘ä¸Šï¼Œæ²¡äººçŸ¥é“ä½ æ˜¯ä¸€æ¡ç‹—&amp;rdquo;ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> 360 </tag>
            
            <tag> äº’è”ç½‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°èŠ±çš„æ–°å®¶</title>
      <link href="//gabby/977/"/>
      <url>//gabby/977/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹åˆè¯·äº†åŠå¤©å‡ï¼Œåˆ°ç¤¾ä¿ä¸­å¿ƒæ¢å¡ã€‚</p><p>åˆ°äº†ç¤¾ä¿ä¸­å¿ƒä¸€é—®ï¼Œä¸‹åˆä¸¤ç‚¹ä¸Šç­ï¼Œç°åœ¨æ‰ä¸€ç‚¹ã€‚äºæ˜¯æˆ‘å¾€æ—è¾¹ä¸€ç…ï¼Œæœ‰ä¸€ä¸ªå°äº­å­ï¼Œé˜³å…‰è¿˜ä¸é”™ï¼Œæ­£å¥½æ‰‹é‡Œæœ‰ä¸€ä»½ã€Šå‘¨æœ«ç”»æŠ¥ã€‹ï¼Œæˆ‘å†³å®šæŠŠè¿™ä¸€ä¸ªå°æ—¶ç”¨åœ¨è¿™å„¿ã€‚</p><p>åäº†ä¸€ä¼šï¼Œèµ·é£äº†ï¼Œä¸€æ‘¸æŠ¥çº¸ï¼Œä¸€æ‰‹ç°ã€‚æŠŠæŠ¥çº¸æ”¶èµ·æ¥ï¼Œä¸€çœ‹æ—è¾¹ï¼Œä¸€åªé»‘ç™½ç›¸é—´çš„å°ç‹—æ­£ä¿¡æ­¥å‘æˆ‘èµ°æ¥ã€‚</p><p>æˆ‘å–œæ¬¢ç‹—ï¼Œäºæ˜¯æˆ‘å†³å®šé€—é€—è¿™æ¡å°ç‹—ã€‚  </p><span id="more"></span><p>å°ä¸œè¥¿åº”è¯¥æ˜¯äº¬å·´è·Ÿè´è¶çš„ä¸²ï¼Œè„¸ä¸Šçš„æ¯›çš„èŠ±çº¹æœ‰ç‚¹åƒå²åŠªæ¯”ï¼Œæ··èº«è„å…®å…®çš„ï¼Œä¸€çœ‹å°±æ˜¯æµæµªç‹—ã€‚ä½†æ˜¯çœ¼ç›ç‚¯ç‚¯æœ‰ç¥ï¼Œä¸€ç‚¹ä¹Ÿä¸æ€•æˆ‘ã€‚å®ƒè¿‡æ¥è¹­æˆ‘çš„è…¿ï¼Œæˆ‘å°±æ‘¸æ‘¸å®ƒçš„è„‘è¢‹ï¼Œä¸€ä¼šå®ƒå°±è¶´åœ¨æˆ‘æ—è¾¹å‡†å¤‡æ‰“ä¸ªç›¹äº†ã€‚ç‹—ç‹—åšå‡ºè¿™ç§åŠ¨ä½œï¼Œå°±è¡¨æ˜å®ƒå¯¹ä½ å·²ç»ä¿¡ä»»äº†ï¼Œæˆ‘å¾ˆå¼€å¿ƒå¯ä»¥çœ‹åˆ°å®ƒè¿™æ ·åšã€‚</p><p>æˆ‘æ‰‹é‡Œæ²¡ä»€ä¹ˆåƒçš„ï¼Œæ—è¾¹ä¼¼ä¹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåº—å¯ä»¥ä¹°ç‚¹é›¶é£Ÿå–‚å®ƒï¼Œé‚ä½œç½¢ã€‚</p><p>è¿‡äº†ä¸€ä¼šï¼Œæ¥äº†ä¸€ä¸ª30å²å·¦å³çš„ç”·äººï¼Œå”¤äº†ä¸€å£°&ldquo;å°èŠ±ï¼&rdquo;ï¼Œæ­£åœ¨ç¡æ¢¦ä¸­çš„å°èŠ±ä¸€ä¸‹å­å°±çå¼€äº†çœ¼ç›ï¼Œæ¬¢å¿«åœ°å‘ç”·äººå¥”äº†è¿‡å»ã€‚è¿™ä¸€äººä¸€ç‹—æ˜¾ç„¶æ˜¯äº’ç›¸è®¤è¯†çš„ã€‚çœ‹ä»–ä¿©äº²å¯†çš„æ ·å­ï¼Œæˆ‘ä¸ä»…å‡ºå£é—®é“&ldquo;è¿™æ˜¯æµæµªç‹—å§ï¼Ÿ&rdquo;ç”·äººæŠ¬å¤´çœ‹äº†æˆ‘ä¸€çœ¼ï¼Œè¯­æ°”æ²‰é‡åœ°å›ç­”é“ï¼š&ldquo;æ˜¯å•Šï¼Œå‰ä¸€é˜µå®ƒå¦ˆä¸¢äº†ï¼Œå®ƒå°±è‡ªå·±ä¸€ä¸ªäººäº†ã€‚&rdquo;è¯´å®Œåˆæ‘¸äº†æ‘¸å°èŠ±ã€‚æˆ‘åªèƒ½å¹ä¸€å£°æ°”è¡¨ç¤ºæŠ±æ­‰ï¼Œç”·äººæ¥ç€è¯´ï¼Œ&ldquo;æ­£çŠ¹è±«è¦ä¸è¦æŠŠå®ƒå¼„å›å®¶å‘¢ã€‚&rdquo;æˆ‘å°±æœ‰ç‚¹æƒŠè®¶äº†ã€‚æµæµªç‹—ä¸€èˆ¬æ˜¯ä¸ä¼šæ‹›äººå¾…è§çš„ï¼Œå³ä¾¿æ˜¯ä¸å»æ¬ºè´Ÿå®ƒï¼Œç»™å®ƒç‚¹åƒçš„å°±ç®—ä¸é”™äº†ã€‚è€Œä»–ç«Ÿç„¶åœ¨æƒ³è¦æŠŠå®ƒå¼„å›å®¶ã€‚</p><p>æˆ‘æ­£å‡†å¤‡é—®å…¶ä»–çš„é—®é¢˜ï¼Œèº«ååˆæœ‰äººå«é“&ldquo;å°èŠ±ï¼&rdquo;ï¼Œæˆ‘å›å¤´ä¸€çœ‹ï¼Œæ˜¯4ä¸ªå¥³äººï¼Œä¼°è®¡40å²å·¦å³çš„æ ·å­ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç¨å¾®å°ç‚¹ï¼Œ30å²å‡ºå¤´å§ï¼ˆå¥½å§ï¼Œæˆ‘å…¶å®ä¸å¤ªä¼šçœ‹å¥³äººçš„å¹´é¾„=ã€‚=ï¼‰ã€‚å”¤å°èŠ±çš„æ˜¯ä¸€ä¸ªç©¿ç€æ‰“æ‰®æ¯”è¾ƒè®²ç©¶çš„ï¼Œæ˜¯é‚£ç§ä¸€çœ‹å°±æ˜¯æ¥å—è¿‡è‰¯å¥½çš„æ•™è‚²çš„äººã€‚&ldquo;å°èŠ±ï¼è¿‡æ¥ï¼Œçœ‹å¦ˆå¦ˆä»Šå¤©ç»™ä½ å¸¦äº†ä»€ä¹ˆï¼Ÿ&rdquo;å°èŠ±åˆä¹é¢ é¢ åœ°è·‘è¿‡å»è¹­å¥¹çš„è…¿ã€‚</p><p>æˆ‘å¿ƒå¤´ä¸€çƒ­ã€‚è¿™æ—¶å€™ç”·äººå‡ºå£°äº†ï¼Œ&ldquo;å‘€ï¼Œå°èŠ±ï¼Œä»Šå„¿ä½ æœ‰å£ç¦äº†ï¼Œæ˜¯å¤§éª¨å¤´å“ã€‚&rdquo;è¯´ç½¢äº”ä¸ªäººä¸€èµ·å“ˆå“ˆå¤§ç¬‘ã€‚åŸæ¥è¿™äº”ä¸ªäººä¹Ÿäº’ç›¸è®¤è¯†å•Šã€‚</p><p>åªå¬æ¯”è¾ƒè®²ç©¶çš„å¥³äººè¯´ï¼Œ&ldquo;ä¸­åˆå»é…’åº—åƒé¥­ï¼Œç•™ä¸‹äº›éª¨å¤´ï¼Œæˆ‘å°±éƒ½æ‰“åŒ…å›æ¥äº†ã€‚&rdquo;å¦å¤–å‡ ä¸ªå¥³äººä¹Ÿæ’å˜´ï¼Œè¯´é“&ldquo;æ€ªä¸å¾—å°èŠ±è·Ÿä½ æœ€äº²ï¼Œä½ è€ç»™å®ƒå¥½åƒçš„ï¼Œæˆ‘ä»¬ç»™çš„éƒ½æ˜¯äº›ç«è…¿è‚ å•¥çš„ï¼Œå’Œä½ ä¸€æ¯”å·®è¿œå•¦ã€‚&rdquo;äº”ä¸ªäººè¯´ç¬‘äº†ä¸€é˜µï¼Œå°±å¼€å§‹è½¬å‘åŒä¸€ä¸ªè¯é¢˜&#8211;ä»Šå¤©æŠŠå®ƒå¸¦å›è°å®¶ã€‚åŸæ¥ä»–ä»¬æ—©å·²å•†é‡å¥½äº†è¿™æ¬¡çš„äº‹æƒ…ã€‚</p><p>ç”·äººå…ˆè¡¨æ€äº†ï¼š&ldquo;æˆ‘æ¥å§ã€‚æˆ‘æŒºå–œæ¬¢å°èŠ±çš„ã€‚&rdquo;<br>æ¯”è¾ƒå¹´è½»çš„å¥³äººæ’å˜´äº†ï¼š&ldquo;ä¸è¡Œï¼Œä½ å®¶å·²ç»æœ‰ä¸¤æ¡æ¯ç‹—äº†ï¼ŒæŠŠå°èŠ±å¼„è¿‡å»ï¼Œä¸æ€•å‡ºäº‹å•Šã€‚&rdquo;å“¦ï¼ŒåŸæ¥å°èŠ±æ˜¯ç”·ç”Ÿã€‚<br>è®²ç©¶çš„å¥³äººè¯´é“ï¼š&ldquo;æˆ‘æ¥å§ï¼Œå°èŠ±å¬è¯ï¼Œæ¯”äº¨åˆ©å¬è¯å¤šäº†ï¼Œæˆ‘ä»¬å®¶äº¨åˆ©ä¹Ÿæ˜¯å…¬çš„ï¼Œä¸æ€•ã€‚&rdquo;çœ‹æ¥å¥¹å®¶é‡Œä¹Ÿæœ‰ä¸€æ¡è°ƒçš®æ£è›‹çš„ç‹—ï¼Œåå«äº¨åˆ©ã€‚<br>ä¸€ä¸ªæœ‰ç‚¹å¯Œæ€çš„å¥³äººè¯´ï¼š&ldquo;ä½ ä»¬å‡ å®¶éƒ½æœ‰ç‹—äº†ï¼Œæ²¡å¿…è¦å†å¼„ï¼Œä¹‹å‰å°±è¯´å°èŠ±æˆ‘è¦äº†ã€‚&rdquo;<br>å¹´è½»çš„å¥³äººåé©³ï¼š&ldquo;çœ‹åˆ°å°èŠ±æˆ‘å°±åæ‚”äº†ï¼Œä¸æƒ³è®©ç»™ä½ äº†ï¼Œè®©å®ƒå»æˆ‘å®¶å§ã€‚&rdquo;çœ‹æ¥å¥¹è¿˜æ˜¯åæ‚”äº†ã€‚</p><p>è¿™æ—¶å°èŠ±æ­£åœ¨é»˜é»˜åœ°ä½å¤´å•ƒéª¨å¤´ï¼Œå…¨ç„¶ä¸çŸ¥æŠŠå®ƒå›´èµ·æ¥çš„è¿™å‡ ä¸ªäººæ­£åœ¨å†³å®šå®ƒçš„å‘½è¿ã€‚</p><p>å‡ ä¸ªäººäº’ç›¸äº‰äº†ä¸€ä¼šï¼Œä¸€ç›´æ²¡è¯´è¯çš„é‚£ä¸ªå¥³äººå‡ºå£°äº†ï¼š&ldquo;æˆ‘è§‰å¾—æˆ‘ä»¬è¿˜æ˜¯å…¬å¹³ä¸€ç‚¹ï¼Œè®©å®ƒè‡ªå·±é€‰æ‹©å§ã€‚æˆ‘ä»¬éƒ½å”¤å®ƒï¼Œçœ‹å®ƒå»æ‰¾è°ï¼Œå°±è¡¨æ˜è°è·Ÿå®ƒæœ€æœ‰ç¼˜ã€‚&rdquo;</p><p>è¿™ä¸ªæè®®å¾—åˆ°äº†å¤§å®¶çš„ä¸€è‡´è®¤åŒï¼Œè™½ç„¶æœ‰ç‚¹å„¿æˆï¼Œä¸è¿‡çœ‹èµ·æ¥ä¼¼ä¹æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å‡ ä¸ªäººæ‹‰å¼€è·ç¦»ï¼Œç„¶åä»¥å„è‡ªçš„æ–¹å¼å”¤å°èŠ±ã€‚ç”·äººæ˜¯å¹å£å“¨ï¼›è®²ç©¶çš„å¥³äººæ˜¯æ‹¿è£…éª¨å¤´çš„å¡‘æ–™è¢‹å­è¯±æƒ‘å®ƒ&#8211;é­åˆ°äº†å¤§å®¶çš„åå¯¹åï¼Œå¥¹ä¸å¾—ä¸æ‰”æ‰äº†è¢‹å­ï¼›å¹´è½»çš„å¥³äººè¹²ä¸‹æ¥æ‹æ‰‹ï¼Œåƒå”¤å­©å­é‚£æ ·ï¼Œå¯Œæ€çš„å¥³äººç«™ç€æ‹æ‰‹ï¼ŒåŒæ—¶å«å°èŠ±çš„åå­—ï¼›æ¯”è¾ƒæ²‰é»˜çš„å¥³äººåªæ˜¯å¾ˆå•è°ƒåœ°å«å°èŠ±ã€‚</p><p>å°èŠ±è¿·èŒ«åœ°æŠ¬èµ·å¤´ï¼Œçœ‹çœ‹è¿™ä¸ªï¼Œçœ‹çœ‹é‚£ä¸ª&#8211;ç”šè‡³è¿˜å›å¤´æœ›äº†æˆ‘ä¸€çœ¼&#8211;å…¨ç„¶ä¸çŸ¥è¿™å‡ ä¸ªè€å°å­©ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚å‡ ä¸ªäººéƒ½çœ¼å·´å·´åœ°çœ‹ç€å°èŠ±ï¼Œå°èŠ±ä¹Ÿä¸çŸ¥é“è‡ªå·±è¦åšä»€ä¹ˆã€‚</p><p>è¿‡äº†å¤§çº¦1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå°èŠ±ä¼¼ä¹ç»ˆäºåšäº†å†³å®šã€‚å®ƒå›å¤´çœ‹äº†ä¸€çœ¼è‡ªå·±çš„éª¨å¤´ï¼Œå°±å¥”å‘äº†æ¯”è¾ƒè®²ç©¶çš„å¥³äººã€‚</p><p>æƒ…ç†ä¹‹ä¸­ã€‚ç‹—æ€»æ˜¯å¯¹é‚£ä¸ªç»™è‡ªå·±å¥½åƒçš„ä¸œè¥¿çš„äººæœ‰ç‹¬ç‰¹çš„æ„Ÿæƒ…ã€‚</p><p>å…¶ä»–å››ä¸ªäººå¹äº†å£æ°”ï¼Œç«™èµ·èº«æ¥ï¼Œçº·çº·æŠ±æ€¨å¥¹ç”¨ç¾é£Ÿè¯±æƒ‘å°èŠ±ã€‚è®²ç©¶çš„å¥³äººå–œç¬‘é¢œå¼€ï¼Œè¿˜æ‰“å‡»å…¶ä»–äººï¼š&ldquo;è¿™å«ä¸ªäººé­…åŠ›ï¼&rdquo;</p><p>æ€»ä¹‹ï¼Œå°èŠ±çš„å»å‘å®šäº†ä¸‹æ¥ï¼Œäº”ä¸ªäººå°±è½»æ¾äº†ä¸å°‘ã€‚æ¥ä¸‹æ¥è¦å•†é‡çš„æ˜¯å›å®¶å‰çš„å¤„ç†å·¥ä½œã€‚</p><p>&ldquo;è¦å…ˆç»™å®ƒæ´—ä¸€ä¸‹ï¼ŒæŠŠæ¯›å…¨ç»™å®ƒå‰ƒäº†ï¼Œè®©å®ƒé‡æ–°é•¿ï¼Œè¿™äº›æ¯›æ²¡è¥å…»ï¼Œä¸æŠ—å†»ã€‚&rdquo;&ldquo;å‰ƒæ¯›ä¹‹åè¦åšåšçš®è‚¤æŠ¤ç†ã€‚&rdquo;&ldquo;è¦ç»™å®ƒæ‰“é’ˆï¼Œå…å¾—å¾—ä¼ æŸ“ç—…ã€‚&rdquo;&ldquo;è¦ä¸è¦æ´—æ´—èƒƒï¼Œè°çŸ¥é“å’±ä¸åœ¨çš„æ—¶å€™å®ƒåƒäº†ä»€ä¹ˆä¸œè¥¿ã€‚&rdquo;&ldquo;æˆ‘çœ‹ä¸å¦‚å–‚è™«å­è¯ï¼Œæ´—èƒƒå¤ªé­ç½ªäº†ã€‚&rdquo;</p><p>å¤§å®¶ä½ ä¸€è¨€æˆ‘ä¸€è¯­åœ°è®¨è®ºç€ï¼Œæˆ‘åœ¨æ—è¾¹çœ‹å¾—å¿ƒé‡Œçƒ­ä¹ä¹çš„ã€‚å°èŠ±ä¼¼ä¹ä¹ŸçŸ¥é“äº†äº›ä»€ä¹ˆï¼Œä¸åœåœ°åœ¨äº”ä¸ªäººä¸­é—´è¹­æ¥è¹­å»ã€‚</p><p>åæ¥å¹´è½»çš„å¥³äººè¯´è¯äº†ï¼š&ldquo;é‚£å°±è¿™ä¹ˆå®šäº†ï¼Œæˆ‘å…ˆæ‰“ç”µè¯ç»™Xå“¥ï¼Œé—®é—®ä»–é‚£èƒ½ä¸èƒ½å¼„ã€‚&rdquo;</p><p>&ldquo;å–‚ï¼ŸXå“¥å•Šï¼Œæ˜¯æˆ‘å•Šã€‚æ˜¯è¿™æ ·çš„ï¼Œæˆ‘è¿™æœ‰æ¡å°ç‹—ï¼Œæ˜¯æ¡æµæµªç‹—ï¼Œæˆ‘æ‰“ç®—æŠŠå®ƒå¸¦å›å®¶ï¼Œæ‚¨çœ‹æ‚¨é‚£èƒ½ä¸èƒ½å¸®æˆ‘å¤„ç†ä¸€ä¸‹ã€‚å•Šï¼Ÿä¸èƒ½å•Šï¼Œåˆ«å•Šï¼Œæˆ‘ä»¬å°±ç»™å®ƒæ´—ä¸€æ´—ç„¶åå‰ƒä¸ªæ¯›å°±è¡Œã€‚åˆ«å•Šï¼Œæˆ‘ä»¬è‡ªå·±æ´—è¿˜ä¸è¡Œä¹ˆï¼Œæ‚¨é‚£ä¸æ˜¯æœ‰ä¸ªå°å«ç”Ÿé—´ä¹ˆï¼Œæˆ‘ä»¬ç»™å®ƒæ´—å®Œäº†æ‚¨å°±å¸®å¿™æ¨ä¸€ä¸‹æ¯›å°±è¡Œã€‚æˆ‘ä»¬å¤šç»™æ‚¨ç‚¹é’±ã€‚å•Šï¼Ÿä¸è¡Œå•Šï¼Ÿ&rdquo;<br>è¿™æ—¶è®²ç©¶çš„å¥³äººè¦ç”µè¯ï¼Œç›´æ¥å°±è¯´ï¼š&ldquo;Xå•Šï¼Œæˆ‘æ˜¯ä½ Yå§ã€‚å¯¹ï¼Œä½ å°±å¸®æˆ‘ä»¬ä¸ªå¿™ï¼Œå…¶ä»–çš„å® ç‰©åº—éƒ½å¤ªè¿œäº†ï¼Œæˆ‘ä»¬è¿‡ä¸å»å•Šï¼Œå°±è®¤è¯†ä½ ä¸€ä¸ªï¼Œå¤§å®¶éƒ½è¡—é‡Œè¡—åŠçš„&#8212;-ä¸éº»çƒ¦ä¸éº»çƒ¦ï¼Œå°±å‰ƒä¸ªæ¯›ï¼Œä¸éº»çƒ¦çš„ã€‚&rdquo;<br>ç”·äººä¸è€çƒ¦äº†ï¼Œåœ¨æ—è¾¹è¯´é“ï¼š&ldquo;å’±å°±ç›´æ¥æŠ±è¿‡å»å°±å®Œäº†ï¼Œå…ˆæŠ±è¿‡å»ï¼ŒæŠ±è¿‡å»å†è¯´ã€‚&rdquo;</p><p>è®²ç©¶çš„å¥³äººåˆåŠªåŠ›äº†ä¸€ä¼šï¼Œä¼¼ä¹æ²¡æœ‰å’ŒXå“¥è¾¾æˆå…±è¯†ï¼Œéƒé—·åœ°æŒ‚æ–­äº†ç”µè¯ã€‚</p><p>æˆ‘åœ¨æ—è¾¹ä¹Ÿå¾ˆç€æ€¥ï¼Œè¿™ä¸ªXå“¥æ€ä¹ˆè¿™ä¹ˆå¤§é¢å­å•Šï¼Œè¿™ä¹ˆäº›äººæ±‚ä»–ä»–éƒ½ä¸å‡ºæ‰‹ã€‚</p><p>&ldquo;ä¼°è®¡æ˜¯æ€•æœ‰ç—…èŒï¼Œæ¯•ç«Ÿä»–é‚£ä¸ªåœ°æ–¹ç‹—æ¥ç‹—å¾€çš„ã€‚&rdquo;æ²‰é»˜çš„å¥³äººçªç„¶æ¥äº†å¥å†·ç¬‘è¯ã€‚</p><p>å…¶ä»–å‡ äººå¾ˆæ˜æ˜¾æ²¡å¿ƒæƒ…å¬å†·ç¬‘è¯ï¼Œéƒ½çš±ç€çœ‰å¤´ï¼Œä¸çŸ¥é“åœ¨æƒ³ä»€ä¹ˆã€‚</p><p>åæ¥è¿˜æ˜¯ç”·äººæ‰“ç ´æ²‰é»˜ï¼š&ldquo;èµ°ï¼Œå»æˆ‘å®¶æ´—ï¼Œå¤šå¤§ç‚¹äº‹ã€‚&rdquo;è®²ç©¶çš„å¥³äººä¸€å¬ä¸å¹²äº†ï¼š&ldquo;é‚£ä¹Ÿå¾—å»æˆ‘å®¶æ´—ã€‚&rdquo;<br>å‡ ä¸ªäººäº‰è®ºäº†ä¸€ä¼šï¼Œè¿˜æ˜¯å†³å®šå»ç”·äººå®¶ç»™å°èŠ±æ´—æ¾¡ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°èŠ±ä¼¼ä¹å‘ç°äº†ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ï¼Œå‘ç›¸åçš„æ–¹å‘èµ°å»ã€‚è®²ç©¶çš„å¥³äººè¿½äº†è¿‡æ¥ï¼Œå«é“ï¼š&ldquo;å°èŠ±ï¼Œåˆ«ä¹±è·‘ï¼Œå›å®¶äº†ã€‚&rdquo;</p><p>è¿™æ—¶å¥¹å·²ç»åˆ°æˆ‘èº«è¾¹äº†ï¼Œé—®æˆ‘ï¼š&ldquo;ä½ ä¹Ÿæ˜¯è¿™ä¸ªå°åŒºçš„ï¼Ÿ&rdquo;æˆ‘ç¬‘ç­”ï¼š&ldquo;ä¸æ˜¯ï¼Œæˆ‘æ˜¯å»é‚£å„¿åŠäº‹çš„ã€‚&rdquo;æˆ‘æŒ‡äº†æŒ‡æ—è¾¹çš„ç¤¾ä¿ä¸­å¿ƒï¼Œ&ldquo;ä½ ä»¬è¿™çš„äººçœŸå¥½ï¼Œå¾ˆå›¢ç»“ï¼Œå¾ˆæœ‰çˆ±å¿ƒã€‚&rdquo;æˆ‘ç”±è¡·åœ°èµå¹ã€‚è®²ç©¶çš„å¥³äººå¹äº†ä¸€å£æ°”ï¼Œè¯´é“ï¼š&ldquo;æµæµªç‹—å¤šå•Šï¼Œæˆ‘ä»¬çœ‹ç€ä¹Ÿå¿ƒç–¼ï¼Œå°½è‡ªå·±çš„å¾®è–„ä¹‹åŠ›å§ã€‚è¿™äº›å°ä¸œè¥¿ä¹ŸæŒºä¸å®¹æ˜“çš„ï¼Œåˆå¬è¯ï¼Œè®¨å–œã€‚&rdquo;</p><p>è¯´å®Œï¼Œå…¶ä»–å‡ ä¸ªäººå«å¥¹äº†ã€‚å¥¹å…¨ç„¶ä¸é¡¾å°èŠ±èº«ä¸Šçš„è„å…®å…®ï¼ŒæŠ±èµ·å°èŠ±ï¼Œå‘æˆ‘é“åˆ«ã€‚</p><p>çœ‹ç€ä»–ä»¬çš„èƒŒå½±ï¼Œå¿ƒé‡Œçªç„¶æ˜ç™½äº†ä¸ºä»€ä¹ˆå°èŠ±åœ¨ä¸€å¼€å§‹çš„æ—¶å€™ä¸æ€•æˆ‘äº†ï¼Œå› ä¸ºå®ƒçŸ¥é“ï¼Œæœ‰è¿™ä¹ˆä¸€å¸®äººï¼Œæ˜¯å®ƒçš„å®¶äººã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> ç‹—ç‹— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Any.Do &amp;#8211; è®¡åˆ’ä½ çš„ä»Šå¤©å’Œæ˜å¤©</title>
      <link href="//just-try/any-do-a-plan-for-today-and-tomorrow/"/>
      <url>//just-try/any-do-a-plan-for-today-and-tomorrow/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šäº†å¹´çºªï¼Œè„‘å­å°±ä¸å¥½ç”¨äº†ã€‚ã€‚<img alt="" height="24" src="http://cy198706.com/blog/wp-content/plugins/ck-and-syntaxhighlighter/ckeditor/plugins/smiley/images/35.gif" title="" width="24" /><br>æœ‰æ—¶å€™éœ€è¦ä¸€ä¸ªå°ä¸œè¥¿æ¥æé†’ä¸€ä¸‹è‡ªå·±ä»Šå¤©è¦åšä»€ä¹ˆã€‚</p><p>å…¶å®è®¡åˆ’ä»»åŠ¡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ï¼Œå¹¶ä¸æ˜¯å› ä¸ºè„‘å­æœ‰é—®é¢˜æˆ–è€…ä»€ä¹ˆï¼Œè€Œæ˜¯ä¸€ç§ç”Ÿæ´»æ€åº¦ï¼Œæœ‰è®¡åˆ’åœ°ç”Ÿæ´»æ‰ä¸è‡³äºè®©ç”Ÿæ´»ä¸€å›¢ç³Ÿã€‚<br>è€Œä¸”æ˜¨å¤©ä»Šå¤©ä½ åšäº†ä»€ä¹ˆï¼Œç•™ä¸ªå¤‡ä»½ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿ</p><p>è¿™æ¬¡å°±æ¥æ¨èä¸€æ¬¾ç²¾è‡´çš„å°Appï¼Œè™½ç„¶å°ï¼Œä½†åœ¨To-do Appç•Œå¯æ˜¯èµ«èµ«æœ‰åçš„ï¼Œåå­—å«åšAny.Doã€‚  </p><span id="more"></span><p>Any.Doçš„å›¾æ ‡åšå¾—å¾ˆè®¨å–œï¼Œè€Œä¸”æ•´ä¸ªAppçš„é£æ ¼éå¸¸ç»Ÿä¸€ï¼Œæ“ä½œæ‰‹æ„Ÿå¾ˆæ£’ï¼Œè¿˜å……åˆ†åˆ©ç”¨äº†æ»‘åŠ¨ã€æ‘‡æ™ƒç­‰æ‰‹åŠ¿ï¼Œä»¥æé«˜ç”¨æˆ·ä½“éªŒåº¦ã€‚<br>Any.Doå¯ä»¥ä¸è°·æ­Œè´¦æˆ·åŒæ­¥ï¼Œå¹¶ä¸”åœ¨iosã€Androidå¹³å°ä¸Šéƒ½æœ‰å¯¹åº”çš„Appï¼Œæ›´æ£’çš„æ˜¯ï¼Œå®ƒåœ¨Chromeä¹Ÿæœ‰å¯¹åº”çš„æ’ä»¶ï¼Œè€Œä¸”åœ¨å®‰è£…æ’ä»¶åï¼Œä½¿ç”¨Gmailéƒ½èƒ½çœ‹è§å®ƒçš„èº«å½±ã€‚è¿˜æœ‰HTML5ç‰ˆæœ¬çš„Any.Doï¼ˆè¦ç­‰å¾…å¥½ä¹…æ‰èƒ½æ¥åˆ°é‚€è¯·å‡½ã€‚ã€‚ï¼‰ï¼ŒçœŸå¯è°“æ˜¯å æ®äº†æ‰€æœ‰çš„ç½‘ç»œå¹³å°å¯èƒ½æ€§ã€‚</p><p>ä¸å” å¨äº†ï¼Œå¤šå›¾æ€çŒ«è¯¦ç»†è¯´æ˜ä¸€ä¸‹Any.Doçš„ç‰¹æ€§ã€‚è‡ªç”¨Android4.1.2ï¼Œæ¯”Android2.2/2.3çš„ä½“éªŒè¦å¥½ä¸€äº›ã€‚<br><span style="color:#b22222;"><var><small>TIP:ä¸è¦åœ¨æ„æˆªå›¾é‡Œçš„æ—¶é—´ã€‚ã€‚æˆªå›¾æˆªå¾—æ¯”è¾ƒçƒ‚ï¼Œæ²¡æœ‰æŒ‰ç…§æ—¶é—´é¡ºåºã€‚ã€‚</small></var></span></p><div style="text-align: center;">  1. å›¾æ ‡è®¾è®¡å¾—æ¯”è¾ƒæœ‰è¶£ï¼Œç¬¦åˆä¸€ä¸ªTo-Do Appçš„é£æ ¼ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo1.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  2. ç¬¬ä¸€ä¸ªç•Œé¢ã€‚é»‘ä¹ä¹çš„ï¼Œå› ä¸ºæ˜¯å¯ä»¥é€šè¿‡Facebookè¿›è¡Œç™»å½•çš„ï¼Œæ‰€ä»¥æˆ‘æ€€ç–‘ã€‚ã€‚ä½ æ‡‚çš„ã€‚å¦‚æœä½ æ²¡æœ‰è´¦å·ï¼Œå¯ä»¥ç‚¹å‡»ä¸Šé¢çš„&ldquo;å…¥é—¨&rdquo;ï¼Œè¿›è¡Œè´¦å·çš„æ³¨å†Œã€‚å¦‚æœä½ å·²ç»æœ‰è´¦å·äº†ï¼Œé‚£å¯ä»¥ç‚¹å‡»ä¸‹é¢çš„&ldquo;å·²ç»æ˜¯ä¼šå‘˜ï¼Ÿ&rdquo;<br /> <span style="color:#b22222;"><var><span style="font-size: 14px;">PSï¼šé‚£ä¸ª&ldquo;å·²ç»æ˜¯ä¼šå‘˜&rdquo;å¹³æ—¶æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå¾—ç‚¹å‡»ä¸€ä¸‹æ‰èƒ½å‡ºç°ã€‚ã€‚</span></var></span></div><div style="text-align: center;">  &nbsp;<img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo2.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  3. åˆ›å»ºè´¦æˆ·ç•Œé¢</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo3.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  4. ç™»å½•ç•Œé¢</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo4.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  5. ä»‹å°±æ˜¯é€šè¿‡è´¦æˆ·è¿›å…¥ä¹‹åçš„ç•Œé¢äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æ˜¯åˆ†ç»„ä¸ºä»Šå„¿ã€æ˜å„¿ã€å³å°†å‘ç”Ÿçš„ä»¥åŠæ˜å¤©ä¹‹åçš„äº‹æƒ…ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo5.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  6. ç‚¹å‡»ä»Šå¤©åˆ†ç»„ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å·²ç»æ·»åŠ çš„ä¸€äº›ä¿¡æ¯ã€‚ï¼ˆä¸è¦åœ¨æ„å†…å®¹ã€‚ã€‚ï¼‰åˆ’æ¨ªçº¿å¹¶ç°åŒ–çš„è¡¨ç¤ºä¹‹å‰å·²ç»å®Œæˆçš„å†…å®¹äº†ï¼Œæˆ‘æ²¡æœ‰æ¸…ç©ºï¼Œå› ä¸ºæˆ‘æœ‰&ldquo;åšå¥½äº‹ç•™è®°å½•&rdquo;çš„ä¹ æƒ¯ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo6.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  7. ç‚¹å‡»&ldquo;ç»™è‰¯ä»”æ‰“ç”µè¯&rdquo;ï¼Œå¯ä»¥çœ‹åˆ°å¼¹å‡ºçš„å°å·¥å…·æ ï¼Œä»å·¦è‡³å³åˆ†åˆ«æ˜¯&ldquo;è¿™ä¸ªå¾ˆé‡è¦å“¦äº²&rdquo;&ldquo;æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œ&rdquo;&ldquo;æä¸ªé†’å‘—&rdquo;&ldquo;å¤‡æ³¨ä¸€ä¸‹&rdquo;å’Œ&ldquo;è®©æˆ‘çš„äº²æˆšæœ‹å‹çŸ¥é“è¿™ä»¶äº‹&rdquo;ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo7.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  8. è¿™æ˜¯&ldquo;è¿™ä¸ªå¾ˆé‡è¦å“¦äº²&rdquo;çš„æ•ˆæœï¼Œåœ¨äº‹ä»¶çš„å·¦è¾¹æœ‰ä¸€æ¡çº¢çº¿ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo8.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  9. è¿™æ˜¯&ldquo;æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œ&rdquo;ï¼Œç›®å‰æˆ‘åªæœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå¸¸ç”¨çš„æ˜¯&ldquo;ä¸ªäºº&rdquo;æ–‡ä»¶å¤¹ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo9.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  10. &ldquo;æä¸ªé†’å§&rdquo;æ‹¥æœ‰éå¸¸äººæ€§åŒ–çš„ç•Œé¢ï¼Œè€Œä¸”ä¸ä¼šè¯¯æ“ä½œï¼Œæœ‰å¾ˆå¥½çš„ç›´è§‚æ€§ã€‚åˆ†é’Ÿéƒ¨åˆ†æ˜¯ä»¥5åˆ†åšä¸ºé—´éš”çš„ï¼Œå…¶å®ä¹Ÿæ˜¯ï¼Œä½ å®šä¸ª19:22åˆ†æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo10.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  11. å¦‚æœè¦æ·»åŠ ä¸€æ¡è®°å½•ï¼Œåœ¨ä¸Šé¢çš„æ¡†æ¡†é‡Œè¾“å…¥ï¼Œç„¶åç‚¹å‡»å³è¾¹çš„å°åŠ å·å°±å¥½äº†ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo11.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  12. å†çœ‹çœ‹èœå•æŒ‰é’®ã€‚åŸºæœ¬åŒ…æ‹¬äº†ä¸€ä¸ªTo-Do Appåº”è¯¥æœ‰çš„è®¾ç½®ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo12.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  13. åˆ‡æ¢ä¸º&ldquo;æ–‡ä»¶å¤¹&rdquo;è§†å›¾ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo13.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  14. èœå•é‡Œçš„&ldquo;åŒæ­¥&rdquo;é€‰é¡¹ã€‚å¯ä»¥ä¸ChromeåŒæ­¥ï¼Œè¿˜å¯ä»¥ä¸Google TasksåŒæ­¥ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo14.png" style="width: 480px; height: 980px;" /><br /> &nbsp;</div><div style="text-align: center;">  15. é€‰é¡¹èœå•ä¸­çš„&ldquo;è®¡åˆ’&rdquo;åŠŸèƒ½ã€‚ä»¥åˆ†æ­¥éª¤çš„æ–¹å¼æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„æé†’ä»»åŠ¡ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo15.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  16. å¦‚æœæˆ‘ç‚¹å‡»äº†&ldquo;å°±åœ¨&rdquo;ï¼Œå°±ä¼šé—®ä½ å…·ä½“æ˜¯å‡ ç‚¹ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo16.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  17. å¦‚æœæˆ‘ç‚¹å‡»äº†&ldquo;ä»¥å&rdquo;ï¼Œåˆ™ä¼šé—®ä½ å…·ä½“æ˜¯å“ªä¸€å¤©ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo17.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  18. è¿™å°±æ˜¯è®¾ç½®ç•Œé¢äº†ã€‚åŸºæœ¬ä¸Šå¹³æ—¶ä¼šç”¨åˆ°çš„é€‰é¡¹éƒ½å¯ä»¥ç›´æ¥è®¾ç½®ï¼Œä¸éœ€è¦è¿›å…¥äºŒçº§èœå•ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo18.png" style="width: 480px; height: 1292px;" /><br /> &nbsp;</div><div style="text-align: center;">  19. And.Doæ—¶åˆ»ã€‚ç»†å¿ƒçš„ä½ è‚¯å®šå·²ç»å‘ç°äº†ï¼Œè®¾ç½®é‡Œæ˜¯&ldquo;Any.Doæ—¶é—´&rdquo;ï¼Œè¿™å„¿æ˜¯&ldquo;Any.Doæ—¶åˆ»&rdquo;ï¼Œæ˜¯çš„ï¼Œè¿™æ˜¯ç¿»è¯‘äººå‘˜çš„å¤±è¯¯ã€‚</div><div style="text-align: center;">  è¿™ä¸ªåŠŸèƒ½å¾ˆè´´å¿ƒï¼Œåœ¨ä½ è§„å®šçš„æ—¶åˆ»åœ¨æ¡Œé¢ä¸Šå¼¹å‡ºä¸€ä¸ªå°æ¡†æ¡†ï¼Œè®©ä½ &ldquo;è®¡åˆ’ä½ çš„ä¸€å¤©&rdquo;ã€‚å¦‚æœç‚¹å‡»ä¸‹é¢çš„&ldquo;å¼€å§‹Any.Doæ—¶åˆ»&rdquo;ï¼Œåˆ™ä¼šè¿›å…¥ä¸Šé¢çš„&ldquo;è®¡åˆ’&rdquo;åŠŸèƒ½ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo19.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  20. è®¾ç½®èœå•ä¸­æœ‰ä¸ªé€‰é¡¹ï¼Œæ˜¯å¦åœ¨çŠ¶æ€æ æ˜¾ç¤ºã€‚è¿™ä¸ªåŠŸèƒ½ä»…æ”¯æŒAndroid4.0+çš„ç³»ç»Ÿã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo20.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  21. è®¾ç½®èœå•ä¸­çš„&ldquo;ç¤¼ç‰©&rdquo;åŸæ¥å°±æ˜¯&ldquo;å‘Šè¯‰å¶çš„äº²æœ‹å¥½å‹å¶æ­£åœ¨ç”¨Any.Doè¿™ä¸ªå¥½ä¸œè¥¿&rdquo;ã€‚</div><div style="text-align: center;">  <span style="color:#b22222;"><var>PSï¼šæŸäººï¼Œçœ‹åˆ°ä½ çš„åå­—äº†æ²¡ã€‚ã€‚@eugene</var></span></div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo21.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  22. &ldquo;å¸®åŠ©&rdquo;é‡Œçš„&ldquo;å…³äº&rdquo;ï¼Œå¾ˆæœ‰çˆ±çš„ç¿»è¯‘ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo22.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  23. å¾ˆå¤šäººä¹Ÿä¼šå…³å¿ƒæ¡Œé¢æ’ä»¶çš„é—®é¢˜ï¼Œå› ä¸ºAndroidå°±æ˜¯ç”¨æ¥æŠ˜è…¾çš„ï¼Œæ¡Œé¢å°±æ˜¯ç”¨æ¥æ”¾å¿«æ·æ–¹å¼å’Œæ’ä»¶çš„ã€‚Any.Doæä¾›äº†5ç§å¤§å°çš„æ’ä»¶ï¼Œä»»ä½ æŠ˜è…¾ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo23.png" style="width: 480px; height: 854px;" />&nbsp;<img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo24.png" style="width: 480px; height: 854px;" /><br /> &nbsp;</div><div style="text-align: center;">  24. Chromeä¸‹çš„æ’ä»¶ï¼Œç•Œé¢ä¹Ÿå¾ˆç®€æ´ï¼Œå¾ˆå‹å¥½ï¼Œå¹¶ä¸”ä¼šä¸ç§»åŠ¨è®¾å¤‡çš„å®¢æˆ·ç«¯è¿›è¡ŒåŒæ­¥ã€‚æ‰€ä»¥ï¼Œåœ¨å“ªé‡Œä¹Ÿä¸¢ä¸äº†ä½ çš„ä»»åŠ¡å–½ã€‚</div><div style="text-align: center;">  <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo25.png" style="width: 280px; height: 646px;" />&nbsp;<img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo26.png" style="width: 281px; height: 621px;" /></p>     <p>    27. æ¸—é€åˆ°Gmailçš„Any.Doã€‚<br /> <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/Android/AnyDo27.png" /></div>     <pre><code>&lt;p&gt;  æ€»çš„æ¥è¯´ï¼ŒAny.Doæ˜¯ä¸€æ¬¾æ¯”è¾ƒç®€æ´ã€äººæ€§åŒ–ã€äº¤äº’æ€§å¼ºçš„To-Doç±»Appï¼Œåœ¨æ¯å¤©ç¹å¿™çš„å·¥ä½œå’Œç”Ÿæ´»ä¸­ï¼Œç©ºå‡ºä¸€ç‚¹æ—¶é—´æ¥ï¼Œè®¡åˆ’ä¸€ä¸‹ä½ çš„ä¸€å¤©ï¼Œä½ å¯ä»¥è¿‡å¾—æ›´æ¡ç†ï¼Œæ›´ä¼˜é›…ã€‚&lt;/p&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†äº«å£çº¸</title>
      <link href="//pictures/%25e5%2588%2586%25e4%25ba%25ab%25e5%25a3%2581%25e7%25ba%25b8/"/>
      <url>//pictures/%25e5%2588%2586%25e4%25ba%25ab%25e5%25a3%2581%25e7%25ba%25b8/</url>
      
        <content type="html"><![CDATA[<div style="text-align: center;">  åˆ†äº«å‡ å¼ å£çº¸ï¼Œéƒ½æ˜¯è‡ªå·±ç½‘ä¸Šæœç½—çš„ï¼Œåˆ†è¾¨ç‡åŸºæœ¬éƒ½æ˜¯1920X1080ã€‚</p>     <p>    ç‚¹å‡»ä»»æ„ä¸€å¼ è¿›å…¥å¤§å›¾ä¸‹è½½ã€‚  </p>    <p>    é¢„è§ˆå›¾ï¼š  </p></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper1.jpg" style="width: 600px; height: 338px;" /></a></div><span id="more"></span><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper2.jpg" style="width: 600px; height: 338px;" /></a></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper3.jpg" style="width: 600px; height: 338px;" /></a></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper4.jpg" style="width: 600px; height: 338px;" /></a></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper5.jpg" style="width: 600px; height: 338px;" /></a></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper6.jpg" style="width: 600px; height: 338px;" /></a></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper7.jpg" style="width: 600px; height: 338px;" /></a></div><div style="text-align: center;">  <a href="http://pan.baidu.com/share/link?shareid=403243&uk=151049050" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/wallpaper8.jpg" style="width: 600px; height: 338px;" /></a></div>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘¨æ°ä¼¦å‡ºé“åå¹´é—´æ‰€æœ‰ä¸“è¾‘åˆé›†(112é¦–æ­Œ) å°†è¿‘ä¸¤ä¸ªå°æ—¶å“¦</title>
      <link href="//pictures/jays-albums-in-10-years/"/>
      <url>//pictures/jays-albums-in-10-years/</url>
      
        <content type="html"><![CDATA[<div>  åˆæ¬¡æ¥è§¦å‘¨æ°ä¼¦ï¼Œè¿˜æ˜¯å°å­¦å…­å¹´çº§çš„æ—¶å€™ï¼Œåœ¨æ¸¸æˆæœºå…é‡Œï¼Œæ¸¸æˆæœºå…çš„è€æ¿æœ‰ä¸€ä¸ªç£å¸¦æœºï¼Œè€æ˜¯å•æ›²å¾ªç¯ã€Šç®€å•çˆ±ã€‹è¿™é¦–æ­Œã€‚æˆ‘ä¸€è¾¹ç©æ¸¸æˆï¼Œå¬äº†ä¸¤ä¸‰æ¬¡å°±ä¼šå”±äº†ï¼Œç„¶åå°±å¼€å§‹æ‰¾ä»–çš„æ­Œå¬ã€‚</div><div>  <br /> å…¶å®é‚£ä¸ªæ—¶å€™ä»–å·²ç»å‡ºé“ä¸¤å¹´äº†ï¼Œã€Šç®€å•çˆ±ã€‹æ˜¯ã€ŠèŒƒç‰¹è¥¿ã€‹ä¸“è¾‘é‡Œçš„ä¸»æ‰“æ­Œä¹‹ä¸€ã€‚</p>     <p>    åæ¥æˆ‘ä¹Ÿä¹°å¾—èµ·ç›—ç‰ˆç£å¸¦äº†ï¼Œå°±ç¼ ç€æˆ‘å¦ˆç»™æˆ‘ä¹°äº†ä¸€ä¸ªéšèº«å¬ï¼ˆå—¯ï¼Œé‚£ä¸ªå¹´ä»£æ˜¯è¿™ä¹ˆå«çš„ï¼‰ï¼Œç„¶åå®¶é‡Œä»…æœ‰çš„å‡ ç›˜ç£å¸¦ï¼Œå°±éƒ½æ˜¯ä»–çš„ä¸“è¾‘äº†ã€‚  </p>    <p>    åˆ°åæ¥åˆä¸­ã€é«˜ä¸­ã€å¤§å­¦ï¼Œä»–çš„æ¯ä¸€é¦–æ­Œæˆ‘éƒ½ä¼šå”±ï¼Œæ¯ä¸€é¦–æ­Œçš„æ­Œè¯æˆ‘éƒ½çŸ¥é“ï¼Œå¤§å­¦å®¿èˆé‡Œä¹Ÿæœ‰ä¸¤ä¸‰ä¸ªæ°ä¼¦è¿·ï¼Œå¤§å®¶å¹³æ—¶ä¼šä¸€èµ·å¬ç€ä»–çš„æ­Œï¼Œå”±ä¸Šä¸¤å¥ã€‚  </p>    <p>    ä¸è¿‡æˆ‘è¿™äººä¸è¿½æ˜Ÿï¼Œåªå–œæ¬¢ä»–çš„æ­Œï¼Œå¯¹ä»–çš„äººæ²¡å•¥å…´è¶£ï¼Œä»–æ¼”çš„ç”µå½±ä¹Ÿçœ‹è¿‡å‡ éƒ¨ï¼Œæ¼”æŠ€ã€‚ã€‚å—¯ã€‚  </p>    <p>    åˆ°ç°åœ¨ï¼Œå‘¨æ°ä¼¦çš„æ­Œå·²ç»å¼€å§‹å‡ºç°é¢“åŠ¿äº†ï¼Œè¶Šæ¥è¶Šæ²¡æœ‰JayèŒƒäº†ï¼Œæœ‰ä¸€ç‚¹é‚£ç§å¿«é¤çš„æ„æ€ã€‚ä¸€æ–¹é¢æ˜¯å› ä¸ºä»–ä¹Ÿä¸‰åå¥½å‡ çš„äººäº†ï¼ŒäºŒæ˜¯ä»–ç°åœ¨å·²ç»ä¸å†æ˜¯ä¸“å¿ƒåšéŸ³ä¹äº†ï¼Œè´¨é‡ä¸‹é™ä¼¼ä¹ä¹Ÿæ˜¯å¿…ç„¶çš„ã€‚  </p>    <p>    å¶ç„¶ä¸€ä¸ªæœºä¼šï¼Œçœ‹åˆ°äº†è¿™ä¸ªè§†é¢‘ï¼ŒæŠŠä»–çš„ä»ã€ŠJayã€‹åˆ°ã€Šè·¨æ—¶ä»£ã€‹çš„æ‰€æœ‰æ›²ç›®ä¸²çƒ§äº†ä¸€éã€‚å¬å®Œäº†å¾ˆèƒ½è®©æˆ‘æƒ³èµ·ä»¥å‰çš„æ—¶å…‰ï¼Œå¿ƒé‡Œè¿˜æ˜¯è›®æœ‰æ„Ÿè§¦çš„ã€‚<br /> <span id="more"></span>    <pre><code>&lt;br /&gt; æ˜¨å¤©ä¸‹åˆåˆå¬äº†ä¸€éï¼Œè½»å£°å“¼ç€ï¼Œå“¼äº†ä¸¤ä¸ªå°æ—¶ã€‚ã€‚</code></pre>  </p>    <p>    ä¸çŸ¥é“çœ‹æˆ‘æ–‡å­—çš„äººæœ‰æ²¡æœ‰å–œæ¬¢ä»–çš„æ­Œçš„ï¼Œæœ‰çš„è¯å½“ç„¶å¥½ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·å›å¿†å›å¿†è¿‡å»çš„æ—¥å­ã€‚<br /> &nbsp;</div>     <pre><code>&lt;div style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éŸ³ä¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿ XX Windows8 å•†åº—ä¸‹çš„ä»˜è´¹åº”ç”¨</title>
      <link href="//just-try/xx-apps-in-windows-store/"/>
      <url>//just-try/xx-apps-in-windows-store/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¥ä¸æƒ³æ¶‰åŠè¿™ç§è¯é¢˜çš„ï¼Œå› ä¸ºå¾ˆå¯èƒ½ä¼šæ”¶åˆ°å¾®è½¯çš„å¾‹å¸ˆå‡½ã€‚ã€‚</p><p>ä½†æœ¬ç€é€ ç¦å¤§ä¼—çš„ç›®æ ‡ï¼Œæˆ‘è¿˜æ˜¯å°†è¿™æšå¥½ä¸œè¥¿å…±äº«å‡ºæ¥ï¼Œç‹¬ä¹ä¹ä¸å¦‚ä¼—ä¹ä¹å˜›ï¼</p><p><span style="color:#0000ff;">æ³¨ï¼šæœ¬è½¯ä»¶åªèƒ½XXå¯ä»¥è¯•ç”¨çš„åº”ç”¨ï¼Œå³åœ¨å•†åº—é‡Œæ˜¾ç¤ºå¦‚ä¸‹çš„ï¼š</span></p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/trial.gif" /></p><p><span style="color:#0000ff;">ä»˜è´¹æ‰èƒ½ä¸‹è½½çš„ä¸å¯XXï¼ˆå› ä¸ºæ ¹æœ¬å°±ä¸‹ä¸ä¸‹æ¥<del>ã€‚</del>ï¼‰</span></p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/pay.gif" /></p><p><span style="color:#0000ff;">æ‰€ä»¥ï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€ç§é€‰æ‹©ï¼Œè¯·ç»§ç»­çœ‹ä¸‹å»ã€‚</span></p><p><span style="color:#b22222;">è­¦å‘Šï¼šXXååº”ç”¨æ— æ³•æ›´æ–°ï¼Œåªèƒ½å¸è½½åé‡æ–°ä¸‹è½½é‡æ–°XXï¼Œå¦‚æœå¯¹æ­¤æ„Ÿåˆ°ä¸é€‚ï¼Œè¯·æ— è§†æ­¤æ–‡ã€‚</span></p><span id="more"></span><p style="text-align: center;">  ä¸‹è½½æ–‡ç« åçš„é™„ä»¶WSACOnekeyï¼Œè§£å‹ã€‚</p><p style="text-align: center;">  å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªç›®å½•ï¼Œå¦‚ä¸‹ï¼š</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411142154.png" style="width: 119px; height: 63px;" /></p><p style="text-align: center;">  wscrack_xxä»£è¡¨ä½ å®‰è£…çš„Win8æ˜¯xxä½çš„ã€‚è¿›å…¥ç›¸åº”çš„ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ–‡ä»¶ï¼š</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411142240.jpg" /></p><p style="text-align: center;">  å³é”®ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œinstaller.exeã€‚</p><p style="text-align: center;">  åœ¨æ‰“å¼€çš„ç¨‹åºä¸­ï¼Œé€‰æ‹©Installã€‚ç¨å€™ç‰‡åˆ»ï¼Œå°†ä¼šå¼¹å‡ºæˆåŠŸå®‰è£…çš„æç¤ºã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411142546.png" /></p><p style="text-align: center;">  æ¥ä¸‹æ¥è¿›å…¥wscrack_anycpuç›®å½•ï¼Œè¿è¡ŒTokensExtractor.exeã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411142605.png" /></p><p style="text-align: center;">  æ‰“å¼€ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ç°åœ¨ä½ çš„ç”µè„‘é‡Œå®‰è£…çš„æ‰€æœ‰å•†åº—åº”ç”¨ã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411142924.png" /></p><p style="text-align: center;">  xxx.xxxx(Full)è¡¨ç¤ºå·²ç»è¢«XXæˆ–è€…æ ¹æœ¬ä¸ç”¨XXã€‚xxx.xxxx(Trial)è¡¨ç¤ºå¯ä»¥è¢«XXã€‚æ¯”å¦‚æˆ‘è¿™é‡Œè¿™ä¸ªIlomiloï¼Œå°±æ˜¯å¯ä»¥XXçš„ã€‚</p><p style="text-align: center;">  ç‚¹å‡»å³è¾¹çš„CrackIt!ï¼Œç¨å€™ç‰‡åˆ»ï¼Œå°±å¼¹å‡ºCrackedï¼æç¤ºï¼Œæ­¤æ—¶å·²ç»å®Œæˆäº†æ— ç—›XXã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411142958.png" /></p><p style="text-align: center;">  å†çœ‹åº”ç”¨çš„çŠ¶æ€ï¼Œå·²ç»å˜æˆxxx.xxx(Full)äº†ã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/QQ20130411143029.png" /></p><p style="text-align: center;">  ä¸Šä¸ªæ°´æœå¿è€…çš„å›¾ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸‹æ–¹çš„&ldquo;è´­ä¹°&rdquo;å·²ç»ä¸è§äº†ã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Mess-Ups/FruitNinja-cracked.png" /></p><p style="text-align: center;">  æœ‰èƒ½åŠ›çš„è¿˜æ˜¯å¤šå¤šæ”¯æŒæ­£ç‰ˆå“ˆï¼åšä¸ºä¸€ä¸ªç¨‹åºçŒ¿ï¼Œè¿˜æ˜¯ä¸å–œæ¬¢åˆ«äººXXè‡ªå·±çš„åº”ç”¨çš„ã€‚ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä¸æ˜¯ä¸ªåˆæ ¼çš„ç¨‹åºçŒ¿ã€‚ã€‚</p><p style="text-align: center;">  é™„ä»¶ï¼š<a href="http://pan.baidu.com/share/link?shareid=445987&uk=151049050" target="_blank"><img alt="" src="http://cy198706.com/blog/wp-content/uploads/2013/04/download.png" /></a></p>]]></content>
      
      
      <categories>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows Store App </tag>
            
            <tag> XX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å“¥åˆç‰¹ä¹ˆä¸­å¥–å•¦ï¼ï¼</title>
      <link href="//gabby/big-prize/"/>
      <url>//gabby/big-prize/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ—©æ™¨ï¼Œæ‰“å¼€å±Œä¸å¿…å¤‡çš„QQé‚®ç®±ï¼Œå‘ç°äº†ä¸€å°ç¥ç§˜çš„æ²¹ä»¶ï¼Œæˆ‘å¿ƒä¸­çªç„¶æœ‰ç§é¢„æ„Ÿï¼Œä»Šå¤©è¦æœ‰å¥½äº‹å‘ç”Ÿï¼</p><p>æœä¸å…¶ç„¶ï¼Œå½“æˆ‘æ‰“å¼€é‚®ä»¶ï¼Œå°±å‘ç°è‡ªå·±ä¸­å¥–å•¦ï¼å¥½å¤šå¥½å¤šé’±ï¼</p><p>æˆªå›¾ç»™ä½ ä»¬çœ‹çœ‹ï¼Œæµå£æ°´å»å§ï¼</p><p style="text-align: center;">  <img alt="1" src="http://serious.qiniudn.com/QQ20130412092019.png" /></p><span id="more"></span><p>æˆ‘æ€€ç€æ¿€åŠ¨è€Œåˆå¿å¿‘çš„å¿ƒæƒ…ï¼Œæ‰“å¼€äº†è¿™ä¸ªéå¸¸æ ‡å‡†çš„å…¨è‹±æ–‡ä¸€çº§åŸŸåã€‚</p><p>å’¦ï¼Ÿè‚¿ä¹ˆæ˜¯è¿™æ ·å­å‘¢ï¼Ÿå…¨æ˜¯ä¹±ç ï¼Ÿ</p><p style="text-align: center;">  <img alt="2" src="http://serious.qiniudn.com/QQ20130412092316.png" /></p><p>æ²¡å…³ç³»ï¼Œè°è®©å’±æ˜¯ç¨‹åºçŒ¿å‘¢ï¼</p><p style="text-align: center;">  <img alt="3" src="http://serious.qiniudn.com/QQ20130412092703.jpg" /></p><p style="text-align: center;">  <img alt="4" src="http://serious.qiniudn.com/QQ20130412093435.png" /></p><p>çœ‹ï¼Œå¥½äº†ï¼ç§ç§ï¼Œå¤šæ¸©é¦¨çš„æç¤ºå•Šï¼Œè®©æˆ‘ä»¬ä¸è¦æäº¤ç§˜ç å•¥çš„ã€‚</p><p>ç‚¹å‡»&ldquo;ç™»å½•é¢†å–å¥–é¡¹&rdquo;ï¼Œå°±è¿›å…¥äº†çŒ©å…‰å¤§é“çš„é¦–é¡µã€‚</p><p style="text-align: center;">  <img alt="5" src="http://serious.qiniudn.com/QQ20130412093436.png" /></p><p>çœ‹ï¼è¿™é¡µé¢åšå¾—å¤šå¤§æ°”ï¼Œå¤šæ•´æ´ï¼Œè¿˜æœ‰å›¾æœ‰è§†é¢‘çš„ã€‚å·¦è¾¹è¿˜åœ¨ä¸æ–­åœ°æ»šåŠ¨ç€é‚£äº›å¹¸è¿å„¿çš„åå­—å’Œä»–ä»¬æ‰€è·å¾—çš„å¥–å“ã€‚</p><p>ä¸€ç­‰å¥–å±…ç„¶æ˜¯Camryå°æ±½è½¦ä¸€è¾†å“~ å’±æ€ä¹ˆå°±æ²¡é‚£ä¸ªè¿æ°”å‘¢~</p><p>æˆ‘é¢¤æŠ–ç€åŒæ‰‹ï¼Œåˆå¸¦ç€äº›è®¸çš„é—æ†¾ï¼Œå¡«ä¸Šäº†æˆ‘çš„éªŒè¯ç &#8211;5688ã€‚</p><p style="text-align: center;">  <img alt="6" src="http://serious.qiniudn.com/QQ20130412101537.png" /></p><p>éªŒè¯è¿‡ç¨‹è™½ç„¶åªæœ‰çŸ­çŸ­çš„å‡ ç§’ï¼Œæˆ‘å´æ„Ÿè§‰åƒæ˜¯è¿‡äº†å‡ ä¸ªä¸–çºªï¼Œä¸‡ä¸€ä¸æ˜¯æ€ä¹ˆåŠï¼Ÿä¸‡ä¸€æ˜¯å‘é”™äº†å·ç æ€ä¹ˆåŠï¼Ÿæ— æ•°ä¸ªå¿µå¤´ä»æˆ‘å¿ƒå¤´é—ªè¿‡ã€‚</p><p style="text-align: center;">  <img alt="7" src="http://serious.qiniudn.com/QQ20130412101551.png" /></p><p>å“ˆï¼æˆ‘å°±çŸ¥é“ï¼Œå“¥çš„è¿æ°”ä»æ¥å°±æ˜¯è¿™ä¹ˆæ£’ï¼</p><p style="text-align: center;">  <img alt="8" src="http://serious.qiniudn.com/QQ20130412101617.png" /></p><p>ç§ï¼Œå“¥çš„å¥–å“å·²ç»åœ¨é‚£ç­‰å“¥äº†ï¼å°æ°´æœï¼Œç­‰ç€å“Ÿ~</p><p>æƒ³åˆ°è¿™å„¿ï¼Œæˆ‘å‡†å¤‡å…ˆå»çœ‹çœ‹ä»–ä»¬çš„&ldquo;èº«ä»½&rdquo;ï¼Œäºæ˜¯æˆ‘ç‚¹å¼€äº†&ldquo;æŸ¥çœ‹æ´»åŠ¨è¯ä¹¦&rdquo;ã€‚</p><p style="text-align: center;">  <img alt="9" src="http://serious.qiniudn.com/QQ20130412104604.png" /></p><p style="text-align: center;">  <img alt="10" src="http://serious.qiniudn.com/QQ20130412104725.png" /></p><p style="text-align: center;">  <img alt="" src="http://xgdd.lnbxjz.com/%E5%8C%97%E4%BA%AC%E5%B8%82%E4%BA%92%E8%81%94%E7%BD%91%E5%85%AC%E8%AF%81%E5%A4%84/images/z1.jpg" /></p><p>å—¯ï¼Œè¿™ä¸‹æˆ‘å°±æ”¾å¿ƒäº†ï¼Œæ¯«æ— PSç—•è¿¹å•Šæœ‰æœ¨æœ‰ï¼ï¼</p><p>è¿›å…¥&ldquo;é¢†å–å¶çš„å¥–å“&rdquo;ï¼Œè€æ¯•æ— è¾œçš„è€è„¸å‡ºç°åœ¨å±å¹•ä¸Šã€‚</p><p style="text-align: center;">  <img alt="11" src="http://serious.qiniudn.com/QQ20130412101710.png" /></p><p>æˆ‘è¿˜ç‰¹æ„æœäº†ä¸€ä¸‹ä¸‹æ–¹çš„ç”µè¯ï¼š</p><p style="text-align: center;">  <img alt="12" src="http://serious.qiniudn.com/QQ20130412101836.png" /></p><p>åŒæ„äº†å¯¹æ–¹çš„åè®®åï¼Œå°±è¿›å…¥äº†ä¸‹ä¸€æ­¥ï¼Œå¡«å†™ä¿¡æ¯ç¯èŠ‚ã€‚</p><p style="text-align: center;">  <img alt="13" src="http://serious.qiniudn.com/QQ20130412102745.png" /></p><p>ä¸ºäº†è®©æˆ‘çš„éšç§å¾—åˆ°ä¿æŠ¤ï¼Œæˆ‘å¯¹è¿™å¼ å›¾ç‰‡è¿›è¡Œäº†å¤„ç†ï¼Œè®©ä½ ä»¬çœ‹ä¸æ¸…æ¥šæˆ‘å¡«å†™çš„ä¸œè¥¿ï¼Œå“ˆå“ˆï¼Œæˆ‘å²‚èƒ½é‚£ä¹ˆè½»æ˜“è®©ä½ ä»¬è·¨çœï¼</p><p style="text-align: center;">  <img alt="14" src="http://serious.qiniudn.com/QQ20130412102836.png" /></p><p>å¡«å†™å®Œåï¼Œå°±å‡ºç°äº†æäº¤è¿‡ç¨‹ã€‚ç»è¿‡çŸ­æš‚è€Œåˆæ¼«é•¿çš„ç­‰å¾…ï¼ŒçŒ©å…‰å¤§é“ç»™äº†æˆ‘ä¸¤ä¸ªæç¤ºï¼Œè¿™é‡Œå¯ä»¥çœ‹å‡ºæ ç›®ç»„æ˜¯å¤šä¹ˆåœ°ä¸¥è°¨å•Šï¼</p><p style="text-align: center;">  <img alt="15" src="http://serious.qiniudn.com/QQ20130412102850.png" /> <img alt="16" src="http://serious.qiniudn.com/QQ20130412102908.png" /></p><p>æ¥ä¸‹æ¥ï¼Œå°±è¿›å…¥æ­£å¼çš„é¢†å¥–ç¯èŠ‚äº†ã€‚é¢†å¥–çš„æ—¶å€™ï¼Œè´´å¿ƒçš„æ ç›®ç»„ä¸ºäº†ä¿è¯å¥–å“ä¸åœ¨è¿è¾“è¿‡ç¨‹ä¸­æŸåï¼Œè¿˜ç»™æˆ‘ä»¬ä¸Šäº†ä¿é™©ï¼Œè€Œä¸”åªéœ€è¦äº¤çº³2200å…ƒï¼Œå°±å¯ä»¥ç«‹å³æ‹¿åˆ°æˆ‘çš„å¥–å“äº†ï¼</p><p style="text-align: center;">  <img alt="17" src="http://serious.qiniudn.com/QQ20130412103030.png" /></p><p>è¯¦ç»†å†…å®¹ï¼ˆäº›å°å­—ï¼Œçœ‹å¾—æˆ‘é«˜å¼ºåº¦é’›åˆé‡‘ç‹—çœ¼éƒ½å¿«çäº†ï¼‰ã€‚</p><p style="text-align: center;">  <img alt="18" src="http://serious.qiniudn.com/QQ20130412103053.png" /></p><p>æ— è¾œçš„å…¬è¯äººã€‚æˆ‘è®°å¾—åœ¨æˆ‘ä¹‹å‰ä¸­çš„ä¸€æ¬¡å¥–æ—¶ï¼Œå·¦è¾¹è¿™å“¥ä»¬å«å¼ é¾™æ—ºæ¥ç€ã€‚ã€‚<img src="http://serious.qiniudn.com/QQ20130412105625.jpg">è¿™æ‰å¤šé•¿æ—¶é—´ï¼Œè¿å§“éƒ½æ”¹å•¦ï¼Ÿç°åœ¨çš„å°å¹´è½»ï¼ŒçœŸæ— æ³•ç†è§£<img src="http://serious.qiniudn.com/QQ20130412105721.jpg" alt="no way"></p><p>æˆ‘å†³å®šäº¤é’±ï¼Œä½†æ˜¯ä¸€æ‘¸å…œé‡Œï¼Œ12å—5ã€‚å®Œäº†ã€‚<img src="http://serious.qiniudn.com/QQ20130412110233.png" alt="holyshit"></p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> ä¸­å¥– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–°å»ºèŠå¤©å®¤ï¼Œæ¬¢è¿å¤§å®¶æ¥ç©ï½</title>
      <link href="//gabby/%25e6%2596%25b0%25e5%25bb%25ba%25e8%2581%258a%25e5%25a4%25a9%25e5%25ae%25a4%25ef%25bc%258c%25e6%25ac%25a2%25e8%25bf%258e%25e5%25a4%25a7%25e5%25ae%25b6%25e6%259d%25a5%25e7%258e%25a9%25ef%25bd%259e/"/>
      <url>//gabby/%25e6%2596%25b0%25e5%25bb%25ba%25e8%2581%258a%25e5%25a4%25a9%25e5%25ae%25a4%25ef%25bc%258c%25e6%25ac%25a2%25e8%25bf%258e%25e5%25a4%25a7%25e5%25ae%25b6%25e6%259d%25a5%25e7%258e%25a9%25ef%25bd%259e/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨Moot.itå»ºç«‹äº†ä¸€ä¸ªèŠå¤©å®¤ã€‚</p><p>å‘ƒã€‚ã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œåº”è¯¥æ˜¯ä¸ªå°è®ºå›ã€‚</p><p>æ€»ä¹‹ï¼Œæ¬¢è¿å¤§å®¶æ¥ç©ã€‚</p><p>TIPï¼šå¯ä»¥ç‚¹å‡»ä¸Šé¢çš„&ldquo;æ¥èŠå¤©å§&rdquo;ï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»<a href="http://chat.cy198706.com/">è¿™ä¸ªé“¾æ¥</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èŠå¤© </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ææ€–çš„ä¸­å­¦æ ¡è§„ï¼Œæˆ‘è‚¯å®šè¿›é—¨å°±è¢«è¸¹å‡ºæ¥ã€‚</title>
      <link href="//gabby/%25e6%2581%2590%25e6%2580%2596%25e7%259a%2584%25e4%25b8%25ad%25e5%25ad%25a6%25e6%25a0%25a1%25e8%25a7%2584%25ef%25bc%258c%25e6%2588%2591%25e8%2582%25af%25e5%25ae%259a%25e8%25bf%259b%25e9%2597%25a8%25e5%25b0%25b1%25e8%25a2%25ab%25e8%25b8%25b9%25e5%2587%25ba%25e6%259d%25a5%25e3%2580%2582/"/>
      <url>//gabby/%25e6%2581%2590%25e6%2580%2596%25e7%259a%2584%25e4%25b8%25ad%25e5%25ad%25a6%25e6%25a0%25a1%25e8%25a7%2584%25ef%25bc%258c%25e6%2588%2591%25e8%2582%25af%25e5%25ae%259a%25e8%25bf%259b%25e9%2597%25a8%25e5%25b0%25b1%25e8%25a2%25ab%25e8%25b8%25b9%25e5%2587%25ba%25e6%259d%25a5%25e3%2580%2582/</url>
      
        <content type="html"><![CDATA[<p>æ²¡å¾—å†™äº†ï¼Œåˆ°å¤„ä¹±é€›çš„æ—¶å€™ï¼Œå‘ç°äº†è¿™ä¸ªã€‚</p><p>çœŸæ˜¯æ„Ÿå¹ï¼Œå¹¸äºæˆ‘ä¸åšå­¦ç”Ÿå¥½å¤šå¹´ã€‚ã€‚</p><span id="more"></span><p>1.æœ‰ä¸‹åˆ—è¡Œä¸ºä¹‹ä¸€è€…ï¼Œç»™ä¸å‘æ”¾è¿çºªé€šçŸ¥å•çš„å¤„ç†ï¼Œæ‰£ç­çº§è¡Œä¸ºé‡åŒ–åˆ†1åˆ†/äººæ¬¡</p><p>æºå¸¦éšèº«å¬ï¼Œmp3ï¼Œè§åˆ°åºŸå¼ƒç‰©è§†è€Œä¸è§ï¼Œç©¿æ€ªå¼‚æœè£…ï¼Œç©¿çŸ­é€éœ²çš„æœè£…ï¼Œç”·ç”Ÿå‰ƒå…‰å¤´ã€ç•™é•¿å‘ã€æŸ“å‘ï¼ˆéé»‘è‰²ï¼‰ã€è“„èƒ¡é¡»ï¼Œå¥³ç”ŸåŒ–å¦†ã€æˆ´é¦–é¥°ã€ç©¿é«˜è·Ÿé‹ã€æ–œæŒé•¿åŒ…ï¼Œåœ¨å®¿èˆæ¥¼ä»¥å¤–çš„åœ°æ–¹ç©¿æ‹–é‹ï¼Œæ—·è¯¾ä¸€èŠ‚ï¼Œä¸éµå®ˆå…¬å…±ç§©åºï¼Œè¨€è¡Œä¸è¯šä¿¡ï¼Œè€ƒè¯•è¿çºªï¼Œè·‘æ­¥å»é¤å…ï¼Œæ‰“é¥­å¤¹å¡ï¼Œåˆä¼™è´­é¥­ï¼Œå°±é¤æ—¶æå‰ï¼Œç”¨å‹ºç­‰å åº§ï¼Œéš”å¢™ã€éš”é—¨æ¥ç‰©ï¼Œä¸Šè¯¾ï¼ˆå«è‡ªä¹ è¯¾ï¼‰æœŸé—´æ— è¯åˆ°åŒ»åŠ¡å®¤å°±åŒ»ï¼Œä¸å è¢«å­ï¼Œåœ¨æ•™å®¤ã€å®¿èˆå¢™é¢ä¹±è´´ä¹±ç”»ï¼Œä¸æŒ‰æ—¶å½’è¿˜å›¾ä¹¦ã€‚</p><hr><p>2ï¼æœ‰ä¸‹åˆ—è¡Œä¸ºä¹‹ä¸€è€…ï¼Œç»™äºˆå…¨æ ¡é€šæŠ¥æ‰¹è¯„çš„å¤„ç†ï¼Œæ‰£ç­çº§è¡Œä¸ºé‡åŒ–åˆ†2åˆ†/äººæ¬¡</p><p>åœ¨æ°´æˆ¿ã€é˜³å°ç­‰å¤„éšåœ°ä¾¿æººï¼Œéšåœ°ä¹±æ‰”åºŸå¼ƒç‰©ï¼ŒæŸåå…¬ç‰©ï¼Œæ—·è¯¾2-3èŠ‚ï¼Œåœ¨ç”¨ç”µå™¨æŒ‚ä¸œè¥¿ï¼Œä½¿ç”¨å……ç”µå™¨ï¼Œæ“…è‡ªåŠ¨ç”¨å­¦æ ¡ç”µè„‘ï¼Œè¯´è¯æ±¡è¨€ç§½è¯­ã€‚</p><hr><p>3ï¼æœ‰ä¸‹åˆ—è¡Œä¸ºä¹‹ä¸€è€…ï¼Œè§†æƒ…èŠ‚è½»é‡äºˆè­¦å‘Šæˆ–ä¸¥é‡è­¦å‘Šå¤„åˆ†ï¼Œå›å®¶è‡ªæˆ‘åæ€ï¼Œæ¥å—å®¶é•¿åœ¨æ•™è‚²1-2å‘¨çš„å¤„ç†ï¼Œå¹¶å…¨æ ¡é€šæŠ¥ï¼Œæ‰£ç­çº§è¡Œä¸ºé‡åŒ–åˆ†3åˆ†/äººæ¬¡</p><p>ç”·å¥³ç”Ÿéæ­£å¸¸æ¥è§¦</p><p>&nbsp;&nbsp;&nbsp;&nbsp;â‘ ç”·å¥³ç”Ÿäº’ç›¸é™ªæŠ¤åˆ°åŒ»åŠ¡å®¤çœ‹ç—…<br>&nbsp;&nbsp;&nbsp;&nbsp;â‘¡ç”·å¥³ç”Ÿäº’ç›¸è¿½é€æ‰“é—¹ï¼ŒåŠ¨æ‰‹åŠ¨è„š<br>&nbsp;&nbsp;&nbsp;&nbsp;â‘¢ä¸€ç”·ä¸€å¥³åœ¨éšè”½è§’è½å•ç‹¬æ¥è§¦<br>&nbsp;&nbsp;&nbsp;&nbsp;â‘£ç”·å¥³ç”Ÿäº’ç›¸è¯·å®¢ï¼Œäº’å‘çŸ­ä¿¡ï¼Œäº’èµ ç¤¼ç‰©ï¼Œäº’ä¼ çº¸æ¡ã€ä¹¦ä¿¡<br>&nbsp;&nbsp;&nbsp;&nbsp;â‘¤äº’ç›¸ä»¥å…„å¦¹æˆ–å…¶ä»–æ˜µç§°ç§°å‘¼<br>&nbsp;&nbsp;&nbsp;&nbsp;â‘¥ç”·å¥³ç”Ÿä¸¤äººé¢‘ç¹äº¤å¾€<br>&nbsp;&nbsp;&nbsp;&nbsp;â‘¦ç”·å¥³ç”Ÿä¸¤äººæ‹‰æ‰‹æ­è‚©ç­‰ã€‚</p><p>ä¸¥é‡æŸåå…¬ç‰©ï¼Œç‹å®¿èˆå†…å¸¦ç«ç§ï¼Œç§æ‹‰ç”µçº¿ï¼Œç„šçƒ§ç‰©å“ï¼Œéš”çª—æ³¼æ°´ã€æŠ•ç‰©ï¼Œæºå¸¦æ‰‹æœºå°çµé€šç­‰é€šè®¯å·¥å…·ï¼Œè¿è§„åƒå¸¦é›¶é£Ÿï¼ˆç¥¥è§åƒå¸¦é›¶é£Ÿçš„æœ‰å…³è§„å®šï¼‰ï¼Œè€ƒè¯•ä½œå¼Šï¼Œæ—·è¯¾åŠå¤©åˆ°ä¸¤å¤©ï¼Œä¾®è¾±ã€è°©éª‚è€å¸ˆæˆ–ä»–äººï¼Œæ“…è‡ªåŠ¨ç”¨å­¦æ ¡ç”µè„‘å¹¶æ›´æ”¹è®¾ç½®ï¼Œæºå¸¦ä¼ çœ‹ä¸å¥åº·ä¹¦åˆŠï¼ŒæŸåæ ‘æœ¨ï¼Œè·µè¸è‰åªï¼Œæ“…è‡ªç¦»æ ¡å¤–å‡ºï¼ˆå«è·³å¢™å¤–å‡ºï¼‰ï¼Œåœ¨æ°´æˆ¿å†…**æ´—æ¾¡ï¼Œç¬¬1-2é¡¹è¿çºªè¡Œä¸ºå±¡æ•™ä¸æ”¹è€…ï¼Œå¸¸è§„ç®¡ç†ä¸­çš„å±¡æ•™ä¸æ”¹çš„è¿çºªè€…ã€‚</p><hr><p>4ï¼æœ‰ä¸‹åˆ—è¡Œä¸ºä¹‹ä¸€è¿™æ˜¯æƒ…èŠ‚è½»é‡ç»™äºˆè®°è¿‡ï¼Œè®°å¤§è¿‡ï¼Œç•™æ ¡å¯Ÿçœ‹å¤„åˆ†ï¼Œå›å®¶è‡ªæˆ‘åæ€ï¼Œæ¥å—å®¶é•¿å†æ•™è‚²2-4å‘¨çš„å¤„ç†ï¼Œå¹¶å…¨æ ¡é€šæŠ¥æ‰¹è¯„ï¼Œæ‰£ç­çº§è¡Œä¸ºé‡åŒ–åˆ†4åˆ†/äººæ¬¡</p><p>æ“…è‡ªç¦»æ ¡å¤–å‡ºï¼Œå¹¶åœ¨æ ¡å¤–è¿‡å¤œï¼ŒæŠ½çƒŸã€å–é…’ã€æ‰“éº»å°†ï¼Œé€ƒé¿è€ƒè¯•ä¸€æ¬¡ï¼Œæºå¸¦ç®¡ä¸¨åˆ¶åˆ€å…·åŠä¸å­¦ä¹ æ— å…³çš„åˆ€å…·æ£æ£’ç­‰ï¼Œæ‰“äººæ‰“æ¶ï¼Œåœ¨å…¬å…±åœºæ‰€èµ·å“„ï¼Œææ¶ä½œå‰§ï¼Œæ—·è¯¾3-6å¤©</p><hr><p>5ï¼æœ‰ä¸‹åˆ—è¡Œä¸ºä¹‹ä¸€è€…ï¼Œç»™äºˆå–æ¶ˆåœ¨æ ¡å­¦ä¹ èµ„æ ¼çš„å¤„åˆ†å¹¶å…¨æ ¡é€šæŠ¥ï¼Œæ‰£é™¤ç­çº§è¡Œä¸ºé‡åŒ–åˆ†6åˆ†/äººæ¬¡</p><p>æ‰“äººæ‰“æ¶æƒ…èŠ‚ä¸¥é‡ï¼Œä¸¾é‡æ‰“æ¶åŠå¹•åæ“çºµæ‰“å‡?ï¼Œå±¡çŠ¯å·çªƒæˆ–å·çªƒæ€§è´¨ä¸¥é‡ï¼Œç”·å¥³è§è¶Šè½¨è¡Œä¸ºï¼Œæ—·è¯¾7-10å¤©ï¼Œå­¦æœŸç´¯è®¡é€ƒé¿è€ƒè¯•ä¸¤æ¬¡ï¼Œç¬¬ä¸‰å››é¡¹å±¡æ•™ä¸æ”¹è€…</p><hr><p>6ï¼æœ‰ä¸‹åˆ—è¡Œä¸ºä¹‹ä¸€è€…ï¼Œç»™äºˆå¼€é™¤å­¦ç±çš„å¤„åˆ†ï¼Œå¹¶å…¨æ ¡é€šæŠ¥ï¼Œæ‰£é™¤ç­çº§è¡Œä¸ºé‡åŒ–åˆ†10åˆ†/äººæ¬¡</p><p>å·çªƒæˆç˜¾ä¸”å·çªƒæ•°é¢å·¨å¤§çš„ï¼Œæ‰“äººæ‰“æ¶æ‰‹æ®µæ¶åŠ£ï¼Œæ€§è´¨ä¸¥é‡ï¼Œé€ æˆä¸¥é‡åæœçš„ï¼Œç”·å¥³ç”Ÿè¶Šè½¨æ¥è§¦é€ æˆä¸¥é‡åæœçš„ï¼Œæœ‰æµæ°“è¡Œä¸ºï¼Œåœ¨å…¬å…±åœºæ‰€ææ¶ä½œå‰§é€ æˆä¸¥é‡åæœçš„</p><hr><p>7ï¼è¿çºªè¡Œä¸ºè‹¥é€ æˆä¸¥é‡åæœï¼Œè¶…å‡ºå­¦æ ¡çºªå¾‹å¤„ç†èŒƒå›´çš„ï¼Œå°†ä¾æ³•ç§»äº¤å¸æ³•éƒ¨é—¨å¤„ç†</p><hr><p>8ï¼ä¸èƒ½æ¶µç›–çš„å…¶ä»–è¿çºªè¡Œä¸ºç”±å­¦æ ¡æ ¹æ®æ€§è´¨å’Œæƒ…èŠ‚å¦ä½œç›¸åº”çš„å¤„ç†ï¼Œä»¥ä¸Šæ¡å—è§£é‡Šæƒåœ¨æ•™è‚²å¤„</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çµ®å¨çµ®å¨</title>
      <link href="//gabby/tick-tock/"/>
      <url>//gabby/tick-tock/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©åˆå¼€å§‹çå¿™ï¼Œå¹²ä¸å±äºè‡ªå·±çš„å·¥ä½œã€‚</p><p>å‘¨ä¸€æˆ‘çš„ç›´å±ä¸Šå¸æŠŠæˆ‘å«åˆ°åŠå…¬å®¤ï¼Œè·Ÿæˆ‘è¯´äº†äº›æ²¡è¥å…»çš„è¯ä¹‹åï¼Œå°±å‘Šè¯‰æˆ‘ï¼š&ldquo;ä½ ç°åœ¨æ­£åœ¨åšçš„é‚£ä¸ªä¸œè¥¿ï¼Œå°±åˆ«å¼„äº†ï¼Œæ²¡ç”¨äº†ã€‚&rdquo;</p><p>è¿™å¥è¯å¯¹æˆ‘æ¥è¯´ä»¿ä½›æ™´å¤©éœ¹é›³ï¼Œæˆ‘è‡ªå·±å¿™æ´»äº†ä¸€æ•´å¹´çš„ä¸œè¥¿ï¼Œå°±è¢«è¿™ä¸€å¥è¯ç»™æ€äº†ã€‚</p><p>ä»–å¥½åƒçœ‹ç©¿äº†æˆ‘çš„æƒ³æ³•ï¼Œå¼€å§‹åŠæˆ‘ï¼š&ldquo;æ²¡äº‹ï¼Œä½ æ¥ä¸‹æ¥å°±çœ‹çœ‹å®‰å“å§ï¼Œå’±ä»¬æ¥ä¸‹æ¥è¦å¼€å‘å®‰å“ç‰ˆçš„å®¢æˆ·ç«¯äº†ã€‚å’±ä»¬å…¬å¸ä¼šæ‹›ä¸¤ä¸ªå®‰å“çš„äººè¿›æ¥ï¼Œä»–ä»¬åšå®Œï¼Œä½ å°±ç»´æŠ¤ä»–ä»¬çš„ä»£ç å§ã€‚&rdquo;è¯´å®ŒåˆåŠ äº†ä¸€å¥&ldquo;ä½ è¿™ä¸ªå²—ä½ï¼Œè¿˜æ˜¯è¦ä¿ç•™çš„ã€‚&rdquo;</p><p class="Code">  <img src="http://images.cy198706.com/Gabby/8f83d327c08f5460b1de05e5.jpg" style="margin-right: 10px; float: left;" /></p><p>æˆ‘åªèƒ½å¼ºè£…é•‡å®šï¼Œè¯´äº†ä¸€å †&ldquo;æ²¡é—®é¢˜&rdquo;&ldquo;è¿™éƒ½å°æ„æ€&rdquo;&ldquo;æˆ‘ä¸æ€•å›°éš¾&rdquo;&ldquo;æœ‰å•¥æ´»æ¥æ‰¾æˆ‘&rdquo;ä¹‹ç±»çš„ï¼Œç„¶åå°±æ‚»æ‚»åœ°å›åˆ°äº†è‡ªå·±çš„å·¥ä½ã€‚</p><p>æ²¡è¿‡å‡ åˆ†é’Ÿï¼Œä»–åˆæ¥äº†ï¼Œè¯´&ldquo;é‚£ä¸ªï¼Œæ˜å¤©ä¸‹åˆä¸‹ç­å…ˆåˆ«èµ°ï¼Œå’±ä»¬è·Ÿå‰ç«¯çš„æ£€æµ‹å‘˜ä¸€èµ·åƒä¸ªé¥­ï¼Œå¬å¬ä»–ä»¬å¯¹æ–°ç‰ˆå®¢æˆ·ç«¯çš„æ”¹è¿›æ„è§ï¼Œä½ å‘¢ï¼Œå°±æ‹¿ä¸ªæœ¬ï¼Œæ‹¿ä¸ªç¬”ï¼Œè®°å½•ä¸€ä¸‹ã€‚&rdquo;</p><p>äºæ˜¯ç¬¬äºŒå¤©æ™šä¸Šå°±å»å½“é€Ÿè®°å‘˜äº†ã€‚æ¥ç€ç¬¬ä¸‰å¤©ä¸­åˆåˆå»å½“é€Ÿè®°å‘˜äº†ã€‚</p><p>æ™šä¸Šå›å»åä¸€ç›´é—·é—·ä¸ä¹çš„ï¼Œæ„Ÿè§‰è‡ªå·±åœ¨å…¬å¸å·²ç»æ²¡æœ‰ä»·å€¼äº†ã€‚ä»ä¸€ä¸ªç¨‹åºå‘˜å˜æˆé€Ÿè®°å‘˜ï¼Œåœ¨åˆ«äººçœ‹æ¥æ²¡å•¥ï¼Œè¿˜æœ‰å¯èƒ½ä¼šè¯´&ldquo;è¿™æœ‰å•¥å•Šï¼Œé—²ç€æ²¡äº‹è¿˜æ‹¿å·¥èµ„ï¼Œå¤šå¥½å“‡&rdquo;ï¼Œä½†å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ç§èƒ½åŠ›çš„å¦å®šã€‚</p><p>äºæ˜¯ç°åœ¨ååœ¨è¿™é‡Œï¼Œå°±å¦‚åé’ˆç §äº†ã€‚æœ¬æ¥æƒ³5æœˆåº•è·³ï¼Œç°åœ¨æ›´åšå®šæˆ‘çš„æƒ³æ³•äº†&#8212;-æˆ‘ä¸èƒ½åšäº›éšä¾¿ä¸€ä¸ªäººéƒ½èƒ½åšçš„å·¥ä½œï¼Œå¦åˆ™æˆ‘å¯¹ä¸èµ·è¿™ä»½å·¥èµ„ã€‚</p><p>å…¶å®åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¹Ÿå‡ºç°è¿‡è¿™æ ·çš„æƒ…å†µï¼Œå½“æ—¶å…¬å¸ç¼ºäººæ‰‹ï¼Œæˆ‘æ—¢æ“ä»£ç ï¼Œè¿˜å¾—è·‘è…¿ï¼Œåˆè¦è®°å½•ï¼Œç”šè‡³è¿˜è¦åšå†³å®šï¼Œè¿™å®Œå…¨ä¸æ˜¯æˆ‘çš„æœ¬èŒå·¥ä½œäº†ã€‚</p><p>èƒ¸ä¸­éƒé—·ï¼Œå°±æŠŠæƒ…å†µè·Ÿåª³å¦‡è¯´äº†ã€‚åª³å¦‡ä¸€å¬å°±ç¬‘äº†ï¼š&ldquo;æˆ‘è¿˜ä»¥ä¸ºå•¥äº‹çš„ï¼Œçœ‹ä½ é—·é—·ä¸ä¹çš„ã€‚ä½ æƒ³å•Šï¼Œä¸ºä»€ä¹ˆä¸éšä¾¿æ‰¾ä¸ªäººæ¥åšå‘¢ï¼Ÿå…¶ä»–äººæœ‰ä½ äº†è§£è¿™ä¸ªå®¢æˆ·ç«¯å—ï¼Ÿå…¶ä»–äººå¬å¾—æ‡‚é‚£äº›ä¸“æœ‰åè¯å—ï¼Ÿå…¶ä»–äººè·Ÿå¾—ä¸Šä½ ä»¬æŠ€æœ¯äººå‘˜ä¹‹é—´çš„è°ˆè¯è¿›åº¦å—ï¼Ÿ&rdquo;å››ä¸ªé—®é¢˜å°±æŠŠæˆ‘æƒŠé†’äº†ã€‚</p><p>æ˜¯å‘¢ï¼Œæ— æ„ä¹‹é—´ï¼Œæˆ‘åˆå¤šäº†ä¸€ä»½è´£ä»»ï¼Œå°±æ˜¯æŠŠè‡ªå·±çŸ¥é“çš„ä¸œè¥¿äº¤ç»™åˆ«äººï¼ŒæŠŠæ£€æµ‹å‘˜åé¦ˆçš„æƒ…å†µç»„æˆæ–°çš„ç‰¹è‰²ï¼Œè¿™æ ·æ‰å«&ldquo;æ”¹è¿›&rdquo;ã€‚è¿™æ ·ä¸€æƒ³ï¼Œå°±èˆ’æœå¤šäº†ã€‚</p><p>ä»Šå¤©å†³å®šæŠŠæŠ€æœ¯ç±»çš„æ–‡ç« é€æ­¥ç‹¬ç«‹å‡ºå»ï¼Œå› ä¸ºå†™æŠ€æœ¯ç±»çš„æ–‡ç« ï¼Œå¥½åƒå¤§ä¼™éƒ½çœ‹ä¸æ‡‚ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ„æ€ï¼Œå°±ç‹¬ç«‹å‡ºå»ï¼Œå½“ä½œæ–°çš„åˆ†æ”¯äº†ã€‚</p><p>æ˜å¤©ä¸‹åˆçš„ç«è½¦ï¼Œå›å®¶äº†ï¼Œè¯·ä¸¤å¤©å¹´å‡ï¼Œå‡‘ä¸ªä¸ƒå¤©çš„é•¿å‡ï¼Œè¿™ç¬”ç”Ÿæ„æŒºåˆ’ç®—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lenka &amp;#8211; Trouble is a Friend</title>
      <link href="//music/lenka-trouble-is-a-friend/"/>
      <url>//music/lenka-trouble-is-a-friend/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸€çœ‹åŠä¸ªæœˆåˆæ²¡æ›´æ–°äº†ã€‚ è¿˜æœ‰æœ‹å‹åœ¨å‚¬æˆ‘æ›´æ–°åšå®¢ï¼Œå› ä¸ºä»–ä»¬è¿‡æ¥ï¼Œå‘ç°è¿˜æ˜¯é‚£ç¯‡æ–‡ç« ï¼Œè¿æƒ³ç•™ä¸ªè„šå°çš„åœ°æ–¹éƒ½æ²¡æœ‰ï¼Œè¿™æ˜¾å¾—æˆ‘å®åœ¨æ˜¯å¤ªæ²¡æ„æ€äº†ã€‚ æ­£åœ¨é…é…¿ä¸€ç¯‡é•¿æ–‡ï¼Œæ‰“ç®—å†™å®Œä¹‹åå†ä¸€èµ·æ”¾ä¸Šæ¥ã€‚ä»Šå„¿å°±å…ˆæ¨èä¸€é¦–æ›²å­å§&ldquo;Lenka &#8211; Trouble is a Friend&rdquo;ã€‚ è¿™é¦–æ­Œç¬¬ä¸€æ¬¡å¬æ˜¯åœ¨ä¸Šä¸€å®¶å…¬å¸çš„å¸æœºé€æˆ‘å»æœºåœºçš„è·¯ä¸Šå¬åˆ°çš„ã€‚æ›²å­çš„èŠ‚å¥æ„Ÿæ¯”è¾ƒå¼ºï¼ˆä¸æ˜¯Discoèˆæ›²å“¦ï¼Œæˆ‘ä¸å–œæ¬¢Discoèˆæ›²ï¼‰ï¼ŒLenkaçš„å£°çº¿å¾ˆå¼ æ‰¬ï¼Œç•¥å¸¦ç‚¹æ²™å“‘çš„å—“å­ç¥é©¬çš„æœ€è®©äººå–œçˆ±äº†ã€‚</p><p>å†åŠ ä¸Šæœ€è¿‘æœ€åˆ°çš„éº»çƒ¦äº‹æ¯”è¾ƒå¤šï¼Œåˆå¬äº†å‡ éè¿™é¦–æ­Œï¼Œå°±æŠŠå®ƒæ¨èç»™å¤§å®¶ï¼Œå¸Œæœ›æœ‹å‹ä»¬å¯ä»¥ä»è¿™é¦–æ­Œä¸­å—åˆ°é¼“åŠ±~</p><p>ä¸Šæ›²ã€‚<strike>æ¥è‡ªskydriveå¤–é“¾ã€‚ï¼ˆå¯èƒ½ä¼šæœ‰ç‚¹æ…¢ã€‚ã€‚æ­£åœ¨ç ”ç©¶ä¸­ã€‚ã€‚ï¼‰</strike></p><p><strike><span style="color:#b22222;"><em>ï¼ˆè¯·ä½¿ç”¨æ”¯æŒHTML5çš„æµè§ˆå™¨ï¼Œå¦åˆ™ä¼šçœ‹ä¸è§å•Šå¬ä¸åˆ°ã€‚ã€‚ï¼‰</em></span></strike></p><p>å› ä¸ºä¸å¯æŠ—åŠ›å› ç´ ï¼Œæ”¹æˆè™¾ç±³äº†ã€‚ã€‚HTML5æ™®åŠè·¯æ¼«æ¼«å•Šã€‚ã€‚</p><p>&nbsp;</p><div style="text-align:center">  <embed height="33" src="http://www.xiami.com/widget/0_3320604/singlePlayer.swf" type="application/x-shockwave-flash" width="257" wmode="transparent">  </embed></div><p>&nbsp;</p>]]></content>
      
      
      <categories>
          
          <category> è€³æœµ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éŸ³ä¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ è¿˜æœ‰æ¢¦æƒ³å—ï¼Ÿ &amp;#8211; è§‚ã€Šå°å„¿éš¾å…»ã€‹æœ‰æ„Ÿ</title>
      <link href="//gabby/%25e4%25bd%25a0%25e8%25bf%2598%25e6%259c%2589%25e6%25a2%25a6%25e6%2583%25b3%25e5%2590%2597%25ef%25bc%259f-%25e8%25a7%2582%25e3%2580%258a%25e5%25b0%258f%25e5%2584%25bf%25e9%259a%25be%25e5%2585%25bb%25e3%2580%258b%25e6%259c%2589%25e6%2584%259f/"/>
      <url>//gabby/%25e4%25bd%25a0%25e8%25bf%2598%25e6%259c%2589%25e6%25a2%25a6%25e6%2583%25b3%25e5%2590%2597%25ef%25bc%259f-%25e8%25a7%2582%25e3%2580%258a%25e5%25b0%258f%25e5%2584%25bf%25e9%259a%25be%25e5%2585%25bb%25e3%2580%258b%25e6%259c%2589%25e6%2584%259f/</url>
      
        <content type="html"><![CDATA[<p style="text-align: center;">  æ„æ€è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæ­£åœ¨è·Ÿåª³å¦‡ä¸€èµ·çœ‹ã€Šå°å„¿éš¾å…»ã€‹&#8211; æˆ‘å¤§é©¬æ¡¶å°ä¹‹å‰å¼ºæ¨çš„ä¸€éƒ¨æˆã€‚</p><p style="text-align: center;">  ç€æ‰‹å†™æ­¤æ–‡çš„æ—¶å€™ï¼Œæ°å¥½æ˜¯çœ‹å®Œè¿™éƒ¨å‰§çš„æ—¶å€™ã€‚35é›†ï¼Œè¿™éƒ¨å‰§ç»™æˆ‘ç•™ä¸‹äº†å¾ˆæ·±çš„å°è±¡ã€‚</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Gabby/QQæˆªå›¾20130515122845.png" style="width: 651px; height: 443px;" /></p><p style="text-align: center;">  æ–‡ç« æ¯”è¾ƒé•¿ï¼ˆå…¶å®ä¹Ÿä¸é•¿ï¼Œåªæ˜¯å¥½ä¹…æ²¡ç å­—äº†ï¼Œæ„Ÿè§‰å¥½åƒæŒºé•¿ï¼ˆä»€ä¹ˆé•¿ä¸é•¿çš„ä½ æƒ³å“ªå»äº†ï¼‰ï¼‰ã€‚</p><span id="more"></span><p>&nbsp;</p><h2 id="å…³äºå‰§ï¼ˆå¼ºå‰§é€å‘ï¼Œå¦‚æœæœ‰æ­£åœ¨çœ‹çš„æˆ–è€…æ˜¯æ‰“ç®—çœ‹çš„è¯·æ–Ÿé…Œï¼‰"><a href="#å…³äºå‰§ï¼ˆå¼ºå‰§é€å‘ï¼Œå¦‚æœæœ‰æ­£åœ¨çœ‹çš„æˆ–è€…æ˜¯æ‰“ç®—çœ‹çš„è¯·æ–Ÿé…Œï¼‰" class="headerlink" title="å…³äºå‰§ï¼ˆå¼ºå‰§é€å‘ï¼Œå¦‚æœæœ‰æ­£åœ¨çœ‹çš„æˆ–è€…æ˜¯æ‰“ç®—çœ‹çš„è¯·æ–Ÿé…Œï¼‰"></a>å…³äºå‰§ï¼ˆå¼ºå‰§é€å‘ï¼Œå¦‚æœæœ‰æ­£åœ¨çœ‹çš„æˆ–è€…æ˜¯æ‰“ç®—çœ‹çš„è¯·æ–Ÿé…Œï¼‰</h2><p>è¿™éƒ¨ç”µè§†å‰§å‰§å¦‚å…¶åï¼Œä¸»è¦æ˜¯è®²å°å­©çš„æ•…äº‹ï¼Œä»¥åŠå›´ç»•ç€è¿™ä¸ªå­©å„¿ï¼Œçˆ¶æ¯ã€å…»çˆ¶æ¯ã€è€çˆ¶è€æ¯çš„æ•…äº‹ï¼Œé¡ºå¸¦ç€ç‰µå‡ºå©†åª³ã€çˆ±æƒ…æ•…äº‹ã€‚</p><p>ä¸»çº¿ä¸€ï¼šä¸Šæµ·ï¼Œä¸€å¯¹å¤«å¦»ï¼Œç”Ÿæ´»è´¨é‡è¿˜å¯ä»¥ï¼Œæœ‰è½¦æœ‰æˆ¿ï¼Œä½†è‡ªä»æœ‰äº†å­©å­ï¼Œå°±å…¨ä¹±äº†ã€‚å¤«å¦»ä¹‹é—´æœ¬æ¥éƒ½ä»¥å¯¹æ–¹ä¸ºæœ€ä¼˜å¯¹è±¡ï¼Œä½†ç°åœ¨éƒ½è½¬å‘äº†å­©å­ï¼Œæ¯ä¸€ä¸ªå†³å®šéƒ½ä¸ºäº†å­©å­å¥½ä½†å´å¤„å¤„éƒ½æ˜¯çŸ›ç›¾ï¼Œå®¶é‡Œä¹±æˆä¸€é”…ç²¥ã€‚ä¸ºäº†ç…§é¡¾å­©å­ä¸æƒœé«˜ä»·è¯·æœˆå«‚ï¼Œä½†å´è¢«çœé’±çš„å©†å©†å’Œä¸ˆæ¯å¨˜èµ¶èµ°ã€‚ä¸ºäº†æ”¹å–„æ¯å†µæ„ˆä¸‹çš„å®¶åº­è´¢æ”¿ï¼Œæ¥ç§æ´»å´è¢«å‘é€è¿›è­¦å¯Ÿå±€ã€‚ä¸ºäº†æé«˜æ”¶å…¥å´å¼•å‘äº†å¤«å¦»ä¹‹é—´çš„çŒœç–‘ã€‚ã€‚ä¸»çº¿ä¸€æ˜¯ä¸»çº¿ä¸­çš„ä¸»çº¿ã€‚</p><p>ä¸»çº¿äºŒï¼šä¸€å¤œæƒ…äº§ç”Ÿçš„ä¸€ä¸ªæ„å¤–ï¼Œè®©ä»¥è§£é›‡åˆ«äººä½œä¸ºèŒä¸šçš„é«˜å¯Œå¸…ç”Ÿæ´»é™·å…¥å›°å¢ƒã€‚åœ¨éŸ©å›½çš„å­©å­çš„æ¯äº²æŠŠå­©å­ç¡¬å¡äº†è¿‡æ¥ï¼Œè®©é«˜å¯Œå¸…æ‰‹è¶³æ— æªã€‚å› ä¸ºè¿™ä¸ªå­©å­ï¼Œå·¥ä½œå—åˆ°ç‰µåˆ¶ï¼Œç”Ÿæ´»å—åˆ°å½±å“ï¼Œç”šè‡³è¿æœªå©šå¦»ä¹Ÿå› æ­¤åç›®åˆ†æ‰‹ã€‚ä½†ä¹Ÿå› ä¸ºè¿™ä¸ªå°å­©ï¼Œä»–è®¤è¯†äº†ä¸€ä¸ªç‰¹ç«‹ç‹¬è¡Œçš„å¥³å­©ï¼Œä¸¤äººä¹‹é—´çš„çˆ±æ¨çº è‘›æ›´è®©äººçº ç»“ã€‚</p><p>ä¸»çº¿ä¸‰ï¼šä¸»çº¿ä¸€ä¸­çš„å¥³äººæ˜¯ä¸ªäº‹ä¸šå¥³å¼ºäººï¼Œä»å°æ²¡è¾“è¿‡äººï¼Œä½†å°±è¿™ç§æ°”åœºï¼Œè®©ä¸€èµ·é•¿å¤§çš„ç©ä¼´æš—ç”Ÿæ¨å«‰ï¼Œåœ¨èŒåœºä¸Šå¤„å¤„åˆéš¾ï¼Œæ˜æªæš—å‰‘ä½ æ¥æˆ‘å¾€ã€‚ä¸»çº¿ä¸€ä¸­çš„ç”·äººæ˜¯ä¸ªäº‹ä¸šå¤±è´¥è€…ï¼Œå¹³æ—¶ç¡¬æ°”ä½†ä¸€ä¸å®¢æˆ·æ¥è§¦å°±ç»“å·´ï¼Œå°å¯Œå³å®‰çš„å¿ƒç†è®©ä»–å—äº†ä¸å°‘ä¸Šå¸çš„è´£éª‚ã€‚</p><p>ä¸»çº¿å››ï¼šæ‹çˆ±ä¸­çš„å°ä¸¤å£ã€‚ç”·ç”Ÿæ˜¯æ ‡å‡†çš„&ldquo;å•åç©·ä¸‰ä»£ï¼Œæ‘„å½±æ¯ä¸€ç”Ÿ&rdquo;ï¼Œæ²¡æœ‰ç¨³å®šçš„å·¥ä½œï¼Œæ€»æ˜¯å·å·åœ°ç”¨å¥³å‹çš„ä¿¡ç”¨å¡ä¹°é•œå¤´ï¼Œä¸å–œæ¬¢è´Ÿè´£ä»»ï¼Œä¸å–œæ¬¢å—æ‹˜æŸï¼Œä¸æƒ³ç»“å©šï¼Œä¸æƒ³è¦å­©å­ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„æ²¡é•¿å¤§çš„å­©å­ã€‚å¥³ç”Ÿå¿ƒæ€å…¨åœ¨ç”·ç”Ÿèº«ä¸Šï¼Œå¯ä»¥å®¹å¿ç”·ç”Ÿçš„ä¸€åˆ‡ï¼Œä½†å—åˆ°ä¸»çº¿ä¸€ä¸­å¤«å¦»çš„å½±å“ï¼Œæƒ³ç»“å©šï¼Œæƒ³è¦å­©å­ï¼Œäºæ˜¯çŸ›ç›¾å°±å‡ºç°äº†ã€‚</p><p>å››ä¸ªä¸»çº¿æ¥å›åˆ‡æ¢åˆäº’ç›¸å½±å“ï¼Œç¼–å‰§å¾ˆå‰å®³ã€‚æˆ‘åœ¨çœ‹å‰§çš„è¿‡ç¨‹ä¸­ï¼Œå¤§çº¦å¤¸äº†å››æ¬¡&ldquo;æ¬¡å¥¥ã€‚ã€‚ç¼–å‰§çœŸç‰›æ°&rdquo;ã€‚åœºæ™¯åˆ‡æ¢å¾—å¾ˆä¹Ÿæµç•…ï¼Œåˆ†é•œæ‰‹æ³•è¿ç”¨å¾—ä¹Ÿå¾ˆå¨´ç†Ÿï¼Œæœ‰äº›åœºæ™¯çš„é•œå¤´æ‘‡æ™ƒè®©äººä»å¿ƒåº•æ„Ÿåˆ°æ€¥èºï¼Œè¿™ç‚¹å¾ˆèµã€‚å¶å°”å‡ºç°çš„æ—ç™½å¾ˆè®¨å·§ã€‚ä¸»çº¿çš„çŸ›ç›¾ç‰¹åˆ«çªå‡ºï¼Œäººç‰©æ€§æ ¼é€šè¿‡ä¸¤ä¸‰ä¸ªé•œå¤´å°±èƒ½ä½“ç°å‡ºæ¥ã€‚è™½ç„¶ä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒç‹—è¡€çš„åœºæ™¯ï¼Œä¸€äº›é…éŸ³é‡åˆ¶ï¼Œå’Œä¸€äº›æ¯”è¾ƒæ˜æ˜¾çš„å¹¿å‘Šæ¤å…¥ï¼Œä½†å®Œå…¨ä¸ä¼šå½±å“åˆ°è¿™éƒ¨ç‰‡å­çš„å…‰åã€‚</p><p>å­©å­çš„å“­å£°å‡ ä¹åœ¨å‰§çš„ä¸­åéƒ¨æ¯é›†éƒ½æœ‰ã€‚å“­å£°ä»£è¡¨äº†ä¸å®‰ã€æ‚²ä¼¤ï¼Œåœ¨åµæ¶çš„æ—¶å€™å­©å­çš„å“­å£°å°±æ˜¯å‚¬åŒ–å‰‚ï¼Œè®©åœºæ™¯æ˜¾å¾—ç‰¹åˆ«æ··ä¹±ï¼Œè§‚ä¼—å¿ƒç†çš„ç„¦èºã€ä¸å®‰åˆ°è¾¾é¡¶ç‚¹ï¼Œå¥½å‡ æ¬¡å¬åˆ°å­©å­åˆºè€³çš„å“­å£°éƒ½æœ‰ç‚¹çœ‹ä¸ä¸‹å»äº†ã€‚</p><p>å‡ ä¹è·Ÿå…¶ä»–çš„å‰§ä¸€æ ·ï¼Œæ€»ä¼šæœ‰å‡ ä¸ªè§’è‰²ï¼Œè®©äººè§ä¸€æ¬¡å°±æƒ³éª‚ä¸€æ¬¡ï¼›ä¹Ÿæ€»ä¼šæœ‰ä¸€äº›å‰§æƒ…ï¼Œè®©è§‚ä¼—å¤§éª‚&ldquo;æ¬¡å¥¥ï¼Œéš¾é“å°±ä¸èƒ½é‚£æ ·æˆ–è€…é‚£æ ·å—ï¼Ÿéå¾—è¿™ä¹ˆåšï¼Ÿ&rdquo;ã€‚æ²¡åŠæ³•ï¼Œè¿™éƒ¨å‰§ä¹Ÿä¸èƒ½è„±ä¿—ã€‚æœ€åæ±‚å©šçš„éƒ¨åˆ†è®©äººçœ¼å‰ä¸€äº®ï¼Œé­æ™¨çš„åŠ å…¥ä¹Ÿè®©è¿™éƒ¨åˆ†å¢è‰²ä¸å°‘ã€‚</p><p>å‰§çš„èƒŒæ™¯éŸ³ä¹ä¸€èˆ¬ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯è¯¥å…¥çš„æ—¶å€™æ²¡å…¥ï¼Œä¸è¯¥å…¥çš„æ—¶å€™çå…¥ï¼Œä½†è´¨é‡å°šå¯ã€‚</p><p>å¹´è½»æ¼”å‘˜çš„è¡¨æ¼”éƒ½å¾ˆå‡ºå½©ï¼Œå¬‰ç¬‘æ€’éª‚æ¯«ä¸åšä½œï¼Œæƒ…æ„Ÿæ”¶æ”¾è‡ªå¦‚ï¼Œå†åŠ ä¸Šå¯¼æ¼”çš„æ‰‹æ³•ä¸é”™ï¼Œè®©å‡ ä¸ªä¸»æ¼”å¤§æ”¾å¼‚å½©ã€‚å¹´çºªå¤§ç‚¹çš„æ¼”å‘˜ç¨æ˜¾æ‹˜æŸï¼Œä½†æ˜¯70å¤šå²çš„å§¥å§¥æ˜¯ä¸ªä¾‹å¤–ï¼Œç®—æ˜¯æœ¬å‰§çš„çµé­‚äººç‰©ä¹‹ä¸€ï¼Œæ˜¯&ldquo;ä¼ é“ã€æˆä¸šã€è§£æƒ‘&rdquo;çš„è§’è‰²ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒæŠ›æ‰å°‘é‡çš„ç³Ÿç²•ï¼Œæ»¡åˆ†5åˆ†ï¼Œæ­¤å‰§å¯ä»¥ç»™4åˆ†äº†ã€‚</p><p>&nbsp;</p><h2 id="å…³äºæ„Ÿæƒ³"><a href="#å…³äºæ„Ÿæƒ³" class="headerlink" title="å…³äºæ„Ÿæƒ³"></a>å…³äºæ„Ÿæƒ³</h2><p>å…¶å®æ€»é‡Œæ€»å½’ï¼Œè¿™éƒ¨ç‰‡å­æœ€å¤§çš„çŸ›ç›¾å°±æ˜¯&ldquo;ç†æƒ³ä¸ç°å®&rdquo;ã€‚</p><p>ç†æƒ³ä¸ç°å®ï¼Œè¿™ä¸ªè¯é¢˜è›®æ²‰é‡çš„ã€‚æ— è®ºæ˜¯æåˆ°ä»€ä¹ˆä¸Šï¼Œ&ldquo;ç†æƒ³å¾ˆä¸°æ»¡ï¼Œç°å®å¾ˆéª¨æ„Ÿ&rdquo;è¿™å¥è¯éƒ½èƒ½ç”¨å¾—ä¸Šã€‚æ¢¦é‡Œè‡ªå·±çš„ç™½é©¬ç‹å­æˆ–è€…ç™½é›ªå…¬ä¸»æ­£å‡†å¤‡è·Ÿè‡ªå·±æ‰“å•µå‘¢ï¼Œä¸€ççœ¼ï¼Œæ˜¯è‡ªå·±çš„å±‹å­ï¼Œæƒ³åˆ°è¿˜æ˜¯å•èº«ï¼Œè¿™ç§å¯¹æ¯”å°±å¾ˆè®©äººéš¾å—äº†ã€‚åˆšä¸€æ¯•ä¸šï¼Œæ»¡æ€€ç†æƒ³å‡†å¤‡åˆ°ç¤¾ä¼šä¸Šå¤§å±•å®å›¾å®ç°è‡ªå·±çš„äººç”Ÿä»·å€¼ï¼Œå´å¤„å¤„ç¢°å£ï¼Œè¢«æ…åˆ€å­ï¼Œåªèƒ½éšä¾¿æ‰¾äº†ä»½å·¥ä½œï¼Œå´æ‹¿ç€æ°¸è¿œä¸æ¶¨ä»·çš„å·¥èµ„ä¹°åˆ†åˆ†é’Ÿåœ¨æ¶¨ä»·çš„é£Ÿç‰©ã€‚ä»¥ä¸ºæ‰¾åˆ°äº†è‡ªå·±äººç”Ÿçš„å¦ä¸€åŠï¼Œå‡†å¤‡å…±ç»“è¿ç†åŒåº¦ä½™ç”Ÿï¼Œå´å‘ç°æ²¡æˆ¿æ²¡è½¦æ²¡é’±ï¼Œæƒ³åšä»€ä¹ˆéƒ½ä¸¾æ­¥ç»´è‰°ã€‚</p><p><em><strong>æ˜¯ä¸æ˜¯å¾ˆç°å®ï¼Ÿ</strong></em></p><p>å‰§ä¸­ä¸»çº¿ä¸€é‡Œçš„å°å¤«å¦»ï¼Œåœ¨å­©å­è¿˜æ²¡ç”Ÿä¸‹æ¥ä¹‹å‰ï¼Œå¯¹æœªæ¥ç”Ÿæ´»å……æ»¡äº†å¸Œæœ›ï¼Œä»–ä»¬è¦ä½æ›´å¤§çš„æˆ¿å­ï¼Œä»–ä»¬è¦è®©å­©å­ä¸Šä¸ªå¥½å­¦æ ¡ï¼Œä»–ä»¬è¦è®©ç”Ÿæ´»è´¨é‡æ›´å¥½ã€‚ã€‚ä½†å­©å­ä¸€å‡ºç”Ÿåï¼Œæƒ…å†µå°±è·Ÿä»–ä»¬çš„è§„åˆ’å®Œå…¨ä¸ä¸€æ ·äº†ã€‚å› ä¸ºå­©å­ï¼Œå¥³ä¸»ä¸¢äº†åŸæ¥çš„èŒä½ï¼Œç”·ä¸»ä¹Ÿé™©äº›è¢«è¾é€€ï¼Œå®¶åº­è´¢æ”¿å…¥ä¸æ•·å‡ºï¼Œä¸¤å£å­ä»å©šå‰çš„ç”œç”œèœœèœœï¼Œåˆ°ç”Ÿå„¿å­ååµçš„å¤©ç¿»åœ°è¦†ï¼Œå…¶ä¸­çš„è½å·®å¯è§ä¸€æ–‘ã€‚</p><p>æˆ‘ä¸çŸ¥é“åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè¿™æ ·çš„æƒ…å†µå¤šä¸å¤šï¼Œæ¯•ç«Ÿæˆ‘çš„æˆé•¿è¿‡ç¨‹è¿˜æ˜¯å¾ˆé¡ºåˆ©çš„ï¼Œè™½ç„¶å®¶åº­çŠ¶å†µä¸å¤ªå¥½ï¼Œä½†æˆ‘çš„ç«¥å¹´è¿˜æ˜¯å¾ˆå¿«ä¹çš„ï¼Œéƒ½æ˜¯ç¾å¥½çš„å›å¿†ã€‚çˆ¸å¦ˆå‡ ä¹æ²¡æœ‰å› ä¸ºè´¢æ”¿ï¼Œæˆ‘ä¸Šå­¦å•¥çš„é—®é¢˜åµè¿‡æ¶ã€‚</p><p>ä¸»çº¿äºŒä¸­ç‰¹ç«‹ç‹¬è¡Œçš„å¥³å­©ï¼Œä»å°å°±æ˜¯å®¶é‡Œå¤´ç–¼çš„å¯¹è±¡ï¼Œä¸å¥½å¥½ä¸Šå­¦ï¼Œä¸å¬è¯ï¼Œé•¿å¤§äº†ä¹Ÿä¸å¬è¯ï¼Œæœ‰ç€ä¸€æ®µéš¾å¿˜çš„ç»å†ï¼Œæˆ–è®¸è¿˜æœ‰ä¸€äº›ä¸åˆ‡å®é™…çš„å¹»æƒ³ï¼Œä¸ç›¸ä¿¡ä»»ä½•äººï¼Œè‡ªå·±å¼€çº¹èº«åº—ï¼Œç”¨è‡ªå·±çš„é’±ç…§é¡¾æµæµªçŒ«ï¼Œä¸æƒ³ç»“å©šï¼Œä¸æƒ³è°ˆæ‹çˆ±ã€‚æœ€ç»å…¸çš„å°è¯å°±æ˜¯&ldquo;æˆ‘çš„äººç”Ÿç†æƒ³ï¼Œå°±æ˜¯å½“æˆ‘çš„å®¢äººç™¾å¹´ä¹‹åï¼Œä»–ä»¬çš„äº²äººçœ‹ç€ä»–ä»¬èº«ä¸Šçš„æˆ‘çš„çº¹èº«ä½œå“ï¼Œæ€ä¹ˆä¹Ÿèˆä¸å¾—æŠŠä»–ä»¬æ”¾è¿›ç„šåŒ–ç‚‰ï¼Œè§‰å¾—å°±è¿™ä¹ˆçƒ§äº†ï¼Œç®€ç›´å°±æ˜¯æ¯åè‰ºæœ¯çå“ï¼&rdquo;è¿™æ ·ä¸€ä¸ªå¥³å­©ï¼Œå´ä¸ºäº†ä¸€ä¸ªæ¡æ¥çš„å°å­©å€¾å°½è‡ªå·±æ‰€æœ‰çš„æ„Ÿæƒ…ã€‚å½“å¥¹ä¸é«˜å¯Œå¸…ç›¸å¤„å¤šäº†ï¼Œä¹Ÿäº§ç”Ÿäº†æ„Ÿæƒ…ï¼ˆ*<span style="font-size:14px;">æˆ‘è·Ÿåª³å¦‡ä»å¼€å¤´å°±çŒœä¸­äº†ï¼Œæ˜¯ä¸æ˜¯å›½äº§å‰§çš„æ‚²å“€ï¼Ÿ</span>*ï¼‰ï¼Œä½†å¹»æƒ³ç¾å¥½çˆ±æƒ…çš„æ—¶å€™ï¼Œå´è¢«é«˜å¯Œå¸…çš„æ¯äº²å’Œ&ldquo;å‰æœªå©šå¦»&rdquo;å°†è¿™ä¸ªæ¢¦ç²‰ç¢äº†ã€‚</p><p>æˆ‘ä¸è®¤è¯†è¿™æ ·çš„å¥³ç”Ÿã€‚ä¹‹å‰çš„æ±‚å­¦ç”Ÿæ¶¯ä¸­æœ‰ä¸€äº›æ¯”è¾ƒmançš„å¥³åŒå­¦ï¼Œæˆ–è€…å¥¹ä»¬ä¹Ÿæœ‰ç€è‡ªå·±çš„ç†æƒ³ï¼Œæƒ³åªèº«åº¦è¿‡ä¸€è¾ˆå­ï¼Œä½†åæ¥è¿˜ä¸æ˜¯ä¸€ä¸ªä¸ªéƒ½å«äººç”Ÿå­äº†ã€‚æ²¡åŠæ³•ï¼Œä½ ä¸ç»“å©šä½ å°±æ˜¯å¼‚ç±»ï¼Œä½ æ˜¯å¼‚ç±»å®¶é‡Œäººéƒ½æ²¡é¢å­å•¦ï¼Œè¿å‡ºå»é€›è¡—éƒ½è¦å¿å—é‚»å±…å¼‚æ ·çš„çœ¼å…‰ï¼Œè¿™è®©ä»–ä»¬æƒ…ä½•ä»¥å ªå‘¢ã€‚</p><p>ä¸»çº¿ä¸€çš„å¥³ä¸»ä¸€ç›´å‘å¾€ç€ä¸€ç§èŒåœºç”Ÿæ´»ï¼Œå°±æ˜¯åŠªåŠ›å°±æœ‰å›æŠ¥ã€‚å¥¹çš„åŠªåŠ›åœ¨ç”Ÿå®Œå­©å­ä¹‹åå°±åŒ–ä¸ºäº†æ³¡å½±ã€‚å…¬å¸æŠ›å¼ƒäº†å¥¹ï¼Œå¥¹åŸæ¥çš„ä¸‹å±éª‘åˆ°äº†å¥¹çš„å¤´ä¸Šè€€æ­¦æ‰¬å¨ã€‚å¥¹å¿äº†ï¼Œå¯¹äºåŸä¸‹å±æ‰€æœ‰çš„æ¶åŠ£è¡Œå¾„ã€‚å½“ç„¶æœ€åç»“æœæ˜¯åœ†æ»¡çš„ï¼Œä¸‹å±å°±æ˜¯ä¸‹å±ï¼Œå¦‚æœåªæƒ³é€šè¿‡ç©æ‰‹æ®µä¸Šä½ï¼Œå°±æ°¸è¿œåªèƒ½æ˜¯ä¸‹å±ã€‚ç¼–å‰§è¿˜æ˜¯æƒ³é€šè¿‡è¿™æ”¯ä¸»çº¿æ¥ä¼ é€’ä¸€äº›æ­£èƒ½é‡çš„ã€‚ç‰‡ä¸­æœ‰æ®µå¥³ä¸»è·Ÿä¸‹å±çš„è°ˆè¯ï¼Œé—®&ldquo;ä½ çš„æ¢¦æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ&rdquo;ï¼Œä¸‹å±æ¯«ä¸çŠ¹è±«åœ°è¯´ï¼š&ldquo;è¶…è¶Šä½ å°±æ˜¯æˆ‘çš„æ¢¦æƒ³ã€‚&rdquo;</p><p>èŒåœºå¾ˆå±é™©ï¼Œå‡¡æ˜¯å·¥ä½œäº†çš„äººéƒ½çŸ¥é“ã€‚æˆ‘ä¹‹å‰æœ‰ä¸€ä¸ªåŒäº‹ï¼Œè¢«å¦å¤–çš„äººæ…è¿‡åˆ€å­ï¼Œç„¶åç›´æ¥å°±è¢«è¾äº†ã€‚è€Œä¸”ï¼Œåˆ€å­çš„ä¸»äººå¹³æ­¥é’äº‘ï¼Œç°åœ¨ä¼¼ä¹å·²ç»ä¸Šå‡åˆ°æ€»ç»ç†çš„èŒä½äº†ã€‚ç”Ÿæ´»ä¸æ˜¯ç”µè§†å‰§ï¼ŒèŒåœºé‡Œä¸€æ—¦æœ‰äº†ç«äº‰ï¼Œå¹¶ç‰µæ‰¯åˆ°åˆ©ç›Šï¼Œé‚£ä¹ˆä¸æ˜¯ä½ æ­»å°±æ˜¯æˆ‘æ­»ã€‚æˆ‘è¿˜æ²¡æœ‰ç»å†è¿‡è¿™ç§äº‹æƒ…ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘åœ¨èŒåœºæ··çš„æ—¶é—´å¤ªçŸ­ï¼Œä¸ä¼šåŠ¨åˆ°åˆ«äººçš„åˆ©ç›Šï¼Œä¹Ÿä¸ä¼šæœ‰äººæ¥è·Ÿæˆ‘æŠ¢ä»€ä¹ˆï¼Œæˆ–è€…æœ‰äººæ…äº†æˆ‘ä¸€åˆ€ï¼Œæˆ‘æ²¡æ„Ÿè§‰åˆ°ï¼Œæˆ–è€…ä»–æ…åäº†ä¼¤åˆ°è‡ªä¸ªäº†ä¹Ÿä¸ä¸€å®šã€‚</p><p>å†è¯´ä¸»çº¿å››çš„ç”·ç”Ÿã€‚è¿™ç§ç”·ç”Ÿæ„Ÿè§‰ç°å®ç”Ÿæ´»ä¸­åº”è¯¥æœ‰å¾ˆå¤šï¼Œä¸ºäº†è‡ªå·±çš„ç†æƒ³ä¸é¡¾ä¸€åˆ‡ï¼Œç”šè‡³ä¼¤å®³çˆ±è‡ªå·±çš„äººå’Œè‡ªå·±çˆ±çš„äººã€‚å¯¹äºä»–æ¥è¯´ï¼Œæ‘„å½±å°±æ˜¯ä»–çš„ä¸€åˆ‡ï¼Œä»–åœ¨å‰§ä¸­ä¹Ÿä¸åªä¸€æ¬¡åœ°å¼ºè°ƒè¿‡ï¼Œä»–ä¸å–œæ¬¢è¢«æ “ä½çš„æ„Ÿè§‰ï¼Œä»–è¦è‡ªç”±åœ°ç”Ÿæ´»ï¼Œä»–ä¸æƒ³è®©ç»“å©šå’Œå­©å­å’Œæ²¹ç›é…±é†‹æ¯äº†è‡ªå·±çš„æ¢¦æƒ³ã€‚å¯æ˜¯å‘¢ï¼Œæœ€åä»–è¿˜æ˜¯æ‚Ÿäº†ï¼Œç°å®å°±æ˜¯ç°å®ï¼Œç”·äººè¦æˆé•¿ï¼Œå°±å¿…é¡»è¦ç»å†ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ç»“å©šï¼Œæ¯”å¦‚ç”Ÿå­©å­ã€‚</p><p>ç‰‡ä¸­å‡ ä¹æ¯ä¸€ä¸ªä¸»è§’éƒ½è¢«é—®è¿‡ä¸€ä¸ªåŒæ ·çš„é—®é¢˜ï¼šä½ è¿˜æœ‰æ¢¦æƒ³å—ï¼Ÿ</p><p>æˆ‘å…¶å®åœ¨çœ‹åˆ°è¿™éƒ¨å‰§çš„åå­—çš„æ—¶å€™ï¼Œæˆ‘æ˜¯æœ‰ç‚¹æŠµè§¦çš„ã€‚æˆ‘æ€•è‡ªå·±ä¼šå› ä¸º&ldquo;å°å„¿éš¾å…»&rdquo;å¯¹è‡ªå·±æ‰€åšæŒçš„ç”Ÿæ´»æœ‰æ‰€åŠ¨æ‘‡ã€‚</p><p>ä½†æ˜¯ï¼Œçœ‹å®Œäº†ï¼Œå´åˆè±ç„¶å¼€æœ—ã€‚ç”·ä¸»çš„å¦ˆå¦ˆè¯´äº†ä¸€å¥å¾ˆè®©æˆ‘å—ç”¨çš„è¯ï¼Œ&ldquo;è€è¯è¯´å°å„¿éš¾å…»ï¼Œè¿™å…»ï¼Œä¸æ˜¯æŒ‡çš„å…»æ´»ï¼Œè€Œæ˜¯ä½ ä¸ºäººçˆ¶æ¯çš„é‚£ä»½è´£ä»»ã€‚&rdquo;ç”Ÿæ´»ï¼Œå°±ç®—è´¨é‡å†æ€ä¹ˆé«˜ï¼Œæœ‰å¤§çš„æˆ¿å­ï¼Œæœ‰é«˜æ¡£çš„æ±½è½¦ï¼Œä½†æœ€é‡è¦çš„ï¼Œè¿˜æ˜¯ä¸€å®¶äººéƒ½åœ¨ä¸€èµ·ï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>çœ‹ç€çœ‹ç€ï¼ŒæŠŠåª³å¦‡çš„&ldquo;å©šå‰ææƒ§ç—‡&rdquo;ç»™å‹¾å‡ºæ¥äº†ã€‚å…¶å®ã€‚ã€‚åˆ°åº•æ˜¯ä¸æ˜¯å©šå‰ææƒ§ç—‡ï¼Œæˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šã€‚ã€‚èŠäº†ä¸€ä¼šï¼Œå‘ç°å…¶å®è¿‡æ—¥å­å°±æ˜¯è¿™æ ·ï¼Œå¹³å¹³æ·¡æ·¡çš„æ‰æœ€çœŸã€‚é—®äº†é—®ä»Šå¹´åˆšç»“å©šçš„åŒäº‹ï¼Œæœ‰æ²¡æœ‰å©šå‰ææƒ§ç—‡ï¼Œä»–æ–©é’‰æˆªé“åœ°è¯´ï¼š&ldquo;æœ‰å“‡ï¼å¿…é¡»æœ‰å“‡ï¼&rdquo;æˆ‘é—®ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä»–è¯´&ldquo;å¤§çº¦ç»“å©šå‰ä¸€ä¸ªæœˆå§ã€‚ç»“å®Œå©šå°±å¥½äº†ã€‚&rdquo;</p><p>äºæ˜¯æˆ‘è·Ÿåª³å¦‡è¯´ï¼Œå’±ä»¥ååˆ«çœ‹è¿™æ ·çš„ç‰‡å­äº†ï¼Œä¼šå¯¹å’±ä»¬æœ‰å½±å“çš„ã€‚å›½äº§çš„ç”µè§†å‰§ï¼Œæ­£é¢å‘çš„å±…å¤šï¼ˆæˆ–è€…åº”è¯¥æ˜¯ç»å¤§éƒ¨åˆ†ï¼‰ï¼Œä½†æ˜¯ä¸æ‰¯å©†åª³ã€ä¸æ‰¯ç”Ÿæ´»ã€ä¸æ‰¯å©šå§»çš„å°‘ã€‚çœ‹å¤šäº†ï¼Œæ€ç»´å®šå¼äº†ï¼Œå¤šå¤šå°‘å°‘è¿˜æ˜¯ä¼šå—å½±å“çš„ã€‚</p><p>æ¯•ç«Ÿï¼Œç”Ÿæ´»è¿˜æ˜¯å¾—å’±è‡ªå·±æ¥è¿‡ã€‚</p><p>&nbsp;</p><h2 id="å…³äºç†æƒ³"><a href="#å…³äºç†æƒ³" class="headerlink" title="å…³äºç†æƒ³"></a>å…³äºç†æƒ³</h2><p>ç†æƒ³è¿™ç©æ„å·®ä¸å¤šæ¯ä¸ªäººéƒ½ä¼šæœ‰ï¼Œè€Œä¸”åœ¨å¾ˆå°çš„æ—¶å€™å°±ä¼šæœ‰ã€‚å› ä¸ºå¾ˆå°çš„æ—¶å€™æ¥è§¦çš„ä¸œè¥¿éƒ½æ˜¯ç§¯æå‘ä¸Šçš„ï¼Œå¾ˆå®¹æ˜“å°±è®©äººæœ‰å„ç§ç†æƒ³ã€‚é—®äº†é—®å‘¨é­çš„äººï¼Œå°æ—¶å€™çš„ç†æƒ³ä¹Ÿæ˜¯äº”èŠ±å…«é—¨çš„ï¼Œæœ‰æƒ³åšè€å¸ˆçš„ï¼Œæœ‰æƒ³åšç§‘å­¦å®¶çš„ï¼Œæœ‰æƒ³å½“æ€»ç»Ÿçš„ï¼Œæœ‰æƒ³å½“é£è¡Œå‘˜çš„ï¼Œæœ‰æƒ³å½“åŒ»ç”Ÿçš„ï¼Œæƒ³å½“å¸æœºçš„ï¼Œå½“æ¼”å‘˜å½“æ•°å­¦å®¶å½“ç”»å®¶å½“ç”Ÿæ„äººã€‚ã€‚ç­‰ç­‰ç­‰ç­‰ã€‚ä½†æ˜¯ï¼Œä»–ä»¬ç°åœ¨è·Ÿæˆ‘ååœ¨ä¸€èµ·ï¼Œå˜æˆäº†ä¸ªç å†œã€‚</p><p>æˆ‘å°æ—¶å€™ï¼Œå—æˆ‘çˆ¸çˆ¸çš„å½±å“ï¼Œæƒ³çš„æ˜¯é•¿å¤§äº†è¦å½“ç§‘å­¦å®¶ã€‚æˆ‘è·Ÿæˆ‘çˆ¸éƒ½å–œæ¬¢é«˜ç§‘æŠ€çš„ç©æ„ï¼Œä»–å¹´è½»çš„æ—¶å€™æŠ˜è…¾è¿‡æ— çº¿ç”µï¼Œä¹Ÿæœ‰ä¸€äº›å°æˆæœï¼Œè€Œä¸”å¯¹æœºæ¢°åŸç†æ— æ¯”ç²¾é€šï¼Œè¿™ä¸¤æ ·çœ‹æ¥æˆ‘æ²¡æ€ä¹ˆç»§æ‰¿ã€‚ã€‚é‚£æ—¶å€™æ„Ÿè§‰ç§‘å­¦å®¶å°±æ˜¯ç¥ä¸€èˆ¬çš„å­˜åœ¨ï¼Œæ²¡æœ‰ä»–ä»¬è§£å†³ä¸äº†çš„é—®é¢˜ã€‚</p><p>åæ¥ï¼Œé•¿å¤§ä¸€ç‚¹ï¼Œå—åˆ°ç½‘ç»œå½±å“ï¼Œæƒ³åšä¸€åé»‘å®¢ï¼Œæˆ–è€…æ˜¯æŠ€æœ¯å°–ç«¯äººæ‰ï¼Œæˆ‘è®°å¾—æœ€éœ‡æ†¾æˆ‘çš„æ˜¯å½“å¹´çš„&ldquo;ç†ŠçŒ«çƒ§é¦™&rdquo;ï¼Œè®©æˆ‘èŒç”Ÿæ­¤æ„ã€‚</p><p>ç°åœ¨ã€‚ã€‚å¯èƒ½æˆ‘çš„ç†æƒ³å°±æ˜¯å¹³å¹³å®‰å®‰çš„ï¼Œè·Ÿåª³å¦‡å®‰ç¨³åœ°è¿‡ä¸€è¾ˆå­ï¼Œèµšè¶³å¤Ÿçš„é’±è®©å¨˜å„¿ä¿©ã€è®©æˆ‘ä»¬çˆ¸å¦ˆéƒ½èƒ½è¿‡ä¸Šå¥½ç‚¹çš„æ—¥å­ã€‚</p><p>å˜åŒ–æ˜¯ä¸æ˜¯ç›¸å½“å¤§ï¼Ÿ</p><p>æœ‰äººè¯´äº†ï¼Œäººæ˜¯ä¼šæˆé•¿çš„å˜›ï¼Œæ€æƒ³æ˜¯ä¼šå˜åŒ–çš„å˜›ã€‚ä½†æ˜¯æˆ‘è¦è¯´çš„æ˜¯ï¼Œç†æƒ³è¿™ä¸ªä¸œè¥¿ï¼Œä¸åº”è¯¥éšç€äººçš„æˆé•¿é¢å˜åŒ–ï¼Œå¦‚æœå˜åŒ–äº†ï¼Œé‚£è¿™ä¸œè¥¿å°±ä¸å«ç†æƒ³ï¼Œå……å…¶é‡å«ä¸ªç›®æ ‡ã€‚</p><p>å…³äºç†æƒ³çš„è¯ï¼Œæœ‰å¾ˆå¤šæƒ³è¯´çš„ï¼Œä½†æ˜¯åˆ°äº†é”®ç›˜ä¸Šå´æ‰“ä¸å‡ºæ¥äº†ã€‚</p><p>&nbsp;</p><h2 id="å…³äºè¯¾å¤–ä½œä¸š"><a href="#å…³äºè¯¾å¤–ä½œä¸š" class="headerlink" title="å…³äºè¯¾å¤–ä½œä¸š"></a>å…³äºè¯¾å¤–ä½œä¸š</h2><p>ä½ çš„ç†æƒ³æ˜¯ä»€ä¹ˆæ¥ç€ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äººç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›å®¶ï¼Œå°èˆ…å­ç»“å©š~</title>
      <link href="//gabby/%25e5%259b%259e%25e5%25ae%25b6%25ef%25bc%258c%25e5%25b0%258f%25e8%2588%2585%25e5%25ad%2590%25e7%25bb%2593%25e5%25a9%259a/"/>
      <url>//gabby/%25e5%259b%259e%25e5%25ae%25b6%25ef%25bc%258c%25e5%25b0%258f%25e8%2588%2585%25e5%25ad%2590%25e7%25bb%2593%25e5%25a9%259a/</url>
      
        <content type="html"><![CDATA[<p style="text-align: center;">  ä¼šæœ‰äº”å¤©å’Œå¤§å®¶å¤±å»è”ç³»å‘¢ã€‚ã€‚</p><p style="text-align: center;">  æ— è®ºå¦‚ä½•ï¼Œå¶å¯ä¸æ˜¯äººé—´è’¸å‘äº†ï¼Œåªæ˜¯åˆæš‚æ—¶æ€§ç¦»å¼€ç½‘ç»œã€‚ã€‚</p><p style="text-align: center;">  ä¼šæƒ³ä½ ä»¬çš„å“Ÿ~</p><p style="text-align: center;">  <img alt="" src="http://images.cy198706.com/Gabby/leaving.jpg" /></p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¬è¯´ç”¨Wordä¹Ÿå¯ä»¥å‘å¸ƒæ–‡ç« </title>
      <link href="//tech/%25e5%2590%25ac%25e8%25af%25b4%25e7%2594%25a8word%25e4%25b9%259f%25e5%258f%25af%25e4%25bb%25a5%25e5%258f%2591%25e5%25b8%2583%25e6%2596%2587%25e7%25ab%25a0/"/>
      <url>//tech/%25e5%2590%25ac%25e8%25af%25b4%25e7%2594%25a8word%25e4%25b9%259f%25e5%258f%25af%25e4%25bb%25a5%25e5%258f%2591%25e5%25b8%2583%25e6%2596%2587%25e7%25ab%25a0/</url>
      
        <content type="html"><![CDATA[<p><strike><span style="font-size:12pt">TableLayout: </span></strike></p><p><strike>android:stretchColumns=â€0â€ ä»£è¡¨è®©ç¬¬ä¸€è¡Œæ‰©å±•åˆ°æ•´è¡Œ</strike></p><p>è¯•è¯•çœ‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é‡‘åˆšé’» </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç«¯åˆåä¸Šè‰åŸè¡Œï¼ˆé«˜æ¸…æ— ç å¤šå›¾ï¼Œå°æ°´ç®¡æ…å…¥ï¼‰</title>
      <link href="//gabby/%25e7%25ab%25af%25e5%258d%2588%25e5%259d%259d%25e4%25b8%258a%25e8%258d%2589%25e5%258e%259f%25e8%25a1%258c%25ef%25bc%2588%25e9%25ab%2598%25e6%25b8%2585%25e6%2597%25a0%25e7%25a0%2581%25e5%25a4%259a%25e5%259b%25be%25ef%25bc%258c%25e5%25b0%258f%25e6%25b0%25b4%25e7%25ae%25a1%25e6%2585%258e%25e5%2585%25a5%25ef%25bc%2589/"/>
      <url>//gabby/%25e7%25ab%25af%25e5%258d%2588%25e5%259d%259d%25e4%25b8%258a%25e8%258d%2589%25e5%258e%259f%25e8%25a1%258c%25ef%25bc%2588%25e9%25ab%2598%25e6%25b8%2585%25e6%2597%25a0%25e7%25a0%2581%25e5%25a4%259a%25e5%259b%25be%25ef%25bc%258c%25e5%25b0%258f%25e6%25b0%25b4%25e7%25ae%25a1%25e6%2585%258e%25e5%2585%25a5%25ef%25bc%2589/</url>
      
        <content type="html"><![CDATA[<p>åˆå¥½ä¹…æ²¡æœ‰ç”Ÿäº§æ–‡ç« äº†ã€‚åŸå› ä¹Ÿå¾ˆå·®å¼ºäººæ„ &#8212; æœ€è¿‘æ¯”è¾ƒå¿™ã€‚</p><p>å‰å‰ååå·®ä¸å¤šå¿™äº†åŠä¸ªæœˆï¼Œè¿˜æ˜¯åœ¨åšè‡ªå·±ä¸è¯¥åšçš„ä¸œè¥¿ã€‚</p><p>è¶ç€ç«¯åˆçš„3å¤©å°å‡ï¼Œæˆ‘ä»¬æ‰“ç®—å‡ºå»ç©ç©ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€é€šï¼Œæœ€åå†³å®šå»ä»å»å¹´å°±æƒ³è¦å»çš„ä¸°å®åä¸Šè‰åŸã€‚</p><p>æœ¬æ¥è®¡åˆ’åå…¬äº¤ï¼Œåæ¥åª³å¦‡åŒäº‹è¯´æœ‰è½¦ï¼Œäºæ˜¯æˆ‘ä»¬5ä¸ªäºº+2ä¸ªå°å­©ï¼Œå°±å—¨å—¨çš®çš®åœ°ä¸Šè·¯äº†ã€‚</p><p>è¿™æ¬¡æ—…ç¨‹ä¸­çš„å¿ƒæƒ…ï¼Œå¯ä»¥ç”¨ä¸€æ¡çº¿çš„è¯è¯­æ¥å½¢å®¹ï¼šå…´å¥‹ &#8211; ç¨€å¥‡ &#8211; éœ‡æ’¼ &#8211; æ„Ÿæ…¨ &#8211; å¤±æœ› &#8211; æ°”æ„¤ &#8211; æ— å¥ˆã€‚</p><p>æƒ…ç»ªä¸ºå•¥ä¼šæœ‰è¿™ä¹ˆå¤§çš„å˜åŒ–å‘¢ï¼Œä¸”è¡Œä¸”çœ‹å§ã€‚</p><span id="more"></span><p>æ—©ä¸Š5ï¼š40èµ·åºŠï¼Œå› ä¸ºè½¦ç¨‹å°†è¿‘6å°æ—¶ï¼Œæ‰€ä»¥èµ·å¾—ç‰¹æ—©ã€‚è¿™æ—¶å€™å¿ƒæƒ…æ˜¯ç›¸å½“å…´å¥‹ï¼ˆæˆ‘ä¼šå‘Šè¯‰ä½ 4ç‚¹æˆ‘å°±ç¡ä¸ç€äº†ä¹ˆï¼‰ã€‚åœ¨è½¦é‡Œï¼Œèµ°åˆ°æ€€æŸ”çš„æ—¶å€™ï¼Œå°±å·²ç»çœ‹åˆ°æ—è¾¹çš„å±±å’Œç»¿æ²¹æ²¹çš„ç”°åœ°äº†ã€‚ä»è¿™å„¿å¼€å§‹ï¼Œå°±æœ‰è„±ç¦»åŸå¸‚çš„æ„Ÿè§‰äº†ã€‚å› ä¸ºæˆ‘ä»å°åœ¨åŸå¸‚é‡Œé•¿å¤§ï¼Œåƒè¿™æ ·çš„å±±å•Šã€ç”°å•Šä¹‹ç±»çš„çœŸæ²¡çœ‹è¿‡ã€‚æ‰€ä»¥ä¸€è·¯ä¸Šæˆ‘æ˜¯ä¸œå¼ è¥¿æœ›ï¼Œæ¯ä¸€ä¸ªæ™¯éƒ½æƒ³æ”¶åœ¨è„‘æµ·é‡Œã€‚</p><p>&nbsp;</p><img alt="" src="http://images.cy198706.com/Travel/IMG_1812.JPG" style="width: 1024px; height: 768px;" /><p>**&uarr;**å¹²å‡€çš„é©¬è·¯ã€‚å› ä¸ºé©¬è·¯ä¸Šä¸ä¼šæœ‰äººä¸‹è½¦ï¼Œå¤§å®¶ä¹Ÿå¾ˆè‡ªè§‰åœ°ä¸å¾€è½¦çª—å¤–æ‰”ä¸œè¥¿ï¼Œæ‰€ä»¥é©¬è·¯ç‰¹åˆ«å¹²å‡€ã€‚è¿™æ˜¯åœ¨ä¸€ä¸ªå°çš„åœè½¦ç‚¹ç…§çš„ã€‚</p><img alt="" src="http://images.cy198706.com/Travel/IMG_1824.JPG" style="width: 1024px; height: 768px;" /><p>**&uarr;**è¿™ç‰‡å±±å«åšäº‘è’™å±±ã€‚è¿™ä¸ªåå­—ç‰¹åˆ«å½¢è±¡ã€‚å±±ä¸Šé£˜ç€çš„ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯çœŸçš„äº‘å½©ã€‚å½“å‰æµ·æ‹”ä¸çŸ¥é“æ˜¯å¤šå°‘ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1831.JPG"></p><p>**&uarr;**æ¯«æ— PSç—•è¿¹çš„äº‘ã€‚å› ä¸ºæ˜¯åœ¨è½¦ä¸Šï¼Œæ‰€ä»¥æ‹å¾—ä¸çœŸç€ã€‚æ„Ÿè§‰äº‘å°±åƒæ˜¯ä»å±±çš„é‚£è¾¹è¢«&ldquo;æ³¼&rdquo;ä¸Šæ¥çš„ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1839.JPG"></p><p>**&uarr;**æ²³åŒ—ç•Œæ—è¾¹çš„å±±ã€‚åœ¨æ²³åŒ—ç•Œæˆ‘ä»¬ä¼‘æ¯äº†10åˆ†é’Ÿï¼Œè¿™å±±çœŸæ˜¯è®©äººæ„Ÿåˆ°ç›¸å½“éœ‡æ’¼ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1842.JPG"></p><p>**&uarr;**åŒä¸Šï¼Œå› ä¸ºæ™¯è‰²å¤ªæ£’ï¼Œæ‰€ä»¥å¤šä¸Šå‡ å¼ ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1849.JPG"></p><p>**&uarr;**æ²³åŒ—ç•Œç‰Œå­ä¸‹æ–¹çš„å…¬è·¯ã€‚ç”¨è¿™ç§è§’åº¦æ‹å¾—è¿˜æ˜¯æŒºæœ‰feelçš„ã€‚</p><p>&nbsp;</p><p>åœ¨ä¸‹åˆ1ç‚¹å·¦å³çš„æ—¶å€™ï¼Œå› ä¸ºçƒ­ä¹ä¹ï¼Œæ‰€ä»¥ã€‚ã€‚ç¡ç€äº†ã€‚ã€‚ç­‰å†æ¬¡é†’æ¥ï¼Œå°±å·²ç»çœ‹åˆ°ä¸€äº›è’™å¤åŒ…ï¼Œé©¬ï¼Œé£è½¦ï¼Œå’Œå°ç‰‡çš„è‰åŸäº†ã€‚æ¸©åº¦å¤§çº¦åœ¨19åº¦å·¦å³ã€‚åˆšä¸‹è¿‡é›¨ï¼Œç©ºæ°”ç‰¹åˆ«ç‰¹åˆ«æ¸…æ–°ï¼ŒçœŸçœŸæ­£æ­£èƒ½æ„Ÿè§‰åˆ°ä»€ä¹ˆå«&ldquo;æ²äººå¿ƒè„¾&rdquo;ï¼Œå’Œéƒ½å¸‚é‡Œé‚£ç§æ±¡æµŠçš„ç©ºæ°”å·®è·ç®€ç›´å¤ªå¤§äº†ã€‚æˆ‘ä»¬æœ€åä¸€æ¬¡åœè½¦å°±æ˜¯ç¦»è‰åŸå¤§çº¦30åˆ†é’Ÿè½¦ç¨‹çš„åœ°æ–¹äº†ã€‚è¿™å„¿æ‹å¾—éƒ½ä¸æ€ä¹ˆå¥½ï¼Œå°±ä¸ä¸Šå›¾äº†ã€‚</p><p>åœ¨ç½‘ä¸ŠæŸ¥åˆ°åä¸Šæœ‰ä¸€ä¸ªä¸é”™çš„åº¦å‡æ‘å«&ldquo;æ‰æ‹‰è¥&rdquo;ï¼Œå¯¼èˆªè‡³æ­¤ï¼Œæ¶å¿ƒçš„éƒ¨åˆ†ä¹Ÿå°±å¼€å§‹äº†ã€‚</p><p><strong>é¦–å…ˆæ˜¯éåœ°çš„é©¬ç²ªã€‚</strong>é©¬ä¸€å¤šï¼Œé©¬ç²ªä¹Ÿå°±å¤šï¼Œå¯æ˜¯100ç±³çš„è·¯è¦èµ°3åˆ†é’Ÿï¼Œä½ ä¿¡å—ï¼ŸçœŸçš„è¦&ldquo;èº²ç€èµ°&rdquo;ï¼Œå› ä¸ºä¸€ä¸å°å¿ƒï¼Œä½ å¯èƒ½å°±è¸©åœ°é›·äº†ã€‚</p><p><strong>åƒåœ¾æ»¡åœ°ã€‚</strong>å…¶å®æœ¬æ¥æŒºå¹²å‡€ï¼Œå¯æ˜¯æ²¡ç´ è´¨çš„äººå®åœ¨å¤ªå¤šï¼Œå¯¼è‡´ç³ç…æ»¡ç›®çš„åƒåœ¾ã€‚çœŸæ˜¯ä¸€æ ·ç±³é¥²ç™¾æ ·äººï¼Œæ€»ä¼šæœ‰äººè·³å‡ºæ¥æ±¡æŸ“ç¾å¥½çš„ç¯å¢ƒã€‚</p><p><strong>ä½å®¿æ¡ä»¶ç‰¹åˆ«å·®ã€‚</strong>å¥½æ­¹ä¹Ÿæ˜¯&ldquo;è‘—å&rdquo;çš„åº¦å‡æ‘ï¼Œéš¾é“ä¸èƒ½æŠŠä½å®¿æ¡ä»¶æå¥½ç‚¹å—ï¼Ÿæ¥å¾…æˆ‘ä»¬çš„æ—¶å€™ï¼Œè¯´&ldquo;æœ‰ç”µè§†ã€æœ‰ç½‘ç»œã€24å°æ—¶çƒ­æ°´ï¼Œå“¦ï¼Œä½ é‚£è¾¹æ˜¯å‘é˜³çš„ï¼Œæ‰€ä»¥ä¼šç‰¹åˆ«èˆ’æœã€‚&rdquo;ç­‰åˆ°æ™šä¸Šå›å»åï¼Œå‘ç°ç”µè§†æ²¡ä¿¡å·ï¼Œç½‘ç»œå°±æ˜¯æ‰€è°“çš„GPRSä¿¡å·ï¼Œçƒ­æ°´éœ€è¦è‡ªå·±æ‰“å¼€çƒ­æ°´å™¨ï¼Œè‡ªå·±æ‰“å°±è‡ªå·±æ‰“å§ï¼Œå¯¹ä¸èµ·ï¼Œæ’åº§æ²¡ç”µã€‚</p><p><strong>å®°å®¢ç°è±¡ç‰¹åˆ«ä¸¥é‡ã€‚</strong>éª‘é©¬è¦60å—ä¸€å°æ—¶ï¼Œè‰åœ°æ‘©æ‰˜è¦120å—ä¸€å°æ—¶ï¼ŒåœŸè±†ä¸ä¸€ç›˜28ï¼Œé»„ç“œæ²¾é…±18ã€‚å…¶å®å‡ºæ¥ä¸€è¶Ÿå°±ä¸åœ¨ä¹èŠ±å¤šå°‘é’±äº†ï¼Œä½†æ˜¯èŠ±å¾—å€¼ä¸å€¼ï¼Œè¿˜å¾—å¦è¯´ã€‚</p><p><strong>æ‰€è°“çš„&ldquo;è‰åŸ&rdquo;éƒ½ä¸åœ¨åº¦å‡æ‘é™„è¿‘ï¼Œæƒ³å»è‰åŸï¼Œè‡ªå·±æ‰¾å»å§ã€‚</strong>åœ¨åº¦å‡æ‘é™„è¿‘çš„ï¼Œéƒ½æ˜¯å°è‰åœºï¼Œå¤§éƒ¨åˆ†éƒ½æ— æ³•è¿›å…¥ï¼ˆæœ‰é“ä¸ç½‘æ‹¦ç€ï¼‰ï¼Œå°±ç®—èƒ½è¿›å»çš„ï¼Œä¹Ÿæ˜¯éåœ°é©¬ç²ªã€‚æœ¬æ¥è®¡åˆ’çš„æ­å¸ç¯·é‡é¤ä¹Ÿå› æ­¤ææµ…äº†ã€‚</p><p>æˆ‘ä¸æ˜¯ä¸ªå–œæ¬¢æŠ±æ€¨çš„äººï¼ˆå‚è§<a href="http://cy198706.com/blog/gabby/%E5%BC%B1%E8%80%85%E5%8F%AA%E4%BC%9A%E6%8A%B1%E6%80%A8%EF%BC%8C%E5%BC%BA%E8%80%85%E6%80%BB%E4%BC%9A%E6%94%B9%E5%8F%98/">å¼±è€…åªä¼šæŠ±æ€¨ï¼Œå¼ºè€…æ€»ä¼šæ”¹å˜</a>ï¼‰ï¼Œä½†è·ŸæœŸæœ›å€¼å·®è·å¤ªå¤§ï¼Œå°±æœ‰ç‚¹è¯´ä¸è¿‡å»äº†ã€‚</p><p>ä¸‹åˆæˆ‘ä»¬æ¼«æ— ç›®çš„åœ°çé€›ï¼Œè¿˜çœŸè®©æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ç‰‡ä¸é”™çš„è‰åŸã€‚ä¹Ÿç¢°ä¸Šäº†è·Ÿæˆ‘ä»¬æœ‰åŒæ ·ç›®çš„çš„ä¸€å®¶ä¸‰å£ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1866.JPG"></p><p>**&uarr;**æœ‰æœ¨æœ‰Windows XPçš„æ„Ÿè„šï¼Ÿ<img alt="cheeky" height="24" src="http://cy198706.com/blog/wp-content/plugins/ck-and-syntaxhighlighter/ckeditor/plugins/smiley/images/6.gif" title="cheeky" width="24" /></p><p><img src="http://images.cy198706.com/Travel/IMG_1868.JPG"></p><p>**&uarr;**ä¸€æœ›æ— é™…çš„å¤§è‰åŸå‘€~ æ¥åˆ°è¿™å„¿ï¼Œæ•´ä¸ªäººéƒ½è¢«å‡€åŒ–äº†ã€‚å¿ƒé‡Œä»»ä½•æ‚å¿µéƒ½æ²¡æœ‰ï¼Œå°±æƒ³äº«å—è¿™ç‰‡ç»¿ï¼Œä¸è¿™ç‰‡è“ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1871.JPG"></p><p>**&uarr;**åœ¨çˆ¬ä¸€ç‰‡å±±ä¸˜çš„æ—¶å€™ï¼ŒåŠè·¯é‡è§çš„ä¸çŸ¥åé‡èŠ±ã€‚è¢«èŠ±é¦™å¸å¼•æ¥çš„å°è™«å­ä»¬æ­£åœ¨ä¸Šé¢å¿™ç¢Œç€ã€‚</p><img alt="" src="http://images.cy198706.com/Travel/IMG_1877.JPG" style="width: 1024px; height: 768px;" /><p>**&uarr;**æŠŠåˆšå­¦æ¥çš„æ‹æ‘„æ‰‹æ³•ç”¨ä¸Šï¼Œæ‹ä¸€ä¸ªï¼Œè‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1900.JPG"></p><p>**&uarr;**æˆ‘è·Ÿåª³å¦‡ã€‚å¥¹ç©¿ç€çš®è‚¤è¡£ï¼Œè¿˜æ²¡å•¥é—®é¢˜ï¼Œæˆ‘ç›´æ¥ä¸€æ¡çŸ­è¢–ï¼Œä¸€å¤©ä¸‹æ¥ï¼ŒæŠŠè„–å­ç»™æ™’ä¼¤äº†=ã€‚=</p><p>åœ¨è‰åŸä¸ŠæŠŠåˆé¥­åƒå®Œï¼Œå°±ç»§ç»­æ¼«æ— ç›®çš„åœ°æ¸¸è¡ã€‚</p><p>å¼€ç€å¼€ç€ï¼Œå‘ç°è·¯è¾¹çš„&ldquo;å¯æ±—è¡Œå®«&rdquo;ã€‚å‡ºäºå¥½å¥‡çš„å¿ƒç†ï¼Œæˆ‘ä»¬åœ¨å¯æ±—è¡Œå®«é›äº†ä¸€åœˆã€‚</p><p>å¯æ±—è¡Œå®«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯è¡Œå®«çš„å‚è§‚ï¼Œä¸€éƒ¨åˆ†æ˜¯ä»¥è‰åŸä¸ºåŸºç¡€çš„æ¸¸ä¹å›­ã€‚å› ä¸ºæœ‰å°å­©å­ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šåœ¨è¿™ä¸ªçœ‹ä¸åˆ°è¾¹çš„æ¸¸ä¹å›­é‡Œåº¦è¿‡ä¸‹åˆã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1910.JPG"></p><p>**&uarr;**ä»‹ä¸ªä¸æ˜¯å¯æ±—ï¼Œæ˜¯ä¸€åæ™®é€šçš„å£«å…µã€‚å¾ˆå¨æ­¦ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1933.JPG"></p><p>**&uarr;**è‰åŸæ‘©æ‰˜ã€‚æ—¢ç„¶æ¥äº†ï¼Œå°±çˆ½ä¸€æŠŠã€‚çœ‹æˆ‘åª³å¦‡ï¼Œå¤šéœ¸æ°”ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1938.JPG"></p><p>**&uarr;**æˆ‘ç›¸å¯¹æ¥è¯´å°±æ¯”è¾ƒå¼±äº†ã€‚ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_1970.JPG"></p><p>**&uarr;**éª‘é©¬çš„æ—¶å€™çº ç»“äº†åŠå¤©ï¼Œåª³å¦‡è·Ÿå¥¹åŒäº‹éƒ½ä¸æ•¢éª‘ï¼Œæˆ‘åˆç‰¹åˆ«æƒ³éª‘ï¼Œä½†åˆä¸èƒ½ä¸¤ä¸ªäººä¸€èµ·ï¼Œæˆ‘ä¹Ÿä¸æ•¢å•ç‹¬æ‚ä¸€å°å­©ï¼Œæ‰€ä»¥æœ€åå°±åªæœ‰æˆ‘ä¸Šé©¬äº†ã€‚</p><p>è¿™é©¬ä¸å¬è¯ï¼Œç‰µé©¬äººè¯´ä½ å°±æ‰¯ç¼°ç»³ï¼Œå¾€å·¦æ‰¯å®ƒå°±å¾€å·¦èµ°ï¼Œå¾€å³æ‰¯å®ƒå°±å¾€å³èµ°ï¼Œå¯æ˜¯çœŸä¸Šé©¬äº†å°±æ˜¯å¦ä¸€å›äº‹äº†ã€‚ä½ å¾€å·¦æ‰¯ä¸€ä¸‹ï¼Œä¸«å°±ç›´æ¥å›å¤´äº†ã€‚ä½ å†å¾€å³æ‰¯ï¼Œä¸«å°±ç›´æ¥å¼€å§‹æ‰½ç¼°ç»³ï¼Œæå¾—æˆ‘ä¹Ÿèƒ†å°äº†ï¼Œåªèƒ½ç”±ç€å®ƒçš„æ€§å­èµ°ã€‚</p><p>æœ€åä¸äº†äº†ä¹‹ã€‚è¿™ç©æ„çœŸæƒ³éª‘å¥½ï¼Œè¿˜æ˜¯å¾—ç»ƒã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_2004.JPG"></p><p>**&uarr;**å°æºªã€‚å…¶å®æ°´å¾ˆè„ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_2012.JPG"></p><p>**&uarr;**å®é™çš„æ¹–æ°´ã€‚å®‰é™å¾—è®©äººå¤§æ°”ä¸æ•¢å‡ºã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_2045.JPG"></p><p>**&uarr;**ç‰µç€åª³å¦‡çš„æ‰‹ï¼Œåœ¨è‰åŸçš„æœ¨æ¡¥ä¸Šèµ°ã€‚</p><p>æ™šä¸Šå›å»éšä¾¿åƒäº†ç‚¹ä¸œè¥¿ï¼Œå†œå®¶é™¢é‡Œæœ‰çƒ¤ç¾Šè‚‰ï¼Œçƒ§çƒ¤ï¼ŒKTVå•¥çš„ï¼Œç´¯äº†ä¸€å¤©ï¼Œå®åœ¨æ˜¯æ²¡å¿ƒæƒ…äº†ã€‚</p><p>ç¬¬äºŒå¤©å†³å®šæ—©èµ·çœ‹æ—¥å‡ºã€‚å¯æ˜¯æˆ‘ä»¬ä¸¤ä¸ªæ²¡æ–¹å‘æ„Ÿçš„ç™½ç—´ï¼ŒåŠ ä¸Šä¸€å †æ²¡æ–¹å‘æ„Ÿçš„ç™½ç—´ï¼ˆä¸è®¤è¯†çš„æ¸¸å®¢ï¼‰ï¼Œå››ç‚¹å¤šçˆ¬èµ·æ¥ï¼Œå¯¹ç€åŒ—æ–¹çœ‹äº†åŠå°æ—¶ï¼Œéƒ½æ²¡æœ‰å¤ªé˜³ã€‚åæ¥æå‡ºåœ°å›¾æ¥ä¸€çœ‹ï¼Œæ¬¡å¥¥ï¼Œå¤ªé˜³è¦æ˜¯èƒ½ä»è¿™è¾¹å‡ºæ¥ï¼Œæˆ‘å°±é¢å£å»ã€‚</p><p><img src="http://images.cy198706.com/Travel/IMG_2058.JPG"></p><p>**&uarr;**é©¬é©¬è™è™æ‹äº†ä¸€å¼ ï¼Œæ¸…æ™¨çš„åŒ—æ–¹ã€‚</p><p>&nbsp;</p><p>å› ä¸ºæ€•ä¼‘æ¯ä¸å¤Ÿï¼Œå†åŠ ä¸Šè¿™ç§ç¯å¢ƒå®åœ¨æ˜¯è®©äººé—¹å¿ƒï¼Œæ‰€ä»¥ç¬¬äºŒå¤©ä¸‹åˆå°±å†³å®šè¿”ç¨‹äº†ã€‚</p><p>å›åˆ°åŒ—äº¬ï¼Œä¸‹äº†ä¸€åœºæš´é›¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—…è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†äº«å£çº¸</title>
      <link href="//pictures/%25e5%2588%2586%25e4%25ba%25ab%25e5%25a3%2581%25e7%25ba%25b8-2/"/>
      <url>//pictures/%25e5%2588%2586%25e4%25ba%25ab%25e5%25a3%2581%25e7%25ba%25b8-2/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…ä¸æ›´ï¼Œè‰¯å¿ƒä¸Šè¿‡ä¸å»äº†ã€‚</p><p>ä½†çš„ç¡®æŠ½ä¸å‡ºæ—¶é—´æ¥æ›´ï¼Œåªèƒ½å…ˆè·Ÿå¤§å®¶åˆ†äº«ç‚¹å¥½ä¸œè¥¿ï¼Œæœ€è¿‘ä¹Ÿåœ¨é…é…¿ä¸€ç¯‡æ–‡ï¼Œç­‰ç å®Œäº†å†æ”¾ä¸Šæ¥å§ã€‚</p><p>ä¸Šå‡ å¼ å£çº¸æ¥åˆ†äº«ä¸€ä¸‹ï¼Œæœ‰å–œæ¬¢çš„ï¼Œä¸ç”¨æ‰“æ‹›å‘¼ï¼Œç›´æ¥å¸¦èµ°ã€‚å¦‚æœä½ æƒ³æ‰“åŒ…ä¸‹è½½ï¼Œè¯·æ‹–åˆ°æœ€ä¸‹æ–¹ã€‚</p><p><span style="color:#0000ff;">tip: å¦‚æœä½ æ˜¯windows 7 / windows 8çš„è¯ï¼ŒæŠŠè¿™äº›å›¾ç‰‡æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹å†…ï¼Œç„¶åå…¨é€‰ï¼Œå³é”®ï¼Œè®¾ä¸ºå£çº¸ï¼Œå°±èƒ½è‡ªåŠ¨å˜æ¢å£çº¸å•¦ã€‚</span></p><p>å½“ç„¶ï¼Œå¦‚æœä½ æ„¿æ„æ¡Œé¢å³é”®ï¼Œä¸ªæ€§åŒ–ï¼Œæ¡Œé¢èƒŒæ™¯ï¼Œç„¶åå†ä¸€èµ·é€‰æ‹©çš„è¯ï¼Œæˆ‘ä¹Ÿæ²¡æ„è§å“¦ã€‚</p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-183872.jpg" target="_blank"><img alt="wallpaper-183872" src="http://images.cy198706.com/Mess-Ups/wallpaper-183872.jpg" style="width: 480px; height: 270px;" /></a></p><span id="more"></span><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-423394.jpg" target="_blank"><img alt="wallpaper-423394" src="http://images.cy198706.com/Mess-Ups/wallpaper-423394.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-730201.jpg" target="_blank"><img alt="wallpaper-730201" src="http://images.cy198706.com/Mess-Ups/wallpaper-730201.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-747480.jpg" target="_blank"><img alt="wallpaper-747480" src="http://images.cy198706.com/Mess-Ups/wallpaper-747480.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1066065.jpg" target="_blank"><img alt="wallpaper-1066065" src="http://images.cy198706.com/Mess-Ups/wallpaper-1066065.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1099271.jpg" target="_blank"><img alt="wallpaper-1099271" src="http://images.cy198706.com/Mess-Ups/wallpaper-1099271.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1104267.jpg" target="_blank"><img alt="wallpaper-1104267" src="http://images.cy198706.com/Mess-Ups/wallpaper-1104267.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1110754.jpg" target="_blank"><img alt="wallpaper-1110754" src="http://images.cy198706.com/Mess-Ups/wallpaper-1110754.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1111647.jpg" target="_blank"><img alt="wallpaper-1111647" src="http://images.cy198706.com/Mess-Ups/wallpaper-1111647.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1712661.jpg" target="_blank"><img alt="wallpaper-1712661" src="http://images.cy198706.com/Mess-Ups/wallpaper-1712661.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-1878706.jpg" target="_blank"><img alt="wallpaper-1878706" src="http://images.cy198706.com/Mess-Ups/wallpaper-1878706.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-2601560.jpg" target="_blank"><img alt="wallpaper-2601560" src="http://images.cy198706.com/Mess-Ups/wallpaper-2601560.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-2610355.jpg" target="_blank"><img alt="wallpaper-2610355" src="http://images.cy198706.com/Mess-Ups/wallpaper-2610355.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-2810681.jpg" target="_blank"><img alt="wallpaper-2810681" src="http://images.cy198706.com/Mess-Ups/wallpaper-2810681.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  <a href="http://images.cy198706.com/Mess-Ups/wallpaper-2811385.jpg" target="_blank"><img alt="wallpaper-2811385" src="http://images.cy198706.com/Mess-Ups/wallpaper-2811385.jpg" style="width: 480px; height: 270px;" /></a></p><p style="text-align: center;">  æ‰“åŒ…ä¸‹è½½ï¼š<a href="http://pan.baidu.com/share/link?shareid=2180002455&uk=151049050"><img src="http://pan.baidu.com/res/static/images/yun_pan_logo.gif?@=-1" /></a></p>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸éƒ½ï¼Œä½ çœŸçš„è¦èµ¶æˆ‘ä»¬èµ°å—ï¼Ÿ</title>
      <link href="//gabby/%25e5%25b8%259d%25e9%2583%25bd%25ef%25bc%258c%25e4%25bd%25a0%25e7%259c%259f%25e7%259a%2584%25e8%25a6%2581%25e8%25b5%25b6%25e6%2588%2591%25e4%25bb%25ac%25e8%25b5%25b0%25e5%2590%2597%25ef%25bc%259f/"/>
      <url>//gabby/%25e5%25b8%259d%25e9%2583%25bd%25ef%25bc%258c%25e4%25bd%25a0%25e7%259c%259f%25e7%259a%2584%25e8%25a6%2581%25e8%25b5%25b6%25e6%2588%2591%25e4%25bb%25ac%25e8%25b5%25b0%25e5%2590%2597%25ef%25bc%259f/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« åœ¨å‘å¸ƒä¹‹å‰ï¼Œå·²ç»ç äº†è¿‘åƒå­—ï¼Œä½†æ˜¯7æœˆ18å·åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€åˆ™æ¶ˆæ¯ï¼Œå°±åˆ äº†å¥½å¤šï¼Œä»Šå„¿åˆé‡æ–°ç äº†ä¸€äº›ã€‚</p><p>å¸Œæœ›æ¯ä¸ªçœ‹è¿™ç¯‡æ–‡ç« çš„æœ‹å‹éƒ½è¯»ä¸€ä¸‹æˆ‘å†™çš„ä¸œè¥¿ï¼Œç„¶åç•™ä¸‹ç‚¹è§è§£ã€‚å› ä¸ºæˆ‘è¿·èŒ«äº†ã€‚</p><span id="more"></span><p>åŠä¸ªæœˆä¹‹å‰å§ï¼Œæœ‹å‹æ‰“æ¥ç”µè¯ï¼Œè¯´ä»–ä»¬åœ¨Xæ¾ç§Ÿçš„æˆ¿å­è¢«æ´¾å‡ºæ‰€çš„è­¦å¯Ÿç»™æŸ¥äº†ï¼Œç„¶åå°±è´´æ¡è¯´ä¸å…è®¸å†äº¤æˆ¿ç§Ÿã€‚è¿™å°±æŠŠä»–ç»™æ„åäº†ï¼Œç°åœ¨æ‰¾ä¸ªä¾¿å®œçš„èƒ½ä½çš„åœ°æ–¹å¤šä¸å®¹æ˜“å•Šã€‚</p><p>æ²¡æƒ³åˆ°18å·å±…ç„¶å°±ç»™æ›å…‰äº†ã€‚80å¹³ç±³çš„æˆ¿å­ï¼Œä½äº†25ä¸ªäººã€‚æˆ‘ä¸€ç›´ä¸çŸ¥é“æˆ‘æœ‹å‹ä½çš„åœ°æ–¹æœ‰è¿™ä¹ˆå¤šäººã€‚åªçŸ¥é“æ˜¯ä¸Šä¸‹é“ºï¼Œä¸€ä¸ªæœˆ700å—ã€‚</p><p>ä»–æ¯ä¸ªæœˆçš„å·¥èµ„åªæœ‰2000å—å¤šä¸€ç‚¹ï¼Œäº¤æ‰æˆ¿ç§Ÿï¼Œè¿˜è¦äº¤ç”µè´¹å’Œæ°´è´¹å’Œç½‘è´¹å…±150ï¼Œä¹Ÿå°±æ˜¯æ¯æœˆè‡³å°‘850å—çš„å›ºå®šæ”¯å‡ºï¼Œå†åŠ ä¸Šåƒé¥­å’Œä¸€äº›é¢å¤–å¼€æ”¯ï¼Œæ¯ä¸ªæœˆå‰©ä¸äº†å¤šå°‘é’±ã€‚</p><p>æˆ‘ä¹Ÿä½è¿‡è¿™ç§åœ°æ–¹ï¼Œä½†å¥½æ­¹å¤§ä¸€ç‚¹ï¼š140å¹³ç±³ï¼Œ24ä¸ªäººï¼Œå¹³å‡æ¯ä¸ªäººå±…ç„¶èƒ½åˆ†åˆ°å°†è¿‘6å¹³ç±³ã€‚æ¯å¤©æ—©ä¸Šæ’é˜Ÿæ´—æ¼±ã€ä¸Šå•æ‰€ï¼Œå°±æ˜¯ä¸€é¡¹å·¥ç¨‹ã€‚è€Œä¸”24ä¸ªäººçœŸçš„æ˜¯è·Ÿèœå¸‚åœºä¸€æ ·ï¼Œéš¾ä»¥å…¥ç¡ä¸è¯´ï¼Œåˆ°å¤å¤©çš„æ—¶å€™ï¼Œå±‹å­é‡Œçš„å‘³é“å°±è·Ÿå•æ‰€æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>ç°åœ¨å¸éƒ½é¢å¸ƒä¸€é¡¹è§„å®šï¼š<a href="http://hb.people.com.cn/utf-8/n/2013/0719/c192237-19107665.html">ä¼ é€é—¨</a></p><blockquote><p>å‡ºç§Ÿæˆ¿å±‹äººå‡å±…ä½é¢ç§¯ä¸å¾—ä½äº5å¹³æ–¹ç±³ï¼Œæ¯ä¸ªæˆ¿é—´å±…ä½ä¸èƒ½è¶…è¿‡2äººã€‚ä¸å¾—å°†ä¸€é—´æˆ¿é—´åˆ†å‰²å‡ºç§Ÿï¼Œä¸å¾—æŒ‰åºŠä½ç­‰æ–¹å¼å˜ç›¸åˆ†å‰²å‡ºç§Ÿã€‚å¨æˆ¿ã€å«ç”Ÿé—´ã€é˜³å°å’Œåœ°ä¸‹å‚¨è—å®¤ä¸èƒ½è®©ç§Ÿæˆ¿è€…å±…ä½ã€‚</p></blockquote><p>å…ˆä¸è´¨ç–‘é¢ç§¯å’ŒåºŠä½çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯ä¸€å®¶ä¸‰å£çš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¾—æ‹†å¼€æ¥ä½äº†ï¼Ÿè¿™æ˜¯ä»€ä¹ˆç‹—å±è§„å®šï¼Ÿ</p><p>ç°åœ¨åœ¨å¸éƒ½ï¼Œä¸€ä¸ªæ™®é€šå•é—´è‡³å°‘è¦800 &ndash; 1000ï¼Œè€Œä¸”å„ç§è´¹ç”¨ä¹Ÿå¹¶ä¸ä½ï¼Œè¿˜æœ‰æ‰€è°“çš„â€ä¸­ä»‹è´¹â€ï¼Œâ€ç®¡ç†è´¹â€ï¼Œâ€ä¿æ´è´¹â€ï¼Œè¿™åºŸé‚£åºŸçš„ï¼Œå¦‚æœæœˆå·¥èµ„åªæœ‰2000ï¼Œé‚£ä¹ˆæ¯ä¸ªæœˆåªèƒ½é å–è¥¿åŒ—é£è¿‡æ—¥å­äº†ï¼Œæ˜¯çœŸçš„å–è¥¿åŒ—é£ï¼Œä¸æ˜¯å¼€ç©ç¬‘ã€‚</p><p>å¦‚æœä½ èƒ½ç§Ÿåˆ°500å—ä»¥ä¸‹çš„å•é—´ï¼Œé‚£æˆ‘åªèƒ½è¯´ï¼Œä½ é‚£ä¸ªè‚¯å®šæ˜¯åœ°ä¸‹å®¤ã€‚</p><p>ç¾¤ç§Ÿåœ¨å¸éƒ½æ˜¯å¸¸è§å¾—ä¸èƒ½å†å¸¸è§çš„ç°è±¡ï¼Œæ˜¯ä¸€ç§æ— å¥ˆï¼Œæ˜¯ä¸€ç§è¢«åŠ¨ï¼Œè¿™ç§è§„å®šä¸ä»…æ²¡æœ‰äººæ€§ï¼Œè€Œä¸”æ˜¯å…¸å‹çš„â€ç«™ç€è¯´è¯ä¸è…°ç–¼â€ã€‚æˆ¿ä»·æ¶¨å°±æ¶¨å§ï¼Œæ¯•ç«Ÿæ€ä¹ˆæ¶¨å’±ä¹°ä¸èµ·ï¼›æˆ¿ç§Ÿæ¶¨å°±æ¶¨å§ï¼Œæ¯•ç«Ÿä¹Ÿæ²¡æ¶¨å¤ªå¤šï¼›è¿ç§Ÿéƒ½ä¸è®©ç§Ÿäº†ï¼Œè¿™æ˜¯è¦èµ¶æˆ‘ä»¬èµ°å•Šã€‚</p><p style="text-align: center">  <img alt="" src="http://cy198706.com/blog/wp-content/uploads/2013/07/6812de56jw1e6qsild99rj20c808mgmz.jpg" /></p><p style="text-align: center">  <span style="font-size:10pt"><em>æ³¨ï¼šå›¾ç‰‡æ¥æºäºäº’è”ç½‘ã€‚äº’è”ç½‘ï¼Œè‡ªç”±ã€å¼€æ”¾çš„ï¼Œä½ çš„ï¼Œæˆ‘çš„ï¼Œå¤§å®¶çš„ã€‚ </em></span></p><p>&nbsp;</p><p>ç ä¸Šé¢è¿™æ®µæ–‡å­—ä¹‹å‰ï¼Œæˆ‘å¿ƒé‡Œå¾ˆçº ç»“ï¼Œå› ä¸ºæˆ‘æœ‰é‚£ä¹ˆå‡ ä¸ªç¬é—´ï¼Œè§‰å¾—å¸éƒ½æŠŠå¤–åœ°äººèµ¶èµ°æ˜¯æœ‰é“ç†çš„ã€‚</p><p>è™½ç„¶æˆ‘ä¹Ÿæ˜¯å¤–åœ°äººï¼Œä¹ŸçŸ¥é“è¿™ç§æƒ³æ³•ç‰¹åˆ«é­æ¨ï¼Œä½†äº²èº«ä½“éªŒè¿‡ä¸€äº›äº‹æƒ…ï¼Œä½ ä¹Ÿä¼šæœ‰è¿™ç§æƒ³æ³•ã€‚</p><p>**æˆ‘ä¸‹é¢è¯´çš„äº‹æƒ…ï¼Œä¸é’ˆå¯¹ä»»ä½•ä¸€ä¸ªäººï¼Œä¸é’ˆå¯¹ä»»ä½•ä¸€ä¸ªåœ°åŒºï¼Œä¸é’ˆå¯¹ä»»ä½•ä¸€ä¸ªå›½å®¶ã€‚å°±äº‹è®ºäº‹ã€‚ **</p><p>æœ‰ä¸ª11è·¯å…¬äº¤è½¦ï¼Œä»å›½è´¸åœ°é“ç«™å§‹å‘ï¼Œæ˜¯æ¡æ¯”è¾ƒç«çˆ†çš„çº¿è·¯ã€‚æˆ‘æœ‰æ—¶å€™ä¸‹ç­ä¼šå»æ‰¾åª³å¦‡ï¼Œç„¶åè·Ÿå¥¹ä¸€èµ·ä»å§‹å‘ç«™åè½¦å›å®¶ã€‚åœ¨å§‹å‘ç«™ï¼Œæ’é˜Ÿç”¨çš„å›´æ å°±æ˜¯ä¸ªæ‘†è®¾ï¼Œå³ä¾¿æ—è¾¹æœ‰å¿—æ„¿è€…ç®¡ç†ï¼Œä¹Ÿå‡ ä¹æ²¡äººæ’é˜Ÿã€‚å› ä¸ºæœ‰ä¸€ä¸ªäººä¸æ’ï¼Œå°±ä¼šæœ‰ç¬¬äºŒä¸ªäººåŠ å…¥ï¼Œæœ‰ç¬¬ä¸‰ä¸ªäººåŠ å…¥åï¼Œå¤§å®¶å°±éƒ½ä¸æ’äº†ã€‚æ¯æ¬¡å»åè½¦ï¼Œæˆ‘éƒ½ä¼šç«™åœ¨æ—è¾¹ï¼Œçœ‹ä»–ä»¬æŒ¤ç ´å¤´ï¼Œæ¨æ¥æ¨å»ï¼Œå„ç§è¾±éª‚ï¼Œå„ç§å¤§æ‰“å‡ºæ‰‹ï¼Œå°±ä¸ºäº†ä¸€ä¸ªåº§ã€‚è€Œä¸”ä»–ä»¬éƒ½ä¸æ€•æ­»ï¼Œç›´æ¥ç«™åœ¨è½¦é“ä¸Šæ‹¦è½¦ã€‚</p><p>åœ¨åœ°é“é‡Œï¼Œæ‹¥æŒ¤æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œå› ä¸ºæ‹¥æŒ¤å‘ç”Ÿå£è§’ç”šè‡³æ‰“æ¶æ›´æ˜¯å¸¸æœ‰çš„äº‹ã€‚è½¦æ¥äº†ï¼Œå°±é—·å¤´å¾€é‡ŒæŒ¤ï¼Œä¹Ÿä¸ç®¡è½¦é‡Œæœ‰å¤šå°‘äººè¦ä¸‹è½¦ã€‚å¤§å®¶éƒ½åœ¨æ’é˜Ÿï¼Œä»–ç›´æ¥å°±ç«™åœ¨é—¨å£ä½ç½®ã€‚</p><p>ä¸€äººï¼Œæ‹‰ç€è‡ªå·±çš„å® ç‰©ç‹—åœ¨å¤–è¾¹é›ï¼Œç‹—å“ªèƒ½è·Ÿäººä¼¼çš„é‚£ä¹ˆéµå®ˆè§„çŸ©å•Šï¼Œä¸€æ³¡ä¾¿ä¾¿æ‹‰åœ¨é©¬è·¯ä¸­å¤®ï¼Œæ°å¥½è¢«è·¯äººçœ‹è§äº†ã€‚è·¯äººæ„¤æ„¤ä¸å¹³åœ°è®©ç‹—ä¸»æŠŠä¾¿ä¾¿æ‰“æ‰«æ‰ï¼Œç‹—ä¸»åé©³åæ­£æœ‰å°åŒºä¿æ´åœ¨ï¼Œæˆ‘å“ªæœ‰ç©ºå¼„è¿™ä¸œè¥¿ã€‚äºæ˜¯ä¸¤ä¸ªäººå°±å¼€å§‹åµã€‚æ›´å¤šè·¯äººå›´è§‚ï¼Œæ•£å»ï¼Œç•™ä¸‹ä¸€æ³¡ä¾¿ä¾¿ï¼Œæœ€åè¿˜æ˜¯å¾—ä¿æ´äººå‘˜æ¥æ¸…ç†ã€‚</p><p>å½“ç„¶ï¼Œå¤§å¤šæ•°å¾ˆæœ‰ç´ è´¨ï¼Œå‡ºé—¨é›ç‹—ä¼šå¸¦ä¸€ä¸ªè¢‹å­ï¼Œç»™ç‹—æ‰“æ‰«å«ç”Ÿï¼Œç„¶åæ‰”è¿›åƒåœ¾ç®±ã€‚</p><p>åˆ°å°åŒºçš„èŠ±å›é‡Œä»”ç»†çœ‹çœ‹ï¼Œä½ ä¼šå‘ç°ï¼Œå«ç”Ÿçº¸ã€çŸ¿æ³‰æ°´ç“¶å­ã€åƒå‰©çš„é¥­ã€è‹¹æœæ ¸ã€ç©¿æ—§çš„çš®é‹ã€é“ä¸ã€ç§Ÿæˆ¿å°å¹¿å‘Šç­‰å„å¼å„æ ·çš„åƒåœ¾ï¼›è·¯å‘å‘æ´¼æ´¼ï¼Œåªè¦ä¸‹é›¨ï¼Œå°±ä¸æ•¢èµ°ï¼Œæ€•ä¸€è„šè¸©å‘é‡Œï¼›ç°å¤´åœŸè„¸å„å¼å„æ ·çš„äººï¼›å¤œæ™šåœ¨å¢™è§’éšä¾¿æ’’å°¿çš„ç”·äººï¼›åœ°é“é‡Œä¹è®¨çš„å„ç§æ‰‹æ®µã€‚ã€‚è®©äººæœ‰ç‚¹æ™•ï¼šç¡®å®šè¿™æ˜¯å¸éƒ½ï¼Ÿç¡®å®šè¿™ç‰¹ä¹ˆä¸æ˜¯ä¸ªä¸‰ä¸ç®¡åœ°å¸¦ä¹ˆï¼Ÿ</p><p>æˆ‘æ¥è§¦è¿‡ä¸€äº›å¸éƒ½äººï¼Œéƒ½å¾ˆæœ‰ç´ è´¨ï¼Œå¾ˆéµå®ˆä¸€äº›å¸¸è¯†æ€§çš„è§„å®šã€‚ç”šè‡³æœ‰äº›è§„å®šå¹¶ä¸æ˜¯è§„å®šï¼Œä»–ä»¬ä¹Ÿä¼šå»æ–¹ä¾¿åˆ«äººã€‚æ‰€å¤„çš„ç¯å¢ƒä¸ä¸€æ ·ï¼Œäººçš„æˆé•¿å†ç¨‹ä¸ä¸€æ ·ï¼Œå°±ä¼šå¯¼è‡´ç´ è´¨çš„å‚å·®ä¸é½ã€‚</p><p>ç°åœ¨ï¼Œæ¯å¤©è¿‡å¾—éƒ½å¾—å°å¿ƒç¿¼ç¿¼ï¼Œå¤ªä¹±äº†ï¼Œæ¯å¤©éƒ½åœ¨å‘ç”Ÿæ­»äººçš„äº‹ä»¶ã€‚ç”Ÿæ€•ç¢°è§ä¸ªç–¯å­ï¼Œåœ¨å¤§æ‚¦åŸè¿™ç§åœ°æ–¹æŠŠä½ ä¸€åˆ€æ…æ­»ã€‚æ— è®ºä»€ä¹ˆåœ°æ–¹ï¼Œä¸€æ—¦å¤©æœäººå¤šäº†ï¼Œè¿™åœ°æ–¹å°±å®Œäº†ã€‚è”æƒ³èµ·ä¹‹å‰å»åä¸Šè‰åŸçš„ç»å†ï¼Œè¿™ç§å¿µå¤´å°±æ›´åŠ è‚¯å®šäº†ã€‚</p><p>&nbsp;</p><p>å…¶å®å†™åˆ°è¿™å„¿ï¼Œå·²ç»ä¸æ˜¯åœ¨è¯´â€åº”ä¸åº”è¯¥èµ¶èµ°å¤–åœ°äººâ€äº†ï¼Œè€Œæ˜¯åœ¨è¯´â€ä½ çœ‹çœ‹è¿™äº›æ²¡ç´ è´¨çš„â€ã€‚äººå„æœ‰å¿—ä¸èƒ½å¼ºæ±‚ï¼Œå¤©æœè¿™ä¹ˆå¤§ï¼Œåªè¦æˆ‘æ˜¯åˆæ³•å…¬æ°‘ï¼Œæˆ‘æ„¿æ„å¾…åœ¨å“ªå°±å¾…åœ¨å“ªï¼Œå‡­ä»€ä¹ˆèµ¶æˆ‘èµ°ã€‚</p><p>çœ¼ä¸‹åˆè¦æ¢æˆ¿å­äº†ï¼Œå› ä¸ºæˆ‘ç°åœ¨ç§Ÿçš„æˆ¿å­è‚¯å®šè¿˜è¦æ¶¨ã€‚æ¬åˆ°å“ªå»ï¼Œæ˜¯ä¸æ˜¯æ¬åˆ°ç±»ä¼¼çš„åœ°æ–¹ï¼ŒçœŸçš„ä¸å¾—è€ŒçŸ¥ã€‚</p><p>æœ‰ä¸ªäººè¯„è®ºå…³äºå¸éƒ½ç¦æ­¢ç¾¤ç§Ÿè¿™ç§ç°è±¡ï¼Œè¯´â€åƒå¾—è‹¦ä¸­è‹¦æ–¹ä¸ºäººä¸Šäººâ€ï¼Œä»–è¯´ä»–ä»¥å‰ä½çš„åœ°æ–¹æ˜¯åœ°ä¸‹å®¤ï¼Œæ¡ä»¶ç‰¹åˆ«ç‰¹åˆ«è‰°è‹¦ï¼Œè¿™æ ·æ‰èƒ½é”»ç‚¼è‡ªå·±çš„å“æ ¼ï¼Œç£¨ç‚¼è‡ªå·±çš„æ„å¿—ï¼Œblablablaã€‚æˆ‘ç°åœ¨æƒ³é—®ä½ ï¼Œå¦‚æœè¿è¿™ç§ç£¨ç‚¼æ„å¿—çš„æœºä¼šéƒ½ä¸ç»™ä½ äº†ï¼Œè¯·é—®ä½ æ€ä¹ˆåŠï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å”‰ï¼Œæœ€è¿‘å¥½ç´¯ã€‚</title>
      <link href="//gabby/%25e5%2594%2589%25ef%25bc%258c%25e6%259c%2580%25e8%25bf%2591%25e5%25a5%25bd%25e7%25b4%25af%25e3%2580%2582/"/>
      <url>//gabby/%25e5%2594%2589%25ef%25bc%258c%25e6%259c%2580%25e8%25bf%2591%25e5%25a5%25bd%25e7%25b4%25af%25e3%2580%2582/</url>
      
        <content type="html"><![CDATA[<p>å—¯ï¼Œæ²¡æœ‰å†…å®¹ã€‚</p><img alt="" src="http://www.xylophonefilms.com/sites/default/files/tired-dog-wallpaper-free-picture_w520.jpg" style="width: 520px; height: 325px;" />]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>çœ‹ITèŒå‘˜å¦‚ä½•äº”å¹´åœ¨åŒ—äº¬ä¹°500ä¸‡æˆ¿å­ &amp;#8211; åŠ±å¿—ï¼</title>
      <link href="//gabby/%25e7%259c%258bit%25e8%2581%258c%25e5%2591%2598%25e5%25a6%2582%25e4%25bd%2595%25e4%25ba%2594%25e5%25b9%25b4%25e5%259c%25a8%25e5%258c%2597%25e4%25ba%25ac%25e4%25b9%25b0500%25e4%25b8%2587%25e6%2588%25bf%25e5%25ad%2590-%25e5%258a%25b1%25e5%25bf%2597%25ef%25bc%2581/"/>
      <url>//gabby/%25e7%259c%258bit%25e8%2581%258c%25e5%2591%2598%25e5%25a6%2582%25e4%25bd%2595%25e4%25ba%2594%25e5%25b9%25b4%25e5%259c%25a8%25e5%258c%2597%25e4%25ba%25ac%25e4%25b9%25b0500%25e4%25b8%2587%25e6%2588%25bf%25e5%25ad%2590-%25e5%258a%25b1%25e5%25bf%2597%25ef%25bc%2581/</url>
      
        <content type="html"><![CDATA[<div>  äº”å¹´å‰ï¼Œåˆšæ¯•ä¸šçš„å°æŸ¯ï¼Œåªæœ‰ä¸çŸ¥åå¤§å­¦çš„å­¦å†ï¼Œæ±‚èŒæ—¶å¤„å¤„ç¢°å£ï¼Œæœ€ååœ¨åŒ—äº¬æŸé—´å°ITå…¬å¸ä¸Šç­æ‹…ä»»å°ç¨‹åºå‘˜ã€‚è¿‡äº†åŠå¹´ï¼Œå°æŸ¯è§‰å¾—è¿™æ ·ä¸‹å»ä¸æ˜¯åŠæ³•ï¼Œçªç„¶è§‰é†’ï¼Œå†³å®šè®¢å‡ºä¸€ä¸ªäº”å¹´ä¹°æˆ¿è®¡åˆ’ï¼Œæ­¥æ­¥è§„åˆ’å½»åº•æ‰§è¡Œï¼&nbsp;</div><div>  &nbsp;&nbsp;</div><div>  &ldquo;åˆšå¼€å§‹çœŸçš„å¾ˆç—›è‹¦ï¼Œä»€ä¹ˆäº¤é™…åº”é…¬ä¸å¨±ä¹æ¶ˆè´¹éƒ½ä¸èƒ½åšäº†&rdquo;å°æŸ¯å›å¿†é“ã€‚ä½†æ˜¯å›æƒ³èµ·è‡ªå·±è¿‡å»çš„äººç”Ÿï¼Œå…¶å®ä¹Ÿè¿™æ ·æµ‘æµ‘å™©å™©ï¼Œçªç„¶æœ‰ä¸€è‚¡å£°éŸ³åœ¨è‡ªå·±ä½“å†…è§‰é†’ï¼Œ&ldquo;æˆ‘å¼€å§‹åˆ©ç”¨ä¸‹ç­æ—¶é—´å»ä¸Šè´¢åŠ¡è§„åˆ’è¯¾ç¨‹ä¸ç¨‹åºè¯¾ç¨‹ï¼Œå¢åŠ è‡ªå·±çš„å®åŠ›ã€‚&rdquo;åˆ©ç”¨ç½‘ç»œä¸Šå¤§å¤§å°å°å…è´¹çš„èµ„æºï¼Œå°æŸ¯å‘ç°è‡ªå·±è¿‡å»å­¦ç”Ÿç”Ÿæ¶¯å®åœ¨æµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚&nbsp;</div><div>  &nbsp;</div><div>  &ldquo;åˆšå¼€å§‹ä¼šè§‰å¾—å¾ˆæ‡Šæ‚”è‡ªå·±è¿‡å»åˆ°åº•åœ¨å¹²å˜›ï¼Œæ‰€ä»¥ç°åœ¨æœ‰æœºä¼šåè€Œæ›´åŠªåŠ›ï¼ŒåŠ å¼ºå†²åˆºã€‚&rdquo;å°±è¿™æ ·ï¼Œå°æŸ¯åˆ©ç”¨é€šè¿‡å¤§å¤§å°å°çš„ITæŠ€èƒ½æ£€å®šè€ƒè¯•ï¼Œè®©å…¬å¸é€å¹´å¸®ä»–åŠ è–ª3%ã€‚&nbsp;</div><div>  &ldquo;é™¤äº†è–ªæ°´æˆé•¿è¿˜ä¸å¤Ÿï¼Œæˆ‘è¿˜å»æŠ¥åäº†è®¸å¤šç®¡ç†è¯¾ç¨‹ï¼Œè®¤è¯†è®¸å¤šä¸šç•Œæ°å‡ºäººå£«ã€‚&rdquo;é€è¿‡è¿™æ ·çš„äº¤æµï¼Œå°æŸ¯é€æ­¥å»ºç«‹èµ·è‡ªå·±çš„äººè„‰ã€‚&nbsp;</div><div>  &ldquo;å…‰é æ­»è–ªæ°´è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘è¿˜å……åˆ†åˆ©ç”¨ä¸šä½™æ—¶é—´ï¼Œæ‰“ä¸€äº›é›¶å·¥ï¼Œè®©è‡ªå·±æ˜ç™½é’±æ¥ä¹‹ä¸æ˜“ã€‚&rdquo;é€šè¿‡æ‰“é›¶å·¥ï¼Œå°æŸ¯ä¹Ÿé€æ¸æœ‰äº†ä¸€äº›å…¶ä»–è¡Œä¸šçš„å®è´µç»éªŒã€‚ &nbsp;</div><span id="more"></span><div>  &nbsp;</div><div>  æœ€åï¼Œé ç€è¿™äº”å¹´æ¥ç´¯ç§¯çš„äº”ä¸‡ï¼Œå†åŠ ä¸Šçˆ¶æ¯ç»™çš„495ä¸‡ï¼Œå°æŸ¯ä¹°ä¸‹äººç”Ÿç¬¬ä¸€æ ‹æˆ¿å­ï¼Œè€Œä¸”æ˜¯åœ¨åŒ—äº¬å¸‚ä¸‰ç¯åŒºåŸŸã€‚&nbsp;</div><div>  &ldquo;æœ‰æ¢¦æœ€ç¾ï¼Œç­‘æ¢¦è¸å®ã€‚&rdquo;å°æŸ¯çœ¼ç¥åšæ¯…åœ°è¯´ç€ã€‚</div><div>  &nbsp;</div>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> äººç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»Šå¤©æ˜¯1024èŠ‚ã€‚</title>
      <link href="//gabby/%25e4%25bb%258a%25e5%25a4%25a9%25e6%2598%25af1024%25e8%258a%2582%25e3%2580%2582/"/>
      <url>//gabby/%25e4%25bb%258a%25e5%25a4%25a9%25e6%2598%25af1024%25e8%258a%2582%25e3%2580%2582/</url>
      
        <content type="html"><![CDATA[<p>æœ‰å¥½å¤šäººè¯´ä»Šå¤©æ˜¯ä¸ªèŠ‚æ—¥ï¼Œæˆ‘ç¬¬ä¸€åæ˜ æ˜¯1024ï¼Œç¨‹åºå‘˜çš„èŠ‚æ—¥å˜›ã€‚</p><p>åæ¥æ‰æç„¶å¤§æ‚Ÿï¼Œ1024å•Šã€‚ã€‚</p><p>æ€ä¹ˆä¹Ÿå¾—çºªå¿µä¸‹ã€‚</p><p>å¾—å¿™åˆ°å¹´åº•äº†ï¼Œç°åœ¨æ™šä¸Šå›å»æ’¸ä»£ç ï¼Œå‘¨å…­åŠ ç­ï¼Œå‘¨æ—¥åœ¨å®¶çŒ›ç¡ï¼Œè™½ç„¶æ„Ÿè§‰å¾ˆå……å®ï¼Œä½†æ˜¯ç´¯å¾—è¦å‘½ã€‚</p><p>wpä¸Šçš„appæš‚åœç»´æŠ¤ï¼Œåšå®¢é•¿è‰ï¼Œæœ‹å‹ä»¬é‚£å„¿ä¹Ÿéƒ½å¥½ä¹…æ²¡é€›é€›äº†ã€‚åŸºæœ¬ç®—æ˜¯è„±èŠ‚äº†ã€‚ã€‚</p><p>&nbsp;</p><p>ç­‰å¿™å®Œå§ï¼Œå¿™å®Œäº†å°±æœ‰æ—¶é—´æŠ˜è…¾äº†ã€‚</p><p>&nbsp;</p><p>ä¸»é¢˜æ¢å›æ¥ï¼Œè¿™ä¸ªç»¿è‰²çš„ä¸»é¢˜çœ‹ç€çœŸå¿ƒéš¾å—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¯æ—¥ä¸€å›¾ &amp;#8211; 20140820</title>
      <link href="//pictures/%25e6%25af%258f%25e6%2597%25a5%25e4%25b8%2580%25e5%259b%25be-20140811/"/>
      <url>//pictures/%25e6%25af%258f%25e6%2597%25a5%25e4%25b8%2580%25e5%259b%25be-20140811/</url>
      
        <content type="html"><![CDATA[<p>å‘ƒï¼Œæƒ³äº†å¾ˆä¹…ï¼Œè¿˜æ˜¯æ‰“ç®—æè¿™ä¹ˆä¸€å¥—ã€‚ä¸€æ¥å¯ä»¥å·æ‡’ï¼ŒäºŒæ¥å¯ä»¥ç»ƒä¹ æ‹ç…§ï¼Œä¸‰æ¥å¯ä»¥ä¿æŒæ›´æ–°ã€‚</p><p><img src="http://serious.qiniudn.com/WP_20140804_19_03_13_Pro.jpg"></p><p>&nbsp;</p><p>æ‹æ‘„äºåŒ—äº¬å››æƒ å…¬äº¤æ¢çº½ç«™å¤©æ¡¥ã€‚Lumia920ï¼Œç¨æœ‰æ™ƒåŠ¨ï¼Œå™ªç‚¹ç•¥å¤šï¼Œè¯·æ— è§†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¯æ—¥ä¸€å›¾ â€“ 20140821</title>
      <link href="//pictures/%25e6%25af%258f%25e6%2597%25a5%25e4%25b8%2580%25e5%259b%25be-20140821/"/>
      <url>//pictures/%25e6%25af%258f%25e6%2597%25a5%25e4%25b8%2580%25e5%259b%25be-20140821/</url>
      
        <content type="html"><![CDATA[<img src="http://serious.qiniudn.com/@/pic-a-day/2014-8-21-1.JPG" width="1280" height="853" class="alignnone" /><p><em>Canon EOS 60D f/5.6 1/80 100</em></p><p>æ‹æ‘„äºæ…•å³ªå…³ &#8211; æ¢¦çŸ³åŸ</p>]]></content>
      
      
      <categories>
          
          <category> è§†è§‰ç››å®´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2014</title>
      <link href="//gabby/my-2014/"/>
      <url>//gabby/my-2014/</url>
      
        <content type="html"><![CDATA[<p>åšå®¢å¾ˆä¹…å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ï¼Œä¹‹å‰æƒ³æä¸ªæ¯æ—¥ä¸€å›¾ï¼Œä¹Ÿæ²¡åšæŒä¸‹æ¥ã€‚ä»2015å¹´å¼€å§‹å§ï¼Œä»»æ€§ä¸€ç‚¹ï¼Œæ¯å‘¨éƒ½æ¥ä¸ªå›¾å•¥çš„ï¼Œèƒ½è‡ªå·±æ‹å°±è‡ªå·±æ‹ï¼Œä¸ä¸ºåˆ«çš„ï¼Œåªä¸ºåšæŒã€‚è¯´ä¸ºå•¥ä¸æ˜¯æ¯å¤©éƒ½æ¥ä¸ªå›¾ï¼Ÿå“ªæœ‰é‚£ä¹ˆå¤šå¥½å›¾å‘ã€‚ã€‚ä¹Ÿæ˜¯è¦ç­›é€‰çš„å˜›ã€‚<br>ä¸€ä»¶å°äº‹åšæŒä¸‹æ¥ï¼Œå°±æ˜¯ä¸€ä»¶å¤§äº‹ã€‚</p><p>2014å¹´å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚è‡³å°‘åœ¨æˆ‘èº«ä¸Šå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚</p><p>é¦–å…ˆè¦æ­å–œæˆ‘å˜æˆäº†æˆ¿å¥´ã€‚ç»“å©šä¹‹åï¼Œè¿™åº”è¯¥æ˜¯ç¬¬ä¸€ä»¶å¤§äº‹äº†ã€‚å› ä¸ºæˆ¿å­çš„äº‹æƒ…ï¼Œæå¾—æˆ‘è·Ÿåª³å¦‡åœ¨è®¡åˆ’ç”Ÿè‚²çš„é—®é¢˜ä¸Šååˆ†é‡è§†ï¼Œå¦‚æœæœ‰äº†å°é™ˆï¼Œå°±æ„å‘³ç€å®¶ä¸­è´¢æ”¿ä¸€å®šä¼šåƒç´§ã€‚<br>ç„¶åæ­å–œæˆ‘æ¢äº†å·¥ä½œã€‚LBEå®‰å…¨å¤§å¸ˆï¼Œå¾ˆä¸é”™å¾ˆä¸é”™çš„åœ°æ–¹ã€‚æˆ‘ä»å¾ˆä¹…ä¹‹å‰å°±å¼€å§‹ç”¨äº†ï¼Œä¹Ÿå‡ ä¹æ˜¯é€¢äººå¿…æ¨ï¼Œçœ‹èµ·æ¥ä¹Ÿç»™å…¬å¸å¢åŠ äº†ä¸å°‘å®¢æˆ·çš„è¯´ã€‚ã€‚<br>æœ€åæ­å–œæˆ‘æœ‰äº†ç›®æ ‡ã€‚æˆ‘è§‰å¾—ç°åœ¨çš„ç›®æ ‡å¾ˆç®€å•äº†ï¼Œå¥½å¥½æŒ£é’±ï¼Œå…»å®¶ç³Šå£ã€‚è¿™åœ¨å‡ å¹´å‰æˆ‘æ˜¯è¯´ä¸å‡ºè¿™ç§è¯çš„ï¼Œç°åœ¨çœ‹æ¥ï¼Œè¿™ä¸ªç›®æ ‡å¾ˆç°å®ï¼Œä¹Ÿå¾ˆæ¸©é¦¨ã€‚</p><p>2013å¹´å¹´ç»ˆæ€»ç»“æœªå†™ï¼Œè®©æˆ‘æ¥ç…§ç€2012å¹´å¹´ç»ˆæ€»ç»“çš„é£æ ¼æ¥ç å­—å§ï½ï¼ˆå…¶å®2013å¹´å¹´åº•å¼€å§‹åˆ°ç°åœ¨éƒ½æ²¡å‡ ç¯‡æ–‡ç« ï¼Œæˆ‘çœŸå‰ï¼ˆzuoï¼‰å®³ï¼ˆsiï¼‰ï¼‰  </p><span id="more"></span><h2 style="text-align: center;">  <span style="color:#ffa500;">é…¸</span></h2><p style="text-align: center;">  <strong>&#8212; å€’ç‰™</strong></p><p>è¯´èµ·æ¥ä»Šå¹´ä¹°æˆ¿è¿™äº‹ï¼Œå¿ƒä¸­äº”å‘³æ‚æ²‰ã€‚<br>æƒ³è¦ä¹°æˆ¿æ˜¯ç»“å©šå‰çš„äº‹ï¼Œæˆ‘ä¿©åŸºæœ¬æ˜¯è£¸å©šçš„ï¼Œä¹Ÿå¾ˆå¿ƒç…§ä¸å®£åœ°æ²¡æœ‰åœ¨ç»“å©šå‰æä¹°æˆ¿å­çš„äº‹æƒ…ã€‚çœŸæ­£å¼€å§‹è¡ŒåŠ¨å°±æ˜¯ä»Šå¹´äº”ä¸€äº†ã€‚<br>æˆ‘å¦ˆå¸®æˆ‘çœ‹å¥½äº†ä¸€ä¸ªåœ°æ®µï¼Œå¾ˆä¸é”™ï¼Œç°åœ¨çœ‹èµ·æ¥æœ‰äº›è’å‡‰ï¼Œä½†è¿‡å‡ å¹´å°±æ˜¯æ ¸å¿ƒåœ°æ®µï¼Œç¦»æˆ‘ä»¬åŒºæ”¿åºœå¾ˆè¿‘ã€‚æƒ³åˆ°ä»¥åçš„å‡å€¼ç©ºé—´ï¼Œæˆ‘ä»¬ä¿©å»çœ‹äº†ä¸¤æ¬¡ï¼Œä¹Ÿæ²¡å•¥çŠ¹è±«ï¼Œç›´æ¥å°±ç­¾äº†è®¤è´­ä¹¦ã€‚å¥½åœ¨æˆ‘å¦ˆè·Ÿè¿™æˆ¿åœ°äº§å•†çš„æŠŠå…„å¼Ÿæ˜¯äº²æˆšå…³ç³»ï¼ˆç»•å—ï¼Ÿç»•å—ï¼Ÿï¼‰ï¼Œä¼˜æƒ æ”¿ç­–ä¹Ÿè¿˜æ˜¯æœ‰çš„ï¼Œè‡³å°‘åœ¨å¾ˆå¤šäº‹æƒ…ä¸Šï¼Œä¹Ÿæ”¾äº†ä¸€ä»½å¿ƒã€‚<br>äºæ˜¯æ¼«é•¿çš„æ‹‰é”¯æˆ˜å°±å¼€å§‹äº†ã€‚<br>åˆ©ç‡çš„é—®é¢˜ã€é“¶è¡Œçš„é€‰æ‹©ã€å›½å®¶çš„æ”¿ç­–ã€å¸‚çš„æ”¿ç­–ã€æ¯å®¶é“¶è¡Œçš„æ”¿ç­–ã€‚ã€‚æ¯æœ‰ç‚¹é£å¹è‰¹åŠ¨ï¼Œæˆ‘ä¿©éƒ½å¦‚æƒŠå¼“ä¹‹é¸Ÿèˆ¬åœ°å•†é‡å¯¹ç­–ï¼Œä¸ä¸ºåˆ«çš„ï¼Œè¿˜ä¸æ˜¯ä¸ºäº†çœé‚£ä¿©é’±ã€‚<br>æˆ¿å­è¿˜ä¸åªæ˜¯æˆ¿å­ï¼Œåœ°ä¸‹å®¤æ˜¯æ†ç»‘é”€å”®çš„ï¼Œä½†å°¼ç›è¦å•ç‹¬ç®—é’±ï¼Œä¸èƒ½ç®—åœ¨è´·æ¬¾é‡Œã€‚è½¦ä½æ˜¯è¦å•ç‹¬ä¹°çš„ï¼Œä¸ä¹°ä»¥åå°±æ¶¨é’±ï¼Œä¸€æ¶¨å°±æ˜¯å‡ ä¸‡è½¯å¦¹å¸ã€‚åœ°ä¸Šåœè½¦ä½ä¸æ•¢ä¹°ï¼Œè°çŸ¥é“å“ªå¤©å°±ç»™ä½ åˆ’åäº†ã€‚è´·æ¬¾æ˜¯å¿…é¡»è¦èµ°æ‹…ä¿å…¬å¸çš„ï¼Œ20å¹´ç®—ä¸‹æ¥è¦è¿‘ä¸€ä¸‡è½¯å¦¹å¸ã€‚ç»´ä¿®åŸºé‡‘ã€åœ°ç¨ã€å¥‘ç¨ã€‚ã€‚ã€‚<br>æˆ‘çœŸçš„å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œä½†å›è¿‡å¤´æ¥ï¼Œå¿ƒé‡Œè¿˜æ˜¯é…¸æ¶©çš„ã€‚äººç”Ÿæ´»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œåªæƒ³æœ‰ä¸ªé®é£é¿é›¨çš„æ¸¯æ¹¾ï¼Œä½†è¿™æ¸¯æ¹¾çœŸæ˜¯æ¥ä¹‹ä¸æ˜“ã€‚å†æƒ³æƒ³ä¹°æˆ¿ä¸­é—´çš„è¯¸äº‹ï¼Œåˆä¸çŸ¥é“å›½å®¶æ‹¿èµ°äº†æˆ‘å¤šå°‘é’±ï¼Œä¸å…æœ‰äº›å€’ç‰™ã€‚</p><h2 style="text-align: center;">  <span style="color:#0000ff;">ç”œ</span></h2><p style="text-align: center;">  <strong>&#8212; ç³–å¿ƒçš„</strong></p><p>å»å¹´10æœˆ2å·ï¼Œæˆ‘ä»¬ç»“å©šäº†ã€‚å©šåç”Ÿæ´»è™½ç„¶è·Ÿä¹‹å‰æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œä½†æ˜¯å¾ˆå¹¸ç¦ï¼Œå¾ˆç”œèœœã€‚æœ‹å‹ä»¬éƒ½ç¥ç¦æˆ‘ä»¬ï¼Œå®¶é‡Œäººä¹Ÿéƒ½å¾ˆå¼€å¿ƒï¼Œçœ‹å¥½æˆ‘ä»¬çš„æœªæ¥ã€‚<br>ä»Šå¹´æˆ‘ä»¬åŠªåŠ›åœ°ä¸ºæ‰“é€ è‡ªå·±çš„ç”Ÿæ´»åŠªåŠ›ç€ï¼Œè™½ç„¶å¾ˆç´¯ï¼Œå¿å—äº†ä¸€äº›å¹³æ—¥ä¸èƒ½å¿å—ä¹‹è‹¦ï¼Œä½†æ˜¯å¿ƒé‡Œå¾ˆç”œã€‚æƒ³æƒ³æˆ‘ä»¬ä¸ºç”Ÿæ´»çš„æŠ•å…¥ï¼Œçœ‹ç€ä¸€ç‚¹ç‚¹çš„æˆç»©ï¼Œæˆ‘ä»¬è§‰å¾—æ˜¯å€¼å¾—çš„ã€‚<br>å¥½åƒä¹Ÿåµè¿‡å‡ æ¬¡æ¶ï¼Œéƒ½æ˜¯äº›äº›é¸¡æ¯›è’œçš®çš„å°äº‹ï¼Œå¤«å¦»å“ªæœ‰ä¸åµæ¶çš„å˜›ï¼ŒåºŠå¤´åµæ¶åºŠå°¾åˆå˜›ã€‚ç°åœ¨æƒ³æƒ³ï¼Œè§‰å¾—ä¹Ÿæ˜¯ç§å›å¿†å˜›ã€‚<br>å¹´åº•ä¹‹å‰ï¼Œåšäº†ä¸ªå¤§å†³å®šï¼Œå‡†å¤‡æ¢å·¥ä½œã€‚è¿™ä»½å·¥ä½œè¦è¯´èµ·æ¥ï¼Œè¿˜çœŸæ˜¯å·§åˆï¼Œä¹Ÿæ˜¯ä¸ªæœºä¼šã€‚<br>åœ¨ç¾¤é‡Œçœ‹è§LBEçš„æ‹›è˜ä¿¡æ¯ï¼Œæˆ‘å°±è·ŸHRèŠäº†èµ·æ¥ï¼Œå‘ç°å·¥èµ„æ¯”æˆ‘ç°åœ¨çš„è¦å¤šï¼Œç¦»å®¶ä¹Ÿéå¸¸è¿‘ï¼ˆå‡ºé—¨+åè½¦+åˆ°å…¬å¸=30åˆ†é’Ÿï¼‰ï¼Œä¹Ÿæ˜¯æˆ‘æ•¬ä»°çš„å…¬å¸ï¼Œè¿˜æœ‰ä»€ä¹ˆç†ç”±ä¸å»å‘¢ï¼Ÿ<br>äºæ˜¯ä¸€ä¸åšäºŒä¸ä¼‘å°±å»é¢è¯•äº†=ã€‚=<br>è€å¼ è¯´æˆ‘èµ°å¾—å¤ªæ—©ï¼Œæœ‰çš„äººæˆ‘è¯´ä½œæ­»ï¼Œæœ‰çš„äººè¯´èµ¶ç´§èµ°å§è¿™æœºä¼šä¸å¥½æ‰¾ã€‚ã€‚æœ€åè¿˜æ˜¯å†³å®šå¬ä»è‡ªå·±å†…å¿ƒçš„é€‰æ‹©ï¼Œå°±è·ŸåŸæ¥çš„å…¬å¸è¯´å†è§äº†ã€‚<br>ä¹‹å‰ä¸€ç›´ä¸äº†è§£ï¼Œä¸ºä»€ä¹ˆæ€»æœ‰é«˜ç®¡ä¹‹ç±»çš„ä»å·¨å¤´å…¬å¸ç¦»èŒå‘¢ï¼Ÿç°åœ¨çœ‹æ˜ç™½äº†ï¼Œå¤§å…¬å¸æ˜¯ç»™åˆ«äººçœ‹çš„ï¼Œå†…éƒ¨æœ‰å¤šä¹±ï¼Œåªæœ‰èº«ä¸´å…¶å¢ƒçš„äººæ‰çŸ¥é“ã€‚<br>åŠä¸ªæœˆäº†ï¼Œæˆ‘è¿‡å¾—å¾ˆå¼€å¿ƒã€‚å…¬å¸æœ‰å¾ˆå¤šå¤§ç‰›ï¼Œå¯ä»¥ä»ä»–ä»¬é‚£å„¿å­¦åˆ°ä¸œè¥¿ï¼Œä»¤æˆ‘å¾ˆæœŸå¾…ã€‚</p><h2 style="text-align: center;">  <span style="color:#008000;">è‹¦</span></h2><p style="text-align: center;">  <strong>&#8212; éšéšä½œç—›</strong></p><p>å¤§çº¦8æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘å¦ˆç’ç€æˆ‘å»åšäº†ä¸ªæ‰‹æœ¯ã€‚è‚¾å›Šè‚¿+è‚¾ç§¯æ°´ï¼Œè²Œä¼¼å·²ç»åˆ°äº†ä¸åŠ¨åˆ€ä¸è¡Œçš„åœ°æ­¥äº†ã€‚èµ·åˆæˆ‘å¦ˆæ˜¯æƒ³æŠŠæˆ‘ä¿©éƒ½ç’è¿‡å»çš„ï¼Œä½†çº¸åŒ…ä¸ä½ç«ï¼Œè¿™äº‹è¿˜æ˜¯è®©æˆ‘çŸ¥é“äº†ã€‚<br>æˆ‘è´£å¤‡äº†å¥¹ã€‚å„¿å­ä¸åœ¨èº«è¾¹ä¸èƒ½å°½å­ï¼Œå‘ç”Ÿè¿™ä¹ˆå¤§çš„äº‹ï¼Œå±…ç„¶è¿˜è¦ç’ç€æˆ‘ã€‚ä½†æˆ‘ä¹Ÿç†è§£å¥¹ï¼ŒæŠ¥å–œä¸æŠ¥å¿§ï¼Œå¥¹æ€•æˆ‘ä»¬æ‹…å¿ƒã€‚<br>åª³å¦‡ä¹Ÿå¾ˆç€æ€¥ï¼Œæˆ‘ä»¬èµ¶ç´§ä¹°äº†ç¬¬äºŒå¤©æ—©ä¸Šçš„ç¥¨èµ¶å›å®¶ï¼Œæ‰€å¹¸å·²ç»æ²¡ä»€ä¹ˆäº‹æƒ…äº†ã€‚ä½†æ˜¯çœ‹åˆ°æˆ‘å¦ˆæ†”æ‚´çš„èº«å½¢ï¼Œå¿ƒé‡Œéå¸¸éš¾å—ã€‚ä½†è¿˜æ˜¯è¦æ•…ä½œåšå¼ºã€‚<br>æœ€è¿‘ç—…æƒ…ä¼¼ä¹æœ‰äº›åå¤ï¼Œå‡†å¤‡è¿‡å®Œå¹´å†å»è¶Ÿã€‚<br>éšç€å¹´é¾„çš„å¢åŠ ï¼Œæƒ³çš„äº‹æƒ…è¶Šæ¥å¤æ‚ï¼Œä½†ä¸€ä¸ªå¿µå¤´è¶Šæ¥è¶Šåšå®šï¼Œå°±æ˜¯å¸Œæœ›å®¶é‡Œäººéƒ½å¥å¥åº·åº·çš„ï¼Œæˆ‘ä»¬åœ¨å¤–é¢ä¹Ÿèƒ½æ”¾å¿ƒæ‰“æ‹¼ï¼Œæ¯•ç«Ÿå°±ç®—æˆ‘ä»€ä¹ˆéƒ½æ²¡æœ‰äº†ï¼Œè‡³å°‘è¿˜æœ‰å®¶ã€‚</p><h2 style="text-align: center;">  <span style="color:#b22222;">è¾£</span></h2><p style="text-align: center;">  <strong>&#8212; ä»»æ€§</strong></p><p>æˆ‘å†³å®šè¿™ä¸ªéƒ¨åˆ†ä¸å†™äº†ã€‚å› ä¸ºä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆäº‹æƒ…èƒ½ç§°å¾—ä¸Šè¾£çš„ã€‚</p><p>2015å¹´è¦æ¥äº†ï¼Œæ—¥å­ä¹Ÿè¦ç»§ç»­ä¸‹å»ï¼Œæ–°å¹´çš„æ„¿æœ›æ˜¯é¡ºé¡ºåˆ©åˆ©åœ°èµ°ä¸‹å»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çœŸå®äº‹ä»¶</title>
      <link href="//gabby/%25e7%259c%259f%25e5%25ae%259e%25e4%25ba%258b%25e4%25bb%25b6/"/>
      <url>//gabby/%25e7%259c%259f%25e5%25ae%259e%25e4%25ba%258b%25e4%25bb%25b6/</url>
      
        <content type="html"><![CDATA[<p>æ—©ä¸Šï¼Œæ¥åˆ°ä¸€ä¸ªé™Œç”Ÿæ¥ç”µã€‚  </p><span id="more"></span><p>â€œæ‚¨å¥½ï¼Œæ‚¨å¥½ï¼Œæˆ‘è¿™é‡Œæ˜¯XXXé‡‘èå…¬å¸ï¼Œä¸“ä¸šç†è´¢ï¼Œé›¶é£é™©ï¼Œä½æŠ•å…¥ï¼Œé«˜å›æŠ¥ã€‚æ‚¨å¥½ï¼Œè¯·é—®æ‚¨å¯¹ç†è´¢æœ‰ä»€ä¹ˆæƒ³æ³•å—ï¼Ÿâ€</p><p>â€œå“¦ï¼Œç†è´¢å•Šï¼Œå•¥å«ç†è´¢ï¼Ÿâ€<br>â€œå“¦ï¼Œå…ˆç”Ÿæ‚¨å¥½ï¼Œæ‚¨æ˜¯ä¸çŸ¥é“ç†è´¢çš„æ„æ€å—ï¼Ÿâ€</p><p>â€œå—¯ï¼Œä½ ç»™å…·ä½“è®²è®²å‘—ã€‚â€<br>â€œå¥½çš„å…ˆç”Ÿã€‚æ‚¨å¥½ï¼Œæ˜¯è¿™æ ·çš„ï¼Œé€šä¿—åœ°è®²ï¼Œç†è´¢å°±æ˜¯æŠŠæ‚¨çš„é’±ç»™æˆ‘ä»¬ï¼Œç„¶åè¿‡ä¸€æ®µæ—¶é—´ï¼Œå°±èƒ½ç»™æ‚¨æ›´å¤šçš„é’±äº†ã€‚â€</p><p>â€œå“¦ï¼Œé‚£ä¸ºä»€ä¹ˆè¦ç»™ä½ ä»¬å‘¢ï¼Ÿä½ ä»¬æ˜¯æ€ä¹ˆå˜æˆæ›´å¤šçš„é’±çš„å‘¢ï¼Ÿâ€<br>â€œå…ˆç”Ÿæ‚¨å¥½ï¼Œæ˜¯è¿™æ ·çš„ï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å¯èƒ½è·Ÿæ‚¨è¯´äº†æ‚¨ä¹Ÿå¬ä¸æ˜ç™½ã€‚â€</p><p>â€œå“¦ï¼Œæ²¡å…³ç³»ï¼Œä½ è¯´è¯´å§ï¼Œæˆ‘å¬å¬çœ‹ï¼Œè¯´ä¸å®šå¼„æ˜ç™½äº†ä¸€æœ‰å…´è¶£ï¼Œæˆ‘å°±ç†ä¸€ä¸ªå‘¢ï¼Ÿâ€<br>â€œé‚£æ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘ç»™æ‚¨ä¸¾ä¸ªæ —å­ã€‚æ‚¨è¦æ˜¯å»é“¶è¡Œå­˜é’±ï¼Œæ˜¯ä¸æ˜¯ä¼šæœ‰åˆ©æ¯å‘¢ï¼Ÿâ€</p><p>â€œæ˜¯ä¹ˆï¼Ÿæˆ‘å»é“¶è¡Œå­˜é’±ä¹Ÿæ²¡ç»™æˆ‘è¿‡åˆ©æ¯å•Šï¼Ÿâ€<br>â€œå“¦æ‚¨å¥½å…ˆç”Ÿï¼Œè¯·é—®æ‚¨å­˜äº†å¤šå°‘é’±å‘¢ï¼Ÿâ€</p><p>â€œ200å¤šï¼Ÿæˆ‘å¿˜è®°äº†ã€‚â€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å“¦ï¼Œé‚£æ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨å­˜çš„æ˜¯å®šæœŸå‘¢ï¼Ÿè¿˜æ˜¯æ´»æœŸå‘¢ï¼Ÿâ€</p><p>â€œä¸çŸ¥é“å•Šï¼Œä»€ä¹ˆæ˜¯å®šæœŸï¼Ÿä»€ä¹ˆæ˜¯æ´»æœŸï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œå®šæœŸå°±æ˜¯æ‚¨è·Ÿé“¶è¡Œçº¦å®šå¥½æ—¥æœŸå»å–é’±ï¼Œæ´»æœŸå°±æ˜¯æ‚¨éšæ—¶å¯ä»¥å»å–ã€‚â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘ä¸çŸ¥é“å•Šï¼Œæˆ‘å­˜ä¸Šä¹‹åå°±æ²¡å†åŠ¨è¿‡é‚£éƒ¨åˆ†é’±äº†ã€‚â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨æ²¡å»é“¶è¡Œçœ‹çœ‹å—ï¼Ÿâ€</p><p>â€œå“¦ï¼Œé‚£ä¸æ˜¯æˆ‘çš„å¡ã€‚â€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨å¥½å…ˆç”Ÿï¼Œé‚£å¡çš„ä¸»äººæœ‰æ²¡æœ‰å»çœ‹è¿‡å‘¢ï¼Ÿâ€</p><p>â€œå“¦ï¼Œä»–å¯†ç å¿˜è®°äº†ã€‚â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œå¯†ç å¿˜è®°æ˜¯å¯ä»¥é‡ç½®çš„ã€‚â€</p><p>â€œå“¦ï¼Ÿè¿˜èƒ½é‡ç½®ï¼Ÿæ€ä¹ˆé‡ç½®ï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œåªè¦å¸¦ä¸Šæ‚¨çš„èº«ä»½è¯å»é“¶è¡ŒæŸœå°åŠç†å¯†ç é‡ç½®ä¸šåŠ¡å°±è¡Œäº†ã€‚â€</p><p>â€œå“¦ï¼Ÿä»–çš„å¡è¿˜èƒ½å¸¦æˆ‘çš„èº«ä»½è¯å‘¢ï¼Ÿâ€<br>â€œä¸æ˜¯ï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œä»–çš„å¡éœ€è¦å¸¦ä»–çš„èº«ä»½è¯æ‰è¡Œã€‚â€</p><p>â€œå“¦ï¼Œé‚£é‡ç½®äº†ä¹‹åå‘¢ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œé‡ç½®äº†ä¹‹åå°±å¯ä»¥çœ‹ä½™é¢äº†ï¼Œå°±èƒ½çŸ¥é“æ‚¨çš„åˆ©æ¯æœ‰å¤šå°‘äº†ã€‚â€</p><p>â€œå“¦ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿâ€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨å¥½å…ˆç”Ÿï¼Œè¿™æ ·æ‚¨å°±çŸ¥é“å­˜é’±æ˜¯ä¼šæœ‰çš„åˆ©æ¯çš„äº†ã€‚â€</p><p>â€œå“¦ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘ä»¬çš„ç†è´¢åŸç†è·Ÿé“¶è¡Œåˆ©æ¯ç›¸åŒã€‚â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘å¹²å˜›ä¸æŠŠé’±å­˜é“¶è¡Œå‘¢ï¼Ÿâ€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘ä»¬çš„ç†è´¢åˆ©æ¯è¦æ¯”é“¶è¡Œé«˜ä¸€äº›ï¼Œä¸€æ®µæ—¶é—´ä¹‹åæ‚¨èƒ½å¾—åˆ°æ›´å¤šçš„æ”¶ç›Šã€‚â€</p><p>â€œå“¦ï¼Œå¤šå¤šå°‘ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œè¿™ä¸ªä¸å¥½ç»™æ‚¨è®¡ç®—ï¼Œè·Ÿæ‚¨è¦å­˜å…¥çš„é‡‘é¢æœ‰å…³ã€‚â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘è¦å­˜100ï¼Œä½ ä»¬èƒ½ç»™æˆ‘å¤šå°‘é’±ï¼Ÿèƒ½åˆ°1ä¸‡ä¸ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ²¡æœ‰é‚£ä¹ˆé«˜çš„åˆ©æ¯ã€‚è€Œä¸”æˆ‘ä»¬â€”â€”â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘è¦å­˜200å‘¢ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬çš„ç†è´¢10ä¸‡èµ·å­˜ã€‚â€</p><p>â€œå“¦ï¼Œ10ä¸‡å•Šï¼Œé‚£è¿˜ä¸é”™ã€‚æ€ä¹ˆå­˜å•Šï¼Ÿâ€<br>â€œæ‚¨å¥½ï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§é€”å¾„å­˜æ¬¾ï¼Œç›´æ¥æ‰“æ¬¾ï¼Œæ”¯ä»˜å®ï¼Œåˆ°æˆ‘ä»¬å…¬å¸çš„æŸœå°åŠç†éƒ½å¯ä»¥ã€‚æ‚¨è¦å­˜å¤šå°‘ï¼Ÿâ€</p><p>â€œå“¦ï¼Ÿæ”¯ä»˜å®ä¹Ÿèƒ½æ‰“æ¬¾ï¼Ÿâ€<br>â€œæ˜¯çš„ï¼Œå…ˆç”Ÿæ‚¨å¥½ï¼Œæ”¯ä»˜å®æ˜¯æœ‰è½¬è´¦åŠŸèƒ½çš„ï¼Œæˆ‘ä»¬ä¼šç»™æ‚¨ä¸€ä¸ªè´¦å·ï¼Œæ‚¨ç›´æ¥æ‰“é’±è¿‡æ¥å°±å¥½äº†ã€‚â€</p><p>â€œå“¦ï¼Œæ€ä¹ˆè½¬è´¦ï¼Œä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨æœ‰æ”¯ä»˜å®çš„è´¦å·å—ï¼Ÿâ€</p><p>â€œæ²¡æœ‰ã€‚â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨éœ€è¦å…ˆæ³¨å†Œä¸€ä¸ªæ”¯ä»˜å®çš„è´¦å·ã€‚â€</p><p>â€œæ€ä¹ˆæ³¨å†Œï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨èº«è¾¹æœ‰ç”µè„‘å—ï¼Ÿâ€</p><p>â€œæœ‰ç”µè„‘ï¼Œä½†æ˜¯å¼€ä¸äº†æœºäº†ã€‚â€<br>â€œæ‚¨èº«è¾¹æ²¡æœ‰å…¶ä»–ç”µè„‘å—ï¼Ÿâ€</p><p>â€œæ²¡æœ‰ï¼Œå°±è¿™ä¸€å°ã€‚å¼€æœºé»‘å±ï¼Œä¸Šé¢æœ‰ä¸¤è¡Œå°å­—ï¼Œæˆ‘ä¹Ÿçœ‹ä¸æ‡‚ï¼Œæˆ‘ç»™ä½ å¿µå¿µï¼Œä½ å¸®æˆ‘çœ‹çœ‹æ€ä¹ˆå›äº‹å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘å¯¹ä¿®ç”µè„‘â€”â€”â€</p><p>â€œæ­ªå“¦ä¼˜å•Šç©ºæ ¼å¡å“¦æŒ¨å§†å±â€”â€”â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘â€”â€”â€</p><p>â€œä¼˜è¸¢æ˜“å•Šâ€”â€”â€<br>â€œå…ˆç”Ÿï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘çœŸçš„ä¸ä¼šä¿®ç”µè„‘ï¼â€</p><p>â€œå“¦ï¼Œä½ ä¸ä¼šå•Šï¼Œé‚£å°±æ²¡æ³•æ³¨å†Œæ”¯ä»˜å®è´¦å·äº†ã€‚â€<br>â€œæ²¡å…³ç³»ï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨å¯ä»¥å»é“¶è¡Œæ‰“æ¬¾ç»™æˆ‘ä»¬ã€‚â€</p><p>â€œå»é“¶è¡Œï¼Ÿæ€ä¹ˆæ‰“ï¼Ÿæ‚¨ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨å¯ä»¥å»ä»»æ„ä¸€å®¶é“¶è¡Œï¼Œå­˜å…¥10ä¸‡æˆ–æ›´å¤šçš„ç°é‡‘ï¼Œç„¶åâ€”â€”â€</p><p>â€œæ€ä¹ˆå¼„é‚£ä¹ˆå¤šé’±ï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œå˜Ÿâ€”â€”å˜Ÿâ€”â€”å˜Ÿâ€”â€”â€</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çœŸå®äº‹ä»¶</title>
      <link href="/2015-03-25/a-call/"/>
      <url>/2015-03-25/a-call/</url>
      
        <content type="html"><![CDATA[<p>æ—©ä¸Šï¼Œæ¥åˆ°ä¸€ä¸ªé™Œç”Ÿæ¥ç”µã€‚  </p><span id="more"></span><p>â€œæ‚¨å¥½ï¼Œæ‚¨å¥½ï¼Œæˆ‘è¿™é‡Œæ˜¯XXXé‡‘èå…¬å¸ï¼Œä¸“ä¸šç†è´¢ï¼Œé›¶é£é™©ï¼Œä½æŠ•å…¥ï¼Œé«˜å›æŠ¥ã€‚æ‚¨å¥½ï¼Œè¯·é—®æ‚¨å¯¹ç†è´¢æœ‰ä»€ä¹ˆæƒ³æ³•å—ï¼Ÿâ€</p><p>â€œå“¦ï¼Œç†è´¢å•Šï¼Œå•¥å«ç†è´¢ï¼Ÿâ€<br>â€œå“¦ï¼Œå…ˆç”Ÿæ‚¨å¥½ï¼Œæ‚¨æ˜¯ä¸çŸ¥é“ç†è´¢çš„æ„æ€å—ï¼Ÿâ€</p><p>â€œå—¯ï¼Œä½ ç»™å…·ä½“è®²è®²å‘—ã€‚â€<br>â€œå¥½çš„å…ˆç”Ÿã€‚æ‚¨å¥½ï¼Œæ˜¯è¿™æ ·çš„ï¼Œé€šä¿—åœ°è®²ï¼Œç†è´¢å°±æ˜¯æŠŠæ‚¨çš„é’±ç»™æˆ‘ä»¬ï¼Œç„¶åè¿‡ä¸€æ®µæ—¶é—´ï¼Œå°±èƒ½ç»™æ‚¨æ›´å¤šçš„é’±äº†ã€‚â€</p><p>â€œå“¦ï¼Œé‚£ä¸ºä»€ä¹ˆè¦ç»™ä½ ä»¬å‘¢ï¼Ÿä½ ä»¬æ˜¯æ€ä¹ˆå˜æˆæ›´å¤šçš„é’±çš„å‘¢ï¼Ÿâ€<br>â€œå…ˆç”Ÿæ‚¨å¥½ï¼Œæ˜¯è¿™æ ·çš„ï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å¯èƒ½è·Ÿæ‚¨è¯´äº†æ‚¨ä¹Ÿå¬ä¸æ˜ç™½ã€‚â€</p><p>â€œå“¦ï¼Œæ²¡å…³ç³»ï¼Œä½ è¯´è¯´å§ï¼Œæˆ‘å¬å¬çœ‹ï¼Œè¯´ä¸å®šå¼„æ˜ç™½äº†ä¸€æœ‰å…´è¶£ï¼Œæˆ‘å°±ç†ä¸€ä¸ªå‘¢ï¼Ÿâ€<br>â€œé‚£æ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘ç»™æ‚¨ä¸¾ä¸ªæ —å­ã€‚æ‚¨è¦æ˜¯å»é“¶è¡Œå­˜é’±ï¼Œæ˜¯ä¸æ˜¯ä¼šæœ‰åˆ©æ¯å‘¢ï¼Ÿâ€</p><p>â€œæ˜¯ä¹ˆï¼Ÿæˆ‘å»é“¶è¡Œå­˜é’±ä¹Ÿæ²¡ç»™æˆ‘è¿‡åˆ©æ¯å•Šï¼Ÿâ€<br>â€œå“¦æ‚¨å¥½å…ˆç”Ÿï¼Œè¯·é—®æ‚¨å­˜äº†å¤šå°‘é’±å‘¢ï¼Ÿâ€</p><p>â€œ200å¤šï¼Ÿæˆ‘å¿˜è®°äº†ã€‚â€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å“¦ï¼Œé‚£æ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨å­˜çš„æ˜¯å®šæœŸå‘¢ï¼Ÿè¿˜æ˜¯æ´»æœŸå‘¢ï¼Ÿâ€</p><p>â€œä¸çŸ¥é“å•Šï¼Œä»€ä¹ˆæ˜¯å®šæœŸï¼Ÿä»€ä¹ˆæ˜¯æ´»æœŸï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œå®šæœŸå°±æ˜¯æ‚¨è·Ÿé“¶è¡Œçº¦å®šå¥½æ—¥æœŸå»å–é’±ï¼Œæ´»æœŸå°±æ˜¯æ‚¨éšæ—¶å¯ä»¥å»å–ã€‚â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘ä¸çŸ¥é“å•Šï¼Œæˆ‘å­˜ä¸Šä¹‹åå°±æ²¡å†åŠ¨è¿‡é‚£éƒ¨åˆ†é’±äº†ã€‚â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨æ²¡å»é“¶è¡Œçœ‹çœ‹å—ï¼Ÿâ€</p><p>â€œå“¦ï¼Œé‚£ä¸æ˜¯æˆ‘çš„å¡ã€‚â€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨å¥½å…ˆç”Ÿï¼Œé‚£å¡çš„ä¸»äººæœ‰æ²¡æœ‰å»çœ‹è¿‡å‘¢ï¼Ÿâ€</p><p>â€œå“¦ï¼Œä»–å¯†ç å¿˜è®°äº†ã€‚â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œå¯†ç å¿˜è®°æ˜¯å¯ä»¥é‡ç½®çš„ã€‚â€</p><p>â€œå“¦ï¼Ÿè¿˜èƒ½é‡ç½®ï¼Ÿæ€ä¹ˆé‡ç½®ï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œåªè¦å¸¦ä¸Šæ‚¨çš„èº«ä»½è¯å»é“¶è¡ŒæŸœå°åŠç†å¯†ç é‡ç½®ä¸šåŠ¡å°±è¡Œäº†ã€‚â€</p><p>â€œå“¦ï¼Ÿä»–çš„å¡è¿˜èƒ½å¸¦æˆ‘çš„èº«ä»½è¯å‘¢ï¼Ÿâ€<br>â€œä¸æ˜¯ï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œä»–çš„å¡éœ€è¦å¸¦ä»–çš„èº«ä»½è¯æ‰è¡Œã€‚â€</p><p>â€œå“¦ï¼Œé‚£é‡ç½®äº†ä¹‹åå‘¢ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œé‡ç½®äº†ä¹‹åå°±å¯ä»¥çœ‹ä½™é¢äº†ï¼Œå°±èƒ½çŸ¥é“æ‚¨çš„åˆ©æ¯æœ‰å¤šå°‘äº†ã€‚â€</p><p>â€œå“¦ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿâ€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨å¥½å…ˆç”Ÿï¼Œè¿™æ ·æ‚¨å°±çŸ¥é“å­˜é’±æ˜¯ä¼šæœ‰çš„åˆ©æ¯çš„äº†ã€‚â€</p><p>â€œå“¦ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘ä»¬çš„ç†è´¢åŸç†è·Ÿé“¶è¡Œåˆ©æ¯ç›¸åŒã€‚â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘å¹²å˜›ä¸æŠŠé’±å­˜é“¶è¡Œå‘¢ï¼Ÿâ€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘ä»¬çš„ç†è´¢åˆ©æ¯è¦æ¯”é“¶è¡Œé«˜ä¸€äº›ï¼Œä¸€æ®µæ—¶é—´ä¹‹åæ‚¨èƒ½å¾—åˆ°æ›´å¤šçš„æ”¶ç›Šã€‚â€</p><p>â€œå“¦ï¼Œå¤šå¤šå°‘ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œè¿™ä¸ªä¸å¥½ç»™æ‚¨è®¡ç®—ï¼Œè·Ÿæ‚¨è¦å­˜å…¥çš„é‡‘é¢æœ‰å…³ã€‚â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘è¦å­˜100ï¼Œä½ ä»¬èƒ½ç»™æˆ‘å¤šå°‘é’±ï¼Ÿèƒ½åˆ°1ä¸‡ä¸ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ²¡æœ‰é‚£ä¹ˆé«˜çš„åˆ©æ¯ã€‚è€Œä¸”æˆ‘ä»¬â€”â€”â€</p><p>â€œå“¦ï¼Œé‚£æˆ‘è¦å­˜200å‘¢ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬çš„ç†è´¢10ä¸‡èµ·å­˜ã€‚â€</p><p>â€œå“¦ï¼Œ10ä¸‡å•Šï¼Œé‚£è¿˜ä¸é”™ã€‚æ€ä¹ˆå­˜å•Šï¼Ÿâ€<br>â€œæ‚¨å¥½ï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§é€”å¾„å­˜æ¬¾ï¼Œç›´æ¥æ‰“æ¬¾ï¼Œæ”¯ä»˜å®ï¼Œåˆ°æˆ‘ä»¬å…¬å¸çš„æŸœå°åŠç†éƒ½å¯ä»¥ã€‚æ‚¨è¦å­˜å¤šå°‘ï¼Ÿâ€</p><p>â€œå“¦ï¼Ÿæ”¯ä»˜å®ä¹Ÿèƒ½æ‰“æ¬¾ï¼Ÿâ€<br>â€œæ˜¯çš„ï¼Œå…ˆç”Ÿæ‚¨å¥½ï¼Œæ”¯ä»˜å®æ˜¯æœ‰è½¬è´¦åŠŸèƒ½çš„ï¼Œæˆ‘ä»¬ä¼šç»™æ‚¨ä¸€ä¸ªè´¦å·ï¼Œæ‚¨ç›´æ¥æ‰“é’±è¿‡æ¥å°±å¥½äº†ã€‚â€</p><p>â€œå“¦ï¼Œæ€ä¹ˆè½¬è´¦ï¼Œä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨æœ‰æ”¯ä»˜å®çš„è´¦å·å—ï¼Ÿâ€</p><p>â€œæ²¡æœ‰ã€‚â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨éœ€è¦å…ˆæ³¨å†Œä¸€ä¸ªæ”¯ä»˜å®çš„è´¦å·ã€‚â€</p><p>â€œæ€ä¹ˆæ³¨å†Œï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨èº«è¾¹æœ‰ç”µè„‘å—ï¼Ÿâ€</p><p>â€œæœ‰ç”µè„‘ï¼Œä½†æ˜¯å¼€ä¸äº†æœºäº†ã€‚â€<br>â€œæ‚¨èº«è¾¹æ²¡æœ‰å…¶ä»–ç”µè„‘å—ï¼Ÿâ€</p><p>â€œæ²¡æœ‰ï¼Œå°±è¿™ä¸€å°ã€‚å¼€æœºé»‘å±ï¼Œä¸Šé¢æœ‰ä¸¤è¡Œå°å­—ï¼Œæˆ‘ä¹Ÿçœ‹ä¸æ‡‚ï¼Œæˆ‘ç»™ä½ å¿µå¿µï¼Œä½ å¸®æˆ‘çœ‹çœ‹æ€ä¹ˆå›äº‹å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘å¯¹ä¿®ç”µè„‘â€”â€”â€</p><p>â€œæ­ªå“¦ä¼˜å•Šç©ºæ ¼å¡å“¦æŒ¨å§†å±â€”â€”â€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘â€”â€”â€</p><p>â€œä¼˜è¸¢æ˜“å•Šâ€”â€”â€<br>â€œå…ˆç”Ÿï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œæˆ‘çœŸçš„ä¸ä¼šä¿®ç”µè„‘ï¼â€</p><p>â€œå“¦ï¼Œä½ ä¸ä¼šå•Šï¼Œé‚£å°±æ²¡æ³•æ³¨å†Œæ”¯ä»˜å®è´¦å·äº†ã€‚â€<br>â€œæ²¡å…³ç³»ï¼Œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨å¯ä»¥å»é“¶è¡Œæ‰“æ¬¾ç»™æˆ‘ä»¬ã€‚â€</p><p>â€œå»é“¶è¡Œï¼Ÿæ€ä¹ˆæ‰“ï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œæ‚¨å¥½å…ˆç”Ÿï¼Œæ‚¨å¯ä»¥å»ä»»æ„ä¸€å®¶é“¶è¡Œï¼Œå­˜å…¥10ä¸‡æˆ–æ›´å¤šçš„ç°é‡‘ï¼Œç„¶åâ€”â€”â€</p><p>â€œæ€ä¹ˆå¼„é‚£ä¹ˆå¤šé’±ï¼Ÿä½ ç»™è®²è®²å‘—ï¼Ÿâ€<br>â€œå˜Ÿâ€”â€”å˜Ÿâ€”â€”å˜Ÿâ€”â€”â€</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2014</title>
      <link href="/2014-12-31/my-2014/"/>
      <url>/2014-12-31/my-2014/</url>
      
        <content type="html"><![CDATA[<p>åšå®¢å¾ˆä¹…å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ï¼Œä¹‹å‰æƒ³æä¸ªæ¯æ—¥ä¸€å›¾ï¼Œä¹Ÿæ²¡åšæŒä¸‹æ¥ã€‚ä»2015å¹´å¼€å§‹å§ï¼Œä»»æ€§ä¸€ç‚¹ï¼Œæ¯å‘¨éƒ½æ¥ä¸ªå›¾å•¥çš„ï¼Œèƒ½è‡ªå·±æ‹å°±è‡ªå·±æ‹ï¼Œä¸ä¸ºåˆ«çš„ï¼Œåªä¸ºåšæŒã€‚è¯´ä¸ºå•¥ä¸æ˜¯æ¯å¤©éƒ½æ¥ä¸ªå›¾ï¼Ÿå“ªæœ‰é‚£ä¹ˆå¤šå¥½å›¾å‘ã€‚ã€‚ä¹Ÿæ˜¯è¦ç­›é€‰çš„å˜›ã€‚<br>ä¸€ä»¶å°äº‹åšæŒä¸‹æ¥ï¼Œå°±æ˜¯ä¸€ä»¶å¤§äº‹ã€‚</p><p>2014å¹´å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚è‡³å°‘åœ¨æˆ‘èº«ä¸Šå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚</p><p>é¦–å…ˆè¦æ­å–œæˆ‘å˜æˆäº†æˆ¿å¥´ã€‚ç»“å©šä¹‹åï¼Œè¿™åº”è¯¥æ˜¯ç¬¬ä¸€ä»¶å¤§äº‹äº†ã€‚å› ä¸ºæˆ¿å­çš„äº‹æƒ…ï¼Œæå¾—æˆ‘è·Ÿåª³å¦‡åœ¨è®¡åˆ’ç”Ÿè‚²çš„é—®é¢˜ä¸Šååˆ†é‡è§†ï¼Œå¦‚æœæœ‰äº†å°é™ˆï¼Œå°±æ„å‘³ç€å®¶ä¸­è´¢æ”¿ä¸€å®šä¼šåƒç´§ã€‚<br>ç„¶åæ­å–œæˆ‘æ¢äº†å·¥ä½œã€‚LBEå®‰å…¨å¤§å¸ˆï¼Œå¾ˆä¸é”™å¾ˆä¸é”™çš„åœ°æ–¹ã€‚æˆ‘ä»å¾ˆä¹…ä¹‹å‰å°±å¼€å§‹ç”¨äº†ï¼Œä¹Ÿå‡ ä¹æ˜¯é€¢äººå¿…æ¨ï¼Œçœ‹èµ·æ¥ä¹Ÿç»™å…¬å¸å¢åŠ äº†ä¸å°‘å®¢æˆ·çš„è¯´ã€‚ã€‚<br>æœ€åæ­å–œæˆ‘æœ‰äº†ç›®æ ‡ã€‚æˆ‘è§‰å¾—ç°åœ¨çš„ç›®æ ‡å¾ˆç®€å•äº†ï¼Œå¥½å¥½æŒ£é’±ï¼Œå…»å®¶ç³Šå£ã€‚è¿™åœ¨å‡ å¹´å‰æˆ‘æ˜¯è¯´ä¸å‡ºè¿™ç§è¯çš„ï¼Œç°åœ¨çœ‹æ¥ï¼Œè¿™ä¸ªç›®æ ‡å¾ˆç°å®ï¼Œä¹Ÿå¾ˆæ¸©é¦¨ã€‚</p><p>2013å¹´å¹´ç»ˆæ€»ç»“æœªå†™ï¼Œè®©æˆ‘æ¥ç…§ç€2012å¹´å¹´ç»ˆæ€»ç»“çš„é£æ ¼æ¥ç å­—å§ï½ï¼ˆå…¶å®2013å¹´å¹´åº•å¼€å§‹åˆ°ç°åœ¨éƒ½æ²¡å‡ ç¯‡æ–‡ç« ï¼Œæˆ‘çœŸå‰ï¼ˆzuoï¼‰å®³ï¼ˆsiï¼‰ï¼‰  </p><span id="more"></span><h2 style="text-align: center;">  <span style="color:#ffa500;">é…¸</span></h2><p style="text-align: center;">  <strong>&#8212; å€’ç‰™</strong></p><p>è¯´èµ·æ¥ä»Šå¹´ä¹°æˆ¿è¿™äº‹ï¼Œå¿ƒä¸­äº”å‘³æ‚æ²‰ã€‚<br>æƒ³è¦ä¹°æˆ¿æ˜¯ç»“å©šå‰çš„äº‹ï¼Œæˆ‘ä¿©åŸºæœ¬æ˜¯è£¸å©šçš„ï¼Œä¹Ÿå¾ˆå¿ƒç…§ä¸å®£åœ°æ²¡æœ‰åœ¨ç»“å©šå‰æä¹°æˆ¿å­çš„äº‹æƒ…ã€‚çœŸæ­£å¼€å§‹è¡ŒåŠ¨å°±æ˜¯ä»Šå¹´äº”ä¸€äº†ã€‚<br>æˆ‘å¦ˆå¸®æˆ‘çœ‹å¥½äº†ä¸€ä¸ªåœ°æ®µï¼Œå¾ˆä¸é”™ï¼Œç°åœ¨çœ‹èµ·æ¥æœ‰äº›è’å‡‰ï¼Œä½†è¿‡å‡ å¹´å°±æ˜¯æ ¸å¿ƒåœ°æ®µï¼Œç¦»æˆ‘ä»¬åŒºæ”¿åºœå¾ˆè¿‘ã€‚æƒ³åˆ°ä»¥åçš„å‡å€¼ç©ºé—´ï¼Œæˆ‘ä»¬ä¿©å»çœ‹äº†ä¸¤æ¬¡ï¼Œä¹Ÿæ²¡å•¥çŠ¹è±«ï¼Œç›´æ¥å°±ç­¾äº†è®¤è´­ä¹¦ã€‚å¥½åœ¨æˆ‘å¦ˆè·Ÿè¿™æˆ¿åœ°äº§å•†çš„æŠŠå…„å¼Ÿæ˜¯äº²æˆšå…³ç³»ï¼ˆç»•å—ï¼Ÿç»•å—ï¼Ÿï¼‰ï¼Œä¼˜æƒ æ”¿ç­–ä¹Ÿè¿˜æ˜¯æœ‰çš„ï¼Œè‡³å°‘åœ¨å¾ˆå¤šäº‹æƒ…ä¸Šï¼Œä¹Ÿæ”¾äº†ä¸€ä»½å¿ƒã€‚<br>äºæ˜¯æ¼«é•¿çš„æ‹‰é”¯æˆ˜å°±å¼€å§‹äº†ã€‚<br>åˆ©ç‡çš„é—®é¢˜ã€é“¶è¡Œçš„é€‰æ‹©ã€å›½å®¶çš„æ”¿ç­–ã€å¸‚çš„æ”¿ç­–ã€æ¯å®¶é“¶è¡Œçš„æ”¿ç­–ã€‚ã€‚æ¯æœ‰ç‚¹é£å¹è‰¹åŠ¨ï¼Œæˆ‘ä¿©éƒ½å¦‚æƒŠå¼“ä¹‹é¸Ÿèˆ¬åœ°å•†é‡å¯¹ç­–ï¼Œä¸ä¸ºåˆ«çš„ï¼Œè¿˜ä¸æ˜¯ä¸ºäº†çœé‚£ä¿©é’±ã€‚<br>æˆ¿å­è¿˜ä¸åªæ˜¯æˆ¿å­ï¼Œåœ°ä¸‹å®¤æ˜¯æ†ç»‘é”€å”®çš„ï¼Œä½†å°¼ç›è¦å•ç‹¬ç®—é’±ï¼Œä¸èƒ½ç®—åœ¨è´·æ¬¾é‡Œã€‚è½¦ä½æ˜¯è¦å•ç‹¬ä¹°çš„ï¼Œä¸ä¹°ä»¥åå°±æ¶¨é’±ï¼Œä¸€æ¶¨å°±æ˜¯å‡ ä¸‡è½¯å¦¹å¸ã€‚åœ°ä¸Šåœè½¦ä½ä¸æ•¢ä¹°ï¼Œè°çŸ¥é“å“ªå¤©å°±ç»™ä½ åˆ’åäº†ã€‚è´·æ¬¾æ˜¯å¿…é¡»è¦èµ°æ‹…ä¿å…¬å¸çš„ï¼Œ20å¹´ç®—ä¸‹æ¥è¦è¿‘ä¸€ä¸‡è½¯å¦¹å¸ã€‚ç»´ä¿®åŸºé‡‘ã€åœ°ç¨ã€å¥‘ç¨ã€‚ã€‚ã€‚<br>æˆ‘çœŸçš„å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œä½†å›è¿‡å¤´æ¥ï¼Œå¿ƒé‡Œè¿˜æ˜¯é…¸æ¶©çš„ã€‚äººç”Ÿæ´»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œåªæƒ³æœ‰ä¸ªé®é£é¿é›¨çš„æ¸¯æ¹¾ï¼Œä½†è¿™æ¸¯æ¹¾çœŸæ˜¯æ¥ä¹‹ä¸æ˜“ã€‚å†æƒ³æƒ³ä¹°æˆ¿ä¸­é—´çš„è¯¸äº‹ï¼Œåˆä¸çŸ¥é“å›½å®¶æ‹¿èµ°äº†æˆ‘å¤šå°‘é’±ï¼Œä¸å…æœ‰äº›å€’ç‰™ã€‚</p><h2 style="text-align: center;">  <span style="color:#0000ff;">ç”œ</span></h2><p style="text-align: center;">  <strong>&#8212; ç³–å¿ƒçš„</strong></p><p>å»å¹´10æœˆ2å·ï¼Œæˆ‘ä»¬ç»“å©šäº†ã€‚å©šåç”Ÿæ´»è™½ç„¶è·Ÿä¹‹å‰æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œä½†æ˜¯å¾ˆå¹¸ç¦ï¼Œå¾ˆç”œèœœã€‚æœ‹å‹ä»¬éƒ½ç¥ç¦æˆ‘ä»¬ï¼Œå®¶é‡Œäººä¹Ÿéƒ½å¾ˆå¼€å¿ƒï¼Œçœ‹å¥½æˆ‘ä»¬çš„æœªæ¥ã€‚<br>ä»Šå¹´æˆ‘ä»¬åŠªåŠ›åœ°ä¸ºæ‰“é€ è‡ªå·±çš„ç”Ÿæ´»åŠªåŠ›ç€ï¼Œè™½ç„¶å¾ˆç´¯ï¼Œå¿å—äº†ä¸€äº›å¹³æ—¥ä¸èƒ½å¿å—ä¹‹è‹¦ï¼Œä½†æ˜¯å¿ƒé‡Œå¾ˆç”œã€‚æƒ³æƒ³æˆ‘ä»¬ä¸ºç”Ÿæ´»çš„æŠ•å…¥ï¼Œçœ‹ç€ä¸€ç‚¹ç‚¹çš„æˆç»©ï¼Œæˆ‘ä»¬è§‰å¾—æ˜¯å€¼å¾—çš„ã€‚<br>å¥½åƒä¹Ÿåµè¿‡å‡ æ¬¡æ¶ï¼Œéƒ½æ˜¯äº›äº›é¸¡æ¯›è’œçš®çš„å°äº‹ï¼Œå¤«å¦»å“ªæœ‰ä¸åµæ¶çš„å˜›ï¼ŒåºŠå¤´åµæ¶åºŠå°¾åˆå˜›ã€‚ç°åœ¨æƒ³æƒ³ï¼Œè§‰å¾—ä¹Ÿæ˜¯ç§å›å¿†å˜›ã€‚<br>å¹´åº•ä¹‹å‰ï¼Œåšäº†ä¸ªå¤§å†³å®šï¼Œå‡†å¤‡æ¢å·¥ä½œã€‚è¿™ä»½å·¥ä½œè¦è¯´èµ·æ¥ï¼Œè¿˜çœŸæ˜¯å·§åˆï¼Œä¹Ÿæ˜¯ä¸ªæœºä¼šã€‚<br>åœ¨ç¾¤é‡Œçœ‹è§LBEçš„æ‹›è˜ä¿¡æ¯ï¼Œæˆ‘å°±è·ŸHRèŠäº†èµ·æ¥ï¼Œå‘ç°å·¥èµ„æ¯”æˆ‘ç°åœ¨çš„è¦å¤šï¼Œç¦»å®¶ä¹Ÿéå¸¸è¿‘ï¼ˆå‡ºé—¨+åè½¦+åˆ°å…¬å¸=30åˆ†é’Ÿï¼‰ï¼Œä¹Ÿæ˜¯æˆ‘æ•¬ä»°çš„å…¬å¸ï¼Œè¿˜æœ‰ä»€ä¹ˆç†ç”±ä¸å»å‘¢ï¼Ÿ<br>äºæ˜¯ä¸€ä¸åšäºŒä¸ä¼‘å°±å»é¢è¯•äº†=ã€‚=<br>è€å¼ è¯´æˆ‘èµ°å¾—å¤ªæ—©ï¼Œæœ‰çš„äººæˆ‘è¯´ä½œæ­»ï¼Œæœ‰çš„äººè¯´èµ¶ç´§èµ°å§è¿™æœºä¼šä¸å¥½æ‰¾ã€‚ã€‚æœ€åè¿˜æ˜¯å†³å®šå¬ä»è‡ªå·±å†…å¿ƒçš„é€‰æ‹©ï¼Œå°±è·ŸåŸæ¥çš„å…¬å¸è¯´å†è§äº†ã€‚<br>ä¹‹å‰ä¸€ç›´ä¸äº†è§£ï¼Œä¸ºä»€ä¹ˆæ€»æœ‰é«˜ç®¡ä¹‹ç±»çš„ä»å·¨å¤´å…¬å¸ç¦»èŒå‘¢ï¼Ÿç°åœ¨çœ‹æ˜ç™½äº†ï¼Œå¤§å…¬å¸æ˜¯ç»™åˆ«äººçœ‹çš„ï¼Œå†…éƒ¨æœ‰å¤šä¹±ï¼Œåªæœ‰èº«ä¸´å…¶å¢ƒçš„äººæ‰çŸ¥é“ã€‚<br>åŠä¸ªæœˆäº†ï¼Œæˆ‘è¿‡å¾—å¾ˆå¼€å¿ƒã€‚å…¬å¸æœ‰å¾ˆå¤šå¤§ç‰›ï¼Œå¯ä»¥ä»ä»–ä»¬é‚£å„¿å­¦åˆ°ä¸œè¥¿ï¼Œä»¤æˆ‘å¾ˆæœŸå¾…ã€‚</p><h2 style="text-align: center;">  <span style="color:#008000;">è‹¦</span></h2><p style="text-align: center;">  <strong>&#8212; éšéšä½œç—›</strong></p><p>å¤§çº¦8æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘å¦ˆç’ç€æˆ‘å»åšäº†ä¸ªæ‰‹æœ¯ã€‚è‚¾å›Šè‚¿+è‚¾ç§¯æ°´ï¼Œè²Œä¼¼å·²ç»åˆ°äº†ä¸åŠ¨åˆ€ä¸è¡Œçš„åœ°æ­¥äº†ã€‚èµ·åˆæˆ‘å¦ˆæ˜¯æƒ³æŠŠæˆ‘ä¿©éƒ½ç’è¿‡å»çš„ï¼Œä½†çº¸åŒ…ä¸ä½ç«ï¼Œè¿™äº‹è¿˜æ˜¯è®©æˆ‘çŸ¥é“äº†ã€‚<br>æˆ‘è´£å¤‡äº†å¥¹ã€‚å„¿å­ä¸åœ¨èº«è¾¹ä¸èƒ½å°½å­ï¼Œå‘ç”Ÿè¿™ä¹ˆå¤§çš„äº‹ï¼Œå±…ç„¶è¿˜è¦ç’ç€æˆ‘ã€‚ä½†æˆ‘ä¹Ÿç†è§£å¥¹ï¼ŒæŠ¥å–œä¸æŠ¥å¿§ï¼Œå¥¹æ€•æˆ‘ä»¬æ‹…å¿ƒã€‚<br>åª³å¦‡ä¹Ÿå¾ˆç€æ€¥ï¼Œæˆ‘ä»¬èµ¶ç´§ä¹°äº†ç¬¬äºŒå¤©æ—©ä¸Šçš„ç¥¨èµ¶å›å®¶ï¼Œæ‰€å¹¸å·²ç»æ²¡ä»€ä¹ˆäº‹æƒ…äº†ã€‚ä½†æ˜¯çœ‹åˆ°æˆ‘å¦ˆæ†”æ‚´çš„èº«å½¢ï¼Œå¿ƒé‡Œéå¸¸éš¾å—ã€‚ä½†è¿˜æ˜¯è¦æ•…ä½œåšå¼ºã€‚<br>æœ€è¿‘ç—…æƒ…ä¼¼ä¹æœ‰äº›åå¤ï¼Œå‡†å¤‡è¿‡å®Œå¹´å†å»è¶Ÿã€‚<br>éšç€å¹´é¾„çš„å¢åŠ ï¼Œæƒ³çš„äº‹æƒ…è¶Šæ¥å¤æ‚ï¼Œä½†ä¸€ä¸ªå¿µå¤´è¶Šæ¥è¶Šåšå®šï¼Œå°±æ˜¯å¸Œæœ›å®¶é‡Œäººéƒ½å¥å¥åº·åº·çš„ï¼Œæˆ‘ä»¬åœ¨å¤–é¢ä¹Ÿèƒ½æ”¾å¿ƒæ‰“æ‹¼ï¼Œæ¯•ç«Ÿå°±ç®—æˆ‘ä»€ä¹ˆéƒ½æ²¡æœ‰äº†ï¼Œè‡³å°‘è¿˜æœ‰å®¶ã€‚</p><h2 style="text-align: center;">  <span style="color:#b22222;">è¾£</span></h2><p style="text-align: center;">  <strong>&#8212; ä»»æ€§</strong></p><p>æˆ‘å†³å®šè¿™ä¸ªéƒ¨åˆ†ä¸å†™äº†ã€‚å› ä¸ºä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆäº‹æƒ…èƒ½ç§°å¾—ä¸Šè¾£çš„ã€‚</p><p>2015å¹´è¦æ¥äº†ï¼Œæ—¥å­ä¹Ÿè¦ç»§ç»­ä¸‹å»ï¼Œæ–°å¹´çš„æ„¿æœ›æ˜¯é¡ºé¡ºåˆ©åˆ©åœ°èµ°ä¸‹å»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> å¹´ç»ˆæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨gdbè°ƒè¯•ç¨‹åº</title>
      <link href="/2013-04-17/gdb-debugging/"/>
      <url>/2013-04-17/gdb-debugging/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« æ¥è®²è®²Linuxä¸‹å¼ºå¤§çš„è°ƒè¯•å·¥å…·â€“gdbã€‚</p><span id="more"></span><h3 id="ä¸€ã€gdbå¸¸ç”¨çš„å‘½ä»¤ï¼š"><a href="#ä¸€ã€gdbå¸¸ç”¨çš„å‘½ä»¤ï¼š" class="headerlink" title="ä¸€ã€gdbå¸¸ç”¨çš„å‘½ä»¤ï¼š"></a>ä¸€ã€gdbå¸¸ç”¨çš„å‘½ä»¤ï¼š</h3><p>è·Ÿåœ¨Windowsä¸‹ä½¿ç”¨Visual Studioè¿›è¡Œè°ƒè¯•ä¸€æ ·ï¼Œgdbçš„è°ƒè¯•åŠŸèƒ½ä¸å…¶å¤§åŒå°å¼‚ã€‚</p><div class="centered"><table border="1" cellpadding="1" cellspacing="1">    <tbody>        <tr>            <td>å‘½ä»¤</td>            <td>åŠŸèƒ½</td>            <td>å¿«æ·æ–¹å¼</td>        </tr>        <tr>            <td>file</td>            <td>åŠ è½½éœ€è¦è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶</td>            <td>file</td>        </tr>        <tr>            <td>kill</td>            <td>ç»ˆæ­¢æ­£åœ¨è°ƒè¯•çš„ç¨‹åº</td>            <td>k</td>        </tr>        <tr>            <td>list</td>            <td>åˆ—å‡ºæºä»£ç çš„ä¸€éƒ¨åˆ†</td>            <td>l</td>        </tr>        <tr>            <td>info</td>            <td>åˆ—å‡ºæŸä¸ªé¡¹ç›®çš„ä¿¡æ¯</td>            <td>i</td>        </tr>        <tr>            <td>next</td>            <td>æ‰§è¡Œä¸€è¡Œä»£ç ï¼ˆä¸è¿›å…¥å‡½æ•°å†…éƒ¨ï¼‰</td>            <td>n</td>        </tr>        <tr>            <td>step</td>            <td>æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç </td>            <td>s</td>        </tr>        <tr>            <td>continue</td>            <td>ç»§ç»­è¿è¡Œç¨‹åºï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</td>            <td>c</td>        </tr>        <tr>            <td>run</td>            <td>æ‰§è¡Œå·²ç»åŠ è½½çš„ç¨‹åº</td>            <td>r</td>        </tr>        <tr>            <td>quit</td>            <td>ç»ˆæ­¢gdb</td>            <td>q</td>        </tr>        <tr>            <td>watch</td>            <td>ç›‘è§†æŸä¸ªå˜é‡çš„å€¼</td>            <td>w</td>        </tr>        <tr>            <td>examine</td>            <td>ç›‘è§†æŸä¸ªå˜é‡çš„å€¼</td>            <td>x</td>        </tr>        <tr>            <td>break</td>            <td>è®¾ç½®æ–­ç‚¹</td>            <td>b</td>        </tr>        <tr>            <td>disable / enable</td>            <td>ä½¿æ–­ç‚¹æ— æ•ˆ/æœ‰æ•ˆ</td>            <td>disable/enable</td>        </tr>        <tr>            <td>delete</td>            <td>åˆ é™¤æ–­ç‚¹</td>            <td>d</td>        </tr>        <tr>            <td>make</td>            <td>åœ¨ä¸é€€å‡ºgdbçš„æƒ…å†µä¸‹ï¼Œé‡æ–°ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</td>            <td>make</td>        </tr>        <tr>            <td>shell</td>            <td>åœ¨ä¸é€€å‡ºgdbçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨shellå‘½ä»¤</td>            <td>shell</td>        </tr>    </tbody></table></div><p>è¿™åªæ˜¯ä¸€éƒ¨åˆ†å“¦ã€‚å…³äºæ•´ä¸ªgdbè°ƒè¯•å¯ä»¥å†™æˆä¸€æœ¬ä¹¦å‘¢ã€‚</p><p>çœ‹åˆ°å…¨ç§°ä¸è¦ç´§å¼ ï¼Œæ¯•ç«Ÿè¿˜æ˜¯æœ‰äº›å¯¹è‹±æ–‡ä¸å¤ªæ„Ÿå†’çš„åŒå­¦ï¼Œåœ¨gdbä¸‹æŒ‰Tabï¼Œgdbä¹Ÿä¼šå¸®ä½ è‡ªåŠ¨è¡¥å…¨ï¼Œé¿å…è¯¯è¾“å…¥ã€‚è€Œä¸”æŒ‰ä¸Šä¸‹é”®ä¹Ÿå¯ä»¥ç¿»çœ‹å†å²å‘½ä»¤ã€‚ï¼ˆè¿™æ ·ä¸æ˜¯ä¸ªåŠæ³•ï¼Œè¿˜æ˜¯å¥½å¥½å­¦è‹±è¯­å§â•®ï¼ˆâ•¯ï¼¿â•°ï¼‰â•­ï¼‰</p><p>è¿˜æœ‰ä¸€ä¸ªåŠæ³•ï¼Œæ˜¯ä½¿ç”¨ç®€åŒ–çš„å‘½ä»¤ã€‚è¿™ä¸ªæ–¹æ³•æˆ‘è¿˜æ˜¯ç›¸å½“å–œæ¬¢çš„ã€‚ä¸è¿‡è¿˜æ˜¯å»ºè®®åˆå­¦è€…ä½¿ç”¨å…¨ç§°ï¼Œå› ä¸ºåªä½¿ç”¨é¦–å­—æ¯æœ‰æ—¶å€™ä¼šäº§ç”Ÿæ­§ä¹‰ï¼Œæ¯”å¦‚<strong>disable</strong>å’Œ<strong>delete</strong>ï¼Œgdbåœ¨ä½ è¾“å…¥<strong>d</strong>æ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨<strong>delete</strong>ï¼Œå¦‚æœä½ æƒ³ç¦ç”¨æŸä¸ªæ–­ç‚¹ï¼Œå´è¾“å…¥äº†<strong>d 5</strong>ï¼Œé‚£è¿™ä¸ªæ–­ç‚¹å°±ä¼šè¢«åˆ é™¤äº†ã€‚</p><p>å½“ç„¶ï¼Œç†Ÿæ‚‰äº†ä¹‹åï¼Œè¿˜æ˜¯ä½¿ç”¨å¿«æ·å‘½ä»¤å§ï¼Œä¼šæé«˜å¾ˆå¤šçš„æ•ˆç‡ã€‚</p><h3 id="äºŒã€ç¼–å†™æµ‹è¯•ç¨‹åº"><a href="#äºŒã€ç¼–å†™æµ‹è¯•ç¨‹åº" class="headerlink" title="äºŒã€ç¼–å†™æµ‹è¯•ç¨‹åº"></a>äºŒã€ç¼–å†™æµ‹è¯•ç¨‹åº</h3><p>å› ä¸ºè¦è°ƒè¯•ï¼Œå¶è¦å†™ä¸€ä¸ªæœ‰ç‚¹BUGçš„ç¨‹åºï¼Œä»¥æ–¹ä¾¿è°ƒè¯•ï¼Œå¸Œæœ›åŒå­¦ä»¬ä¸è¦å­¦ä¹ æˆ‘è¿™ç§è‡ªæ®‹çš„è¡Œä¸ºã€‚ </p><pre><code class="c">[serious@localhost c]$ vim gdbtest.c[serious@localhost c]$ cat gdbtest.c #include &amp;lt;stdio.h&amp;gt;#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;string.h&amp;gt; void reverse(char* string) &#123;     int nLength = strlen(string);     char* temp = (char*)malloc(nLength + 1);      for(int i = 0; i &lt; nLength; i++)     &#123;         temp[i] = string[nLength - i];     &#125;          strcpy(string, temp);         free(temp);&#125;      int main(int argc, char** argv) &#123;     char * str = malloc(20);     memset(str, 0, 20);     strcpy(str, &quot;hello world!&quot;);      reverse(str);      printf(&quot;%s\n&quot;, str);      free(str);    return 0; &#125;</code></pre><p>ç¼–è¯‘ä¹‹ï¼š</p><pre><code class="bash">[serious@localhost c]$gcc -g -o gdbtest gdbtest.c -std=c99  //æ·»åŠ -gé€‰é¡¹ä»¥äº§ç”Ÿè°ƒè¯•ä¿¡æ¯ </code></pre><p>è¿™ä¸ªç¨‹åºçš„ç”¨æ„æ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²ç»™é€†åºåŒ–ã€‚è¯·æ— è§†æ¸£ç®—æ³•ï¼Œä¸€åˆ‡ä¸ºäº†è°ƒè¯•ã€‚</p><p>è¿è¡Œçœ‹çœ‹æˆ‘ä»¬çš„ç¨‹åºï¼š  </p><pre><code class="bash">[serious@localhost c]$ ./gdbtest[serious@localhost c]$  </code></pre><p>å’¦ï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰è¾“å‡ºå‘¢ï¼Ÿ<br>é‚£å°±æ¥è°ƒè¯•ä¸€ä¸‹ã€‚</p><h3 id="ä¸‰ã€è°ƒè¯•ç¨‹åº"><a href="#ä¸‰ã€è°ƒè¯•ç¨‹åº" class="headerlink" title="ä¸‰ã€è°ƒè¯•ç¨‹åº"></a>ä¸‰ã€è°ƒè¯•ç¨‹åº</h3><p>å› ä¸ºåˆšæ‰æˆ‘ä»¬åœ¨ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå·²ç»åŠ ä¸Šäº†-gé€‰é¡¹ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•äº†ã€‚</p><pre><code class="bash">[serious@localhost c]$ gdb gdbtest GNU gdb (GDB) 7.5 Copyright (C) 2012 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot; and &quot;show warranty&quot; for details. This GDB was configured as &quot;x86_64-unknown-linux-gnu&quot;. For bug reporting instructions, please see: &lt;http://www.gnu.org/software/gdb/bugs/&gt;... Reading symbols from /home/serious/Desktop/c/gdbtest...done. (gdb) //è¿™é‡Œå°±å¯ä»¥å¼€å§‹è¾“å…¥å‘½ä»¤è¿›è¡Œè°ƒè¯•äº†</code></pre><p>é¦–å…ˆåˆ—å‡ºç¨‹åºçš„å†…å®¹ï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å¦å¼€ä¸€ä¸ªç»ˆç«¯ç•Œé¢ä½¿ç”¨vimçš„set nuåŠŸèƒ½æ˜¾ç¤ºè¡Œå·ï¼‰</p><pre><code class="bash">(gdb) list 1 #include &amp;lt;stdio.h&amp;gt;#include &amp;lt;stdlib.h&amp;gt; #include &amp;lt;string.h&amp;gt; void reverse(char* string) &#123;     int nLength = strlen(string);     char * temp = (char*)malloc(nLength);     for(int i = 0; i &lt; nLength; i++) </code></pre><p>listå‘½ä»¤ä¼šä¸€æ¬¡æ€§åˆ—å‡º10è¡Œæºä»£ç ï¼Œliståé¢åŠ ä¸Š1æ˜¯ç¡®ä¿å¯ä»¥ä»ç¬¬ä¸€è¡Œå¼€å§‹æ˜¾ç¤ºæºä»£ç ã€‚</p><p>åé¢çš„å°±ä¸åˆ—å‡ºäº†ã€‚æˆ‘ä»¬åœ¨å‡ ä¸ªå…³é”®çš„ä½ç½®åŠ ä¸Šæ–­ç‚¹ï¼š</p><pre><code class="bash">(gdb) break 7 Breakpoint 1 at 0x4006ac: file gdbtest.c, line 7. (gdb) break 12 Breakpoint 2 at 0x4006d5: file gdbtest.c, line 12. (gdb) b 15 Breakpoint 3 at 0x400707: file gdbtest.c, line 15. (gdb) b 27 Breakpoint 4 at 0x400777: file gdbtest.c, line 27. (gdb) b 29 Breakpoint 5 at 0x400783: file gdbtest.c, line 29. </code></pre><p>ç„¶åçœ‹çœ‹æˆ‘ä»¬æ‰€è®¾ç½®çš„æ–­ç‚¹ï¼š</p><pre><code class="bash">(gdb) info break Num     Type           Disp Enb Address            What 1       breakpoint     keep y   0x00000000004006ac in reverse at gdbtest.c:7 2       breakpoint     keep y   0x00000000004006d5 in reverse at gdbtest.c:12 3       breakpoint     keep y   0x0000000000400707 in reverse at gdbtest.c:15 4       breakpoint     keep y   0x0000000000400777 in main at gdbtest.c:27 5       breakpoint     keep y   0x0000000000400783 in main at gdbtest.c:29 </code></pre><ul><li><p>Numä»£è¡¨æ–­ç‚¹çš„åºå·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç¦ç”¨æŸä¸ªæ–­ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨<strong>disable n</strong>å‘½ä»¤ï¼›å¦‚æœæƒ³è¦åˆ é™¤ï¼Œåˆ™ä½¿ç”¨<strong>delete n</strong>å‘½ä»¤ã€‚å¦‚æœè¦å…¨éƒ¨ç¦ç”¨ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œåˆ™ä¸éœ€è¦å¸¦nã€‚</p></li><li><p>Typeä»£è¡¨æ–­ç‚¹çš„ç±»å‹ã€‚æœ‰<strong>breakpoint</strong>, <strong>watchpoint</strong>å’Œ<strong>catchpoint</strong>ä¸‰ç§ç±»å‹ã€‚</p><ul><li><p>breakpoint: å°±æ˜¯ä¼ è¯´ä¸­çš„æ–­ç‚¹å•¦ã€‚</p></li><li><p>watchpoint: ç›‘æ§å˜é‡ï¼ˆæˆ–è¡¨è¾¾å¼ï¼‰</p></li><li><p>catchpoint: ç›‘æ§äº‹ä»¶ã€‚</p></li></ul></li><li><p>Dispä»£è¡¨å½“èµ°åˆ°å½“å‰æ–­ç‚¹æ—¶ï¼Œå¦‚æœæ­¤æ–­ç‚¹å·²è¢«ç¦ç”¨ï¼Œæ˜¯å¦è¦æ˜¾ç¤ºè¯¥ä¿¡æ¯ã€‚</p></li><li><p>Enbæ˜¯æ–­ç‚¹å½“å‰æ˜¯å¦æ˜¯å¯ç”¨çš„ã€‚å¯ç”¨ä¸ºyï¼Œç¦ç”¨ä¸ºnã€‚</p></li><li><p>Addressæ˜¯æ–­ç‚¹çš„åœ°å€ã€‚æ¯ä¸€ä¸ªæ–­ç‚¹ä¹Ÿæ˜¯æœ‰åˆ†é…ç›¸åº”çš„å†…å­˜çš„ã€‚</p></li><li><p>Whatæ˜¯æ–­ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€åœ¨çš„å‡½æ•°ååŠæ‰€åœ¨æºä»£ç è¡Œæ•°ã€‚</p></li></ul><p>å¼€å§‹è°ƒè¯•ï¼š</p><pre><code class="bash">(gdb) run             // è¿è¡Œç¨‹åºStarting program: /home/serious/Desktop/c/gdbtestBreakpoint 4, main (argc=1, argv=0x7fffffffe1a8) at gdbtest.c:27 27      reverse(str); (gdb) continue        // ç»§ç»­è¿è¡Œç¨‹åºç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹Continuing. Breakpoint 1, reverse (string=0x601010 &quot;hello world!&quot;) at gdbtest.c:7 7       int nLength = strlen(string); (gdb) next            // æ‰§è¡Œä¸€è¡Œä»£ç 8       char * temp = (char*)malloc(nLength); (gdb) print nLength   // æŸ¥çœ‹nLengthçš„å€¼$10 = 12              // é•¿åº¦æ˜¯æ­£ç¡®çš„(gdb) next 10      for(int i = 0; i &lt; nLength; i++) (gdb) next Breakpoint 2, reverse (string=0x601010 &quot;hello world!&quot;) at gdbtest.c:12 12          temp[i] = string[nLength - i]; (gdb) next 10      for(int i = 0; i &lt; nLength; i++) (gdb) next Breakpoint 2, reverse (string=0x601010 &quot;hello world!&quot;) at gdbtest.c:12 12          temp[i] = string[nLength - i]; (gdb) print temp      // æŸ¥çœ‹tempçš„å€¼$11 = 0x601030 &quot;&quot; (gdb) continueContinuing. Breakpoint 2, reverse (string=0x601010 &quot;hello world!&quot;) at gdbtest.c:12 12          temp[i] = string[nLength - i]; (gdb) print temp $12 = 0x601030 &quot;&quot;     // å·²ç»å‘ç°é—®é¢˜äº†ï¼Œè¿ç»­èµ‹å€¼ä¸¤æ¬¡ï¼Œtempå´ä¸€ç›´æ˜¯&quot;&quot;(gdb)</code></pre><p>ç¨‹åºçš„BUGåœ¨äºï¼Œstring[nLength - i]çš„å€¼æ˜¯â€™\0â€™ï¼Œå¦‚æœèµ‹ç»™temp[0]ï¼Œåˆ™å­—ç¬¦ä¸²tempçš„ç¡®å°±å˜æˆäº†â€â€ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>examine</strong>å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹tempæ‰€åœ¨çš„å†…å­˜åŒºåŸŸï¼š</p><pre><code class="bash">(gdb) examine/12ub temp 0x601030:   0   33  100 0   0   0   0   0 0x601038:   0   0   0   0 </code></pre><p>è§£é‡Šä¸€ä¸‹å‘½ä»¤ï¼š</p><p>12ubè¡¨ç¤ºtempæ‰€åœ¨å†…å­˜çš„æ˜¾ç¤ºæ–¹å¼ï¼Œ12uä»£è¡¨æ˜¾ç¤º12ä¸ªè®¡é‡å•ä½ï¼Œbä»£è¡¨å­—èŠ‚ï¼Œæ‰€ä»¥æ­¤å‘½ä»¤æ˜¯æ˜¾ç¤ºä»¥tempä½œä¸ºèµ·å§‹åœ°å€ï¼Œå‘åæ˜¾ç¤º12ä¸ªå­—èŠ‚çš„å†…å®¹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯0ï¼Œç¬¬äºŒä¸ªå­—èŠ‚æ˜¯33ï¼Œå³â€™!â€™ã€‚</p><p>æ›´å¤šæ ¼å¼ï¼Œè¯·man gdbã€‚</p><p>ä¸éœ€è¦é€€å‡ºç¨‹åºï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ç¨‹åºï¼š</p><pre><code class="bash">(gdb) shell [serious@localhost c]$ vim gdbtest.c [serious@localhost c]$ gcc -g -o gdbtest gdbtest.c -std=c99 [serious@localhost c]$ exit exit (gdb) </code></pre><p>å°†æºä»£ç ç¬¬12è¡Œä¿®æ”¹ä¸º:</p><pre><code class="bash">temp[i] = string[nLength - i - 1];</code></pre><p>å†æ¬¡è°ƒè¯•åˆ°ç»™tempèµ‹å€¼çš„éƒ¨åˆ†ï¼Œçœ‹ä¸€ä¸‹tempï¼š</p><pre><code class="bash">(gdb) p temp $13 = 0x601030 &quot;!dlr&quot; </code></pre><p>æœ‰ç«¥é‹é—®äº†ï¼Œè€è¿™æ ·è¾“å‡ºtempå¥½çƒ¦å•Šï¼Œæœ‰ä»€ä¹ˆå…¶ä»–åŠæ³•å—ï¼Ÿ</p><p>å½“ç„¶æœ‰ã€‚ä½¿ç”¨<strong>watch</strong>å‘½ä»¤ã€‚</p><p>åœ¨è°ƒè¯•åˆ°ç¬¬10è¡Œæ—¶ï¼Œä½¿ç”¨<strong>watch</strong>ï¼š</p><pre><code class="bash">(gdb) n 10        for(int i = 0; i &lt; nLength; i++)(gdb) watch temp[i] Hardware watchpoint 12: temp[i] (gdb) c Continuing. Hardware watchpoint 12: temp[i] Old value = 0 &#39;\000&#39; New value = 33 &#39;!&#39; reverse (string=0x601010 &quot;hello world!&quot;) at gdbtest.c:10 10      for(int i = 0; i &lt; nLength; i++) (gdb)</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“temp[i]æœ‰å˜åŒ–æ—¶ï¼Œgdbä¼šæç¤ºä½ ï¼Œå€¼æœ‰å˜åŒ–ï¼Œä»â€™\000\å˜åŒ–åˆ°äº†â€™!â€™ã€‚</p><p>ç¨‹åºæœ€åçš„è¿è¡Œç»“æœï¼š</p><pre><code class="bash">[serious@localhost c]$ ./gdbtest!dlrow olleh</code></pre><h3 id="å››ã€å®¹æ˜“å‡ºç°çš„é—®é¢˜"><a href="#å››ã€å®¹æ˜“å‡ºç°çš„é—®é¢˜" class="headerlink" title="å››ã€å®¹æ˜“å‡ºç°çš„é—®é¢˜"></a>å››ã€å®¹æ˜“å‡ºç°çš„é—®é¢˜</h3><p>1.åœ¨ä½¿ç”¨gdbæ—¶ï¼Œæœ‰æ—¶ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼š</p><pre><code class="bash">(gdb) nMissing separate debuginfos, use: debuginfo-install glibc-2.12-1.80.el6.x86_64(gdb) </code></pre><p>è§£å†³åŠæ³•ï¼šç¼–è¾‘ä¸€ä¸‹debuginfoçš„æºï¼Œå¹¶ä½¿ç”¨debuginfo-installå‘½ä»¤æ›´æ–°debuginfoåº“ã€‚</p><pre><code class="bash">[serius@localhost c]$ vim /etc/yum.repos.d/CentOS-Base-debuginfo.repo: // æ·»åŠ å¦‚ä¸‹æº[base-debuginfo]name=CentOS-$releasever -DebugInfobaseurl=http://debuginfo.centos.org/$releasever/$basearch/gpgcheck=0enabled=0protect=1priority=1</code></pre><p>2.ä¹Ÿæœ‰å¯èƒ½åœ¨è°ƒè¯•ä½ çš„ç¨‹åºæ—¶å‡ºç°ï¼š</p><pre><code class="bash">(gdb) n Single stepping until exit from function yourfunc, which has no line number information. (gdb) </code></pre><p>yourfuncæ˜¯ä½ è‡ªå·±çš„å‡½æ•°ï¼Œè¿™è¡¨ç¤ºç€å«æœ‰æ­¤å‡½æ•°çš„ä»£ç åœ¨ç¼–è¯‘æ—¶å¹¶æ²¡æœ‰åŠ ä¸Š-gé€‰é¡¹ã€‚</p><p>è¿˜æœ‰ä¸€ç§å¯èƒ½ï¼Œæ˜¯ä½ çš„gccç‰ˆæœ¬è¿‡é«˜è€Œgdbç‰ˆæœ¬è¿‡ä½ï¼Œæ¯”å¦‚æˆ‘ã€‚CentOS6.4ï¼Œ4.8.0ç‰ˆæœ¬gccï¼Œå´æ˜¯7.2.0ç‰ˆæœ¬çš„gdbï¼Œæ— å¥ˆå…ˆå‡çº§äº†gdbï¼Œæ‰é¿å…äº†è¿™ä¸ªé”™è¯¯ã€‚</p><p>3.åœ¨<strong>watch</strong>å˜é‡æ—¶å‡ºç°ï¼š</p><pre><code class="bash">(gdb) watch varNo symbol &quot;var&quot; in current context. </code></pre><p>å¾ˆæ˜æ˜¾äº†ï¼Œgdbåœ¨å½“å‰çš„ä»£ç åŸŸå†…æ‰¾ä¸åˆ°varå˜é‡ï¼Œå°±ä¼šæŠ¥è¿™ç§é”™è¯¯ã€‚</p><h3 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h3><p>æ€»çš„æ¥è¯´ï¼Œgdbæ˜¯ä¸ªå¼ºå¤§çš„è°ƒè¯•å™¨ï¼Œæˆ‘åœ¨ä¸Šé¢è¯´çš„è¿™ä¸€å †ï¼Œä¹Ÿåªæ˜¯æ²§æµ·ä¸€ç²Ÿè€Œå·²ï¼Œgdbçš„å®˜æ–¹pdfæ–‡æ¡£å·²ç»å †åˆ°äº†662é¡µã€‚ã€‚æˆ‘ä¹Ÿä¸å¯èƒ½åœ¨ä¸€ç¯‡æ–‡ç« é‡Œè¯´æ¸…æ¥šï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šï¼Œå°±å»ä¸‹è½½æ–‡æ¡£é˜…è¯»å§ã€‚</p><p><a href="http://sourceware.org/gdb/current/onlinedocs/gdb.pdf.gz">å‡¶çŒ›çš„ä¼ é€é—¨</a></p>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> gdb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°èŠ±çš„æ–°å®¶</title>
      <link href="/2013-03-21/xiaohua&#39;s-new-home/"/>
      <url>/2013-03-21/xiaohua&#39;s-new-home/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹åˆè¯·äº†åŠå¤©å‡ï¼Œåˆ°ç¤¾ä¿ä¸­å¿ƒæ¢å¡ã€‚</p><p>åˆ°äº†ç¤¾ä¿ä¸­å¿ƒä¸€é—®ï¼Œä¸‹åˆä¸¤ç‚¹ä¸Šç­ï¼Œç°åœ¨æ‰ä¸€ç‚¹ã€‚äºæ˜¯æˆ‘å¾€æ—è¾¹ä¸€ç…ï¼Œæœ‰ä¸€ä¸ªå°äº­å­ï¼Œé˜³å…‰è¿˜ä¸é”™ï¼Œæ­£å¥½æ‰‹é‡Œæœ‰ä¸€ä»½ã€Šå‘¨æœ«ç”»æŠ¥ã€‹ï¼Œæˆ‘å†³å®šæŠŠè¿™ä¸€ä¸ªå°æ—¶ç”¨åœ¨è¿™å„¿ã€‚</p><p>åäº†ä¸€ä¼šï¼Œèµ·é£äº†ï¼Œä¸€æ‘¸æŠ¥çº¸ï¼Œä¸€æ‰‹ç°ã€‚æŠŠæŠ¥çº¸æ”¶èµ·æ¥ï¼Œä¸€çœ‹æ—è¾¹ï¼Œä¸€åªé»‘ç™½ç›¸é—´çš„å°ç‹—æ­£ä¿¡æ­¥å‘æˆ‘èµ°æ¥ã€‚</p><p>æˆ‘å–œæ¬¢ç‹—ï¼Œäºæ˜¯æˆ‘å†³å®šé€—é€—è¿™æ¡å°ç‹—ã€‚</p><span id="more"></span><p>å°ä¸œè¥¿åº”è¯¥æ˜¯äº¬å·´è·Ÿè´è¶çš„ä¸²ï¼Œè„¸ä¸Šçš„æ¯›çš„èŠ±çº¹æœ‰ç‚¹åƒå²åŠªæ¯”ï¼Œæ··èº«è„å…®å…®çš„ï¼Œä¸€çœ‹å°±æ˜¯æµæµªç‹—ã€‚ä½†æ˜¯çœ¼ç›ç‚¯ç‚¯æœ‰ç¥ï¼Œä¸€ç‚¹ä¹Ÿä¸æ€•æˆ‘ã€‚å®ƒè¿‡æ¥è¹­æˆ‘çš„è…¿ï¼Œæˆ‘å°±æ‘¸æ‘¸å®ƒçš„è„‘è¢‹ï¼Œä¸€ä¼šå®ƒå°±è¶´åœ¨æˆ‘æ—è¾¹å‡†å¤‡æ‰“ä¸ªç›¹äº†ã€‚ç‹—ç‹—åšå‡ºè¿™ç§åŠ¨ä½œï¼Œå°±è¡¨æ˜å®ƒå¯¹ä½ å·²ç»ä¿¡ä»»äº†ï¼Œæˆ‘å¾ˆå¼€å¿ƒå¯ä»¥çœ‹åˆ°å®ƒè¿™æ ·åšã€‚</p><p>æˆ‘æ‰‹é‡Œæ²¡ä»€ä¹ˆåƒçš„ï¼Œæ—è¾¹ä¼¼ä¹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåº—å¯ä»¥ä¹°ç‚¹é›¶é£Ÿå–‚å®ƒï¼Œé‚ä½œç½¢ã€‚</p><p>è¿‡äº†ä¸€ä¼šï¼Œæ¥äº†ä¸€ä¸ª30å²å·¦å³çš„ç”·äººï¼Œå”¤äº†ä¸€å£°â€œå°èŠ±ï¼â€ï¼Œæ­£åœ¨ç¡æ¢¦ä¸­çš„å°èŠ±ä¸€ä¸‹å­å°±çå¼€äº†çœ¼ç›ï¼Œæ¬¢å¿«åœ°å‘ç”·äººå¥”äº†è¿‡å»ã€‚è¿™ä¸€äººä¸€ç‹—æ˜¾ç„¶æ˜¯äº’ç›¸è®¤è¯†çš„ã€‚çœ‹ä»–ä¿©äº²å¯†çš„æ ·å­ï¼Œæˆ‘ä¸ä»…å‡ºå£é—®é“â€œè¿™æ˜¯æµæµªç‹—å§ï¼Ÿâ€ç”·äººæŠ¬å¤´çœ‹äº†æˆ‘ä¸€çœ¼ï¼Œè¯­æ°”æ²‰é‡åœ°å›ç­”é“ï¼šâ€œæ˜¯å•Šï¼Œå‰ä¸€é˜µå®ƒå¦ˆä¸¢äº†ï¼Œå®ƒå°±è‡ªå·±ä¸€ä¸ªäººäº†ã€‚â€è¯´å®Œåˆæ‘¸äº†æ‘¸å°èŠ±ã€‚æˆ‘åªèƒ½å¹ä¸€å£°æ°”è¡¨ç¤ºæŠ±æ­‰ï¼Œç”·äººæ¥ç€è¯´ï¼Œâ€œæ­£çŠ¹è±«è¦ä¸è¦æŠŠå®ƒå¼„å›å®¶å‘¢ã€‚â€æˆ‘å°±æœ‰ç‚¹æƒŠè®¶äº†ã€‚æµæµªç‹—ä¸€èˆ¬æ˜¯ä¸ä¼šæ‹›äººå¾…è§çš„ï¼Œå³ä¾¿æ˜¯ä¸å»æ¬ºè´Ÿå®ƒï¼Œç»™å®ƒç‚¹åƒçš„å°±ç®—ä¸é”™äº†ã€‚è€Œä»–ç«Ÿç„¶åœ¨æƒ³è¦æŠŠå®ƒå¼„å›å®¶ã€‚</p><p>æˆ‘æ­£å‡†å¤‡é—®å…¶ä»–çš„é—®é¢˜ï¼Œèº«ååˆæœ‰äººå«é“â€œå°èŠ±ï¼â€ï¼Œæˆ‘å›å¤´ä¸€çœ‹ï¼Œæ˜¯4ä¸ªå¥³äººï¼Œä¼°è®¡40å²å·¦å³çš„æ ·å­ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç¨å¾®å°ç‚¹ï¼Œ30å²å‡ºå¤´å§ï¼ˆå¥½å§ï¼Œæˆ‘å…¶å®ä¸å¤ªä¼šçœ‹å¥³äººçš„å¹´é¾„=ã€‚=ï¼‰ã€‚å”¤å°èŠ±çš„æ˜¯ä¸€ä¸ªç©¿ç€æ‰“æ‰®æ¯”è¾ƒè®²ç©¶çš„ï¼Œæ˜¯é‚£ç§ä¸€çœ‹å°±æ˜¯æ¥å—è¿‡è‰¯å¥½çš„æ•™è‚²çš„äººã€‚â€œå°èŠ±ï¼è¿‡æ¥ï¼Œçœ‹å¦ˆå¦ˆä»Šå¤©ç»™ä½ å¸¦äº†ä»€ä¹ˆï¼Ÿâ€å°èŠ±åˆä¹é¢ é¢ åœ°è·‘è¿‡å»è¹­å¥¹çš„è…¿ã€‚</p><p>æˆ‘å¿ƒå¤´ä¸€çƒ­ã€‚è¿™æ—¶å€™ç”·äººå‡ºå£°äº†ï¼Œâ€œå‘€ï¼Œå°èŠ±ï¼Œä»Šå„¿ä½ æœ‰å£ç¦äº†ï¼Œæ˜¯å¤§éª¨å¤´å“ã€‚â€è¯´ç½¢äº”ä¸ªäººä¸€èµ·å“ˆå“ˆå¤§ç¬‘ã€‚åŸæ¥è¿™äº”ä¸ªäººä¹Ÿäº’ç›¸è®¤è¯†å•Šã€‚</p><p>åªå¬æ¯”è¾ƒè®²ç©¶çš„å¥³äººè¯´ï¼Œâ€œä¸­åˆå»é…’åº—åƒé¥­ï¼Œç•™ä¸‹äº›éª¨å¤´ï¼Œæˆ‘å°±éƒ½æ‰“åŒ…å›æ¥äº†ã€‚â€å¦å¤–å‡ ä¸ªå¥³äººä¹Ÿæ’å˜´ï¼Œè¯´é“â€œæ€ªä¸å¾—å°èŠ±è·Ÿä½ æœ€äº²ï¼Œä½ è€ç»™å®ƒå¥½åƒçš„ï¼Œæˆ‘ä»¬ç»™çš„éƒ½æ˜¯äº›ç«è…¿è‚ å•¥çš„ï¼Œå’Œä½ ä¸€æ¯”å·®è¿œå•¦ã€‚â€äº”ä¸ªäººè¯´ç¬‘äº†ä¸€é˜µï¼Œå°±å¼€å§‹è½¬å‘åŒä¸€ä¸ªè¯é¢˜â€”â€”ä»Šå¤©æŠŠå®ƒå¸¦å›è°å®¶ã€‚åŸæ¥ä»–ä»¬æ—©å·²å•†é‡å¥½äº†è¿™æ¬¡çš„äº‹æƒ…ã€‚</p><p>ç”·äººå…ˆè¡¨æ€äº†ï¼šâ€œæˆ‘æ¥å§ã€‚æˆ‘æŒºå–œæ¬¢å°èŠ±çš„ã€‚â€<br>æ¯”è¾ƒå¹´è½»çš„å¥³äººæ’å˜´äº†ï¼šâ€œä¸è¡Œï¼Œä½ å®¶å·²ç»æœ‰ä¸¤æ¡æ¯ç‹—äº†ï¼ŒæŠŠå°èŠ±å¼„è¿‡å»ï¼Œä¸æ€•å‡ºäº‹å•Šã€‚â€å“¦ï¼ŒåŸæ¥å°èŠ±æ˜¯ç”·ç”Ÿã€‚<br>è®²ç©¶çš„å¥³äººè¯´é“ï¼šâ€œæˆ‘æ¥å§ï¼Œå°èŠ±å¬è¯ï¼Œæ¯”äº¨åˆ©å¬è¯å¤šäº†ï¼Œæˆ‘ä»¬å®¶äº¨åˆ©ä¹Ÿæ˜¯å…¬çš„ï¼Œä¸æ€•ã€‚â€çœ‹æ¥å¥¹å®¶é‡Œä¹Ÿæœ‰ä¸€æ¡è°ƒçš®æ£è›‹çš„ç‹—ï¼Œåå«äº¨åˆ©ã€‚<br>ä¸€ä¸ªæœ‰ç‚¹å¯Œæ€çš„å¥³äººè¯´ï¼šâ€œä½ ä»¬å‡ å®¶éƒ½æœ‰ç‹—äº†ï¼Œæ²¡å¿…è¦å†å¼„ï¼Œä¹‹å‰å°±è¯´å°èŠ±æˆ‘è¦äº†ã€‚â€<br>å¹´è½»çš„å¥³äººåé©³ï¼šâ€œçœ‹åˆ°å°èŠ±æˆ‘å°±åæ‚”äº†ï¼Œä¸æƒ³è®©ç»™ä½ äº†ï¼Œè®©å®ƒå»æˆ‘å®¶å§ã€‚â€çœ‹æ¥å¥¹è¿˜æ˜¯åæ‚”äº†ã€‚</p><p>è¿™æ—¶å°èŠ±æ­£åœ¨é»˜é»˜åœ°ä½å¤´å•ƒéª¨å¤´ï¼Œå…¨ç„¶ä¸çŸ¥æŠŠå®ƒå›´èµ·æ¥çš„è¿™å‡ ä¸ªäººæ­£åœ¨å†³å®šå®ƒçš„å‘½è¿ã€‚</p><p>å‡ ä¸ªäººäº’ç›¸äº‰äº†ä¸€ä¼šï¼Œä¸€ç›´æ²¡è¯´è¯çš„é‚£ä¸ªå¥³äººå‡ºå£°äº†ï¼šâ€œæˆ‘è§‰å¾—æˆ‘ä»¬è¿˜æ˜¯å…¬å¹³ä¸€ç‚¹ï¼Œè®©å®ƒè‡ªå·±é€‰æ‹©å§ã€‚æˆ‘ä»¬éƒ½å”¤å®ƒï¼Œçœ‹å®ƒå»æ‰¾è°ï¼Œå°±è¡¨æ˜è°è·Ÿå®ƒæœ€æœ‰ç¼˜ã€‚â€</p><p>è¿™ä¸ªæè®®å¾—åˆ°äº†å¤§å®¶çš„ä¸€è‡´è®¤åŒï¼Œè™½ç„¶æœ‰ç‚¹å„¿æˆï¼Œä¸è¿‡çœ‹èµ·æ¥ä¼¼ä¹æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å‡ ä¸ªäººæ‹‰å¼€è·ç¦»ï¼Œç„¶åä»¥å„è‡ªçš„æ–¹å¼å”¤å°èŠ±ã€‚ç”·äººæ˜¯å¹å£å“¨ï¼›è®²ç©¶çš„å¥³äººæ˜¯æ‹¿è£…éª¨å¤´çš„å¡‘æ–™è¢‹å­è¯±æƒ‘å®ƒâ€“é­åˆ°äº†å¤§å®¶çš„åå¯¹åï¼Œå¥¹ä¸å¾—ä¸æ‰”æ‰äº†è¢‹å­ï¼›å¹´è½»çš„å¥³äººè¹²ä¸‹æ¥æ‹æ‰‹ï¼Œåƒå”¤å­©å­é‚£æ ·ï¼Œå¯Œæ€çš„å¥³äººç«™ç€æ‹æ‰‹ï¼ŒåŒæ—¶å«å°èŠ±çš„åå­—ï¼›æ¯”è¾ƒæ²‰é»˜çš„å¥³äººåªæ˜¯å¾ˆå•è°ƒåœ°å«å°èŠ±ã€‚</p><p>å°èŠ±è¿·èŒ«åœ°æŠ¬èµ·å¤´ï¼Œçœ‹çœ‹è¿™ä¸ªï¼Œçœ‹çœ‹é‚£ä¸ªâ€”â€”ç”šè‡³è¿˜å›å¤´æœ›äº†æˆ‘ä¸€çœ¼â€”â€”å…¨ç„¶ä¸çŸ¥è¿™å‡ ä¸ªè€å°å­©ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚å‡ ä¸ªäººéƒ½çœ¼å·´å·´åœ°çœ‹ç€å°èŠ±ï¼Œå°èŠ±ä¹Ÿä¸çŸ¥é“è‡ªå·±è¦åšä»€ä¹ˆã€‚</p><p>è¿‡äº†å¤§çº¦1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå°èŠ±ä¼¼ä¹ç»ˆäºåšäº†å†³å®šã€‚å®ƒå›å¤´çœ‹äº†ä¸€çœ¼è‡ªå·±çš„éª¨å¤´ï¼Œå°±å¥”å‘äº†æ¯”è¾ƒè®²ç©¶çš„å¥³äººã€‚</p><p>æƒ…ç†ä¹‹ä¸­ã€‚ç‹—æ€»æ˜¯å¯¹é‚£ä¸ªç»™è‡ªå·±å¥½åƒçš„ä¸œè¥¿çš„äººæœ‰ç‹¬ç‰¹çš„æ„Ÿæƒ…ã€‚</p><p>å…¶ä»–å››ä¸ªäººå¹äº†å£æ°”ï¼Œç«™èµ·èº«æ¥ï¼Œçº·çº·æŠ±æ€¨å¥¹ç”¨ç¾é£Ÿè¯±æƒ‘å°èŠ±ã€‚è®²ç©¶çš„å¥³äººå–œç¬‘é¢œå¼€ï¼Œè¿˜æ‰“å‡»å…¶ä»–äººï¼šâ€œè¿™å«ä¸ªäººé­…åŠ›ï¼â€</p><p>æ€»ä¹‹ï¼Œå°èŠ±çš„å»å‘å®šäº†ä¸‹æ¥ï¼Œäº”ä¸ªäººå°±è½»æ¾äº†ä¸å°‘ã€‚æ¥ä¸‹æ¥è¦å•†é‡çš„æ˜¯å›å®¶å‰çš„å¤„ç†å·¥ä½œã€‚</p><p>â€œè¦å…ˆç»™å®ƒæ´—ä¸€ä¸‹ï¼ŒæŠŠæ¯›å…¨ç»™å®ƒå‰ƒäº†ï¼Œè®©å®ƒé‡æ–°é•¿ï¼Œè¿™äº›æ¯›æ²¡è¥å…»ï¼Œä¸æŠ—å†»ã€‚â€â€œå‰ƒæ¯›ä¹‹åè¦åšåšçš®è‚¤æŠ¤ç†ã€‚â€â€œè¦ç»™å®ƒæ‰“é’ˆï¼Œå…å¾—å¾—ä¼ æŸ“ç—…ã€‚â€â€œè¦ä¸è¦æ´—æ´—èƒƒï¼Œè°çŸ¥é“å’±ä¸åœ¨çš„æ—¶å€™å®ƒåƒäº†ä»€ä¹ˆä¸œè¥¿ã€‚â€â€œæˆ‘çœ‹ä¸å¦‚å–‚è™«å­è¯ï¼Œæ´—èƒƒå¤ªé­ç½ªäº†ã€‚â€</p><p>å¤§å®¶ä½ ä¸€è¨€æˆ‘ä¸€è¯­åœ°è®¨è®ºç€ï¼Œæˆ‘åœ¨æ—è¾¹çœ‹å¾—å¿ƒé‡Œçƒ­ä¹ä¹çš„ã€‚å°èŠ±ä¼¼ä¹ä¹ŸçŸ¥é“äº†äº›ä»€ä¹ˆï¼Œä¸åœåœ°åœ¨äº”ä¸ªäººä¸­é—´è¹­æ¥è¹­å»ã€‚</p><p>åæ¥å¹´è½»çš„å¥³äººè¯´è¯äº†ï¼šâ€œé‚£å°±è¿™ä¹ˆå®šäº†ï¼Œæˆ‘å…ˆæ‰“ç”µè¯ç»™Xå“¥ï¼Œé—®é—®ä»–é‚£èƒ½ä¸èƒ½å¼„ã€‚â€</p><p>â€œå–‚ï¼ŸXå“¥å•Šï¼Œæ˜¯æˆ‘å•Šã€‚æ˜¯è¿™æ ·çš„ï¼Œæˆ‘è¿™æœ‰æ¡å°ç‹—ï¼Œæ˜¯æ¡æµæµªç‹—ï¼Œæˆ‘æ‰“ç®—æŠŠå®ƒå¸¦å›å®¶ï¼Œæ‚¨çœ‹æ‚¨é‚£èƒ½ä¸èƒ½å¸®æˆ‘å¤„ç†ä¸€ä¸‹ã€‚å•Šï¼Ÿä¸èƒ½å•Šï¼Œåˆ«å•Šï¼Œæˆ‘ä»¬å°±ç»™å®ƒæ´—ä¸€æ´—ç„¶åå‰ƒä¸ªæ¯›å°±è¡Œã€‚åˆ«å•Šï¼Œæˆ‘ä»¬è‡ªå·±æ´—è¿˜ä¸è¡Œä¹ˆï¼Œæ‚¨é‚£ä¸æ˜¯æœ‰ä¸ªå°å«ç”Ÿé—´ä¹ˆï¼Œæˆ‘ä»¬ç»™å®ƒæ´—å®Œäº†æ‚¨å°±å¸®å¿™æ¨ä¸€ä¸‹æ¯›å°±è¡Œã€‚æˆ‘ä»¬å¤šç»™æ‚¨ç‚¹é’±ã€‚å•Šï¼Ÿä¸è¡Œå•Šï¼Ÿâ€<br>è¿™æ—¶è®²ç©¶çš„å¥³äººè¦ç”µè¯ï¼Œç›´æ¥å°±è¯´ï¼šâ€œXå•Šï¼Œæˆ‘æ˜¯ä½ Yå§ã€‚å¯¹ï¼Œä½ å°±å¸®æˆ‘ä»¬ä¸ªå¿™ï¼Œå…¶ä»–çš„å® ç‰©åº—éƒ½å¤ªè¿œäº†ï¼Œæˆ‘ä»¬è¿‡ä¸å»å•Šï¼Œå°±è®¤è¯†ä½ ä¸€ä¸ªï¼Œå¤§å®¶éƒ½è¡—é‡Œè¡—åŠçš„â€”-ä¸éº»çƒ¦ä¸éº»çƒ¦ï¼Œå°±å‰ƒä¸ªæ¯›ï¼Œä¸éº»çƒ¦çš„ã€‚â€<br>ç”·äººä¸è€çƒ¦äº†ï¼Œåœ¨æ—è¾¹è¯´é“ï¼šâ€œå’±å°±ç›´æ¥æŠ±è¿‡å»å°±å®Œäº†ï¼Œå…ˆæŠ±è¿‡å»ï¼ŒæŠ±è¿‡å»å†è¯´ã€‚â€</p><p>è®²ç©¶çš„å¥³äººåˆåŠªåŠ›äº†ä¸€ä¼šï¼Œä¼¼ä¹æ²¡æœ‰å’ŒXå“¥è¾¾æˆå…±è¯†ï¼Œéƒé—·åœ°æŒ‚æ–­äº†ç”µè¯ã€‚</p><p>æˆ‘åœ¨æ—è¾¹ä¹Ÿå¾ˆç€æ€¥ï¼Œè¿™ä¸ªXå“¥æ€ä¹ˆè¿™ä¹ˆå¤§é¢å­å•Šï¼Œè¿™ä¹ˆäº›äººæ±‚ä»–ä»–éƒ½ä¸å‡ºæ‰‹ã€‚</p><p>â€œä¼°è®¡æ˜¯æ€•æœ‰ç—…èŒï¼Œæ¯•ç«Ÿä»–é‚£ä¸ªåœ°æ–¹ç‹—æ¥ç‹—å¾€çš„ã€‚â€æ²‰é»˜çš„å¥³äººçªç„¶æ¥äº†å¥å†·ç¬‘è¯ã€‚</p><p>å…¶ä»–å‡ äººå¾ˆæ˜æ˜¾æ²¡å¿ƒæƒ…å¬å†·ç¬‘è¯ï¼Œéƒ½çš±ç€çœ‰å¤´ï¼Œä¸çŸ¥é“åœ¨æƒ³ä»€ä¹ˆã€‚</p><p>åæ¥è¿˜æ˜¯ç”·äººæ‰“ç ´æ²‰é»˜ï¼šâ€œèµ°ï¼Œå»æˆ‘å®¶æ´—ï¼Œå¤šå¤§ç‚¹äº‹ã€‚â€è®²ç©¶çš„å¥³äººä¸€å¬ä¸å¹²äº†ï¼šâ€œé‚£ä¹Ÿå¾—å»æˆ‘å®¶æ´—ã€‚â€<br>å‡ ä¸ªäººäº‰è®ºäº†ä¸€ä¼šï¼Œè¿˜æ˜¯å†³å®šå»ç”·äººå®¶ç»™å°èŠ±æ´—æ¾¡ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°èŠ±ä¼¼ä¹å‘ç°äº†ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ï¼Œå‘ç›¸åçš„æ–¹å‘èµ°å»ã€‚è®²ç©¶çš„å¥³äººè¿½äº†è¿‡æ¥ï¼Œå«é“ï¼šâ€œå°èŠ±ï¼Œåˆ«ä¹±è·‘ï¼Œå›å®¶äº†ã€‚â€</p><p>è¿™æ—¶å¥¹å·²ç»åˆ°æˆ‘èº«è¾¹äº†ï¼Œé—®æˆ‘ï¼šâ€œä½ ä¹Ÿæ˜¯è¿™ä¸ªå°åŒºçš„ï¼Ÿâ€æˆ‘ç¬‘ç­”ï¼šâ€œä¸æ˜¯ï¼Œæˆ‘æ˜¯å»é‚£å„¿åŠäº‹çš„ã€‚â€æˆ‘æŒ‡äº†æŒ‡æ—è¾¹çš„ç¤¾ä¿ä¸­å¿ƒï¼Œâ€œä½ ä»¬è¿™çš„äººçœŸå¥½ï¼Œå¾ˆå›¢ç»“ï¼Œå¾ˆæœ‰çˆ±å¿ƒã€‚â€æˆ‘ç”±è¡·åœ°èµå¹ã€‚è®²ç©¶çš„å¥³äººå¹äº†ä¸€å£æ°”ï¼Œè¯´é“ï¼šâ€œæµæµªç‹—å¤šå•Šï¼Œæˆ‘ä»¬çœ‹ç€ä¹Ÿå¿ƒç–¼ï¼Œå°½è‡ªå·±çš„å¾®è–„ä¹‹åŠ›å§ã€‚è¿™äº›å°ä¸œè¥¿ä¹ŸæŒºä¸å®¹æ˜“çš„ï¼Œåˆå¬è¯ï¼Œè®¨å–œã€‚â€</p><p>è¯´å®Œï¼Œå…¶ä»–å‡ ä¸ªäººå«å¥¹äº†ã€‚å¥¹å…¨ç„¶ä¸é¡¾å°èŠ±èº«ä¸Šçš„è„å…®å…®ï¼ŒæŠ±èµ·å°èŠ±ï¼Œå‘æˆ‘é“åˆ«ã€‚</p><p>çœ‹ç€ä»–ä»¬çš„èƒŒå½±ï¼Œå¿ƒé‡Œçªç„¶æ˜ç™½äº†ä¸ºä»€ä¹ˆå°èŠ±åœ¨ä¸€å¼€å§‹çš„æ—¶å€™ä¸æ€•æˆ‘äº†ï¼Œå› ä¸ºå®ƒçŸ¥é“ï¼Œæœ‰è¿™ä¹ˆä¸€å¸®äººï¼Œæ˜¯å®ƒçš„å®¶äººã€‚</p><p><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3373849083,1383287608&fm=26&gp=0.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu ä¸‹ä½¿ç”¨ crontab å®šæ—¶æ‰§è¡Œä»»åŠ¡</title>
      <link href="/2013-02-28/crontab-in-ubuntu/"/>
      <url>/2013-02-28/crontab-in-ubuntu/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä»¥å‰çš„å·¥ä½œé‡Œï¼Œcrontabä¹Ÿç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œåšä¸ºä¸€ä¸ªè®¡åˆ’ä»»åŠ¡è½¯ä»¶ï¼Œcrontabå·²ç»åšå¾—è¶³å¤Ÿæ£’äº†ï¼Œå®ƒå¯ä»¥å®Œæˆç»å¤§éƒ¨åˆ†å®šæ—¶å·¥ä½œã€‚</p><span id="more"></span><h3 id="åŸºäºç”¨æˆ·çš„cron"><a href="#åŸºäºç”¨æˆ·çš„cron" class="headerlink" title="åŸºäºç”¨æˆ·çš„cron"></a>åŸºäºç”¨æˆ·çš„cron</h3><p>è€Œä¸”ç”¨æ³•æå…¶ç®€å•ï¼š</p><pre><code class="bash">serious@serious:~/Desktop$ crontab [-u username] [-l|-r|-e]å‚æ•°ï¼š-uï¼šè®¾å®šæŸä¸ªç”¨æˆ·çš„cronæœåŠ¡ï¼Œä¸€èˆ¬rootç”¨æˆ·åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„æ—¶å€™éœ€è¦æ­¤å‚æ•°-lï¼šåˆ—å‡ºæŸä¸ªç”¨æˆ·cronæœåŠ¡çš„è¯¦ç»†å†…å®¹-rï¼šåˆ é™¤æ²¡ä¸ªç”¨æˆ·çš„cronæœåŠ¡-eï¼šç¼–è¾‘æŸä¸ªç”¨æˆ·çš„cronæœåŠ¡å¦‚æœæƒ³æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡åˆ—è¡¨ï¼šcrontab -u username -låˆ é™¤æŸä¸ªç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡åˆ—è¡¨ï¼šcrontab -u username -ré’ˆå¯¹æŸä¸ªç”¨æˆ·ç¼–è¾‘è®¡åˆ’ä»»åŠ¡ï¼šcrontab -u username -e</code></pre><p>ç¬¬ä¸€æ¬¡è¿›å…¥crontabç¼–è¾‘æ—¶ï¼Œä¼šè¯¢é—®è¦é€‰æ‹©å“ªç§ç¼–è¾‘å™¨ï¼Œå“ªç§é¡ºæ‰‹å°±é€‰å“ªç§å‘—ã€‚</p><pre><code class="bash">serious@serious:~/Desktop$ crontab -eno crontab for serious - using an empty oneSelect an editor.  To change later, run &#39;select-editor&#39;.  1. /bin/ed  2. /bin/nano        &lt;---- easiest  3. /usr/bin/emacs23  4. /usr/bin/vim.basic  5. /usr/bin/vim.tinyChoose 1-5 [2]: 4</code></pre><p>é»˜è®¤ä¸ºnanoç¼–è¾‘å™¨ï¼Œæˆ‘é€‰æ‹©4ï¼Œæ­£å¸¸ç‰ˆçš„vimç¼–è¾‘å™¨ã€‚</p><p>æ¥ä¸‹æ¥åœ¨æ‰“å¼€çš„vimç¼–è¾‘å™¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><pre><code class="bash"># Edit this file to introduce tasks to be run by cron.# # Each task to run has to be defined through a single line# indicating with different fields when the task will be run# and what command to run for the task# # To define the time you can provide concrete values for# minute (m), hour (h), day of month (dom), month (mon),# and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).# # Notice that tasks will be started based on the cron&#39;s system# daemon&#39;s notion of time and timezones.# # Output of the crontab jobs (including errors) is sent through# email to the user the crontab file belongs to (unless redirected).# # For example, you can run a backup of all your user accounts# at 5 a.m every week with:# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/# # For more information see the manual pages of crontab(5) and cron(8)# # m h  dom mon dow   command</code></pre><p>å¯ä»¥é˜…è¯»ä¸€ä¸‹å®ƒç»™ä½ çš„è¯´æ˜ã€‚</p><p>ç„¶ååœ¨æ–‡ä»¶çš„æœ€åæ·»åŠ ä¸€è¡Œ</p><pre><code class="bash">30  16  *  *   *   date &gt;&gt; ~/time.log#åˆ† æ—¶  æ—¥  æœˆ  å‘¨  &lt;-------å‘½ä»¤------&gt;</code></pre><p>ç„¶åä¿å­˜é€€å‡ºï¼Œè¿™æ ·åœ¨/var/spool/cron/crontabs/é‡Œå¯ä»¥çœ‹åˆ°ä½ çš„å®šæ—¶è®¡åˆ’æ–‡ä»¶äº†ã€‚è®°å¾—ä½¿ç”¨rootæŸ¥çœ‹ã€‚</p><p>è¯´ä¸€ä¸‹æ¯ä¸€ä¸ªå‚æ•°çš„ä¿¡æ¯ï¼š</p><p>æ•°å­—èŒƒå›´ï¼š<br><img alt="" src="http://images.cy198706.com/Programming/QQ20130228164906.png" /></p><p>å¯ç”¨å­—ç¬¦ï¼š<br><img alt="" src="http://images.cy198706.com/Programming/QQ20130228165829.png" /></p><p>ç°åœ¨å°±æ¥ä¸¾å„ç§å„æ ·çš„ä¾‹å­å§ã€‚</p><p>ä½ çš„å¥³æœ‹å‹çš„ç”Ÿæ—¥æ˜¯æ¯å¹´çš„2æœˆ3æ—¥ï¼Œä½ æƒ³åœ¨2æœˆ2æ—¥çš„23ï¼š59åˆ†å‘ä¸€å°å……æ»¡çˆ±æ„çš„é‚®ä»¶ç»™å¥¹ï¼Œå°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class="bash">59 23 2 2 * mail sweety &lt; /home/serious/ToMyLover.txt</code></pre><p>å“¦å¯¹äº†ï¼Œè®°å¾—æ¯å¹´æŠŠä¿¡çš„å†…å®¹å˜ä¸€å˜ã€‚</p><p>æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡/home/serious/test.shæ–‡ä»¶ï¼š</p><pre><code class="bash">*/5 * * * * /home/serious/test.sh</code></pre><p>æ¯å‘¨äº”ä¸‹åˆ5ï¼š30å‘å°é‚®ä»¶æé†’ä½ çš„æœ‹å‹ï¼Œé©¬ä¸Šè¦ä¸‹ç­å•¦ï¼š</p><pre><code class="bash">30 17 * * * mail friend@somewhere.com &lt; /home/serious/TGIF.txt</code></pre><h3 id="åŸºäºç³»ç»Ÿçš„cron"><a href="#åŸºäºç³»ç»Ÿçš„cron" class="headerlink" title="åŸºäºç³»ç»Ÿçš„cron"></a>åŸºäºç³»ç»Ÿçš„cron</h3><p>å¦‚æœæ˜¯ç³»ç»Ÿä¾‹è¡Œä»»åŠ¡å‘¢ï¼Ÿé‚£å°±ä¸å†éœ€è¦ä½¿ç”¨crontab -eæ¥å®Œæˆä»»åŠ¡äº†ï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘/etc/crontabæ–‡ä»¶ã€‚</p><p>æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼Œcrontab -eè¿™ä¸ªcrontabå…¶å®æ˜¯/usr/bin/crontabè¿™ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œè€Œä¸”/etc/crontabæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿rootèº«ä»½ç¼–è¾‘è¯¥æ–‡ä»¶ã€‚</p><p>çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å§ï¼š</p><pre><code class="bash"># /etc/crontab: system-wide crontab# Unlike any other crontab you don&#39;t have to run the `crontab&#39;# command to install the new version when you edit this file# and files in /etc/cron.d. These files also have username fields,# that none of the other crontabs do.SHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin# m h dom mon dow user  command17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )#</code></pre><p>çœ‹èµ·æ¥è·Ÿåˆšæ‰çš„crontab -eå†…å®¹å·®ä¸å¤šå•Šï¼Œåªæ˜¯æœ‰ä¸€ä¸ªåœ°æ–¹ä¸å¤ªç›¸åŒï¼Œè¿™é‡Œçš„å‘½ä»¤éœ€è¦æä¾›ç”¨æˆ·åã€‚</p><h3 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h3><h4 id="1-æ‰¾ä¸åˆ°crondæœåŠ¡"><a href="#1-æ‰¾ä¸åˆ°crondæœåŠ¡" class="headerlink" title="1.æ‰¾ä¸åˆ°crondæœåŠ¡"></a>1.æ‰¾ä¸åˆ°crondæœåŠ¡</h4><pre><code class="bash">root@serious:~# service crond restartcrond: unrecognized service</code></pre><p>æ€ä¹ˆä¼šæ‰¾ä¸åˆ°crondæœåŠ¡å‘¢ï¼Ÿéš¾é“å®‰è£…çš„æ—¶å€™å–highäº†ï¼Œå¿˜è®°å®‰è£…crondç»„ä»¶ï¼Ÿä¸å¯èƒ½ã€‚ã€‚è¿™æ˜¯é›†æˆçš„ã€‚</p><p>Googleäº†ä¸€ç•ªï¼Œå‘ç°åœ¨Ubuntué‡Œï¼ŒcrondæœåŠ¡æ”¹å¤´æ¢é¢ï¼Œå˜æˆcronäº†ï¼Œæ‰€ä»¥æ­£ç¡®çš„å‘½ä»¤åº”è¯¥æ˜¯ï¼š</p><pre><code class="bash">root@serious:~# service cron restartæˆ–è€…æ˜¯root@serious:~# /etc/init.d/cron restart</code></pre><h4 id="2-crontabè®¾ç½®å®Œåä¸æ‰§è¡Œã€‚"><a href="#2-crontabè®¾ç½®å®Œåä¸æ‰§è¡Œã€‚" class="headerlink" title="2.crontabè®¾ç½®å®Œåä¸æ‰§è¡Œã€‚"></a>2.crontabè®¾ç½®å®Œåä¸æ‰§è¡Œã€‚</h4><p>é¦–å…ˆæ£€æŸ¥è·¯å¾„ï¼Œåœ¨crontabä¸­æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™ç»å¤§éƒ¨åˆ†ä¸æ‰§è¡Œçš„åŸå› éƒ½æ˜¯å› ä¸ºè·¯å¾„é—®é¢˜ã€‚</p><p>ç¬¬äºŒï¼Œç”±äºcrontabæœºåˆ¶é—®é¢˜ï¼Œcrontabæ¯åˆ†é’Ÿä¼šå¸®æˆ‘ä»¬é‡æ–°è¯»å–ä¸€æ¬¡/etc/crontabï¼Œä½†åœ¨æœ‰äº›*nixç³»ç»Ÿä¸­ï¼Œcrontabæ˜¯è¯»åˆ°å†…å­˜ä¸­çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±è¦å°†cronæœåŠ¡é‡æ–°å¯åŠ¨ä¸€éäº†ã€‚</p><p>ç¬¬ä¸‰ï¼Œç¯å¢ƒå˜é‡é—®é¢˜ã€‚</p><p>æ¯”å¦‚æˆ‘ç”¨C++å†™äº†ä¸ªç¨‹åºï¼Œéœ€è¦ä½¿ç”¨crontabæ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¸ªç¨‹åºçš„è¿è¡Œæ˜¯éœ€è¦ç¯å¢ƒå˜é‡æ”¯æŒçš„ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦åœ¨crontabæ–‡ä»¶ä¸­åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå¦åˆ™ä¼šæœ‰å„å¼å„æ ·çš„é”™è¯¯æç¤ºã€‚</p><h4 id="3-æˆ‘ä¸€ä¸‹å­é€‰é”™äº†ç¼–è¾‘å™¨è‚¿ä¹ˆåŠã€‚"><a href="#3-æˆ‘ä¸€ä¸‹å­é€‰é”™äº†ç¼–è¾‘å™¨è‚¿ä¹ˆåŠã€‚" class="headerlink" title="3.æˆ‘ä¸€ä¸‹å­é€‰é”™äº†ç¼–è¾‘å™¨è‚¿ä¹ˆåŠã€‚"></a>3.æˆ‘ä¸€ä¸‹å­é€‰é”™äº†ç¼–è¾‘å™¨è‚¿ä¹ˆåŠã€‚</h4><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œé‡æ–°é€‰æ‹©å³å¯ï¼š</p><pre><code class="bash">serious@serious:~# select-editor</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2012</title>
      <link href="/2013-01-31/my-2012/"/>
      <url>/2013-01-31/my-2012/</url>
      
        <content type="html"><![CDATA[<p>2012å¹´ï¼Œæœ‰æƒŠæ— é™©åœ°è¿‡æ¥äº†ã€‚</p><p>å›é¡¾è¿™ä¸€å¹´ï¼Œé…¸ç”œè‹¦è¾£éƒ½æœ‰ï¼Œç®—æ˜¯è®©æˆ‘åœ¨è¿™ä¸€å¹´ä½“ä¼šåˆ°äº†äººç”Ÿçš„å¤šå§¿å¤šå½©ã€‚</p><p>ä¹‹å‰åœ¨æˆ‘çš„è„‘æµ·é‡Œï¼Œå°è±¡æœ€æ·±çš„ä¸€å¹´æ˜¯1993å¹´ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå°è±¡æœ€æ·±åˆ»ï¼Œä½†æ˜¯å¦‚æœåˆ«äººé—®èµ·æ¥ï¼Œè‚¯å®šå°±æ˜¯1993å¹´ï¼Œå¯èƒ½è·Ÿçº½çº¦ä¸–è´¸ä¸­å¿ƒå‘ç”Ÿçˆ†ç‚¸æœ‰å…³ç³»ï¼Ÿï¼ˆç¬‘ï¼‰</p><p>ç°åœ¨æ¥è¯´ï¼Œå°è±¡æœ€æ·±åˆ»çš„è‚¯å®šå°±æ˜¯2012å¹´äº†ã€‚</p><p>2012å¹´æ³¨å®šæ˜¯ä¸å¹³å‡¡çš„ä¸€å¹´ï¼Œ25å²ï¼Œç®—æ˜¯æ­£å¼åº¦è¿‡äº†äººç”Ÿçš„1/4&#8211;æˆ–è®¸æ˜¯1/3æ›´å¥½äº›ã€‚è¿™ä¸€å¹´ä¸–ç•Œä¸Šå‘ç”Ÿçš„äº‹æƒ…å¤ªå¤šï¼Œè·Ÿæˆ‘æœ‰å…³ç³»çš„å€’æ˜¯ä¸å¤šã€‚æˆ–è®¸ä¸–ç•Œæœ«æ—¥è·Ÿæˆ‘æœ‰ç‚¹å…³ç³»å§ï¼Œä½†æ˜¯è¿™ä¸€å¤©æ˜¯è·Ÿæœ€çˆ±çš„äººä¸€èµ·åº¦è¿‡çš„ï¼Œè›®æœ‰æ„ä¹‰ã€‚</p><span id="more"></span><h2 style="text-align: center;">  <span style="color:#ffa500;">é…¸</span></h2><p style="text-align: center;">  <strong>&#8212; é…¸æ˜¯ç§å‚¬åŒ–å‰‚</strong></p><p>2010å¹´æˆ‘æ¥åˆ°åŒ—äº¬ï¼Œåˆ°2012å¹´7æœˆæ•´ä¸¤å¹´ã€‚ </p><p>åŒ—äº¬ç»™æˆ‘çš„ç¬¬ä¸€å°è±¡å¾ˆä¸é”™ï¼Œäº¤é”™ç›˜æ‚çš„ç«‹äº¤æ¡¥ï¼Œå“ªå“ªéƒ½æ˜¯äººçš„æ™¯ç‚¹ï¼Œå¹²å‡€çš„è¡—é“ï¼Œæ»¡ç›®çš„é«˜æ¥¼å¤§å¦ï¼Œç©¿å¾—å¾ˆæœ‰è´¨é‡çš„è¡Œäººã€‚</p><p>æ·±å…¥äº†è§£åŒ—äº¬åï¼Œæ‰æ„Ÿè§‰ä¸æ˜¯é‚£ä¹ˆå›äº‹ã€‚åŒ—äº¬è¡¨é¢çœ‹èµ·æ¥å¾ˆå…‰é²œäº®ä¸½ï¼Œå†…é‡Œçš„æ±¡æµŠæ˜¯æ·±åˆ°éª¨é«“é‡Œçš„ã€‚ç¢äºå¤©æœåˆ¶åº¦ï¼Œæˆ‘ä¸èƒ½åœ¨è¿™é‡Œè¯´ä¸€æœä¹‹éƒ½çš„åè¯ï¼Œå¦åˆ™è¢«è·¨çœäº†å°±ä¸å¥½äº†ã€‚æ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯å¤©æœçš„ä¸€åˆ†å­ã€‚ </p><p>ç°åœ¨çš„äº¬åŸç»™æˆ‘çš„æ„Ÿè§‰å¾ˆå·®ã€‚æ··æµŠçš„ç©ºæ°”ï¼Œæ¯å¤©è¦ç˜«ç—ªå‡ æ¬¡çš„äº¤é€šï¼ˆåœ°é“å¾ˆæ–¹ä¾¿ï¼‰ï¼Œé±¼é¾™æ··æ‚çš„äººï¼Œé«˜æ˜çš„éª—å­ï¼Œæ˜‚è´µçš„ç”Ÿæ´»ã€‚</p><p>äº†è§£äº†äº¬åŸï¼Œå´åˆä¸å¾—ä¸åœ¨è¿™ç§å¤§ç¯å¢ƒä¸‹éšæ³¢é€æµï¼ŒçœŸçš„æ˜¯å¾ˆæ— å¥ˆï¼Œè°è®©å’±æ˜¯ä¸ºäº†ç”Ÿæ´»å‘¢ã€‚ </p><p>2011å¹´åº•ï¼Œåœ¨åˆè‚¥åº¦è¿‡äº†ä¸€æ®µç°æš—çš„æ—¶å…‰ï¼Œåœ¨2012å¹´å¹´åˆåˆè½¬æˆ˜é™•è¥¿ï¼Œ1ä¸ªæœˆä¸é•¿ä¸çŸ­ï¼Œä½†å´å°†æˆ‘çš„ä¿¡å¿ƒå’Œè€å¿ƒç£¨å¾—ä¸€å¹²äºŒå‡€ã€‚ç´¢æ€§ç¦»å¼€é™•è¥¿ï¼Œç‹¬è‡ªä¸€äººè¸ä¸Šå›åŒ—äº¬çš„è·¯ï¼Œå¿ƒä¸­çš„é…¸æ¶©æ— äººå¯è¯‰ã€‚</p><p>æ¥ä¸‹æ¥åœ¨æ‰¾å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œåˆè¢«æ‰“å‡»å¾—ä½“æ— å®Œè‚¤ã€‚æ€»æƒ³ç€è‡ªå·±å·²ç»å¯ä»¥ç‹¬å½“ä¸€é¢äº†ï¼Œåˆ°å¤´æ¥è¿˜æ˜¯ä»€ä¹ˆéƒ½ä¸ä¼šï¼Œè¢«é¢è¯•çš„äººè¯´å¾—é¢çº¢è€³èµ¤ã€‚ </p><p>æœ€åæ¥åˆ°è¿™å®¶å…¬å¸ï¼Œè‡ªå·±æ‰€åœ¨çš„éƒ¨é—¨åªæœ‰è‡ªå·±ä¸€ä¸ªäººï¼Œåœ¨åˆ«äººçœ‹èµ·æ¥&ldquo;å“‡ï¼Œä½ æ—¢æ˜¯éƒ¨é—¨ç»ç†åˆæ˜¯æŠ€æœ¯æ€»ç›‘åˆæ˜¯å‘˜å·¥å“ï¼&rdquo;ï¼Œå´æ— æ³•äº†è§£å…¶ä¸­çš„éš¾å—ä¹‹å¤„ã€‚</p><p>å› ä¸ºå‰æœŸè¢«æ‰“å‡»ï¼Œå·¥èµ„æ²¡æ•¢è¦å¤ªé«˜ï¼Œä»¥è‡´ç°åœ¨æ‰‹å¤´è¿˜æ˜¯ç´§å¼ å¾—è¦å‘½ã€‚æˆ‘åˆä¸ä¼šå­˜é’±ï¼Œå‡ ä¹æ¯ä¸ªæœˆéƒ½å‘æœˆå…‰ç¾¤ä½“é æ‹¢ï¼Œæ€»æ˜¯æ„Ÿè§‰é’±ä¸å¤Ÿã€‚è¯´å®è¯æˆ‘å¯¹é‡‘é’±çš„æ¬²æœ›å¹¶ä¸å¼ºçƒˆï¼Œä½†æœ‰æ—¶åœ¨è¡—ä¸Šèµ°ï¼Œé£å•Šé›¨å•Šçš„å¹è¿‡æ¥ï¼Œè¿˜æ˜¯å¾ˆç¾¡æ…•é‚£äº›ååœ¨è½¦é‡Œæš–æš–å’Œå’Œèˆ’èˆ’æœæœçš„äººçš„ã€‚ </p><p>æ¢äº†å·¥ä½œï¼Œä¹Ÿæ¢äº†ä¸ªæ–°çš„ä½æ‰€ã€‚ä¹Ÿè®¸æ˜¯æˆ‘æ¶‰ä¸–æœªæ·±ï¼Œä¹Ÿè®¸æ˜¯æˆ‘çœŸçš„æ²¡ä»€ä¹ˆè„‘å­ï¼Œå¯¹äººæ²¡ä»€ä¹ˆé˜²å¤‡ä¹‹å¿ƒï¼Œå±…ç„¶å°±è¢«éª—ç€ä½äº†ä¸ªå¾ˆæš—å¾ˆæš—çš„éš”æ–­é—´ã€‚å½“æ—¶æ­£æ˜¯æ˜¥å¤äº¤é™…æ—¶ï¼Œæ¸©åº¦å’Œæ¹¿åº¦éƒ½é€‚å®œï¼Œä½†åˆ°äº†å¤å¤©å°±æœ‰æƒ³æ­»çš„å¿ƒäº†ã€‚è¿™éƒ½ä¸æ˜¯é‡ç‚¹ï¼Œå¤§ä¸äº†å¤šæ´—æ¾¡ï¼Œå¤šå¼€ä¼šé£æ‰‡ï¼Œé‡ç‚¹æ˜¯åŒä½çš„äººæ˜¯æœ‰å¤šå¥‡è‘©ã€‚</p><p>éš”å£æ˜¯å››ä¸ªç™½ç—´ï¼Œå…¶ä¸­ä¸€ä¸ªä»æ¥ä¸ä¸Šç­ï¼Œå› ä¸ºæˆ‘éšæ—¶éƒ½èƒ½å¬åˆ°ä»–çš„å¤§å—“é—¨ï¼Œåœ¨å–Š&ldquo;è‰¹ï¼åŠ è¡€å•Šï¼è‰¹ï¼Œä¼šä¸ä¼šæ‰“ï¼&rdquo;ï¼›ç¬¬äºŒä¸ªæ‹‰å®Œå±ä»æ¥ä¸å†²ï¼Œç»ˆäºåœ¨ä¸€ä¸ªæ™šä¸Šéš”å£çš„éš”å£çš„å¥³äººå¿ä¸ä½äº†ï¼Œè·Ÿè¿™ç™½ç—´å¤§åµäº†ä¸€é€šï¼Œè¿™ç™½ç—´è¿˜TMç©¿ç€çº¢è£¤è¡©ï¼Œç«™åœ¨èµ°å»Šé‡Œï¼Œè·Ÿä¸ªæš´éœ²ç‹‚ä¸€æ ·ï¼›ç¬¬ä¸‰ä¸ªä¼šå¼¹å‰ä»–ï¼Œæ›¾ç»çš„è®°å½•æ˜¯è¿ç»­å”±äº†ä¸¤ä¸ªæ˜ŸæœŸçš„ã€Šä½ çš„èƒŒåŒ…ã€‹ï¼Œè¿™ä¹Ÿå°±ç½¢äº†ï¼Œå…³é”®æ˜¯ä»–å”±æ­Œçš„è°ƒè°ƒå®åœ¨è®©äººä¸æ•¢ç›´è§†ï¼ŒçœŸæ•™äººæ¬²æ­»ä¸æ¬²ç”Ÿï¼›ç¬¬å››ä¸ªæ¯å¤©éƒ½è¦æŠ±æ€¨ç”Ÿæ´»çš„ä¸å…¬å¹³ï¼Œæ¯å¤©å›åˆ°å®¶éƒ½è¦é•¿å¹ä¸€å£æ°”ï¼Œç„¶åå¼€å§‹è¯‰è‹¦ï¼Œè¯´çœŸæ²¡æ„æ€ï¼Œæ‹¿è¿™ä¸¤åƒå—é’±çš„å·¥èµ„ï¼Œè¿˜æ¯å¤©ç´¯å¾—è·Ÿå­™å­ä¸€æ ·ã€‚</p><p>éš”å£çš„éš”å£çš„å¥³äººå…¶å®ä¹Ÿæ˜¯ä¸ªå¥‡è‘©ã€‚å¥¹è·Ÿå¦ä¸€ä¸ªå¥³äººä½åœ¨ä¸€èµ·ï¼Œæ´—æ¾¡æ—¶ä¸€å®šæ˜¯ä¸¤ä¸ªäººä¸€èµ·ï¼Œæ—¶é—´ç‰¹åˆ«ç‰¹åˆ«é•¿ï¼Œè‡³å°‘è¦ä¸¤ä¸ªå°æ—¶ï¼Œè¿™è®©æˆ‘ä»¬å–å¤šäº†æ°´æ†‹ç€çš„äººæƒ…ä½•ä»¥å ªã€‚</p><p>è¿˜æœ‰å·è‚¥çš‚çš„ï¼Œå‡ºé—¨ä»æ¥ä¸å…³é—¨çš„ï¼Œæ´—äº†è¢œå­å†…è£¤éšä¾¿å¾€åˆ«äººè¡£æœä¸Šæ­çš„ï¼Œåœ¨æ»¡æ˜¯èŸ‘è‚çš„å¨æˆ¿é‡Œåšé¥­çš„ï¼Œåœ¨æ´—è¡£æœºé‡Œæ´—é‹çš„ï¼Œåœ¨å†°ç®±é‡Œæ”¾é¿å­•å¥—çš„ã€‚ã€‚äººç”ŸçœŸçš„å¾ˆç¥å¥‡ï¼Œå¯ä»¥é‡è§å„ç§å„æ ·çš„äººã€‚ </p><h2 style="text-align: center;">  <span style="color:#0000ff;">ç”œ</span></h2><p style="text-align: center;">  <strong>&#8212; æœ€å¹¸ç¦çš„å°±æ˜¯ç”œ</strong></p><p>2012å¹´2æœˆ2æ—¥ï¼Œè¿™ä¸ªæ—¥å­å¾ˆæ™®é€šï¼Œæˆ‘è®¤è¯†äº†å¥¹ã€‚å½“æ—¶æˆ‘äººåœ¨åˆè‚¥ï¼Œä¸€è…”è‹¦é—·æ— äººèƒ½è§£ï¼Œä¹Ÿæ˜¯å¥¹å¸®æˆ‘æ’è§£ï¼Œè·Ÿæˆ‘ä¸€èµ·å¬‰ç¬‘æ€’éª‚ï¼Œç»™æˆ‘æŒ‡æ˜æ–¹å‘ã€‚ </p><p>èŒ«èŒ«äººæµ·ä¸­ä¸¤äººä»ç›¸é‡ï¼Œç›¸è¯†ï¼Œç›¸çŸ¥ï¼Œç›¸äº²ç›¸çˆ±ï¼Œè¿™å°±æ˜¯ç¼˜åˆ†å§ã€‚å½“æˆ‘å‘ç°ä¸¤äººçš„æ‰‹æœºå·ç«Ÿç„¶åªå·®ä¸€ä½æ•°æ—¶ï¼Œå¿ƒé‡Œæœ‰ç§å¼‚æ ·çš„æ„Ÿè§‰ï¼Œæˆ‘è§‰å¾—ï¼Œå°±æ˜¯å¥¹äº†ã€‚ </p><p>å¥¹è¯´å¥¹è„¾æ°”å¾ˆæš´èºï¼Œæ€»æ˜¯åŠ¨ä¸åŠ¨å°±å‘ç«ï¼Œè¿™ç‚¹æˆ‘é¢†æ•™åˆ°äº†ã€‚ä¸è¿‡ï¼Œçˆ±å¥¹ï¼Œå°±å¯ä»¥åŒ…å®¹å¥¹çš„ç¼ºç‚¹ï¼Œå†µä¸”æˆ‘çš„è„¾æ°”å¥½ï¼Œä¹Ÿç®—æ˜¯äº’è¡¥å§ã€‚</p><p>å¯æ˜¯å¥¹ä¹Ÿæ¸©æŸ”ä¼¼æ°´å•Šï¼Œæˆ‘å°±å®Œå…¨æŠ—æ‹’ä¸äº†è¿™ä¸€ç‚¹ã€‚ </p><p>4æœˆ7å·æˆ‘å°±å‘å¥¹è¡¨ç™½äº†ã€‚è¿˜ç®—æ˜¯é¡ºåˆ©å§ï¼Œè™½ç„¶å¥¹åæ¥è€å‘æˆ‘æŠ±æ€¨æˆ‘æ²¡æ­£å¼åœ°è¿½è¿‡å¥¹ã€‚ã€‚ </p><p>é©¬ä¸Šåˆè¦2æœˆ2å·äº†ï¼Œä¸€å¹´è¿‡å¾—çœŸå¿«ã€‚åœ¨è¿™ä¸€å¹´é‡Œï¼Œæˆ‘ä»¬ä¸€èµ·æ¯«æ— å½¢è±¡åœ°å¤§ç¬‘ï¼Œä¸€èµ·ä¸ºä¼¤å¿ƒçš„äº‹æƒ…æŠ±å¤´ç—›å“­ï¼Œä¸ºäº†ä¸€ç‚¹å°å±äº‹åµæ¶ï¼Œä¸ºäº†ä¸€ç‚¹ä¸å…¬å¹³åˆä¼™æ€’éª‚ï¼Œè¿™éƒ½æ˜¯æœ€ç¾å¥½çš„å›å¿†ã€‚</p><p>æˆ‘ä»¬ä¸€èµ·å‡ºå»æ—…è¡Œï¼Œä¸€èµ·ä¸ºæœªæ¥åšæ‰“ç®—ï¼Œä¸€èµ·åšé¥­ï¼Œä¸€èµ·å­¦è·³èˆï¼Œä¸€èµ·å‡è‚¥ï¼ˆå‘ƒæŸäººçœ‹åˆ°ä¸è¦ææˆ‘ï¼‰ï¼Œè®¸è®¸å¤šå¤šçš„æ•…äº‹ï¼Œéƒ½æ˜¯æˆ‘ä»¬çš„è´¢å¯Œã€‚ </p><p>æˆ‘æ›¾ç»åœ¨å¥¹ä¸Šè¯¾çš„æ—¶å€™çªç„¶å‡ºç°åœ¨å¥¹çš„èº«åï¼Œåœ¨å„¿ç«¥èŠ‚çš„æ—¶å€™å¸¦ç€å…”æ–¯åŸºå»é©¾æ ¡æ¥å¥¹ï¼Œåœ¨ä¸ƒå¤•çš„æ—¶å€™ç»™å¥¹é€èŠ±ï¼Œåœ¨åœ£è¯å¤œçš„æ—¶å€™ç»™å¥¹å®šæƒ…çš„æˆ’æŒ‡&#8211;å¥½å§ï¼Œæˆ‘æ‰¿è®¤è¿™äº›éƒ½ä¸æµªæ¼«ï¼Œæˆ‘å¹¶ä¸æ˜¯ä¸ªä¼šåˆ¶é€ æµªæ¼«çš„äººï¼Œå¥¹ä¹Ÿè€è¯´&ldquo;å’±ä¿©å°±åƒè€å¤«è€å¦»ä¼¼çš„ï¼Œæœ‰æœ¨æœ‰&rdquo;ã€‚ </p><p>ä»Šå¹´ç”Ÿè¿‡ä¸¤åœºå¤§ç—…ï¼Œéƒ½æŠŠå¥¹å“åäº†ã€‚ç¬¬ä¸€åœºæ˜¯æ— ç¼˜æ•…åœ°æ‹‰è‚šå­ï¼ŒæŒç»­äº†å¿«ä¸€ä¸ªå‘¨ï¼Œæ•´ä¸ªäººéƒ½è™šè„±äº†ï¼Œå‘çƒ§ï¼Œæ²¡åŠ›æ°”åŠ¨ã€‚å¥¹åŠå¤œä¸¤ç‚¹è·‘å‡ºå»ä¹°é€€çƒ§è¯ï¼Œæˆ‘åœ¨åºŠä¸Šæ„ŸåŠ¨å¾—æ­»å»æ´»æ¥çš„ã€‚ç¬¬äºŒåœºæ˜¯éå¸¸ä¸¥é‡çš„æ„Ÿå†’ï¼Œæˆ‘ä»æ¥æ²¡æœ‰æ„Ÿå†’åˆ°è¿™ç§ç¨‹åº¦ï¼Œä»ä¸€å¼€å§‹çš„å—“å­ç–¼ï¼Œå’³å—½ï¼Œåˆ°åæ¥å‘•åï¼Œå‘çƒ§ï¼Œæ‹‰è‚šå­ï¼Œæµé¼»æ¶•ã€‚ã€‚åæ¥é€¢äººæˆ‘å°±è¯´ï¼Œè¿™æ¬¡å¯ç®—æ˜¯å½»åº•æ„Ÿå†’äº†ä¸€æ¬¡ã€‚å¥¹è¯·å‡åœ¨å®¶ç…§é¡¾æˆ‘ï¼Œæˆ‘å¾ˆæ„§ç–šï¼Œåœ¨å¥¹åšé¥­çš„æ—¶å€™ï¼ŒæŒªåˆ°å¨æˆ¿å»çœ‹å¥¹ï¼Œå¥¹è¯´&ldquo;æ¥è¿™å¹²ä»€ä¹ˆï¼Œèµ¶ç´§å›å»ï¼Œåˆ«å†»ç€ã€‚&rdquo;æˆ‘å‘å¥¹è¡¨è¾¾æˆ‘çš„æ­‰ç–šä¹‹æƒ…ï¼Œå¥¹å¾ˆå¹³æ·¡åœ°è¯´&ldquo;è¿™ä¸åº”è¯¥çš„ä¹ˆã€‚&rdquo;äººç”Ÿå¾—æ­¤å¥³ï¼Œæ— æ‰€æ±‚ä¹Ÿã€‚ </p><p>2012å¹´12æœˆ9å·ï¼Œæˆ‘ä»¬è®¢å©šäº†ã€‚10ä¸ªæœˆç›¸å¤„çš„æ—¶é—´ï¼Œæˆ‘è§‰å¾—è¿™å°±æ˜¯æˆ‘çš„äººç”Ÿä¼´ä¾£äº†ï¼Œå¯ä»¥å°†è‡ªå·±äº¤ä»˜äºˆå¥¹ï¼Œå¥¹ä¹Ÿå¯ä»¥æŠŠè‡ªå·±çš„æœªæ¥äº¤ç»™æˆ‘ã€‚æˆ‘ç›¸ä¿¡ï¼Œæœªæ¥åœ¨æˆ‘ä»¬è‡ªå·±çš„æ‰‹ä¸Šï¼ </p><h2 style="text-align: center;">  <span style="color:#008000;">è‹¦</span></h2><p style="text-align: center;">  <strong>&#8212; äººé—´æ­£é“æ˜¯æ²§æ¡‘</strong></p><p>ä½›è¯´ï¼šäººæœ‰å…«è‹¦ï¼Œç”Ÿè‹¦ï¼Œè€è‹¦ï¼Œç—…è‹¦ï¼Œæ­»è‹¦ï¼Œæ€¨æ†ä¼šè‹¦ï¼Œçˆ±åˆ«ç¦»è‹¦ï¼Œæ±‚ä¸å¾—è‹¦ï¼Œäº”è•´ç‚½ç››è‹¦ã€‚å”¯æœ‰èº«å¿ƒæ”¾ç©ºï¼Œæ–¹èƒ½äººç¦»éš¾ï¼Œéš¾ç¦»èº«ï¼Œä¸€åˆ‡ç¾æ®ƒåŒ–ä¸ºå°˜ã€‚ </p><p>æˆ‘è¿™ä¸ªäººï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§è€å¿ƒï¼Œè¦è¯´åƒè‹¦ï¼ŒçœŸåƒä¸äº†ã€‚å¯æ˜¯æœ‰äº›è‹¦ï¼Œå´æ˜¯èƒ½æ±è¿‡æ¥çš„ã€‚ </p><p>ä»å»å¹´å››æœˆä»½è¿›å…¥è¿™å®¶å…¬å¸ï¼Œå°±å¼€å§‹äº†ä¸€ç§å’Œä»¥å‰æˆªç„¶ä¸åŒçš„ç”Ÿæ´»ã€‚æ¯å¤©ä¸Šç­è¦æŒ¤å…¬äº¤ï¼ŒæŒ¤å®Œå…¬äº¤æŒ¤åœ°é“ï¼Œæ¯å¤©ä¸Šç­ä¸‹ç­éƒ½è¦æµªè´¹æ‰ä¸¤ä¸ªå°æ—¶ï¼Œè®©äººæ„Ÿå¹åŒ—äº¬äººæ€ä¹ˆè¿™ä¹ˆå¤šçš„åŒæ—¶ï¼Œä¹Ÿæš—æš—å«è‹¦ã€‚æˆ‘æœ‰è½»åº¦å¼ºè¿«ç—‡ï¼Œè®¨åŒåœ¨è½¦ä¸Šè¢«ä¸è®¤è¯†çš„äººç¢°ï¼Œæ‰€ä»¥æŒ¤è½¦çš„æ—¶å€™æ˜¯ä¸ªå¾ˆç—›è‹¦çš„è¿‡ç¨‹ã€‚å¸¸å¸¸å¾ˆå¥½çš„å¿ƒæƒ…ï¼Œå°±å› ä¸ºæŒ¤äº†ä¸ªå…¬äº¤æˆ–è€…åœ°é“ï¼Œé©¬ä¸Šå°±ä¹Œäº‘å¯†å¸ƒäº†ã€‚</p><p>ä½†çœ‹çœ‹å‘¨å›´çš„äººï¼Œå“ªä¸ªåˆä¸æ˜¯è¿™æ ·ï¼Œè¿˜æœ‰å¾ˆå¤šé€šå·çš„äººï¼Œå¤§è€æ—©å°±åè½¦ï¼Œåˆ°å›½è´¸ä¸Šç­ã€‚æ‰€ä»¥ï¼Œè¿™ç‚¹è‹¦ï¼Œåˆç®—å¾—äº†ä»€ä¹ˆï¼Œæˆ‘ä¹Ÿæ²¡èµ„æ ¼æŠ±æ€¨ä»€ä¹ˆï¼Œå¹´è½»äººï¼Œåƒç‚¹è‹¦æ€•ä»€ä¹ˆï¼Œç­‰åˆ°å¹´çºªå¤§äº†ï¼Œæ‰èƒ½æ‡‚å¾—ï¼Œè¿™äº›æ“è›‹çš„ç»éªŒæ‰å«äººç”Ÿã€‚</p><h2 style="text-align: center;">  <span style="color:#b22222;">è¾£</span></h2><p style="text-align: center;">  <strong>&#8212; ç§æˆ‘è¿™çˆ†è„¾æ°”</strong></p><p>å°çš„æ—¶å€™è¿˜è›®èƒ½åƒè¾£çš„ï¼Œé•¿å¤§äº†è¶Šå‘ä¸è¡Œäº†ã€‚å°±å¥½åƒæˆ‘å°æ—¶å€™è¢«éª‚æ²¡ä»€ä¹ˆå…³ç³»ï¼Œè„¸çš®åšï¼Œé•¿å¤§äº†è„¸çš®è–„ï¼Œè¢«éª‚äº†å°±æŒ‚ä¸ä½äº†ã€‚ </p><p>è¿™ä¸€å¹´è¢«å¾ˆå¤šä¸åŒçš„äººéª‚è¿‡ã€‚æœ‰çš„æ˜¯å–„æ„çš„ï¼Œæœ‰çš„æ˜¯æ¶æ„çš„ã€‚æ¶æ„çš„æˆ‘ä»æ¥éƒ½ä¸æ”¾åœ¨èº«ä¸Šï¼Œå› ä¸ºæˆ‘æ˜¯ä¸ä¼šå»å’¬é©¬è·¯ä¸Šå¯¹ç€æˆ‘ç‹‚å çš„ç‹—çš„ã€‚å–„æ„çš„éª‚æ¯æ¬¡éƒ½ä¼šéš¾è¿‡ï¼Œä½†è¿‡åéƒ½ä¼šæƒ³æ˜ç™½ï¼Œæˆ‘è¢«éª‚ä¹Ÿæ˜¯åº”è¯¥çš„ã€‚ </p><p>å¤§æŠµæ˜¯åœ¨1æœˆä»½ï¼Œå½“æ—¶åœ¨åˆè‚¥ï¼Œè·Ÿè€å¤–ä¸€èµ·å…±äº‹ã€‚æœ‰ä¸€æ¬¡å‡ºäº†ç‚¹é—®é¢˜ï¼Œæˆ‘æ²¡æœ‰è·Ÿä»–å•†é‡å°±æ“…è‡ªåšäº†å†³å®šï¼Œå½“æ—¶æˆ‘æƒ³ï¼Œè¿™ä¸ªå†³å®šå¹¶ä¸ä¼šå¯¹æˆ‘ä»¬é€ æˆä»€ä¹ˆå½±å“ã€‚æ²¡æƒ³åˆ°è€å¤–çŸ¥é“ä¹‹åé›·éœ†éœ‡æ€’ï¼Œå¤§å£°åœ°æ–¥è´£æˆ‘ï¼Œè¯´ä¸ºä»€ä¹ˆä¸å‘Šè¯‰ä»–ï¼Œä¸ºä»€ä¹ˆä¸é€šçŸ¥å…¶ä»–çš„é¢†å¯¼è®©ä»–ä»¬æ¥æ‹¿ä¸»æ„ã€‚æˆ‘çš„çˆ†è„¾æ°”ä¹Ÿç¬é—´ç‡ƒäº†ï¼Œè·Ÿä»–å¯¹å‘›èµ·æ¥ï¼Œåœºé¢ä¸€æ—¶å¤±æ§ã€‚åæ¥ä»–æŠ›ä¸‹ä¸€å¥&ldquo;ä½ è‡ªå·±æƒ³æƒ³å§&rdquo;å°±å›åŠå…¬å®¤äº†ã€‚æ€’ç«è¿‡åï¼Œæˆ‘é™ä¸‹å¿ƒæ¥ï¼Œæƒ³å½“æ—¶çš„ç¡®ä¸åº”è¯¥è‡ªå·±æ‹¿å†³å®šï¼Œæ¯•ç«Ÿä¸æ˜¯ä¸€å—é’±ä¸¤å—é’±çš„äº‹ï¼Œæ˜¯æ¯å¤©ä¸Šåƒä¸‡çš„äº¤æ˜“ï¼Œå¦‚æœæœ‰äº†å·®é”™ï¼Œäº‹æƒ…åªèƒ½è½åœ¨æˆ‘çš„å¤´ä¸Šï¼Œå› ä¸ºè¿™ä¸ªå†³å®šæ˜¯æˆ‘åšçš„ï¼Œæˆ‘æ‹…å½“ä¸èµ·ã€‚äº‹åè·Ÿè€å¤–é“æ­‰ï¼Œä»–æ¥å—äº†ï¼Œä¹Ÿæ²¡å†è¯´ä»€ä¹ˆï¼Œæ‰€å¹¸ä¹Ÿæ²¡å‘ç”Ÿä»€ä¹ˆäº‹æƒ…ã€‚ </p><p>åæ¥æœ‰ä¸€æ¬¡ã€‚é‚£ä¸€æ®µæ—¶é—´æˆ‘æ— æ‰€äº‹äº‹ï¼Œä¸Šé¢äº¤ç»™æˆ‘çš„äº‹æƒ…æˆ‘éƒ½ä¸åšï¼Œå› ä¸ºä»–ä»¬éƒ½è¿œåœ¨é™•è¥¿ã€‚æ¯å¤©éƒ½æ˜¯&ldquo;æ”¾ç¾Šæ··æ—¥å­&rdquo;çš„çŠ¶æ€ï¼Œä¸Šç­çœ‹å°è¯´ï¼Œä¸‹ç­ç©æ¸¸æˆï¼Œä¸äº¦ä¹ä¹ã€‚æœŸé—´æœ‰ä¸ªå…¶ä»–çš„é¢†å¯¼ä¼šæŒ‡ä½¿æˆ‘åšä¸€äº›è·‘è…¿çš„äº‹æƒ…ï¼Œæˆ‘ç¢äºä¸Šä¸‹çº§çš„å…³ç³»ï¼Œå°±ä¼šå¸®ä»–åšäº›äº‹æƒ…ã€‚åæ¥æˆ‘çš„ç›´å±é¢†å¯¼ä¸“ç¨‹æ‰“ç”µè¯è¿‡æ¥ï¼ŒåŠˆå¤´ç›–è„¸éª‚æˆ‘ä¸€é€šï¼Œè¯´&ldquo;æˆ‘æ‰æ˜¯ä½ çš„é¢†å¯¼ï¼Œåˆ«çš„é¢†å¯¼æŒ‡ä½¿æˆ‘çš„å‘˜å·¥ï¼Œæˆ‘çš„å‘˜å·¥å¯ä»¥ä¸å¹²ï¼ä¸‹æ¬¡å†è®©æˆ‘çŸ¥é“ä½ æ›¿ä»–è·‘è…¿ï¼Œä½ å°±å¹²è„†å»ä»–é‚£è¾¹å¾—äº†ï¼ç¨‹åºå‘˜ä¸æ˜¯ç”¨æ¥è·‘è…¿ä¹°çƒŸçš„ï¼&rdquo;æˆ‘å¿ƒé‡Œå¾ˆå§”å±ˆï¼Œå´ä¹Ÿåªèƒ½åæ€è‡ªå·±çš„ä¸æ˜¯ã€‚é¢†å¯¼ä¹Ÿæ˜¯æœ‰é€†é³çš„ï¼Œä»–çš„é€†é³å¤§æ¦‚å°±æ˜¯è¿™æ ·å§ã€‚ </p><p>å› ä¸ºè®¢å©šï¼Œå°±ç‰µæ‰¯åˆ°ä¹°æˆ¿ï¼Œç»“å©šï¼Œç”Ÿå­ã€‚æˆ‘å¿ƒé‡Œå‹åŠ›éª¤å¢ã€‚80åéƒ½æ˜¯æ‚²æ‘§çš„ä¸€ä»£ï¼Œä»–ä»¬ç”Ÿæ´»çš„å¹´ä»£ï¼Œæ‹¿ç€ä»€ä¹ˆéƒ½ä¹°ä¸èµ·çš„å·¥èµ„ï¼Œè¿‡ç€ä»€ä¹ˆéƒ½ä¹°ä¸èµ·çš„æ—¥å­ã€‚ä½†æ˜¯å¯¹æˆ‘æ¥è¯´ï¼Œå‹åŠ›æ˜¯é˜»ç¢ï¼Œä¹Ÿæ˜¯åŠ¨åŠ›ï¼Œåªæƒ³ç€é æ­»å·¥èµ„æ¯å¤©å¥½åƒæ‡’ä½œï¼Œä»€ä¹ˆæ—¶å€™æ˜¯ä¸ªå¤´ã€‚çˆ¸å¦ˆè‚¯å®šä¹Ÿå¸Œæœ›æˆ‘ä»¥åèƒ½æœ‰ä¸ªå¥½ç”Ÿæ´»ï¼Œä¸æ˜¯ä¹ˆã€‚</p><h2 style="text-align: center;">  ç»­</h2><p style="text-align: center;">  <strong>&#8212; äººç”Ÿè¿˜è¦ç»§ç»­</strong></p><p>ä»åŠä¸ªæœˆå‰å°±å¼€å§‹è§„åˆ’è¿™ç¯‡æ–‡ç« ï¼Œåæ¥å‘ç°è¿˜æ˜¯æ²¡æœ‰æŒ‰ç…§é¢„æƒ³çš„è·¯å­ç å­—ã€‚ </p><p>é…¸ç”œè‹¦è¾£å†™å®Œï¼Œæ„Ÿè§‰åˆæ˜ç™½äº†å¾ˆå¤šä¸œè¥¿ã€‚ </p><p>ä¸Šé«˜ä¸­çš„æ—¶å€™ï¼Œæˆ‘å†™è¿‡ä¸€å¥è¯ï¼šäººç”Ÿå°±æ˜¯ä¸ªèˆå°ï¼Œå„ç§å„æ ·çš„å‰§éƒ½åœ¨ä¸Šæ¼”ç€ã€‚å¦‚æœæ²¡æœ‰å‰§ç›®ï¼Œé‚£å°±æ²¡äººçœ‹äº†ã€‚</p><p>å¾ˆå¯¹ï¼Œæ˜¯ä¸ï¼Ÿå˜¿å˜¿ã€‚ </p><p>è·¯è¿˜è¦ç»§ç»­èµ°ï¼Œç›é›…äººè¯´å¥½çš„ä¸–ç•Œæœ«æ—¥å¹¶æ²¡æœ‰å¦‚çº¦è€Œè‡³ï¼Œ2013è¿ˆç€è½»æ¾çš„è„šæ­¥å‘æˆ‘ä»¬èµ°æ¥ã€‚æˆ‘ä»¬ä¸èƒ½åœä¸‹ï¼Œæ›´ä¸èƒ½æ”¾å¼ƒï¼Œä¸–ç•Œå¤šä¹ˆç²¾å½©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> å¹´ç»ˆæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bash ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼</title>
      <link href="/2013-01-22/bash-condition-expressions/"/>
      <url>/2013-01-22/bash-condition-expressions/</url>
      
        <content type="html"><![CDATA[<p>æ¯ç§è¯­è¨€éƒ½ä¼šæœ‰æ¡ä»¶è¡¨è¾¾å¼ï¼Œåœ¨Linuxä¸‹çš„Bashä¸­ä¹Ÿä¸ä¾‹å¤–ã€‚</p><p>è¿™ç¯‡æ–‡ç« æ¥è¯¦ç»†è®²ä¸€ä¸‹bashä¸­çš„æ¡ä»¶è¡¨è¾¾å¼çš„è¿ç”¨ã€‚</p><span id="more"></span><p>åœ¨Bashä¸­ï¼ŒåŸºæœ¬å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä½¿ç”¨testå‘½ä»¤ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨â€[]â€è¡¨è¾¾å¼ã€‚è¿™ä¸¤ç§æ–¹å¼çš„åŠŸèƒ½æ˜¯ç­‰ä»·çš„ã€‚</p><p>åœ¨Bashä¸­ï¼Œè¦æ³¨æ„ï¼Œä¸è¦æŠŠå†™å…¶ä»–è¯­è¨€çš„ä¹ æƒ¯å¸¦åˆ°è¿™å„¿æ¥ï¼Œå› ä¸ºBashæ˜¯é€šè¿‡è§£é‡Šæ¥ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ï¼Œä¸éœ€è¦ç¼–è¯‘è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸ºäº†è§„é¿ä¸€äº›å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œåœ¨â€[]â€ä¸­é—´ï¼Œæ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»ç”¨ç©ºæ ¼éš”å¼€ã€‚æ¯”å¦‚ï¼š</p><pre><code class="bash">[ -e /home/tom ][ $num -eq 2 ][ &quot;$string&quot; = &quot;You are a genius!&quot; ]    // æ³¨æ„ï¼Œç­‰å·ä¸¤è¾¹é¡»å‘æœ‰ç©ºæ ¼[ &quot;$p&quot; != &quot;sss&quot; ] || [ &quot;$p&quot; != &quot;ttt&quot; ]    // åŒæ ·åœ°ï¼Œ&quot;!=&quot;ä¸¤è¾¹ä¹Ÿå¿…é¡»æœ‰ç©ºæ ¼</code></pre><p>å¦‚æœå†™æˆè¿™æ ·ï¼š</p><pre><code class="bash">[ -e /home/tom][$num -eq 2][ &quot;$string&quot;=&quot;You are a genius!&quot;]  // [ ]è¿ç®—ç¬¦å°†&quot;$string&quot;=&quot;You are a genius!&quot;è§†ä¸ºä¸€ä¸ªæ•´ä½“äº†[&quot;$p&quot;!=&quot;sss&quot;]||[&quot;$p&quot;!=&quot;ttt&quot;]</code></pre><p>æ˜¯æ— æ³•æ­£ç¡®æ‰§è¡Œçš„ã€‚</p><p>ä¸‹é¢çœ‹å‡ ä¸ªè¿è¡Œç¬¦ã€‚</p><h3 id="æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦"></a>æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦</h3><p>[ -e filename ]  å¦‚æœfilenameå­˜åœ¨,åˆ™ä¸ºçœŸ     </p><pre><code class="bash">[ -e /var/log/syslog ]    ortest -e /var/log/syslog</code></pre><p>[ -d filename ]  å¦‚æœfilenameä¸ºç›®å½•,åˆ™ä¸ºçœŸ   </p><pre><code class="bash">[ -d /tmp/mydir ]    ortest -d /tmp/mydir</code></pre><p>[ -f filename ]   å¦‚æœfilenameä¸ºå¸¸è§„æ–‡ä»¶,åˆ™ä¸ºçœŸ    </p><pre><code class="bash">[ -f /usr/bin/httpd ]    ortest -f /usr/bin/httpd</code></pre><p>[ -L filename ]  å¦‚æœfilenameä¸ºç¬¦å·é“¾æ¥,åˆ™ä¸ºçœŸ   </p><pre><code class="bash">[ -L /usr/bin/apache2 ]    ortest -L /usr/bin/apache2</code></pre><p>[ -r filename ]   å¦‚æœfilenameå¯è¯»,åˆ™ä¸ºçœŸ        </p><pre><code class="bash">[ -r /var/log/syslog ]    ortest -r /var/log/syslog</code></pre><p>[ -w filename ]  å¦‚æœfilenameå¯å†™,åˆ™ä¸ºçœŸ       </p><pre><code class="bash">[ -w /var/haha.txt ]    ortest -w /var/haha.txt</code></pre><p>[ -x filename ]  å¦‚æœfilenameå¯æ‰§è¡Œ,åˆ™ä¸ºçœŸ     </p><pre><code class="bash">[ -x /etc/init.d/mysqld ]    ortest -x /etc/init.d/mysqld</code></pre><p>[ filename1 -nt filename2 ] å¦‚æœfilename1æ¯”filename2æ–°,åˆ™ä¸ºçœŸ  </p><pre><code class="bash">[ /tmp/install/etc/services -nt /etc/services ]   // newer than    ortest /tmp/install/etc/services -nt /etc/services</code></pre><p>[ filename1 -ot filename2 ] å¦‚æœfilename1æ¯”filename2æ—§,åˆ™ä¸ºçœŸ  </p><pre><code class="bash">[ /home/tom/test -ot /home/tom/test1 ]    // older than    ortest /home/tom/test -ot /home/tom/test1</code></pre><p>[ filename1 -ef filename2 ] åˆ¤æ–­filename1ä¸filename2æ˜¯å¦ä¸ºåŒä¸€æ–‡ä»¶ï¼Œå¯ç”¨åœ¨hard linkçš„åˆ¤å®šä¸Šã€‚ä¸»è¦æ„ä¹‰åœ¨äºåˆ¤å®šä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦å‡æŒ‡å‘åŒä¸€ä¸ªinodeã€‚</p><pre><code class="bash">[ /usr/bin/apache2 -ef /etc/bin/apache2 ]    // equal file    ortest /usr/bin/apache2 -ef /etc/bin/apache2</code></pre><h3 id="å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦"></a>å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦</h3><p>(è¯·æ³¨æ„å¼•å·çš„ä½¿ç”¨ï¼Œè¿™æ˜¯é˜²æ­¢ç©ºæ ¼æ‰°ä¹±ä»£ç çš„å¥½æ–¹æ³•)</p><p>[ -z string ] å¦‚æœstringé•¿åº¦ä¸ºé›¶,åˆ™ä¸ºçœŸ  </p><pre><code class="bash">[ -z &quot;$myvar&quot; ]    ortest -z &quot;$myvar&quot;</code></pre><p>[ -n string ] å¦‚æœstringé•¿åº¦éé›¶,åˆ™ä¸ºçœŸ  </p><pre><code class="bash">[ -n &quot;$myvar&quot; ]  // -nä¹Ÿå¯ä»¥çœç•¥    ortest -n &quot;$myvar&quot;</code></pre><p>[ string1  = string2 ] å¦‚æœstring1ä¸string2ç›¸åŒ,åˆ™ä¸ºçœŸ  </p><pre><code class="bash">[ &quot;$myvar&quot; = &quot;one two three&quot; ]    // &quot;==&quot; ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåœ¨bashä¸­ï¼Œè¿›è¡Œåˆ¤æ–­æ—¶ï¼Œ&quot;=&quot; å’Œ &quot;==&quot; çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œ è¿™ä¸€ç‚¹è·Ÿç¼–ç¨‹è¯­è¨€ä¸­ä¸å¤ªç›¸åŒ                                  // ä½†ä¸ºäº†åŒºåˆ«å¼€æ¥ï¼Œè¿˜æ˜¯å»ºè®®ç”¨ &quot;==&quot;    ortest &quot;$myvar&quot; = &quot;one two three&quot;</code></pre><p>[ string1 != string2 ] å¦‚æœstring1ä¸string2ä¸åŒ,åˆ™ä¸ºçœŸ  </p><pre><code class="bash">[ &quot;$myvar&quot; != &quot;one two three&quot; ]    ortest &quot;$myvar&quot; != &quot;one two three&quot;</code></pre><h3 id="ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦"></a>ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦</h3><p>[ num1 -eq num2 ]  ç­‰äº</p><pre><code class="bash">[ $mynum -eq 3 ]    // equal    ortest $mynum -eq 3</code></pre><p>[ num1 -ne num2 ]  ä¸ç­‰äº</p><pre><code class="bash">[ $mynum -ne 3 ]    // not equal    ortest $mynum -ne 3</code></pre><p>[ num1 -lt num2 ]  å°äº</p><pre><code class="bash">[ $mynum -lt 3 ]    // less than    ortest $mynum -lt 3</code></pre><p>[ num1 -le num2 ]  å°äºæˆ–ç­‰äº</p><pre><code class="bash">[ $mynum -le 3 ]    // less or equal    ortest mynum -le 3</code></pre><p>[ num1 -gt num2 ]  å¤§äº</p><pre><code class="bash">[ $mynum -gt 3 ]    // greater than    ortest $mynum -gt 3</code></pre><p>[ num1 -ge num2 ]  å¤§äºæˆ–ç­‰äº</p><pre><code class="bash">[ $mynum -ge 3 ]    // greater or equal    ortest $mynum -ge 3</code></pre><h3 id="å¤šé‡æ¡ä»¶åˆ¤å®š"><a href="#å¤šé‡æ¡ä»¶åˆ¤å®š" class="headerlink" title="å¤šé‡æ¡ä»¶åˆ¤å®š"></a>å¤šé‡æ¡ä»¶åˆ¤å®š</h3><p>-a ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æˆç«‹ï¼Œåˆ™ä¸ºçœŸ</p><pre><code class="bash">[ -r /home/tom/test -a -x /home/tom/test ]    // å³testæ–‡ä»¶åŒæ—¶å…·æœ‰rxæƒé™æ—¶ï¼Œæ‰è¿”å›çœŸ    ortest -r /home/tom/test -a -x /home/tom/test </code></pre><p>-o ä»»æ„ä¸€ä¸ªæ¡ä»¶æˆç«‹ï¼Œåˆ™ä¸ºçœŸ</p><pre><code class="bash">[ -r /home/tom/test -o -x /home/tom/test ]    // å³testæ–‡ä»¶å…·æœ‰ræˆ–xæƒé™æ—¶ï¼Œéƒ½è¿”å›çœŸ    ortest -r /home/tom/test -o -x /home/tom/test </code></pre><p>ï¼ æ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ä¸ºçœŸ</p><pre><code class="bash">[ ! -x /home/tom/test ]    // å³testæ–‡ä»¶åŒæ—¶ä¸å…·æœ‰xæƒé™æ—¶ï¼Œæ‰è¿”å›çœŸ    ortest ! -x /home/tom/test </code></pre>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼±è€…åªä¼šæŠ±æ€¨ï¼Œå¼ºè€…æ€»ä¼šæ”¹å˜</title>
      <link href="/2013-01-08/dont-complain/"/>
      <url>/2013-01-08/dont-complain/</url>
      
        <content type="html"><![CDATA[<p>ç°åœ¨ï¼Œæ¯å¤©ä¸­åˆï¼Œåƒé¥­çš„æ—¶å€™ï¼Œæˆ‘è·Ÿä¸‰ä¸ªåŒäº‹æ˜¯åœ¨ä¸€èµ·çš„ã€‚è€Œå™©æ¢¦ä¹Ÿå°±å¼€å§‹äº†ã€‚</p><span id="more"></span><p>æˆ‘ä»¬å››ä¸ªäººï¼Œæˆ‘æ˜¯å±±ä¸œçš„ï¼Œä¸¤ä¸ªæ¹–åŒ—çš„ï¼Œä¸€ä¸ªæ¹–å—çš„ã€‚æ¹–åŒ—çš„ä¸¤ä¸ªæš‚ä¸”å‘½åä¸º J å›å’Œ H å›ï¼Œæ¹–å—çš„å‘½åä¸º L å›ã€‚</p><p>Jå›æ˜¯æ¯”è¾ƒæ­£å¸¸çš„é‚£ç§äººï¼Œå†œæ‘å‡ºèº«ï¼Œæœ‰å››ä¸ªå§å§ã€‚å¯¹å„ç§äº‹æƒ…éƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œä¸éšå¤§æµï¼Œå–œæ¬¢å„ç§å„æ ·çš„æ±½è½¦ï¼Œè€Œä¸”æå…¶æ¸…æ¥šæ¯ç§é…ç½®çš„ä»·æ ¼ï¼Œå–œå¥½å†›äº‹ï¼Œå–œå¥½ç»æµï¼Œå£é½¿æœ‰ç‚¹ä¸æ¸…æ¥šï¼Œè„¸ä¸Šçš„é’æ˜¥ç—˜ä¹Ÿæ— è§†è¿™å®¶ä¼™å·²ç» 23 äº†ï¼Œå™Œå™Œåœ°å¾€å¤–é•¿ã€‚æ€»ä¹‹ï¼Œæ˜¯ä¸ªå¾ˆå¥½ç›¸å¤„çš„äººã€‚</p><p>Lå›æ˜¯ä¸ªç‰¹åˆ«å–œæ¬¢ç§€ä¸‹é™çš„äººã€‚æ ‡å‡† 90 åï¼Œè‡ªä»ä»–åŠ å…¥äº†æˆ‘ä»¬ï¼Œæˆ‘ä»¬éƒ½æ„Ÿè§‰ï¼Œæˆ‘ä»¬å°ç»„çš„å¹³å‡æ™ºå•†è¢«æ‹‰åˆ°äº†ä¸€ä¸ªè‚‰çœ¼ä¸å¯è§çš„æ°´å¹³ã€‚å¹³æ—¶æˆ‘ä»¬ä»¨éƒ½å–œæ¬¢è°ƒæˆä»–ï¼Œä»ä»–èº«ä¸Šçš„å›´å·¾ï¼Œåˆ°ä»–æ·±ä¸å¯æµ‹çš„æ™ºå•†ã€‚æˆ‘æ„Ÿè§‰ï¼Œæ¯ä¸€ä¸ªå››äººç»„é‡Œï¼Œæ€»éœ€è¦è¿™ä¹ˆä¸€ä¸ªäººï¼Œä¹Ÿæ€»ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªäººï¼Œè¿™æ ·åœ¨è·¯ä¸Šï¼Œä¸è‡³äºå†·åœºã€‚</p><p>Hå›æ˜¯ä¸ªè®©æˆ‘ç‰¹åˆ«æœ‰æ„Ÿè§¦çš„äººï¼Œçœ‹åˆ°ä»–ï¼Œæˆ‘å°±çŸ¥é“ï¼Œæˆ‘ä»¥åä¸èƒ½åšå“ªäº›äº‹äº†ã€‚å¹¶ä¸æ˜¯è¯´ä»–å¤šä¹ˆå¤šä¹ˆä¸åƒæ ·ï¼Œè€Œæ˜¯ï¼Œåœ¨å¤–äººé¢å‰ï¼Œåƒè¿™æ ·è¡¨ç°ï¼Œåªèƒ½è¢«åˆ«äººæ— è§†ï¼Œå¹¶ä¸”åœ¨å¿ƒé‡Œéª‚ä¸€å¥ã€å‚»é€¼ã€ã€‚</p><p>ä»–çš„æŠ€èƒ½å°±æ˜¯ã€æŠ±æ€¨ã€ï¼Œå¯¹ä»»ä½•ä¸€ç‚¹å°äº‹éƒ½èƒ½æŠ±æ€¨ä¸ªæ²¡å®Œæ²¡äº†ï¼Œå•æ‰€æ²¡çº¸äº†ï¼Œæ˜¨å¤©åˆåŠ ç­äº†ï¼Œå‘ç¥¨æŠ¥äº†æ²¡ç»™é’±ï¼Œç°åœ¨ç»“å©šçœŸ TM æ—©ï¼Œç”µæ¢¯çœŸå¤Ÿæ…¢çš„ç­‰ç­‰ç­‰ç­‰ï¼Œæ¯å¤©éƒ½ä¼šå¬åˆ°ä»–çš„æŠ±æ€¨ã€‚<br>ä»–çš„å¦ä¸€ä¸ªæŠ€èƒ½æ˜¯ã€å­¤åƒ»ã€ï¼Œå½“å¤§å®¶éƒ½èŠå¤©çš„æ—¶å€™ï¼Œä»–å°±ç‹¬è‡ªè£…é…·ï¼Œç”šè‡³èŠäº†ä¸€ä¼šï¼Œå‘ç°ä»–å±…ç„¶ä¸è§äº†ã€‚å›æ¥é—®ã€å»å“ªäº†ã€ï¼Œä¹Ÿä¸å±å£°ï¼Œçœ‹èµ·æ¥åƒä¸ªæ€¨å¦‡ï¼Œåœ¨æ€¨æˆ‘ä»¬æŠŠä»–æŠ›å¼ƒäº†ã€‚<br>ç¬¬ä¸‰ä¸ªæŠ€èƒ½æ˜¯ã€å£åˆã€ï¼Œæ— è®ºä¸­åˆåƒä»€ä¹ˆï¼Œç»å¯¹èƒ½å¬åˆ°ä»–è¯´ã€ä»€ä¹ˆä¸œè¥¿ï¼Œéš¾åƒæ­»äº†ã€ï¼Œç„¶ååƒå¾—å¹²å¹²å‡€å‡€ã€‚æˆ–è€…åœ¨è‡ªå·±çš„èœæ¯”è¾ƒå•ä¸€æ—¶ï¼Œå¤¹åˆ«äººä¸€ç­·å­ï¼Œç„¶åçœ‰å¤´ç´§çš±ï¼Œè¯´ã€è¿™ç§ä¸œè¥¿ä½ ä¹Ÿåƒå¾—ä¸‹ã€ï¼Œæå¾—åˆ«äººå…¨æ— èƒƒå£ã€‚</p><p>ä½†å› ä¸ºæˆ‘æ˜¯åæ¥äººï¼Œç®—æ˜¯ã€æ–°äººã€ï¼Œè™½ç„¶å¹´é¾„æ˜¯æœ€å¤§çš„ï¼ˆä¸€ä¸ª 90 åï¼Œä¸€ä¸ªä¸€è„šè¸åœ¨ 90 é—¨æ§›ä¸Šï¼Œä¸€ä¸ª 89 å¹´çš„ï¼‰ï¼Œä½†ä¹Ÿæ²¡èµ„æ ¼è¯´åˆ«äººä»€ä¹ˆã€‚å…¶å®æˆ‘ä¹Ÿä¸æƒ³å¯¹ä»–è¯´ä»€ä¹ˆï¼Œæ²¡å¿…è¦å•Šã€‚</p><p>ä»¥å‰æˆ‘ä¹Ÿæ˜¯ä¸ªå¾ˆèƒ½æŠ±æ€¨çš„äººï¼Œå¤§äº‹å°äº‹éƒ½è¦æŠ±æ€¨ä¸€ç•ªï¼Œå¯èƒ½ä¹Ÿçƒ¦åˆ°äº†æˆ‘çš„ä¸€äº›æœ‹å‹ï¼Œä»–ä»¬å¯èƒ½ä¹Ÿæœ‰è·Ÿæˆ‘ç°åœ¨ä¸€æ ·çš„æƒ³æ³•ã€‚ä¸è¿‡åæ¥å‘ç°ï¼ŒæŠ±æ€¨å…¶å®ä»€ä¹ˆä¹Ÿæ”¹å˜ä¸äº†ï¼Œå®‰å®‰å¿ƒå¿ƒåƒä½ çš„é¥­ï¼ŒæˆåŠŸæ¶ˆåŒ–ï¼ŒæˆåŠŸæ’æ³„ï¼Œè¿™å°±ç®—æ˜¯åŠŸå¾·åœ†æ»¡äº†ï¼ŒæŠ±æ€¨æœ‰ä»€ä¹ˆç”¨å‘¢ã€‚</p><p>å¿˜è®°åœ¨å“ªçœ‹åˆ°è¿™å¥è¯äº†ï¼Œã€å¼±è€…æŠ±æ€¨å‘½è¿çš„æ— æƒ…, å¼ºè€…æ‰¼ä½å‘½è¿çš„å’½å–‰ã€ã€‚çš„ç¡®æ˜¯è¿™æ ·ï¼ŒæŠ±æ€¨ä¸æ˜¯ä¸å¯ä»¥ï¼Œå¶å°”æŠ±æ€¨ä¸€ä¸‹å¹¶ä¸ä¼šè¡¨ç¤ºä½ è¿™ä¸ªäººæ˜¯ä¸ªåºŸç‰©ï¼Œå› ä¸ºæ²¡æœ‰å“ªä¸ªäººçš„å¿ƒæ€§æ˜¯å®Œç¾çš„ã€‚ä½†æ˜¯å¤©å¤©æŠ±æ€¨ï¼Œå½“æŠ±æ€¨æˆä¸ºä¸€ç§ä¹ æƒ¯ï¼Œå°±ä¼šè¢«å‘½è¿æŠ›å¼ƒã€‚</p><p>æœ‰æ—¶ï¼ŒæŠ±æ€¨çš„æ„Ÿè§‰æŒºä¸é”™ï¼Œå› ä¸ºæˆ‘ä»¬æ€»å–œæ¬¢åšã€å¯¹ã€çš„ä¸€æ–¹ã€‚æˆ‘ä»¬æ€»æ˜¯ä¸ºè‡ªå·±è¾©è§£ï¼šã€æ˜¯è¿™ä¸ªäººä¾µçŠ¯äº†æˆ‘ã€ã€ã€æ˜¯é‚£ä¸ªå®¶ä¼™çš„é”™ã€ï¼Œæ®Šä¸çŸ¥æˆ‘ä»¬æ­£ä¸€æ­¥æ­¥æ»‘å…¥æŠ±æ€¨çš„æ³¥æ½­ï¼Œæ­¢æ­¥ä¸å‰ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥é€‰æ‹©ï¼šæ˜¯é™·å…¥è‡ªä»¥ä¸ºæ˜¯çš„æ³¥æ½­ï¼Œè¿˜æ˜¯æ”¾ä¸‹æŠ±æ€¨ç»§ç»­ä¸Šè·¯ï¼Ÿåˆ«å¿˜äº†è‡ªå·±æ´»å¾—æ»‹æ¶¦æ‰æ˜¯å¯¹ä»–äººæœ€å¥½çš„æŠ¥å¤ã€‚</p><p>è¯´çœŸçš„ï¼ŒåŸ‹æ€¨ä¸–ç•Œå¯ä»¥ä¸Šç˜¾ã€‚ä½†åªè¦ä½ æ„¿æ„ï¼Œä½ å°±èƒ½åœæ­¢æŠ±æ€¨çš„æ¸¸æˆã€‚æœ‰æ—¶æˆ‘ä»¬æ²¡æ³•æ”¹æ‰ä¹ æƒ¯ï¼Œå› ä¸ºæˆ‘ä»¬æƒ§æ€•æ”¹å˜ã€‚ä½†è¯·ç›¸ä¿¡åªè¦ä½ æŠ›å¼ƒåŸ‹æ€¨çš„ä¹ æƒ¯ï¼Œä¸€ä¸ªå´­æ–°çš„ä½ ä¾¿è¯ç”Ÿäº†ã€‚ç­”æ¡ˆå’Œæ–¹å‘å°±åœ¨ä½ æ‹¨å¼€äº‘é›¾çš„é‚£ä¸€åˆ¹é‚£ä¾¿å¯ä»¥æ¸…æ¥šçœ‹åˆ°ã€‚</p><p>ç°åœ¨ç¤¾ä¼šå„ç§ç«äº‰æ¿€çƒˆä¸¥é…·ã€å„ç§ææƒ§çš„è”“å»¶çº ç»“ï¼Œè®©æˆ‘ä»¬å˜å¾—å¦‚åˆºçŒ¬èˆ¬ã€å‰‘æ°”åè¶³ã€ï¼šå¯¹å‘¨é­çš„ä¸€åˆ‡æŠ±æ€¨ä¸æ­¢ï¼Œå´æå°‘é™ä¸‹å¿ƒæ¥åçœè‡ªå·±ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´å°±åº”å°†ä¸€åˆ‡è´£ä»»éƒ½æ½ç»™è‡ªå·±ï¼Œè€Œæ˜¯åº”è¯¥æ¥å—ç°å®ï¼Œä»ç»å†ä¸­æˆé•¿ï¼ŒåŸè°…è‡ªå·±ï¼Œä»å¤±è´¥ä¸­é‡æ–°æŒ¯ä½œï¼Œå¹¶åˆ¶å®šä¸‹ä¸€æ­¥çš„è®¡åˆ’ã€‚ä¸ç®¡æ€æ ·ï¼Œæ—¶é—´ä¸ç­‰äººã€‚</p><p>å›½å¤–éƒ½æœ‰ä¸“å®¶ç ”ç©¶å‡ºï¼Œå¬å¤šäº†æŠ±æ€¨ï¼Œä¼šæŸä¼¤æˆ‘ä»¬è‹±æ˜ç¥æ­¦çš„å¤§è„‘çš„ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬è¿œç¦»æŠ±æ€¨å§ã€‚</p><p>æœ‰ä¸€åˆ™å¤è€çš„å¯“è¨€ï¼Œæˆ–è®¸å¯ä»¥ç»™æˆ‘ä»¬ä¸€äº›å¯ç¤ºã€‚</p><blockquote><p>æœ‰ä¸€ä¸ªå¹´è½»çš„å†œå¤«ï¼Œåˆ’ç€å°èˆ¹ï¼Œç»™å¦ä¸€ä¸ªæ‘å­çš„å±…æ°‘è¿é€è‡ªå®¶çš„å†œäº§å“ã€‚é‚£å¤©çš„å¤©æ°”é…·çƒ­éš¾è€ï¼Œå†œå¤«æ±—æµæµƒèƒŒï¼Œè‹¦ä¸å ªè¨€ã€‚ä»–å¿ƒæ€¥ç«ç‡åœ°åˆ’ç€å°èˆ¹ï¼Œå¸Œæœ›èµ¶ç´§å®Œæˆè¿é€ä»»åŠ¡ï¼Œä»¥ä¾¿åœ¨å¤©é»‘ä¹‹å‰èƒ½è¿”å›å®¶ä¸­ã€‚çªç„¶ï¼Œå†œå¤«å‘ç°ï¼Œå‰é¢å¦å¤–ä¸€åªå°èˆ¹ï¼Œæ²¿æ²³è€Œä¸‹ï¼Œè¿é¢å‘è‡ªå·±å¿«é€Ÿé©¶æ¥ã€‚çœ¼è§ç€ä¸¤åªèˆ¹å°±è¦æ’ä¸Šäº†ï¼Œä½†é‚£åªèˆ¹å¹¶æ²¡æœ‰ä¸æ¯«é¿è®©çš„æ„æ€ï¼Œä¼¼ä¹æ˜¯æœ‰æ„è¦æ’ç¿»å†œå¤«çš„å°èˆ¹ã€‚</p><p>ã€è®©å¼€ï¼Œå¿«ç‚¹è®©å¼€ï¼ä½ è¿™ä¸ªç™½ç—´ï¼ã€å†œå¤«å¤§å£°åœ°å‘å¯¹é¢çš„èˆ¹å¼å«é“ã€‚ã€å†ä¸è®©å¼€ä½ å°±è¦æ’ä¸Šæˆ‘äº†ï¼ã€ä½†å†œå¤«çš„å¼å«å®Œå…¨æ²¡ç”¨ï¼Œå°½ç®¡å†œå¤«æ‰‹å¿™è„šä¹±åœ°ä¼å›¾è®©å¼€æ°´é“ï¼Œä½†ä¸ºæ—¶å·²æ™šï¼Œé‚£åªèˆ¹è¿˜æ˜¯é‡é‡åœ°æ’ä¸Šäº†ä»–ã€‚å†œå¤«è¢«æ¿€æ€’äº†ï¼Œä»–å‰å£°æ–¥è´£é“ï¼šã€ä½ ä¼šä¸ä¼šé©¾èˆ¹ï¼Œè¿™ä¹ˆå®½çš„æ²³é¢ï¼Œä½ ç«Ÿç„¶æ’åˆ°äº†æˆ‘çš„èˆ¹ä¸Šï¼Ÿï¼ã€å½“å†œå¤«æ€’ç›®å®¡è§†å¯¹æ–¹å°èˆ¹æ—¶ï¼Œä»–åƒæƒŠåœ°å‘ç°ï¼Œå°èˆ¹ä¸Šç©ºæ— ä¸€äººã€‚å¬ä»–å¤§å‘¼å°å«ï¼Œå‰è¨€æ–¥éª‚çš„åªæ˜¯ä¸€åªæŒ£è„±äº†ç»³ç´¢ã€é¡ºæ²³æ¼‚æµçš„ç©ºèˆ¹ã€‚</p></blockquote><p>å¥½ä¹…æ²¡ç å­—äº†ï¼Œè¯­ç«­è¯ç©·äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å£æ°´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
            <tag> äººç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20äº¿åƒç´ çš„å…¨æ™¯ç…§ç‰‡ &amp;#8211; å†²å‡»å‰å°¼æ–¯ä¸–ç•Œçºªå½•ï¼</title>
      <link href="/2012-12-26//"/>
      <url>/2012-12-26//</url>
      
        <content type="html"><![CDATA[<p>æ®å›½å¤–åª’ä½“æŠ¥é“ï¼Œè¿‘æ—¥ç”±åå«David Breashersæ‰€å¸¦é¢†çš„GlacierWorksåœ°è´¨ç ”ç©¶å°ç»„å…¬å¸ƒäº†<strong>ä¸€å¹…20äº¿åƒç´ çš„ç ç©†æœ—ç›å³°æ˜†å¸ƒå†°å·æ˜¥å­£å…¨æ™¯ç…§ç‰‡</strong>ï¼Œæ´›å­å³°å’ŒåŠªå­å³°ä¸¤åº§é«˜åŸé›ªå±±æ›¼å¦™çš„èº«å§¿ä¹Ÿåœ¨ç…§ç‰‡ä¸­å¾—ä»¥å±•ç°ã€‚</p><p>åŒæ—¶ï¼Œå½“äººä»¬æ”¾å¤§è§‚çœ‹ç…§ç‰‡æ—¶ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°å†°å·æ²³åºŠä¸­æ˜Ÿç½—å¯†å¸ƒçš„å¸ç¯·ä»¥åŠæ•´ä¸ªå†°å·çš„æ‰€æœ‰ç»†èŠ‚ï¼Œè¿™ç€å®è®©é‚£äº›å¯¹ç¥ç§˜å†°å·å……æ»¡å‘å¾€ï¼Œè€Œç”±æ— æ³•äº²è‡ªå‰å¾€çš„äººä»¬è¿‡è¶³äº†çœ¼ç˜¾ã€‚</p><p>è¯¥å›¢é˜Ÿåœ¨å…¶å®˜æ–¹Facebooké¡µé¢ä¸­å†™é“ï¼š&ldquo;æˆ‘è¯•å›¾é€šè¿‡è¿™ç§æ–¹å¼è®©äººä»¬èƒ½å¤Ÿè¿‘è·ç¦»çœ‹åˆ°è¿™äº›æç²¾ç»†çš„å†°å·æ™¯è‰²ã€‚&rdquo;<br>ä»–è¡¨ç¤ºï¼Œ&ldquo;æˆ‘ä»¬çš„å›¢é˜Ÿç›®å‰æ­£åœ¨ä¸å¾®è½¯ä»¥åŠè‹±å›½çš‡å®¶åœ°ç†å­¦ä¼šå±•å¼€åˆä½œï¼Œæœªæ¥è¯¥ç»„ç»‡å°†è¿›è¡Œæ›´å¤šæœ‰å…³æ˜†å¸ƒå†°å·è¯»å–è‡ªç„¶æ°”å€™åœ°è²Œæ¼”å˜çš„ç§‘è€ƒæ´»åŠ¨ã€‚&rdquo;  </p><span id="more"></span><p>ä»¥ä¸‹æ˜¯æ­¤æ¬¡æ‰€å…¬å¸ƒçš„å…¨æ™¯ç…§ç‰‡çš„ç½‘é¡µæˆªå›¾ï¼Œæƒ³æŸ¥çœ‹å®Œæ•´å¤§å›¾çš„è¯»è€…å¯ç§»æ­¥è‡³<a class="f14_link" href="http://www.glacierworks.org/the-glaciers/pumori-spring-2012/" style="color: rgb(0, 0, 255);" target="_blank">è¿™é‡Œ</a>ã€‚æ“ä½œæ–¹å¼å¾ˆç®€å•ï¼Œå¯ä»¥ç”¨é¼ æ ‡æˆ–ä¸‹æ–¹æŒ‰é’®ç§»åŠ¨é•œå¤´ï¼Œç”¨æ»šè½®æˆ–Shiftã€Ctrlé”®ç¼©æ”¾ã€‚å³ä¸‹è§’çš„Full Screenå¯ä»¥å…¨å±å“¦ã€‚<br><a href="http://images.cy198706.com/Mess-Ups/20121226112100.jpg" target="_blank"> <img alt="" src="http://images.cy198706.com/Mess-Ups/20121226112100.jpg" /></a></p><p><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121226111623.jpg" target="_blank"> <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121226111623.jpg" /></a></p><p><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121226111938.jpg" target="_blank"> <img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121226111938.jpg" /></a><br>&nbsp;</p>]]></content>
      
      
      
        <tags>
            
            <tag> å›¾ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++è·å–æœ¬æœºMACåœ°å€</title>
      <link href="/2012-12-21/c++-get-mac/"/>
      <url>/2012-12-21/c++-get-mac/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å‡ºç°ä¸€ä¸ªéœ€æ±‚ï¼Œè¦è·å–æœ¬æœºçš„MACåœ°å€ï¼Œå°±æ‰¾äº†ä¸€äº›èµ„æ–™ã€‚</p><span id="more"></span><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>åœ¨Windowsä¸‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è·å–MACåœ°å€ï¼š</p><h4 id="1-é€šè¿‡SendARPå‡½æ•°æ¥è·å–ã€‚"><a href="#1-é€šè¿‡SendARPå‡½æ•°æ¥è·å–ã€‚" class="headerlink" title="1.é€šè¿‡SendARPå‡½æ•°æ¥è·å–ã€‚"></a>1.é€šè¿‡SendARPå‡½æ•°æ¥è·å–ã€‚</h4><p>SendARPçš„å‡½æ•°åŸå‹ï¼š</p><pre><code class="c">DWORD SendARP(  _In_     IPAddr DestIP,  _In_     IPAddr SrcIP,  _Out_    PULONG pMacAddr,  _Inout_  PULONG PhyAddrLen);</code></pre><p>æ ¹æ®å‡½æ•°åŸå‹å¯ä»¥çœ‹å‡ºï¼Œå¯ä»¥é€šè¿‡IPåœ°å€æ¥è·å–ï¼Œä¹Ÿå¯ä»¥æ— è§†IPåœ°å€ï¼Œè¿™æ ·å°±è·å¾—ç¬¬ä¸€ä¸ªç½‘å¡çš„MACåœ°å€ã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°pMacAddrä¸ç¬¬å››ä¸ªå‚æ•°PhyAddrLenç±»å‹ç›¸åŒï¼Œæ˜¯æŒ‡å‘ULONGç±»å‹æ•°ç»„çš„æŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å¼ºè½¬ä¸ºunsigned char *ï¼Œç”¨æ¥æ˜¾ç¤ºç­‰ã€‚<br>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="c">int GetOtherMacAddr(char *szIP,char *szBuf,int *pnBufLen)&#123;    HRESULT hr;    IPAddr  ipAddr;    ULONG   pulMac[2];    ULONG   ulLen;    char strMacAddr[100]=&#123;0&#125;;    ipAddr = inet_addr (szIP);    memset (pulMac, 0xff, sizeof (pulMac));    ulLen = 6;    hr = SendARP (ipAddr, 0, pulMac, &amp;ulLen);    if(hr!=NO_ERROR)        return 1;    unsigned char * mac_addr=(unsigned char*)pulMac;    sprintf(strMacAddr,&quot;%02X:%02X:%02X:%02X:%02X:%02X&quot;,mac_addr[0],mac_addr[1],        mac_addr[2],mac_addr[3],mac_addr[4],mac_addr[5]);    if ( *pnBufLen &lt;= (int)strlen(strMacAddr) )        return 2;    strcpy(szBuf,strMacAddr);    *pnBufLen = strlen(szBuf);    return 0;&#125;int GetLocalMacAddr(char *szMac,int *pnMacLen,char *szIP /*=NULL */)&#123;    //å¦‚æœæŒ‡å®šäº†IPï¼Œåˆ™ç›´æ¥æŒ‰IPè·å–MAC    //å¦åˆ™ï¼Œéœ€è¦å…ˆè·å–æœ¬æœºåç§°ï¼Œå†è·å–IPï¼Œå†è·å–MAC    if ( szIP != NULL )        return GetOtherMacAddr(szIP,szMac,pnMacLen);    char szHostName[256] = &#123;0&#125;;    int nRet = gethostname(szHostName,256);    if ( nRet == SOCKET_ERROR )        return 1;    //è·å–æœ¬æœºåç§°    struct hostent* hHost = gethostbyname(szHostName);    if ( hHost == NULL ||  hHost-&gt;h_addr_list[0] == NULL )        return 2;    //è·å–IPåœ°å€    memset(szHostName,0,256);    strcpy(szHostName,inet_ntoa(*(struct in_addr *)hHost-&gt;h_addr_list[0]));    //è·å–MAC    return  GetOtherMacAddr(szHostName,szMac,pnMacLen);&#125;</code></pre><h4 id="2-é€šè¿‡PIP-ADAPTER-INFOç»“æ„ä½“ä¸GetAdaptersInfoå‡½æ•°æ¥è·å–"><a href="#2-é€šè¿‡PIP-ADAPTER-INFOç»“æ„ä½“ä¸GetAdaptersInfoå‡½æ•°æ¥è·å–" class="headerlink" title="2.é€šè¿‡PIP_ADAPTER_INFOç»“æ„ä½“ä¸GetAdaptersInfoå‡½æ•°æ¥è·å–"></a>2.é€šè¿‡PIP_ADAPTER_INFOç»“æ„ä½“ä¸GetAdaptersInfoå‡½æ•°æ¥è·å–</h4><p>PIP_ADAPTER_INFOç»“æ„ä½“çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class="c">typedef struct _IP_ADAPTER_INFO &#123;    struct _IP_ADAPTER_INFO* Next;    DWORD ComboIndex;    char AdapterName[MAX_ADAPTER_NAME_LENGTH + 4];    char Description[MAX_ADAPTER_DESCRIPTION_LENGTH + 4];    UINT AddressLength;    BYTE Address[MAX_ADAPTER_ADDRESS_LENGTH];    DWORD Index;    UINT Type;    UINT DhcpEnabled;    PIP_ADDR_STRING CurrentIpAddress;    IP_ADDR_STRING IpAddressList;    IP_ADDR_STRING GatewayList;    IP_ADDR_STRING DhcpServer;    BOOL HaveWins;    IP_ADDR_STRING PrimaryWinsServer;    IP_ADDR_STRING SecondaryWinsServer;    time_t LeaseObtained;    time_t LeaseExpires;&#125; IP_ADAPTER_INFO, *PIP_ADAPTER_INFO;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ç½‘å¡åç§°ã€æè¿°ä¿¡æ¯ã€MACåœ°å€ã€IPåœ°å€åˆ—è¡¨ã€DHCPæœåŠ¡å™¨ç­‰ä¿¡æ¯ã€‚è¿™æ¬¡æˆ‘ä»¬ç”¨åˆ°çš„å°±æ˜¯MACåœ°å€BYTE[MAX_ADAPTER_ADDRESS_LENGTHã€‚è€Œstruct _IP_ADAPTER_INFO* Nextåˆ™å‘Šè¯‰æˆ‘ä»¬æ‰€æœ‰çš„ç½‘å¡ä¿¡æ¯å°†ä¼šæ„æˆä¸€ä¸ªé“¾è¡¨ï¼Œé€šè¿‡Nextæ¥å¾—åˆ°ä¸‹ä¸€ä¸ªç½‘å¡çš„ä¿¡æ¯ã€‚</p><pre><code class="c">void GetMAC(BSTR* pVal)&#123;    CString sMAC;    PIP_ADAPTER_INFO pAdapterInfo;    PIP_ADAPTER_INFO pAdapter = NULL;    DWORD dwRetVal = 0;    ULONG ulOutBufLen;    pAdapterInfo=(PIP_ADAPTER_INFO)malloc(sizeof(IP_ADAPTER_INFO));    ulOutBufLen = sizeof(IP_ADAPTER_INFO);    if (GetAdaptersInfo(pAdapterInfo, &amp;ulOutBufLen) == ERROR_BUFFER_OVERFLOW)    &#123;        free(pAdapterInfo);        pAdapterInfo = (IP_ADAPTER_INFO *) malloc (ulOutBufLen);    &#125;    if ((dwRetVal = GetAdaptersInfo(pAdapterInfo, &amp;ulOutBufLen)) == NO_ERROR)    &#123;        pAdapter = pAdapterInfo;        if (pAdapter)&#123;            sMAC.Format(_T(&quot;æœ¬æœºMACåœ°å€ä¸ºï¼š%02x-%02x-%02x-%02x-%02x-%02x&quot;),                pAdapter-&gt;Address[0],                pAdapter-&gt;Address[1],                pAdapter-&gt;Address[2],                pAdapter-&gt;Address[3],                pAdapter-&gt;Address[4],                pAdapter-&gt;Address[5]);            //pAdapter = pAdapter-&gt;Next;  //å¦‚æœæœ‰å¤šç½‘å¡ï¼Œè¿™å„¿å°±å¯ä»¥ä½¿ç”¨æ­¤æ¡è¯­å¥è½¬åˆ°ä¸‹ä¸€ä¸ªç½‘å¡        &#125;    &#125;    *pVal = ::SysAllocString(sMAC.MakeUpper());&#125;</code></pre><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>åœ¨Linuxä¸‹ä¹Ÿç±»ä¼¼ã€‚æœ‰ä¸€ä¸ªåä¸ºifreqçš„ç»“æ„ä½“ï¼ŒåŒ…å«äº†ç½‘å¡çš„æ‰€æœ‰ä¿¡æ¯ã€‚<br>ifreqçš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class="c">struct ifreq&#123;    char ifr_name[IFNAMSIZ];    union    &#123;        struct sockaddr ifru_addr;        struct sockaddr ifru_dstaddr;        struct sockaddr ifru_broadaddr;        struct sockaddr ifru_netmask;        struct sockaddr ifru_hwaddr;        short int ifru_flags;        int ifru_ivalue;        int ifru_mtu;        struct ifmap ifru_map;        char ifru_slave[IFNAMSIZ]; /* Just fits the size */        char ifru_newname[IFNAMSIZ];        __caddr_t ifru_data;    &#125; ifr_ifru;&#125;;# define ifr_name ifr_ifrn.ifrn_name /* interface name */# define ifr_hwaddr ifr_ifru.ifru_hwaddr /* MAC address */# define ifr_addr ifr_ifru.ifru_addr /* address */# define ifr_dstaddr ifr_ifru.ifru_dstaddr /* other end of p-p lnk */# define ifr_broadaddr ifr_ifru.ifru_broadaddr /* broadcast address */# define ifr_netmask ifr_ifru.ifru_netmask /* interface net mask */# define ifr_flags ifr_ifru.ifru_flags /* flags */# define ifr_metric ifr_ifru.ifru_ivalue /* metric */# define ifr_mtu ifr_ifru.ifru_mtu /* mtu */# define ifr_map ifr_ifru.ifru_map /* device map */# define ifr_slave ifr_ifru.ifru_slave /* slave device */# define ifr_data ifr_ifru.ifru_data /* for use by interface */# define ifr_ifindex ifr_ifru.ifru_ivalue /* interface index */# define ifr_bandwidth ifr_ifru.ifru_ivalue /* link bandwidth */# define ifr_qlen ifr_ifru.ifru_ivalue /* queue length */# define ifr_newname ifr_ifru.ifru_newname /* New name */# define _IOT_ifreq _IOT(_IOTS(char),IFNAMSIZ,_IOTS(char),16,0,0)# define _IOT_ifreq_short _IOT(_IOTS(char),IFNAMSIZ,_IOTS(short),1,0,0)# define _IOT_ifreq_int _IOT(_IOTS(char),IFNAMSIZ,_IOTS(int),1,0,0)</code></pre><p>ç¨å¾®å¤æ‚ç‚¹ï¼Œä½†è¿˜æ˜¯èƒ½æ‰¾åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„ä¿¡æ¯çš„ - ifru_hwaddrã€‚</p><p>é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼Œå°±èƒ½å®Œæˆå·¥ä½œäº†ï¼š</p><pre><code class="c">int GetLocalMacAddr(char *szMac,int *pnMacLen)&#123;    int   sock;    struct   ifreq   ifr;    unsigned   char   mac[6];    sock=socket(AF_INET,SOCK_DGRAM,0);    // ç”Ÿæˆä¸€ä¸ªTCPçš„socket    if (sock==-1)    &#123;        perror(&quot;socket&quot;);        return 1;    &#125;    strncpy(ifr.ifr_name,&quot;eth0&quot;,sizeof(ifr.ifr_name));    ifr.ifr_name[IFNAMSIZ-1]   =   0;    memset(mac,0,sizeof(mac));    if (ioctl(sock,SIOCGIFHWADDR,&amp;ifr)&lt; 0)    &#123;        perror(&quot;ioctl&quot;);        return 2;    &#125;    memcpy(mac,&amp;ifr.ifr_hwaddr.sa_data,sizeof(mac));    char curmacstr[64];    memset(curmacstr,0,sizeof(curmacstr));    sprintf(curmacstr,&quot;%.2X:%.2X:%.2X:%.2X:%.2X:%.2X&quot;,mac[0],mac[1],mac[2],mac[3],mac[4],mac[5]);    strcpy(szMac,curmacstr);    return 0;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨æ’ä»¶ï¼šå¾®åšæ€¥ç®€ &amp;#8211; è¿˜ä½ ä¸€ä¸ªï¼Œå¹²å‡€çš„å¾®åšï¼</title>
      <link href="/2012-12-19//"/>
      <url>/2012-12-19//</url>
      
        <content type="html"><![CDATA[<p>è¿™å¹´å¤´ï¼Œæ— å­”ä¸å…¥çš„å¹¿å‘Šå·²ç»æŠŠæˆ‘ä»¬çƒ¦å¾—è¦æ­»è¦æ´»çš„ï¼Œå†åŠ ä¸Šä¸€äº›&ldquo;æ½œè§„åˆ™&rdquo;ï¼Œæœ¬æ¥æœ‰äº›åœ°æ–¹æ˜¯&ldquo;ä¸€æ–¹å‡€åœŸ&rdquo;ï¼Œä¹Ÿä¼šåœ¨åˆ©ç›Šçš„é©±ä½¿ä¸‹å˜å¾—æ±¡æµŠä¸å ªã€‚<br>å½“ç„¶ï¼Œè¿™åªæ˜¯äº›æ— å…³ç—›ç—’çš„è¯ï¼Œç°åœ¨è°è¿˜ä¼šå› ä¸ºå¹³æ°‘çš„å‘¼å£°å°±åšå‡ºä¸€äº›&ldquo;è‰°éš¾çš„å†³å®š&rdquo;å•Šã€‚</p><p>æ–°æµªå¾®åšä»ä¸€å¼€å§‹çš„ç®€æ´æ˜å¿«ï¼Œåˆ°åæ¥çš„è‡ƒè‚¿ä¸å ªï¼Œæœ‰åˆ©ç›Šåœ¨é‡Œé¢ï¼Œä¹Ÿæœ‰äº‹ç‰©çš„å‘å±•è§„å¾‹åœ¨é‡Œé¢ã€‚ä»åˆ©ç›Šæ–¹é¢ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå¤§å‹ç½‘ç«™æ˜¯ä¸éœ€è¦æŒ£é’±çš„ï¼Œä»…é é‚£ä¸€ç‚¹ç‚¹å¹¿å‘Šè´¹ï¼Œæ˜¯ä¸è¶³ä»¥å…»æ´»ä¸‹é¢çš„ç™¾åå·äººçš„ã€‚  </p><span id="more"></span><p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿä¼šå‘˜ï¼Ÿå—¯ï¼æ”¾ç‚¹æƒé™ï¼ä¼šå‘˜å¯ä»¥çŸ¥é“è°å–æ¶ˆäº†å¯¹ä»–çš„å…³æ³¨ï¼ä¼šå‘˜å¯ä»¥ç”¨ä¸“å±çš„æ¨¡ç‰ˆï¼ä¼šå‘˜åº”è¯¥æˆ´ä¸€ä¸ªçš‡å† ï¼ä¼šå‘˜çš„è¯å¯ä»¥è¢«æ›´å¤šäººçœ‹åˆ°ï¼</p><p>é‚£æ€ä¹ˆæ‰èƒ½è®©ä¼šå‘˜çš„è¯è¢«æ›´å¤šäººçœ‹åˆ°å‘¢ï¼Ÿæ’åºå§ï¼</p><pre class="brush:cpp;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;">if(user.group == _VIPGROUP){&nbsp;&nbsp;&nbsp; pop_sort();}if(user.group == _NORMALGROUP){&nbsp;&nbsp;  push_sort();}</pre><p>åºŸè¯å°‘è¯´ï¼Œæ–°æµªå¾®åšçš„é¡µé¢ä¸Šæœ‰å¤ªå¤šå¹³æ—¶ç”¨ä¸åˆ°çš„ä¸œè¥¿äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘å–œæ¬¢wapç‰ˆçš„å¾®åšçš„åŸå› ï¼Œç®€æ´æ˜å¿«ï¼Œæˆ‘èƒ½å¾ˆå¿«åœ°æ‰¾åˆ°æˆ‘éœ€è¦çš„ä¸œè¥¿ã€‚<br><a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121219094357.jpg" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121219094357.jpg" /></a><br>çœ‹çœ‹è¿™ä¸œè¥¿ï¼Œå¤šè‡ƒè‚¿ï¼Œå¤ªå¤šå¹³æ—¶ç”¨ä¸åˆ°çš„ä¸œè¥¿äº†ã€‚ã€‚æˆ‘å°±æ˜¯çœ‹å¾®åšï¼Œå‘å¾®åšï¼Œæ²¡äº†ã€‚</p><p>è¿™ä»Šå¤©æ¨èä¸€ä¸ªå¾®åšæ€¥ç®€å·¥å…·ï¼Œä»–ä»¬çš„å£å·æ˜¯&ldquo;è¿˜ä½ ä¸€ä¸ªï¼Œå¹²å‡€çš„å¾®åšï¼&rdquo;é’ˆå¯¹FireFoxï¼ŒChromeï¼ŒSafariå’Œ360æµè§ˆå™¨åˆ†åˆ«å¼€å‘äº†æ’ä»¶ï¼Œä»–ä»¬å¯¹å¾…IEç”¨æˆ·çš„æ€åº¦æ˜¯ï¼šIâ€™m sorry, Iâ€™m so sorry, Iâ€™m sooooo sorry.<br>æ•ˆæœæ›´æ˜¯æ²¡è¯è¯´ï¼Œä¸Šå›¾ï¼š<a href="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121219092616.jpg" target="_blank"><img alt="" src="http://i1352.photobucket.com/albums/q645/cy198706/mess-ups/20121219092616.jpg" /></a><br>å› ä¸ºåœ¨Win8ä¸‹ï¼ŒMactypeä¸èƒ½å¾ˆå¥½åœ°æ¸²æŸ“Chromeï¼Œçœ‹ç€é‚£è›‹ç–¼çš„å­—ä½“å®åœ¨è®©äººè›‹ç–¼ï¼Œæ‰€ä»¥å¶ç›®å‰ä½¿ç”¨çš„æ˜¯ç«ç‹æµè§ˆå™¨ï¼Œè¿˜ä¸é”™å§ï¼Ÿ<br>é“¾æ¥å¥‰ä¸Šï¼š<a href="http://www.diff.im/weibo_wc/">å¾®åšæ€¥ç®€</a></p><!--[syntaxhighlighter]--><!--ä»£ç é«˜äº®ï¼Œè¯·å‹¿ç¼–è¾‘--><link type="text/css" rel="stylesheet" href="http://cy198706.com/blog/wp-content/plugins/ck-and-syntaxhighlighter/syntaxhighlighter/styles/shCoreCk.css" /><link type="text/css" rel="stylesheet" href="http://cy198706.com/blog/wp-content/plugins/ck-and-syntaxhighlighter/syntaxhighlighter/styles/shThemeCk.css" /><!--[/syntaxhighlighter]-->]]></content>
      
      
      
        <tags>
            
            <tag> æ—é—¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸ƒå¡æ¼«ç”» &amp;#8211; æ¼«ç”»ç¥å™¨</title>
      <link href="/2012-12-18//"/>
      <url>/2012-12-18//</url>
      
        <content type="html"><![CDATA[<p>å¶ä»å¾ˆå°çš„æ—¶å€™å°±å¼€å§‹çœ‹æ¼«ç”»ï¼Œé‚£ä¸ªæ—¶å€™çš„å°æ¼«ç”»ä¹¦è¿˜æ˜¯å››å¤„å€Ÿçš„ï¼Œå› ä¸ºæ²¡é’±ä¹°=ã€‚= ä¸ƒé¾™ç ï¼Œæœºå™¨çŒ«ï¼Œä¹±é©¬ï¼Œèœ¡ç¬”å°æ–°ï¼ŒæŸ¯å—ï¼ŒçŒç¯®é«˜æ‰‹ã€‚ã€‚ã€‚æ¼«ç”»é™ªæˆ‘åº¦è¿‡äº†ç«¥å¹´ã€‚<br>ç°åœ¨è™½ç„¶æ²¡æœ‰é‚£ç§æ¿€æƒ…äº†ï¼Œä½†æ˜¯å¶å°”çœ‹ä¸ªæ¼«ç”»ï¼Œè¿˜æ˜¯èƒ½æ‰¾å›å½“å¹´çš„æ„Ÿè§‰çš„ã€‚</p><p>åœ¨é…·å®‰å¸‚åœºæ‰¾åˆ°äº†è¿™ä¸ªæ¼«ç”»ç¥å™¨ &#8211; å¸ƒå¡æ¼«ç”»ï¼ˆå¸ƒå¡ï¼Ÿä¸å¡ï¼Ÿï¼‰ã€‚ç”¨äº†å‡ å¤©å‘ç°ï¼ŒçœŸçš„æ˜¯ç¥å™¨ã€‚ä¸ä½†èµ„æºä¸°å¯Œï¼Œè€Œä¸”ä¸€ç‚¹ä¹Ÿä¸å¡ï¼ˆå½“ç„¶æ˜¯åœ¨wifiä¸‹ï¼‰ï¼Œåº”äº†åå­—çš„å¯“æ„ã€‚</p><p>è½¯ä»¶çš„ç•Œé¢åšå¾—æ¯”è¾ƒè®¨å–œï¼Œé£æ ¼å¾ˆç®€æ´ï¼Œè€Œä¸”å¸¸ç”¨çš„ä¸œè¥¿åŸºæœ¬ä¸Šåœ¨ä¸¤æ¬¡æ“ä½œä»¥å†…éƒ½å¯ä»¥å®Œæˆï¼Œæ²¡æœ‰å¤ªå¤šç¹å†—çš„è®¾ç½®ã€‚å›¾ç‰‡çš„è´¨é‡éƒ½æ¯”è¾ƒé«˜ï¼Œæˆ‘çš„Defyåˆ†è¾¨ç‡ä¸º854*480ï¼Œæ— è®ºæ¨ªå±è¿˜æ˜¯ç«–å±ï¼Œçœ‹èµ·æ¥éƒ½ç›¸å½“æ¸…æ™°ã€‚<span id="more"></span></p><p><a href="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-54-00.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-54-00.png" style="height: 569px; width: 320px;" /></a>&nbsp;<a href="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-54-23.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-54-23.png" style="width: 320px; height: 569px;" /></a><br><a href="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-54-38.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-54-38.png" style="height: 569px; width: 320px;" /></a>&nbsp;<a href="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-55-15.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-12-17-14-55-15.png" style="height: 569px; width: 320px;" /></a><br>æ€»çš„æ¥è¯´ï¼Œè¿™è¿˜æ˜¯ä¸€æ¬¾ç²¾å“æå“çš„è½¯ä»¶ï¼Œä½“ç§¯ä¹Ÿä¸å¤§ï¼Œéå¸¸é€‚åˆå–œæ¬¢çœ‹æ¼«ç”»çš„äººå®‰è£…ä½¿ç”¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å§åºŠä¸‰å¤©</title>
      <link href="/2012-12-03//"/>
      <url>/2012-12-03//</url>
      
        <content type="html"><![CDATA[<p>è«åå‘çƒ§ï¼Œå§åºŠä¸‰å¤©ã€‚çœ‹æ¥å†¬å­£åˆ°åº•æ˜¯æ¥äº†ã€‚<br>ç—…æœ€ä¸¥é‡çš„æ—¶å€™ï¼Œå¤§è„‘æ— æ—¶æ— åˆ»ä¸åœ¨æŠ˜ç£¨ç€æˆ‘ã€‚æ°å¥½å‰äº›å¤©åœ¨å›é¡¾ç¾å‰§&ldquo;è¶Šç‹±&rdquo;ï¼Œåœ¨ç¡è§‰çš„æ—¶å€™ï¼Œé‡Œé¢çš„æƒ…èŠ‚å°±æœ‰å¦‚æ½®æ°´ä¸€èˆ¬å‘æˆ‘æ¶Œæ¥ï¼Œå°±ç®—æ¸…é†’è¿‡æ¥ä¹Ÿè¿˜ä¸æ”¾è¿‡æˆ‘ã€‚è¯´è¯ä¹Ÿå¼€å§‹å˜å¾—ç³Šæ¶‚ï¼Œç¥æ™ºä¸æ¸…ï¼Œä¸çŸ¥é“è‡ªå·±åœ¨è¯´äº›ä»€ä¹ˆï¼ŒåŠ ä¹‹æ˜æš—çš„æˆ¿é—´ï¼Œè‚šå­ä¹Ÿéš¾å—ï¼Œå¤´ç–¼æ¬²è£‚ï¼Œæ•´ä¸ªäººåƒå¿«è¦æ­»è¿‡å»ã€‚<br>å¥½åœ¨åª³å¦‡åœ¨èº«è¾¹ã€‚æˆ‘å¦ˆæ‰“æ¥ç”µè¯ï¼Œä¸€å¬è¯´æˆ‘æ„Ÿå†’äº†ï¼Œç¬¬ä¸€æ—¶é—´å°±é—®&ldquo;ä½ åª³å¦‡æ²¡äº‹å§?&rdquo;æˆ‘æ’‡äº†æ’‡å˜´ï¼Œå›ç­”&ldquo;æ²¡äº‹ã€‚æ”¾å¿ƒå§ã€‚&rdquo;çˆ¶æ¯è¡¨ç¤ºæœ‰å¥¹åœ¨èº«è¾¹ï¼Œä¸€åˆ‡æ”¾å¿ƒã€‚<br>è¿™ä¸¤æ—¥çœŸçœŸæŠŠå¥¹å¿™åäº†ã€‚ä¹°èœï¼Œåšé¥­ï¼Œæ”¶æ‹¾å±‹å­ï¼Œå€’æ°´ï¼ŒçŒè¯ï¼Œå€’è…¾å‡‰æ¯›å·¾ï¼Œçƒ­æ°´æ³¡è„šã€‚ã€‚å¿ƒé‡Œæš–æš–çš„ï¼Œä½†æ˜¯æˆ‘å®åœ¨æ²¡æœ‰åŠ›æ°”ç«™èµ·æ¥ï¼Œå¸®å¥¹åšç‚¹ä»€ä¹ˆã€‚æ˜¨å¤©å¥¹åœ¨åšé¥­ï¼Œæˆ‘æŒªåˆ°å¨æˆ¿å»ï¼Œè¯´&ldquo;å¿ƒé‡Œæ„§ç–šå•Šã€‚&rdquo;å¥¹çœ‹äº†æˆ‘ä¸€çœ¼ï¼Œ&ldquo;è¿™ä¸åº”è¯¥çš„ä¹ˆã€‚èµ¶ç´§å›å»ï¼Œåˆ«å†»ç€ã€‚&rdquo;å¾—å¥³å¦‚æ­¤ï¼Œå¤«å¤ä½•æ±‚?<br>ä»Šæ—¥ä½™çƒ­é€€å°½ï¼Œä¾æ—§è¡ŒåŠ¨ä¸ä¾¿ï¼Œå¿µæ­¤æƒ…æ­¤æ™¯ï¼Œä¹¦ä¹‹ã€‚<br><a href="http://img29.wal8.com/img29/310877_20121224145902/135633515792.jpg" target=""><img alt="" src="http://img29.wal8.com/img29/310877_20121224145902/135633515792.jpg" style="width: 610px;" /></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kelly Clarkson &amp;#8211; (What Doesn&amp;#8217;t Kill You Makes You) Stronger</title>
      <link href="/2012-11-27//"/>
      <url>/2012-11-27//</url>
      
        <content type="html"><![CDATA[<p><span style="font-size:14px;">ç¾å›½å¶åƒä¸€å§Kelly ClarksonæºåŠ›ä½œã€ŠStrongerã€‹å¼ºåŠ¿å›å½’ï¼ŒåŠ›å‹ç¾¤é›„ï¼Œç›´å‡»ç¬¬ä¸€å®åº§ï¼ä¸€å‘å°±æ˜¯&ldquo;åŠ±å¿—å§&rdquo;çš„Kelly Clarksonåœ¨è›°ä¼ä¸€é˜µå­åçŒ›åŠ›å‘åŠ›ï¼Œä»¥æ‘‡æ»šé£èŒƒå…¨æ–°å¤å‡ºï¼&ldquo;What doesnâ€™t kill you makes you strongerï¼&rdquo;è¶Šåˆ°å›°éš¾å°±è¦è¶ŠæŒ«è¶Šå‹‡ï¼æ›²è°ƒè½»å¿«åŠ¨æ„Ÿï¼ŒKellyç”¨åä¸½å’Œç«¯åº„ä¸¤ç§è£…æ‰®é£æ ¼å±•ç¤ºå‡ºè‡ªå·±çš„é­…åŠ›ã€‚åŒæ—¶Kellyåœ¨è¿™é¦–æ­Œä¸­çš„éŸ³è‰²è¡¨ç°è¢«æ¬§ç¾ä¹è¯„äººç§°èµä¸ºæ•´å¼ ä¸“è¾‘çš„äº®ç‚¹ã€‚</span></p><p><span style="font-size:14px;">Kelly Clarksonï¼Œ1982å¹´4æœˆ24æ—¥å‡ºç”Ÿåœ¨å¾·å…‹è¨æ–¯å·çš„Burlesonã€‚ç¾å›½æµè¡ŒéŸ³ä¹å¥³æ­Œæ‰‹ã€‚2002å¹´ï¼ŒKellyå‚åŠ äº†ç¾å›½çœŸäººç§€èŠ‚ç›®ã€Šç¾å›½å¶ åƒã€‹ç¬¬ä¸€å­£çš„æ¯”èµ›ï¼Œå‡­ç€å…¶æ‰å®çš„å”±åŠŸå’Œç¨³å®šçš„æ¼”å‡ºï¼Œç”±å…¨ç¾ç”µè§†è§‚ä¼—æŠ•ç¥¨é€‰ä¸ºæ¯”èµ›çš„å† å†›ï¼Œæˆä¸ºæ–°ä¸–ä»£çš„ç¾å›½å¶åƒã€‚<br /> å¥‰ä¸ŠMTVï¼Œè™½ç„¶æ‹æ‘„å¾—ä¸­è§„ä¸­çŸ©ï¼Œä½†æ˜¯å´å‘Šè¯‰æˆ‘ä»¬ï¼Œå¹³å‡¡çš„äººï¼Œä¹Ÿæœ‰åŠ›é‡ã€‚</span></p><p style="text-align: center;">  <embed align="middle" allowfullscreen="true" allowscriptaccess="always" height="460" quality="high" src="http://player.youku.com/player.php/sid/XMzMyMzgzNjI4/v.swf" type="application/x-shockwave-flash" width="620">  </embed></p>]]></content>
      
      
      
        <tags>
            
            <tag> éŸ³ä¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç°å¸¸æœ‰æ„æ€çš„å¡å†œ</title>
      <link href="/2012-11-22//"/>
      <url>/2012-11-22//</url>
      
        <content type="html"><![CDATA[<p>è¦è¯´å¡å†œï¼Œæˆ‘ä¹Ÿå¬äº†ä¸å°‘ç‰ˆæœ¬äº†ï¼ŒæŠ’æƒ…çš„ï¼Œä½æ²‰çš„ï¼Œæ‘‡æ»šçš„ï¼Œç”µå­çš„ï¼Œçˆµå£«çš„ã€‚è¿™ä¸ªç‰ˆæœ¬çš„è¿˜æ˜¯å¤´ä¸€æ¬¡å¬ã€‚</p><p>åºŸè¯å°‘è¯´ï¼Œå¥‰ä¸Šè§†é¢‘ã€‚</p><p style="text-align: center;"></p>]]></content>
      
      
      
        <tags>
            
            <tag> éŸ³ä¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¶æœ€å–œæ¬¢çš„é˜…è¯»è½¯ä»¶ &amp;#8211; é™è¯»å¤©ä¸‹ Moon Reader</title>
      <link href="/2012-11-21//"/>
      <url>/2012-11-21//</url>
      
        <content type="html"><![CDATA[<p>è¦è¿½æº¯ä¿ºçš„ç”µå­ä¹¦è¯»ä¹¦å†å²ï¼Œè¦ä»é«˜äºŒå¼€å§‹ã€‚é‚£ä¸ªæ—¶å€™æˆ‘çœ‹ç­é‡Œæœ‰äººå¼€å§‹ç”¨&ldquo;æ–‡æ›²æ˜Ÿ&rdquo;ï¼Œæˆ‘é‚£ä¸ªç¾¡æ…•å•Šï¼Œé‚£ä¸ªå«‰å¦’å•Šï¼Œé‚£ä¸ªæ¨å•Šï¼Œåæ¥å°±ç¼ ç€æˆ‘çˆ¸ç»™æˆ‘ä¹°äº†ä¸€ä¸ªã€‚è®°å¾—é‚£ä¸ªç‰Œå­å«&ldquo;è¯ºäºšèˆŸ&rdquo;ï¼Œè‡ªæ­¤æˆ‘ä¹Ÿæˆä¸ºæ‹¥æœ‰ç”µå­äº§å“çš„äººï¼Œå¾—ä¼—å¤šå°‘ç”·å°‘å¥³ä»¬çš„ç¾¡æ…•ã€‚<br>&ldquo;è¯ºäºšèˆŸ&rdquo;æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œå­¦ä¹ è‹±è¯­æ˜¯é¦–ä½çš„ï¼Œæˆ‘ä¹Ÿç»å¸¸ç”¨æ¥æŸ¥ä¸ªå•è¯å•Šå•¥çš„ã€‚ç„¶åå°±æ˜¯æ¸¸æˆåŠŸèƒ½äº†ï¼Œæ¨ç®±å­ã€è´ªåƒè›‡ã€æ‰«é›·ï¼Œä¸‰ä¸ªæ¸¸æˆæˆ‘ç©äº†æ•´æ•´ä¸¤å¹´ã€‚<br>ä¸è¿‡ç”¨çš„æœ€å¤šçš„åŠŸèƒ½è¿˜æ˜¯çœ‹ç”µå­ä¹¦ã€‚å½“æ—¶çœ‹çš„ä¹¦ï¼Œä¸å¤–ä¹è¨€æƒ…å°è¯´å•Šï¼Œç§‘å¹»å°è¯´ï¼Œå†å°±æ˜¯ä¸¤ä¸‰ä¸ªäººå°±èƒ½æ¼”å®Œçš„é‚£ç§å°è¯´ã€‚å½“æ—¶è¿˜æ²¡æœ‰ç„å¹»å°è¯´ï¼Œã€Šè¯›ä»™ã€‹å•¥çš„è¿˜æ²¡å‡ºç°å‘¢ã€‚<br>åæ¥åˆ°å¤§å­¦ï¼Œæœ‰äº†æ‰‹æœºã€‚ç¬¬ä¸€éƒ¨æ™ºèƒ½æœºæ˜¯MOTOROLAçš„E398ã€‚</p><span id="more"></span><p>&nbsp;<img alt="" height="280" src="http://2d.zol-img.com.cn/product/2/777/ce9iCrUA0Ft.jpg" width="374" /><br>é‚£ä¸ªæ—¶å€™çœ‹çš„ä¹¦å°±æ¯”è¾ƒæ‚äº†ï¼Œç§‘å¹»çš„ï¼Œæ‚å°è¯´ï¼Œç„å¹»ç±»çš„ã€‚å½“æ—¶ç”¨çš„è½¯ä»¶å«MOTO-TXTã€‚<br>&nbsp;<img alt="" class="alignnone size-full wp-image-279" data-mce-="" src="http://images.cy198706.com/Android/20100302163631-2099173229.jpg" style="height: 320px; width: 240px;" title="20100302163631-2099173229" /><br>è¿™ä¸œè¥¿ç®€ç›´å°±æ˜¯ç¥å™¨ï¼Œå¯å®šåˆ¶æ€§ç›¸å½“å¼ºã€‚è™½ç„¶ç°åœ¨çœ‹æ¥ï¼Œè¿™ä¸ªè½¯ä»¶å·²ç»è½åä¸çŸ¥é“å¤šå°‘äº†ï¼Œä½†æ˜¯è¿™æ®µæ—¶å…‰æ˜¯æ°¸è¿œä¹Ÿå¿˜ä¸äº†æ»´ã€‚<br>åæ¥åˆä¹°äº†MOTOROLA E2ã€‚<br><img alt="" class="alignnone size-full wp-image-280" data-mce-="" src="http://images.cy198706.com/Android/20080112100044426.jpg" style="height: 375px; width: 500px;" title="20080112100044426" /><br>è¿™ç®—æ˜¯MOTOROLAçš„åˆä¸€æ¬¾ç»å…¸æœºå‹ã€‚å½“æ—¶åˆ·æœºåˆ·å¾—é‚£å«ä¸€ä¸ªç–¯å•Š~ç”¨äº†ä¸‰å¹´çš„è½¯ä»¶å«Anyviewã€‚<br><img alt="" class="alignnone size-full wp-image-281" data-mce-="" src="http://images.cy198706.com/Android/200962516473099249.jpg" style="width: 240px; height: 320px;" title="200962516473099249" /><br>Anyviewå·²ç»å°†é”®ç›˜é˜…è¯»è½¯ä»¶æå‡åˆ°ç²¾å“çš„é«˜åº¦ï¼Œå¯¹äºå½“æ—¶çš„å¶æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šä¸€å¤©é‡Œè‡³å°‘æœ‰5ä¸ªå°æ—¶æ˜¯å¼€ç€è¿™ä¸ªè½¯ä»¶çš„ã€‚Anyviewçš„ä½œè€…ç°åœ¨å¥½åƒè¿˜åœ¨å¼€å‘ï¼Œä¸è¿‡å·²ç»è®¸ä¹…æ²¡æœ‰ç”¨è¿‡äº†ï¼Œå‘ä»–è‡´æ•¬ã€‚<br>æ¯•ä¸šåï¼Œæœ‰äº†ç‚¹é’±ï¼Œä¹°äº†ä¸ªè¯ºåŸºäºšçš„E71ï¼Œä¹Ÿæ˜¯ä¸€æ¬¾ç»å…¸è¡—æœºã€‚<br><img alt="" class="alignnone size-full wp-image-282" data-mce-="" src="http://images.cy198706.com/Android/241720.jpg" style="width: 269px; height: 292px;" title="241720" /><br>æ‰¾äº†å¥½å¤šè¯»ä¹¦è½¯ä»¶ï¼Œéƒ½æ‰¾ä¸åˆ°å¤§å­¦å››å¹´ï¼Œæ™šä¸Šé»‘ä¹ä¹çš„ï¼Œçœ‹ã€Šé¬¼å¹ç¯ã€‹çœ‹åˆ°å‡Œæ™¨å››ç‚¹æ‰ç¡çš„æ„Ÿè§‰äº†ã€‚åœ¨E71è¢«è´¼äººå·å»ä¹‹å‰ï¼Œä¸€ç›´åœ¨ç”¨çš„æ˜¯ç™¾é˜…ï¼Œä¹Ÿç®—æ˜¯æ¯”è¾ƒå¥½çš„ä¸œè¥¿äº†ã€‚ç™¾é˜…ç›®å‰åœ¨Androidå¹³å°ä¸Šä¹Ÿæœ‰è‡ªå·±çš„å¸‚åœºï¼Œåªæ˜¯ä¸ªäººä¸å–œæ¬¢è¿™ç§åªåœ¨ä¹å‘å±•å…¶åœ¨çº¿æ¨¡å—ï¼ˆä¹Ÿå°±æ˜¯èµšé’±æ¨¡å—ï¼‰è€Œå¿½è§†ç¦»çº¿æœ¬åœ°é˜…è¯»ä½“éªŒçš„è½¯ä»¶ï¼Œé‚æ”¾å¼ƒã€‚<br>ç°åœ¨åœ¨ç”¨çš„æ˜¯MOTOROLA Defyï¼ˆä½ çœ‹ï¼Œæˆ‘çœŸæ˜¯MOTOçš„å¿ å®ç²‰ä¸å•Šã€‚ã€‚ï¼‰ã€‚è¯»ç”µå­ä¹¦çš„ä¹ æƒ¯ä¸€ç›´éƒ½ä¿æŒç€ã€‚ç¡å‰ï¼Œå¦‚å•ï¼Œåœ°é“ä¸Šï¼Œå…¬äº¤ä¸Šï¼Œç”šè‡³ç”µæ¢¯é‡Œã€‚ã€‚æˆ‘å–œæ¬¢æŠ˜è…¾æ‰‹æœºï¼Œä½ çœ‹æˆ‘ä¹°çš„å‡ æ¬¾æœºå™¨ï¼Œéƒ½æ˜¯å¯ä»¥åˆ·æœºçš„ï¼Œå¯å®šåˆ¶æ€§éå¸¸å¼ºï¼Œæˆ‘ä¸å–œæ¬¢è¢«è‡ªå·±çš„æ‰‹æœºæŸç¼šä½è¿™ç§æ„Ÿè„šã€‚iPhoneä¹Ÿç”¨è¿‡ä¸€æ®µæ—¶é—´ï¼Œè‹¹æœçš„ä¸œè¥¿è›®ä¸é”™çš„ï¼Œç”¨æˆ·ä½“éªŒåšå¾—éå¸¸æ£’ï¼Œä½†ä¸ä¹ æƒ¯ï¼Œé‚æ”¾å¼ƒã€‚åœ¨Androidä¸‹ï¼Œå¯æŠ˜è…¾ç©ºé—´å°±å¤§äº†è®¸å¤šäº†ã€‚é˜…è¯»è½¯ä»¶ä¹Ÿç”¨äº†ä¸å°‘ä¸å°‘çš„ã€‚Anyviewã€ç™¾é˜…ã€iReaderã€é™è¯»å¤©ä¸‹ã€å¼€å·æœ‰ç›Šï¼Œè¿˜æœ‰äº›ç”¨äº†ä¸€ä¸¤æ¬¡å°±ç›´æ¥å¹²æ‰çš„è½¯ä»¶ï¼ŒiReaderä¹Ÿç”¨äº†å¥½é•¿ä¸€æ®µæ—¶é—´ï¼Œä½†æœ€åè¿˜æ˜¯é”å®šäº†é™è¯»å¤©ä¸‹ã€‚<br>é™è¯»å¤©ä¸‹æ˜¯æ¬¾å¯å®šåˆ¶æ€§éå¸¸å¼ºçš„ç¦»çº¿é˜…è¯»è½¯ä»¶ï¼Œå…¶èµ¢åˆ©çš„æ–¹å¼æ˜¯è´­ä¹°ä¸“ä¸šç‰ˆä»¥è§£é”é«˜çº§åŠŸèƒ½ã€‚ç½‘ä¸Šæµä¼ çš„åŸºæœ¬ä¸Šéƒ½æ˜¯XXç‰ˆçš„ï¼Œåœ¨ä½œè€…çš„å£°æ˜é‡Œä¹Ÿæ˜ç¡®è¡¨ç¤ºäº†&ldquo;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ç ´è§£ç‰ˆï¼Œè¯·ä¸è¦è”ç³»å¶&rdquo;ã€‚</p><blockquote><p>åŠŸèƒ½ä¸‡é‡‘æ²¹ï¼š<br>1ã€å®ç°çœŸæ­£çš„å¹³æ»‘æ»šåŠ¨ã€‚<br>2ã€å¤šä¸ªåœ¨çº¿ä¹¦åº“ï¼Œæ•°åä¸‡æœ¬å°è¯´/æŠ¥çº¸/æ‚å¿—<br>3ã€æ”¯æŒä¼ ç»Ÿä¸­æ–‡çš„ç«–æ’/ç›´è¯»æ¨¡å¼<br>4ã€æ·±åº¦ä¼˜åŒ–txté•¿ç¯‡å°è¯´é˜…è¯»ä½“éªŒï¼Œé«˜æ•ˆæ™ºèƒ½è¯†åˆ«ç« èŠ‚æ®µè½ï¼Œè‡ªåŠ¨ç”Ÿæˆç›®å½•<br>5ã€æ”¯æŒå››åå¤šç§ç¼–ç ï¼Œä¸‰åå¤šç§å¤–æŒ‚å­—ä½“ï¼ˆç¹ä½“å­—TXTæ–‡æ¡£è¯·åœ¨å¯è§†è®¾ç½®é‡Œæ‰‹å·¥é€‰æ‹©ç›¸åº”æ–‡å­—ç¼–ç ï¼‰<br>6ã€é¢„ç½®åç§é…è‰²æ–¹æ¡ˆï¼Œå¯å®šåˆ¶ç™½å¤©æ™šä¸Šæ¨¡å¼<br>7ã€å¯è§†åŒ–è®¾ç½®ï¼Œæ‰€æœ‰é¢œè‰²èƒŒæ™¯ç­‰å³æ—¶å¯è§<br>8ã€æ”¯æŒåå¤šç§ç¿»é¡µæ¨¡å¼<br>9ã€æ”¯æŒäº”ç§è‡ªåŠ¨æ»šå±æ–¹æ¡ˆï¼Œå¹¶å¯å®æ—¶è°ƒèŠ‚<br>10ã€æ™ºèƒ½æ’ç‰ˆï¼Œé¦–è¡Œç¼©è¿›ï¼Œè£å‰ªå¤šä½™ç©ºè¡Œ<br>11ã€è§†åŠ›ä¿æŠ¤æé†’é€‰é¡¹<br>12ã€çœŸå®çº¸å¼ ç¿»é¡µæ•ˆæœ<br>13ã€è±ªåä¹¦æ¶ç®¡ç†ï¼Œæˆ‘çš„çè—/ä¸‹è½½/ä½œè€…/åˆ†ç±»å¹¶å¯è‡ªåˆ¶å°é¢<br>14ã€å¼ºå¤§çš„æœ¬åœ°ä¹¦ç±æ–‡æ¡£æŸ¥æ‰¾ï¼ˆæ”¯æŒé€šé…ç¬¦æ£€ç´¢åŠå¯¼å…¥ï¼‰ï¼Œå…¨æ–¹ä½çš„ä¹¦æœ¬å†…å®¹æœç´¢ï¼ˆæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼‰<br>15ã€è¯å…¸/ç¿»è¯‘/é«˜äº®/æ ‡æ³¨ï¼Œé•¿æŒ‰é˜…è¯»å†…å®¹å¯é€‰æ‹©é€šè¿‡å¾®åšï¼ŒçŸ­ä¿¡å’Œé‚®ä»¶ç­‰æ–¹å¼è¿›è¡Œåˆ†äº«<br>16ã€å¤šè¯­ç§é˜…è¯»æ”¯æŒï¼šå…±æœ‰26ä¸ªè¯­è¨€çš„ç‰ˆæœ¬ï¼Œæ”¯æŒJustifiedå’ŒHyphenationæ’ç‰ˆï¼Œæ”¯æŒéŸ©è¯­å’Œæ—¥è¯­æ’ç‰ˆï¼Œæ”¯æŒ300å¤šéƒ¨å„è¯­ç§ç¦»çº¿è¯å…¸<br>17ã€æ”¯æŒæ ¼å¼ï¼štxtã€htmlã€epubã€fb2ã€umdã€chmã€zipã€OPDS<br>ä¸“ä¸šç‰ˆå¢å¼ºï¼š<br>1ã€åˆ é™¤å¹¿å‘Šæ¡<br>2ã€è¯­éŸ³æœ—è¯»<br>3ã€å¤šç‚¹è§¦æ‘¸æ”¯æŒ<br>4ã€å¯†ç ä¿æŠ¤<br>5ã€è€³æœºæˆ–è“ç‰™æ§åˆ¶<br>6ã€åˆ›å»ºæ¡Œé¢ä¹¦ç±å¿«æ·æ–¹å¼<br>7ã€æ ‡ç­¾/é«˜äº®/æ ‡æ³¨çš„åˆ†äº«åŠå¯¼å…¥å¯¼å‡ºåŠŸèƒ½<br>8ã€é‚®ä»¶æŠ€æœ¯æ”¯æŒæœåŠ¡</p></blockquote><p>ä¸Šå‡ å¼ è‡ªç”¨æˆªå›¾</p><p><a href="http://0.serious.duapp.com/wp-content/uploads/Screenshot_2012-11-21-16-20-16.png"><img alt="" class="alignnone size-full wp-image-226" src="http://images.cy198706.com/Android/Screenshot_2012-11-21-16-20-16.png" style="height: 854px; width: 480px;" title="Screenshot_2012-11-21-16-20-16" /></a></p><p>è¿™ä¾¿æ˜¯å¼€å§‹ç•Œé¢äº†ï¼Œè¿‘æœŸçœ‹è¿‡çš„ä¹¦ç±éƒ½æ‘†åœ¨ä¸Šæ–¹äº†ï¼Œå¯ä»¥é€šè¿‡æ»‘åŠ¨æ¥é€‰æ‹©å…¶ä»–çš„ã€‚</p><p><a href="http://0.serious.duapp.com/wp-content/uploads/Screenshot_2012-11-21-16-21-13.png"><img alt="" class="alignnone size-full wp-image-224" src="http://images.cy198706.com/Android/Screenshot_2012-11-21-16-21-13.png" style="width: 480px; height: 854px;" title="Screenshot_2012-11-21-16-21-13" /></a></p><p>é˜…è¯»ç•Œé¢ã€‚å› ä¸ºæ˜¯epubä¹¦ç±ï¼Œæ‰€ä»¥æ’ç‰ˆæ–¹é¢åšå¾—ç›¸å½“ä¸é”™ã€‚</p><p><a href="http://0.serious.duapp.com/wp-content/uploads/Screenshot_2012-11-21-16-21-06.png"><img alt="" class="alignnone size-full wp-image-227" src="http://images.cy198706.com/Android/Screenshot_2012-11-21-16-21-06.png" style="width: 480px; height: 854px;" title="Screenshot_2012-11-21-16-21-06" /></a></p><p>å„ç§é…è‰²æ–¹æ¡ˆã€‚ç”¨äº†å¾ˆä¹…çš„ç¾Šçš®çº¸ï¼Œç°åœ¨å–œæ¬¢è“åº•ç™½å­—ã€‚</p><p><a href="http://0.serious.duapp.com/wp-content/uploads/Screenshot_2012-11-21-16-21-20.png"><img alt="" class="alignnone size-full wp-image-225" src="http://images.cy198706.com/Android/Screenshot_2012-11-21-16-21-20.png" style="width: 480px; height: 854px;" title="Screenshot_2012-11-21-16-21-20" /></a></p><p>å¯å®šåˆ¶æ€§éå¸¸å¼ºï¼Œæœ‰å¾ˆå¤šå¾ˆå¤šçš„è®¾ç½®é€‰é¡¹ï¼Œåƒæˆ‘ä¸€æ ·å–œæ¬¢æŠ˜è…¾çš„å¼ºè¿«ç—‡æ‚£è€…ï¼Œå¯ä»¥å¥½å¥½ç ”ç©¶ä¸€ä¸‹å­äº†ã€‚</p><p>é™„ä¸Šä¸‹è½½åœ°å€ï¼š<a href="http://www.coolapk.com/apk/3276/">å‡¶çŒ›çš„ä¼ é€é—¨</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŸè§†è®°è€…ç›´æ’­åå…«å¤§æ—¶å¿˜è¯è¿çº¿ä¸­æ–­</title>
      <link href="/2012-11-20//"/>
      <url>/2012-11-20//</url>
      
        <content type="html"><![CDATA[<p>å¿˜è¯å¾ˆå¸¸è§ï¼Œä½†è¿™ä¹ˆé‡è¦çš„æ—¶åˆ»å¿˜è¯ï¼Œå°±æ˜¯è®°è€…çš„é—®é¢˜äº†ã€‚è¿™æ˜¯CCAVçš„èŠ‚ç›®ï¼Œå¤©æœæœ€å¤§çš„åª’ä½“ï¼Œåœ¨å®¡æ ¸è®°è€…çš„æ°´å¹³ä¸Šï¼Œçœ‹èµ·æ¥è¿˜çœŸæ˜¯ä¸å°½äººæ„ã€‚</p><p>ä¸è¿‡è¿˜å¥½æˆ‘ä»¬æœ‰â€œç”±äºæŠ€æœ¯åŸå› ï¼Œè¿çº¿æš‚æ—¶ä¸­æ–­â€è¿™ç§å€Ÿå£ï¼Œä½†æ˜¯ä¸»æŒäººç”¨çš„ä¸æ˜¯åœ°æ–¹ã€‚ç¬¬ä¸€æ¬¡å‘ç°è®°è€…å¼€å§‹å¿˜è¯çš„æ—¶å€™ï¼Œå°±åº”è¯¥é€Ÿåº¦æ•‘åœºï¼Œè€Œä¸æ˜¯æé†’ã€‚ç°åœºçš„å·¥ä½œåœ¨å‘˜ï¼Œåœ¨å‘ç°è¿™ç§å°´å°¬çš„æƒ…å†µæ—¶ï¼Œä¹Ÿåº”è¯¥é€Ÿåº¦ææ‰ç½‘ç»œï¼Œé€ æˆçœŸæ­£çš„â€œæŠ€æœ¯åŸå› â€ï¼Œä½†æ˜¯è¿™äº›æœ¬è¯¥è®­ç»ƒæœ‰ç´ çš„â€œæ”»åŸç‹®â€å´æ²¡æœ‰åŠæ—¶è¿™ä¹ˆåšï¼ŒçœŸçœŸå«äººè´¹è§£ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå‘ç”Ÿè¿™ç§äº‹æƒ…ï¼Œæ€»è¯¥å¼•äººæ·±æ€ä¸€ä¸‹ï¼Œç©¶ç«Ÿæ˜¯è°ä¹‹è¿‡?</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ€åº¦, è§†é¢‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¸ç¦å¾ˆç®€å•</title>
      <link href="/2012-11-16//"/>
      <url>/2012-11-16//</url>
      
        <content type="html"><![CDATA[<p>æ˜¨å¤©æ™šä¸Šï¼Œåƒå®Œé¥­ï¼Œè¯•äº†è¯•æ–°ä¹°çš„ä¿æš–å†…è¡£ï¼Œå¾ˆæš–å’Œï¼Œå¾ˆèˆ’æœï¼Œå°±æƒ³ç€ç»™æˆ‘çˆ¸å¦ˆå’Œåª³å¦‡çš„çˆ¸å¦ˆä¸€äººå¼„ä¸€å¥—ï¼Œäºæ˜¯è·Ÿåª³å¦‡è¯´&ldquo;ç»™å’±çˆ¸å¦ˆä¸€äººå¼„ä¸€å¥—å°±è¡Œã€‚&rdquo;æ²¡æƒ³åˆ°åª³å¦‡å¬å®Œæ„£äº†ä¸€ä¸‹ï¼Œç„¶åä¸€è„¸æƒŠå–œåœ°æ‰‘è¿‡æ¥æŠ±ä½äº†æˆ‘ã€‚æˆ‘ä¹Ÿæ„£äº†ï¼Œç„¶åç¬é—´å°±æ˜ç™½è¿‡æ¥äº†ã€‚ å¥¹éœ€è¦çš„ä¸œè¥¿å¾ˆç®€å•ã€‚ä¸€ä¸ªè´´å¿ƒçš„åŠ¨ä½œï¼Œä¸€å¥ä¸ç»æ„çš„è¯ï¼Œä¸€ä»¶å¾®ä¸è¶³é“çš„å°äº‹ï¼Œéƒ½èƒ½è®©äººæ„ŸåŠ¨ã€‚ å¹¸ç¦å…¶å®å¾ˆç®€å•ï¼Œå°±çœ‹ä½ èƒ½ä¸èƒ½æ•æ‰åˆ°ã€‚<a href="http://images.cy198706.com/Gabby/hold your hands.jpg" target="_blank"><img alt="" src="http://images.cy198706.com/Gabby/hold%20your%20hands.jpg" style="width: 610px;" /></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åä¸½çš„èµ„æºç®¡ç†å™¨-Solid Explorer</title>
      <link href="/2012-11-15//"/>
      <url>/2012-11-15//</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰åœ¨éƒ½ä¸€ç›´åœ¨ç”¨REç®¡ç†å™¨ï¼Œæ„Ÿè§‰ä¸é”™ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ“ä½œä¹Ÿå¿«æ·ã€‚åæ¥åœ¨é…·å®‰å¸‚åœºå‘ç°äº†è¿™ä¸ªèµ„æºç®¡ç†å™¨ï¼Œå°±å®Œå…¨æŠŠREæŠ›å¼ƒäº†ã€‚ Solid Explorerï¼ˆSEï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥è·å¾—Rootæƒé™çš„èµ„æºç®¡ç†å™¨ï¼Œä¹Ÿç®—æ˜¯ä¸ªæ–°ä¸œè¥¿ï¼Œç°åœ¨ç”¨æˆ·é‡ä¹Ÿåœ¨æ…¢æ…¢æ¶¨èµ·æ¥ã€‚åˆ†é¡µæ¨¡å¼è®©æ“ä½œå˜å¾—æ›´åŠ å¿«æ·ï¼Œåä¸½çš„UIè®©äººä¸€è¿›å…¥å°±çˆ±ä¸é‡Šæ‰‹ã€‚æˆ‘æ‰¿è®¤ï¼Œæˆ‘å°±æ˜¯è¢«è¿™ä¸œè¥¿çš„UIå¸å¼•çš„ã€‚ã€‚<span id="more"></span>&nbsp;æ¥ä¸¤å¼ å›¾å§ã€‚</p><div style="text-align: center;">  <a href="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-11-57.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-11-57.png" style="width: 480px; height: 854px;" /></a></div><p>Solid Explorer çš„ç•Œé¢ç®€æ´é«˜é›…ï¼Œé™¤äº†å¼ºå¤§çš„æœ¬åœ°æ–‡ä»¶ç®¡ç†åŠŸèƒ½ä¹‹å¤–ï¼Œå®ƒè¿˜èƒ½è¯»å–å’Œæ“ä½œè¿œç¨‹ç”µè„‘çš„æ–‡ä»¶å…±äº«å’ŒFTP/SFTPæœåŠ¡å™¨ç­‰ï¼Œç”šè‡³è¿˜èƒ½ç®¡ç†å¦‚ Dropboxã€SkyDriveã€Google Driveã€Box ç­‰äº‘ç«¯ç½‘ç»œç¡¬ç›˜ï¼ŒåŠŸèƒ½é‚£æ˜¯ç›¸å½“çš„å…¨é¢ã€‚</p><div style="text-align: center;">  <a href="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-12-21.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-12-21.png" style="width: 480px; height: 854px;" /></a></div><p>æœ€è®©æˆ‘å–œçˆ±çš„è¿˜æ˜¯å®ƒæ‹¥æœ‰çš„ä¸¤ä¸ªç‹¬ç«‹æµè§ˆé¢æ¿ï¼ˆè¿™ä¹Ÿæ˜¯å®ƒçš„æœ€å¤§çš„ç‰¹è‰²æ‰€åœ¨ï¼‰ï¼Œä½ åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­å¤åˆ¶äº†æŸä¸ªæ–‡ä»¶åï¼Œæ»‘åŠ¨ä¸€ä¸‹ï¼Œå°±èƒ½è½¬åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åå°±å‰ªè´´è¿‡å»å°±å¥½äº†ã€‚</p><div style="text-align: center;">  <a href="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-14-56.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-14-56.png" style="width: 480px; height: 854px;" /></a></div><p>ç„¶åè®©äººçœ¼å‰ä¸€äº®çš„æ˜¯æ›´æ”¹æ–‡ä»¶å±æ€§çš„é¡µé¢ï¼Œéå¸¸æ£’ï¼Œå¾ˆç›´è§‚ï¼Œè¿˜æœ‰md5æ ¡éªŒçš„åŠŸèƒ½ã€‚</p><div style="text-align: center;">  <a href="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-16-20.png" target="_blank"><img alt="" src="http://images.cy198706.com/Android/Screenshot_2012-11-15-14-16-20.png" style="width: 480px; height: 854px;" /></a></div><p>å…¶å®è¿™å°ä¸œè¥¿ä¹Ÿç®—å°ä¼—è½¯ä»¶äº†ï¼ŒçŸ¥æ™“çš„äººå¹¶ä¸å¤šï¼Œç”¨è¿‡çš„æ‰çŸ¥é“^^ æœ€åé™„ä¸Šä¸ªä¸‹è½½åœ°å€å§ã€‚<a href="http://www.coolapk.com/apk/5192/" target="_blank" title="ä½è°ƒçš„ä¼ é€é—¨">ä½è°ƒçš„ä¼ é€é—¨</a> &nbsp;</p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Elvis Aron Presley &amp;#8211; My Way</title>
      <link href="/2012-11-15//"/>
      <url>/2012-11-15//</url>
      
        <content type="html"><![CDATA[<p>æ‚²ä¼¤çš„æ­Œæ›²ã€‚</p><blockquote><p>ã€ŠMy Wayã€‹æ˜¯ä¸€é¦–æ¬§ç¾è‘—åè‹±æ–‡æµè¡Œæ›²ï¼Œæ—‹å¾‹æºè‡ªæ³•å›½åæ›²Comme dâ€™habitudeï¼ˆä¸€å¦‚å¾€æ—¥ï¼‰ï¼Œæ³•æ–‡åŸç‰ˆç”±å…‹ç½—å¾·&middot;æ³•å…°ç´¢ç“¦ï¼ˆClaude Fran&ccedil;oisï¼‰ã€é›…å…‹&middot;èµ«éœï¼ˆJacques Revauxï¼‰åŠå‰å°”&middot;æä¼¯ï¼ˆGilles Thibautï¼‰åœ¨1967å¹´å…±åŒåˆ›ä½œï¼Œéšåç”±ä¿ç½—&middot;å®‰å¡ï¼ˆPaul Ankaï¼‰æ”¹ç¼–æˆè‹±æ–‡ç‰ˆï¼Œ1969å¹´é¦–æ¬¡æ”¶å½•åœ¨æ³•å…°&middot;ä»™çº³æœæ‹‰åŒåå¤§ç¢Ÿï¼Œè‡ªæ­¤é£é¡å…¨çƒã€‚è¿™é¦–æ­Œä¸ä½†æˆä¸ºä»™çº³æœæ‹‰çš„ä»£è¡¨ä½œï¼Œåœ¨æµè¡Œæ–‡åŒ–ä¸Šäº¦å¸¸è¢«ç”¨ä½œä¸ºå‘Šåˆ«æ›²ï¼Œè¡¨ç¤ºä¸€åœºè¡¨æ¼”çš„ç»“æŸæˆ–ä¸€ä¸ªäººçš„ç¦»å¼€ã€‚è¿™äº¦æ˜¯è‹±å›½æœ€å—æ¬¢è¿çš„ä¸§ç¤¼æŒ½æ›²ã€‚ç›¸æ¯”è‹±æ–‡ç‰ˆå“€ä¼¤çš„æ›²è°ƒï¼Œæ³•æ–‡ç‰ˆçš„é…ä¹åˆ™æœ‰å¿§ä¼¤ã€è½»å¿«ã€æˆ–æ‘‡æ»šç‰ˆæœ¬ã€‚ &#8211;æ¥è‡ªåº¦å¨˜</p></blockquote><p>å…¶å®è¿™é¦–æ­Œæœ¬æ¥ä¸å–œæ¬¢ï¼Œä½†æœ‹å‹æ— æ„é—´æ¨èäº†ä¸€ä¸‹ï¼Œåˆæ‰¾äº†äº›èƒŒæ™¯èµ„æ–™ï¼Œå°±å–œæ¬¢ä¸Šäº†ã€‚ è¿™é¦–æ­Œè›®å¥‡æ€ªçš„ã€‚è¿™é¦–æ­Œæ›²åˆ›ä½œæ—¶ï¼Œå…‹ç½—å¾·&middot;æ³•å…°ç´¢ç“¦åˆšåˆšä¸ä¸€ä½å«æ³•å…°ä¸&middot;ç›–å°”ï¼ˆFrance Gallï¼‰çš„å¥³å­åˆ†æ‰‹ï¼Œå¿ƒæƒ…æŠ‘éƒï¼Œå½“ä»–åœ¨å‹äººå‰å“¼å‡ºè¿™é¦–æ­Œçš„æ—‹å¾‹åï¼Œä»–ä»¬ä¸€åŒç¼–å†™æ­Œè¯ï¼Œè¡¨è¾¾å…‹ç½—å¾·å¤±æ‹çš„å¿ƒæƒ…ï¼Œåˆ›ä½œè¿™é¦–æ­Œåçš„11å¹´ï¼Œä»–åœ¨æµ´ç¼¸ä¸­æ„å¤–è¢«ç”µæ­»ï¼Œè¿™ä¹Ÿæˆä¸ºä»–çš„å‘Šåˆ«ä½œã€‚ è¿™é¦–æ­Œæœ€åˆæ”¹ä½œè‹±æ–‡ç‰ˆæ—¶ï¼Œæ›¾æœ‰ä¸åŒæ­Œè¯æ¨å‡ºï¼Œå…¶ä¸­å½“æ—¶åˆå‡ºé“çš„å¤§å«&middot;å®å„¿æŠŠæ­Œè¯å†™æˆEven a Fool Learns to Loveï¼ˆå‚»å­ä¹Ÿå­¦ä¼šçˆ±ï¼‰ï¼Œä½†ä¿ç½—&middot;å®‰å¡æœ€åä¹°äº†æ³•æ–‡ç‰ˆçš„æ—‹å¾‹ï¼Œ1969å¹´æ”¹æˆMy Wayï¼Œå¹¶äº¤ç”±ç¾å›½è‘—åæ­Œæ‰‹æ³•å…°&middot;ä»™çº³æœæ‹‰æ¼”å‡ºè¿™é¦–æ­Œï¼Œå¤§å«&middot;å®å„¿çš„ç‰ˆæœ¬ä»æœªæ›¾æ¼”å‡ºã€‚ åœ¨è¥¿æ–¹æµè¡Œä¹å›ä¸­ï¼Œç»å¸¸æŠŠè¿™é¦–æ­Œä¸ç¦»åˆ«åˆ»æ„æ‰¯ä¸Šå…³ç³»ï¼Œå¦‚&ldquo;çŒ«ç‹&rdquo;çš®ç¤¼å£«åˆ©åœ¨1970å¹´ä¸­æœŸæ›¾è¡¨æ¼”è¿™é¦–ä½œå“ï¼Œä¸ä¹…åé€ä¸–ï¼Œä»¤ä¹è¿·å¼•èµ·éæ€ã€‚æ­¤åï¼Œç”µå½±ã€Šç›—äº¦æœ‰ç›—ã€‹ï¼ˆGoodFellasï¼‰ä»¥æ­¤ä½œä¸ºé—­å¹•æ­Œæ›²ï¼›è€Œå¾·å›½å‰æ€»ç†æ–½ç½—å¾·åœ¨ç¦»ä»»æ—¶äº¦ç‰¹åˆ«è¦æ±‚ä»¥æ­¤æ›²å‘Šåˆ«ã€‚ æ ¹æ®è‹±å›½ã€Šå«æŠ¥ã€‹çš„èµ„æ–™ï¼Œè¿™é¦–æ­Œå·²æˆäº†è‹±å›½æœ€å¸¸æ’­æ”¾çš„ä¸§ç¤¼æ­Œæ›²ï¼›ç¾å›½è½¦æ‰‹é˜¿ä¼¦&middot;åº“å°”å¨åŸºï¼ˆAlan Kulwickiï¼‰1993å¹´ç¦»ä¸–åï¼Œä»–çš„å‹äººä¹Ÿé€‰äº†My Wayä¸ºæŒ½æ›²ã€‚æ­Œæ›²ä¸­çš„I did it my wayï¼ˆæˆ‘èµ°æˆ‘çš„è·¯ï¼‰ï¼Œäº¦æˆä¸ºå®¶ä¼ æˆ·æ™“çš„åº§å³é“­ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> éŸ³ä¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ®ç”Ÿè‹¥æ¢¦</title>
      <link href="/2012-11-13//"/>
      <url>/2012-11-13//</url>
      
        <content type="html"><![CDATA[<p><a href="http://images.cy198706.com/Android/boat-in-water.jpg" target="_blank"><img alt="" src="http://images.cy198706.com/Gabby/boat-in-water.jpg" /></a><br>å›¾ç‰‡å¾ˆæ£’ï¼Œåˆ†äº«ä¹‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> å£æ°´, å›¾å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”Ÿæ´»è¿˜æ˜¯å¾ˆç¾å¥½</title>
      <link href="/2012-11-12//"/>
      <url>/2012-11-12//</url>
      
        <content type="html"><![CDATA[<p>æ˜¨æ™šè·Ÿåª³å¦‡èŠäº†ä¸€æ™šä¸Šï¼Œæ„Ÿè§‰è·ç¦»æ›´è¿‘äº†ï¼Œè¿™ç§æ„Ÿè§‰è®©äººå‘è‡ªå†…å¿ƒåœ°èˆ’æœã€‚ çˆ±ä½ ï¼Œè€å©†ã€‚<br><a href="http://img29.wal8.com/img29/310877_20121224145902/135634222435.jpg" target="_blank"><img alt="" src="http://images.cy198706.com/Gabby/she.jpg" style="width: 224px; height: 300px;" /></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç‰¹åˆ«æƒ³å›å®¶</title>
      <link href="/2012-11-07//"/>
      <url>/2012-11-07//</url>
      
        <content type="html"><![CDATA[<p>ç°åœ¨å›å®¶è¦1ä¸ªå°æ—¶ï¼Œå¾ˆç´¯ã€‚ æƒ³æ—©ç‚¹å›å»è§åª³å¦‡ã€‚&nbsp;<br><a href="http://images.cy198706.com/Gabby/97c2ba7c8c52eddc6f2a2c2b5a781fb6.jpg" target="_blank"><img alt="" src="http://images.cy198706.com/Gabby/97c2ba7c8c52eddc6f2a2c2b5a781fb6.jpg" style="width: 610px;" /></a><br>=ã€‚=è¿™æ˜¯ç½‘ä¸Šæ‰¾çš„å›¾ç‰‡</p>]]></content>
      
      
      
        <tags>
            
            <tag> å£æ°´ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
