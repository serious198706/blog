<!DOCTYPE html><html class="appearance-user-can-set" lang="zh"><head><meta charset="UTF-8"><title>Notex</title><meta name="description" content="Keep low profile, he said."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="8. 状态（State）Intent允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它所属的类。
Class Diagram  

Implementation糖果销售机有多种状态，每种状态下销售机有不同的行为，状态可以发生转移，使得销售机的行为也发生改变。
  

public interface State &amp;#123;
    /**
     * 投入 25 分钱
     */
    void insertQuarter();

    /**
     * 退回 25 分钱
     */
    void ejectQuarter();

    /**
     * 转动曲柄
     */
    void turnCrank();

    /**
     * 发放糖果
 .."><script src="//unpkg.com/valine/dist/Valine.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><!-- a(href= url_for("/"))= (theme.user && theme.user.name || config.author) + "'s blog"--><a href="/">Notex</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center"></p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">主页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">主页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%8A%B6%E6%80%81%EF%BC%88State%EF%BC%89"><span class="toc-text">8. 状态（State）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent"><span class="toc-text">Intent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class-Diagram"><span class="toc-text">Class Diagram</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implementation"><span class="toc-text">Implementation</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle"></h1><time class="has-text-grey" datetime="2023-01-31T06:58:14.698Z">2023-01-31</time><article class="mt-2 post-content"><h2 id="8-状态（State）"><a href="#8-状态（State）" class="headerlink" title="8. 状态（State）"></a>8. 状态（State）</h2><h3 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h3><p>允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它所属的类。</p>
<h3 id="Class-Diagram"><a href="#Class-Diagram" class="headerlink" title="Class Diagram"></a>Class Diagram</h3><div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/79df886f-fdc3-4020-a07f-c991bb58e0d8.png"/> </div><br>

<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p>糖果销售机有多种状态，每种状态下销售机有不同的行为，状态可以发生转移，使得销售机的行为也发生改变。</p>
<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/396be981-3f2c-4fd9-8101-dbf9c841504b.jpg" width="600"/> </div><br>

<pre><code class="java">public interface State &#123;
    /**
     * 投入 25 分钱
     */
    void insertQuarter();

    /**
     * 退回 25 分钱
     */
    void ejectQuarter();

    /**
     * 转动曲柄
     */
    void turnCrank();

    /**
     * 发放糖果
     */
    void dispense();
&#125;
</code></pre>
<pre><code class="java">public class HasQuarterState implements State &#123;

    private GumballMachine gumballMachine;

    public HasQuarterState(GumballMachine gumballMachine) &#123;
        this.gumballMachine = gumballMachine;
    &#125;

    @Override
    public void insertQuarter() &#123;
        System.out.println(&quot;You can&#39;t insert another quarter&quot;);
    &#125;

    @Override
    public void ejectQuarter() &#123;
        System.out.println(&quot;Quarter returned&quot;);
        gumballMachine.setState(gumballMachine.getNoQuarterState());
    &#125;

    @Override
    public void turnCrank() &#123;
        System.out.println(&quot;You turned...&quot;);
        gumballMachine.setState(gumballMachine.getSoldState());
    &#125;

    @Override
    public void dispense() &#123;
        System.out.println(&quot;No gumball dispensed&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class NoQuarterState implements State &#123;

    GumballMachine gumballMachine;

    public NoQuarterState(GumballMachine gumballMachine) &#123;
        this.gumballMachine = gumballMachine;
    &#125;

    @Override
    public void insertQuarter() &#123;
        System.out.println(&quot;You insert a quarter&quot;);
        gumballMachine.setState(gumballMachine.getHasQuarterState());
    &#125;

    @Override
    public void ejectQuarter() &#123;
        System.out.println(&quot;You haven&#39;t insert a quarter&quot;);
    &#125;

    @Override
    public void turnCrank() &#123;
        System.out.println(&quot;You turned, but there&#39;s no quarter&quot;);
    &#125;

    @Override
    public void dispense() &#123;
        System.out.println(&quot;You need to pay first&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class SoldOutState implements State &#123;

    GumballMachine gumballMachine;

    public SoldOutState(GumballMachine gumballMachine) &#123;
        this.gumballMachine = gumballMachine;
    &#125;

    @Override
    public void insertQuarter() &#123;
        System.out.println(&quot;You can&#39;t insert a quarter, the machine is sold out&quot;);
    &#125;

    @Override
    public void ejectQuarter() &#123;
        System.out.println(&quot;You can&#39;t eject, you haven&#39;t inserted a quarter yet&quot;);
    &#125;

    @Override
    public void turnCrank() &#123;
        System.out.println(&quot;You turned, but there are no gumballs&quot;);
    &#125;

    @Override
    public void dispense() &#123;
        System.out.println(&quot;No gumball dispensed&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class SoldState implements State &#123;

    GumballMachine gumballMachine;

    public SoldState(GumballMachine gumballMachine) &#123;
        this.gumballMachine = gumballMachine;
    &#125;

    @Override
    public void insertQuarter() &#123;
        System.out.println(&quot;Please wait, we&#39;re already giving you a gumball&quot;);
    &#125;

    @Override
    public void ejectQuarter() &#123;
        System.out.println(&quot;Sorry, you already turned the crank&quot;);
    &#125;

    @Override
    public void turnCrank() &#123;
        System.out.println(&quot;Turning twice doesn&#39;t get you another gumball!&quot;);
    &#125;

    @Override
    public void dispense() &#123;
        gumballMachine.releaseBall();
        if (gumballMachine.getCount() &gt; 0) &#123;
            gumballMachine.setState(gumballMachine.getNoQuarterState());
        &#125; else &#123;
            System.out.println(&quot;Oops, out of gumballs&quot;);
            gumballMachine.setState(gumballMachine.getSoldOutState());
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class GumballMachine &#123;

    private State soldOutState;
    private State noQuarterState;
    private State hasQuarterState;
    private State soldState;

    private State state;
    private int count = 0;

    public GumballMachine(int numberGumballs) &#123;
        count = numberGumballs;
        soldOutState = new SoldOutState(this);
        noQuarterState = new NoQuarterState(this);
        hasQuarterState = new HasQuarterState(this);
        soldState = new SoldState(this);

        if (numberGumballs &gt; 0) &#123;
            state = noQuarterState;
        &#125; else &#123;
            state = soldOutState;
        &#125;
    &#125;

    public void insertQuarter() &#123;
        state.insertQuarter();
    &#125;

    public void ejectQuarter() &#123;
        state.ejectQuarter();
    &#125;

    public void turnCrank() &#123;
        state.turnCrank();
        state.dispense();
    &#125;

    public void setState(State state) &#123;
        this.state = state;
    &#125;

    public void releaseBall() &#123;
        System.out.println(&quot;A gumball comes rolling out the slot...&quot;);
        if (count != 0) &#123;
            count -= 1;
        &#125;
    &#125;

    public State getSoldOutState() &#123;
        return soldOutState;
    &#125;

    public State getNoQuarterState() &#123;
        return noQuarterState;
    &#125;

    public State getHasQuarterState() &#123;
        return hasQuarterState;
    &#125;

    public State getSoldState() &#123;
        return soldState;
    &#125;

    public int getCount() &#123;
        return count;
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class Client &#123;

    public static void main(String[] args) &#123;
        GumballMachine gumballMachine = new GumballMachine(5);

        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();

        gumballMachine.insertQuarter();
        gumballMachine.ejectQuarter();
        gumballMachine.turnCrank();

        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.ejectQuarter();

        gumballMachine.insertQuarter();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
    &#125;
&#125;
</code></pre>
<pre><code class="html">You insert a quarter
You turned...
A gumball comes rolling out the slot...
You insert a quarter
Quarter returned
You turned, but there&#39;s no quarter
You need to pay first
You insert a quarter
You turned...
A gumball comes rolling out the slot...
You insert a quarter
You turned...
A gumball comes rolling out the slot...
You haven&#39;t insert a quarter
You insert a quarter
You can&#39;t insert another quarter
You turned...
A gumball comes rolling out the slot...
You insert a quarter
You turned...
A gumball comes rolling out the slot...
Oops, out of gumballs
You can&#39;t insert a quarter, the machine is sold out
You turned, but there are no gumballs
No gumball dispensed
</code></pre>
<div align="center"><img width="320px" src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/githubio/公众号二维码-2.png"></img></div>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em></section><article class="mt-6 comment-container" id="vcomments" data-comment_valine_id="b7rbKQnQFa9DYl1anYfacJRz-gzGzoHsz" data-comment_valine_key="nUuKvGHOJBRylruJLW2Fmekg"></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/serious198706"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> cy198706 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="京ICP备2022033375号" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">京ICP备2022033375号 </a></p></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>